# Comparing `tmp/meerk40t-0.8.3000.tar.gz` & `tmp/meerk40t-0.8.4000.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "meerk40t-0.8.3000.tar", last modified: Thu Apr 13 19:28:32 2023, max compression
+gzip compressed data, was "meerk40t-0.8.4000.tar", last modified: Sat Apr 29 16:58:21 2023, max compression
```

## Comparing `meerk40t-0.8.3000.tar` & `meerk40t-0.8.4000.tar`

### file list

```diff
@@ -1,454 +1,466 @@
-drwxrwxrwx   0        0        0        0 2023-04-13 19:28:32.569637 meerk40t-0.8.3000/
--rw-rw-rw-   0        0        0     1086 2022-08-29 19:57:50.000000 meerk40t-0.8.3000/LICENSE
--rw-rw-rw-   0        0        0     5619 2023-04-13 19:28:32.570638 meerk40t-0.8.3000/PKG-INFO
--rw-rw-rw-   0        0        0     3981 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/README.md
-drwxrwxrwx   0        0        0        0 2023-04-13 19:28:31.632584 meerk40t-0.8.3000/meerk40t/
--rw-rw-rw-   0        0        0       19 2022-08-29 19:57:50.000000 meerk40t-0.8.3000/meerk40t/__init__.py
-drwxrwxrwx   0        0        0        0 2023-04-13 19:28:31.651585 meerk40t-0.8.3000/meerk40t/balormk/
--rw-rw-rw-   0        0        0        0 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/balormk/__init__.py
--rw-rw-rw-   0        0        0     5556 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/balormk/balor_params.py
--rw-rw-rw-   0        0        0    46666 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/balormk/controller.py
--rw-rw-rw-   0        0        0    69394 2023-04-13 18:18:16.000000 meerk40t-0.8.3000/meerk40t/balormk/device.py
--rw-rw-rw-   0        0        0    21033 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/balormk/driver.py
--rw-rw-rw-   0        0        0     5304 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/balormk/elementlightjob.py
-drwxrwxrwx   0        0        0        0 2023-04-13 19:28:31.658585 meerk40t-0.8.3000/meerk40t/balormk/gui/
--rw-rw-rw-   0        0        0        0 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/balormk/gui/__init__.py
--rw-rw-rw-   0        0        0     3941 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/balormk/gui/balorconfig.py
--rw-rw-rw-   0        0        0     5987 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/balormk/gui/balorcontroller.py
--rw-rw-rw-   0        0        0     5858 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/balormk/gui/baloroperationproperties.py
--rw-rw-rw-   0        0        0     5311 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/balormk/gui/gui.py
--rw-rw-rw-   0        0        0     7755 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/balormk/livefulllightjob.py
--rw-rw-rw-   0        0        0     5981 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/balormk/liveselectionlightjob.py
--rw-rw-rw-   0        0        0     3646 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/balormk/mock_connection.py
--rw-rw-rw-   0        0        0     4991 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/balormk/plugin.py
--rw-rw-rw-   0        0        0    11181 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/balormk/usb_connection.py
-drwxrwxrwx   0        0        0        0 2023-04-13 19:28:31.663586 meerk40t-0.8.3000/meerk40t/camera/
--rw-rw-rw-   0        0        0       17 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/camera/__init__.py
--rw-rw-rw-   0        0        0    13273 2023-04-13 18:18:16.000000 meerk40t-0.8.3000/meerk40t/camera/camera.py
-drwxrwxrwx   0        0        0        0 2023-04-13 19:28:31.668586 meerk40t-0.8.3000/meerk40t/camera/gui/
--rw-rw-rw-   0        0        0        0 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/camera/gui/__init__.py
--rw-rw-rw-   0        0        0    40400 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/camera/gui/camerapanel.py
--rw-rw-rw-   0        0        0     2341 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/camera/gui/gui.py
--rw-rw-rw-   0        0        0    10112 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/camera/plugin.py
-drwxrwxrwx   0        0        0        0 2023-04-13 19:28:31.674586 meerk40t-0.8.3000/meerk40t/ch341/
--rw-rw-rw-   0        0        0      739 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/ch341/__init__.py
--rw-rw-rw-   0        0        0    21033 2023-04-13 18:18:16.000000 meerk40t-0.8.3000/meerk40t/ch341/libusb.py
--rw-rw-rw-   0        0        0     5511 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/ch341/mock.py
--rw-rw-rw-   0        0        0     6302 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/ch341/windll.py
-drwxrwxrwx   0        0        0        0 2023-04-13 19:28:31.702588 meerk40t-0.8.3000/meerk40t/core/
--rw-rw-rw-   0        0        0       15 2022-08-29 19:57:50.000000 meerk40t-0.8.3000/meerk40t/core/__init__.py
--rw-rw-rw-   0        0        0    17576 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/bindalias.py
--rw-rw-rw-   0        0        0      841 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/core.py
-drwxrwxrwx   0        0        0        0 2023-04-13 19:28:31.725589 meerk40t-0.8.3000/meerk40t/core/cutcode/
--rw-rw-rw-   0        0        0        0 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/core/cutcode/__init__.py
--rw-rw-rw-   0        0        0     2074 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/core/cutcode/cubiccut.py
--rw-rw-rw-   0        0        0    12244 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/core/cutcode/cutcode.py
--rw-rw-rw-   0        0        0     5392 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/core/cutcode/cutgroup.py
--rw-rw-rw-   0        0        0     5129 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/core/cutcode/cutobject.py
--rw-rw-rw-   0        0        0      847 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/core/cutcode/dwellcut.py
--rw-rw-rw-   0        0        0      727 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/core/cutcode/gotocut.py
--rw-rw-rw-   0        0        0      693 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/core/cutcode/homecut.py
--rw-rw-rw-   0        0        0      776 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/core/cutcode/inputcut.py
--rw-rw-rw-   0        0        0      952 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/core/cutcode/linecut.py
--rw-rw-rw-   0        0        0      786 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/core/cutcode/outputcut.py
--rw-rw-rw-   0        0        0    10490 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/core/cutcode/plotcut.py
--rw-rw-rw-   0        0        0     1653 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/core/cutcode/quadcut.py
--rw-rw-rw-   0        0        0     4168 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/core/cutcode/rastercut.py
--rw-rw-rw-   0        0        0      892 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/core/cutcode/setorigincut.py
--rw-rw-rw-   0        0        0      900 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/core/cutcode/waitcut.py
--rw-rw-rw-   0        0        0    41262 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/cutplan.py
--rw-rw-rw-   0        0        0    10443 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/drivers.py
-drwxrwxrwx   0        0        0        0 2023-04-13 19:28:31.753591 meerk40t-0.8.3000/meerk40t/core/elements/
--rw-rw-rw-   0        0        0        0 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/elements/__init__.py
--rw-rw-rw-   0        0        0    24140 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/elements/align.py
--rw-rw-rw-   0        0        0    50660 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/elements/branches.py
--rw-rw-rw-   0        0        0     7178 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/elements/clipboard.py
--rw-rw-rw-   0        0        0    87682 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/elements/element_treeops.py
--rw-rw-rw-   0        0        0     2561 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/elements/element_types.py
--rw-rw-rw-   0        0        0   149392 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/elements/elements.py
--rw-rw-rw-   0        0        0    19772 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/elements/grid.py
--rw-rw-rw-   0        0        0     3212 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/elements/materials.py
--rw-rw-rw-   0        0        0     1152 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/elements/notes.py
--rw-rw-rw-   0        0        0    10838 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/elements/penbox.py
--rw-rw-rw-   0        0        0    23836 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/elements/render.py
--rw-rw-rw-   0        0        0    76441 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/elements/shapes.py
--rw-rw-rw-   0        0        0    15500 2023-04-13 18:18:16.000000 meerk40t-0.8.3000/meerk40t/core/elements/trace.py
--rw-rw-rw-   0        0        0    14470 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/elements/tree_commands.py
--rw-rw-rw-   0        0        0     1571 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/elements/undo_redo.py
--rw-rw-rw-   0        0        0     8274 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/elements/wordlist.py
--rw-rw-rw-   0        0        0      269 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/core/exceptions.py
--rw-rw-rw-   0        0        0     9609 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/laserjob.py
--rw-rw-rw-   0        0        0     2136 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/logging.py
-drwxrwxrwx   0        0        0        0 2023-04-13 19:28:31.814594 meerk40t-0.8.3000/meerk40t/core/node/
--rw-rw-rw-   0        0        0        0 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/core/node/__init__.py
--rw-rw-rw-   0        0        0     1260 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/core/node/blobnode.py
--rw-rw-rw-   0        0        0     3949 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/core/node/bootstrap.py
--rw-rw-rw-   0        0        0      894 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/core/node/branch_elems.py
--rw-rw-rw-   0        0        0     1188 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/core/node/branch_ops.py
--rw-rw-rw-   0        0        0     1236 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/core/node/branch_regmark.py
--rw-rw-rw-   0        0        0      937 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/core/node/cutnode.py
--rw-rw-rw-   0        0        0     6801 2023-04-13 18:18:16.000000 meerk40t-0.8.3000/meerk40t/core/node/elem_ellipse.py
--rw-rw-rw-   0        0        0     3187 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/core/node/elem_geomstr.py
--rw-rw-rw-   0        0        0    30090 2023-04-13 18:18:16.000000 meerk40t-0.8.3000/meerk40t/core/node/elem_image.py
--rw-rw-rw-   0        0        0     6789 2023-04-13 18:18:16.000000 meerk40t-0.8.3000/meerk40t/core/node/elem_line.py
--rw-rw-rw-   0        0        0     6597 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/core/node/elem_path.py
--rw-rw-rw-   0        0        0     2654 2023-04-13 18:18:16.000000 meerk40t-0.8.3000/meerk40t/core/node/elem_point.py
--rw-rw-rw-   0        0        0     7041 2023-04-13 18:18:16.000000 meerk40t-0.8.3000/meerk40t/core/node/elem_polyline.py
--rw-rw-rw-   0        0        0     6805 2023-04-13 18:18:16.000000 meerk40t-0.8.3000/meerk40t/core/node/elem_rect.py
--rw-rw-rw-   0        0        0    15489 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/core/node/elem_text.py
--rw-rw-rw-   0        0        0     1088 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/core/node/filenode.py
--rw-rw-rw-   0        0        0     2139 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/core/node/groupnode.py
--rw-rw-rw-   0        0        0     1881 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/node/lasercodenode.py
--rw-rw-rw-   0        0        0      928 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/core/node/layernode.py
--rw-rw-rw-   0        0        0     2151 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/node/mixins.py
--rw-rw-rw-   0        0        0    36602 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/node/node.py
--rw-rw-rw-   0        0        0     3248 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/core/node/nutils.py
--rw-rw-rw-   0        0        0    12129 2023-04-13 18:18:16.000000 meerk40t-0.8.3000/meerk40t/core/node/op_cut.py
--rw-rw-rw-   0        0        0    10322 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/node/op_dots.py
--rw-rw-rw-   0        0        0    12180 2023-04-13 18:18:16.000000 meerk40t-0.8.3000/meerk40t/core/node/op_engrave.py
--rw-rw-rw-   0        0        0    15187 2023-04-13 18:18:16.000000 meerk40t-0.8.3000/meerk40t/core/node/op_hatch.py
--rw-rw-rw-   0        0        0    14409 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/node/op_image.py
--rw-rw-rw-   0        0        0    20645 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/node/op_raster.py
--rw-rw-rw-   0        0        0     1580 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/core/node/refnode.py
--rw-rw-rw-   0        0        0     7504 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/core/node/rootnode.py
--rw-rw-rw-   0        0        0     1511 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/node/util_console.py
--rw-rw-rw-   0        0        0     2216 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/node/util_goto.py
--rw-rw-rw-   0        0        0     1955 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/node/util_home.py
--rw-rw-rw-   0        0        0     3411 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/node/util_input.py
--rw-rw-rw-   0        0        0     2450 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/node/util_origin.py
--rw-rw-rw-   0        0        0     3451 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/node/util_output.py
--rw-rw-rw-   0        0        0     2220 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/node/util_wait.py
--rw-rw-rw-   0        0        0    16353 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/core/parameters.py
--rw-rw-rw-   0        0        0    30434 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/planner.py
--rw-rw-rw-   0        0        0    22754 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/plotplanner.py
--rw-rw-rw-   0        0        0    26854 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/spoolers.py
--rw-rw-rw-   0        0        0    47769 2023-04-13 19:21:44.000000 meerk40t-0.8.3000/meerk40t/core/svg_io.py
--rw-rw-rw-   0        0        0     6158 2023-04-13 18:18:16.000000 meerk40t-0.8.3000/meerk40t/core/treeop.py
--rw-rw-rw-   0        0        0     2858 2023-04-13 18:18:16.000000 meerk40t-0.8.3000/meerk40t/core/undos.py
--rw-rw-rw-   0        0        0    36569 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/units.py
--rw-rw-rw-   0        0        0     2859 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/webhelp.py
--rw-rw-rw-   0        0        0    17542 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/wordlist.py
-drwxrwxrwx   0        0        0        0 2023-04-13 19:28:31.819594 meerk40t-0.8.3000/meerk40t/device/
--rw-rw-rw-   0        0        0       17 2022-08-29 19:57:51.000000 meerk40t-0.8.3000/meerk40t/device/__init__.py
--rw-rw-rw-   0        0        0     4253 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/device/basedevice.py
-drwxrwxrwx   0        0        0        0 2023-04-13 19:28:31.828595 meerk40t-0.8.3000/meerk40t/device/ch341/
--rw-rw-rw-   0        0        0       16 2022-08-29 19:57:51.000000 meerk40t-0.8.3000/meerk40t/device/ch341/__init__.py
--rw-rw-rw-   0        0        0     7197 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/device/ch341/ch341.py
--rw-rw-rw-   0        0        0    16050 2023-04-13 18:18:16.000000 meerk40t-0.8.3000/meerk40t/device/ch341/ch341libusbdriver.py
--rw-rw-rw-   0        0        0     5505 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/device/ch341/libusb.py
--rw-rw-rw-   0        0        0     5948 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/device/ch341/mock.py
--rw-rw-rw-   0        0        0     6759 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/device/ch341/windll.py
--rw-rw-rw-   0        0        0     4504 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/device/dummydevice.py
-drwxrwxrwx   0        0        0        0 2023-04-13 19:28:31.835595 meerk40t-0.8.3000/meerk40t/device/gui/
--rw-rw-rw-   0        0        0        0 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/device/gui/__init__.py
--rw-rw-rw-   0        0        0    23841 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/device/gui/defaultactions.py
--rw-rw-rw-   0        0        0    10140 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/device/gui/formatterpanel.py
--rw-rw-rw-   0        0        0     9284 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/device/gui/warningpanel.py
-drwxrwxrwx   0        0        0        0 2023-04-13 19:28:31.840596 meerk40t-0.8.3000/meerk40t/dxf/
--rw-rw-rw-   0        0        0       14 2022-08-29 19:57:51.000000 meerk40t-0.8.3000/meerk40t/dxf/__init__.py
--rw-rw-rw-   0        0        0    23432 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/dxf/dxf_io.py
--rw-rw-rw-   0        0        0     1318 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/dxf/plugin.py
-drwxrwxrwx   0        0        0        0 2023-04-13 19:28:31.854596 meerk40t-0.8.3000/meerk40t/extra/
--rw-rw-rw-   0        0        0        0 2022-08-29 19:57:51.000000 meerk40t-0.8.3000/meerk40t/extra/__init__.py
--rw-rw-rw-   0        0        0     4516 2023-04-13 18:18:16.000000 meerk40t-0.8.3000/meerk40t/extra/cag.py
--rw-rw-rw-   0        0        0     2027 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/extra/embroider.py
--rw-rw-rw-   0        0        0    11380 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/extra/hershey.py
--rw-rw-rw-   0        0        0    12235 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/extra/imageactions.py
--rw-rw-rw-   0        0        0    22736 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/extra/inkscape.py
--rw-rw-rw-   0        0        0     8348 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/extra/pathoptimize.py
--rw-rw-rw-   0        0        0     9470 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/extra/potrace.py
--rw-rw-rw-   0        0        0    12356 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/extra/updater.py
--rw-rw-rw-   0        0        0     5120 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/extra/vectrace.py
--rw-rw-rw-   0        0        0     2769 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/extra/winsleep.py
-drwxrwxrwx   0        0        0        0 2023-04-13 19:28:31.859597 meerk40t-0.8.3000/meerk40t/fill/
--rw-rw-rw-   0        0        0        0 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/fill/__init__.py
--rw-rw-rw-   0        0        0    10357 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/fill/fills.py
--rw-rw-rw-   0        0        0    38279 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/fill/patternfill.py
--rw-rw-rw-   0        0        0    16519 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/fill/patterns.py
-drwxrwxrwx   0        0        0        0 2023-04-13 19:28:31.879598 meerk40t-0.8.3000/meerk40t/grbl/
--rw-rw-rw-   0        0        0        0 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/grbl/__init__.py
--rw-rw-rw-   0        0        0     2668 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/grbl/control.py
--rw-rw-rw-   0        0        0    18490 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/grbl/controller.py
--rw-rw-rw-   0        0        0    23410 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/grbl/device.py
--rw-rw-rw-   0        0        0    22452 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/grbl/driver.py
--rw-rw-rw-   0        0        0    18743 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/grbl/emulator.py
--rw-rw-rw-   0        0        0    27894 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/grbl/gcodejob.py
-drwxrwxrwx   0        0        0        0 2023-04-13 19:28:31.887598 meerk40t-0.8.3000/meerk40t/grbl/gui/
--rw-rw-rw-   0        0        0        0 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/grbl/gui/__init__.py
--rw-rw-rw-   0        0        0     6535 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/grbl/gui/grblconfiguration.py
--rw-rw-rw-   0        0        0     8386 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/grbl/gui/grblserialcontroller.py
--rw-rw-rw-   0        0        0     3800 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/grbl/gui/gui.py
--rw-rw-rw-   0        0        0     6870 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/grbl/gui/tcpcontroller.py
--rw-rw-rw-   0        0        0     1719 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/grbl/interpreter.py
--rw-rw-rw-   0        0        0      617 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/grbl/loader.py
--rw-rw-rw-   0        0        0     1677 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/grbl/mock_connection.py
--rw-rw-rw-   0        0        0     5760 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/grbl/plugin.py
--rw-rw-rw-   0        0        0     2667 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/grbl/serial_connection.py
--rw-rw-rw-   0        0        0     2602 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/grbl/tcp_connection.py
-drwxrwxrwx   0        0        0        0 2023-04-13 19:28:31.957602 meerk40t-0.8.3000/meerk40t/gui/
--rw-rw-rw-   0        0        0       14 2022-08-29 19:57:51.000000 meerk40t-0.8.3000/meerk40t/gui/__init__.py
--rw-rw-rw-   0        0        0    11627 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/about.py
--rw-rw-rw-   0        0        0    64914 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/alignment.py
--rw-rw-rw-   0        0        0     2314 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/gui/bufferview.py
--rw-rw-rw-   0        0        0     2645 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/busy.py
--rw-rw-rw-   0        0        0    62799 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/choicepropertypanel.py
--rw-rw-rw-   0        0        0    18111 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/consolepanel.py
--rw-rw-rw-   0        0        0    20394 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/devicepanel.py
--rw-rw-rw-   0        0        0     3866 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/gui/dialogoptions.py
--rw-rw-rw-   0        0        0    11766 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/executejob.py
--rw-rw-rw-   0        0        0     2800 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/gui/fonts.py
-drwxrwxrwx   0        0        0        0 2023-04-13 19:28:31.959602 meerk40t-0.8.3000/meerk40t/gui/help_assets/
--rw-rw-rw-   0        0        0        0 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/gui/help_assets/__init__.py
--rw-rw-rw-   0        0        0     9381 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/help_assets/help_assets.py
--rw-rw-rw-   0        0        0    31290 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/hersheymanager.py
--rw-rw-rw-   0        0        0   242725 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/icons.py
--rw-rw-rw-   0        0        0    19129 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/gui/imagesplitter.py
--rw-rw-rw-   0        0        0    11758 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/gui/keymap.py
--rw-rw-rw-   0        0        0    23975 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/laserpanel.py
--rw-rw-rw-   0        0        0    40207 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/laserrender.py
--rw-rw-rw-   0        0        0    30777 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/gui/lasertoolpanel.py
--rw-rw-rw-   0        0        0    56121 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/materialtest.py
--rw-rw-rw-   0        0        0     3623 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/gui/mkdebug.py
--rw-rw-rw-   0        0        0     4640 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/gui/mwindow.py
--rw-rw-rw-   0        0        0    81819 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/navigationpanels.py
--rw-rw-rw-   0        0        0     4715 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/gui/notes.py
--rw-rw-rw-   0        0        0    14969 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/opassignment.py
--rw-rw-rw-   0        0        0    10919 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/gui/operation_info.py
--rw-rw-rw-   0        0        0    11670 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/plugin.py
--rw-rw-rw-   0        0        0    20747 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/position.py
--rw-rw-rw-   0        0        0    21256 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/gui/preferences.py
-drwxrwxrwx   0        0        0        0 2023-04-13 19:28:31.983604 meerk40t-0.8.3000/meerk40t/gui/propertypanels/
--rw-rw-rw-   0        0        0        0 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/gui/propertypanels/__init__.py
--rw-rw-rw-   0        0        0    38620 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/gui/propertypanels/attributes.py
--rw-rw-rw-   0        0        0     5561 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/gui/propertypanels/blobproperty.py
--rw-rw-rw-   0        0        0     2837 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/gui/propertypanels/consoleproperty.py
--rw-rw-rw-   0        0        0     7360 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/gui/propertypanels/groupproperties.py
--rw-rw-rw-   0        0        0    53861 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/gui/propertypanels/imageproperty.py
--rw-rw-rw-   0        0        0     1781 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/gui/propertypanels/inputproperty.py
--rw-rw-rw-   0        0        0     2612 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/gui/propertypanels/opbranchproperties.py
--rw-rw-rw-   0        0        0    69312 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/propertypanels/operationpropertymain.py
--rw-rw-rw-   0        0        0     1789 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/gui/propertypanels/outputproperty.py
--rw-rw-rw-   0        0        0    13370 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/gui/propertypanels/pathproperty.py
--rw-rw-rw-   0        0        0     4398 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/gui/propertypanels/pointproperty.py
--rw-rw-rw-   0        0        0     5748 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/gui/propertypanels/propertywindow.py
--rw-rw-rw-   0        0        0    36709 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/gui/propertypanels/rasterwizardpanels.py
--rw-rw-rw-   0        0        0    27959 2023-04-13 18:18:16.000000 meerk40t-0.8.3000/meerk40t/gui/propertypanels/textproperty.py
--rw-rw-rw-   0        0        0     1771 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/gui/propertypanels/waitproperty.py
-drwxrwxrwx   0        0        0        0 2023-04-13 19:28:31.993605 meerk40t-0.8.3000/meerk40t/gui/scene/
--rw-rw-rw-   0        0        0        0 2022-08-29 19:57:51.000000 meerk40t-0.8.3000/meerk40t/gui/scene/__init__.py
--rw-rw-rw-   0        0        0     5180 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/gui/scene/guicolors.py
--rw-rw-rw-   0        0        0    33615 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/scene/scene.py
--rw-rw-rw-   0        0        0      648 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/scene/sceneconst.py
--rw-rw-rw-   0        0        0    11695 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/scene/scenepanel.py
--rw-rw-rw-   0        0        0    13224 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/gui/scene/scenespacewidget.py
--rw-rw-rw-   0        0        0    15826 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/scene/widget.py
-drwxrwxrwx   0        0        0        0 2023-04-13 19:28:32.012606 meerk40t-0.8.3000/meerk40t/gui/scenewidgets/
--rw-rw-rw-   0        0        0        0 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/gui/scenewidgets/__init__.py
--rw-rw-rw-   0        0        0    16441 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/scenewidgets/attractionwidget.py
--rw-rw-rw-   0        0        0     3033 2023-03-14 23:32:20.000000 meerk40t-0.8.3000/meerk40t/gui/scenewidgets/bedwidget.py
--rw-rw-rw-   0        0        0     3091 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/scenewidgets/elementswidget.py
--rw-rw-rw-   0        0        0    28381 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/scenewidgets/gridwidget.py
--rw-rw-rw-   0        0        0    28989 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/scenewidgets/guidewidget.py
--rw-rw-rw-   0        0        0     1876 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/gui/scenewidgets/laserpathwidget.py
--rw-rw-rw-   0        0        0     2343 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/gui/scenewidgets/machineoriginwidget.py
--rw-rw-rw-   0        0        0    12668 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/gui/scenewidgets/rectselectwidget.py
--rw-rw-rw-   0        0        0     1196 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/scenewidgets/relocatewidget.py
--rw-rw-rw-   0        0        0     2403 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/gui/scenewidgets/reticlewidget.py
--rw-rw-rw-   0        0        0   103117 2023-04-13 18:18:16.000000 meerk40t-0.8.3000/meerk40t/gui/scenewidgets/selectionwidget.py
--rw-rw-rw-   0        0        0    90312 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/simulation.py
--rw-rw-rw-   0        0        0     7291 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/gui/snapoptions.py
--rw-rw-rw-   0        0        0    39076 2023-04-13 18:18:16.000000 meerk40t-0.8.3000/meerk40t/gui/spoolerpanel.py
-drwxrwxrwx   0        0        0        0 2023-04-13 19:28:32.024606 meerk40t-0.8.3000/meerk40t/gui/statusbarwidgets/
--rw-rw-rw-   0        0        0        0 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/gui/statusbarwidgets/__init__.py
--rw-rw-rw-   0        0        0    17561 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/statusbarwidgets/infowidget.py
--rw-rw-rw-   0        0        0    13740 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/statusbarwidgets/opassignwidget.py
--rw-rw-rw-   0        0        0     3844 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/gui/statusbarwidgets/selectionwidget.py
--rw-rw-rw-   0        0        0     8335 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/gui/statusbarwidgets/shapepropwidget.py
--rw-rw-rw-   0        0        0     9756 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/gui/statusbarwidgets/statusbar.py
--rw-rw-rw-   0        0        0     9050 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/gui/statusbarwidgets/statusbarwidget.py
--rw-rw-rw-   0        0        0     9357 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/statusbarwidgets/strokewidget.py
-drwxrwxrwx   0        0        0        0 2023-04-13 19:28:32.052608 meerk40t-0.8.3000/meerk40t/gui/toolwidgets/
--rw-rw-rw-   0        0        0        0 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/gui/toolwidgets/__init__.py
--rw-rw-rw-   0        0        0      983 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/gui/toolwidgets/circlebrush.py
--rw-rw-rw-   0        0        0     8750 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/toolwidgets/toolcircle.py
--rw-rw-rw-   0        0        0     1476 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/toolwidgets/toolcontainer.py
--rw-rw-rw-   0        0        0     3313 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/toolwidgets/tooldraw.py
--rw-rw-rw-   0        0        0     8603 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/toolwidgets/toolellipse.py
--rw-rw-rw-   0        0        0     9358 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/toolwidgets/toollinetext.py
--rw-rw-rw-   0        0        0     7613 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/toolwidgets/toolmeasure.py
--rw-rw-rw-   0        0        0    94489 2023-04-13 18:18:16.000000 meerk40t-0.8.3000/meerk40t/gui/toolwidgets/toolnodeedit.py
--rw-rw-rw-   0        0        0     1791 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/toolwidgets/toolpoint.py
--rw-rw-rw-   0        0        0     7078 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/toolwidgets/toolpolygon.py
--rw-rw-rw-   0        0        0     7173 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/toolwidgets/toolpolyline.py
--rw-rw-rw-   0        0        0     8146 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/toolwidgets/toolrect.py
--rw-rw-rw-   0        0        0     2229 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/toolwidgets/toolrelocate.py
--rw-rw-rw-   0        0        0     4234 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/toolwidgets/toolribbon.py
--rw-rw-rw-   0        0        0     3061 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/toolwidgets/tooltext.py
--rw-rw-rw-   0        0        0     7516 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/toolwidgets/toolvector.py
--rw-rw-rw-   0        0        0     1194 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/gui/toolwidgets/toolwidget.py
--rw-rw-rw-   0        0        0     2844 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/gui/usbconnect.py
-drwxrwxrwx   0        0        0        0 2023-04-13 19:28:32.069609 meerk40t-0.8.3000/meerk40t/gui/utilitywidgets/
--rw-rw-rw-   0        0        0        0 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/gui/utilitywidgets/__init__.py
--rw-rw-rw-   0        0        0      737 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/utilitywidgets/buttonwidget.py
--rw-rw-rw-   0        0        0     2812 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/gui/utilitywidgets/checkboxwidget.py
--rw-rw-rw-   0        0        0    11773 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/gui/utilitywidgets/cyclocycloidwidget.py
--rw-rw-rw-   0        0        0      926 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/utilitywidgets/handlewidget.py
--rw-rw-rw-   0        0        0    13518 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/utilitywidgets/harmonograph.py
--rw-rw-rw-   0        0        0     1073 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/utilitywidgets/openclosewidget.py
--rw-rw-rw-   0        0        0     1914 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/utilitywidgets/rotationwidget.py
--rw-rw-rw-   0        0        0     2776 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/utilitywidgets/scalewidget.py
--rw-rw-rw-   0        0        0     5697 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/gui/utilitywidgets/seekbarwidget.py
--rw-rw-rw-   0        0        0     5167 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/gui/utilitywidgets/togglewidget.py
--rw-rw-rw-   0        0        0      344 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/utilitywidgets/toolbarwidget.py
--rw-rw-rw-   0        0        0    35380 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/gui/wordlisteditor.py
--rw-rw-rw-   0        0        0    37467 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/wxmeerk40t.py
--rw-rw-rw-   0        0        0   139114 2023-04-13 18:18:16.000000 meerk40t-0.8.3000/meerk40t/gui/wxmmain.py
--rw-rw-rw-   0        0        0    54031 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/wxmribbon.py
--rw-rw-rw-   0        0        0    49719 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/wxmscene.py
--rw-rw-rw-   0        0        0    69738 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/wxmtree.py
--rw-rw-rw-   0        0        0    32739 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/wxutils.py
--rw-rw-rw-   0        0        0     2807 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/gui/zmatrix.py
-drwxrwxrwx   0        0        0        0 2023-04-13 19:28:32.072609 meerk40t-0.8.3000/meerk40t/image/
--rw-rw-rw-   0        0        0       16 2022-08-29 19:57:51.000000 meerk40t-0.8.3000/meerk40t/image/__init__.py
--rw-rw-rw-   0        0        0    65324 2023-04-13 18:18:16.000000 meerk40t-0.8.3000/meerk40t/image/imagetools.py
-drwxrwxrwx   0        0        0        0 2023-04-13 19:28:32.090610 meerk40t-0.8.3000/meerk40t/kernel/
--rw-rw-rw-   0        0        0      344 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/kernel/__init__.py
--rw-rw-rw-   0        0        0     6819 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/kernel/channel.py
--rw-rw-rw-   0        0        0    18205 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/kernel/context.py
--rw-rw-rw-   0        0        0     1187 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/kernel/exceptions.py
--rw-rw-rw-   0        0        0    14995 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/kernel/functions.py
--rw-rw-rw-   0        0        0     2850 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/kernel/jobs.py
--rw-rw-rw-   0        0        0   132505 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/kernel/kernel.py
--rw-rw-rw-   0        0        0     2263 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/kernel/lifecycles.py
--rw-rw-rw-   0        0        0     1978 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/kernel/module.py
--rw-rw-rw-   0        0        0     5212 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/kernel/service.py
--rw-rw-rw-   0        0        0    11606 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/kernel/settings.py
--rw-rw-rw-   0        0        0      181 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/kernel/states.py
-drwxrwxrwx   0        0        0        0 2023-04-13 19:28:32.104611 meerk40t-0.8.3000/meerk40t/lihuiyu/
--rw-rw-rw-   0        0        0        0 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/lihuiyu/__init__.py
--rw-rw-rw-   0        0        0    31603 2023-04-13 18:18:16.000000 meerk40t-0.8.3000/meerk40t/lihuiyu/controller.py
--rw-rw-rw-   0        0        0    39947 2023-04-13 18:18:16.000000 meerk40t-0.8.3000/meerk40t/lihuiyu/device.py
--rw-rw-rw-   0        0        0    46862 2023-04-13 18:18:16.000000 meerk40t-0.8.3000/meerk40t/lihuiyu/driver.py
-drwxrwxrwx   0        0        0        0 2023-04-13 19:28:32.115611 meerk40t-0.8.3000/meerk40t/lihuiyu/gui/
--rw-rw-rw-   0        0        0        0 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/lihuiyu/gui/__init__.py
--rw-rw-rw-   0        0        0     4089 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/lihuiyu/gui/gui.py
--rw-rw-rw-   0        0        0    16374 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/lihuiyu/gui/lhyaccelgui.py
--rw-rw-rw-   0        0        0    24793 2023-04-13 18:18:16.000000 meerk40t-0.8.3000/meerk40t/lihuiyu/gui/lhycontrollergui.py
--rw-rw-rw-   0        0        0    17367 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/lihuiyu/gui/lhydrivergui.py
--rw-rw-rw-   0        0        0     9731 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/lihuiyu/gui/lhyoperationproperties.py
--rw-rw-rw-   0        0        0     7407 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/lihuiyu/gui/tcpcontroller.py
--rw-rw-rw-   0        0        0     1692 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/lihuiyu/interpreter.py
--rw-rw-rw-   0        0        0    16341 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/lihuiyu/laserspeed.py
--rw-rw-rw-   0        0        0     2622 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/lihuiyu/loader.py
--rw-rw-rw-   0        0        0    13937 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/lihuiyu/parser.py
--rw-rw-rw-   0        0        0     3815 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/lihuiyu/plugin.py
--rw-rw-rw-   0        0        0     3474 2023-04-13 18:18:16.000000 meerk40t-0.8.3000/meerk40t/lihuiyu/tcp_connection.py
--rw-rw-rw-   0        0        0     7233 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/main.py
-drwxrwxrwx   0        0        0        0 2023-04-13 19:28:32.124612 meerk40t-0.8.3000/meerk40t/moshi/
--rw-rw-rw-   0        0        0        0 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/moshi/__init__.py
--rw-rw-rw-   0        0        0    13904 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/moshi/builder.py
--rw-rw-rw-   0        0        0    17816 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/moshi/controller.py
--rw-rw-rw-   0        0        0    15320 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/moshi/device.py
--rw-rw-rw-   0        0        0    23830 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/moshi/driver.py
-drwxrwxrwx   0        0        0        0 2023-04-13 19:28:32.128612 meerk40t-0.8.3000/meerk40t/moshi/gui/
--rw-rw-rw-   0        0        0        0 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/moshi/gui/__init__.py
--rw-rw-rw-   0        0        0     2566 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/moshi/gui/gui.py
--rw-rw-rw-   0        0        0    21985 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/moshi/gui/moshicontrollergui.py
--rw-rw-rw-   0        0        0     3661 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/moshi/gui/moshidrivergui.py
--rw-rw-rw-   0        0        0     1462 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/moshi/plugin.py
-drwxrwxrwx   0        0        0        0 2023-04-13 19:28:32.135613 meerk40t-0.8.3000/meerk40t/network/
--rw-rw-rw-   0        0        0        0 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/network/__init__.py
--rw-rw-rw-   0        0        0     2111 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/network/console_server.py
--rw-rw-rw-   0        0        0      326 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/network/kernelserver.py
--rw-rw-rw-   0        0        0     5028 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/network/tcp_server.py
--rw-rw-rw-   0        0        0     2731 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/network/udp_server.py
-drwxrwxrwx   0        0        0        0 2023-04-13 19:28:32.148613 meerk40t-0.8.3000/meerk40t/newly/
--rw-rw-rw-   0        0        0        0 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/newly/__init__.py
--rw-rw-rw-   0        0        0    34652 2023-04-13 19:19:20.000000 meerk40t-0.8.3000/meerk40t/newly/controller.py
--rw-rw-rw-   0        0        0    24466 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/newly/device.py
--rw-rw-rw-   0        0        0    12770 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/newly/driver.py
-drwxrwxrwx   0        0        0        0 2023-04-13 19:28:32.155614 meerk40t-0.8.3000/meerk40t/newly/gui/
--rw-rw-rw-   0        0        0        0 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/newly/gui/__init__.py
--rw-rw-rw-   0        0        0     7263 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/newly/gui/gui.py
--rw-rw-rw-   0        0        0     3586 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/newly/gui/newlyconfig.py
--rw-rw-rw-   0        0        0     6105 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/newly/gui/newlycontroller.py
--rw-rw-rw-   0        0        0     1504 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/newly/gui/operationproperties.py
--rw-rw-rw-   0        0        0     2646 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/newly/mock_connection.py
--rw-rw-rw-   0        0        0     1642 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/newly/newly_params.py
--rw-rw-rw-   0        0        0    44191 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/newly/plugin.py
--rw-rw-rw-   0        0        0    12062 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/newly/usb_connection.py
-drwxrwxrwx   0        0        0        0 2023-04-13 19:28:32.158614 meerk40t-0.8.3000/meerk40t/rotary/
--rw-rw-rw-   0        0        0        0 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/rotary/__init__.py
-drwxrwxrwx   0        0        0        0 2023-04-13 19:28:32.162614 meerk40t-0.8.3000/meerk40t/rotary/gui/
--rw-rw-rw-   0        0        0        0 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/rotary/gui/__init__.py
--rw-rw-rw-   0        0        0     1645 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/rotary/gui/gui.py
--rw-rw-rw-   0        0        0     9599 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/rotary/gui/rotarysettings.py
--rw-rw-rw-   0        0        0     3187 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/rotary/rotary.py
-drwxrwxrwx   0        0        0        0 2023-04-13 19:28:32.178615 meerk40t-0.8.3000/meerk40t/ruida/
--rw-rw-rw-   0        0        0        0 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/ruida/__init__.py
--rw-rw-rw-   0        0        0     3256 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/ruida/control.py
--rw-rw-rw-   0        0        0    31762 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/ruida/controller.py
--rw-rw-rw-   0        0        0     6448 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/ruida/device.py
--rw-rw-rw-   0        0        0    15377 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/ruida/driver.py
--rw-rw-rw-   0        0        0    53016 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/ruida/emulator.py
--rw-rw-rw-   0        0        0      120 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/ruida/exceptions.py
-drwxrwxrwx   0        0        0        0 2023-04-13 19:28:32.186616 meerk40t-0.8.3000/meerk40t/ruida/gui/
--rw-rw-rw-   0        0        0        0 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/ruida/gui/__init__.py
--rw-rw-rw-   0        0        0     2840 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/ruida/gui/gui.py
--rw-rw-rw-   0        0        0     2505 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/ruida/gui/ruidaconfig.py
--rw-rw-rw-   0        0        0     5987 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/ruida/gui/ruidacontroller.py
--rw-rw-rw-   0        0        0     1274 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/ruida/gui/ruidaoperationproperties.py
--rw-rw-rw-   0        0        0      657 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/ruida/loader.py
--rw-rw-rw-   0        0        0     3654 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/ruida/mock_connection.py
--rw-rw-rw-   0        0        0     3157 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/ruida/plugin.py
--rw-rw-rw-   0        0        0    45282 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/ruida/rdjob.py
--rw-rw-rw-   0        0        0   338649 2023-04-13 18:18:16.000000 meerk40t-0.8.3000/meerk40t/svgelements.py
-drwxrwxrwx   0        0        0        0 2023-04-13 19:28:32.206617 meerk40t-0.8.3000/meerk40t/tools/
--rw-rw-rw-   0        0        0        0 2022-08-29 19:57:51.000000 meerk40t-0.8.3000/meerk40t/tools/__init__.py
--rw-rw-rw-   0        0        0    21419 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/tools/driver_to_path.py
--rw-rw-rw-   0        0        0    94058 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/tools/geomstr.py
--rw-rw-rw-   0        0        0    12007 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/tools/jhfparser.py
--rw-rw-rw-   0        0        0    42419 2023-04-13 18:18:16.000000 meerk40t-0.8.3000/meerk40t/tools/livinghinges.py
--rw-rw-rw-   0        0        0    31362 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/tools/pathtools.py
--rw-rw-rw-   0        0        0    35800 2022-08-29 19:57:51.000000 meerk40t-0.8.3000/meerk40t/tools/pointfinder.py
--rw-rw-rw-   0        0        0    28108 2023-04-13 18:18:16.000000 meerk40t-0.8.3000/meerk40t/tools/polybool.py
--rw-rw-rw-   0        0        0    20221 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/tools/rasterplotter.py
--rw-rw-rw-   0        0        0    30973 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/tools/shxparser.py
--rw-rw-rw-   0        0        0    16287 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/tools/ttfparser.py
--rw-rw-rw-   0        0        0    20709 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/tools/zinglplotter.py
-drwxrwxrwx   0        0        0        0 2023-04-13 19:28:32.471632 meerk40t-0.8.3000/meerk40t.egg-info/
--rw-rw-rw-   0        0        0     5619 2023-04-13 19:28:31.000000 meerk40t-0.8.3000/meerk40t.egg-info/PKG-INFO
--rw-rw-rw-   0        0        0    24970 2023-04-13 19:28:31.000000 meerk40t-0.8.3000/meerk40t.egg-info/SOURCES.txt
--rw-rw-rw-   0        0        0        1 2023-04-13 19:28:31.000000 meerk40t-0.8.3000/meerk40t.egg-info/dependency_links.txt
--rw-rw-rw-   0        0        0       48 2023-04-13 19:28:31.000000 meerk40t-0.8.3000/meerk40t.egg-info/entry_points.txt
--rw-rw-rw-   0        0        0      284 2023-04-13 19:28:31.000000 meerk40t-0.8.3000/meerk40t.egg-info/requires.txt
--rw-rw-rw-   0        0        0       14 2023-04-13 19:28:31.000000 meerk40t-0.8.3000/meerk40t.egg-info/top_level.txt
--rw-rw-rw-   0        0        0        2 2021-01-18 14:07:22.000000 meerk40t-0.8.3000/meerk40t.egg-info/zip-safe
--rw-rw-rw-   0        0        0    20222 2022-09-23 03:31:07.000000 meerk40t-0.8.3000/pyproject.toml
--rw-rw-rw-   0        0        0     1128 2023-04-13 19:28:32.571637 meerk40t-0.8.3000/setup.cfg
--rw-rw-rw-   0        0        0      581 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/setup.py
-drwxrwxrwx   0        0        0        0 2023-04-13 19:28:32.243619 meerk40t-0.8.3000/test/
--rw-rw-rw-   0        0        0        0 2022-08-29 19:57:51.000000 meerk40t-0.8.3000/test/__init__.py
--rw-rw-rw-   0        0        0     1493 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/test/bootstrap.py
--rw-rw-rw-   0        0        0      232 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/test/test_cli.py
--rw-rw-rw-   0        0        0    17155 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/test/test_core_cutcode.py
--rw-rw-rw-   0        0        0     4323 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/test/test_core_elements.py
--rw-rw-rw-   0        0        0    14608 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/test/test_core_plotplanner.py
--rw-rw-rw-   0        0        0    13742 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/test/test_core_viewports.py
--rw-rw-rw-   0        0        0     2393 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/test/test_drivers_grbl.py
--rw-rw-rw-   0        0        0    16583 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/test/test_drivers_lihuiyu.py
--rw-rw-rw-   0        0        0     2343 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/test/test_element_degenerate_points.py
--rw-rw-rw-   0        0        0     3341 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/test/test_elements_classify.py
--rw-rw-rw-   0        0        0      632 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/test/test_elements_penbox.py
--rw-rw-rw-   0        0        0     5392 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/test/test_fill.py
--rw-rw-rw-   0        0        0    32554 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/test/test_geomstr.py
--rw-rw-rw-   0        0        0    12913 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/test/test_imagetools_actualize.py
--rw-rw-rw-   0        0        0    11767 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/test/test_imagetools_wizard.py
--rw-rw-rw-   0        0        0     4701 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/test/test_kernel.py
--rw-rw-rw-   0        0        0   107060 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/test/test_laser_speeds.py
--rw-rw-rw-   0        0        0     2138 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/test/test_length.py
--rw-rw-rw-   0        0        0     2281 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/test/test_lifecycle.py
--rw-rw-rw-   0        0        0     1119 2023-04-13 18:18:16.000000 meerk40t-0.8.3000/test/test_operations_hatch.py
--rw-rw-rw-   0        0        0      591 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/test/test_spooler.py
--rw-rw-rw-   0        0        0     4624 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/test/test_wobble.py
--rw-rw-rw-   0        0        0     4190 2022-12-30 04:02:50.000000 meerk40t-0.8.3000/test/test_zingl.py
+drwxrwxrwx   0        0        0        0 2023-04-29 16:58:21.823976 meerk40t-0.8.4000/
+-rw-rw-rw-   0        0        0     1086 2022-08-29 19:57:50.000000 meerk40t-0.8.4000/LICENSE
+-rw-rw-rw-   0        0        0     5619 2023-04-29 16:58:21.824976 meerk40t-0.8.4000/PKG-INFO
+-rw-rw-rw-   0        0        0     3981 2023-04-26 18:27:23.000000 meerk40t-0.8.4000/README.md
+drwxrwxrwx   0        0        0        0 2023-04-29 16:58:21.028931 meerk40t-0.8.4000/meerk40t/
+-rw-rw-rw-   0        0        0       19 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/__init__.py
+drwxrwxrwx   0        0        0        0 2023-04-29 16:58:21.043932 meerk40t-0.8.4000/meerk40t/balormk/
+-rw-rw-rw-   0        0        0        0 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/balormk/__init__.py
+-rw-rw-rw-   0        0        0     5556 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/balormk/balor_params.py
+-rw-rw-rw-   0        0        0    46666 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/balormk/controller.py
+-rw-rw-rw-   0        0        0    69469 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/balormk/device.py
+-rw-rw-rw-   0        0        0    21033 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/balormk/driver.py
+-rw-rw-rw-   0        0        0     5304 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/balormk/elementlightjob.py
+drwxrwxrwx   0        0        0        0 2023-04-29 16:58:21.050932 meerk40t-0.8.4000/meerk40t/balormk/gui/
+-rw-rw-rw-   0        0        0        0 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/balormk/gui/__init__.py
+-rw-rw-rw-   0        0        0     3941 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/balormk/gui/balorconfig.py
+-rw-rw-rw-   0        0        0     5987 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/balormk/gui/balorcontroller.py
+-rw-rw-rw-   0        0        0     5858 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/balormk/gui/baloroperationproperties.py
+-rw-rw-rw-   0        0        0     5311 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/balormk/gui/gui.py
+-rw-rw-rw-   0        0        0     7755 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/balormk/livefulllightjob.py
+-rw-rw-rw-   0        0        0     5981 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/balormk/liveselectionlightjob.py
+-rw-rw-rw-   0        0        0     3646 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/balormk/mock_connection.py
+-rw-rw-rw-   0        0        0     4991 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/balormk/plugin.py
+-rw-rw-rw-   0        0        0    11181 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/balormk/usb_connection.py
+drwxrwxrwx   0        0        0        0 2023-04-29 16:58:21.053932 meerk40t-0.8.4000/meerk40t/camera/
+-rw-rw-rw-   0        0        0       17 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/camera/__init__.py
+-rw-rw-rw-   0        0        0    13273 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/camera/camera.py
+drwxrwxrwx   0        0        0        0 2023-04-29 16:58:21.057932 meerk40t-0.8.4000/meerk40t/camera/gui/
+-rw-rw-rw-   0        0        0        0 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/camera/gui/__init__.py
+-rw-rw-rw-   0        0        0    40400 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/camera/gui/camerapanel.py
+-rw-rw-rw-   0        0        0     2341 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/camera/gui/gui.py
+-rw-rw-rw-   0        0        0    10112 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/camera/plugin.py
+drwxrwxrwx   0        0        0        0 2023-04-29 16:58:21.063933 meerk40t-0.8.4000/meerk40t/ch341/
+-rw-rw-rw-   0        0        0      739 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/ch341/__init__.py
+-rw-rw-rw-   0        0        0    21369 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/ch341/libusb.py
+-rw-rw-rw-   0        0        0     5656 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/ch341/mock.py
+-rw-rw-rw-   0        0        0     6729 2023-04-29 16:16:31.000000 meerk40t-0.8.4000/meerk40t/ch341/windll.py
+drwxrwxrwx   0        0        0        0 2023-04-29 16:58:21.092934 meerk40t-0.8.4000/meerk40t/core/
+-rw-rw-rw-   0        0        0       15 2022-08-29 19:57:50.000000 meerk40t-0.8.4000/meerk40t/core/__init__.py
+-rw-rw-rw-   0        0        0    17576 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/core/bindalias.py
+-rw-rw-rw-   0        0        0      912 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/core/core.py
+drwxrwxrwx   0        0        0        0 2023-04-29 16:58:21.115936 meerk40t-0.8.4000/meerk40t/core/cutcode/
+-rw-rw-rw-   0        0        0        0 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/core/cutcode/__init__.py
+-rw-rw-rw-   0        0        0     2074 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/core/cutcode/cubiccut.py
+-rw-rw-rw-   0        0        0    12244 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/core/cutcode/cutcode.py
+-rw-rw-rw-   0        0        0     5392 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/core/cutcode/cutgroup.py
+-rw-rw-rw-   0        0        0     5129 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/core/cutcode/cutobject.py
+-rw-rw-rw-   0        0        0      847 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/core/cutcode/dwellcut.py
+-rw-rw-rw-   0        0        0      727 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/core/cutcode/gotocut.py
+-rw-rw-rw-   0        0        0      693 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/core/cutcode/homecut.py
+-rw-rw-rw-   0        0        0      776 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/core/cutcode/inputcut.py
+-rw-rw-rw-   0        0        0      952 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/core/cutcode/linecut.py
+-rw-rw-rw-   0        0        0      786 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/core/cutcode/outputcut.py
+-rw-rw-rw-   0        0        0    10490 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/core/cutcode/plotcut.py
+-rw-rw-rw-   0        0        0     1653 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/core/cutcode/quadcut.py
+-rw-rw-rw-   0        0        0     4168 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/core/cutcode/rastercut.py
+-rw-rw-rw-   0        0        0      892 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/core/cutcode/setorigincut.py
+-rw-rw-rw-   0        0        0      900 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/core/cutcode/waitcut.py
+-rw-rw-rw-   0        0        0    45095 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/core/cutplan.py
+-rw-rw-rw-   0        0        0    10443 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/core/drivers.py
+-rw-rw-rw-   0        0        0        0 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/core/element_commands.py
+drwxrwxrwx   0        0        0        0 2023-04-29 16:58:21.140937 meerk40t-0.8.4000/meerk40t/core/elements/
+-rw-rw-rw-   0        0        0        0 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/core/elements/__init__.py
+-rw-rw-rw-   0        0        0    24045 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/core/elements/align.py
+-rw-rw-rw-   0        0        0    50660 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/core/elements/branches.py
+-rw-rw-rw-   0        0        0     7178 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/core/elements/clipboard.py
+-rw-rw-rw-   0        0        0    96029 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/core/elements/element_treeops.py
+-rw-rw-rw-   0        0        0     2707 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/core/elements/element_types.py
+-rw-rw-rw-   0        0        0   150853 2023-04-28 21:16:53.000000 meerk40t-0.8.4000/meerk40t/core/elements/elements.py
+-rw-rw-rw-   0        0        0    19772 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/core/elements/grid.py
+-rw-rw-rw-   0        0        0     3212 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/core/elements/materials.py
+-rw-rw-rw-   0        0        0     1152 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/core/elements/notes.py
+-rw-rw-rw-   0        0        0    10838 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/core/elements/penbox.py
+-rw-rw-rw-   0        0        0     2345 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/core/elements/placements.py
+-rw-rw-rw-   0        0        0    23836 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/core/elements/render.py
+-rw-rw-rw-   0        0        0    76713 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/core/elements/shapes.py
+-rw-rw-rw-   0        0        0    16569 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/core/elements/trace.py
+-rw-rw-rw-   0        0        0    14470 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/core/elements/tree_commands.py
+-rw-rw-rw-   0        0        0     1571 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/core/elements/undo_redo.py
+-rw-rw-rw-   0        0        0     8274 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/core/elements/wordlist.py
+-rw-rw-rw-   0        0        0      269 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/core/exceptions.py
+-rw-rw-rw-   0        0        0     9609 2023-04-28 00:59:37.000000 meerk40t-0.8.4000/meerk40t/core/laserjob.py
+-rw-rw-rw-   0        0        0     2136 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/core/logging.py
+drwxrwxrwx   0        0        0        0 2023-04-29 16:58:21.320948 meerk40t-0.8.4000/meerk40t/core/node/
+-rw-rw-rw-   0        0        0        0 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/core/node/__init__.py
+-rw-rw-rw-   0        0        0     1260 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/core/node/blobnode.py
+-rw-rw-rw-   0        0        0     4147 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/core/node/bootstrap.py
+-rw-rw-rw-   0        0        0      894 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/core/node/branch_elems.py
+-rw-rw-rw-   0        0        0     1188 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/core/node/branch_ops.py
+-rw-rw-rw-   0        0        0     1236 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/core/node/branch_regmark.py
+-rw-rw-rw-   0        0        0      937 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/core/node/cutnode.py
+-rw-rw-rw-   0        0        0     6801 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/core/node/elem_ellipse.py
+-rw-rw-rw-   0        0        0     3187 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/core/node/elem_geomstr.py
+-rw-rw-rw-   0        0        0    30090 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/core/node/elem_image.py
+-rw-rw-rw-   0        0        0     6789 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/core/node/elem_line.py
+-rw-rw-rw-   0        0        0     6597 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/core/node/elem_path.py
+-rw-rw-rw-   0        0        0     2654 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/core/node/elem_point.py
+-rw-rw-rw-   0        0        0     7041 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/core/node/elem_polyline.py
+-rw-rw-rw-   0        0        0     6805 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/core/node/elem_rect.py
+-rw-rw-rw-   0        0        0    15489 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/core/node/elem_text.py
+-rw-rw-rw-   0        0        0     1088 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/core/node/filenode.py
+-rw-rw-rw-   0        0        0     2139 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/core/node/groupnode.py
+-rw-rw-rw-   0        0        0     1881 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/core/node/lasercodenode.py
+-rw-rw-rw-   0        0        0      928 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/core/node/layernode.py
+-rw-rw-rw-   0        0        0     2151 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/core/node/mixins.py
+-rw-rw-rw-   0        0        0    37261 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/core/node/node.py
+-rw-rw-rw-   0        0        0     3345 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/core/node/nutils.py
+-rw-rw-rw-   0        0        0    12290 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/core/node/op_cut.py
+-rw-rw-rw-   0        0        0    10483 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/core/node/op_dots.py
+-rw-rw-rw-   0        0        0    12341 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/core/node/op_engrave.py
+-rw-rw-rw-   0        0        0    15348 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/core/node/op_hatch.py
+-rw-rw-rw-   0        0        0    14409 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/core/node/op_image.py
+-rw-rw-rw-   0        0        0    20806 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/core/node/op_raster.py
+-rw-rw-rw-   0        0        0     1567 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/core/node/place_current.py
+-rw-rw-rw-   0        0        0     4869 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/core/node/place_point.py
+-rw-rw-rw-   0        0        0     1580 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/core/node/refnode.py
+-rw-rw-rw-   0        0        0     7504 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/core/node/rootnode.py
+-rw-rw-rw-   0        0        0     1511 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/core/node/util_console.py
+-rw-rw-rw-   0        0        0     2216 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/core/node/util_goto.py
+-rw-rw-rw-   0        0        0     1955 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/core/node/util_home.py
+-rw-rw-rw-   0        0        0     3411 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/core/node/util_input.py
+-rw-rw-rw-   0        0        0     2450 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/core/node/util_origin.py
+-rw-rw-rw-   0        0        0     3451 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/core/node/util_output.py
+-rw-rw-rw-   0        0        0     2220 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/core/node/util_wait.py
+-rw-rw-rw-   0        0        0    16353 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/core/parameters.py
+-rw-rw-rw-   0        0        0    31889 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/core/planner.py
+-rw-rw-rw-   0        0        0    22754 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/core/plotplanner.py
+-rw-rw-rw-   0        0        0     3972 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/core/space.py
+-rw-rw-rw-   0        0        0    26854 2023-04-28 00:55:54.000000 meerk40t-0.8.4000/meerk40t/core/spoolers.py
+-rw-rw-rw-   0        0        0    47807 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/core/svg_io.py
+-rw-rw-rw-   0        0        0     6158 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/core/treeop.py
+-rw-rw-rw-   0        0        0     2858 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/core/undos.py
+-rw-rw-rw-   0        0        0    31404 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/core/units.py
+-rw-rw-rw-   0        0        0     7764 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/core/view.py
+-rw-rw-rw-   0        0        0     2859 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/core/webhelp.py
+-rw-rw-rw-   0        0        0    18364 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/core/wordlist.py
+drwxrwxrwx   0        0        0        0 2023-04-29 16:58:21.323948 meerk40t-0.8.4000/meerk40t/device/
+-rw-rw-rw-   0        0        0       17 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/device/__init__.py
+-rw-rw-rw-   0        0        0     4253 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/device/basedevice.py
+drwxrwxrwx   0        0        0        0 2023-04-29 16:58:21.331948 meerk40t-0.8.4000/meerk40t/device/ch341/
+-rw-rw-rw-   0        0        0       16 2022-08-29 19:57:51.000000 meerk40t-0.8.4000/meerk40t/device/ch341/__init__.py
+-rw-rw-rw-   0        0        0     7197 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/device/ch341/ch341.py
+-rw-rw-rw-   0        0        0    16050 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/device/ch341/ch341libusbdriver.py
+-rw-rw-rw-   0        0        0     5505 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/device/ch341/libusb.py
+-rw-rw-rw-   0        0        0     5948 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/device/ch341/mock.py
+-rw-rw-rw-   0        0        0     6759 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/device/ch341/windll.py
+-rw-rw-rw-   0        0        0     4504 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/device/dummydevice.py
+drwxrwxrwx   0        0        0        0 2023-04-29 16:58:21.335948 meerk40t-0.8.4000/meerk40t/device/gui/
+-rw-rw-rw-   0        0        0        0 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/device/gui/__init__.py
+-rw-rw-rw-   0        0        0    23841 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/device/gui/defaultactions.py
+-rw-rw-rw-   0        0        0    10278 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/device/gui/formatterpanel.py
+-rw-rw-rw-   0        0        0     9284 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/device/gui/warningpanel.py
+drwxrwxrwx   0        0        0        0 2023-04-29 16:58:21.338949 meerk40t-0.8.4000/meerk40t/dxf/
+-rw-rw-rw-   0        0        0       14 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/dxf/__init__.py
+-rw-rw-rw-   0        0        0    23432 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/dxf/dxf_io.py
+-rw-rw-rw-   0        0        0     1318 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/dxf/plugin.py
+-rw-rw-rw-   0        0        0     1245 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/external_plugins.py
+-rw-rw-rw-   0        0        0      885 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/external_plugins_build.py
+drwxrwxrwx   0        0        0        0 2023-04-29 16:58:21.350949 meerk40t-0.8.4000/meerk40t/extra/
+-rw-rw-rw-   0        0        0        0 2022-08-29 19:57:51.000000 meerk40t-0.8.4000/meerk40t/extra/__init__.py
+-rw-rw-rw-   0        0        0     4516 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/extra/cag.py
+-rw-rw-rw-   0        0        0     2027 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/extra/embroider.py
+-rw-rw-rw-   0        0        0    34670 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/extra/ezd.py
+-rw-rw-rw-   0        0        0    12009 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/extra/hershey.py
+-rw-rw-rw-   0        0        0    13066 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/extra/imageactions.py
+-rw-rw-rw-   0        0        0    23369 2023-04-29 16:17:37.000000 meerk40t-0.8.4000/meerk40t/extra/inkscape.py
+-rw-rw-rw-   0        0        0     8348 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/extra/pathoptimize.py
+-rw-rw-rw-   0        0        0     9470 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/extra/potrace.py
+-rw-rw-rw-   0        0        0    12356 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/extra/updater.py
+-rw-rw-rw-   0        0        0     5120 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/extra/vectrace.py
+-rw-rw-rw-   0        0        0     2769 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/extra/winsleep.py
+drwxrwxrwx   0        0        0        0 2023-04-29 16:58:21.355950 meerk40t-0.8.4000/meerk40t/fill/
+-rw-rw-rw-   0        0        0        0 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/fill/__init__.py
+-rw-rw-rw-   0        0        0    10357 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/fill/fills.py
+-rw-rw-rw-   0        0        0    38279 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/fill/patternfill.py
+-rw-rw-rw-   0        0        0    16519 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/fill/patterns.py
+drwxrwxrwx   0        0        0        0 2023-04-29 16:58:21.369950 meerk40t-0.8.4000/meerk40t/grbl/
+-rw-rw-rw-   0        0        0        0 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/grbl/__init__.py
+-rw-rw-rw-   0        0        0     2702 2023-04-28 11:51:37.000000 meerk40t-0.8.4000/meerk40t/grbl/control.py
+-rw-rw-rw-   0        0        0    20171 2023-04-29 16:01:17.000000 meerk40t-0.8.4000/meerk40t/grbl/controller.py
+-rw-rw-rw-   0        0        0    26740 2023-04-29 16:16:03.000000 meerk40t-0.8.4000/meerk40t/grbl/device.py
+-rw-rw-rw-   0        0        0    23277 2023-04-29 11:35:09.000000 meerk40t-0.8.4000/meerk40t/grbl/driver.py
+-rw-rw-rw-   0        0        0    18743 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/grbl/emulator.py
+-rw-rw-rw-   0        0        0    28028 2023-04-29 15:50:24.000000 meerk40t-0.8.4000/meerk40t/grbl/gcodejob.py
+drwxrwxrwx   0        0        0        0 2023-04-29 16:58:21.374951 meerk40t-0.8.4000/meerk40t/grbl/gui/
+-rw-rw-rw-   0        0        0        0 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/grbl/gui/__init__.py
+-rw-rw-rw-   0        0        0    11187 2023-04-29 16:16:03.000000 meerk40t-0.8.4000/meerk40t/grbl/gui/grblconfiguration.py
+-rw-rw-rw-   0        0        0     8667 2023-04-29 08:41:23.000000 meerk40t-0.8.4000/meerk40t/grbl/gui/grblserialcontroller.py
+-rw-rw-rw-   0        0        0     4875 2023-04-28 11:51:37.000000 meerk40t-0.8.4000/meerk40t/grbl/gui/gui.py
+-rw-rw-rw-   0        0        0     7416 2023-04-28 11:51:37.000000 meerk40t-0.8.4000/meerk40t/grbl/gui/tcpcontroller.py
+-rw-rw-rw-   0        0        0     1712 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/grbl/interpreter.py
+-rw-rw-rw-   0        0        0      617 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/grbl/loader.py
+-rw-rw-rw-   0        0        0     1611 2023-04-29 16:16:02.000000 meerk40t-0.8.4000/meerk40t/grbl/mock_connection.py
+-rw-rw-rw-   0        0        0     7332 2023-04-29 16:16:03.000000 meerk40t-0.8.4000/meerk40t/grbl/plugin.py
+-rw-rw-rw-   0        0        0     2667 2023-04-28 04:30:24.000000 meerk40t-0.8.4000/meerk40t/grbl/serial_connection.py
+-rw-rw-rw-   0        0        0     2564 2023-04-29 15:25:12.000000 meerk40t-0.8.4000/meerk40t/grbl/tcp_connection.py
+drwxrwxrwx   0        0        0        0 2023-04-29 16:58:21.423954 meerk40t-0.8.4000/meerk40t/gui/
+-rw-rw-rw-   0        0        0       14 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/__init__.py
+-rw-rw-rw-   0        0        0    11627 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/gui/about.py
+-rw-rw-rw-   0        0        0    64696 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/gui/alignment.py
+-rw-rw-rw-   0        0        0     2314 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/bufferview.py
+-rw-rw-rw-   0        0        0     4030 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/gui/busy.py
+-rw-rw-rw-   0        0        0    62799 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/choicepropertypanel.py
+-rw-rw-rw-   0        0        0    18111 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/consolepanel.py
+-rw-rw-rw-   0        0        0    20551 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/gui/devicepanel.py
+-rw-rw-rw-   0        0        0     3866 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/dialogoptions.py
+-rw-rw-rw-   0        0        0    12237 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/gui/executejob.py
+-rw-rw-rw-   0        0        0     2800 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/fonts.py
+drwxrwxrwx   0        0        0        0 2023-04-29 16:58:21.425954 meerk40t-0.8.4000/meerk40t/gui/help_assets/
+-rw-rw-rw-   0        0        0        0 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/help_assets/__init__.py
+-rw-rw-rw-   0        0        0     9381 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/help_assets/help_assets.py
+-rw-rw-rw-   0        0        0    31290 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/gui/hersheymanager.py
+-rw-rw-rw-   0        0        0   246387 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/gui/icons.py
+-rw-rw-rw-   0        0        0    19129 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/imagesplitter.py
+-rw-rw-rw-   0        0        0    11758 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/keymap.py
+-rw-rw-rw-   0        0        0    26941 2023-04-29 03:13:21.000000 meerk40t-0.8.4000/meerk40t/gui/laserpanel.py
+-rw-rw-rw-   0        0        0    44687 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/gui/laserrender.py
+-rw-rw-rw-   0        0        0    30777 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/lasertoolpanel.py
+-rw-rw-rw-   0        0        0    56121 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/materialtest.py
+-rw-rw-rw-   0        0        0     3623 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/mkdebug.py
+-rw-rw-rw-   0        0        0     4640 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/mwindow.py
+-rw-rw-rw-   0        0        0    82407 2023-04-29 03:12:10.000000 meerk40t-0.8.4000/meerk40t/gui/navigationpanels.py
+-rw-rw-rw-   0        0        0     4715 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/notes.py
+-rw-rw-rw-   0        0        0    14969 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/gui/opassignment.py
+-rw-rw-rw-   0        0        0    10919 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/operation_info.py
+-rw-rw-rw-   0        0        0    11672 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/gui/plugin.py
+-rw-rw-rw-   0        0        0    21548 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/gui/position.py
+-rw-rw-rw-   0        0        0    21855 2023-04-29 16:16:07.000000 meerk40t-0.8.4000/meerk40t/gui/preferences.py
+drwxrwxrwx   0        0        0        0 2023-04-29 16:58:21.446955 meerk40t-0.8.4000/meerk40t/gui/propertypanels/
+-rw-rw-rw-   0        0        0        0 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/propertypanels/__init__.py
+-rw-rw-rw-   0        0        0    38837 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/gui/propertypanels/attributes.py
+-rw-rw-rw-   0        0        0     5561 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/propertypanels/blobproperty.py
+-rw-rw-rw-   0        0        0     2837 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/propertypanels/consoleproperty.py
+-rw-rw-rw-   0        0        0     7360 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/propertypanels/groupproperties.py
+-rw-rw-rw-   0        0        0    53880 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/gui/propertypanels/imageproperty.py
+-rw-rw-rw-   0        0        0     1781 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/propertypanels/inputproperty.py
+-rw-rw-rw-   0        0        0     2612 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/propertypanels/opbranchproperties.py
+-rw-rw-rw-   0        0        0    69312 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/gui/propertypanels/operationpropertymain.py
+-rw-rw-rw-   0        0        0     1789 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/propertypanels/outputproperty.py
+-rw-rw-rw-   0        0        0    13370 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/propertypanels/pathproperty.py
+-rw-rw-rw-   0        0        0    13701 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/gui/propertypanels/placementproperty.py
+-rw-rw-rw-   0        0        0     4398 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/propertypanels/pointproperty.py
+-rw-rw-rw-   0        0        0     5748 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/propertypanels/propertywindow.py
+-rw-rw-rw-   0        0        0    36709 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/propertypanels/rasterwizardpanels.py
+-rw-rw-rw-   0        0        0    27959 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/gui/propertypanels/textproperty.py
+-rw-rw-rw-   0        0        0     1771 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/propertypanels/waitproperty.py
+drwxrwxrwx   0        0        0        0 2023-04-29 16:58:21.454955 meerk40t-0.8.4000/meerk40t/gui/scene/
+-rw-rw-rw-   0        0        0        0 2022-08-29 19:57:51.000000 meerk40t-0.8.4000/meerk40t/gui/scene/__init__.py
+-rw-rw-rw-   0        0        0     5180 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/scene/guicolors.py
+-rw-rw-rw-   0        0        0    33615 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/gui/scene/scene.py
+-rw-rw-rw-   0        0        0      648 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/scene/sceneconst.py
+-rw-rw-rw-   0        0        0    11695 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/scene/scenepanel.py
+-rw-rw-rw-   0        0        0    13224 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/scene/scenespacewidget.py
+-rw-rw-rw-   0        0        0    15826 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/scene/widget.py
+drwxrwxrwx   0        0        0        0 2023-04-29 16:58:21.468956 meerk40t-0.8.4000/meerk40t/gui/scenewidgets/
+-rw-rw-rw-   0        0        0        0 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/scenewidgets/__init__.py
+-rw-rw-rw-   0        0        0    16441 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/gui/scenewidgets/attractionwidget.py
+-rw-rw-rw-   0        0        0     3033 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/scenewidgets/bedwidget.py
+-rw-rw-rw-   0        0        0     3431 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/gui/scenewidgets/elementswidget.py
+-rw-rw-rw-   0        0        0    28244 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/gui/scenewidgets/gridwidget.py
+-rw-rw-rw-   0        0        0    29128 2023-04-29 16:16:10.000000 meerk40t-0.8.4000/meerk40t/gui/scenewidgets/guidewidget.py
+-rw-rw-rw-   0        0        0     1876 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/scenewidgets/laserpathwidget.py
+-rw-rw-rw-   0        0        0     2340 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/gui/scenewidgets/machineoriginwidget.py
+-rw-rw-rw-   0        0        0    12777 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/gui/scenewidgets/rectselectwidget.py
+-rw-rw-rw-   0        0        0     1196 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/scenewidgets/relocatewidget.py
+-rw-rw-rw-   0        0        0     2403 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/scenewidgets/reticlewidget.py
+-rw-rw-rw-   0        0        0   103410 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/gui/scenewidgets/selectionwidget.py
+-rw-rw-rw-   0        0        0    90417 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/gui/simulation.py
+-rw-rw-rw-   0        0        0     8323 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/gui/snapoptions.py
+-rw-rw-rw-   0        0        0    39076 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/gui/spoolerpanel.py
+drwxrwxrwx   0        0        0        0 2023-04-29 16:58:21.480957 meerk40t-0.8.4000/meerk40t/gui/statusbarwidgets/
+-rw-rw-rw-   0        0        0        0 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/statusbarwidgets/__init__.py
+-rw-rw-rw-   0        0        0    17561 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/gui/statusbarwidgets/infowidget.py
+-rw-rw-rw-   0        0        0    13740 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/gui/statusbarwidgets/opassignwidget.py
+-rw-rw-rw-   0        0        0     3844 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/statusbarwidgets/selectionwidget.py
+-rw-rw-rw-   0        0        0     8335 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/statusbarwidgets/shapepropwidget.py
+-rw-rw-rw-   0        0        0     9756 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/statusbarwidgets/statusbar.py
+-rw-rw-rw-   0        0        0     9050 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/statusbarwidgets/statusbarwidget.py
+-rw-rw-rw-   0        0        0     9357 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/gui/statusbarwidgets/strokewidget.py
+drwxrwxrwx   0        0        0        0 2023-04-29 16:58:21.503958 meerk40t-0.8.4000/meerk40t/gui/toolwidgets/
+-rw-rw-rw-   0        0        0        0 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/toolwidgets/__init__.py
+-rw-rw-rw-   0        0        0      983 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/toolwidgets/circlebrush.py
+-rw-rw-rw-   0        0        0     8750 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/toolwidgets/toolcircle.py
+-rw-rw-rw-   0        0        0     1476 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/toolwidgets/toolcontainer.py
+-rw-rw-rw-   0        0        0     3313 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/toolwidgets/tooldraw.py
+-rw-rw-rw-   0        0        0     8603 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/toolwidgets/toolellipse.py
+-rw-rw-rw-   0        0        0     9358 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/gui/toolwidgets/toollinetext.py
+-rw-rw-rw-   0        0        0     7613 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/toolwidgets/toolmeasure.py
+-rw-rw-rw-   0        0        0    94489 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/gui/toolwidgets/toolnodeedit.py
+-rw-rw-rw-   0        0        0     3425 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/gui/toolwidgets/toolplacement.py
+-rw-rw-rw-   0        0        0     1791 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/toolwidgets/toolpoint.py
+-rw-rw-rw-   0        0        0     7078 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/gui/toolwidgets/toolpolygon.py
+-rw-rw-rw-   0        0        0     7173 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/gui/toolwidgets/toolpolyline.py
+-rw-rw-rw-   0        0        0     8146 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/toolwidgets/toolrect.py
+-rw-rw-rw-   0        0        0     2229 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/toolwidgets/toolrelocate.py
+-rw-rw-rw-   0        0        0     4234 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/toolwidgets/toolribbon.py
+-rw-rw-rw-   0        0        0     3061 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/toolwidgets/tooltext.py
+-rw-rw-rw-   0        0        0     7516 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/gui/toolwidgets/toolvector.py
+-rw-rw-rw-   0        0        0     1194 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/toolwidgets/toolwidget.py
+-rw-rw-rw-   0        0        0     2844 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/usbconnect.py
+drwxrwxrwx   0        0        0        0 2023-04-29 16:58:21.524959 meerk40t-0.8.4000/meerk40t/gui/utilitywidgets/
+-rw-rw-rw-   0        0        0        0 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/utilitywidgets/__init__.py
+-rw-rw-rw-   0        0        0      737 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/utilitywidgets/buttonwidget.py
+-rw-rw-rw-   0        0        0     2812 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/utilitywidgets/checkboxwidget.py
+-rw-rw-rw-   0        0        0    11773 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/utilitywidgets/cyclocycloidwidget.py
+-rw-rw-rw-   0        0        0      926 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/utilitywidgets/handlewidget.py
+-rw-rw-rw-   0        0        0    13518 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/utilitywidgets/harmonograph.py
+-rw-rw-rw-   0        0        0     1073 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/utilitywidgets/openclosewidget.py
+-rw-rw-rw-   0        0        0     1914 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/utilitywidgets/rotationwidget.py
+-rw-rw-rw-   0        0        0     2776 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/utilitywidgets/scalewidget.py
+-rw-rw-rw-   0        0        0     5697 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/utilitywidgets/seekbarwidget.py
+-rw-rw-rw-   0        0        0     5167 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/utilitywidgets/togglewidget.py
+-rw-rw-rw-   0        0        0      344 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/utilitywidgets/toolbarwidget.py
+-rw-rw-rw-   0        0        0    35380 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/wordlisteditor.py
+-rw-rw-rw-   0        0        0    37751 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/gui/wxmeerk40t.py
+-rw-rw-rw-   0        0        0   140652 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/gui/wxmmain.py
+-rw-rw-rw-   0        0        0    54351 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/gui/wxmribbon.py
+-rw-rw-rw-   0        0        0    53471 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/gui/wxmscene.py
+-rw-rw-rw-   0        0        0    70530 2023-04-29 03:13:21.000000 meerk40t-0.8.4000/meerk40t/gui/wxmtree.py
+-rw-rw-rw-   0        0        0    32739 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/wxutils.py
+-rw-rw-rw-   0        0        0     2807 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/gui/zmatrix.py
+drwxrwxrwx   0        0        0        0 2023-04-29 16:58:21.526960 meerk40t-0.8.4000/meerk40t/image/
+-rw-rw-rw-   0        0        0       16 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/image/__init__.py
+-rw-rw-rw-   0        0        0    65324 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/image/imagetools.py
+-rw-rw-rw-   0        0        0     3073 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/internal_plugins.py
+drwxrwxrwx   0        0        0        0 2023-04-29 16:58:21.543960 meerk40t-0.8.4000/meerk40t/kernel/
+-rw-rw-rw-   0        0        0      321 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/kernel/__init__.py
+-rw-rw-rw-   0        0        0     6819 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/kernel/channel.py
+-rw-rw-rw-   0        0        0    18178 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/kernel/context.py
+-rw-rw-rw-   0        0        0     1187 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/kernel/exceptions.py
+-rw-rw-rw-   0        0        0    14995 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/kernel/functions.py
+-rw-rw-rw-   0        0        0     2815 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/kernel/jobs.py
+-rw-rw-rw-   0        0        0   132402 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/kernel/kernel.py
+-rw-rw-rw-   0        0        0     2263 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/kernel/lifecycles.py
+-rw-rw-rw-   0        0        0     1941 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/kernel/module.py
+-rw-rw-rw-   0        0        0     5212 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/kernel/service.py
+-rw-rw-rw-   0        0        0    11606 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/kernel/settings.py
+-rw-rw-rw-   0        0        0        0 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/kernel/states.py
+drwxrwxrwx   0        0        0        0 2023-04-29 16:58:21.559961 meerk40t-0.8.4000/meerk40t/lihuiyu/
+-rw-rw-rw-   0        0        0        0 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/lihuiyu/__init__.py
+-rw-rw-rw-   0        0        0    31573 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/lihuiyu/controller.py
+-rw-rw-rw-   0        0        0    39931 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/lihuiyu/device.py
+-rw-rw-rw-   0        0        0    46862 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/lihuiyu/driver.py
+drwxrwxrwx   0        0        0        0 2023-04-29 16:58:21.568962 meerk40t-0.8.4000/meerk40t/lihuiyu/gui/
+-rw-rw-rw-   0        0        0        0 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/lihuiyu/gui/__init__.py
+-rw-rw-rw-   0        0        0     4089 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/lihuiyu/gui/gui.py
+-rw-rw-rw-   0        0        0    16374 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/lihuiyu/gui/lhyaccelgui.py
+-rw-rw-rw-   0        0        0    24575 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/lihuiyu/gui/lhycontrollergui.py
+-rw-rw-rw-   0        0        0    17367 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/lihuiyu/gui/lhydrivergui.py
+-rw-rw-rw-   0        0        0     9731 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/lihuiyu/gui/lhyoperationproperties.py
+-rw-rw-rw-   0        0        0     7407 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/lihuiyu/gui/tcpcontroller.py
+-rw-rw-rw-   0        0        0     1692 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/lihuiyu/interpreter.py
+-rw-rw-rw-   0        0        0    16341 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/lihuiyu/laserspeed.py
+-rw-rw-rw-   0        0        0     2622 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/lihuiyu/loader.py
+-rw-rw-rw-   0        0        0    13937 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/lihuiyu/parser.py
+-rw-rw-rw-   0        0        0     3815 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/lihuiyu/plugin.py
+-rw-rw-rw-   0        0        0     3474 2023-04-28 11:51:37.000000 meerk40t-0.8.4000/meerk40t/lihuiyu/tcp_connection.py
+-rw-rw-rw-   0        0        0     4043 2023-04-28 03:38:02.000000 meerk40t-0.8.4000/meerk40t/main.py
+drwxrwxrwx   0        0        0        0 2023-04-29 16:58:21.578962 meerk40t-0.8.4000/meerk40t/moshi/
+-rw-rw-rw-   0        0        0        0 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/moshi/__init__.py
+-rw-rw-rw-   0        0        0    13904 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/moshi/builder.py
+-rw-rw-rw-   0        0        0    17471 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/moshi/controller.py
+-rw-rw-rw-   0        0        0    15227 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/moshi/device.py
+-rw-rw-rw-   0        0        0    23830 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/moshi/driver.py
+drwxrwxrwx   0        0        0        0 2023-04-29 16:58:21.583963 meerk40t-0.8.4000/meerk40t/moshi/gui/
+-rw-rw-rw-   0        0        0        0 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/moshi/gui/__init__.py
+-rw-rw-rw-   0        0        0     2566 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/moshi/gui/gui.py
+-rw-rw-rw-   0        0        0    21985 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/moshi/gui/moshicontrollergui.py
+-rw-rw-rw-   0        0        0     3661 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/moshi/gui/moshidrivergui.py
+-rw-rw-rw-   0        0        0     1462 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/moshi/plugin.py
+drwxrwxrwx   0        0        0        0 2023-04-29 16:58:21.590963 meerk40t-0.8.4000/meerk40t/network/
+-rw-rw-rw-   0        0        0        0 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/network/__init__.py
+-rw-rw-rw-   0        0        0     2111 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/network/console_server.py
+-rw-rw-rw-   0        0        0      326 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/network/kernelserver.py
+-rw-rw-rw-   0        0        0     4958 2023-04-28 11:51:37.000000 meerk40t-0.8.4000/meerk40t/network/tcp_server.py
+-rw-rw-rw-   0        0        0     2680 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/network/udp_server.py
+drwxrwxrwx   0        0        0        0 2023-04-29 16:58:21.603964 meerk40t-0.8.4000/meerk40t/newly/
+-rw-rw-rw-   0        0        0        0 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/newly/__init__.py
+-rw-rw-rw-   0        0        0    35613 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/newly/controller.py
+-rw-rw-rw-   0        0        0    25047 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/newly/device.py
+-rw-rw-rw-   0        0        0    12517 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/newly/driver.py
+drwxrwxrwx   0        0        0        0 2023-04-29 16:58:21.611964 meerk40t-0.8.4000/meerk40t/newly/gui/
+-rw-rw-rw-   0        0        0        0 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/newly/gui/__init__.py
+-rw-rw-rw-   0        0        0     7263 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/newly/gui/gui.py
+-rw-rw-rw-   0        0        0     3586 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/newly/gui/newlyconfig.py
+-rw-rw-rw-   0        0        0     6105 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/newly/gui/newlycontroller.py
+-rw-rw-rw-   0        0        0     1504 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/newly/gui/operationproperties.py
+-rw-rw-rw-   0        0        0     2646 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/newly/mock_connection.py
+-rw-rw-rw-   0        0        0     1642 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/newly/newly_params.py
+-rw-rw-rw-   0        0        0    44191 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/newly/plugin.py
+-rw-rw-rw-   0        0        0    12062 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/newly/usb_connection.py
+drwxrwxrwx   0        0        0        0 2023-04-29 16:58:21.614964 meerk40t-0.8.4000/meerk40t/rotary/
+-rw-rw-rw-   0        0        0        0 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/rotary/__init__.py
+drwxrwxrwx   0        0        0        0 2023-04-29 16:58:21.618965 meerk40t-0.8.4000/meerk40t/rotary/gui/
+-rw-rw-rw-   0        0        0        0 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/rotary/gui/__init__.py
+-rw-rw-rw-   0        0        0     1645 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/rotary/gui/gui.py
+-rw-rw-rw-   0        0        0     9599 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/rotary/gui/rotarysettings.py
+-rw-rw-rw-   0        0        0     3187 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/rotary/rotary.py
+drwxrwxrwx   0        0        0        0 2023-04-29 16:58:21.637966 meerk40t-0.8.4000/meerk40t/ruida/
+-rw-rw-rw-   0        0        0        0 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/ruida/__init__.py
+-rw-rw-rw-   0        0        0     3256 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/ruida/control.py
+-rw-rw-rw-   0        0        0    31762 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/ruida/controller.py
+-rw-rw-rw-   0        0        0     6587 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/ruida/device.py
+-rw-rw-rw-   0        0        0    15377 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/ruida/driver.py
+-rw-rw-rw-   0        0        0    53016 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/ruida/emulator.py
+-rw-rw-rw-   0        0        0      120 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/ruida/exceptions.py
+drwxrwxrwx   0        0        0        0 2023-04-29 16:58:21.645966 meerk40t-0.8.4000/meerk40t/ruida/gui/
+-rw-rw-rw-   0        0        0        0 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/ruida/gui/__init__.py
+-rw-rw-rw-   0        0        0     2840 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/ruida/gui/gui.py
+-rw-rw-rw-   0        0        0     2505 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/ruida/gui/ruidaconfig.py
+-rw-rw-rw-   0        0        0     5987 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/ruida/gui/ruidacontroller.py
+-rw-rw-rw-   0        0        0     1274 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/ruida/gui/ruidaoperationproperties.py
+-rw-rw-rw-   0        0        0      657 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/ruida/loader.py
+-rw-rw-rw-   0        0        0     3654 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/ruida/mock_connection.py
+-rw-rw-rw-   0        0        0     3157 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/ruida/plugin.py
+-rw-rw-rw-   0        0        0    45282 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/ruida/rdjob.py
+-rw-rw-rw-   0        0        0   341032 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/svgelements.py
+drwxrwxrwx   0        0        0        0 2023-04-29 16:58:21.664967 meerk40t-0.8.4000/meerk40t/tools/
+-rw-rw-rw-   0        0        0        0 2022-08-29 19:57:51.000000 meerk40t-0.8.4000/meerk40t/tools/__init__.py
+-rw-rw-rw-   0        0        0    21412 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/tools/driver_to_path.py
+-rw-rw-rw-   0        0        0    94058 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/tools/geomstr.py
+-rw-rw-rw-   0        0        0    12007 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/tools/jhfparser.py
+-rw-rw-rw-   0        0        0    42419 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/tools/livinghinges.py
+-rw-rw-rw-   0        0        0    31362 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/tools/pathtools.py
+-rw-rw-rw-   0        0        0    35800 2022-08-29 19:57:51.000000 meerk40t-0.8.4000/meerk40t/tools/pointfinder.py
+-rw-rw-rw-   0        0        0    28108 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/meerk40t/tools/polybool.py
+-rw-rw-rw-   0        0        0    20221 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/tools/rasterplotter.py
+-rw-rw-rw-   0        0        0    30973 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/tools/shxparser.py
+-rw-rw-rw-   0        0        0    16287 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/tools/ttfparser.py
+-rw-rw-rw-   0        0        0    20709 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/meerk40t/tools/zinglplotter.py
+drwxrwxrwx   0        0        0        0 2023-04-29 16:58:21.713970 meerk40t-0.8.4000/meerk40t.egg-info/
+-rw-rw-rw-   0        0        0     5619 2023-04-29 16:58:20.000000 meerk40t-0.8.4000/meerk40t.egg-info/PKG-INFO
+-rw-rw-rw-   0        0        0    26958 2023-04-29 16:58:20.000000 meerk40t-0.8.4000/meerk40t.egg-info/SOURCES.txt
+-rw-rw-rw-   0        0        0        1 2023-04-29 16:58:20.000000 meerk40t-0.8.4000/meerk40t.egg-info/dependency_links.txt
+-rw-rw-rw-   0        0        0       48 2023-04-29 16:58:20.000000 meerk40t-0.8.4000/meerk40t.egg-info/entry_points.txt
+-rw-rw-rw-   0        0        0      284 2023-04-29 16:58:20.000000 meerk40t-0.8.4000/meerk40t.egg-info/requires.txt
+-rw-rw-rw-   0        0        0       14 2023-04-29 16:58:20.000000 meerk40t-0.8.4000/meerk40t.egg-info/top_level.txt
+-rw-rw-rw-   0        0        0        2 2021-01-18 14:07:22.000000 meerk40t-0.8.4000/meerk40t.egg-info/zip-safe
+-rw-rw-rw-   0        0        0    20222 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/pyproject.toml
+-rw-rw-rw-   0        0        0     1128 2023-04-29 16:58:21.825976 meerk40t-0.8.4000/setup.cfg
+-rw-rw-rw-   0        0        0      581 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/setup.py
+drwxrwxrwx   0        0        0        0 2023-04-29 16:58:21.702969 meerk40t-0.8.4000/test/
+-rw-rw-rw-   0        0        0        0 2022-08-29 19:57:51.000000 meerk40t-0.8.4000/test/__init__.py
+-rw-rw-rw-   0        0        0     1493 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/test/bootstrap.py
+-rw-rw-rw-   0        0        0      232 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/test/test_cli.py
+-rw-rw-rw-   0        0        0    17155 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/test/test_core_cutcode.py
+-rw-rw-rw-   0        0        0     4323 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/test/test_core_elements.py
+-rw-rw-rw-   0        0        0    14608 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/test/test_core_plotplanner.py
+-rw-rw-rw-   0        0        0    13401 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/test/test_core_viewports.py
+-rw-rw-rw-   0        0        0     2393 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/test/test_drivers_grbl.py
+-rw-rw-rw-   0        0        0    16583 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/test/test_drivers_lihuiyu.py
+-rw-rw-rw-   0        0        0     2343 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/test/test_element_degenerate_points.py
+-rw-rw-rw-   0        0        0     3341 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/test/test_elements_classify.py
+-rw-rw-rw-   0        0        0      632 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/test/test_elements_penbox.py
+-rw-rw-rw-   0        0        0     5392 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/test/test_fill.py
+-rw-rw-rw-   0        0        0    32554 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/test/test_geomstr.py
+-rw-rw-rw-   0        0        0    12913 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/test/test_imagetools_actualize.py
+-rw-rw-rw-   0        0        0    11767 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/test/test_imagetools_wizard.py
+-rw-rw-rw-   0        0        0     4701 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/test/test_kernel.py
+-rw-rw-rw-   0        0        0   107060 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/test/test_laser_speeds.py
+-rw-rw-rw-   0        0        0     2138 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/test/test_length.py
+-rw-rw-rw-   0        0        0     2281 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/test/test_lifecycle.py
+-rw-rw-rw-   0        0        0     1119 2023-04-27 21:34:28.000000 meerk40t-0.8.4000/test/test_operations_hatch.py
+-rw-rw-rw-   0        0        0      591 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/test/test_spooler.py
+-rw-rw-rw-   0        0        0     4624 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/test/test_wobble.py
+-rw-rw-rw-   0        0        0     4190 2023-04-26 18:27:24.000000 meerk40t-0.8.4000/test/test_zingl.py
```

### Comparing `meerk40t-0.8.3000/LICENSE` & `meerk40t-0.8.4000/LICENSE`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/PKG-INFO` & `meerk40t-0.8.4000/PKG-INFO`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: meerk40t
-Version: 0.8.3000
+Version: 0.8.4000
 Summary: MeerK40t LaserCutter Software
 Home-page: https://github.com/meerk40t/meerk40t
 Author: Tatarize
 Author-email: tatarize@gmail.com
 License: MIT
 Description: # MeerK40t
         MeerK40t (pronounced MeerKat) is a built-from-the-ground-up MIT licensed open-source laser cutting software.
```

### Comparing `meerk40t-0.8.3000/README.md` & `meerk40t-0.8.4000/README.md`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/balormk/balor_params.py` & `meerk40t-0.8.4000/meerk40t/balormk/balor_params.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/balormk/controller.py` & `meerk40t-0.8.4000/meerk40t/balormk/controller.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/balormk/device.py` & `meerk40t-0.8.4000/meerk40t/balormk/device.py`

 * *Files 1% similar despite different names*

```diff
@@ -745,16 +745,14 @@
             self,
             self.lens_size,
             self.lens_size,
             native_scale_x=units_per_galvo,
             native_scale_y=units_per_galvo,
             origin_x=1.0 if self.flip_x else 0.0,
             origin_y=1.0 if self.flip_y else 0.0,
-            show_origin_x=0.5,
-            show_origin_y=0.5,
             flip_x=self.flip_x,
             flip_y=self.flip_y,
             swap_xy=self.swap_xy,
         )
         self.spooler = Spooler(self)
         self.driver = BalorDriver(self)
         self.spooler.driver = self.driver
@@ -1802,21 +1800,25 @@
             "viewport_update",
             hidden=True,
             help=_("Update galvo flips for movement"),
         )
         def codes_update(**kwargs):
             self.realize()
 
+    def service_attach(self, *args, **kwargs):
+        self.realize()
+
     @signal_listener("flip_x")
     @signal_listener("flip_y")
     @signal_listener("swap_xy")
     def realize(self, origin=None, *args):
         self.width = self.lens_size
         self.height = self.lens_size
         super().realize()
+        self.space.update_bounds(0, 0, self.width, self.height)
 
     @property
     def current(self):
         """
         @return: the location in nm for the current known x value.
         """
         return self.device_to_scene_position(
```

### Comparing `meerk40t-0.8.3000/meerk40t/balormk/driver.py` & `meerk40t-0.8.4000/meerk40t/balormk/driver.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/balormk/elementlightjob.py` & `meerk40t-0.8.4000/meerk40t/balormk/elementlightjob.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/balormk/gui/balorconfig.py` & `meerk40t-0.8.4000/meerk40t/balormk/gui/balorconfig.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/balormk/gui/balorcontroller.py` & `meerk40t-0.8.4000/meerk40t/balormk/gui/balorcontroller.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/balormk/gui/baloroperationproperties.py` & `meerk40t-0.8.4000/meerk40t/balormk/gui/baloroperationproperties.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/balormk/gui/gui.py` & `meerk40t-0.8.4000/meerk40t/balormk/gui/gui.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/balormk/livefulllightjob.py` & `meerk40t-0.8.4000/meerk40t/balormk/livefulllightjob.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/balormk/liveselectionlightjob.py` & `meerk40t-0.8.4000/meerk40t/balormk/liveselectionlightjob.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/balormk/mock_connection.py` & `meerk40t-0.8.4000/meerk40t/balormk/mock_connection.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/balormk/plugin.py` & `meerk40t-0.8.4000/meerk40t/balormk/plugin.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/balormk/usb_connection.py` & `meerk40t-0.8.4000/meerk40t/balormk/usb_connection.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/camera/camera.py` & `meerk40t-0.8.4000/meerk40t/camera/camera.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/camera/gui/camerapanel.py` & `meerk40t-0.8.4000/meerk40t/camera/gui/camerapanel.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/camera/gui/gui.py` & `meerk40t-0.8.4000/meerk40t/camera/gui/gui.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/camera/plugin.py` & `meerk40t-0.8.4000/meerk40t/camera/plugin.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/ch341/__init__.py` & `meerk40t-0.8.4000/meerk40t/ch341/__init__.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/ch341/libusb.py` & `meerk40t-0.8.4000/meerk40t/ch341/libusb.py`

 * *Files 2% similar despite different names*

```diff
@@ -56,15 +56,16 @@
     """
 
     def __init__(self, channel):
         self.devices = {}
         self.interface = {}
         self.channel = channel
         self.backend_error_code = None
-        self.timeout = 500
+        self.timeout = 1500
+        self.bulk = True
 
     def find_device(self, index=0):
         _ = self.channel._
         self.channel("\n")
         self.channel(_("Finding devices."))
         try:
             devices = list(
@@ -341,14 +342,21 @@
             self.backend_error_code = e.backend_error_code
 
             self.channel(str(e))
             raise ConnectionError
 
     # pylint: disable=dangerous-default-value
     def CH341GetStatus(self, index=0, status=[0]):
+        if self.bulk:
+            return self.CH341GetStatusBulk(index=index, status=status)
+        else:
+            return self.CH341GetStatusControlTransfer(index=index, status=status)
+
+    # pylint: disable=dangerous-default-value
+    def CH341GetStatusControlTransfer(self, index=0, status=[0]):
         """D7-0, 8: err, 9: pEmp, 10: Int, 11: SLCT, 12: SDA, 13: Busy, 14: data, 15: addrs"""
         device = self.devices[index]
         try:
             buffer = device.ctrl_transfer(
                 bmRequestType=mCH341_VENDOR_READ,
                 bRequest=mCH341A_STATUS,
                 wValue=0,
```

### Comparing `meerk40t-0.8.3000/meerk40t/ch341/mock.py` & `meerk40t-0.8.4000/meerk40t/ch341/mock.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,22 +1,23 @@
 # MIT License.
-
+import random
 import time
 
 
 class MockCH341Driver:
     """
     This is basic interface code for a mock CH341.
     """
 
     def __init__(self, channel=None, state=None):
         self.driver_index = None
         self.driver_value = None
         self.channel = channel
         self.state = state
+        self.bulk = True
 
         self.mock_status = 206
         self.mock_error = 207
         self.mock_finish = 236
 
         self._start_time_status = None
         self._end_time_status = None
@@ -95,14 +96,17 @@
         """
         if not self.is_connected():
             raise ConnectionError
         if packet.startswith(b"\x00A"):
             self._start_time_status = time.time()
             self._end_time_status = self._start_time_status + 0.5
             self._time_status = 204
+        if random.randint(0, 5000) == 0:
+            # Write failed.
+            raise ConnectionError
         time.sleep(0.04)
         # Mock
 
     def write_addr(self, packet):
         """
         Writes an address byte packet to the device. This is typically 1 byte
         The driver will packetize the \0xA7 writes.
```

### Comparing `meerk40t-0.8.3000/meerk40t/ch341/windll.py` & `meerk40t-0.8.4000/meerk40t/ch341/windll.py`

 * *Files 10% similar despite different names*

```diff
@@ -1,22 +1,25 @@
 from ctypes import c_byte, windll
 
+from meerk40t.ch341.libusb import mCH341_PARA_CMD_STS
+
 # MIT License.
 
 
 class WinCH341Driver:
     """
     This is basic interface code for a CH341 to be run in EPP 1.9 mode.
     """
 
     def __init__(self, channel=None, state=None):
         self.driver_index = None
         self.driver_value = None
         self.channel = channel
         self.state = state
+        self.bulk = True
 
         try:
             self.driver = windll.LoadLibrary("CH341DLL.dll")
         except FileNotFoundError as e:
             self.channel(f"{str(type(e))}: {str(e)}")
             raise ImportError(
                 "FileNotFoundError for misconfigured CH341DLL.dll. See Issue #459"
@@ -58,23 +61,23 @@
                 self.channel(_("Connection to USB failed.\n"))
                 self.state("STATE_CONNECTION_FAILED")
                 raise ConnectionRefusedError  # No more devices.
             self.driver_index = usb_index
             self.state("STATE_USB_CONNECTED")
             self.channel(_("USB Connected."))
             self.channel(_("Sending CH341 mode change to EPP1.9."))
-            try:
-                self.driver.CH341InitParallel(
-                    self.driver_index, 1
-                )  # 0x40, 177, 0x8800, 0, 0
+            success = self.driver.CH341InitParallel(
+                self.driver_index, 1
+            )  # 0x40, 177, 0x8800, 0, 0
+            if success:
                 self.channel(_("CH341 mode change to EPP1.9: Success."))
-            except ConnectionError as e:
-                self.channel(str(e))
+            else:
                 self.channel(_("CH341 mode change to EPP1.9: Fail."))
                 self.driver.CH341CloseDevice(self.driver_index)
+                raise ConnectionRefusedError
             self.channel(_("Device Connected.\n"))
 
     def close(self):
         """
         Closes the driver for the stated device index.
         """
         _ = self.channel._
@@ -102,40 +105,44 @@
         Writes a 32 byte packet to the device. This is typically \x00 + 30 bytes + CRC
         The driver will packetize the \0xA6 writes.
 
         @param packet: 32 bytes of data to be written to the CH341.
         @return:
         """
         if not self.is_connected():
-            raise ConnectionError
+            raise ConnectionError("Not connected.")
         length = len(packet)
         obuf = (c_byte * length)()
         for i in range(length):
             obuf[i] = packet[i]
         length = (c_byte * 1)()
         length[0] = len(packet)
-        self.driver.CH341EppWriteData(self.driver_index, obuf, length)
+        success = self.driver.CH341EppWriteData(self.driver_index, obuf, length)
+        if not success:
+            raise ConnectionError("Failed to write to CH341:Windll.")
 
     def write_addr(self, packet):
         """
         Writes an address byte packet to the device. This is typically 1 byte
         The driver will packetize the \0xA7 writes.
 
         @param packet: 1 byte of data to be written to the CH341.
         @return:
         """
         if not self.is_connected():
-            raise ConnectionError
+            raise ConnectionError("Not connected.")
         length = len(packet)
         obuf = (c_byte * length)()
         for i in range(length):
             obuf[i] = packet[i]
         length = (c_byte * 1)()
         length[0] = len(packet)
-        self.driver.CH341EppWriteAddr(self.driver_index, packet, length)
+        success = self.driver.CH341EppWriteAddr(self.driver_index, packet, length)
+        if not success:
+            raise ConnectionError("Failed to write_addr to CH341:Windll.")
 
     def get_status(self):
         """
         Gets the status bytes from the CH341. This is usually 255 for the D0-D7 values
         And the state flags for the chip signals. Importantly are WAIT which means do not
         send data, and ERR which means the data sent was faulty. And PEMP which means the
         buffer is empty.
@@ -150,24 +157,26 @@
         StateBitRESET   0x00010000
         StateBitWRITE   0x00020000
         StateBitSCL     0x00400000
         StateBitSDA     0x00800000
         @return:
         """
         if not self.is_connected():
-            raise ConnectionRefusedError
-        length = (c_byte * 1)()
-        write_buffer = (c_byte * 1)()
-        write_buffer[0] = 0xA0
-        length[0] = len(write_buffer)
-        self.driver.CH341WriteData(self.driver_index, write_buffer, length)
+            raise ConnectionRefusedError("Not connected.")
         read_buffer = (c_byte * 6)()
-        length[0] = len(read_buffer)
-        self.driver.CH341ReadData(self.driver_index, read_buffer, length)
-        # self.driver.CH341GetStatus(self.driver_index, read_buffer)
+        if self.bulk:
+            write_buffer = (c_byte * 1)()
+            write_buffer[0] = mCH341_PARA_CMD_STS
+            length = (c_byte * 1)()
+            length[0] = len(write_buffer)
+            self.driver.CH341WriteData(self.driver_index, write_buffer, length)
+            length[0] = len(read_buffer)
+            self.driver.CH341ReadData(self.driver_index, read_buffer, length)
+        else:
+            self.driver.CH341GetStatus(self.driver_index, read_buffer)
         return [int(q & 0xFF) for q in read_buffer]
 
     def get_chip_version(self):
         """
         Gets the version of the CH341 chip being used.
         @return: version. Eg. 48.
         """
```

### Comparing `meerk40t-0.8.3000/meerk40t/core/bindalias.py` & `meerk40t-0.8.4000/meerk40t/core/bindalias.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/core/core.py` & `meerk40t-0.8.4000/meerk40t/core/core.py`

 * *Files 5% similar despite different names*

```diff
@@ -8,14 +8,18 @@
     if lifecycle == "plugins":
         plugins = []
 
         from . import spoolers
 
         plugins.append(spoolers.plugin)
 
+        from . import space
+
+        plugins.append(space.plugin)
+
         from .elements import elements
 
         plugins.append(elements.plugin)
 
         from .elements import penbox
 
         plugins.append(penbox.plugin)
```

### Comparing `meerk40t-0.8.3000/meerk40t/core/cutcode/cubiccut.py` & `meerk40t-0.8.4000/meerk40t/core/cutcode/cubiccut.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/core/cutcode/cutcode.py` & `meerk40t-0.8.4000/meerk40t/core/cutcode/cutcode.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/core/cutcode/cutgroup.py` & `meerk40t-0.8.4000/meerk40t/core/cutcode/cutgroup.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/core/cutcode/cutobject.py` & `meerk40t-0.8.4000/meerk40t/core/cutcode/cutobject.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/core/cutcode/dwellcut.py` & `meerk40t-0.8.4000/meerk40t/core/cutcode/dwellcut.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/core/cutcode/gotocut.py` & `meerk40t-0.8.4000/meerk40t/core/cutcode/gotocut.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/core/cutcode/homecut.py` & `meerk40t-0.8.4000/meerk40t/core/cutcode/homecut.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/core/cutcode/inputcut.py` & `meerk40t-0.8.4000/meerk40t/core/cutcode/inputcut.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/core/cutcode/linecut.py` & `meerk40t-0.8.4000/meerk40t/core/cutcode/linecut.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/core/cutcode/outputcut.py` & `meerk40t-0.8.4000/meerk40t/core/cutcode/outputcut.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/core/cutcode/plotcut.py` & `meerk40t-0.8.4000/meerk40t/core/cutcode/plotcut.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/core/cutcode/quadcut.py` & `meerk40t-0.8.4000/meerk40t/core/cutcode/quadcut.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/core/cutcode/rastercut.py` & `meerk40t-0.8.4000/meerk40t/core/cutcode/rastercut.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/core/cutcode/setorigincut.py` & `meerk40t-0.8.4000/meerk40t/core/cutcode/setorigincut.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/core/cutcode/waitcut.py` & `meerk40t-0.8.4000/meerk40t/core/cutcode/waitcut.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/core/cutplan.py` & `meerk40t-0.8.4000/meerk40t/core/cutplan.py`

 * *Files 3% similar despite different names*

```diff
@@ -117,19 +117,19 @@
 
         Nodes are expected to convert relevant properties and shapes from scene coordinates to device coordinate systems
         if they need operations. They are also expected to add any relevant commands to the commands list. The commands
         list sequentially in the next stage.
         """
         device = self.context.device
 
+        scene_to_device_matrix = device.scene_to_device_matrix()
+
         # ==========
-        # Preprocess Operations
+        # Determine the jobs bounds.
         # ==========
-        matrix = device.scene_to_device_matrix()
-
         bounds = Node.union_bounds(self.plan, bounds=self._previous_bounds)
         self._previous_bounds = bounds
         if bounds is not None:
             left, top, right, bottom = bounds
             min_x = min(right, left)
             min_y = min(top, bottom)
             max_x = max(right, left)
@@ -141,30 +141,84 @@
                 self.outline = (
                     device.device_position(min_x, min_y),
                     device.device_position(max_x, min_y),
                     device.device_position(max_x, max_y),
                     device.device_position(min_x, max_y),
                 )
 
+        # ==========
+        # Query Placements
+        # ==========
+        placements = []
+        for place in self.plan:
+            if not hasattr(place, "type"):
+                continue
+            if place.type.startswith("place "):
+                if hasattr(place, "output") and place.output:
+                    loops = 1
+                    if hasattr(place, "loops") and place.loops > 1:
+                        loops = place.loops
+                    for idx in range(loops):
+                        placements.extend(
+                            place.placements(
+                                self.context, self.outline, scene_to_device_matrix, self
+                            )
+                        )
+        if not placements:
+            # Absolute coordinates.
+            placements.append(scene_to_device_matrix)
+
         # TODO: Correct rotary.
         # rotary = self.context.rotary
         # if rotary.rotary_enabled:
         #     axis = rotary.axis
 
-        for op in self.plan:
-            if not hasattr(op, "type") or op.type is None:
-                continue
-            if op.type.startswith("op"):
-                if hasattr(op, "preprocess"):
-                    op.preprocess(self.context, matrix, self)
-                for node in op.flat():
-                    if node is op:
-                        continue
-                    if hasattr(node, "preprocess"):
-                        node.preprocess(self.context, matrix, self)
+        original_ops = copy(self.plan)
+        self.plan.clear()
+        idx = 0
+        self.context.elements.mywordlist.push()
+
+        for placement in placements:
+            # Adjust wordlist
+            if idx > 0:
+                self.context.elements.mywordlist.move_all_indices(1)
+
+            for original_op in original_ops:
+                op = copy(original_op)
+                if not hasattr(op, "type") or op.type is None:
+                    self.plan.append(op)
+                    continue
+                if op.type.startswith("place "):
+                    continue
+                self.plan.append(op)
+                if op.type.startswith("op"):
+                    for child in original_op.children:
+                        op.add_node(copy(child))
+                    if hasattr(op, "preprocess"):
+                        op.preprocess(self.context, placement, self)
+                    for node in op.flat():
+                        if node is op:
+                            continue
+                        if hasattr(node, "mktext") and hasattr(node, "_cache"):
+                            newtext = self.context.elements.wordlist_translate(
+                                node.mktext, elemnode=node, increment=False
+                            )
+                            oldtext = getattr(node, "_translated_text", "")
+                            # print (f"Was called inside preprocess for {node.type} with {node.mktext}, old: {oldtext}, new:{newtext}")
+                            if newtext != oldtext:
+                                node._translated_text = newtext
+                                kernel = self.context.elements.kernel
+                                for property_op in kernel.lookup_all("path_updater/.*"):
+                                    property_op(kernel.root, node)
+                                if hasattr(node, "_cache"):
+                                    node._cache = None
+                        if hasattr(node, "preprocess"):
+                            node.preprocess(self.context, placement, self)
+            idx += 1
+        self.context.elements.mywordlist.pop()
 
     def _to_grouped_plan(self, plan):
         """
         Break operations into grouped sequences of Operations and utility operations.
 
         We can only merge between contiguous groups of operations. We cannot merge util node types with op node types.
 
@@ -443,24 +497,35 @@
             pass
 
     def optimize_travel_2opt(self):
         """
         Optimize travel 2opt at optimize stage on cutcode
         @return:
         """
+        busy = self.context.kernel.busyinfo
+        _ = self.context.kernel.translation
+        if busy.shown:
+            busy.change(msg=_("Optimize inner travel"), keep=1)
+            busy.show()
         channel = self.context.channel("optimize", timestamp=True)
         for i, c in enumerate(self.plan):
             if isinstance(c, CutCode):
                 self.plan[i] = short_travel_cutcode_2opt(self.plan[i], channel=channel)
 
     def optimize_cuts(self):
         """
         Optimize cuts at optimize stage on cutcode
         @return:
         """
+        # Update Info-panel if displayed
+        busy = self.context.kernel.busyinfo
+        _ = self.context.kernel.translation
+        if busy.shown:
+            busy.change(msg=_("Optimize cuts"), keep=1)
+            busy.show()
         tolerance = 0
         if self.context.opt_inner_first:
             stol = self.context.opt_inner_tolerance
             try:
                 tolerance = (
                     float(Length(stol))
                     * 2
@@ -472,14 +537,19 @@
             except ValueError:
                 pass
         # print(f"Tolerance: {tolerance}")
 
         channel = self.context.channel("optimize", timestamp=True)
         grouped_inner = self.context.opt_inner_first and self.context.opt_inners_grouped
         for i, c in enumerate(self.plan):
+            if busy.shown:
+                busy.change(
+                    msg=_("Optimize cuts") + f" {i + 1}/{len(self.plan)}", keep=1
+                )
+                busy.show()
             if isinstance(c, CutCode):
                 if c.constrained:
                     self.plan[i] = inner_first_ident(
                         c, channel=channel, tolerance=tolerance
                     )
                     c = self.plan[i]
                 self.plan[i] = inner_selection_cutcode(
@@ -489,14 +559,20 @@
                 )
 
     def optimize_travel(self):
         """
         Optimize travel at optimize stage on cutcode.
         @return:
         """
+        # Update Info-panel if displayed
+        busy = self.context.kernel.busyinfo
+        _ = self.context.kernel.translation
+        if busy.shown:
+            busy.change(msg=_("Optimize travel"), keep=1)
+            busy.show()
         try:
             last = self.context.device.native
         except AttributeError:
             last = None
         tolerance = 0
         if self.context.opt_inner_first:
             stol = self.context.opt_inner_tolerance
@@ -512,14 +588,20 @@
             except ValueError:
                 pass
         # print(f"Tolerance: {tolerance}")
 
         channel = self.context.channel("optimize", timestamp=True)
         grouped_inner = self.context.opt_inner_first and self.context.opt_inners_grouped
         for i, c in enumerate(self.plan):
+            if busy.shown:
+                busy.change(
+                    msg=_("Optimize travel") + f" {i + 1}/{len(self.plan)}", keep=1
+                )
+                busy.show()
+
             if isinstance(c, CutCode):
                 if c.constrained:
                     self.plan[i] = inner_first_ident(
                         c, channel=channel, tolerance=tolerance
                     )
                     c = self.plan[i]
                 if last is not None:
@@ -533,14 +615,19 @@
                 last = self.plan[i].end
 
     def merge_cutcode(self):
         """
         Merge all adjacent optimized cutcode into single cutcode objects.
         @return:
         """
+        busy = self.context.kernel.busyinfo
+        _ = self.context.kernel.translation
+        if busy.shown:
+            busy.change(msg=_("Merging cutcode"), keep=1)
+            busy.show()
         for i in range(len(self.plan) - 1, 0, -1):
             cur = self.plan[i]
             prev = self.plan[i - 1]
             if isinstance(cur, CutCode) and isinstance(prev, CutCode):
                 prev.extend(cur)
                 del self.plan[i]
```

### Comparing `meerk40t-0.8.3000/meerk40t/core/drivers.py` & `meerk40t-0.8.4000/meerk40t/core/drivers.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/core/elements/align.py` & `meerk40t-0.8.4000/meerk40t/core/elements/align.py`

 * *Files 2% similar despite different names*

```diff
@@ -468,15 +468,15 @@
         input_type="align",
         output_type="align",
     )
     def subtype_align_spaceh(command, channel, _, data=None, **kwargs):
         mode, group, bound, raw_elements = data
         haslock = False
         for node in raw_elements:
-            if hasattr(node, "lock") and node.lock and not self.lock_allows_move:
+            if not node.can_move(self.lock_allows_move):
                 haslock = True
                 break
         if haslock:
             channel(_("Your selection contains a locked element, that cannot be moved"))
             return "align", (mode, group, bound, raw_elements)
         elements = self.condense_elements(raw_elements)
         distribute_elements(elements, in_x=True, distance=True)
@@ -489,15 +489,15 @@
         input_type="align",
         output_type="align",
     )
     def subtype_align_spaceh2(command, channel, _, data=None, **kwargs):
         mode, group, bound, raw_elements = data
         haslock = False
         for node in raw_elements:
-            if hasattr(node, "lock") and node.lock and not self.lock_allows_move:
+            if not node.can_move(self.lock_allows_move):
                 haslock = True
                 break
         if haslock:
             channel(_("Your selection contains a locked element, that cannot be moved"))
             return "align", (mode, group, bound, raw_elements)
         elements = self.condense_elements(raw_elements)
         distribute_elements(elements, in_x=True, distance=False)
@@ -510,15 +510,15 @@
         input_type="align",
         output_type="align",
     )
     def subtype_align_spacev(command, channel, _, data=None, **kwargs):
         mode, group, bound, raw_elements = data
         haslock = False
         for node in raw_elements:
-            if hasattr(node, "lock") and node.lock and not self.lock_allows_move:
+            if not node.can_move(self.lock_allows_move):
                 haslock = True
                 break
         if haslock:
             channel(_("Your selection contains a locked element, that cannot be moved"))
             return "align", (mode, group, bound, raw_elements)
         elements = self.condense_elements(raw_elements)
         distribute_elements(elements, in_x=False, distance=True)
@@ -531,15 +531,15 @@
         input_type="align",
         output_type="align",
     )
     def subtype_align_spacev2(command, channel, _, data=None, **kwargs):
         mode, group, bound, raw_elements = data
         haslock = False
         for node in raw_elements:
-            if hasattr(node, "lock") and node.lock and not self.lock_allows_move:
+            if not node.can_move(self.lock_allows_move):
                 haslock = True
                 break
         if haslock:
             channel(_("Your selection contains a locked element, that cannot be moved"))
             return "align", (mode, group, bound, raw_elements)
         elements = self.condense_elements(raw_elements)
         distribute_elements(elements, in_x=False, distance=False)
@@ -598,15 +598,15 @@
         for node in elements:
             boundary_points.append(node.bounds)
         if not len(boundary_points):
             return
 
         haslock = False
         for node in elements:
-            if hasattr(node, "lock") and node.lock and not self.lock_allows_move:
+            if hasattr(node, "can_move") and not node.can_move(self.lock_allows_move):
                 haslock = True
                 break
         if haslock:
             channel(_("Your selection contains a locked element, that cannot be moved"))
             return
         left_edge = min([e[0] for e in boundary_points])
         top_edge = min([e[1] for e in boundary_points])
```

### Comparing `meerk40t-0.8.3000/meerk40t/core/elements/branches.py` & `meerk40t-0.8.4000/meerk40t/core/elements/branches.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/core/elements/clipboard.py` & `meerk40t-0.8.4000/meerk40t/core/elements/clipboard.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/core/elements/element_treeops.py` & `meerk40t-0.8.4000/meerk40t/core/elements/element_treeops.py`

 * *Files 3% similar despite different names*

```diff
@@ -43,5439 +43,5960 @@
 000002a0: 746f 725f 6166 7465 722c 0d0a 2020 2020  tor_after,..    
 000002b0: 7472 6565 5f73 6570 6172 6174 6f72 5f62  tree_separator_b
 000002c0: 6566 6f72 652c 0d0a 2020 2020 7472 6565  efore,..    tree
 000002d0: 5f73 7562 6d65 6e75 2c0d 0a20 2020 2074  _submenu,..    t
 000002e0: 7265 655f 7661 6c75 6573 2c0d 0a29 0d0a  ree_values,..)..
 000002f0: 6672 6f6d 206d 6565 726b 3430 742e 636f  from meerk40t.co
 00000300: 7265 2e75 6e69 7473 2069 6d70 6f72 7420  re.units import 
-00000310: 554e 4954 535f 5045 525f 494e 4348 0d0a  UNITS_PER_INCH..
-00000320: 6672 6f6d 206d 6565 726b 3430 742e 6b65  from meerk40t.ke
-00000330: 726e 656c 2069 6d70 6f72 7420 436f 6d6d  rnel import Comm
-00000340: 616e 6453 796e 7461 7845 7272 6f72 0d0a  andSyntaxError..
-00000350: 6672 6f6d 206d 6565 726b 3430 742e 7376  from meerk40t.sv
-00000360: 6765 6c65 6d65 6e74 7320 696d 706f 7274  gelements import
-00000370: 204d 6174 7269 782c 2050 6f69 6e74 0d0a   Matrix, Point..
-00000380: 0d0a 6672 6f6d 202e 656c 656d 656e 745f  ..from .element_
-00000390: 7479 7065 7320 696d 706f 7274 202a 0d0a  types import *..
-000003a0: 0d0a 0d0a 6465 6620 706c 7567 696e 286b  ....def plugin(k
-000003b0: 6572 6e65 6c2c 206c 6966 6563 7963 6c65  ernel, lifecycle
-000003c0: 3d4e 6f6e 6529 3a0d 0a20 2020 205f 203d  =None):..    _ =
-000003d0: 206b 6572 6e65 6c2e 7472 616e 736c 6174   kernel.translat
-000003e0: 696f 6e0d 0a20 2020 2069 6620 6c69 6665  ion..    if life
-000003f0: 6379 636c 6520 3d3d 2022 706f 7374 626f  cycle == "postbo
-00000400: 6f74 223a 0d0a 2020 2020 2020 2020 696e  ot":..        in
-00000410: 6974 5f74 7265 6528 6b65 726e 656c 290d  it_tree(kernel).
-00000420: 0a0d 0a0d 0a64 6566 2069 6e69 745f 7472  .....def init_tr
-00000430: 6565 286b 6572 6e65 6c29 3a0d 0a20 2020  ee(kernel):..   
-00000440: 2073 656c 6620 3d20 6b65 726e 656c 2e65   self = kernel.e
-00000450: 6c65 6d65 6e74 730d 0a0d 0a20 2020 2074  lements....    t
-00000460: 7265 655f 6f70 6572 6174 696f 6e20 3d20  ree_operation = 
-00000470: 6765 745f 7472 6565 5f6f 7065 7261 7469  get_tree_operati
-00000480: 6f6e 2873 656c 6629 0d0a 0d0a 2020 2020  on(self)....    
-00000490: 5f20 3d20 6b65 726e 656c 2e74 7261 6e73  _ = kernel.trans
-000004a0: 6c61 7469 6f6e 0d0a 0d0a 2020 2020 2320  lation....    # 
-000004b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000004c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d20 5452 4545  ----------- TREE
-000004d0: 204f 5045 5241 5449 4f4e 5320 2d2d 2d2d   OPERATIONS ----
-000004e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000004f0: 2d2d 2d2d 2d2d 2d0d 0a0d 0a20 2020 2064  -------....    d
-00000500: 6566 2069 735f 7265 676d 6172 6b28 6e6f  ef is_regmark(no
-00000510: 6465 293a 0d0a 2020 2020 2020 2020 7265  de):..        re
-00000520: 7375 6c74 203d 2046 616c 7365 0d0a 2020  sult = False..  
-00000530: 2020 2020 2020 7472 793a 0d0a 2020 2020        try:..    
-00000540: 2020 2020 2020 2020 6966 206e 6f64 652e          if node.
-00000550: 5f70 6172 656e 742e 7479 7065 203d 3d20  _parent.type == 
-00000560: 2262 7261 6e63 6820 7265 6722 3a0d 0a20  "branch reg":.. 
-00000570: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00000580: 6573 756c 7420 3d20 5472 7565 0d0a 2020  esult = True..  
-00000590: 2020 2020 2020 6578 6365 7074 2041 7474        except Att
-000005a0: 7269 6275 7465 4572 726f 723a 0d0a 2020  ributeError:..  
-000005b0: 2020 2020 2020 2020 2020 7061 7373 0d0a            pass..
-000005c0: 2020 2020 2020 2020 7265 7475 726e 2072          return r
-000005d0: 6573 756c 740d 0a0d 0a20 2020 2064 6566  esult....    def
-000005e0: 2068 6173 5f63 6861 6e67 6573 286e 6f64   has_changes(nod
-000005f0: 6529 3a0d 0a20 2020 2020 2020 2072 6573  e):..        res
-00000600: 756c 7420 3d20 4661 6c73 650d 0a20 2020  ult = False..   
-00000610: 2020 2020 2074 7279 3a0d 0a20 2020 2020       try:..     
-00000620: 2020 2020 2020 2069 6620 6e6f 7420 6e6f         if not no
-00000630: 6465 2e6d 6174 7269 782e 6973 5f69 6465  de.matrix.is_ide
-00000640: 6e74 6974 7928 293a 0d0a 2020 2020 2020  ntity():..      
-00000650: 2020 2020 2020 2020 2020 7265 7375 6c74            result
-00000660: 203d 2054 7275 650d 0a20 2020 2020 2020   = True..       
-00000670: 2065 7863 6570 7420 4174 7472 6962 7574   except Attribut
-00000680: 6545 7272 6f72 3a0d 0a20 2020 2020 2020  eError:..       
-00000690: 2020 2020 2023 2054 6865 7265 2077 6173       # There was
-000006a0: 2061 6e20 6572 726f 7220 6475 7269 6e67   an error during
-000006b0: 2063 6865 636b 2066 6f72 206d 6174 7269   check for matri
-000006c0: 782e 6973 5f69 6465 6e74 6974 790d 0a20  x.is_identity.. 
-000006d0: 2020 2020 2020 2020 2020 2070 6173 730d             pass.
-000006e0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000006f0: 7265 7375 6c74 0d0a 0d0a 2020 2020 4074  result....    @t
-00000700: 7265 655f 7365 7061 7261 746f 725f 6166  ree_separator_af
-00000710: 7465 7228 290d 0a20 2020 2040 7472 6565  ter()..    @tree
-00000720: 5f63 6f6e 6469 7469 6f6e 616c 286c 616d  _conditional(lam
-00000730: 6264 6120 6e6f 6465 3a20 6c65 6e28 6c69  bda node: len(li
-00000740: 7374 2873 656c 662e 6f70 7328 7365 6c65  st(self.ops(sele
-00000750: 6374 6564 3d54 7275 6529 2929 203d 3d20  cted=True))) == 
-00000760: 3129 0d0a 2020 2020 4074 7265 655f 6f70  1)..    @tree_op
-00000770: 6572 6174 696f 6e28 5f28 224f 7065 7261  eration(_("Opera
-00000780: 7469 6f6e 2070 726f 7065 7274 6965 7322  tion properties"
-00000790: 292c 206e 6f64 655f 7479 7065 3d6f 705f  ), node_type=op_
-000007a0: 6e6f 6465 732c 2068 656c 703d 2222 290d  nodes, help="").
-000007b0: 0a20 2020 2064 6566 206f 7065 7261 7469  .    def operati
-000007c0: 6f6e 5f70 726f 7065 7274 7928 6e6f 6465  on_property(node
-000007d0: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
-000007e0: 2020 2020 2020 6163 7469 7661 7465 203d        activate =
-000007f0: 2073 656c 662e 6b65 726e 656c 2e6c 6f6f   self.kernel.loo
-00000800: 6b75 7028 2266 756e 6374 696f 6e2f 6f70  kup("function/op
-00000810: 656e 5f70 726f 7065 7274 795f 7769 6e64  en_property_wind
-00000820: 6f77 5f66 6f72 5f6e 6f64 6522 290d 0a20  ow_for_node").. 
-00000830: 2020 2020 2020 2069 6620 6163 7469 7661         if activa
-00000840: 7465 2069 7320 6e6f 7420 4e6f 6e65 3a0d  te is not None:.
-00000850: 0a20 2020 2020 2020 2020 2020 2061 6374  .            act
-00000860: 6976 6174 6528 6e6f 6465 290d 0a0d 0a20  ivate(node).... 
-00000870: 2020 2040 7472 6565 5f73 6570 6172 6174     @tree_separat
-00000880: 6f72 5f61 6674 6572 2829 0d0a 2020 2020  or_after()..    
-00000890: 4074 7265 655f 6f70 6572 6174 696f 6e28  @tree_operation(
-000008a0: 5f28 2245 6469 7422 292c 206e 6f64 655f  _("Edit"), node_
-000008b0: 7479 7065 3d22 7574 696c 2063 6f6e 736f  type="util conso
-000008c0: 6c65 222c 2068 656c 703d 2222 290d 0a20  le", help="").. 
-000008d0: 2020 2064 6566 2065 6469 745f 636f 6e73     def edit_cons
-000008e0: 6f6c 655f 636f 6d6d 616e 6428 6e6f 6465  ole_command(node
-000008f0: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
-00000900: 2020 2020 2020 6163 7469 7661 7465 203d        activate =
-00000910: 2073 656c 662e 6b65 726e 656c 2e6c 6f6f   self.kernel.loo
-00000920: 6b75 7028 2266 756e 6374 696f 6e2f 6f70  kup("function/op
-00000930: 656e 5f70 726f 7065 7274 795f 7769 6e64  en_property_wind
-00000940: 6f77 5f66 6f72 5f6e 6f64 6522 290d 0a20  ow_for_node").. 
-00000950: 2020 2020 2020 2069 6620 6163 7469 7661         if activa
-00000960: 7465 2069 7320 6e6f 7420 4e6f 6e65 3a0d  te is not None:.
-00000970: 0a20 2020 2020 2020 2020 2020 2061 6374  .            act
-00000980: 6976 6174 6528 6e6f 6465 290d 0a0d 0a20  ivate(node).... 
-00000990: 2020 2040 7472 6565 5f73 6570 6172 6174     @tree_separat
-000009a0: 6f72 5f61 6674 6572 2829 0d0a 2020 2020  or_after()..    
-000009b0: 4074 7265 655f 6f70 6572 6174 696f 6e28  @tree_operation(
-000009c0: 0d0a 2020 2020 2020 2020 5f28 2245 6c65  ..        _("Ele
-000009d0: 6d65 6e74 2070 726f 7065 7274 6965 7322  ment properties"
-000009e0: 292c 0d0a 2020 2020 2020 2020 6e6f 6465  ),..        node
-000009f0: 5f74 7970 653d 280d 0a20 2020 2020 2020  _type=(..       
-00000a00: 2020 2020 2022 656c 656d 2065 6c6c 6970       "elem ellip
-00000a10: 7365 222c 0d0a 2020 2020 2020 2020 2020  se",..          
-00000a20: 2020 2265 6c65 6d20 7061 7468 222c 0d0a    "elem path",..
-00000a30: 2020 2020 2020 2020 2020 2020 2265 6c65              "ele
-00000a40: 6d20 706f 696e 7422 2c0d 0a20 2020 2020  m point",..     
-00000a50: 2020 2020 2020 2022 656c 656d 2070 6f6c         "elem pol
-00000a60: 796c 696e 6522 2c0d 0a20 2020 2020 2020  yline",..       
-00000a70: 2020 2020 2022 656c 656d 2072 6563 7422       "elem rect"
-00000a80: 2c0d 0a20 2020 2020 2020 2020 2020 2022  ,..            "
-00000a90: 656c 656d 206c 696e 6522 2c0d 0a20 2020  elem line",..   
-00000aa0: 2020 2020 2029 2c0d 0a20 2020 2020 2020       ),..       
-00000ab0: 2068 656c 703d 2222 2c0d 0a20 2020 2029   help="",..    )
-00000ac0: 0d0a 2020 2020 6465 6620 7061 7468 5f70  ..    def path_p
-00000ad0: 726f 7065 7274 7928 6e6f 6465 2c20 2a2a  roperty(node, **
-00000ae0: 6b77 6172 6773 293a 0d0a 2020 2020 2020  kwargs):..      
-00000af0: 2020 6163 7469 7661 7465 203d 2073 656c    activate = sel
-00000b00: 662e 6b65 726e 656c 2e6c 6f6f 6b75 7028  f.kernel.lookup(
-00000b10: 2266 756e 6374 696f 6e2f 6f70 656e 5f70  "function/open_p
-00000b20: 726f 7065 7274 795f 7769 6e64 6f77 5f66  roperty_window_f
-00000b30: 6f72 5f6e 6f64 6522 290d 0a20 2020 2020  or_node")..     
-00000b40: 2020 2069 6620 6163 7469 7661 7465 2069     if activate i
-00000b50: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
-00000b60: 2020 2020 2020 2020 2061 6374 6976 6174           activat
-00000b70: 6528 6e6f 6465 290d 0a0d 0a20 2020 2040  e(node)....    @
-00000b80: 7472 6565 5f73 6570 6172 6174 6f72 5f61  tree_separator_a
-00000b90: 6674 6572 2829 0d0a 2020 2020 4074 7265  fter()..    @tre
-00000ba0: 655f 6f70 6572 6174 696f 6e28 5f28 2247  e_operation(_("G
-00000bb0: 726f 7570 2070 726f 7065 7274 6965 7322  roup properties"
-00000bc0: 292c 206e 6f64 655f 7479 7065 3d22 6772  ), node_type="gr
-00000bd0: 6f75 7022 2c20 6865 6c70 3d22 2229 0d0a  oup", help="")..
-00000be0: 2020 2020 6465 6620 6772 6f75 705f 7072      def group_pr
-00000bf0: 6f70 6572 7479 286e 6f64 652c 202a 2a6b  operty(node, **k
-00000c00: 7761 7267 7329 3a0d 0a20 2020 2020 2020  wargs):..       
-00000c10: 2061 6374 6976 6174 6520 3d20 7365 6c66   activate = self
-00000c20: 2e6b 6572 6e65 6c2e 6c6f 6f6b 7570 2822  .kernel.lookup("
-00000c30: 6675 6e63 7469 6f6e 2f6f 7065 6e5f 7072  function/open_pr
-00000c40: 6f70 6572 7479 5f77 696e 646f 775f 666f  operty_window_fo
-00000c50: 725f 6e6f 6465 2229 0d0a 2020 2020 2020  r_node")..      
-00000c60: 2020 6966 2061 6374 6976 6174 6520 6973    if activate is
-00000c70: 206e 6f74 204e 6f6e 653a 0d0a 2020 2020   not None:..    
-00000c80: 2020 2020 2020 2020 6163 7469 7661 7465          activate
-00000c90: 286e 6f64 6529 0d0a 0d0a 2020 2020 4074  (node)....    @t
-00000ca0: 7265 655f 7365 7061 7261 746f 725f 6166  ree_separator_af
-00000cb0: 7465 7228 290d 0a20 2020 2040 7472 6565  ter()..    @tree
-00000cc0: 5f6f 7065 7261 7469 6f6e 285f 2822 5465  _operation(_("Te
-00000cd0: 7874 2070 726f 7065 7274 6965 7322 292c  xt properties"),
-00000ce0: 206e 6f64 655f 7479 7065 3d22 656c 656d   node_type="elem
-00000cf0: 2074 6578 7422 2c20 6865 6c70 3d22 2229   text", help="")
-00000d00: 0d0a 2020 2020 6465 6620 7465 7874 5f70  ..    def text_p
-00000d10: 726f 7065 7274 7928 6e6f 6465 2c20 2a2a  roperty(node, **
-00000d20: 6b77 6172 6773 293a 0d0a 2020 2020 2020  kwargs):..      
-00000d30: 2020 6163 7469 7661 7465 203d 2073 656c    activate = sel
-00000d40: 662e 6b65 726e 656c 2e6c 6f6f 6b75 7028  f.kernel.lookup(
-00000d50: 2266 756e 6374 696f 6e2f 6f70 656e 5f70  "function/open_p
-00000d60: 726f 7065 7274 795f 7769 6e64 6f77 5f66  roperty_window_f
-00000d70: 6f72 5f6e 6f64 6522 290d 0a20 2020 2020  or_node")..     
-00000d80: 2020 2069 6620 6163 7469 7661 7465 2069     if activate i
-00000d90: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
-00000da0: 2020 2020 2020 2020 2061 6374 6976 6174           activat
-00000db0: 6528 6e6f 6465 290d 0a0d 0a20 2020 2040  e(node)....    @
-00000dc0: 7472 6565 5f73 6570 6172 6174 6f72 5f61  tree_separator_a
-00000dd0: 6674 6572 2829 0d0a 2020 2020 4074 7265  fter()..    @tre
-00000de0: 655f 6f70 6572 6174 696f 6e28 5f28 2249  e_operation(_("I
-00000df0: 6d61 6765 2070 726f 7065 7274 6965 7322  mage properties"
-00000e00: 292c 206e 6f64 655f 7479 7065 3d22 656c  ), node_type="el
-00000e10: 656d 2069 6d61 6765 222c 2068 656c 703d  em image", help=
-00000e20: 2222 290d 0a20 2020 2064 6566 2069 6d61  "")..    def ima
-00000e30: 6765 5f70 726f 7065 7274 7928 6e6f 6465  ge_property(node
-00000e40: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
-00000e50: 2020 2020 2020 6163 7469 7661 7465 203d        activate =
-00000e60: 2073 656c 662e 6b65 726e 656c 2e6c 6f6f   self.kernel.loo
-00000e70: 6b75 7028 2266 756e 6374 696f 6e2f 6f70  kup("function/op
-00000e80: 656e 5f70 726f 7065 7274 795f 7769 6e64  en_property_wind
-00000e90: 6f77 5f66 6f72 5f6e 6f64 6522 290d 0a20  ow_for_node").. 
-00000ea0: 2020 2020 2020 2069 6620 6163 7469 7661         if activa
-00000eb0: 7465 2069 7320 6e6f 7420 4e6f 6e65 3a0d  te is not None:.
-00000ec0: 0a20 2020 2020 2020 2020 2020 2061 6374  .            act
-00000ed0: 6976 6174 6528 6e6f 6465 290d 0a0d 0a20  ivate(node).... 
-00000ee0: 2020 2040 7472 6565 5f63 6f6e 6469 7469     @tree_conditi
-00000ef0: 6f6e 616c 286c 616d 6264 6120 6e6f 6465  onal(lambda node
-00000f00: 3a20 6e6f 7420 6973 5f72 6567 6d61 726b  : not is_regmark
-00000f10: 286e 6f64 6529 290d 0a20 2020 2040 7472  (node))..    @tr
-00000f20: 6565 5f6f 7065 7261 7469 6f6e 285f 2822  ee_operation(_("
-00000f30: 556e 6772 6f75 7020 656c 656d 656e 7473  Ungroup elements
-00000f40: 2229 2c20 6e6f 6465 5f74 7970 653d 2822  "), node_type=("
-00000f50: 6772 6f75 7022 2c20 2266 696c 6522 292c  group", "file"),
-00000f60: 2068 656c 703d 2222 290d 0a20 2020 2064   help="")..    d
-00000f70: 6566 2075 6e67 726f 7570 5f65 6c65 6d65  ef ungroup_eleme
-00000f80: 6e74 7328 6e6f 6465 2c20 2a2a 6b77 6172  nts(node, **kwar
-00000f90: 6773 293a 0d0a 2020 2020 2020 2020 746f  gs):..        to
-00000fa0: 5f74 7265 6174 203d 205b 5d0d 0a20 2020  _treat = []..   
-00000fb0: 2020 2020 2066 6f72 2067 6e6f 6465 2069       for gnode i
-00000fc0: 6e20 7365 6c66 2e66 6c61 7428 7365 6c65  n self.flat(sele
-00000fd0: 6374 6564 3d54 7275 652c 2063 6173 6361  cted=True, casca
-00000fe0: 6465 3d46 616c 7365 2c20 7479 7065 733d  de=False, types=
-00000ff0: 2822 6772 6f75 7022 2c20 2266 696c 6522  ("group", "file"
-00001000: 2929 3a0d 0a20 2020 2020 2020 2020 2020  )):..           
-00001010: 2065 6e6f 6465 203d 2067 6e6f 6465 0d0a   enode = gnode..
-00001020: 2020 2020 2020 2020 2020 2020 7768 696c              whil
-00001030: 6520 5472 7565 3a0d 0a20 2020 2020 2020  e True:..       
-00001040: 2020 2020 2020 2020 2069 6620 656e 6f64           if enod
-00001050: 652e 7061 7265 6e74 2069 7320 4e6f 6e65  e.parent is None
-00001060: 206f 7220 656e 6f64 652e 7061 7265 6e74   or enode.parent
-00001070: 2069 7320 7365 6c66 2e65 6c65 6d5f 6272   is self.elem_br
-00001080: 616e 6368 3a0d 0a20 2020 2020 2020 2020  anch:..         
-00001090: 2020 2020 2020 2020 2020 2069 6620 656e             if en
-000010a0: 6f64 6520 6e6f 7420 696e 2074 6f5f 7472  ode not in to_tr
-000010b0: 6561 743a 0d0a 2020 2020 2020 2020 2020  eat:..          
-000010c0: 2020 2020 2020 2020 2020 2020 2020 746f                to
-000010d0: 5f74 7265 6174 2e61 7070 656e 6428 656e  _treat.append(en
-000010e0: 6f64 6529 0d0a 2020 2020 2020 2020 2020  ode)..          
-000010f0: 2020 2020 2020 2020 2020 6272 6561 6b0d            break.
-00001100: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00001110: 2069 6620 656e 6f64 652e 7061 7265 6e74   if enode.parent
-00001120: 2e73 656c 6563 7465 643a 0d0a 2020 2020  .selected:..    
-00001130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001140: 656e 6f64 6520 3d20 656e 6f64 652e 7061  enode = enode.pa
-00001150: 7265 6e74 0d0a 2020 2020 2020 2020 2020  rent..          
-00001160: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-00001170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001180: 2069 6620 656e 6f64 6520 6e6f 7420 696e   if enode not in
-00001190: 2074 6f5f 7472 6561 743a 0d0a 2020 2020   to_treat:..    
-000011a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000011b0: 2020 2020 746f 5f74 7265 6174 2e61 7070      to_treat.app
-000011c0: 656e 6428 656e 6f64 6529 0d0a 2020 2020  end(enode)..    
-000011d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000011e0: 6272 6561 6b0d 0a0d 0a20 2020 2020 2020  break....       
-000011f0: 2066 6f72 2067 6e6f 6465 2069 6e20 746f   for gnode in to
-00001200: 5f74 7265 6174 3a0d 0a20 2020 2020 2020  _treat:..       
-00001210: 2020 2020 2066 6f72 206e 2069 6e20 6c69       for n in li
-00001220: 7374 2867 6e6f 6465 2e63 6869 6c64 7265  st(gnode.childre
-00001230: 6e29 3a0d 0a20 2020 2020 2020 2020 2020  n):..           
-00001240: 2020 2020 2067 6e6f 6465 2e69 6e73 6572       gnode.inser
-00001250: 745f 7369 626c 696e 6728 6e29 0d0a 2020  t_sibling(n)..  
-00001260: 2020 2020 2020 2020 2020 676e 6f64 652e            gnode.
-00001270: 7265 6d6f 7665 5f6e 6f64 6528 2920 2023  remove_node()  #
-00001280: 2052 656d 6f76 696e 6720 6772 6f75 702f   Removing group/
-00001290: 6669 6c65 206e 6f64 652e 0d0a 0d0a 2020  file node.....  
-000012a0: 2020 4074 7265 655f 636f 6e64 6974 696f    @tree_conditio
-000012b0: 6e61 6c28 6c61 6d62 6461 206e 6f64 653a  nal(lambda node:
-000012c0: 206e 6f74 2069 735f 7265 676d 6172 6b28   not is_regmark(
-000012d0: 6e6f 6465 2929 0d0a 2020 2020 4074 7265  node))..    @tre
-000012e0: 655f 6f70 6572 6174 696f 6e28 0d0a 2020  e_operation(..  
-000012f0: 2020 2020 2020 5f28 2253 696d 706c 6966        _("Simplif
-00001300: 7920 6772 6f75 7022 292c 0d0a 2020 2020  y group"),..    
-00001310: 2020 2020 6e6f 6465 5f74 7970 653d 2822      node_type=("
-00001320: 6772 6f75 7022 2c20 2266 696c 6522 292c  group", "file"),
-00001330: 0d0a 2020 2020 2020 2020 6865 6c70 3d5f  ..        help=_
-00001340: 2822 556e 6c65 7665 6c20 6772 6f75 7073  ("Unlevel groups
-00001350: 2069 6620 7468 6579 206a 7573 7420 636f   if they just co
-00001360: 6e74 6169 6e20 616e 6f74 6865 7220 6772  ntain another gr
-00001370: 6f75 7022 292c 0d0a 2020 2020 290d 0a20  oup"),..    ).. 
-00001380: 2020 2064 6566 2073 696d 706c 6966 795f     def simplify_
-00001390: 6772 6f75 7073 286e 6f64 652c 202a 2a6b  groups(node, **k
-000013a0: 7761 7267 7329 3a0d 0a20 2020 2020 2020  wargs):..       
-000013b0: 2064 6566 2073 7472 6169 6768 7465 6e28   def straighten(
-000013c0: 736e 6f64 6529 3a0d 0a20 2020 2020 2020  snode):..       
-000013d0: 2020 2020 2061 6d6f 756e 7420 3d20 300d       amount = 0.
-000013e0: 0a20 2020 2020 2020 2020 2020 206e 6565  .            nee
-000013f0: 6473 5f72 6570 6574 6974 696f 6e20 3d20  ds_repetition = 
-00001400: 5472 7565 0d0a 2020 2020 2020 2020 2020  True..          
-00001410: 2020 7768 696c 6520 6e65 6564 735f 7265    while needs_re
-00001420: 7065 7469 7469 6f6e 3a0d 0a20 2020 2020  petition:..     
-00001430: 2020 2020 2020 2020 2020 206e 6565 6473             needs
-00001440: 5f72 6570 6574 6974 696f 6e20 3d20 4661  _repetition = Fa
-00001450: 6c73 650d 0a20 2020 2020 2020 2020 2020  lse..           
-00001460: 2020 2020 2063 6c20 3d20 6c69 7374 2873       cl = list(s
-00001470: 6e6f 6465 2e63 6869 6c64 7265 6e29 0d0a  node.children)..
-00001480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001490: 6966 206c 656e 2863 6c29 203d 3d20 303a  if len(cl) == 0:
-000014a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000014b0: 2020 2020 2020 2320 4e6f 2043 6869 6c64        # No Child
-000014c0: 7265 6e3f 2052 656d 6f76 650d 0a20 2020  ren? Remove..   
-000014d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000014e0: 2061 6d6f 756e 7420 3d20 310d 0a20 2020   amount = 1..   
-000014f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001500: 2073 6e6f 6465 2e72 656d 6f76 655f 6e6f   snode.remove_no
-00001510: 6465 2829 0d0a 2020 2020 2020 2020 2020  de()..          
-00001520: 2020 2020 2020 656c 6966 206c 656e 2863        elif len(c
-00001530: 6c29 203d 3d20 313a 0d0a 2020 2020 2020  l) == 1:..      
-00001540: 2020 2020 2020 2020 2020 2020 2020 676e                gn
-00001550: 6f64 6520 3d20 636c 5b30 5d0d 0a20 2020  ode = cl[0]..   
-00001560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001570: 2069 6620 676e 6f64 6520 6973 206e 6f74   if gnode is not
-00001580: 204e 6f6e 6520 616e 6420 676e 6f64 652e   None and gnode.
-00001590: 7479 7065 203d 3d20 2267 726f 7570 223a  type == "group":
-000015a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000015b0: 2020 2020 2020 2020 2020 666f 7220 6e20            for n 
-000015c0: 696e 206c 6973 7428 676e 6f64 652e 6368  in list(gnode.ch
-000015d0: 696c 6472 656e 293a 0d0a 2020 2020 2020  ildren):..      
-000015e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000015f0: 2020 2020 2020 676e 6f64 652e 696e 7365        gnode.inse
-00001600: 7274 5f73 6962 6c69 6e67 286e 290d 0a20  rt_sibling(n).. 
-00001610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001620: 2020 2020 2020 2067 6e6f 6465 2e72 656d         gnode.rem
-00001630: 6f76 655f 6e6f 6465 2829 2020 2320 5265  ove_node()  # Re
-00001640: 6d6f 7669 6e67 2067 726f 7570 2f66 696c  moving group/fil
-00001650: 6520 6e6f 6465 2e0d 0a20 2020 2020 2020  e node...       
-00001660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001670: 206e 6565 6473 5f72 6570 6574 6974 696f   needs_repetitio
-00001680: 6e20 3d20 5472 7565 0d0a 2020 2020 2020  n = True..      
-00001690: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
-000016a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000016b0: 2020 2020 2066 6f72 206e 2069 6e20 636c       for n in cl
-000016c0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-000016d0: 2020 2020 2020 2020 2020 2069 6620 6e20             if n 
-000016e0: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
-000016f0: 6e2e 7479 7065 203d 3d20 2267 726f 7570  n.type == "group
-00001700: 223a 0d0a 2020 2020 2020 2020 2020 2020  ":..            
+00000310: 554e 4954 535f 5045 525f 494e 4348 2c20  UNITS_PER_INCH, 
+00000320: 4c65 6e67 7468 0d0a 6672 6f6d 206d 6565  Length..from mee
+00000330: 726b 3430 742e 6b65 726e 656c 2069 6d70  rk40t.kernel imp
+00000340: 6f72 7420 436f 6d6d 616e 6453 796e 7461  ort CommandSynta
+00000350: 7845 7272 6f72 0d0a 6672 6f6d 206d 6565  xError..from mee
+00000360: 726b 3430 742e 7376 6765 6c65 6d65 6e74  rk40t.svgelement
+00000370: 7320 696d 706f 7274 204d 6174 7269 782c  s import Matrix,
+00000380: 2050 6f69 6e74 0d0a 0d0a 6672 6f6d 202e   Point....from .
+00000390: 656c 656d 656e 745f 7479 7065 7320 696d  element_types im
+000003a0: 706f 7274 202a 0d0a 0d0a 0d0a 6465 6620  port *......def 
+000003b0: 706c 7567 696e 286b 6572 6e65 6c2c 206c  plugin(kernel, l
+000003c0: 6966 6563 7963 6c65 3d4e 6f6e 6529 3a0d  ifecycle=None):.
+000003d0: 0a20 2020 205f 203d 206b 6572 6e65 6c2e  .    _ = kernel.
+000003e0: 7472 616e 736c 6174 696f 6e0d 0a20 2020  translation..   
+000003f0: 2069 6620 6c69 6665 6379 636c 6520 3d3d   if lifecycle ==
+00000400: 2022 706f 7374 626f 6f74 223a 0d0a 2020   "postboot":..  
+00000410: 2020 2020 2020 696e 6974 5f74 7265 6528        init_tree(
+00000420: 6b65 726e 656c 290d 0a0d 0a0d 0a64 6566  kernel)......def
+00000430: 2069 6e69 745f 7472 6565 286b 6572 6e65   init_tree(kerne
+00000440: 6c29 3a0d 0a20 2020 2073 656c 6620 3d20  l):..    self = 
+00000450: 6b65 726e 656c 2e65 6c65 6d65 6e74 730d  kernel.elements.
+00000460: 0a0d 0a20 2020 2074 7265 655f 6f70 6572  ...    tree_oper
+00000470: 6174 696f 6e20 3d20 6765 745f 7472 6565  ation = get_tree
+00000480: 5f6f 7065 7261 7469 6f6e 2873 656c 6629  _operation(self)
+00000490: 0d0a 0d0a 2020 2020 5f20 3d20 6b65 726e  ....    _ = kern
+000004a0: 656c 2e74 7261 6e73 6c61 7469 6f6e 0d0a  el.translation..
+000004b0: 0d0a 2020 2020 2320 2d2d 2d2d 2d2d 2d2d  ..    # --------
+000004c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000004d0: 2d2d 2d20 5452 4545 204f 5045 5241 5449  --- TREE OPERATI
+000004e0: 4f4e 5320 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ONS ------------
+000004f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0d  ---------------.
+00000500: 0a0d 0a20 2020 2064 6566 2069 735f 7265  ...    def is_re
+00000510: 676d 6172 6b28 6e6f 6465 293a 0d0a 2020  gmark(node):..  
+00000520: 2020 2020 2020 7265 7375 6c74 203d 2046        result = F
+00000530: 616c 7365 0d0a 2020 2020 2020 2020 7472  alse..        tr
+00000540: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
+00000550: 6966 206e 6f64 652e 5f70 6172 656e 742e  if node._parent.
+00000560: 7479 7065 203d 3d20 2262 7261 6e63 6820  type == "branch 
+00000570: 7265 6722 3a0d 0a20 2020 2020 2020 2020  reg":..         
+00000580: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
+00000590: 5472 7565 0d0a 2020 2020 2020 2020 6578  True..        ex
+000005a0: 6365 7074 2041 7474 7269 6275 7465 4572  cept AttributeEr
+000005b0: 726f 723a 0d0a 2020 2020 2020 2020 2020  ror:..          
+000005c0: 2020 7061 7373 0d0a 2020 2020 2020 2020    pass..        
+000005d0: 7265 7475 726e 2072 6573 756c 740d 0a0d  return result...
+000005e0: 0a20 2020 2064 6566 2068 6173 5f63 6861  .    def has_cha
+000005f0: 6e67 6573 286e 6f64 6529 3a0d 0a20 2020  nges(node):..   
+00000600: 2020 2020 2072 6573 756c 7420 3d20 4661       result = Fa
+00000610: 6c73 650d 0a20 2020 2020 2020 2074 7279  lse..        try
+00000620: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
+00000630: 6620 6e6f 7420 6e6f 6465 2e6d 6174 7269  f not node.matri
+00000640: 782e 6973 5f69 6465 6e74 6974 7928 293a  x.is_identity():
+00000650: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00000660: 2020 7265 7375 6c74 203d 2054 7275 650d    result = True.
+00000670: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+00000680: 4174 7472 6962 7574 6545 7272 6f72 3a0d  AttributeError:.
+00000690: 0a20 2020 2020 2020 2020 2020 2023 2054  .            # T
+000006a0: 6865 7265 2077 6173 2061 6e20 6572 726f  here was an erro
+000006b0: 7220 6475 7269 6e67 2063 6865 636b 2066  r during check f
+000006c0: 6f72 206d 6174 7269 782e 6973 5f69 6465  or matrix.is_ide
+000006d0: 6e74 6974 790d 0a20 2020 2020 2020 2020  ntity..         
+000006e0: 2020 2070 6173 730d 0a20 2020 2020 2020     pass..       
+000006f0: 2072 6574 7572 6e20 7265 7375 6c74 0d0a   return result..
+00000700: 0d0a 2020 2020 4074 7265 655f 7365 7061  ..    @tree_sepa
+00000710: 7261 746f 725f 6166 7465 7228 290d 0a20  rator_after().. 
+00000720: 2020 2040 7472 6565 5f63 6f6e 6469 7469     @tree_conditi
+00000730: 6f6e 616c 286c 616d 6264 6120 6e6f 6465  onal(lambda node
+00000740: 3a20 6c65 6e28 6c69 7374 2873 656c 662e  : len(list(self.
+00000750: 6f70 7328 7365 6c65 6374 6564 3d54 7275  ops(selected=Tru
+00000760: 6529 2929 203d 3d20 3129 0d0a 2020 2020  e))) == 1)..    
+00000770: 4074 7265 655f 6f70 6572 6174 696f 6e28  @tree_operation(
+00000780: 5f28 224f 7065 7261 7469 6f6e 2070 726f  _("Operation pro
+00000790: 7065 7274 6965 7322 292c 206e 6f64 655f  perties"), node_
+000007a0: 7479 7065 3d6f 705f 6e6f 6465 732c 2068  type=op_nodes, h
+000007b0: 656c 703d 2222 290d 0a20 2020 2064 6566  elp="")..    def
+000007c0: 206f 7065 7261 7469 6f6e 5f70 726f 7065   operation_prope
+000007d0: 7274 7928 6e6f 6465 2c20 2a2a 6b77 6172  rty(node, **kwar
+000007e0: 6773 293a 0d0a 2020 2020 2020 2020 6163  gs):..        ac
+000007f0: 7469 7661 7465 203d 2073 656c 662e 6b65  tivate = self.ke
+00000800: 726e 656c 2e6c 6f6f 6b75 7028 2266 756e  rnel.lookup("fun
+00000810: 6374 696f 6e2f 6f70 656e 5f70 726f 7065  ction/open_prope
+00000820: 7274 795f 7769 6e64 6f77 5f66 6f72 5f6e  rty_window_for_n
+00000830: 6f64 6522 290d 0a20 2020 2020 2020 2069  ode")..        i
+00000840: 6620 6163 7469 7661 7465 2069 7320 6e6f  f activate is no
+00000850: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
+00000860: 2020 2020 2061 6374 6976 6174 6528 6e6f       activate(no
+00000870: 6465 290d 0a0d 0a20 2020 2040 7472 6565  de)....    @tree
+00000880: 5f73 6570 6172 6174 6f72 5f61 6674 6572  _separator_after
+00000890: 2829 0d0a 2020 2020 4074 7265 655f 6f70  ()..    @tree_op
+000008a0: 6572 6174 696f 6e28 5f28 2245 6469 7422  eration(_("Edit"
+000008b0: 292c 206e 6f64 655f 7479 7065 3d22 7574  ), node_type="ut
+000008c0: 696c 2063 6f6e 736f 6c65 222c 2068 656c  il console", hel
+000008d0: 703d 2222 290d 0a20 2020 2064 6566 2065  p="")..    def e
+000008e0: 6469 745f 636f 6e73 6f6c 655f 636f 6d6d  dit_console_comm
+000008f0: 616e 6428 6e6f 6465 2c20 2a2a 6b77 6172  and(node, **kwar
+00000900: 6773 293a 0d0a 2020 2020 2020 2020 6163  gs):..        ac
+00000910: 7469 7661 7465 203d 2073 656c 662e 6b65  tivate = self.ke
+00000920: 726e 656c 2e6c 6f6f 6b75 7028 2266 756e  rnel.lookup("fun
+00000930: 6374 696f 6e2f 6f70 656e 5f70 726f 7065  ction/open_prope
+00000940: 7274 795f 7769 6e64 6f77 5f66 6f72 5f6e  rty_window_for_n
+00000950: 6f64 6522 290d 0a20 2020 2020 2020 2069  ode")..        i
+00000960: 6620 6163 7469 7661 7465 2069 7320 6e6f  f activate is no
+00000970: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
+00000980: 2020 2020 2061 6374 6976 6174 6528 6e6f       activate(no
+00000990: 6465 290d 0a0d 0a20 2020 2040 7472 6565  de)....    @tree
+000009a0: 5f73 6570 6172 6174 6f72 5f61 6674 6572  _separator_after
+000009b0: 2829 0d0a 2020 2020 4074 7265 655f 6f70  ()..    @tree_op
+000009c0: 6572 6174 696f 6e28 0d0a 2020 2020 2020  eration(..      
+000009d0: 2020 5f28 2245 6c65 6d65 6e74 2070 726f    _("Element pro
+000009e0: 7065 7274 6965 7322 292c 0d0a 2020 2020  perties"),..    
+000009f0: 2020 2020 6e6f 6465 5f74 7970 653d 280d      node_type=(.
+00000a00: 0a20 2020 2020 2020 2020 2020 2022 656c  .            "el
+00000a10: 656d 2065 6c6c 6970 7365 222c 0d0a 2020  em ellipse",..  
+00000a20: 2020 2020 2020 2020 2020 2265 6c65 6d20            "elem 
+00000a30: 7061 7468 222c 0d0a 2020 2020 2020 2020  path",..        
+00000a40: 2020 2020 2265 6c65 6d20 706f 696e 7422      "elem point"
+00000a50: 2c0d 0a20 2020 2020 2020 2020 2020 2022  ,..            "
+00000a60: 656c 656d 2070 6f6c 796c 696e 6522 2c0d  elem polyline",.
+00000a70: 0a20 2020 2020 2020 2020 2020 2022 656c  .            "el
+00000a80: 656d 2072 6563 7422 2c0d 0a20 2020 2020  em rect",..     
+00000a90: 2020 2020 2020 2022 656c 656d 206c 696e         "elem lin
+00000aa0: 6522 2c0d 0a20 2020 2020 2020 2029 2c0d  e",..        ),.
+00000ab0: 0a20 2020 2020 2020 2068 656c 703d 2222  .        help=""
+00000ac0: 2c0d 0a20 2020 2029 0d0a 2020 2020 6465  ,..    )..    de
+00000ad0: 6620 7061 7468 5f70 726f 7065 7274 7928  f path_property(
+00000ae0: 6e6f 6465 2c20 2a2a 6b77 6172 6773 293a  node, **kwargs):
+00000af0: 0d0a 2020 2020 2020 2020 6163 7469 7661  ..        activa
+00000b00: 7465 203d 2073 656c 662e 6b65 726e 656c  te = self.kernel
+00000b10: 2e6c 6f6f 6b75 7028 2266 756e 6374 696f  .lookup("functio
+00000b20: 6e2f 6f70 656e 5f70 726f 7065 7274 795f  n/open_property_
+00000b30: 7769 6e64 6f77 5f66 6f72 5f6e 6f64 6522  window_for_node"
+00000b40: 290d 0a20 2020 2020 2020 2069 6620 6163  )..        if ac
+00000b50: 7469 7661 7465 2069 7320 6e6f 7420 4e6f  tivate is not No
+00000b60: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
+00000b70: 2061 6374 6976 6174 6528 6e6f 6465 290d   activate(node).
+00000b80: 0a0d 0a20 2020 2040 7472 6565 5f73 6570  ...    @tree_sep
+00000b90: 6172 6174 6f72 5f61 6674 6572 2829 0d0a  arator_after()..
+00000ba0: 2020 2020 4074 7265 655f 6f70 6572 6174      @tree_operat
+00000bb0: 696f 6e28 5f28 2247 726f 7570 2070 726f  ion(_("Group pro
+00000bc0: 7065 7274 6965 7322 292c 206e 6f64 655f  perties"), node_
+00000bd0: 7479 7065 3d22 6772 6f75 7022 2c20 6865  type="group", he
+00000be0: 6c70 3d22 2229 0d0a 2020 2020 6465 6620  lp="")..    def 
+00000bf0: 6772 6f75 705f 7072 6f70 6572 7479 286e  group_property(n
+00000c00: 6f64 652c 202a 2a6b 7761 7267 7329 3a0d  ode, **kwargs):.
+00000c10: 0a20 2020 2020 2020 2061 6374 6976 6174  .        activat
+00000c20: 6520 3d20 7365 6c66 2e6b 6572 6e65 6c2e  e = self.kernel.
+00000c30: 6c6f 6f6b 7570 2822 6675 6e63 7469 6f6e  lookup("function
+00000c40: 2f6f 7065 6e5f 7072 6f70 6572 7479 5f77  /open_property_w
+00000c50: 696e 646f 775f 666f 725f 6e6f 6465 2229  indow_for_node")
+00000c60: 0d0a 2020 2020 2020 2020 6966 2061 6374  ..        if act
+00000c70: 6976 6174 6520 6973 206e 6f74 204e 6f6e  ivate is not Non
+00000c80: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00000c90: 6163 7469 7661 7465 286e 6f64 6529 0d0a  activate(node)..
+00000ca0: 0d0a 2020 2020 4074 7265 655f 7365 7061  ..    @tree_sepa
+00000cb0: 7261 746f 725f 6166 7465 7228 290d 0a20  rator_after().. 
+00000cc0: 2020 2040 7472 6565 5f6f 7065 7261 7469     @tree_operati
+00000cd0: 6f6e 285f 2822 5465 7874 2070 726f 7065  on(_("Text prope
+00000ce0: 7274 6965 7322 292c 206e 6f64 655f 7479  rties"), node_ty
+00000cf0: 7065 3d22 656c 656d 2074 6578 7422 2c20  pe="elem text", 
+00000d00: 6865 6c70 3d22 2229 0d0a 2020 2020 6465  help="")..    de
+00000d10: 6620 7465 7874 5f70 726f 7065 7274 7928  f text_property(
+00000d20: 6e6f 6465 2c20 2a2a 6b77 6172 6773 293a  node, **kwargs):
+00000d30: 0d0a 2020 2020 2020 2020 6163 7469 7661  ..        activa
+00000d40: 7465 203d 2073 656c 662e 6b65 726e 656c  te = self.kernel
+00000d50: 2e6c 6f6f 6b75 7028 2266 756e 6374 696f  .lookup("functio
+00000d60: 6e2f 6f70 656e 5f70 726f 7065 7274 795f  n/open_property_
+00000d70: 7769 6e64 6f77 5f66 6f72 5f6e 6f64 6522  window_for_node"
+00000d80: 290d 0a20 2020 2020 2020 2069 6620 6163  )..        if ac
+00000d90: 7469 7661 7465 2069 7320 6e6f 7420 4e6f  tivate is not No
+00000da0: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
+00000db0: 2061 6374 6976 6174 6528 6e6f 6465 290d   activate(node).
+00000dc0: 0a0d 0a20 2020 2040 7472 6565 5f73 6570  ...    @tree_sep
+00000dd0: 6172 6174 6f72 5f61 6674 6572 2829 0d0a  arator_after()..
+00000de0: 2020 2020 4074 7265 655f 6f70 6572 6174      @tree_operat
+00000df0: 696f 6e28 5f28 2249 6d61 6765 2070 726f  ion(_("Image pro
+00000e00: 7065 7274 6965 7322 292c 206e 6f64 655f  perties"), node_
+00000e10: 7479 7065 3d22 656c 656d 2069 6d61 6765  type="elem image
+00000e20: 222c 2068 656c 703d 2222 290d 0a20 2020  ", help="")..   
+00000e30: 2064 6566 2069 6d61 6765 5f70 726f 7065   def image_prope
+00000e40: 7274 7928 6e6f 6465 2c20 2a2a 6b77 6172  rty(node, **kwar
+00000e50: 6773 293a 0d0a 2020 2020 2020 2020 6163  gs):..        ac
+00000e60: 7469 7661 7465 203d 2073 656c 662e 6b65  tivate = self.ke
+00000e70: 726e 656c 2e6c 6f6f 6b75 7028 2266 756e  rnel.lookup("fun
+00000e80: 6374 696f 6e2f 6f70 656e 5f70 726f 7065  ction/open_prope
+00000e90: 7274 795f 7769 6e64 6f77 5f66 6f72 5f6e  rty_window_for_n
+00000ea0: 6f64 6522 290d 0a20 2020 2020 2020 2069  ode")..        i
+00000eb0: 6620 6163 7469 7661 7465 2069 7320 6e6f  f activate is no
+00000ec0: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
+00000ed0: 2020 2020 2061 6374 6976 6174 6528 6e6f       activate(no
+00000ee0: 6465 290d 0a0d 0a20 2020 2040 7472 6565  de)....    @tree
+00000ef0: 5f63 6f6e 6469 7469 6f6e 616c 286c 616d  _conditional(lam
+00000f00: 6264 6120 6e6f 6465 3a20 6e6f 7420 6973  bda node: not is
+00000f10: 5f72 6567 6d61 726b 286e 6f64 6529 290d  _regmark(node)).
+00000f20: 0a20 2020 2040 7472 6565 5f6f 7065 7261  .    @tree_opera
+00000f30: 7469 6f6e 285f 2822 556e 6772 6f75 7020  tion(_("Ungroup 
+00000f40: 656c 656d 656e 7473 2229 2c20 6e6f 6465  elements"), node
+00000f50: 5f74 7970 653d 2822 6772 6f75 7022 2c20  _type=("group", 
+00000f60: 2266 696c 6522 292c 2068 656c 703d 2222  "file"), help=""
+00000f70: 290d 0a20 2020 2064 6566 2075 6e67 726f  )..    def ungro
+00000f80: 7570 5f65 6c65 6d65 6e74 7328 6e6f 6465  up_elements(node
+00000f90: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
+00000fa0: 2020 2020 2020 746f 5f74 7265 6174 203d        to_treat =
+00000fb0: 205b 5d0d 0a20 2020 2020 2020 2066 6f72   []..        for
+00000fc0: 2067 6e6f 6465 2069 6e20 7365 6c66 2e66   gnode in self.f
+00000fd0: 6c61 7428 7365 6c65 6374 6564 3d54 7275  lat(selected=Tru
+00000fe0: 652c 2063 6173 6361 6465 3d46 616c 7365  e, cascade=False
+00000ff0: 2c20 7479 7065 733d 2822 6772 6f75 7022  , types=("group"
+00001000: 2c20 2266 696c 6522 2929 3a0d 0a20 2020  , "file")):..   
+00001010: 2020 2020 2020 2020 2065 6e6f 6465 203d           enode =
+00001020: 2067 6e6f 6465 0d0a 2020 2020 2020 2020   gnode..        
+00001030: 2020 2020 7768 696c 6520 5472 7565 3a0d      while True:.
+00001040: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00001050: 2069 6620 656e 6f64 652e 7061 7265 6e74   if enode.parent
+00001060: 2069 7320 4e6f 6e65 206f 7220 656e 6f64   is None or enod
+00001070: 652e 7061 7265 6e74 2069 7320 7365 6c66  e.parent is self
+00001080: 2e65 6c65 6d5f 6272 616e 6368 3a0d 0a20  .elem_branch:.. 
+00001090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000010a0: 2020 2069 6620 656e 6f64 6520 6e6f 7420     if enode not 
+000010b0: 696e 2074 6f5f 7472 6561 743a 0d0a 2020  in to_treat:..  
+000010c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000010d0: 2020 2020 2020 746f 5f74 7265 6174 2e61        to_treat.a
+000010e0: 7070 656e 6428 656e 6f64 6529 0d0a 2020  ppend(enode)..  
+000010f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001100: 2020 6272 6561 6b0d 0a20 2020 2020 2020    break..       
+00001110: 2020 2020 2020 2020 2069 6620 656e 6f64           if enod
+00001120: 652e 7061 7265 6e74 2e73 656c 6563 7465  e.parent.selecte
+00001130: 643a 0d0a 2020 2020 2020 2020 2020 2020  d:..            
+00001140: 2020 2020 2020 2020 656e 6f64 6520 3d20          enode = 
+00001150: 656e 6f64 652e 7061 7265 6e74 0d0a 2020  enode.parent..  
+00001160: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00001170: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+00001180: 2020 2020 2020 2020 2069 6620 656e 6f64           if enod
+00001190: 6520 6e6f 7420 696e 2074 6f5f 7472 6561  e not in to_trea
+000011a0: 743a 0d0a 2020 2020 2020 2020 2020 2020  t:..            
+000011b0: 2020 2020 2020 2020 2020 2020 746f 5f74              to_t
+000011c0: 7265 6174 2e61 7070 656e 6428 656e 6f64  reat.append(enod
+000011d0: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
+000011e0: 2020 2020 2020 2020 6272 6561 6b0d 0a0d          break...
+000011f0: 0a20 2020 2020 2020 2066 6f72 2067 6e6f  .        for gno
+00001200: 6465 2069 6e20 746f 5f74 7265 6174 3a0d  de in to_treat:.
+00001210: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+00001220: 206e 2069 6e20 6c69 7374 2867 6e6f 6465   n in list(gnode
+00001230: 2e63 6869 6c64 7265 6e29 3a0d 0a20 2020  .children):..   
+00001240: 2020 2020 2020 2020 2020 2020 2067 6e6f               gno
+00001250: 6465 2e69 6e73 6572 745f 7369 626c 696e  de.insert_siblin
+00001260: 6728 6e29 0d0a 2020 2020 2020 2020 2020  g(n)..          
+00001270: 2020 676e 6f64 652e 7265 6d6f 7665 5f6e    gnode.remove_n
+00001280: 6f64 6528 2920 2023 2052 656d 6f76 696e  ode()  # Removin
+00001290: 6720 6772 6f75 702f 6669 6c65 206e 6f64  g group/file nod
+000012a0: 652e 0d0a 0d0a 2020 2020 4074 7265 655f  e.....    @tree_
+000012b0: 636f 6e64 6974 696f 6e61 6c28 6c61 6d62  conditional(lamb
+000012c0: 6461 206e 6f64 653a 206e 6f74 2069 735f  da node: not is_
+000012d0: 7265 676d 6172 6b28 6e6f 6465 2929 0d0a  regmark(node))..
+000012e0: 2020 2020 4074 7265 655f 6f70 6572 6174      @tree_operat
+000012f0: 696f 6e28 0d0a 2020 2020 2020 2020 5f28  ion(..        _(
+00001300: 2253 696d 706c 6966 7920 6772 6f75 7022  "Simplify group"
+00001310: 292c 0d0a 2020 2020 2020 2020 6e6f 6465  ),..        node
+00001320: 5f74 7970 653d 2822 6772 6f75 7022 2c20  _type=("group", 
+00001330: 2266 696c 6522 292c 0d0a 2020 2020 2020  "file"),..      
+00001340: 2020 6865 6c70 3d5f 2822 556e 6c65 7665    help=_("Unleve
+00001350: 6c20 6772 6f75 7073 2069 6620 7468 6579  l groups if they
+00001360: 206a 7573 7420 636f 6e74 6169 6e20 616e   just contain an
+00001370: 6f74 6865 7220 6772 6f75 7022 292c 0d0a  other group"),..
+00001380: 2020 2020 290d 0a20 2020 2064 6566 2073      )..    def s
+00001390: 696d 706c 6966 795f 6772 6f75 7073 286e  implify_groups(n
+000013a0: 6f64 652c 202a 2a6b 7761 7267 7329 3a0d  ode, **kwargs):.
+000013b0: 0a20 2020 2020 2020 2064 6566 2073 7472  .        def str
+000013c0: 6169 6768 7465 6e28 736e 6f64 6529 3a0d  aighten(snode):.
+000013d0: 0a20 2020 2020 2020 2020 2020 2061 6d6f  .            amo
+000013e0: 756e 7420 3d20 300d 0a20 2020 2020 2020  unt = 0..       
+000013f0: 2020 2020 206e 6565 6473 5f72 6570 6574       needs_repet
+00001400: 6974 696f 6e20 3d20 5472 7565 0d0a 2020  ition = True..  
+00001410: 2020 2020 2020 2020 2020 7768 696c 6520            while 
+00001420: 6e65 6564 735f 7265 7065 7469 7469 6f6e  needs_repetition
+00001430: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00001440: 2020 206e 6565 6473 5f72 6570 6574 6974     needs_repetit
+00001450: 696f 6e20 3d20 4661 6c73 650d 0a20 2020  ion = False..   
+00001460: 2020 2020 2020 2020 2020 2020 2063 6c20               cl 
+00001470: 3d20 6c69 7374 2873 6e6f 6465 2e63 6869  = list(snode.chi
+00001480: 6c64 7265 6e29 0d0a 2020 2020 2020 2020  ldren)..        
+00001490: 2020 2020 2020 2020 6966 206c 656e 2863          if len(c
+000014a0: 6c29 203d 3d20 303a 0d0a 2020 2020 2020  l) == 0:..      
+000014b0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+000014c0: 4e6f 2043 6869 6c64 7265 6e3f 2052 656d  No Children? Rem
+000014d0: 6f76 650d 0a20 2020 2020 2020 2020 2020  ove..           
+000014e0: 2020 2020 2020 2020 2061 6d6f 756e 7420           amount 
+000014f0: 3d20 310d 0a20 2020 2020 2020 2020 2020  = 1..           
+00001500: 2020 2020 2020 2020 2073 6e6f 6465 2e72           snode.r
+00001510: 656d 6f76 655f 6e6f 6465 2829 0d0a 2020  emove_node()..  
+00001520: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00001530: 6966 206c 656e 2863 6c29 203d 3d20 313a  if len(cl) == 1:
+00001540: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00001550: 2020 2020 2020 676e 6f64 6520 3d20 636c        gnode = cl
+00001560: 5b30 5d0d 0a20 2020 2020 2020 2020 2020  [0]..           
+00001570: 2020 2020 2020 2020 2069 6620 676e 6f64           if gnod
+00001580: 6520 6973 206e 6f74 204e 6f6e 6520 616e  e is not None an
+00001590: 6420 676e 6f64 652e 7479 7065 203d 3d20  d gnode.type == 
+000015a0: 2267 726f 7570 223a 0d0a 2020 2020 2020  "group":..      
+000015b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000015c0: 2020 666f 7220 6e20 696e 206c 6973 7428    for n in list(
+000015d0: 676e 6f64 652e 6368 696c 6472 656e 293a  gnode.children):
+000015e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000015f0: 2020 2020 2020 2020 2020 2020 2020 676e                gn
+00001600: 6f64 652e 696e 7365 7274 5f73 6962 6c69  ode.insert_sibli
+00001610: 6e67 286e 290d 0a20 2020 2020 2020 2020  ng(n)..         
+00001620: 2020 2020 2020 2020 2020 2020 2020 2067                 g
+00001630: 6e6f 6465 2e72 656d 6f76 655f 6e6f 6465  node.remove_node
+00001640: 2829 2020 2320 5265 6d6f 7669 6e67 2067  ()  # Removing g
+00001650: 726f 7570 2f66 696c 6520 6e6f 6465 2e0d  roup/file node..
+00001660: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00001670: 2020 2020 2020 2020 206e 6565 6473 5f72           needs_r
+00001680: 6570 6574 6974 696f 6e20 3d20 5472 7565  epetition = True
+00001690: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000016a0: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+000016b0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+000016c0: 206e 2069 6e20 636c 3a0d 0a20 2020 2020   n in cl:..     
+000016d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000016e0: 2020 2069 6620 6e20 6973 206e 6f74 204e     if n is not N
+000016f0: 6f6e 6520 616e 6420 6e2e 7479 7065 203d  one and n.type =
+00001700: 3d20 2267 726f 7570 223a 0d0a 2020 2020  = "group":..    
 00001710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001720: 666e 6420 3d20 7374 7261 6967 6874 656e  fnd = straighten
-00001730: 286e 290d 0a20 2020 2020 2020 2020 2020  (n)..           
+00001720: 2020 2020 2020 2020 666e 6420 3d20 7374          fnd = st
+00001730: 7261 6967 6874 656e 286e 290d 0a20 2020  raighten(n)..   
 00001740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001750: 2061 6d6f 756e 7420 2b3d 2066 6e64 0d0a   amount += fnd..
-00001760: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00001770: 726e 2061 6d6f 756e 740d 0a0d 0a20 2020  rn amount....   
-00001780: 2020 2020 2072 6573 203d 2073 7472 6169       res = strai
-00001790: 6768 7465 6e28 6e6f 6465 290d 0a20 2020  ghten(node)..   
-000017a0: 2020 2020 2069 6620 7265 7320 3e20 303a       if res > 0:
-000017b0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-000017c0: 6c66 2e73 6967 6e61 6c28 2272 6562 7569  lf.signal("rebui
-000017d0: 6c64 5f74 7265 6522 290d 0a0d 0a20 2020  ld_tree")....   
-000017e0: 2040 7472 6565 5f63 6f6e 6469 7469 6f6e   @tree_condition
-000017f0: 616c 286c 616d 6264 6120 6e6f 6465 3a20  al(lambda node: 
-00001800: 6c65 6e28 6c69 7374 2873 656c 662e 656c  len(list(self.el
-00001810: 656d 7328 656d 7068 6173 697a 6564 3d54  ems(emphasized=T
-00001820: 7275 6529 2929 203e 2030 290d 0a20 2020  rue))) > 0)..   
-00001830: 2040 7472 6565 5f6f 7065 7261 7469 6f6e   @tree_operation
-00001840: 280d 0a20 2020 2020 2020 205f 2822 456c  (..        _("El
-00001850: 656d 656e 7473 2069 6e20 7363 656e 652e  ements in scene.
-00001860: 2e2e 2229 2c20 6e6f 6465 5f74 7970 653d  .."), node_type=
-00001870: 656c 656d 5f6e 6f64 6573 2c20 6865 6c70  elem_nodes, help
-00001880: 3d22 222c 2065 6e61 626c 653d 4661 6c73  ="", enable=Fals
-00001890: 650d 0a20 2020 2029 0d0a 2020 2020 6465  e..    )..    de
-000018a0: 6620 656c 656d 656e 745f 6c61 6265 6c28  f element_label(
-000018b0: 6e6f 6465 2c20 2a2a 6b77 6172 6773 293a  node, **kwargs):
-000018c0: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-000018d0: 0d0a 0d0a 2020 2020 4074 7265 655f 636f  ....    @tree_co
-000018e0: 6e64 6974 696f 6e61 6c28 6c61 6d62 6461  nditional(lambda
-000018f0: 206e 6f64 653a 206e 6f74 2069 735f 7265   node: not is_re
-00001900: 676d 6172 6b28 6e6f 6465 2929 0d0a 2020  gmark(node))..  
-00001910: 2020 4074 7265 655f 636f 6e64 6974 696f    @tree_conditio
-00001920: 6e61 6c28 6c61 6d62 6461 206e 6f64 653a  nal(lambda node:
-00001930: 206c 656e 286c 6973 7428 7365 6c66 2e65   len(list(self.e
-00001940: 6c65 6d73 2865 6d70 6861 7369 7a65 643d  lems(emphasized=
-00001950: 5472 7565 2929 2920 3e20 3129 0d0a 2020  True))) > 1)..  
-00001960: 2020 4074 7265 655f 6f70 6572 6174 696f    @tree_operatio
-00001970: 6e28 5f28 2247 726f 7570 2065 6c65 6d65  n(_("Group eleme
-00001980: 6e74 7322 292c 206e 6f64 655f 7479 7065  nts"), node_type
-00001990: 3d65 6c65 6d5f 6e6f 6465 732c 2068 656c  =elem_nodes, hel
-000019a0: 703d 2222 290d 0a20 2020 2064 6566 2067  p="")..    def g
-000019b0: 726f 7570 5f65 6c65 6d65 6e74 7328 6e6f  roup_elements(no
-000019c0: 6465 2c20 2a2a 6b77 6172 6773 293a 0d0a  de, **kwargs):..
-000019d0: 2020 2020 2020 2020 6772 6f75 705f 6e6f          group_no
-000019e0: 6465 203d 206e 6f64 652e 7061 7265 6e74  de = node.parent
-000019f0: 2e61 6464 2874 7970 653d 2267 726f 7570  .add(type="group
-00001a00: 222c 206c 6162 656c 3d22 4772 6f75 7022  ", label="Group"
-00001a10: 290d 0a20 2020 2020 2020 2066 6f72 2065  )..        for e
-00001a20: 2069 6e20 6c69 7374 2873 656c 662e 656c   in list(self.el
-00001a30: 656d 7328 656d 7068 6173 697a 6564 3d54  ems(emphasized=T
-00001a40: 7275 6529 293a 0d0a 2020 2020 2020 2020  rue)):..        
-00001a50: 2020 2020 6772 6f75 705f 6e6f 6465 2e61      group_node.a
-00001a60: 7070 656e 645f 6368 696c 6428 6529 0d0a  ppend_child(e)..
-00001a70: 0d0a 2020 2020 4074 7265 655f 636f 6e64  ..    @tree_cond
-00001a80: 6974 696f 6e61 6c28 0d0a 2020 2020 2020  itional(..      
-00001a90: 2020 6c61 6d62 6461 2063 6f6e 643a 206c    lambda cond: l
-00001aa0: 656e 286c 6973 7428 7365 6c66 2e66 6c61  en(list(self.fla
-00001ab0: 7428 7365 6c65 6374 6564 3d54 7275 652c  t(selected=True,
-00001ac0: 2063 6173 6361 6465 3d46 616c 7365 2c20   cascade=False, 
-00001ad0: 7479 7065 733d 6f70 5f6e 6f64 6573 2929  types=op_nodes))
-00001ae0: 290d 0a20 2020 2020 2020 203e 3d20 310d  )..        >= 1.
-00001af0: 0a20 2020 2029 0d0a 2020 2020 4074 7265  .    )..    @tre
-00001b00: 655f 6f70 6572 6174 696f 6e28 0d0a 2020  e_operation(..  
-00001b10: 2020 2020 2020 5f28 2252 656d 6f76 6520        _("Remove 
-00001b20: 616c 6c20 6974 656d 7320 6672 6f6d 206f  all items from o
-00001b30: 7065 7261 7469 6f6e 2229 2c20 6e6f 6465  peration"), node
-00001b40: 5f74 7970 653d 6f70 5f70 6172 656e 745f  _type=op_parent_
-00001b50: 6e6f 6465 732c 2068 656c 703d 2222 0d0a  nodes, help=""..
-00001b60: 2020 2020 290d 0a20 2020 2064 6566 2063      )..    def c
-00001b70: 6c65 6172 5f61 6c6c 5f6f 705f 656e 7472  lear_all_op_entr
-00001b80: 6965 7328 6e6f 6465 2c20 2a2a 6b77 6172  ies(node, **kwar
-00001b90: 6773 293a 0d0a 2020 2020 2020 2020 7769  gs):..        wi
-00001ba0: 7468 2073 656c 662e 7374 6174 6963 2822  th self.static("
-00001bb0: 636c 6561 725f 616c 6c5f 6f70 2229 3a0d  clear_all_op"):.
-00001bc0: 0a20 2020 2020 2020 2020 2020 2064 6174  .            dat
-00001bd0: 6120 3d20 6c69 7374 2829 0d0a 2020 2020  a = list()..    
-00001be0: 2020 2020 2020 2020 7265 6d6f 7665 6420          removed 
-00001bf0: 3d20 4661 6c73 650d 0a20 2020 2020 2020  = False..       
-00001c00: 2020 2020 2066 6f72 2069 7465 6d20 696e       for item in
-00001c10: 206c 6973 7428 7365 6c66 2e66 6c61 7428   list(self.flat(
-00001c20: 7365 6c65 6374 6564 3d54 7275 652c 2063  selected=True, c
-00001c30: 6173 6361 6465 3d46 616c 7365 2c20 7479  ascade=False, ty
-00001c40: 7065 733d 6f70 5f6e 6f64 6573 2929 3a0d  pes=op_nodes)):.
-00001c50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00001c60: 2064 6174 612e 6170 7065 6e64 2869 7465   data.append(ite
-00001c70: 6d29 0d0a 2020 2020 2020 2020 2020 2020  m)..            
-00001c80: 666f 7220 6974 656d 2069 6e20 6461 7461  for item in data
-00001c90: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00001ca0: 2020 2072 656d 6f76 6564 203d 2054 7275     removed = Tru
-00001cb0: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
-00001cc0: 2020 2069 7465 6d2e 7265 6d6f 7665 5f61     item.remove_a
-00001cd0: 6c6c 5f63 6869 6c64 7265 6e28 290d 0a0d  ll_children()...
-00001ce0: 0a20 2020 2040 7472 6565 5f63 6f6e 6469  .    @tree_condi
-00001cf0: 7469 6f6e 616c 286c 616d 6264 6120 6e6f  tional(lambda no
-00001d00: 6465 3a20 6861 7361 7474 7228 6e6f 6465  de: hasattr(node
-00001d10: 2c20 226f 7574 7075 7422 2929 0d0a 2020  , "output"))..  
-00001d20: 2020 4074 7265 655f 6f70 6572 6174 696f    @tree_operatio
-00001d30: 6e28 5f28 2245 6e61 626c 652f 4469 7361  n(_("Enable/Disa
-00001d40: 626c 6520 6f70 7322 292c 206e 6f64 655f  ble ops"), node_
-00001d50: 7479 7065 3d6f 705f 6e6f 6465 732c 2068  type=op_nodes, h
-00001d60: 656c 703d 2222 290d 0a20 2020 2064 6566  elp="")..    def
-00001d70: 2074 6f67 676c 655f 6e5f 6f70 6572 6174   toggle_n_operat
-00001d80: 696f 6e73 286e 6f64 652c 202a 2a6b 7761  ions(node, **kwa
-00001d90: 7267 7329 3a0d 0a20 2020 2020 2020 2063  rgs):..        c
-00001da0: 6861 6e67 6573 203d 205b 5d0d 0a20 2020  hanges = []..   
-00001db0: 2020 2020 2066 6f72 206e 2069 6e20 7365       for n in se
-00001dc0: 6c66 2e6f 7073 2873 656c 6563 7465 643d  lf.ops(selected=
-00001dd0: 5472 7565 293a 0d0a 2020 2020 2020 2020  True):..        
-00001de0: 2020 2020 6966 2068 6173 6174 7472 286e      if hasattr(n
-00001df0: 2c20 226f 7574 7075 7422 293a 0d0a 2020  , "output"):..  
-00001e00: 2020 2020 2020 2020 2020 2020 2020 7472                tr
-00001e10: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
-00001e20: 2020 2020 2020 2020 6e2e 6f75 7470 7574          n.output
-00001e30: 203d 206e 6f74 206e 2e6f 7574 7075 740d   = not n.output.
-00001e40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00001e50: 2020 2020 206e 2e75 7064 6174 6564 2829       n.updated()
-00001e60: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00001e70: 2020 2020 2020 6368 616e 6765 732e 6170        changes.ap
-00001e80: 7065 6e64 286e 290d 0a20 2020 2020 2020  pend(n)..       
-00001e90: 2020 2020 2020 2020 2065 7863 6570 7420           except 
-00001ea0: 4174 7472 6962 7574 6545 7272 6f72 3a0d  AttributeError:.
-00001eb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00001ec0: 2020 2020 2070 6173 730d 0a20 2020 2020       pass..     
-00001ed0: 2020 2069 6620 6c65 6e28 6368 616e 6765     if len(change
-00001ee0: 7329 203e 2030 3a0d 0a20 2020 2020 2020  s) > 0:..       
-00001ef0: 2020 2020 2073 656c 662e 7661 6c69 6461       self.valida
-00001f00: 7465 5f73 656c 6563 7465 645f 6172 6561  te_selected_area
-00001f10: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
-00001f20: 7365 6c66 2e73 6967 6e61 6c28 2265 6c65  self.signal("ele
-00001f30: 6d65 6e74 5f70 726f 7065 7274 795f 7570  ment_property_up
-00001f40: 6461 7465 222c 2063 6861 6e67 6573 290d  date", changes).
-00001f50: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00001f60: 662e 7369 676e 616c 2822 7265 6672 6573  f.signal("refres
-00001f70: 685f 7363 656e 6522 2c20 2253 6365 6e65  h_scene", "Scene
-00001f80: 2229 0d0a 0d0a 2020 2020 4074 7265 655f  ")....    @tree_
-00001f90: 636f 6e64 6974 696f 6e61 6c28 0d0a 2020  conditional(..  
-00001fa0: 2020 2020 2020 6c61 6d62 6461 206e 6f64        lambda nod
-00001fb0: 653a 2068 6173 6174 7472 286e 6f64 652c  e: hasattr(node,
-00001fc0: 2022 6f75 7470 7574 2229 0d0a 2020 2020   "output")..    
-00001fd0: 2020 2020 616e 6420 6861 7361 7474 7228      and hasattr(
-00001fe0: 6e6f 6465 2c20 2269 735f 7669 7369 626c  node, "is_visibl
-00001ff0: 6522 290d 0a20 2020 2020 2020 2061 6e64  e")..        and
-00002000: 206e 6f74 2067 6574 6174 7472 286e 6f64   not getattr(nod
-00002010: 652c 2022 6f75 7470 7574 222c 2054 7275  e, "output", Tru
-00002020: 6529 0d0a 2020 2020 290d 0a20 2020 2040  e)..    )..    @
-00002030: 7472 6565 5f6f 7065 7261 7469 6f6e 285f  tree_operation(_
-00002040: 2822 5368 6f77 2f48 6964 6520 636f 6e74  ("Show/Hide cont
-00002050: 6169 6e65 6420 656c 656d 656e 7473 2229  ained elements")
-00002060: 2c20 6e6f 6465 5f74 7970 653d 6f70 5f6e  , node_type=op_n
-00002070: 6f64 6573 2c20 6865 6c70 3d22 2229 0d0a  odes, help="")..
-00002080: 2020 2020 6465 6620 746f 6767 6c65 5f6f      def toggle_o
-00002090: 705f 656c 656d 5f76 6973 6962 696c 6974  p_elem_visibilit
-000020a0: 7928 6e6f 6465 2c20 2a2a 6b77 6172 6773  y(node, **kwargs
-000020b0: 293a 0d0a 2020 2020 2020 2020 6368 616e  ):..        chan
-000020c0: 6765 7320 3d20 5b5d 0d0a 2020 2020 2020  ges = []..      
-000020d0: 2020 666f 7220 6e20 696e 2073 656c 662e    for n in self.
-000020e0: 6f70 7328 7365 6c65 6374 6564 3d54 7275  ops(selected=Tru
-000020f0: 6529 3a0d 0a20 2020 2020 2020 2020 2020  e):..           
-00002100: 2069 6620 6861 7361 7474 7228 6e2c 2022   if hasattr(n, "
-00002110: 6f75 7470 7574 2229 2061 6e64 2068 6173  output") and has
-00002120: 6174 7472 286e 2c20 2269 735f 7669 7369  attr(n, "is_visi
-00002130: 626c 6522 293a 0d0a 2020 2020 2020 2020  ble"):..        
-00002140: 2020 2020 2020 2020 6e65 7766 6c61 6720          newflag 
-00002150: 3d20 5472 7565 0d0a 2020 2020 2020 2020  = True..        
-00002160: 2020 2020 2020 2020 6966 206e 2e6f 7574          if n.out
-00002170: 7075 7420 6973 206e 6f74 204e 6f6e 653a  put is not None:
-00002180: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00002190: 2020 2020 2020 6966 206e 6f74 206e 2e6f        if not n.o
-000021a0: 7574 7075 743a 0d0a 2020 2020 2020 2020  utput:..        
+00001750: 2020 2020 2020 2020 2061 6d6f 756e 7420           amount 
+00001760: 2b3d 2066 6e64 0d0a 2020 2020 2020 2020  += fnd..        
+00001770: 2020 2020 7265 7475 726e 2061 6d6f 756e      return amoun
+00001780: 740d 0a0d 0a20 2020 2020 2020 2072 6573  t....        res
+00001790: 203d 2073 7472 6169 6768 7465 6e28 6e6f   = straighten(no
+000017a0: 6465 290d 0a20 2020 2020 2020 2069 6620  de)..        if 
+000017b0: 7265 7320 3e20 303a 0d0a 2020 2020 2020  res > 0:..      
+000017c0: 2020 2020 2020 7365 6c66 2e73 6967 6e61        self.signa
+000017d0: 6c28 2272 6562 7569 6c64 5f74 7265 6522  l("rebuild_tree"
+000017e0: 290d 0a0d 0a20 2020 2040 7472 6565 5f63  )....    @tree_c
+000017f0: 6f6e 6469 7469 6f6e 616c 286c 616d 6264  onditional(lambd
+00001800: 6120 6e6f 6465 3a20 6c65 6e28 6c69 7374  a node: len(list
+00001810: 2873 656c 662e 656c 656d 7328 656d 7068  (self.elems(emph
+00001820: 6173 697a 6564 3d54 7275 6529 2929 203e  asized=True))) >
+00001830: 2030 290d 0a20 2020 2040 7472 6565 5f6f   0)..    @tree_o
+00001840: 7065 7261 7469 6f6e 280d 0a20 2020 2020  peration(..     
+00001850: 2020 205f 2822 456c 656d 656e 7473 2069     _("Elements i
+00001860: 6e20 7363 656e 652e 2e2e 2229 2c20 6e6f  n scene..."), no
+00001870: 6465 5f74 7970 653d 656c 656d 5f6e 6f64  de_type=elem_nod
+00001880: 6573 2c20 6865 6c70 3d22 222c 2065 6e61  es, help="", ena
+00001890: 626c 653d 4661 6c73 650d 0a20 2020 2029  ble=False..    )
+000018a0: 0d0a 2020 2020 6465 6620 656c 656d 656e  ..    def elemen
+000018b0: 745f 6c61 6265 6c28 6e6f 6465 2c20 2a2a  t_label(node, **
+000018c0: 6b77 6172 6773 293a 0d0a 2020 2020 2020  kwargs):..      
+000018d0: 2020 7265 7475 726e 0d0a 0d0a 2020 2020    return....    
+000018e0: 4074 7265 655f 636f 6e64 6974 696f 6e61  @tree_conditiona
+000018f0: 6c28 6c61 6d62 6461 206e 6f64 653a 206e  l(lambda node: n
+00001900: 6f74 2069 735f 7265 676d 6172 6b28 6e6f  ot is_regmark(no
+00001910: 6465 2929 0d0a 2020 2020 4074 7265 655f  de))..    @tree_
+00001920: 636f 6e64 6974 696f 6e61 6c28 6c61 6d62  conditional(lamb
+00001930: 6461 206e 6f64 653a 206c 656e 286c 6973  da node: len(lis
+00001940: 7428 7365 6c66 2e65 6c65 6d73 2865 6d70  t(self.elems(emp
+00001950: 6861 7369 7a65 643d 5472 7565 2929 2920  hasized=True))) 
+00001960: 3e20 3129 0d0a 2020 2020 4074 7265 655f  > 1)..    @tree_
+00001970: 6f70 6572 6174 696f 6e28 5f28 2247 726f  operation(_("Gro
+00001980: 7570 2065 6c65 6d65 6e74 7322 292c 206e  up elements"), n
+00001990: 6f64 655f 7479 7065 3d65 6c65 6d5f 6e6f  ode_type=elem_no
+000019a0: 6465 732c 2068 656c 703d 2222 290d 0a20  des, help="").. 
+000019b0: 2020 2064 6566 2067 726f 7570 5f65 6c65     def group_ele
+000019c0: 6d65 6e74 7328 6e6f 6465 2c20 2a2a 6b77  ments(node, **kw
+000019d0: 6172 6773 293a 0d0a 2020 2020 2020 2020  args):..        
+000019e0: 6772 6f75 705f 6e6f 6465 203d 206e 6f64  group_node = nod
+000019f0: 652e 7061 7265 6e74 2e61 6464 2874 7970  e.parent.add(typ
+00001a00: 653d 2267 726f 7570 222c 206c 6162 656c  e="group", label
+00001a10: 3d22 4772 6f75 7022 290d 0a20 2020 2020  ="Group")..     
+00001a20: 2020 2066 6f72 2065 2069 6e20 6c69 7374     for e in list
+00001a30: 2873 656c 662e 656c 656d 7328 656d 7068  (self.elems(emph
+00001a40: 6173 697a 6564 3d54 7275 6529 293a 0d0a  asized=True)):..
+00001a50: 2020 2020 2020 2020 2020 2020 6772 6f75              grou
+00001a60: 705f 6e6f 6465 2e61 7070 656e 645f 6368  p_node.append_ch
+00001a70: 696c 6428 6529 0d0a 0d0a 2020 2020 4074  ild(e)....    @t
+00001a80: 7265 655f 636f 6e64 6974 696f 6e61 6c28  ree_conditional(
+00001a90: 0d0a 2020 2020 2020 2020 6c61 6d62 6461  ..        lambda
+00001aa0: 2063 6f6e 643a 206c 656e 286c 6973 7428   cond: len(list(
+00001ab0: 7365 6c66 2e66 6c61 7428 7365 6c65 6374  self.flat(select
+00001ac0: 6564 3d54 7275 652c 2063 6173 6361 6465  ed=True, cascade
+00001ad0: 3d46 616c 7365 2c20 7479 7065 733d 6f70  =False, types=op
+00001ae0: 5f6e 6f64 6573 2929 290d 0a20 2020 2020  _nodes)))..     
+00001af0: 2020 203e 3d20 310d 0a20 2020 2029 0d0a     >= 1..    )..
+00001b00: 2020 2020 4074 7265 655f 6f70 6572 6174      @tree_operat
+00001b10: 696f 6e28 0d0a 2020 2020 2020 2020 5f28  ion(..        _(
+00001b20: 2252 656d 6f76 6520 616c 6c20 6974 656d  "Remove all item
+00001b30: 7320 6672 6f6d 206f 7065 7261 7469 6f6e  s from operation
+00001b40: 2229 2c20 6e6f 6465 5f74 7970 653d 6f70  "), node_type=op
+00001b50: 5f70 6172 656e 745f 6e6f 6465 732c 2068  _parent_nodes, h
+00001b60: 656c 703d 2222 0d0a 2020 2020 290d 0a20  elp=""..    ).. 
+00001b70: 2020 2064 6566 2063 6c65 6172 5f61 6c6c     def clear_all
+00001b80: 5f6f 705f 656e 7472 6965 7328 6e6f 6465  _op_entries(node
+00001b90: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
+00001ba0: 2020 2020 2020 7769 7468 2073 656c 662e        with self.
+00001bb0: 7374 6174 6963 2822 636c 6561 725f 616c  static("clear_al
+00001bc0: 6c5f 6f70 2229 3a0d 0a20 2020 2020 2020  l_op"):..       
+00001bd0: 2020 2020 2064 6174 6120 3d20 6c69 7374       data = list
+00001be0: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
+00001bf0: 7265 6d6f 7665 6420 3d20 4661 6c73 650d  removed = False.
+00001c00: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+00001c10: 2069 7465 6d20 696e 206c 6973 7428 7365   item in list(se
+00001c20: 6c66 2e66 6c61 7428 7365 6c65 6374 6564  lf.flat(selected
+00001c30: 3d54 7275 652c 2063 6173 6361 6465 3d46  =True, cascade=F
+00001c40: 616c 7365 2c20 7479 7065 733d 6f70 5f6e  alse, types=op_n
+00001c50: 6f64 6573 2929 3a0d 0a20 2020 2020 2020  odes)):..       
+00001c60: 2020 2020 2020 2020 2064 6174 612e 6170           data.ap
+00001c70: 7065 6e64 2869 7465 6d29 0d0a 2020 2020  pend(item)..    
+00001c80: 2020 2020 2020 2020 666f 7220 6974 656d          for item
+00001c90: 2069 6e20 6461 7461 3a0d 0a20 2020 2020   in data:..     
+00001ca0: 2020 2020 2020 2020 2020 2072 656d 6f76             remov
+00001cb0: 6564 203d 2054 7275 650d 0a20 2020 2020  ed = True..     
+00001cc0: 2020 2020 2020 2020 2020 2069 7465 6d2e             item.
+00001cd0: 7265 6d6f 7665 5f61 6c6c 5f63 6869 6c64  remove_all_child
+00001ce0: 7265 6e28 290d 0a0d 0a20 2020 2040 7472  ren()....    @tr
+00001cf0: 6565 5f63 6f6e 6469 7469 6f6e 616c 286c  ee_conditional(l
+00001d00: 616d 6264 6120 6e6f 6465 3a20 6861 7361  ambda node: hasa
+00001d10: 7474 7228 6e6f 6465 2c20 226f 7574 7075  ttr(node, "outpu
+00001d20: 7422 2929 0d0a 2020 2020 4074 7265 655f  t"))..    @tree_
+00001d30: 6f70 6572 6174 696f 6e28 5f28 2245 6e61  operation(_("Ena
+00001d40: 626c 652f 4469 7361 626c 6520 6f70 7322  ble/Disable ops"
+00001d50: 292c 206e 6f64 655f 7479 7065 3d6f 705f  ), node_type=op_
+00001d60: 6e6f 6465 732c 2068 656c 703d 2222 290d  nodes, help="").
+00001d70: 0a20 2020 2064 6566 2074 6f67 676c 655f  .    def toggle_
+00001d80: 6e5f 6f70 6572 6174 696f 6e73 286e 6f64  n_operations(nod
+00001d90: 652c 202a 2a6b 7761 7267 7329 3a0d 0a20  e, **kwargs):.. 
+00001da0: 2020 2020 2020 2063 6861 6e67 6573 203d         changes =
+00001db0: 205b 5d0d 0a20 2020 2020 2020 2066 6f72   []..        for
+00001dc0: 206e 2069 6e20 7365 6c66 2e6f 7073 2873   n in self.ops(s
+00001dd0: 656c 6563 7465 643d 5472 7565 293a 0d0a  elected=True):..
+00001de0: 2020 2020 2020 2020 2020 2020 6966 2068              if h
+00001df0: 6173 6174 7472 286e 2c20 226f 7574 7075  asattr(n, "outpu
+00001e00: 7422 293a 0d0a 2020 2020 2020 2020 2020  t"):..          
+00001e10: 2020 2020 2020 7472 793a 0d0a 2020 2020        try:..    
+00001e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001e30: 6e2e 6f75 7470 7574 203d 206e 6f74 206e  n.output = not n
+00001e40: 2e6f 7574 7075 740d 0a20 2020 2020 2020  .output..       
+00001e50: 2020 2020 2020 2020 2020 2020 206e 2e75               n.u
+00001e60: 7064 6174 6564 2829 0d0a 2020 2020 2020  pdated()..      
+00001e70: 2020 2020 2020 2020 2020 2020 2020 6368                ch
+00001e80: 616e 6765 732e 6170 7065 6e64 286e 290d  anges.append(n).
+00001e90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00001ea0: 2065 7863 6570 7420 4174 7472 6962 7574   except Attribut
+00001eb0: 6545 7272 6f72 3a0d 0a20 2020 2020 2020  eError:..       
+00001ec0: 2020 2020 2020 2020 2020 2020 2070 6173               pas
+00001ed0: 730d 0a20 2020 2020 2020 2069 6620 6c65  s..        if le
+00001ee0: 6e28 6368 616e 6765 7329 203e 2030 3a0d  n(changes) > 0:.
+00001ef0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00001f00: 662e 7661 6c69 6461 7465 5f73 656c 6563  f.validate_selec
+00001f10: 7465 645f 6172 6561 2829 0d0a 2020 2020  ted_area()..    
+00001f20: 2020 2020 2020 2020 7365 6c66 2e73 6967          self.sig
+00001f30: 6e61 6c28 2265 6c65 6d65 6e74 5f70 726f  nal("element_pro
+00001f40: 7065 7274 795f 7570 6461 7465 222c 2063  perty_update", c
+00001f50: 6861 6e67 6573 290d 0a20 2020 2020 2020  hanges)..       
+00001f60: 2020 2020 2073 656c 662e 7369 676e 616c       self.signal
+00001f70: 2822 7265 6672 6573 685f 7363 656e 6522  ("refresh_scene"
+00001f80: 2c20 2253 6365 6e65 2229 0d0a 0d0a 2020  , "Scene")....  
+00001f90: 2020 4074 7265 655f 636f 6e64 6974 696f    @tree_conditio
+00001fa0: 6e61 6c28 0d0a 2020 2020 2020 2020 6c61  nal(..        la
+00001fb0: 6d62 6461 206e 6f64 653a 2068 6173 6174  mbda node: hasat
+00001fc0: 7472 286e 6f64 652c 2022 6f75 7470 7574  tr(node, "output
+00001fd0: 2229 0d0a 2020 2020 2020 2020 616e 6420  ")..        and 
+00001fe0: 6861 7361 7474 7228 6e6f 6465 2c20 2269  hasattr(node, "i
+00001ff0: 735f 7669 7369 626c 6522 290d 0a20 2020  s_visible")..   
+00002000: 2020 2020 2061 6e64 206e 6f74 2067 6574       and not get
+00002010: 6174 7472 286e 6f64 652c 2022 6f75 7470  attr(node, "outp
+00002020: 7574 222c 2054 7275 6529 0d0a 2020 2020  ut", True)..    
+00002030: 290d 0a20 2020 2040 7472 6565 5f6f 7065  )..    @tree_ope
+00002040: 7261 7469 6f6e 285f 2822 5368 6f77 2f48  ration(_("Show/H
+00002050: 6964 6520 636f 6e74 6169 6e65 6420 656c  ide contained el
+00002060: 656d 656e 7473 2229 2c20 6e6f 6465 5f74  ements"), node_t
+00002070: 7970 653d 6f70 5f6e 6f64 6573 2c20 6865  ype=op_nodes, he
+00002080: 6c70 3d22 2229 0d0a 2020 2020 6465 6620  lp="")..    def 
+00002090: 746f 6767 6c65 5f6f 705f 656c 656d 5f76  toggle_op_elem_v
+000020a0: 6973 6962 696c 6974 7928 6e6f 6465 2c20  isibility(node, 
+000020b0: 2a2a 6b77 6172 6773 293a 0d0a 2020 2020  **kwargs):..    
+000020c0: 2020 2020 6368 616e 6765 7320 3d20 5b5d      changes = []
+000020d0: 0d0a 2020 2020 2020 2020 666f 7220 6e20  ..        for n 
+000020e0: 696e 2073 656c 662e 6f70 7328 7365 6c65  in self.ops(sele
+000020f0: 6374 6564 3d54 7275 6529 3a0d 0a20 2020  cted=True):..   
+00002100: 2020 2020 2020 2020 2069 6620 6861 7361           if hasa
+00002110: 7474 7228 6e2c 2022 6f75 7470 7574 2229  ttr(n, "output")
+00002120: 2061 6e64 2068 6173 6174 7472 286e 2c20   and hasattr(n, 
+00002130: 2269 735f 7669 7369 626c 6522 293a 0d0a  "is_visible"):..
+00002140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002150: 6e65 7766 6c61 6720 3d20 5472 7565 0d0a  newflag = True..
+00002160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002170: 6966 206e 2e6f 7574 7075 7420 6973 206e  if n.output is n
+00002180: 6f74 204e 6f6e 653a 0d0a 2020 2020 2020  ot None:..      
+00002190: 2020 2020 2020 2020 2020 2020 2020 6966                if
+000021a0: 206e 6f74 206e 2e6f 7574 7075 743a 0d0a   not n.output:..
 000021b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000021c0: 6e65 7766 6c61 6720 3d20 626f 6f6c 286e  newflag = bool(n
-000021d0: 6f74 206e 2e69 735f 7669 7369 626c 6529  ot n.is_visible)
-000021e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000021f0: 2020 6e2e 6973 5f76 6973 6962 6c65 203d    n.is_visible =
-00002200: 206e 6577 666c 6167 0d0a 2020 2020 2020   newflag..      
-00002210: 2020 2020 2020 2020 2020 6e2e 7570 6461            n.upda
-00002220: 7465 6428 290d 0a20 2020 2020 2020 2020  ted()..         
-00002230: 2020 2020 2020 2063 6861 6e67 6573 2e61         changes.a
-00002240: 7070 656e 6428 6e29 0d0a 2020 2020 2020  ppend(n)..      
-00002250: 2020 6966 206c 656e 2863 6861 6e67 6573    if len(changes
-00002260: 2920 3e20 303a 0d0a 2020 2020 2020 2020  ) > 0:..        
-00002270: 2020 2020 7365 6c66 2e76 616c 6964 6174      self.validat
-00002280: 655f 7365 6c65 6374 6564 5f61 7265 6128  e_selected_area(
-00002290: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
-000022a0: 656c 662e 7369 676e 616c 2822 656c 656d  elf.signal("elem
-000022b0: 656e 745f 7072 6f70 6572 7479 5f75 7064  ent_property_upd
-000022c0: 6174 6522 2c20 6368 616e 6765 7329 0d0a  ate", changes)..
-000022d0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000022e0: 2e73 6967 6e61 6c28 2272 6566 7265 7368  .signal("refresh
-000022f0: 5f73 6365 6e65 222c 2022 5363 656e 6522  _scene", "Scene"
-00002300: 290d 0a0d 0a20 2020 2040 7472 6565 5f63  )....    @tree_c
-00002310: 6f6e 6469 7469 6f6e 616c 286c 616d 6264  onditional(lambd
-00002320: 6120 6e6f 6465 3a20 6861 7361 7474 7228  a node: hasattr(
-00002330: 6e6f 6465 2c20 226f 7574 7075 7422 2929  node, "output"))
-00002340: 0d0a 2020 2020 4074 7265 655f 6f70 6572  ..    @tree_oper
-00002350: 6174 696f 6e28 0d0a 2020 2020 2020 2020  ation(..        
-00002360: 5f28 2245 6e61 626c 6520 7369 6d69 6c61  _("Enable simila
-00002370: 7222 292c 0d0a 2020 2020 2020 2020 6e6f  r"),..        no
-00002380: 6465 5f74 7970 653d 6f70 5f6e 6f64 6573  de_type=op_nodes
-00002390: 2c0d 0a20 2020 2020 2020 2068 656c 703d  ,..        help=
-000023a0: 5f28 2245 6e61 626c 6520 616c 6c20 6f70  _("Enable all op
-000023b0: 6572 6174 696f 6e73 206f 6620 7468 6973  erations of this
-000023c0: 2074 7970 6522 292c 0d0a 2020 2020 290d   type"),..    ).
-000023d0: 0a20 2020 2064 6566 206f 7073 5f65 6e61  .    def ops_ena
-000023e0: 626c 655f 7369 6d69 6c61 7228 6e6f 6465  ble_similar(node
-000023f0: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
-00002400: 2020 2020 2020 6f70 6c69 7374 203d 205b        oplist = [
-00002410: 5d0d 0a20 2020 2020 2020 2066 6f72 206e  ]..        for n
-00002420: 2069 6e20 7365 6c66 2e6f 7073 2829 3a0d   in self.ops():.
-00002430: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00002440: 6e2e 7479 7065 203d 3d20 6e6f 6465 2e74  n.type == node.t
-00002450: 7970 653a 0d0a 2020 2020 2020 2020 2020  ype:..          
-00002460: 2020 2020 2020 6f70 6c69 7374 2e61 7070        oplist.app
-00002470: 656e 6428 6e29 0d0a 2020 2020 2020 2020  end(n)..        
-00002480: 7365 745f 6f70 5f6f 7574 7075 7428 6f70  set_op_output(op
-00002490: 6c69 7374 2c20 5472 7565 290d 0a0d 0a20  list, True).... 
-000024a0: 2020 2040 7472 6565 5f63 6f6e 6469 7469     @tree_conditi
-000024b0: 6f6e 616c 286c 616d 6264 6120 6e6f 6465  onal(lambda node
-000024c0: 3a20 6861 7361 7474 7228 6e6f 6465 2c20  : hasattr(node, 
-000024d0: 226f 7574 7075 7422 2929 0d0a 2020 2020  "output"))..    
-000024e0: 4074 7265 655f 7365 7061 7261 746f 725f  @tree_separator_
-000024f0: 6166 7465 7228 290d 0a20 2020 2040 7472  after()..    @tr
-00002500: 6565 5f6f 7065 7261 7469 6f6e 280d 0a20  ee_operation(.. 
-00002510: 2020 2020 2020 205f 2822 4469 7361 626c         _("Disabl
-00002520: 6520 7369 6d69 6c61 7222 292c 0d0a 2020  e similar"),..  
-00002530: 2020 2020 2020 6e6f 6465 5f74 7970 653d        node_type=
-00002540: 6f70 5f6e 6f64 6573 2c0d 0a20 2020 2020  op_nodes,..     
-00002550: 2020 2068 656c 703d 5f28 2244 6973 6162     help=_("Disab
-00002560: 6c65 2061 6c6c 206f 7065 7261 7469 6f6e  le all operation
-00002570: 7320 6f66 2074 6869 7320 7479 7065 2229  s of this type")
-00002580: 2c0d 0a20 2020 2029 0d0a 2020 2020 6465  ,..    )..    de
-00002590: 6620 6f70 735f 6469 7361 626c 655f 7369  f ops_disable_si
-000025a0: 6d69 6c61 7228 6e6f 6465 2c20 2a2a 6b77  milar(node, **kw
-000025b0: 6172 6773 293a 0d0a 2020 2020 2020 2020  args):..        
-000025c0: 6f70 6c69 7374 203d 205b 5d0d 0a20 2020  oplist = []..   
-000025d0: 2020 2020 2066 6f72 206e 2069 6e20 7365       for n in se
-000025e0: 6c66 2e6f 7073 2829 3a0d 0a20 2020 2020  lf.ops():..     
-000025f0: 2020 2020 2020 2069 6620 6e2e 7479 7065         if n.type
-00002600: 203d 3d20 6e6f 6465 2e74 7970 653a 0d0a   == node.type:..
-00002610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002620: 6f70 6c69 7374 2e61 7070 656e 6428 6e29  oplist.append(n)
-00002630: 0d0a 2020 2020 2020 2020 7365 745f 6f70  ..        set_op
-00002640: 5f6f 7574 7075 7428 6f70 6c69 7374 2c20  _output(oplist, 
-00002650: 4661 6c73 6529 0d0a 0d0a 2020 2020 4074  False)....    @t
-00002660: 7265 655f 7375 626d 656e 7528 5f28 2243  ree_submenu(_("C
-00002670: 6f6e 7665 7274 206f 7065 7261 7469 6f6e  onvert operation
-00002680: 2229 290d 0a20 2020 2040 7472 6565 5f6f  "))..    @tree_o
-00002690: 7065 7261 7469 6f6e 285f 2822 436f 6e76  peration(_("Conv
-000026a0: 6572 7420 746f 2049 6d61 6765 2229 2c20  ert to Image"), 
-000026b0: 6e6f 6465 5f74 7970 653d 6f70 5f70 6172  node_type=op_par
-000026c0: 656e 745f 6e6f 6465 732c 2068 656c 703d  ent_nodes, help=
-000026d0: 2222 290d 0a20 2020 2064 6566 2063 6f6e  "")..    def con
-000026e0: 7665 7274 5f6f 7065 7261 7469 6f6e 5f69  vert_operation_i
-000026f0: 6d61 6765 286e 6f64 652c 202a 2a6b 7761  mage(node, **kwa
-00002700: 7267 7329 3a0d 0a20 2020 2020 2020 2066  rgs):..        f
-00002710: 6f72 206e 2069 6e20 6c69 7374 2873 656c  or n in list(sel
-00002720: 662e 6f70 7328 7365 6c65 6374 6564 3d54  f.ops(selected=T
-00002730: 7275 6529 293a 0d0a 2020 2020 2020 2020  rue)):..        
-00002740: 2020 2020 6e65 775f 7365 7474 696e 6773      new_settings
-00002750: 203d 2064 6963 7428 6e2e 7365 7474 696e   = dict(n.settin
-00002760: 6773 290d 0a20 2020 2020 2020 2020 2020  gs)..           
-00002770: 206e 6577 5f73 6574 7469 6e67 735b 2274   new_settings["t
-00002780: 7970 6522 5d20 3d20 226f 7020 696d 6167  ype"] = "op imag
-00002790: 6522 0d0a 2020 2020 2020 2020 2020 2020  e"..            
-000027a0: 6e2e 7265 706c 6163 655f 6e6f 6465 286b  n.replace_node(k
-000027b0: 6565 705f 6368 696c 6472 656e 3d54 7275  eep_children=Tru
-000027c0: 652c 202a 2a6e 6577 5f73 6574 7469 6e67  e, **new_setting
-000027d0: 7329 0d0a 2020 2020 2020 2020 7365 6c66  s)..        self
-000027e0: 2e73 6967 6e61 6c28 2272 6562 7569 6c64  .signal("rebuild
-000027f0: 5f74 7265 6522 290d 0a0d 0a20 2020 2040  _tree")....    @
-00002800: 7472 6565 5f73 7562 6d65 6e75 285f 2822  tree_submenu(_("
-00002810: 436f 6e76 6572 7420 6f70 6572 6174 696f  Convert operatio
-00002820: 6e22 2929 0d0a 2020 2020 4074 7265 655f  n"))..    @tree_
-00002830: 6f70 6572 6174 696f 6e28 5f28 2243 6f6e  operation(_("Con
-00002840: 7665 7274 2074 6f20 5261 7374 6572 2229  vert to Raster")
-00002850: 2c20 6e6f 6465 5f74 7970 653d 6f70 5f70  , node_type=op_p
-00002860: 6172 656e 745f 6e6f 6465 732c 2068 656c  arent_nodes, hel
-00002870: 703d 2222 290d 0a20 2020 2064 6566 2063  p="")..    def c
-00002880: 6f6e 7665 7274 5f6f 7065 7261 7469 6f6e  onvert_operation
-00002890: 5f72 6173 7465 7228 6e6f 6465 2c20 2a2a  _raster(node, **
-000028a0: 6b77 6172 6773 293a 0d0a 2020 2020 2020  kwargs):..      
-000028b0: 2020 666f 7220 6e20 696e 206c 6973 7428    for n in list(
-000028c0: 7365 6c66 2e6f 7073 2873 656c 6563 7465  self.ops(selecte
-000028d0: 643d 5472 7565 2929 3a0d 0a20 2020 2020  d=True)):..     
-000028e0: 2020 2020 2020 206e 6577 5f73 6574 7469         new_setti
-000028f0: 6e67 7320 3d20 6469 6374 286e 2e73 6574  ngs = dict(n.set
-00002900: 7469 6e67 7329 0d0a 2020 2020 2020 2020  tings)..        
-00002910: 2020 2020 6e65 775f 7365 7474 696e 6773      new_settings
-00002920: 5b22 7479 7065 225d 203d 2022 6f70 2072  ["type"] = "op r
-00002930: 6173 7465 7222 0d0a 2020 2020 2020 2020  aster"..        
-00002940: 2020 2020 6e2e 7265 706c 6163 655f 6e6f      n.replace_no
-00002950: 6465 286b 6565 705f 6368 696c 6472 656e  de(keep_children
-00002960: 3d54 7275 652c 202a 2a6e 6577 5f73 6574  =True, **new_set
-00002970: 7469 6e67 7329 0d0a 2020 2020 2020 2020  tings)..        
-00002980: 7365 6c66 2e73 6967 6e61 6c28 2272 6562  self.signal("reb
-00002990: 7569 6c64 5f74 7265 6522 290d 0a0d 0a20  uild_tree").... 
-000029a0: 2020 2040 7472 6565 5f73 7562 6d65 6e75     @tree_submenu
-000029b0: 285f 2822 436f 6e76 6572 7420 6f70 6572  (_("Convert oper
-000029c0: 6174 696f 6e22 2929 0d0a 2020 2020 4074  ation"))..    @t
-000029d0: 7265 655f 6f70 6572 6174 696f 6e28 5f28  ree_operation(_(
-000029e0: 2243 6f6e 7665 7274 2074 6f20 456e 6772  "Convert to Engr
-000029f0: 6176 6522 292c 206e 6f64 655f 7479 7065  ave"), node_type
-00002a00: 3d6f 705f 7061 7265 6e74 5f6e 6f64 6573  =op_parent_nodes
-00002a10: 2c20 6865 6c70 3d22 2229 0d0a 2020 2020  , help="")..    
-00002a20: 6465 6620 636f 6e76 6572 745f 6f70 6572  def convert_oper
-00002a30: 6174 696f 6e5f 656e 6772 6176 6528 6e6f  ation_engrave(no
-00002a40: 6465 2c20 2a2a 6b77 6172 6773 293a 0d0a  de, **kwargs):..
-00002a50: 2020 2020 2020 2020 666f 7220 6e20 696e          for n in
-00002a60: 206c 6973 7428 7365 6c66 2e6f 7073 2873   list(self.ops(s
-00002a70: 656c 6563 7465 643d 5472 7565 2929 3a0d  elected=True)):.
-00002a80: 0a20 2020 2020 2020 2020 2020 206e 6577  .            new
-00002a90: 5f73 6574 7469 6e67 7320 3d20 6469 6374  _settings = dict
-00002aa0: 286e 2e73 6574 7469 6e67 7329 0d0a 2020  (n.settings)..  
-00002ab0: 2020 2020 2020 2020 2020 6e65 775f 7365            new_se
-00002ac0: 7474 696e 6773 5b22 7479 7065 225d 203d  ttings["type"] =
-00002ad0: 2022 6f70 2065 6e67 7261 7665 220d 0a20   "op engrave".. 
-00002ae0: 2020 2020 2020 2020 2020 206e 2e72 6570             n.rep
-00002af0: 6c61 6365 5f6e 6f64 6528 6b65 6570 5f63  lace_node(keep_c
-00002b00: 6869 6c64 7265 6e3d 5472 7565 2c20 2a2a  hildren=True, **
-00002b10: 6e65 775f 7365 7474 696e 6773 290d 0a20  new_settings).. 
-00002b20: 2020 2020 2020 2073 656c 662e 7369 676e         self.sign
-00002b30: 616c 2822 7265 6275 696c 645f 7472 6565  al("rebuild_tree
-00002b40: 2229 0d0a 0d0a 2020 2020 4074 7265 655f  ")....    @tree_
-00002b50: 7375 626d 656e 7528 5f28 2243 6f6e 7665  submenu(_("Conve
-00002b60: 7274 206f 7065 7261 7469 6f6e 2229 290d  rt operation")).
-00002b70: 0a20 2020 2040 7472 6565 5f6f 7065 7261  .    @tree_opera
-00002b80: 7469 6f6e 285f 2822 436f 6e76 6572 7420  tion(_("Convert 
-00002b90: 746f 2043 7574 2229 2c20 6e6f 6465 5f74  to Cut"), node_t
-00002ba0: 7970 653d 6f70 5f70 6172 656e 745f 6e6f  ype=op_parent_no
-00002bb0: 6465 732c 2068 656c 703d 2222 290d 0a20  des, help="").. 
-00002bc0: 2020 2064 6566 2063 6f6e 7665 7274 5f6f     def convert_o
-00002bd0: 7065 7261 7469 6f6e 5f63 7574 286e 6f64  peration_cut(nod
-00002be0: 652c 202a 2a6b 7761 7267 7329 3a0d 0a20  e, **kwargs):.. 
-00002bf0: 2020 2020 2020 2066 6f72 206e 2069 6e20         for n in 
-00002c00: 6c69 7374 2873 656c 662e 6f70 7328 7365  list(self.ops(se
-00002c10: 6c65 6374 6564 3d54 7275 6529 293a 0d0a  lected=True)):..
-00002c20: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
-00002c30: 7365 7474 696e 6773 203d 2064 6963 7428  settings = dict(
-00002c40: 6e2e 7365 7474 696e 6773 290d 0a20 2020  n.settings)..   
-00002c50: 2020 2020 2020 2020 206e 6577 5f73 6574           new_set
-00002c60: 7469 6e67 735b 2274 7970 6522 5d20 3d20  tings["type"] = 
-00002c70: 226f 7020 6375 7422 0d0a 2020 2020 2020  "op cut"..      
-00002c80: 2020 2020 2020 6e2e 7265 706c 6163 655f        n.replace_
-00002c90: 6e6f 6465 286b 6565 705f 6368 696c 6472  node(keep_childr
-00002ca0: 656e 3d54 7275 652c 202a 2a6e 6577 5f73  en=True, **new_s
-00002cb0: 6574 7469 6e67 7329 0d0a 2020 2020 2020  ettings)..      
-00002cc0: 2020 7365 6c66 2e73 6967 6e61 6c28 2272    self.signal("r
-00002cd0: 6562 7569 6c64 5f74 7265 6522 290d 0a0d  ebuild_tree")...
-00002ce0: 0a20 2020 2040 7472 6565 5f73 7562 6d65  .    @tree_subme
-00002cf0: 6e75 285f 2822 436f 6e76 6572 7420 6f70  nu(_("Convert op
-00002d00: 6572 6174 696f 6e22 2929 0d0a 2020 2020  eration"))..    
-00002d10: 4074 7265 655f 6f70 6572 6174 696f 6e28  @tree_operation(
-00002d20: 5f28 2243 6f6e 7665 7274 2074 6f20 4861  _("Convert to Ha
-00002d30: 7463 6822 292c 206e 6f64 655f 7479 7065  tch"), node_type
-00002d40: 3d6f 705f 7061 7265 6e74 5f6e 6f64 6573  =op_parent_nodes
-00002d50: 2c20 6865 6c70 3d22 2229 0d0a 2020 2020  , help="")..    
-00002d60: 6465 6620 636f 6e76 6572 745f 6f70 6572  def convert_oper
-00002d70: 6174 696f 6e5f 6861 7463 6828 6e6f 6465  ation_hatch(node
-00002d80: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
-00002d90: 2020 2020 2020 666f 7220 6e20 696e 206c        for n in l
-00002da0: 6973 7428 7365 6c66 2e6f 7073 2873 656c  ist(self.ops(sel
-00002db0: 6563 7465 643d 5472 7565 2929 3a0d 0a20  ected=True)):.. 
-00002dc0: 2020 2020 2020 2020 2020 206e 6577 5f73             new_s
-00002dd0: 6574 7469 6e67 7320 3d20 6469 6374 286e  ettings = dict(n
-00002de0: 2e73 6574 7469 6e67 7329 0d0a 2020 2020  .settings)..    
-00002df0: 2020 2020 2020 2020 6e65 775f 7365 7474          new_sett
-00002e00: 696e 6773 5b22 7479 7065 225d 203d 2022  ings["type"] = "
-00002e10: 6f70 2068 6174 6368 220d 0a20 2020 2020  op hatch"..     
-00002e20: 2020 2020 2020 206e 2e72 6570 6c61 6365         n.replace
-00002e30: 5f6e 6f64 6528 6b65 6570 5f63 6869 6c64  _node(keep_child
-00002e40: 7265 6e3d 5472 7565 2c20 2a2a 6e65 775f  ren=True, **new_
-00002e50: 7365 7474 696e 6773 290d 0a20 2020 2020  settings)..     
-00002e60: 2020 2073 656c 662e 7369 676e 616c 2822     self.signal("
-00002e70: 7265 6275 696c 645f 7472 6565 2229 0d0a  rebuild_tree")..
-00002e80: 0d0a 2020 2020 4074 7265 655f 7375 626d  ..    @tree_subm
-00002e90: 656e 7528 5f28 2243 6f6e 7665 7274 206f  enu(_("Convert o
-00002ea0: 7065 7261 7469 6f6e 2229 290d 0a20 2020  peration"))..   
-00002eb0: 2040 7472 6565 5f6f 7065 7261 7469 6f6e   @tree_operation
-00002ec0: 285f 2822 436f 6e76 6572 7420 746f 2044  (_("Convert to D
-00002ed0: 6f74 7322 292c 206e 6f64 655f 7479 7065  ots"), node_type
-00002ee0: 3d6f 705f 7061 7265 6e74 5f6e 6f64 6573  =op_parent_nodes
-00002ef0: 2c20 6865 6c70 3d22 2229 0d0a 2020 2020  , help="")..    
-00002f00: 6465 6620 636f 6e76 6572 745f 6f70 6572  def convert_oper
-00002f10: 6174 696f 6e5f 646f 7473 286e 6f64 652c  ation_dots(node,
-00002f20: 202a 2a6b 7761 7267 7329 3a0d 0a20 2020   **kwargs):..   
-00002f30: 2020 2020 2066 6f72 206e 2069 6e20 6c69       for n in li
-00002f40: 7374 2873 656c 662e 6f70 7328 7365 6c65  st(self.ops(sele
-00002f50: 6374 6564 3d54 7275 6529 293a 0d0a 2020  cted=True)):..  
-00002f60: 2020 2020 2020 2020 2020 6e65 775f 7365            new_se
-00002f70: 7474 696e 6773 203d 2064 6963 7428 6e2e  ttings = dict(n.
-00002f80: 7365 7474 696e 6773 290d 0a20 2020 2020  settings)..     
-00002f90: 2020 2020 2020 206e 6577 5f73 6574 7469         new_setti
-00002fa0: 6e67 735b 2274 7970 6522 5d20 3d20 226f  ngs["type"] = "o
-00002fb0: 7020 646f 7473 220d 0a20 2020 2020 2020  p dots"..       
-00002fc0: 2020 2020 206e 2e72 6570 6c61 6365 5f6e       n.replace_n
-00002fd0: 6f64 6528 6b65 6570 5f63 6869 6c64 7265  ode(keep_childre
-00002fe0: 6e3d 5472 7565 2c20 2a2a 6e65 775f 7365  n=True, **new_se
-00002ff0: 7474 696e 6773 290d 0a20 2020 2020 2020  ttings)..       
-00003000: 2073 656c 662e 7369 676e 616c 2822 7265   self.signal("re
-00003010: 6275 696c 645f 7472 6565 2229 0d0a 0d0a  build_tree")....
-00003020: 2020 2020 4074 7265 655f 7375 626d 656e      @tree_submen
-00003030: 7528 5f28 2252 6173 7465 7257 697a 6172  u(_("RasterWizar
-00003040: 6422 2929 0d0a 2020 2020 4074 7265 655f  d"))..    @tree_
-00003050: 6f70 6572 6174 696f 6e28 5f28 2253 6574  operation(_("Set
-00003060: 2074 6f20 4e6f 6e65 2229 2c20 6e6f 6465   to None"), node
-00003070: 5f74 7970 653d 2265 6c65 6d20 696d 6167  _type="elem imag
-00003080: 6522 2c20 6865 6c70 3d22 2229 0d0a 2020  e", help="")..  
-00003090: 2020 6465 6620 696d 6167 655f 7261 7374    def image_rast
-000030a0: 6572 7769 7a61 7264 5f61 7070 6c79 5f6e  erwizard_apply_n
-000030b0: 6f6e 6528 6e6f 6465 2c20 2a2a 6b77 6172  one(node, **kwar
-000030c0: 6773 293a 0d0a 2020 2020 2020 2020 6669  gs):..        fi
-000030d0: 7273 746e 6f64 6520 3d20 4e6f 6e65 0d0a  rstnode = None..
-000030e0: 2020 2020 2020 2020 666f 7220 6520 696e          for e in
-000030f0: 206c 6973 7428 7365 6c66 2e65 6c65 6d73   list(self.elems
-00003100: 2865 6d70 6861 7369 7a65 643d 5472 7565  (emphasized=True
-00003110: 2929 3a0d 0a20 2020 2020 2020 2020 2020  )):..           
-00003120: 2069 6620 652e 7479 7065 2021 3d20 2265   if e.type != "e
-00003130: 6c65 6d20 696d 6167 6522 3a0d 0a20 2020  lem image":..   
-00003140: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-00003150: 7469 6e75 650d 0a20 2020 2020 2020 2020  tinue..         
-00003160: 2020 2065 2e6f 7065 7261 7469 6f6e 7320     e.operations 
-00003170: 3d20 5b5d 0d0a 2020 2020 2020 2020 2020  = []..          
-00003180: 2020 652e 7570 6461 7465 284e 6f6e 6529    e.update(None)
-00003190: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-000031a0: 2066 6972 7374 6e6f 6465 2069 7320 4e6f   firstnode is No
-000031b0: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
-000031c0: 2020 2020 2066 6972 7374 6e6f 6465 203d       firstnode =
-000031d0: 2065 0d0a 2020 2020 2020 2020 7365 6c66   e..        self
-000031e0: 2e73 6967 6e61 6c28 2272 6566 7265 7368  .signal("refresh
-000031f0: 5f73 6365 6e65 222c 2022 5363 656e 6522  _scene", "Scene"
-00003200: 290d 0a20 2020 2020 2020 2061 6374 6976  )..        activ
-00003210: 6174 6520 3d20 7365 6c66 2e6b 6572 6e65  ate = self.kerne
-00003220: 6c2e 6c6f 6f6b 7570 2822 6675 6e63 7469  l.lookup("functi
-00003230: 6f6e 2f6f 7065 6e5f 7072 6f70 6572 7479  on/open_property
-00003240: 5f77 696e 646f 775f 666f 725f 6e6f 6465  _window_for_node
-00003250: 2229 0d0a 2020 2020 2020 2020 6966 2061  ")..        if a
-00003260: 6374 6976 6174 6520 6973 206e 6f74 204e  ctivate is not N
-00003270: 6f6e 6520 616e 6420 6669 7273 746e 6f64  one and firstnod
-00003280: 6520 6973 206e 6f74 204e 6f6e 653a 0d0a  e is not None:..
-00003290: 2020 2020 2020 2020 2020 2020 6163 7469              acti
-000032a0: 7661 7465 2866 6972 7374 6e6f 6465 290d  vate(firstnode).
-000032b0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-000032c0: 662e 7369 676e 616c 2822 7072 6f70 7570  f.signal("propup
-000032d0: 6461 7465 222c 2066 6972 7374 6e6f 6465  date", firstnode
-000032e0: 290d 0a0d 0a20 2020 2040 7472 6565 5f73  )....    @tree_s
-000032f0: 7562 6d65 6e75 285f 2822 5261 7374 6572  ubmenu(_("Raster
-00003300: 5769 7a61 7264 2229 290d 0a20 2020 2040  Wizard"))..    @
-00003310: 7472 6565 5f76 616c 7565 7328 2273 6372  tree_values("scr
-00003320: 6970 7422 2c20 7661 6c75 6573 3d6c 6973  ipt", values=lis
-00003330: 7428 7365 6c66 2e6d 6174 6368 2822 7261  t(self.match("ra
-00003340: 7374 6572 5f73 6372 6970 7422 2c20 7375  ster_script", su
-00003350: 6666 6978 3d54 7275 6529 2929 0d0a 2020  ffix=True)))..  
-00003360: 2020 4074 7265 655f 6f70 6572 6174 696f    @tree_operatio
-00003370: 6e28 5f28 2241 7070 6c79 3a20 7b73 6372  n(_("Apply: {scr
-00003380: 6970 747d 2229 2c20 6e6f 6465 5f74 7970  ipt}"), node_typ
-00003390: 653d 2265 6c65 6d20 696d 6167 6522 2c20  e="elem image", 
-000033a0: 6865 6c70 3d22 2229 0d0a 2020 2020 6465  help="")..    de
-000033b0: 6620 696d 6167 655f 7261 7374 6572 7769  f image_rasterwi
-000033c0: 7a61 7264 5f61 7070 6c79 286e 6f64 652c  zard_apply(node,
-000033d0: 2073 6372 6970 743d 4e6f 6e65 2c20 2a2a   script=None, **
-000033e0: 6b77 6172 6773 293a 0d0a 2020 2020 2020  kwargs):..      
-000033f0: 2020 7261 7374 6572 5f73 6372 6970 7420    raster_script 
-00003400: 3d20 7365 6c66 2e6c 6f6f 6b75 7028 6622  = self.lookup(f"
-00003410: 7261 7374 6572 5f73 6372 6970 742f 7b73  raster_script/{s
-00003420: 6372 6970 747d 2229 0d0a 2020 2020 2020  cript}")..      
-00003430: 2020 6669 7273 746e 6f64 6520 3d20 4e6f    firstnode = No
-00003440: 6e65 0d0a 2020 2020 2020 2020 666f 7220  ne..        for 
-00003450: 6520 696e 206c 6973 7428 7365 6c66 2e65  e in list(self.e
-00003460: 6c65 6d73 2865 6d70 6861 7369 7a65 643d  lems(emphasized=
-00003470: 5472 7565 2929 3a0d 0a20 2020 2020 2020  True)):..       
-00003480: 2020 2020 2069 6620 652e 7479 7065 2021       if e.type !
-00003490: 3d20 2265 6c65 6d20 696d 6167 6522 3a0d  = "elem image":.
-000034a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000034b0: 2063 6f6e 7469 6e75 650d 0a20 2020 2020   continue..     
-000034c0: 2020 2020 2020 2065 2e6f 7065 7261 7469         e.operati
-000034d0: 6f6e 7320 3d20 7261 7374 6572 5f73 6372  ons = raster_scr
-000034e0: 6970 740d 0a20 2020 2020 2020 2020 2020  ipt..           
-000034f0: 2065 2e75 7064 6174 6528 4e6f 6e65 290d   e.update(None).
-00003500: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00003510: 6669 7273 746e 6f64 6520 6973 204e 6f6e  firstnode is Non
-00003520: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00003530: 2020 2020 6669 7273 746e 6f64 6520 3d20      firstnode = 
-00003540: 650d 0a20 2020 2020 2020 2073 656c 662e  e..        self.
-00003550: 7369 676e 616c 2822 7265 6672 6573 685f  signal("refresh_
-00003560: 7363 656e 6522 2c20 2253 6365 6e65 2229  scene", "Scene")
-00003570: 0d0a 2020 2020 2020 2020 6163 7469 7661  ..        activa
-00003580: 7465 203d 2073 656c 662e 6b65 726e 656c  te = self.kernel
-00003590: 2e6c 6f6f 6b75 7028 2266 756e 6374 696f  .lookup("functio
-000035a0: 6e2f 6f70 656e 5f70 726f 7065 7274 795f  n/open_property_
-000035b0: 7769 6e64 6f77 5f66 6f72 5f6e 6f64 6522  window_for_node"
-000035c0: 290d 0a20 2020 2020 2020 2069 6620 6163  )..        if ac
-000035d0: 7469 7661 7465 2069 7320 6e6f 7420 4e6f  tivate is not No
-000035e0: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
-000035f0: 2061 6374 6976 6174 6528 6e6f 6465 290d   activate(node).
-00003600: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00003610: 662e 7369 676e 616c 2822 7072 6f70 7570  f.signal("propup
-00003620: 6461 7465 222c 206e 6f64 6529 0d0a 0d0a  date", node)....
-00003630: 2020 2020 6465 6620 7261 6469 6f5f 6d61      def radio_ma
-00003640: 7463 685f 7370 6565 6428 6e6f 6465 2c20  tch_speed(node, 
-00003650: 7370 6565 643d 302c 202a 2a6b 7761 7267  speed=0, **kwarg
-00003660: 7329 3a0d 0a20 2020 2020 2020 2072 6574  s):..        ret
-00003670: 7572 6e20 6e6f 6465 2e73 7065 6564 203d  urn node.speed =
-00003680: 3d20 666c 6f61 7428 7370 6565 6429 0d0a  = float(speed)..
-00003690: 0d0a 2020 2020 4074 7265 655f 7375 626d  ..    @tree_subm
-000036a0: 656e 7528 5f28 2253 7065 6564 2066 6f72  enu(_("Speed for
-000036b0: 2052 6173 7465 722d 4f70 6572 6174 696f   Raster-Operatio
-000036c0: 6e22 2929 0d0a 2020 2020 4074 7265 655f  n"))..    @tree_
-000036d0: 7261 6469 6f28 7261 6469 6f5f 6d61 7463  radio(radio_matc
-000036e0: 685f 7370 6565 6429 0d0a 2020 2020 4074  h_speed)..    @t
-000036f0: 7265 655f 7661 6c75 6573 2822 7370 6565  ree_values("spee
-00003700: 6422 2c20 2835 2c20 3130 2c20 3530 2c20  d", (5, 10, 50, 
-00003710: 3735 2c20 3130 302c 2031 3530 2c20 3230  75, 100, 150, 20
-00003720: 302c 2032 3530 2c20 3330 302c 2033 3530  0, 250, 300, 350
-00003730: 2c20 3430 302c 2034 3530 2c20 3530 3029  , 400, 450, 500)
-00003740: 290d 0a20 2020 2040 7472 6565 5f6f 7065  )..    @tree_ope
-00003750: 7261 7469 6f6e 285f 2822 7b73 7065 6564  ration(_("{speed
-00003760: 7d6d 6d2f 7322 292c 206e 6f64 655f 7479  }mm/s"), node_ty
-00003770: 7065 3d28 226f 7020 7261 7374 6572 222c  pe=("op raster",
-00003780: 2022 6f70 2069 6d61 6765 2229 2c20 6865   "op image"), he
-00003790: 6c70 3d22 2229 0d0a 2020 2020 6465 6620  lp="")..    def 
-000037a0: 7365 745f 7370 6565 645f 7261 7374 6572  set_speed_raster
-000037b0: 286e 6f64 652c 2073 7065 6564 3d31 3530  (node, speed=150
-000037c0: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
-000037d0: 2020 2020 2020 6461 7461 203d 206c 6973        data = lis
-000037e0: 7428 290d 0a20 2020 2020 2020 2066 6f72  t()..        for
-000037f0: 206e 2069 6e20 6c69 7374 2873 656c 662e   n in list(self.
-00003800: 6f70 7328 7365 6c65 6374 6564 3d54 7275  ops(selected=Tru
-00003810: 6529 293a 0d0a 2020 2020 2020 2020 2020  e)):..          
-00003820: 2020 6966 206e 2e74 7970 6520 6e6f 7420    if n.type not 
-00003830: 696e 2028 226f 7020 7261 7374 6572 222c  in ("op raster",
-00003840: 2022 6f70 2069 6d61 6765 2229 3a0d 0a20   "op image"):.. 
-00003850: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00003860: 6f6e 7469 6e75 650d 0a20 2020 2020 2020  ontinue..       
-00003870: 2020 2020 206e 2e73 7065 6564 203d 2066       n.speed = f
-00003880: 6c6f 6174 2873 7065 6564 290d 0a20 2020  loat(speed)..   
-00003890: 2020 2020 2020 2020 2064 6174 612e 6170           data.ap
-000038a0: 7065 6e64 286e 290d 0a20 2020 2020 2020  pend(n)..       
-000038b0: 2073 656c 662e 7369 676e 616c 2822 656c   self.signal("el
-000038c0: 656d 656e 745f 7072 6f70 6572 7479 5f72  ement_property_r
-000038d0: 656c 6f61 6422 2c20 6461 7461 290d 0a0d  eload", data)...
-000038e0: 0a20 2020 2040 7472 6565 5f73 7562 6d65  .    @tree_subme
-000038f0: 6e75 285f 2822 5370 6565 6420 666f 7220  nu(_("Speed for 
-00003900: 5665 6374 6f72 2d4f 7065 7261 7469 6f6e  Vector-Operation
-00003910: 2229 290d 0a20 2020 2040 7472 6565 5f72  "))..    @tree_r
-00003920: 6164 696f 2872 6164 696f 5f6d 6174 6368  adio(radio_match
-00003930: 5f73 7065 6564 290d 0a20 2020 2040 7472  _speed)..    @tr
-00003940: 6565 5f76 616c 7565 7328 2273 7065 6564  ee_values("speed
-00003950: 222c 2028 322c 2033 2c20 342c 2035 2c20  ", (2, 3, 4, 5, 
-00003960: 362c 2037 2c20 3130 2c20 3135 2c20 3230  6, 7, 10, 15, 20
-00003970: 2c20 3235 2c20 3330 2c20 3335 2c20 3430  , 25, 30, 35, 40
-00003980: 2c20 3530 2929 0d0a 2020 2020 4074 7265  , 50))..    @tre
-00003990: 655f 6f70 6572 6174 696f 6e28 0d0a 2020  e_operation(..  
-000039a0: 2020 2020 2020 5f28 227b 7370 6565 647d        _("{speed}
-000039b0: 6d6d 2f73 2229 2c0d 0a20 2020 2020 2020  mm/s"),..       
-000039c0: 206e 6f64 655f 7479 7065 3d28 226f 7020   node_type=("op 
-000039d0: 6375 7422 2c20 226f 7020 656e 6772 6176  cut", "op engrav
-000039e0: 6522 2c20 226f 7020 6861 7463 6822 292c  e", "op hatch"),
-000039f0: 0d0a 2020 2020 2020 2020 6865 6c70 3d22  ..        help="
-00003a00: 222c 0d0a 2020 2020 290d 0a20 2020 2064  ",..    )..    d
-00003a10: 6566 2073 6574 5f73 7065 6564 5f76 6563  ef set_speed_vec
-00003a20: 746f 725f 6375 7428 6e6f 6465 2c20 7370  tor_cut(node, sp
-00003a30: 6565 643d 3230 2c20 2a2a 6b77 6172 6773  eed=20, **kwargs
-00003a40: 293a 0d0a 2020 2020 2020 2020 6461 7461  ):..        data
-00003a50: 203d 206c 6973 7428 290d 0a20 2020 2020   = list()..     
-00003a60: 2020 2066 6f72 206e 2069 6e20 6c69 7374     for n in list
-00003a70: 2873 656c 662e 6f70 7328 7365 6c65 6374  (self.ops(select
-00003a80: 6564 3d54 7275 6529 293a 0d0a 2020 2020  ed=True)):..    
-00003a90: 2020 2020 2020 2020 6966 206e 2e74 7970          if n.typ
-00003aa0: 6520 6e6f 7420 696e 2028 226f 7020 6375  e not in ("op cu
-00003ab0: 7422 2c20 226f 7020 656e 6772 6176 6522  t", "op engrave"
-00003ac0: 2c20 226f 7020 6861 7463 6822 293a 0d0a  , "op hatch"):..
-00003ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003ae0: 636f 6e74 696e 7565 0d0a 2020 2020 2020  continue..      
-00003af0: 2020 2020 2020 6e2e 7370 6565 6420 3d20        n.speed = 
-00003b00: 666c 6f61 7428 7370 6565 6429 0d0a 2020  float(speed)..  
-00003b10: 2020 2020 2020 2020 2020 6461 7461 2e61            data.a
-00003b20: 7070 656e 6428 6e29 0d0a 2020 2020 2020  ppend(n)..      
-00003b30: 2020 7365 6c66 2e73 6967 6e61 6c28 2265    self.signal("e
-00003b40: 6c65 6d65 6e74 5f70 726f 7065 7274 795f  lement_property_
-00003b50: 7265 6c6f 6164 222c 2064 6174 6129 0d0a  reload", data)..
-00003b60: 0d0a 2020 2020 6465 6620 7261 6469 6f5f  ..    def radio_
-00003b70: 6d61 7463 685f 706f 7765 7228 6e6f 6465  match_power(node
-00003b80: 2c20 706f 7765 723d 302c 202a 2a6b 7761  , power=0, **kwa
-00003b90: 7267 7329 3a0d 0a20 2020 2020 2020 2072  rgs):..        r
-00003ba0: 6574 7572 6e20 6e6f 6465 2e70 6f77 6572  eturn node.power
-00003bb0: 203d 3d20 666c 6f61 7428 706f 7765 7229   == float(power)
-00003bc0: 0d0a 0d0a 2020 2020 4074 7265 655f 7375  ....    @tree_su
-00003bd0: 626d 656e 7528 5f28 2250 6f77 6572 2229  bmenu(_("Power")
-00003be0: 290d 0a20 2020 2040 7472 6565 5f72 6164  )..    @tree_rad
-00003bf0: 696f 2872 6164 696f 5f6d 6174 6368 5f70  io(radio_match_p
-00003c00: 6f77 6572 290d 0a20 2020 2040 7472 6565  ower)..    @tree
-00003c10: 5f76 616c 7565 7328 2270 6f77 6572 222c  _values("power",
-00003c20: 2028 3130 302c 2032 3530 2c20 3333 332c   (100, 250, 333,
-00003c30: 2035 3030 2c20 3636 372c 2037 3530 2c20   500, 667, 750, 
-00003c40: 3130 3030 2929 0d0a 2020 2020 4074 7265  1000))..    @tre
-00003c50: 655f 6361 6c63 2822 706f 7765 725f 3130  e_calc("power_10
-00003c60: 222c 206c 616d 6264 6120 693a 2072 6f75  ", lambda i: rou
-00003c70: 6e64 2869 202f 2031 302c 2031 2929 0d0a  nd(i / 10, 1))..
-00003c80: 2020 2020 4074 7265 655f 6f70 6572 6174      @tree_operat
-00003c90: 696f 6e28 0d0a 2020 2020 2020 2020 5f28  ion(..        _(
-00003ca0: 227b 706f 7765 727d 7070 6920 287b 706f  "{power}ppi ({po
-00003cb0: 7765 725f 3130 7d25 2922 292c 0d0a 2020  wer_10}%)"),..  
-00003cc0: 2020 2020 2020 6e6f 6465 5f74 7970 653d        node_type=
-00003cd0: 2822 6f70 2063 7574 222c 2022 6f70 2072  ("op cut", "op r
-00003ce0: 6173 7465 7222 2c20 226f 7020 696d 6167  aster", "op imag
-00003cf0: 6522 2c20 226f 7020 656e 6772 6176 6522  e", "op engrave"
-00003d00: 2c20 226f 7020 6861 7463 6822 292c 0d0a  , "op hatch"),..
-00003d10: 2020 2020 2020 2020 6865 6c70 3d22 222c          help="",
-00003d20: 0d0a 2020 2020 290d 0a20 2020 2064 6566  ..    )..    def
-00003d30: 2073 6574 5f70 6f77 6572 286e 6f64 652c   set_power(node,
-00003d40: 2070 6f77 6572 3d31 3030 302c 202a 2a6b   power=1000, **k
-00003d50: 7761 7267 7329 3a0d 0a20 2020 2020 2020  wargs):..       
-00003d60: 2064 6174 6120 3d20 6c69 7374 2829 0d0a   data = list()..
-00003d70: 2020 2020 2020 2020 666f 7220 6e20 696e          for n in
-00003d80: 206c 6973 7428 7365 6c66 2e6f 7073 2873   list(self.ops(s
-00003d90: 656c 6563 7465 643d 5472 7565 2929 3a0d  elected=True)):.
-00003da0: 0a20 2020 2020 2020 2020 2020 206e 2e70  .            n.p
-00003db0: 6f77 6572 203d 2066 6c6f 6174 2870 6f77  ower = float(pow
-00003dc0: 6572 290d 0a20 2020 2020 2020 2020 2020  er)..           
-00003dd0: 2064 6174 612e 6170 7065 6e64 286e 290d   data.append(n).
-00003de0: 0a20 2020 2020 2020 2073 656c 662e 7369  .        self.si
-00003df0: 676e 616c 2822 656c 656d 656e 745f 7072  gnal("element_pr
-00003e00: 6f70 6572 7479 5f72 656c 6f61 6422 2c20  operty_reload", 
-00003e10: 6461 7461 290d 0a0d 0a20 2020 2064 6566  data)....    def
-00003e20: 2072 6164 696f 5f6d 6174 6368 286e 6f64   radio_match(nod
-00003e30: 652c 2064 7069 3d31 3030 2c20 2a2a 6b77  e, dpi=100, **kw
-00003e40: 6172 6773 293a 0d0a 2020 2020 2020 2020  args):..        
-00003e50: 7265 7475 726e 206e 6f64 652e 6470 6920  return node.dpi 
-00003e60: 3d3d 2064 7069 0d0a 0d0a 2020 2020 4074  == dpi....    @t
-00003e70: 7265 655f 7375 626d 656e 7528 5f28 2244  ree_submenu(_("D
-00003e80: 5049 2229 290d 0a20 2020 2040 7472 6565  PI"))..    @tree
-00003e90: 5f72 6164 696f 2872 6164 696f 5f6d 6174  _radio(radio_mat
-00003ea0: 6368 290d 0a20 2020 2040 7472 6565 5f76  ch)..    @tree_v
-00003eb0: 616c 7565 7328 2264 7069 222c 2028 3130  alues("dpi", (10
-00003ec0: 302c 2032 3530 2c20 3333 332c 2035 3030  0, 250, 333, 500
-00003ed0: 2c20 3636 372c 2037 3530 2c20 3130 3030  , 667, 750, 1000
-00003ee0: 2929 0d0a 2020 2020 4074 7265 655f 6f70  ))..    @tree_op
-00003ef0: 6572 6174 696f 6e28 0d0a 2020 2020 2020  eration(..      
-00003f00: 2020 5f28 2244 5049 207b 6470 697d 2229    _("DPI {dpi}")
-00003f10: 2c0d 0a20 2020 2020 2020 206e 6f64 655f  ,..        node_
-00003f20: 7479 7065 3d28 226f 7020 7261 7374 6572  type=("op raster
-00003f30: 222c 2022 656c 656d 2069 6d61 6765 2229  ", "elem image")
-00003f40: 2c0d 0a20 2020 2020 2020 2068 656c 703d  ,..        help=
-00003f50: 5f28 2243 6861 6e67 6520 6470 6920 7661  _("Change dpi va
-00003f60: 6c75 6573 2229 2c0d 0a20 2020 2029 0d0a  lues"),..    )..
-00003f70: 2020 2020 6465 6620 7365 745f 7374 6570      def set_step
-00003f80: 5f6e 286e 6f64 652c 2064 7069 3d31 2c20  _n(node, dpi=1, 
-00003f90: 2a2a 6b77 6172 6773 293a 0d0a 2020 2020  **kwargs):..    
-00003fa0: 2020 2020 6461 7461 203d 206c 6973 7428      data = list(
-00003fb0: 290d 0a20 2020 2020 2020 2066 6f72 206e  )..        for n
-00003fc0: 2069 6e20 6c69 7374 2873 656c 662e 6f70   in list(self.op
-00003fd0: 7328 7365 6c65 6374 6564 3d54 7275 6529  s(selected=True)
-00003fe0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00003ff0: 6e2e 6470 6920 3d20 6470 690d 0a20 2020  n.dpi = dpi..   
-00004000: 2020 2020 2020 2020 2064 6174 612e 6170           data.ap
-00004010: 7065 6e64 286e 290d 0a20 2020 2020 2020  pend(n)..       
-00004020: 2066 6f72 206e 2069 6e20 6c69 7374 2873   for n in list(s
-00004030: 656c 662e 656c 656d 7328 656d 7068 6173  elf.elems(emphas
-00004040: 697a 6564 3d54 7275 6529 293a 0d0a 2020  ized=True)):..  
-00004050: 2020 2020 2020 2020 2020 6966 206e 2e74            if n.t
-00004060: 7970 6520 3d3d 2022 656c 656d 2069 6d61  ype == "elem ima
-00004070: 6765 223a 0d0a 2020 2020 2020 2020 2020  ge":..          
-00004080: 2020 2020 2020 6e2e 6470 6920 3d20 6470        n.dpi = dp
-00004090: 690d 0a20 2020 2020 2020 2020 2020 2020  i..             
-000040a0: 2020 206e 2e75 7064 6174 6528 4e6f 6e65     n.update(None
-000040b0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-000040c0: 2020 2064 6174 612e 6170 7065 6e64 286e     data.append(n
-000040d0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-000040e0: 7369 676e 616c 2822 7265 6672 6573 685f  signal("refresh_
-000040f0: 7363 656e 6522 2c20 2253 6365 6e65 2229  scene", "Scene")
-00004100: 0d0a 2020 2020 2020 2020 7365 6c66 2e73  ..        self.s
-00004110: 6967 6e61 6c28 2265 6c65 6d65 6e74 5f70  ignal("element_p
-00004120: 726f 7065 7274 795f 7265 6c6f 6164 222c  roperty_reload",
-00004130: 2064 6174 6129 0d0a 0d0a 2020 2020 6465   data)....    de
-00004140: 6620 7261 6469 6f5f 6d61 7463 685f 7061  f radio_match_pa
-00004150: 7373 6573 286e 6f64 652c 2070 6173 7376  sses(node, passv
-00004160: 616c 7565 3d31 2c20 2a2a 6b77 6172 6773  alue=1, **kwargs
-00004170: 293a 0d0a 2020 2020 2020 2020 7265 7475  ):..        retu
-00004180: 726e 2028 6e6f 6465 2e70 6173 7365 735f  rn (node.passes_
-00004190: 6375 7374 6f6d 2061 6e64 2070 6173 7376  custom and passv
-000041a0: 616c 7565 203d 3d20 6e6f 6465 2e70 6173  alue == node.pas
-000041b0: 7365 7329 206f 7220 280d 0a20 2020 2020  ses) or (..     
-000041c0: 2020 2020 2020 206e 6f74 206e 6f64 652e         not node.
-000041d0: 7061 7373 6573 5f63 7573 746f 6d20 616e  passes_custom an
-000041e0: 6420 7061 7373 7661 6c75 6520 3d3d 2031  d passvalue == 1
-000041f0: 0d0a 2020 2020 2020 2020 290d 0a0d 0a20  ..        ).... 
-00004200: 2020 2040 7472 6565 5f73 7562 6d65 6e75     @tree_submenu
-00004210: 285f 2822 5365 7420 6f70 6572 6174 696f  (_("Set operatio
-00004220: 6e20 7061 7373 6573 2229 290d 0a20 2020  n passes"))..   
-00004230: 2040 7472 6565 5f72 6164 696f 2872 6164   @tree_radio(rad
-00004240: 696f 5f6d 6174 6368 5f70 6173 7365 7329  io_match_passes)
-00004250: 0d0a 2020 2020 4074 7265 655f 6974 6572  ..    @tree_iter
-00004260: 6174 6528 2270 6173 7376 616c 7565 222c  ate("passvalue",
-00004270: 2031 2c20 3130 290d 0a20 2020 2040 7472   1, 10)..    @tr
-00004280: 6565 5f6f 7065 7261 7469 6f6e 285f 2822  ee_operation(_("
-00004290: 5061 7373 6573 207b 7061 7373 7661 6c75  Passes {passvalu
-000042a0: 657d 2229 2c20 6e6f 6465 5f74 7970 653d  e}"), node_type=
-000042b0: 6f70 5f70 6172 656e 745f 6e6f 6465 732c  op_parent_nodes,
-000042c0: 2068 656c 703d 2222 290d 0a20 2020 2064   help="")..    d
-000042d0: 6566 2073 6574 5f6e 5f70 6173 7365 7328  ef set_n_passes(
-000042e0: 6e6f 6465 2c20 7061 7373 7661 6c75 653d  node, passvalue=
-000042f0: 312c 202a 2a6b 7761 7267 7329 3a0d 0a20  1, **kwargs):.. 
-00004300: 2020 2020 2020 2064 6174 6120 3d20 6c69         data = li
-00004310: 7374 2829 0d0a 2020 2020 2020 2020 666f  st()..        fo
-00004320: 7220 6e20 696e 206c 6973 7428 7365 6c66  r n in list(self
-00004330: 2e6f 7073 2873 656c 6563 7465 643d 5472  .ops(selected=Tr
-00004340: 7565 2929 3a0d 0a20 2020 2020 2020 2020  ue)):..         
-00004350: 2020 206e 2e70 6173 7365 7320 3d20 7061     n.passes = pa
-00004360: 7373 7661 6c75 650d 0a20 2020 2020 2020  ssvalue..       
-00004370: 2020 2020 206e 2e70 6173 7365 735f 6375       n.passes_cu
-00004380: 7374 6f6d 203d 2070 6173 7376 616c 7565  stom = passvalue
-00004390: 2021 3d20 310d 0a20 2020 2020 2020 2020   != 1..         
-000043a0: 2020 2064 6174 612e 6170 7065 6e64 286e     data.append(n
-000043b0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-000043c0: 7369 676e 616c 2822 656c 656d 656e 745f  signal("element_
-000043d0: 7072 6f70 6572 7479 5f72 656c 6f61 6422  property_reload"
-000043e0: 2c20 6461 7461 290d 0a0d 0a20 2020 2023  , data)....    #
-000043f0: 202d 2d2d 2d20 4275 726e 2044 6972 6563   ---- Burn Direc
-00004400: 7469 6f6e 0d0a 2020 2020 6465 6620 6765  tion..    def ge
-00004410: 745f 6469 7265 6374 696f 6e5f 7661 6c75  t_direction_valu
-00004420: 6573 2829 3a0d 0a20 2020 2020 2020 2072  es():..        r
-00004430: 6574 7572 6e20 280d 0a20 2020 2020 2020  eturn (..       
-00004440: 2020 2020 2022 546f 7020 546f 2042 6f74       "Top To Bot
-00004450: 746f 6d22 2c0d 0a20 2020 2020 2020 2020  tom",..         
-00004460: 2020 2022 426f 7474 6f6d 2054 6f20 546f     "Bottom To To
-00004470: 7022 2c0d 0a20 2020 2020 2020 2020 2020  p",..           
-00004480: 2022 5269 6768 7420 546f 204c 6566 7422   "Right To Left"
-00004490: 2c0d 0a20 2020 2020 2020 2020 2020 2022  ,..            "
-000044a0: 4c65 6674 2054 6f20 5269 6768 7422 2c0d  Left To Right",.
-000044b0: 0a20 2020 2020 2020 2020 2020 2022 4372  .            "Cr
-000044c0: 6f73 7368 6174 6368 222c 0d0a 2020 2020  osshatch",..    
-000044d0: 2020 2020 290d 0a0d 0a20 2020 2064 6566      )....    def
-000044e0: 2072 6164 696f 5f6d 6174 6368 5f64 6972   radio_match_dir
-000044f0: 6563 7469 6f6e 286e 6f64 652c 2072 6173  ection(node, ras
-00004500: 7465 725f 6469 7265 6374 696f 6e3d 2222  ter_direction=""
-00004510: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
-00004520: 2020 2020 2020 7661 6c75 6573 203d 2067        values = g
-00004530: 6574 5f64 6972 6563 7469 6f6e 5f76 616c  et_direction_val
-00004540: 7565 7328 290d 0a20 2020 2020 2020 2066  ues()..        f
-00004550: 6f72 2069 6478 2c20 6b65 7920 696e 2065  or idx, key in e
-00004560: 6e75 6d65 7261 7465 2876 616c 7565 7329  numerate(values)
-00004570: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
-00004580: 6620 6b65 7920 3d3d 2072 6173 7465 725f  f key == raster_
-00004590: 6469 7265 6374 696f 6e3a 0d0a 2020 2020  direction:..    
-000045a0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-000045b0: 726e 206e 6f64 652e 7261 7374 6572 5f64  rn node.raster_d
-000045c0: 6972 6563 7469 6f6e 203d 3d20 6964 780d  irection == idx.
-000045d0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000045e0: 4661 6c73 650d 0a0d 0a20 2020 2040 7472  False....    @tr
-000045f0: 6565 5f73 7562 6d65 6e75 285f 2822 4275  ee_submenu(_("Bu
-00004600: 726e 2044 6972 6563 7469 6f6e 2229 290d  rn Direction")).
-00004610: 0a20 2020 2040 7472 6565 5f72 6164 696f  .    @tree_radio
-00004620: 2872 6164 696f 5f6d 6174 6368 5f64 6972  (radio_match_dir
-00004630: 6563 7469 6f6e 290d 0a20 2020 2040 7472  ection)..    @tr
-00004640: 6565 5f76 616c 7565 7328 2272 6173 7465  ee_values("raste
-00004650: 725f 6469 7265 6374 696f 6e22 2c20 7661  r_direction", va
-00004660: 6c75 6573 3d67 6574 5f64 6972 6563 7469  lues=get_directi
-00004670: 6f6e 5f76 616c 7565 7328 2929 0d0a 2020  on_values())..  
-00004680: 2020 4074 7265 655f 6f70 6572 6174 696f    @tree_operatio
-00004690: 6e28 0d0a 2020 2020 2020 2020 227b 7261  n(..        "{ra
-000046a0: 7374 6572 5f64 6972 6563 7469 6f6e 7d22  ster_direction}"
-000046b0: 2c0d 0a20 2020 2020 2020 206e 6f64 655f  ,..        node_
-000046c0: 7479 7065 3d28 226f 7020 7261 7374 6572  type=("op raster
-000046d0: 222c 2022 6f70 2069 6d61 6765 2229 2c0d  ", "op image"),.
-000046e0: 0a20 2020 2020 2020 2068 656c 703d 2222  .        help=""
-000046f0: 2c0d 0a20 2020 2029 0d0a 2020 2020 6465  ,..    )..    de
-00004700: 6620 7365 745f 6469 7265 6374 696f 6e28  f set_direction(
-00004710: 6e6f 6465 2c20 7261 7374 6572 5f64 6972  node, raster_dir
-00004720: 6563 7469 6f6e 3d22 222c 202a 2a6b 7761  ection="", **kwa
-00004730: 7267 7329 3a0d 0a20 2020 2020 2020 2076  rgs):..        v
-00004740: 616c 7565 7320 3d20 6765 745f 6469 7265  alues = get_dire
-00004750: 6374 696f 6e5f 7661 6c75 6573 2829 0d0a  ction_values()..
-00004760: 2020 2020 2020 2020 666f 7220 6964 782c          for idx,
-00004770: 206b 6579 2069 6e20 656e 756d 6572 6174   key in enumerat
-00004780: 6528 7661 6c75 6573 293a 0d0a 2020 2020  e(values):..    
-00004790: 2020 2020 2020 2020 6966 206b 6579 203d          if key =
-000047a0: 3d20 7261 7374 6572 5f64 6972 6563 7469  = raster_directi
-000047b0: 6f6e 3a0d 0a20 2020 2020 2020 2020 2020  on:..           
-000047c0: 2020 2020 2064 6174 6120 3d20 6c69 7374       data = list
-000047d0: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
-000047e0: 2020 2020 666f 7220 6e20 696e 206c 6973      for n in lis
-000047f0: 7428 7365 6c66 2e6f 7073 2873 656c 6563  t(self.ops(selec
-00004800: 7465 643d 5472 7565 2929 3a0d 0a20 2020  ted=True)):..   
-00004810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004820: 2069 6620 6e2e 7479 7065 206e 6f74 2069   if n.type not i
-00004830: 6e20 2822 6f70 2072 6173 7465 7222 2c20  n ("op raster", 
-00004840: 226f 7020 696d 6167 6522 293a 0d0a 2020  "op image"):..  
-00004850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004860: 2020 2020 2020 636f 6e74 696e 7565 0d0a        continue..
-00004870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004880: 2020 2020 6e2e 7261 7374 6572 5f64 6972      n.raster_dir
-00004890: 6563 7469 6f6e 203d 2069 6478 0d0a 2020  ection = idx..  
-000048a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000048b0: 2020 6461 7461 2e61 7070 656e 6428 6e29    data.append(n)
-000048c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000048d0: 2020 7365 6c66 2e73 6967 6e61 6c28 2265    self.signal("e
-000048e0: 6c65 6d65 6e74 5f70 726f 7065 7274 795f  lement_property_
-000048f0: 7265 6c6f 6164 222c 2064 6174 6129 0d0a  reload", data)..
-00004900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004910: 6272 6561 6b0d 0a0d 0a20 2020 2064 6566  break....    def
-00004920: 2067 6574 5f73 7769 6e67 5f76 616c 7565   get_swing_value
-00004930: 7328 293a 0d0a 2020 2020 2020 2020 7265  s():..        re
-00004940: 7475 726e 2028 0d0a 2020 2020 2020 2020  turn (..        
-00004950: 2020 2020 5f28 2255 6e69 6469 7265 6374      _("Unidirect
-00004960: 696f 6e61 6c22 292c 0d0a 2020 2020 2020  ional"),..      
-00004970: 2020 2020 2020 5f28 2242 6964 6972 6563        _("Bidirec
-00004980: 7469 6f6e 616c 2229 2c0d 0a20 2020 2020  tional"),..     
-00004990: 2020 2029 0d0a 0d0a 2020 2020 6465 6620     )....    def 
-000049a0: 7261 6469 6f5f 6d61 7463 685f 7377 696e  radio_match_swin
-000049b0: 6728 6e6f 6465 2c20 7261 7374 6572 5f73  g(node, raster_s
-000049c0: 7769 6e67 3d22 222c 202a 2a6b 7761 7267  wing="", **kwarg
-000049d0: 7329 3a0d 0a20 2020 2020 2020 2076 616c  s):..        val
-000049e0: 7565 7320 3d20 6765 745f 7377 696e 675f  ues = get_swing_
-000049f0: 7661 6c75 6573 2829 0d0a 2020 2020 2020  values()..      
-00004a00: 2020 666f 7220 6964 782c 206b 6579 2069    for idx, key i
-00004a10: 6e20 656e 756d 6572 6174 6528 7661 6c75  n enumerate(valu
-00004a20: 6573 293a 0d0a 2020 2020 2020 2020 2020  es):..          
-00004a30: 2020 6966 206b 6579 203d 3d20 7261 7374    if key == rast
-00004a40: 6572 5f73 7769 6e67 3a0d 0a20 2020 2020  er_swing:..     
-00004a50: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00004a60: 6e20 6e6f 6465 2e62 6964 6972 6563 7469  n node.bidirecti
-00004a70: 6f6e 616c 203d 3d20 6964 780d 0a20 2020  onal == idx..   
-00004a80: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
-00004a90: 650d 0a0d 0a20 2020 2040 7472 6565 5f73  e....    @tree_s
-00004aa0: 7562 6d65 6e75 285f 2822 4469 7265 6374  ubmenu(_("Direct
-00004ab0: 696f 6e61 6c20 5261 7374 6572 2229 290d  ional Raster")).
-00004ac0: 0a20 2020 2040 7472 6565 5f72 6164 696f  .    @tree_radio
-00004ad0: 2872 6164 696f 5f6d 6174 6368 5f73 7769  (radio_match_swi
-00004ae0: 6e67 290d 0a20 2020 2040 7472 6565 5f76  ng)..    @tree_v
-00004af0: 616c 7565 7328 2272 6173 7465 725f 7377  alues("raster_sw
-00004b00: 696e 6722 2c20 7661 6c75 6573 3d67 6574  ing", values=get
-00004b10: 5f73 7769 6e67 5f76 616c 7565 7328 2929  _swing_values())
-00004b20: 0d0a 2020 2020 4074 7265 655f 6f70 6572  ..    @tree_oper
-00004b30: 6174 696f 6e28 0d0a 2020 2020 2020 2020  ation(..        
-00004b40: 227b 7261 7374 6572 5f73 7769 6e67 7d22  "{raster_swing}"
-00004b50: 2c0d 0a20 2020 2020 2020 206e 6f64 655f  ,..        node_
-00004b60: 7479 7065 3d28 226f 7020 7261 7374 6572  type=("op raster
-00004b70: 222c 2022 6f70 2069 6d61 6765 2229 2c0d  ", "op image"),.
-00004b80: 0a20 2020 2020 2020 2068 656c 703d 2222  .        help=""
-00004b90: 2c0d 0a20 2020 2029 0d0a 2020 2020 6465  ,..    )..    de
-00004ba0: 6620 7365 745f 7377 696e 6728 6e6f 6465  f set_swing(node
-00004bb0: 2c20 7261 7374 6572 5f73 7769 6e67 3d22  , raster_swing="
-00004bc0: 222c 202a 2a6b 7761 7267 7329 3a0d 0a20  ", **kwargs):.. 
-00004bd0: 2020 2020 2020 2076 616c 7565 7320 3d20         values = 
-00004be0: 6765 745f 7377 696e 675f 7661 6c75 6573  get_swing_values
-00004bf0: 2829 0d0a 2020 2020 2020 2020 666f 7220  ()..        for 
-00004c00: 6964 782c 206b 6579 2069 6e20 656e 756d  idx, key in enum
-00004c10: 6572 6174 6528 7661 6c75 6573 293a 0d0a  erate(values):..
-00004c20: 2020 2020 2020 2020 2020 2020 6966 206b              if k
-00004c30: 6579 203d 3d20 7261 7374 6572 5f73 7769  ey == raster_swi
-00004c40: 6e67 3a0d 0a20 2020 2020 2020 2020 2020  ng:..           
-00004c50: 2020 2020 2064 6174 6120 3d20 6c69 7374       data = list
-00004c60: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
-00004c70: 2020 2020 666f 7220 6e20 696e 206c 6973      for n in lis
-00004c80: 7428 7365 6c66 2e6f 7073 2873 656c 6563  t(self.ops(selec
-00004c90: 7465 643d 5472 7565 2929 3a0d 0a20 2020  ted=True)):..   
-00004ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004cb0: 2069 6620 6e2e 7479 7065 206e 6f74 2069   if n.type not i
-00004cc0: 6e20 2822 6f70 2072 6173 7465 7222 2c20  n ("op raster", 
-00004cd0: 226f 7020 696d 6167 6522 293a 0d0a 2020  "op image"):..  
-00004ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004cf0: 2020 2020 2020 636f 6e74 696e 7565 0d0a        continue..
-00004d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004d10: 2020 2020 6e2e 6269 6469 7265 6374 696f      n.bidirectio
-00004d20: 6e61 6c20 3d20 626f 6f6c 2869 6478 290d  nal = bool(idx).
-00004d30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004d40: 2020 2020 2064 6174 612e 6170 7065 6e64       data.append
-00004d50: 286e 290d 0a20 2020 2020 2020 2020 2020  (n)..           
-00004d60: 2020 2020 2073 656c 662e 7369 676e 616c       self.signal
-00004d70: 2822 656c 656d 656e 745f 7072 6f70 6572  ("element_proper
-00004d80: 7479 5f72 656c 6f61 6422 2c20 6461 7461  ty_reload", data
-00004d90: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00004da0: 2020 2062 7265 616b 0d0a 0d0a 2020 2020     break....    
-00004db0: 4074 7265 655f 7365 7061 7261 746f 725f  @tree_separator_
-00004dc0: 6265 666f 7265 2829 0d0a 2020 2020 4074  before()..    @t
-00004dd0: 7265 655f 6f70 6572 6174 696f 6e28 0d0a  ree_operation(..
-00004de0: 2020 2020 2020 2020 5f28 2245 7865 6375          _("Execu
-00004df0: 7465 206f 7065 7261 7469 6f6e 2873 2922  te operation(s)"
-00004e00: 292c 0d0a 2020 2020 2020 2020 6e6f 6465  ),..        node
-00004e10: 5f74 7970 653d 6f70 5f6e 6f64 6573 2c0d  _type=op_nodes,.
-00004e20: 0a20 2020 2020 2020 2068 656c 703d 5f28  .        help=_(
-00004e30: 2245 7865 6375 7465 204a 6f62 2066 6f72  "Execute Job for
-00004e40: 2074 6865 2073 656c 6563 7465 6420 6f70   the selected op
-00004e50: 6572 6174 696f 6e28 7329 2e22 292c 0d0a  eration(s)."),..
-00004e60: 2020 2020 290d 0a20 2020 2064 6566 2065      )..    def e
-00004e70: 7865 6375 7465 5f6a 6f62 286e 6f64 652c  xecute_job(node,
-00004e80: 202a 2a6b 7761 7267 7329 3a0d 0a20 2020   **kwargs):..   
-00004e90: 2020 2020 2073 656c 662e 7365 745f 6e6f       self.set_no
-00004ea0: 6465 5f65 6d70 6861 7369 7328 6e6f 6465  de_emphasis(node
-00004eb0: 2c20 5472 7565 290d 0a20 2020 2020 2020  , True)..       
-00004ec0: 2073 656c 6628 2270 6c61 6e30 2063 6c65   self("plan0 cle
-00004ed0: 6172 2063 6f70 792d 7365 6c65 6374 6564  ar copy-selected
-00004ee0: 5c6e 2229 0d0a 2020 2020 2020 2020 7365  \n")..        se
-00004ef0: 6c66 2822 7769 6e64 6f77 206f 7065 6e20  lf("window open 
-00004f00: 4578 6563 7574 654a 6f62 2030 5c6e 2229  ExecuteJob 0\n")
-00004f10: 0d0a 0d0a 2020 2020 4074 7265 655f 7365  ....    @tree_se
-00004f20: 7061 7261 746f 725f 6166 7465 7228 290d  parator_after().
-00004f30: 0a20 2020 2040 7472 6565 5f6f 7065 7261  .    @tree_opera
-00004f40: 7469 6f6e 280d 0a20 2020 2020 2020 205f  tion(..        _
-00004f50: 2822 5369 6d75 6c61 7465 206f 7065 7261  ("Simulate opera
-00004f60: 7469 6f6e 2873 2922 292c 0d0a 2020 2020  tion(s)"),..    
-00004f70: 2020 2020 6e6f 6465 5f74 7970 653d 6f70      node_type=op
-00004f80: 5f6e 6f64 6573 2c0d 0a20 2020 2020 2020  _nodes,..       
-00004f90: 2068 656c 703d 5f28 2252 756e 2073 696d   help=_("Run sim
-00004fa0: 756c 6174 696f 6e20 666f 7220 7468 6520  ulation for the 
-00004fb0: 7365 6c65 6374 6564 206f 7065 7261 7469  selected operati
-00004fc0: 6f6e 2873 2922 292c 0d0a 2020 2020 290d  on(s)"),..    ).
-00004fd0: 0a20 2020 2064 6566 2063 6f6d 7069 6c65  .    def compile
-00004fe0: 5f61 6e64 5f73 696d 756c 6174 6528 6e6f  _and_simulate(no
-00004ff0: 6465 2c20 2a2a 6b77 6172 6773 293a 0d0a  de, **kwargs):..
-00005000: 2020 2020 2020 2020 7365 6c66 2e73 6574          self.set
-00005010: 5f6e 6f64 655f 656d 7068 6173 6973 286e  _node_emphasis(n
-00005020: 6f64 652c 2054 7275 6529 0d0a 2020 2020  ode, True)..    
-00005030: 2020 2020 7365 6c66 2822 706c 616e 3020      self("plan0 
-00005040: 636f 7079 2d73 656c 6563 7465 6420 7072  copy-selected pr
-00005050: 6570 726f 6365 7373 2076 616c 6964 6174  eprocess validat
-00005060: 6520 626c 6f62 2070 7265 6f70 7420 6f70  e blob preopt op
-00005070: 7469 6d69 7a65 5c6e 2229 0d0a 2020 2020  timize\n")..    
-00005080: 2020 2020 7365 6c66 2822 7769 6e64 6f77      self("window
-00005090: 206f 7065 6e20 5369 6d75 6c61 7469 6f6e   open Simulation
-000050a0: 2030 2031 2031 5c6e 2229 2020 2320 506c   0 1 1\n")  # Pl
-000050b0: 616e 204e 616d 652c 2041 7574 6f2d 436c  an Name, Auto-Cl
-000050c0: 6561 722c 204f 7074 696d 6973 650d 0a0d  ear, Optimise...
-000050d0: 0a20 2020 2023 203d 3d3d 3d3d 3d3d 3d3d  .    # =========
-000050e0: 3d0d 0a20 2020 2023 2047 656e 6572 616c  =..    # General
-000050f0: 206d 656e 752d 656e 7472 6965 7320 666f   menu-entries fo
-00005100: 7220 6f70 6572 6174 696f 6e20 6272 616e  r operation bran
-00005110: 6368 0d0a 2020 2020 2320 3d3d 3d3d 3d3d  ch..    # ======
-00005120: 3d3d 3d3d 0d0a 0d0a 2020 2020 4074 7265  ====....    @tre
-00005130: 655f 6f70 6572 6174 696f 6e28 5f28 2247  e_operation(_("G
-00005140: 6c6f 6261 6c20 5365 7474 696e 6773 2229  lobal Settings")
-00005150: 2c20 6e6f 6465 5f74 7970 653d 2262 7261  , node_type="bra
-00005160: 6e63 6820 6f70 7322 2c20 6865 6c70 3d22  nch ops", help="
-00005170: 2229 0d0a 2020 2020 6465 6620 6f70 5f70  ")..    def op_p
-00005180: 726f 7028 6e6f 6465 2c20 2a2a 6b77 6172  rop(node, **kwar
-00005190: 6773 293a 0d0a 2020 2020 2020 2020 6163  gs):..        ac
-000051a0: 7469 7661 7465 203d 2073 656c 662e 6b65  tivate = self.ke
-000051b0: 726e 656c 2e6c 6f6f 6b75 7028 2266 756e  rnel.lookup("fun
-000051c0: 6374 696f 6e2f 6f70 656e 5f70 726f 7065  ction/open_prope
-000051d0: 7274 795f 7769 6e64 6f77 5f66 6f72 5f6e  rty_window_for_n
-000051e0: 6f64 6522 290d 0a20 2020 2020 2020 2069  ode")..        i
-000051f0: 6620 6163 7469 7661 7465 2069 7320 6e6f  f activate is no
-00005200: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
-00005210: 2020 2020 2061 6374 6976 6174 6528 6e6f       activate(no
-00005220: 6465 290d 0a0d 0a20 2020 2040 7472 6565  de)....    @tree
-00005230: 5f6f 7065 7261 7469 6f6e 285f 2822 436c  _operation(_("Cl
-00005240: 6561 7220 616c 6c22 292c 206e 6f64 655f  ear all"), node_
-00005250: 7479 7065 3d22 6272 616e 6368 206f 7073  type="branch ops
-00005260: 222c 2068 656c 703d 2222 290d 0a20 2020  ", help="")..   
-00005270: 2064 6566 2063 6c65 6172 5f61 6c6c 286e   def clear_all(n
-00005280: 6f64 652c 202a 2a6b 7761 7267 7329 3a0d  ode, **kwargs):.
-00005290: 0a20 2020 2020 2020 2073 656c 6628 226f  .        self("o
-000052a0: 7065 7261 7469 6f6e 2a20 6465 6c65 7465  peration* delete
-000052b0: 5c6e 2229 0d0a 0d0a 2020 2020 4074 7265  \n")....    @tre
-000052c0: 655f 6f70 6572 6174 696f 6e28 0d0a 2020  e_operation(..  
-000052d0: 2020 2020 2020 5f28 2243 6c65 6172 2075        _("Clear u
-000052e0: 6e75 7365 6422 292c 0d0a 2020 2020 2020  nused"),..      
-000052f0: 2020 6e6f 6465 5f74 7970 653d 2262 7261    node_type="bra
-00005300: 6e63 6820 6f70 7322 2c0d 0a20 2020 2020  nch ops",..     
-00005310: 2020 2068 656c 703d 5f28 2243 6c65 6172     help=_("Clear
-00005320: 206f 7065 7261 7469 6f6e 7320 7769 7468   operations with
-00005330: 6f75 7420 6368 696c 6472 656e 2229 2c0d  out children"),.
-00005340: 0a20 2020 2029 0d0a 2020 2020 6465 6620  .    )..    def 
-00005350: 636c 6561 725f 756e 7573 6564 286e 6f64  clear_unused(nod
-00005360: 652c 202a 2a6b 7761 7267 7329 3a0d 0a20  e, **kwargs):.. 
-00005370: 2020 2020 2020 2074 6f5f 6465 6c65 7465         to_delete
-00005380: 203d 205b 5d0d 0a20 2020 2020 2020 2066   = []..        f
-00005390: 6f72 206f 7020 696e 2073 656c 662e 6f70  or op in self.op
-000053a0: 7328 293a 0d0a 2020 2020 2020 2020 2020  s():..          
-000053b0: 2020 2320 7072 696e 7420 2866 227b 6f70    # print (f"{op
-000053c0: 2e74 7970 657d 2c20 7265 6673 3d7b 6c65  .type}, refs={le
-000053d0: 6e28 6f70 2e5f 7265 6665 7265 6e63 6573  n(op._references
-000053e0: 297d 2c20 6368 696c 6472 656e 3d7b 6c65  )}, children={le
-000053f0: 6e28 6f70 2e5f 6368 696c 6472 656e 297d  n(op._children)}
-00005400: 2229 0d0a 2020 2020 2020 2020 2020 2020  ")..            
-00005410: 6966 206c 656e 286f 702e 5f63 6869 6c64  if len(op._child
-00005420: 7265 6e29 203d 3d20 3020 616e 6420 6e6f  ren) == 0 and no
-00005430: 7420 6f70 2e74 7970 6520 3d3d 2022 626c  t op.type == "bl
-00005440: 6f62 223a 0d0a 2020 2020 2020 2020 2020  ob":..          
-00005450: 2020 2020 2020 746f 5f64 656c 6574 652e        to_delete.
-00005460: 6170 7065 6e64 286f 7029 0d0a 2020 2020  append(op)..    
-00005470: 2020 2020 6966 206c 656e 2874 6f5f 6465      if len(to_de
-00005480: 6c65 7465 2920 3e20 303a 0d0a 2020 2020  lete) > 0:..    
-00005490: 2020 2020 2020 2020 7769 7468 2073 656c          with sel
-000054a0: 662e 7374 6174 6963 2822 636c 6561 725f  f.static("clear_
-000054b0: 756e 7573 6564 2229 3a0d 0a20 2020 2020  unused"):..     
-000054c0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000054d0: 7265 6d6f 7665 5f6f 7065 7261 7469 6f6e  remove_operation
-000054e0: 7328 746f 5f64 656c 6574 6529 0d0a 0d0a  s(to_delete)....
-000054f0: 2020 2020 6465 6620 7261 6469 6f5f 6d61      def radio_ma
-00005500: 7463 685f 7370 6565 645f 616c 6c28 6e6f  tch_speed_all(no
-00005510: 6465 2c20 7370 6565 643d 302c 202a 2a6b  de, speed=0, **k
-00005520: 7761 7267 7329 3a0d 0a20 2020 2020 2020  wargs):..       
-00005530: 206d 6178 7370 6565 6420 3d20 300d 0a20   maxspeed = 0.. 
-00005540: 2020 2020 2020 2066 6f72 206e 2069 6e20         for n in 
-00005550: 6c69 7374 2873 656c 662e 6f70 7328 2929  list(self.ops())
-00005560: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
-00005570: 6620 6e2e 7370 6565 6420 6973 206e 6f74  f n.speed is not
-00005580: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
-00005590: 2020 2020 2020 2020 6d61 7873 7065 6564          maxspeed
-000055a0: 203d 206d 6178 286d 6178 7370 6565 642c   = max(maxspeed,
-000055b0: 206e 2e73 7065 6564 290d 0a20 2020 2020   n.speed)..     
-000055c0: 2020 2072 6574 7572 6e20 626f 6f6c 2861     return bool(a
-000055d0: 6273 286d 6178 7370 6565 6420 2d20 666c  bs(maxspeed - fl
-000055e0: 6f61 7428 7370 6565 6429 2920 3c20 302e  oat(speed)) < 0.
-000055f0: 3529 0d0a 0d0a 2020 2020 4074 7265 655f  5)....    @tree_
-00005600: 7375 626d 656e 7528 5f28 2253 6361 6c65  submenu(_("Scale
-00005610: 2073 7065 6564 2073 6574 7469 6e67 7322   speed settings"
-00005620: 2929 0d0a 2020 2020 4074 7265 655f 7261  ))..    @tree_ra
-00005630: 6469 6f28 7261 6469 6f5f 6d61 7463 685f  dio(radio_match_
-00005640: 7370 6565 645f 616c 6c29 0d0a 2020 2020  speed_all)..    
-00005650: 4074 7265 655f 7661 6c75 6573 2822 7370  @tree_values("sp
-00005660: 6565 6422 2c20 2835 2c20 3130 2c20 3530  eed", (5, 10, 50
-00005670: 2c20 3735 2c20 3130 302c 2031 3530 2c20  , 75, 100, 150, 
-00005680: 3230 302c 2032 3530 2c20 3330 302c 2033  200, 250, 300, 3
-00005690: 3530 2c20 3430 302c 2034 3530 2c20 3530  50, 400, 450, 50
-000056a0: 3029 290d 0a20 2020 2040 7472 6565 5f6f  0))..    @tree_o
-000056b0: 7065 7261 7469 6f6e 280d 0a20 2020 2020  peration(..     
-000056c0: 2020 205f 2822 4d61 7820 7370 6565 6420     _("Max speed 
-000056d0: 3d20 7b73 7065 6564 7d6d 6d2f 7322 292c  = {speed}mm/s"),
-000056e0: 0d0a 2020 2020 2020 2020 6e6f 6465 5f74  ..        node_t
-000056f0: 7970 653d 2262 7261 6e63 6820 6f70 7322  ype="branch ops"
-00005700: 2c0d 0a20 2020 2020 2020 2068 656c 703d  ,..        help=
-00005710: 2222 2c0d 0a20 2020 2029 0d0a 2020 2020  "",..    )..    
-00005720: 6465 6620 7365 745f 7370 6565 645f 6c65  def set_speed_le
-00005730: 7665 6c73 286e 6f64 652c 2073 7065 6564  vels(node, speed
-00005740: 3d31 3530 2c20 2a2a 6b77 6172 6773 293a  =150, **kwargs):
-00005750: 0d0a 2020 2020 2020 2020 6461 7461 203d  ..        data =
-00005760: 206c 6973 7428 290d 0a20 2020 2020 2020   list()..       
-00005770: 206d 6178 7370 6565 6420 3d20 300d 0a20   maxspeed = 0.. 
-00005780: 2020 2020 2020 2066 6f72 206e 2069 6e20         for n in 
-00005790: 6c69 7374 2873 656c 662e 6f70 7328 2929  list(self.ops())
-000057a0: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
-000057b0: 6620 6e2e 7370 6565 6420 6973 206e 6f74  f n.speed is not
-000057c0: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
-000057d0: 2020 2020 2020 2020 6d61 7873 7065 6564          maxspeed
-000057e0: 203d 206d 6178 286d 6178 7370 6565 642c   = max(maxspeed,
-000057f0: 206e 2e73 7065 6564 290d 0a20 2020 2020   n.speed)..     
-00005800: 2020 2069 6620 6d61 7873 7065 6564 203d     if maxspeed =
-00005810: 3d20 303a 0d0a 2020 2020 2020 2020 2020  = 0:..          
-00005820: 2020 7265 7475 726e 0d0a 2020 2020 2020    return..      
-00005830: 2020 666f 7220 6e20 696e 206c 6973 7428    for n in list(
-00005840: 7365 6c66 2e6f 7073 2829 293a 0d0a 2020  self.ops()):..  
-00005850: 2020 2020 2020 2020 2020 6966 206e 2e73            if n.s
-00005860: 7065 6564 2069 7320 6e6f 7420 4e6f 6e65  peed is not None
-00005870: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00005880: 2020 206f 6c64 7370 6565 6420 3d20 666c     oldspeed = fl
-00005890: 6f61 7428 6e2e 7370 6565 6429 0d0a 2020  oat(n.speed)..  
-000058a0: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
-000058b0: 7773 7065 6564 203d 206f 6c64 7370 6565  wspeed = oldspee
-000058c0: 6420 2f20 6d61 7873 7065 6564 202a 2073  d / maxspeed * s
-000058d0: 7065 6564 0d0a 2020 2020 2020 2020 2020  peed..          
-000058e0: 2020 2020 2020 6e2e 7370 6565 6420 3d20        n.speed = 
-000058f0: 666c 6f61 7428 6e65 7773 7065 6564 290d  float(newspeed).
-00005900: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005910: 2064 6174 612e 6170 7065 6e64 286e 290d   data.append(n).
-00005920: 0a20 2020 2020 2020 2073 656c 662e 7369  .        self.si
-00005930: 676e 616c 2822 656c 656d 656e 745f 7072  gnal("element_pr
-00005940: 6f70 6572 7479 5f72 656c 6f61 6422 2c20  operty_reload", 
-00005950: 6461 7461 290d 0a0d 0a20 2020 2064 6566  data)....    def
-00005960: 2072 6164 696f 5f6d 6174 6368 5f70 6f77   radio_match_pow
-00005970: 6572 5f61 6c6c 286e 6f64 652c 2070 6f77  er_all(node, pow
-00005980: 6572 3d30 2c20 2a2a 6b77 6172 6773 293a  er=0, **kwargs):
-00005990: 0d0a 2020 2020 2020 2020 6d61 7870 6f77  ..        maxpow
-000059a0: 6572 203d 2030 0d0a 2020 2020 2020 2020  er = 0..        
-000059b0: 666f 7220 6e20 696e 206c 6973 7428 7365  for n in list(se
-000059c0: 6c66 2e6f 7073 2829 293a 0d0a 2020 2020  lf.ops()):..    
-000059d0: 2020 2020 2020 2020 6966 206e 2e70 6f77          if n.pow
-000059e0: 6572 2069 7320 6e6f 7420 4e6f 6e65 3a0d  er is not None:.
-000059f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005a00: 206d 6178 706f 7765 7220 3d20 6d61 7828   maxpower = max(
-00005a10: 6d61 7870 6f77 6572 2c20 6e2e 706f 7765  maxpower, n.powe
-00005a20: 7229 0d0a 2020 2020 2020 2020 7265 7475  r)..        retu
-00005a30: 726e 2062 6f6f 6c28 6162 7328 6d61 7870  rn bool(abs(maxp
-00005a40: 6f77 6572 202d 2066 6c6f 6174 2870 6f77  ower - float(pow
-00005a50: 6572 2929 203c 2030 2e35 290d 0a0d 0a20  er)) < 0.5).... 
-00005a60: 2020 2040 7472 6565 5f73 7562 6d65 6e75     @tree_submenu
-00005a70: 285f 2822 5363 616c 6520 706f 7765 7220  (_("Scale power 
-00005a80: 7365 7474 696e 6773 2229 290d 0a20 2020  settings"))..   
-00005a90: 2040 7472 6565 5f72 6164 696f 2872 6164   @tree_radio(rad
-00005aa0: 696f 5f6d 6174 6368 5f70 6f77 6572 5f61  io_match_power_a
-00005ab0: 6c6c 290d 0a20 2020 2040 7472 6565 5f76  ll)..    @tree_v
-00005ac0: 616c 7565 7328 2270 6f77 6572 222c 2028  alues("power", (
-00005ad0: 3130 302c 2032 3530 2c20 3333 332c 2035  100, 250, 333, 5
-00005ae0: 3030 2c20 3636 372c 2037 3530 2c20 3130  00, 667, 750, 10
-00005af0: 3030 2929 0d0a 2020 2020 4074 7265 655f  00))..    @tree_
-00005b00: 6361 6c63 2822 706f 7765 725f 3130 222c  calc("power_10",
-00005b10: 206c 616d 6264 6120 693a 2072 6f75 6e64   lambda i: round
-00005b20: 2869 202f 2031 302c 2031 2929 0d0a 2020  (i / 10, 1))..  
-00005b30: 2020 4074 7265 655f 6f70 6572 6174 696f    @tree_operatio
-00005b40: 6e28 0d0a 2020 2020 2020 2020 5f28 224d  n(..        _("M
-00005b50: 6178 2070 6f77 6572 203d 207b 706f 7765  ax power = {powe
-00005b60: 727d 7070 6920 287b 706f 7765 725f 3130  r}ppi ({power_10
-00005b70: 7d25 2922 292c 0d0a 2020 2020 2020 2020  }%)"),..        
-00005b80: 6e6f 6465 5f74 7970 653d 2262 7261 6e63  node_type="branc
-00005b90: 6820 6f70 7322 2c0d 0a20 2020 2020 2020  h ops",..       
-00005ba0: 2068 656c 703d 2222 2c0d 0a20 2020 2029   help="",..    )
-00005bb0: 0d0a 2020 2020 6465 6620 7365 745f 706f  ..    def set_po
-00005bc0: 7765 725f 6c65 7665 6c73 286e 6f64 652c  wer_levels(node,
-00005bd0: 2070 6f77 6572 3d31 3030 302c 202a 2a6b   power=1000, **k
-00005be0: 7761 7267 7329 3a0d 0a20 2020 2020 2020  wargs):..       
-00005bf0: 2064 6174 6120 3d20 6c69 7374 2829 0d0a   data = list()..
-00005c00: 2020 2020 2020 2020 6d61 7870 6f77 6572          maxpower
-00005c10: 203d 2030 0d0a 2020 2020 2020 2020 666f   = 0..        fo
-00005c20: 7220 6e20 696e 206c 6973 7428 7365 6c66  r n in list(self
-00005c30: 2e6f 7073 2829 293a 0d0a 2020 2020 2020  .ops()):..      
-00005c40: 2020 2020 2020 6966 206e 2e70 6f77 6572        if n.power
-00005c50: 2069 7320 6e6f 7420 4e6f 6e65 3a0d 0a20   is not None:.. 
-00005c60: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-00005c70: 6178 706f 7765 7220 3d20 6d61 7828 6d61  axpower = max(ma
-00005c80: 7870 6f77 6572 2c20 6e2e 706f 7765 7229  xpower, n.power)
-00005c90: 0d0a 2020 2020 2020 2020 6966 206d 6178  ..        if max
-00005ca0: 706f 7765 7220 3d3d 2030 3a0d 0a20 2020  power == 0:..   
-00005cb0: 2020 2020 2020 2020 2072 6574 7572 6e0d           return.
-00005cc0: 0a20 2020 2020 2020 2066 6f72 206e 2069  .        for n i
-00005cd0: 6e20 6c69 7374 2873 656c 662e 6f70 7328  n list(self.ops(
-00005ce0: 2929 3a0d 0a20 2020 2020 2020 2020 2020  )):..           
-00005cf0: 2069 6620 6e2e 706f 7765 7220 6973 206e   if n.power is n
-00005d00: 6f74 204e 6f6e 653a 0d0a 2020 2020 2020  ot None:..      
-00005d10: 2020 2020 2020 2020 2020 6f6c 6470 6f77            oldpow
-00005d20: 6572 203d 2066 6c6f 6174 286e 2e70 6f77  er = float(n.pow
-00005d30: 6572 290d 0a20 2020 2020 2020 2020 2020  er)..           
-00005d40: 2020 2020 206e 6577 706f 7765 7220 3d20       newpower = 
-00005d50: 6f6c 6470 6f77 6572 202f 206d 6178 706f  oldpower / maxpo
-00005d60: 7765 7220 2a20 706f 7765 720d 0a20 2020  wer * power..   
-00005d70: 2020 2020 2020 2020 2020 2020 206e 2e70               n.p
-00005d80: 6f77 6572 203d 2066 6c6f 6174 286e 6577  ower = float(new
-00005d90: 706f 7765 7229 0d0a 2020 2020 2020 2020  power)..        
-00005da0: 2020 2020 2020 2020 6461 7461 2e61 7070          data.app
-00005db0: 656e 6428 6e29 0d0a 2020 2020 2020 2020  end(n)..        
-00005dc0: 7365 6c66 2e73 6967 6e61 6c28 2265 6c65  self.signal("ele
-00005dd0: 6d65 6e74 5f70 726f 7065 7274 795f 7265  ment_property_re
-00005de0: 6c6f 6164 222c 2064 6174 6129 0d0a 0d0a  load", data)....
-00005df0: 2020 2020 6465 6620 7365 745f 6f70 5f6f      def set_op_o
-00005e00: 7574 7075 7428 6f70 732c 2076 616c 7565  utput(ops, value
-00005e10: 293a 0d0a 2020 2020 2020 2020 6e65 7776  ):..        newv
-00005e20: 616c 7565 203d 2076 616c 7565 0d0a 2020  alue = value..  
-00005e30: 2020 2020 2020 666f 7220 6e20 696e 206f        for n in o
-00005e40: 7073 3a0d 0a20 2020 2020 2020 2020 2020  ps:..           
-00005e50: 2069 6620 7661 6c75 6520 6973 204e 6f6e   if value is Non
-00005e60: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00005e70: 2020 2020 6e65 7776 616c 7565 203d 206e      newvalue = n
-00005e80: 6f74 206e 2e6f 7574 7075 740d 0a20 2020  ot n.output..   
-00005e90: 2020 2020 2020 2020 2074 7279 3a0d 0a20           try:.. 
-00005ea0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-00005eb0: 2e6f 7574 7075 7420 3d20 6e65 7776 616c  .output = newval
-00005ec0: 7565 0d0a 2020 2020 2020 2020 2020 2020  ue..            
-00005ed0: 2020 2020 6e2e 7570 6461 7465 6428 290d      n.updated().
-00005ee0: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
-00005ef0: 6570 7420 4174 7472 6962 7574 6545 7272  ept AttributeErr
-00005f00: 6f72 3a0d 0a20 2020 2020 2020 2020 2020  or:..           
-00005f10: 2020 2020 2070 6173 730d 0a20 2020 2020       pass..     
-00005f20: 2020 2073 656c 662e 7369 676e 616c 2822     self.signal("
-00005f30: 656c 656d 656e 745f 7072 6f70 6572 7479  element_property
-00005f40: 5f75 7064 6174 6522 2c20 6f70 7329 0d0a  _update", ops)..
-00005f50: 0d0a 2020 2020 4074 7265 655f 7365 7061  ..    @tree_sepa
-00005f60: 7261 746f 725f 6265 666f 7265 2829 0d0a  rator_before()..
-00005f70: 2020 2020 4074 7265 655f 6f70 6572 6174      @tree_operat
-00005f80: 696f 6e28 0d0a 2020 2020 2020 2020 5f28  ion(..        _(
-00005f90: 2245 6e61 626c 6520 616c 6c20 6f70 6572  "Enable all oper
-00005fa0: 6174 696f 6e73 2229 2c0d 0a20 2020 2020  ations"),..     
-00005fb0: 2020 206e 6f64 655f 7479 7065 3d22 6272     node_type="br
-00005fc0: 616e 6368 206f 7073 222c 0d0a 2020 2020  anch ops",..    
-00005fd0: 2020 2020 6865 6c70 3d5f 2822 456e 6162      help=_("Enab
-00005fe0: 6c65 2061 6c6c 206f 7065 7261 7469 6f6e  le all operation
-00005ff0: 7322 292c 0d0a 2020 2020 290d 0a20 2020  s"),..    )..   
-00006000: 2064 6566 206f 7073 5f65 6e61 626c 655f   def ops_enable_
-00006010: 616c 6c28 6e6f 6465 2c20 2a2a 6b77 6172  all(node, **kwar
-00006020: 6773 293a 0d0a 2020 2020 2020 2020 7365  gs):..        se
-00006030: 745f 6f70 5f6f 7574 7075 7428 6c69 7374  t_op_output(list
-00006040: 2873 656c 662e 6f70 7328 2929 2c20 5472  (self.ops()), Tr
-00006050: 7565 290d 0a0d 0a20 2020 2040 7472 6565  ue)....    @tree
-00006060: 5f6f 7065 7261 7469 6f6e 280d 0a20 2020  _operation(..   
-00006070: 2020 2020 205f 2822 4469 7361 626c 6520       _("Disable 
-00006080: 616c 6c20 6f70 6572 6174 696f 6e73 2229  all operations")
-00006090: 2c0d 0a20 2020 2020 2020 206e 6f64 655f  ,..        node_
-000060a0: 7479 7065 3d22 6272 616e 6368 206f 7073  type="branch ops
-000060b0: 222c 0d0a 2020 2020 2020 2020 6865 6c70  ",..        help
-000060c0: 3d5f 2822 4469 7361 626c 6520 616c 6c20  =_("Disable all 
-000060d0: 6f70 6572 6174 696f 6e73 2229 2c0d 0a20  operations"),.. 
-000060e0: 2020 2029 0d0a 2020 2020 6465 6620 6f70     )..    def op
-000060f0: 735f 6469 7361 626c 655f 616c 6c28 6e6f  s_disable_all(no
-00006100: 6465 2c20 2a2a 6b77 6172 6773 293a 0d0a  de, **kwargs):..
-00006110: 2020 2020 2020 2020 7365 745f 6f70 5f6f          set_op_o
-00006120: 7574 7075 7428 6c69 7374 2873 656c 662e  utput(list(self.
-00006130: 6f70 7328 2929 2c20 4661 6c73 6529 0d0a  ops()), False)..
-00006140: 0d0a 2020 2020 4074 7265 655f 7365 7061  ..    @tree_sepa
-00006150: 7261 746f 725f 6166 7465 7228 290d 0a20  rator_after().. 
-00006160: 2020 2040 7472 6565 5f6f 7065 7261 7469     @tree_operati
-00006170: 6f6e 280d 0a20 2020 2020 2020 205f 2822  on(..        _("
-00006180: 546f 6767 6c65 2061 6c6c 206f 7065 7261  Toggle all opera
-00006190: 7469 6f6e 7322 292c 0d0a 2020 2020 2020  tions"),..      
-000061a0: 2020 6e6f 6465 5f74 7970 653d 2262 7261    node_type="bra
-000061b0: 6e63 6820 6f70 7322 2c0d 0a20 2020 2020  nch ops",..     
-000061c0: 2020 2068 656c 703d 5f28 2254 6f67 676c     help=_("Toggl
-000061d0: 6520 656e 6162 6c65 642d 7374 6174 7573  e enabled-status
-000061e0: 206f 6620 616c 6c20 6f70 6572 6174 696f   of all operatio
-000061f0: 6e73 2229 2c0d 0a20 2020 2029 0d0a 2020  ns"),..    )..  
-00006200: 2020 6465 6620 6f70 735f 746f 6767 6c65    def ops_toggle
-00006210: 5f61 6c6c 286e 6f64 652c 202a 2a6b 7761  _all(node, **kwa
-00006220: 7267 7329 3a0d 0a20 2020 2020 2020 2073  rgs):..        s
-00006230: 6574 5f6f 705f 6f75 7470 7574 286c 6973  et_op_output(lis
-00006240: 7428 7365 6c66 2e6f 7073 2829 292c 204e  t(self.ops()), N
-00006250: 6f6e 6529 0d0a 0d0a 2020 2020 2320 3d3d  one)....    # ==
-00006260: 3d3d 3d3d 3d3d 3d3d 0d0a 2020 2020 2320  ========..    # 
-00006270: 4765 6e65 7261 6c20 6d65 6e75 2d65 6e74  General menu-ent
-00006280: 7269 6573 2066 6f72 2065 6c65 6d20 6272  ries for elem br
-00006290: 616e 6368 0d0a 2020 2020 2320 3d3d 3d3d  anch..    # ====
-000062a0: 3d3d 3d3d 3d3d 0d0a 0d0a 2020 2020 4074  ======....    @t
-000062b0: 7265 655f 6f70 6572 6174 696f 6e28 5f28  ree_operation(_(
-000062c0: 2243 6c65 6172 2061 6c6c 2229 2c20 6e6f  "Clear all"), no
-000062d0: 6465 5f74 7970 653d 2262 7261 6e63 6820  de_type="branch 
-000062e0: 656c 656d 7322 2c20 6865 6c70 3d22 2229  elems", help="")
-000062f0: 0d0a 2020 2020 6465 6620 636c 6561 725f  ..    def clear_
-00006300: 616c 6c5f 656c 656d 7328 6e6f 6465 2c20  all_elems(node, 
-00006310: 2a2a 6b77 6172 6773 293a 0d0a 2020 2020  **kwargs):..    
-00006320: 2020 2020 2320 7365 6c66 2822 656c 656d      # self("elem
-00006330: 656e 742a 2064 656c 6574 655c 6e22 290d  ent* delete\n").
-00006340: 0a20 2020 2020 2020 2077 6974 6820 7365  .        with se
-00006350: 6c66 2e73 7461 7469 6328 2263 6c65 6172  lf.static("clear
-00006360: 5f65 6c65 6d73 2229 3a0d 0a20 2020 2020  _elems"):..     
-00006370: 2020 2020 2020 2073 656c 662e 656c 656d         self.elem
-00006380: 5f62 7261 6e63 682e 7265 6d6f 7665 5f61  _branch.remove_a
-00006390: 6c6c 5f63 6869 6c64 7265 6e28 290d 0a0d  ll_children()...
-000063a0: 0a20 2020 2023 203d 3d3d 3d3d 3d3d 3d3d  .    # =========
-000063b0: 3d0d 0a20 2020 2023 2047 656e 6572 616c  =..    # General
-000063c0: 206d 656e 752d 656e 7472 6965 7320 666f   menu-entries fo
-000063d0: 7220 7265 676d 6172 6b20 6272 616e 6368  r regmark branch
-000063e0: 0d0a 2020 2020 2320 3d3d 3d3d 3d3d 3d3d  ..    # ========
-000063f0: 3d3d 0d0a 0d0a 2020 2020 4074 7265 655f  ==....    @tree_
-00006400: 6f70 6572 6174 696f 6e28 5f28 2243 6c65  operation(_("Cle
-00006410: 6172 2061 6c6c 2229 2c20 6e6f 6465 5f74  ar all"), node_t
-00006420: 7970 653d 2262 7261 6e63 6820 7265 6722  ype="branch reg"
-00006430: 2c20 6865 6c70 3d22 2229 0d0a 2020 2020  , help="")..    
-00006440: 6465 6620 636c 6561 725f 616c 6c5f 7265  def clear_all_re
-00006450: 676d 6172 6b73 286e 6f64 652c 202a 2a6b  gmarks(node, **k
-00006460: 7761 7267 7329 3a0d 0a20 2020 2020 2020  wargs):..       
-00006470: 2077 6974 6820 7365 6c66 2e73 7461 7469   with self.stati
-00006480: 6328 2263 6c65 6172 5f72 6567 6d61 726b  c("clear_regmark
-00006490: 7322 293a 0d0a 2020 2020 2020 2020 2020  s"):..          
-000064a0: 2020 7365 6c66 2e72 6567 5f62 7261 6e63    self.reg_branc
-000064b0: 682e 7265 6d6f 7665 5f61 6c6c 5f63 6869  h.remove_all_chi
-000064c0: 6c64 7265 6e28 290d 0a0d 0a20 2020 2023  ldren()....    #
-000064d0: 203d 3d3d 3d3d 3d3d 3d3d 3d0d 0a20 2020   ==========..   
-000064e0: 2023 2052 454d 4f56 4520 4d55 4c54 4920   # REMOVE MULTI 
-000064f0: 2854 7265 6520 5365 6c65 6374 6564 290d  (Tree Selected).
-00006500: 0a20 2020 2023 203d 3d3d 3d3d 3d3d 3d3d  .    # =========
-00006510: 3d0d 0a20 2020 2023 2043 616c 6375 6c61  =..    # Calcula
-00006520: 7465 2074 6865 2061 6d6f 756e 7420 6f66  te the amount of
-00006530: 2073 656c 6563 7465 6420 6e6f 6465 7320   selected nodes 
-00006540: 696e 2074 6865 2074 7265 653a 0d0a 2020  in the tree:..  
-00006550: 2020 2320 4966 2074 6865 7265 2061 7265    # If there are
-00006560: 206f 7073 2073 656c 6563 7465 6420 7468   ops selected th
-00006570: 656e 2074 6865 7920 7461 6b65 2070 7265  en they take pre
-00006580: 6365 6465 6e63 650d 0a20 2020 2023 2061  cedence..    # a
-00006590: 6e64 2077 696c 6c20 6f6e 6c79 2062 6520  nd will only be 
-000065a0: 636f 756e 7465 640d 0a0d 0a20 2020 2040  counted....    @
-000065b0: 7472 6565 5f63 6f6e 6469 7469 6f6e 616c  tree_conditional
-000065c0: 280d 0a20 2020 2020 2020 206c 616d 6264  (..        lambd
-000065d0: 6120 636f 6e64 3a20 6c65 6e28 0d0a 2020  a cond: len(..  
-000065e0: 2020 2020 2020 2020 2020 6c69 7374 2873            list(s
-000065f0: 656c 662e 666c 6174 2873 656c 6563 7465  elf.flat(selecte
-00006600: 643d 5472 7565 2c20 6361 7363 6164 653d  d=True, cascade=
-00006610: 4661 6c73 652c 2074 7970 6573 3d22 7265  False, types="re
-00006620: 6665 7265 6e63 6522 2929 0d0a 2020 2020  ference"))..    
-00006630: 2020 2020 290d 0a20 2020 2020 2020 203e      )..        >
-00006640: 3d20 310d 0a20 2020 2029 0d0a 2020 2020  = 1..    )..    
-00006650: 4074 7265 655f 6361 6c63 280d 0a20 2020  @tree_calc(..   
-00006660: 2020 2020 2022 6563 6f75 6e74 222c 0d0a       "ecount",..
-00006670: 2020 2020 2020 2020 6c61 6d62 6461 2069          lambda i
-00006680: 3a20 6c65 6e28 6c69 7374 2873 656c 662e  : len(list(self.
-00006690: 666c 6174 2873 656c 6563 7465 643d 5472  flat(selected=Tr
-000066a0: 7565 2c20 6361 7363 6164 653d 4661 6c73  ue, cascade=Fals
-000066b0: 652c 2074 7970 6573 3d22 7265 6665 7265  e, types="refere
-000066c0: 6e63 6522 2929 292c 0d0a 2020 2020 290d  nce"))),..    ).
-000066d0: 0a20 2020 2040 7472 6565 5f6f 7065 7261  .    @tree_opera
-000066e0: 7469 6f6e 280d 0a20 2020 2020 2020 205f  tion(..        _
-000066f0: 2822 5265 6d6f 7665 207b 6563 6f75 6e74  ("Remove {ecount
-00006700: 7d20 7365 6c65 6374 6564 2069 7465 6d73  } selected items
-00006710: 2066 726f 6d20 6f70 6572 6174 696f 6e73   from operations
-00006720: 2229 2c0d 0a20 2020 2020 2020 206e 6f64  "),..        nod
-00006730: 655f 7479 7065 3d22 7265 6665 7265 6e63  e_type="referenc
-00006740: 6522 2c0d 0a20 2020 2020 2020 2068 656c  e",..        hel
-00006750: 703d 2222 2c0d 0a20 2020 2029 0d0a 2020  p="",..    )..  
-00006760: 2020 6465 6620 7265 6d6f 7665 5f6d 756c    def remove_mul
-00006770: 7469 5f72 6566 6572 656e 6365 7328 6e6f  ti_references(no
-00006780: 6465 2c20 2a2a 6b77 6172 6773 293a 0d0a  de, **kwargs):..
-00006790: 2020 2020 2020 2020 6e6f 6465 7320 3d20          nodes = 
-000067a0: 6c69 7374 2873 656c 662e 666c 6174 2873  list(self.flat(s
-000067b0: 656c 6563 7465 643d 5472 7565 2c20 6361  elected=True, ca
-000067c0: 7363 6164 653d 4661 6c73 652c 2074 7970  scade=False, typ
-000067d0: 6573 3d22 7265 6665 7265 6e63 6522 2929  es="reference"))
-000067e0: 0d0a 2020 2020 2020 2020 666f 7220 6e6f  ..        for no
-000067f0: 6465 2069 6e20 6e6f 6465 733a 0d0a 2020  de in nodes:..  
-00006800: 2020 2020 2020 2020 2020 6966 206e 6f64            if nod
-00006810: 652e 7061 7265 6e74 2069 7320 6e6f 7420  e.parent is not 
-00006820: 4e6f 6e65 3a20 2023 204d 6179 2068 6176  None:  # May hav
-00006830: 6520 616c 7265 6164 7920 7265 6d6f 7665  e already remove
-00006840: 642e 0d0a 2020 2020 2020 2020 2020 2020  d...            
-00006850: 2020 2020 6e6f 6465 2e72 656d 6f76 655f      node.remove_
-00006860: 6e6f 6465 2829 0d0a 2020 2020 2020 2020  node()..        
-00006870: 7365 6c66 2e73 6574 5f65 6d70 6861 7369  self.set_emphasi
-00006880: 7328 4e6f 6e65 290d 0a20 2020 2020 2020  s(None)..       
-00006890: 2073 656c 662e 7369 676e 616c 2822 7265   self.signal("re
-000068a0: 6672 6573 685f 7472 6565 2229 0d0a 0d0a  fresh_tree")....
-000068b0: 2020 2020 2320 4074 7265 655f 636f 6e64      # @tree_cond
-000068c0: 6974 696f 6e61 6c28 0d0a 2020 2020 2320  itional(..    # 
-000068d0: 2020 2020 6c61 6d62 6461 2063 6f6e 643a      lambda cond:
-000068e0: 206c 656e 280d 0a20 2020 2023 2020 2020   len(..    #    
-000068f0: 2020 2020 206c 6973 7428 7365 6c66 2e66       list(self.f
-00006900: 6c61 7428 7365 6c65 6374 6564 3d54 7275  lat(selected=Tru
-00006910: 652c 2063 6173 6361 6465 3d46 616c 7365  e, cascade=False
-00006920: 2c20 7479 7065 733d 6f70 6572 6174 655f  , types=operate_
-00006930: 6e6f 6465 7329 290d 0a20 2020 2023 2020  nodes))..    #  
-00006940: 2020 2029 0d0a 2020 2020 2320 2020 2020     )..    #     
-00006950: 6966 206c 656e 286c 6973 7428 7365 6c66  if len(list(self
-00006960: 2e66 6c61 7428 7365 6c65 6374 6564 3d54  .flat(selected=T
-00006970: 7275 652c 2063 6173 6361 6465 3d46 616c  rue, cascade=Fal
-00006980: 7365 2c20 7479 7065 733d 6f70 6572 6174  se, types=operat
-00006990: 655f 6e6f 6465 7329 2929 0d0a 2020 2020  e_nodes)))..    
-000069a0: 2320 2020 2020 3e20 300d 0a20 2020 2023  #     > 0..    #
-000069b0: 2020 2020 2065 6c73 6520 6c65 6e28 0d0a       else len(..
-000069c0: 2020 2020 2320 2020 2020 2020 2020 6c69      #         li
-000069d0: 7374 2873 656c 662e 666c 6174 2873 656c  st(self.flat(sel
-000069e0: 6563 7465 643d 5472 7565 2c20 6361 7363  ected=True, casc
-000069f0: 6164 653d 4661 6c73 652c 2074 7970 6573  ade=False, types
-00006a00: 3d65 6c65 6d5f 6772 6f75 705f 6e6f 6465  =elem_group_node
-00006a10: 7329 290d 0a20 2020 2023 2020 2020 2029  s))..    #     )
-00006a20: 0d0a 2020 2020 2320 2020 2020 3e20 310d  ..    #     > 1.
-00006a30: 0a20 2020 2023 2029 0d0a 2020 2020 2320  .    # )..    # 
-00006a40: 4074 7265 655f 6361 6c63 280d 0a20 2020  @tree_calc(..   
-00006a50: 2023 2020 2020 2022 6563 6f75 6e74 222c   #     "ecount",
-00006a60: 0d0a 2020 2020 2320 2020 2020 6c61 6d62  ..    #     lamb
-00006a70: 6461 2069 3a20 6c65 6e28 0d0a 2020 2020  da i: len(..    
-00006a80: 2320 2020 2020 2020 2020 6c69 7374 2873  #         list(s
-00006a90: 656c 662e 666c 6174 2873 656c 6563 7465  elf.flat(selecte
-00006aa0: 643d 5472 7565 2c20 6361 7363 6164 653d  d=True, cascade=
-00006ab0: 4661 6c73 652c 2074 7970 6573 3d6f 7065  False, types=ope
-00006ac0: 7261 7465 5f6e 6f64 6573 2929 0d0a 2020  rate_nodes))..  
-00006ad0: 2020 2320 2020 2020 290d 0a20 2020 2023    #     )..    #
-00006ae0: 2020 2020 2069 6620 6c65 6e28 6c69 7374       if len(list
-00006af0: 2873 656c 662e 666c 6174 2873 656c 6563  (self.flat(selec
-00006b00: 7465 643d 5472 7565 2c20 6361 7363 6164  ted=True, cascad
-00006b10: 653d 4661 6c73 652c 2074 7970 6573 3d6f  e=False, types=o
-00006b20: 7065 7261 7465 5f6e 6f64 6573 2929 290d  perate_nodes))).
-00006b30: 0a20 2020 2023 2020 2020 203e 2030 0d0a  .    #     > 0..
-00006b40: 2020 2020 2320 2020 2020 656c 7365 206c      #     else l
-00006b50: 656e 280d 0a20 2020 2023 2020 2020 2020  en(..    #      
-00006b60: 2020 206c 6973 7428 7365 6c66 2e66 6c61     list(self.fla
-00006b70: 7428 7365 6c65 6374 6564 3d54 7275 652c  t(selected=True,
-00006b80: 2063 6173 6361 6465 3d46 616c 7365 2c20   cascade=False, 
-00006b90: 7479 7065 733d 656c 656d 5f67 726f 7570  types=elem_group
-00006ba0: 5f6e 6f64 6573 2929 0d0a 2020 2020 2320  _nodes))..    # 
-00006bb0: 2020 2020 292c 0d0a 2020 2020 2320 290d      ),..    # ).
-00006bc0: 0a20 2020 2023 2040 7472 6565 5f63 616c  .    # @tree_cal
-00006bd0: 6328 0d0a 2020 2020 2320 2020 2020 2272  c(..    #     "r
-00006be0: 636f 756e 7422 2c0d 0a20 2020 2023 2020  count",..    #  
-00006bf0: 2020 206c 616d 6264 6120 693a 206c 656e     lambda i: len
-00006c00: 280d 0a20 2020 2023 2020 2020 2020 2020  (..    #        
-00006c10: 206c 6973 7428 7365 6c66 2e66 6c61 7428   list(self.flat(
-00006c20: 7365 6c65 6374 6564 3d54 7275 652c 2063  selected=True, c
-00006c30: 6173 6361 6465 3d46 616c 7365 2c20 7479  ascade=False, ty
-00006c40: 7065 733d 2822 7265 6665 7265 6e63 6522  pes=("reference"
-00006c50: 2929 290d 0a20 2020 2023 2020 2020 2029  )))..    #     )
-00006c60: 2c0d 0a20 2020 2023 2029 0d0a 2020 2020  ,..    # )..    
-00006c70: 2320 4074 7265 655f 6361 6c63 280d 0a20  # @tree_calc(.. 
-00006c80: 2020 2023 2020 2020 2022 656c 6f63 222c     #     "eloc",
-00006c90: 0d0a 2020 2020 2320 2020 2020 6c61 6d62  ..    #     lamb
-00006ca0: 6461 2073 3a20 226f 7065 7261 7469 6f6e  da s: "operation
-00006cb0: 7322 0d0a 2020 2020 2320 2020 2020 6966  s"..    #     if
-00006cc0: 206c 656e 286c 6973 7428 7365 6c66 2e66   len(list(self.f
-00006cd0: 6c61 7428 7365 6c65 6374 6564 3d54 7275  lat(selected=Tru
-00006ce0: 652c 2063 6173 6361 6465 3d46 616c 7365  e, cascade=False
-00006cf0: 2c20 7479 7065 733d 6f70 6572 6174 655f  , types=operate_
-00006d00: 6e6f 6465 7329 2929 0d0a 2020 2020 2320  nodes)))..    # 
-00006d10: 2020 2020 3e20 300d 0a20 2020 2023 2020      > 0..    #  
-00006d20: 2020 2065 6c73 6520 2265 6c65 6d65 6e74     else "element
-00006d30: 2d6c 6973 7422 2c0d 0a20 2020 2023 2029  -list",..    # )
-00006d40: 0d0a 2020 2020 2320 4074 7265 655f 6f70  ..    # @tree_op
-00006d50: 6572 6174 696f 6e28 0d0a 2020 2020 2320  eration(..    # 
-00006d60: 2020 2020 5f28 2244 656c 6574 6520 2573      _("Delete %s
-00006d70: 2073 656c 6563 7465 6420 6974 656d 7320   selected items 
-00006d80: 6672 6f6d 2025 7320 2852 6566 3d25 7329  from %s (Ref=%s)
-00006d90: 2229 2025 2028 227b 6563 6f75 6e74 7d22  ") % ("{ecount}"
-00006da0: 2c20 227b 656c 6f63 7d22 2c20 227b 7263  , "{eloc}", "{rc
-00006db0: 6f75 6e74 7d22 292c 0d0a 2020 2020 2320  ount}"),..    # 
-00006dc0: 2020 2020 6e6f 6465 5f74 7970 653d 6e6f      node_type=no
-00006dd0: 6e5f 7374 7275 6374 7572 616c 5f6e 6f64  n_structural_nod
-00006de0: 6573 2c0d 0a20 2020 2023 2020 2020 2068  es,..    #     h
-00006df0: 656c 703d 2222 2c0d 0a20 2020 2023 2029  elp="",..    # )
-00006e00: 0d0a 2020 2020 2320 6465 6620 7265 6d6f  ..    # def remo
-00006e10: 7665 5f6d 756c 7469 5f6e 6f64 6573 286e  ve_multi_nodes(n
-00006e20: 6f64 652c 202a 2a6b 7761 7267 7329 3a0d  ode, **kwargs):.
-00006e30: 0a20 2020 2023 2020 2020 2069 6620 280d  .    #     if (.
-00006e40: 0a20 2020 2023 2020 2020 2020 2020 206c  .    #         l
-00006e50: 656e 286c 6973 7428 7365 6c66 2e66 6c61  en(list(self.fla
-00006e60: 7428 7365 6c65 6374 6564 3d54 7275 652c  t(selected=True,
-00006e70: 2063 6173 6361 6465 3d46 616c 7365 2c20   cascade=False, 
-00006e80: 7479 7065 733d 6f70 6572 6174 655f 6e6f  types=operate_no
-00006e90: 6465 7329 2929 0d0a 2020 2020 2320 2020  des)))..    #   
-00006ea0: 2020 2020 2020 3e20 300d 0a20 2020 2023        > 0..    #
-00006eb0: 2020 2020 2029 3a0d 0a20 2020 2023 2020       ):..    #  
-00006ec0: 2020 2020 2020 2074 7970 6573 203d 206f         types = o
-00006ed0: 7065 7261 7465 5f6e 6f64 6573 0d0a 2020  perate_nodes..  
-00006ee0: 2020 2320 2020 2020 656c 7365 3a0d 0a20    #     else:.. 
-00006ef0: 2020 2023 2020 2020 2020 2020 2074 7970     #         typ
-00006f00: 6573 203d 2065 6c65 6d5f 6772 6f75 705f  es = elem_group_
-00006f10: 6e6f 6465 730d 0a20 2020 2023 2020 2020  nodes..    #    
-00006f20: 206e 6f64 6573 203d 206c 6973 7428 7365   nodes = list(se
-00006f30: 6c66 2e66 6c61 7428 7365 6c65 6374 6564  lf.flat(selected
-00006f40: 3d54 7275 652c 2063 6173 6361 6465 3d46  =True, cascade=F
-00006f50: 616c 7365 2c20 7479 7065 733d 7479 7065  alse, types=type
-00006f60: 7329 290d 0a20 2020 2023 2020 2020 2066  s))..    #     f
-00006f70: 6f72 206e 6f64 6520 696e 206e 6f64 6573  or node in nodes
-00006f80: 3a0d 0a20 2020 2023 2020 2020 2020 2020  :..    #        
-00006f90: 2023 2049 6620 7765 2061 7265 2073 656c   # If we are sel
-00006fa0: 6563 7469 6e67 2061 6e20 6f70 6572 6174  ecting an operat
-00006fb0: 696f 6e20 2f20 616e 2065 6c65 6d65 6e74  ion / an element
-00006fc0: 2077 6974 6869 6e20 616e 206f 7065 7261   within an opera
-00006fd0: 7469 6f6e 2c20 7468 656e 2069 740d 0a20  tion, then it.. 
-00006fe0: 2020 2023 2020 2020 2020 2020 2023 2061     #         # a
-00006ff0: 6c73 6f20 7365 6c65 6374 732f 656d 7068  lso selects/emph
-00007000: 6173 697a 6573 2074 6865 2063 6f6e 7461  asizes the conta
-00007010: 696e 6564 2065 6c65 6d65 6e74 7320 696e  ined elements in
-00007020: 2074 6865 2065 6c65 6d65 6e74 7320 6272   the elements br
-00007030: 616e 6368 2e2e 2e0d 0a20 2020 2023 2020  anch.....    #  
-00007040: 2020 2020 2020 2023 2053 6f20 626f 7468         # So both
-00007050: 2077 696c 6c20 6265 2064 656c 6574 6564   will be deleted
-00007060: 2e2e 2e0d 0a20 2020 2023 2020 2020 2020  .....    #      
-00007070: 2020 2023 2054 6f20 6369 7263 756d 7665     # To circumve
-00007080: 6e74 2074 6869 732c 2077 6520 696e 7175  nt this, we inqu
-00007090: 6972 6520 6f6e 6365 206d 6f72 6520 7468  ire once more th
-000070a0: 6520 7365 6c65 6374 6564 2073 7461 7475  e selected statu
-000070b0: 732e 2e2e 0d0a 2020 2020 2320 2020 2020  s.....    #     
-000070c0: 2020 2020 6966 206e 6f64 652e 7365 6c65      if node.sele
-000070d0: 6374 6564 3a0d 0a20 2020 2023 2020 2020  cted:..    #    
-000070e0: 2020 2020 2020 2020 2069 6620 6e6f 6465           if node
-000070f0: 2e70 6172 656e 7420 6973 206e 6f74 204e  .parent is not N
-00007100: 6f6e 653a 2020 2320 4d61 7920 6861 7665  one:  # May have
-00007110: 2061 6c72 6561 6479 2072 656d 6f76 6564   already removed
-00007120: 2e0d 0a20 2020 2023 2020 2020 2020 2020  ...    #        
-00007130: 2020 2020 2020 2020 206e 6f64 652e 7265           node.re
-00007140: 6d6f 7665 5f6e 6f64 6528 290d 0a20 2020  move_node()..   
-00007150: 2023 2020 2020 2073 656c 662e 7365 745f   #     self.set_
-00007160: 656d 7068 6173 6973 284e 6f6e 6529 0d0a  emphasis(None)..
-00007170: 0d0a 2020 2020 2320 3d3d 3d3d 3d3d 3d3d  ..    # ========
-00007180: 3d3d 0d0a 2020 2020 2320 5245 4d4f 5645  ==..    # REMOVE
-00007190: 2053 494e 474c 4520 2854 7265 6520 5365   SINGLE (Tree Se
-000071a0: 6c65 6374 6564 202d 2045 4c45 4d45 4e54  lected - ELEMENT
-000071b0: 290d 0a20 2020 2023 203d 3d3d 3d3d 3d3d  )..    # =======
-000071c0: 3d3d 3d0d 0a20 2020 2040 7472 6565 5f63  ===..    @tree_c
-000071d0: 6f6e 6469 7469 6f6e 616c 286c 616d 6264  onditional(lambd
-000071e0: 6120 6e6f 6465 3a20 6e6f 7420 6e6f 6465  a node: not node
-000071f0: 2e6c 6f63 6b29 0d0a 2020 2020 4074 7265  .lock)..    @tre
-00007200: 655f 636f 6e64 6974 696f 6e61 6c28 0d0a  e_conditional(..
-00007210: 2020 2020 2020 2020 6c61 6d62 6461 2063          lambda c
-00007220: 6f6e 643a 206c 656e 280d 0a20 2020 2020  ond: len(..     
-00007230: 2020 2020 2020 206c 6973 7428 7365 6c66         list(self
-00007240: 2e66 6c61 7428 7365 6c65 6374 6564 3d54  .flat(selected=T
-00007250: 7275 652c 2063 6173 6361 6465 3d46 616c  rue, cascade=Fal
-00007260: 7365 2c20 7479 7065 733d 656c 656d 5f6e  se, types=elem_n
-00007270: 6f64 6573 2929 0d0a 2020 2020 2020 2020  odes))..        
-00007280: 290d 0a20 2020 2020 2020 203d 3d20 310d  )..        == 1.
-00007290: 0a20 2020 2029 0d0a 2020 2020 4074 7265  .    )..    @tre
-000072a0: 655f 6f70 6572 6174 696f 6e28 0d0a 2020  e_operation(..  
-000072b0: 2020 2020 2020 5f28 2244 656c 6574 6520        _("Delete 
-000072c0: 656c 656d 656e 7420 277b 6e61 6d65 7d27  element '{name}'
-000072d0: 2066 756c 6c79 2229 2c0d 0a20 2020 2020   fully"),..     
-000072e0: 2020 206e 6f64 655f 7479 7065 3d65 6c65     node_type=ele
-000072f0: 6d5f 6e6f 6465 732c 0d0a 2020 2020 2020  m_nodes,..      
-00007300: 2020 6865 6c70 3d22 222c 0d0a 2020 2020    help="",..    
-00007310: 290d 0a20 2020 2064 6566 2072 656d 6f76  )..    def remov
-00007320: 655f 7479 7065 5f65 6c65 6d28 6e6f 6465  e_type_elem(node
-00007330: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
-00007340: 2020 2020 2020 6966 2068 6173 6174 7472        if hasattr
-00007350: 286e 6f64 652c 2022 6c6f 636b 2229 2061  (node, "lock") a
-00007360: 6e64 206e 6f64 652e 6c6f 636b 3a0d 0a20  nd node.lock:.. 
-00007370: 2020 2020 2020 2020 2020 2070 6173 730d             pass.
-00007380: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
-00007390: 2020 2020 2020 2020 2020 2020 6e6f 6465              node
-000073a0: 2e72 656d 6f76 655f 6e6f 6465 2829 0d0a  .remove_node()..
-000073b0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000073c0: 2e73 6574 5f65 6d70 6861 7369 7328 4e6f  .set_emphasis(No
-000073d0: 6e65 290d 0a0d 0a20 2020 2040 7472 6565  ne)....    @tree
-000073e0: 5f63 6f6e 6469 7469 6f6e 616c 280d 0a20  _conditional(.. 
-000073f0: 2020 2020 2020 206c 616d 6264 6120 636f         lambda co
-00007400: 6e64 3a20 6c65 6e28 6c69 7374 2873 656c  nd: len(list(sel
-00007410: 662e 666c 6174 2873 656c 6563 7465 643d  f.flat(selected=
-00007420: 5472 7565 2c20 6361 7363 6164 653d 4661  True, cascade=Fa
-00007430: 6c73 652c 2074 7970 6573 3d6f 705f 6e6f  lse, types=op_no
-00007440: 6465 7329 2929 0d0a 2020 2020 2020 2020  des)))..        
-00007450: 3d3d 2031 0d0a 2020 2020 290d 0a20 2020  == 1..    )..   
-00007460: 2040 7472 6565 5f6f 7065 7261 7469 6f6e   @tree_operation
-00007470: 280d 0a20 2020 2020 2020 205f 2822 4465  (..        _("De
-00007480: 6c65 7465 206f 7065 7261 7469 6f6e 2027  lete operation '
-00007490: 7b6e 616d 657d 2720 6675 6c6c 7922 292c  {name}' fully"),
-000074a0: 0d0a 2020 2020 2020 2020 6e6f 6465 5f74  ..        node_t
-000074b0: 7970 653d 6f70 5f6e 6f64 6573 2c0d 0a20  ype=op_nodes,.. 
-000074c0: 2020 2020 2020 2068 656c 703d 2222 2c0d         help="",.
-000074d0: 0a20 2020 2029 0d0a 2020 2020 6465 6620  .    )..    def 
-000074e0: 7265 6d6f 7665 5f74 7970 655f 6f70 286e  remove_type_op(n
-000074f0: 6f64 652c 202a 2a6b 7761 7267 7329 3a0d  ode, **kwargs):.
-00007500: 0a0d 0a20 2020 2020 2020 206e 6f64 652e  ...        node.
-00007510: 7265 6d6f 7665 5f6e 6f64 6528 290d 0a20  remove_node().. 
-00007520: 2020 2020 2020 2073 656c 662e 7365 745f         self.set_
-00007530: 656d 7068 6173 6973 284e 6f6e 6529 0d0a  emphasis(None)..
-00007540: 2020 2020 2020 2020 7365 6c66 2e73 6967          self.sig
-00007550: 6e61 6c28 226f 7065 7261 7469 6f6e 5f72  nal("operation_r
-00007560: 656d 6f76 6564 2229 0d0a 0d0a 2020 2020  emoved")....    
-00007570: 4074 7265 655f 636f 6e64 6974 696f 6e61  @tree_conditiona
-00007580: 6c28 0d0a 2020 2020 2020 2020 6c61 6d62  l(..        lamb
-00007590: 6461 2063 6f6e 643a 206c 656e 286c 6973  da cond: len(lis
-000075a0: 7428 7365 6c66 2e66 6c61 7428 7365 6c65  t(self.flat(sele
-000075b0: 6374 6564 3d54 7275 652c 2063 6173 6361  cted=True, casca
-000075c0: 6465 3d46 616c 7365 2c20 7479 7065 733d  de=False, types=
-000075d0: 2262 6c6f 6222 2929 290d 0a20 2020 2020  "blob")))..     
-000075e0: 2020 203d 3d20 310d 0a20 2020 2029 0d0a     == 1..    )..
-000075f0: 2020 2020 4074 7265 655f 6f70 6572 6174      @tree_operat
-00007600: 696f 6e28 0d0a 2020 2020 2020 2020 5f28  ion(..        _(
-00007610: 2244 656c 6574 6520 626c 6f62 2027 7b6e  "Delete blob '{n
-00007620: 616d 657d 2720 6675 6c6c 7922 292c 0d0a  ame}' fully"),..
-00007630: 2020 2020 2020 2020 6e6f 6465 5f74 7970          node_typ
-00007640: 653d 2262 6c6f 6222 2c0d 0a20 2020 2020  e="blob",..     
-00007650: 2020 2068 656c 703d 2222 2c0d 0a20 2020     help="",..   
-00007660: 2029 0d0a 2020 2020 6465 6620 7265 6d6f   )..    def remo
-00007670: 7665 5f74 7970 655f 626c 6f62 286e 6f64  ve_type_blob(nod
-00007680: 652c 202a 2a6b 7761 7267 7329 3a0d 0a20  e, **kwargs):.. 
-00007690: 2020 2020 2020 206e 6f64 652e 7265 6d6f         node.remo
-000076a0: 7665 5f6e 6f64 6528 290d 0a20 2020 2020  ve_node()..     
-000076b0: 2020 2073 656c 662e 7365 745f 656d 7068     self.set_emph
-000076c0: 6173 6973 284e 6f6e 6529 0d0a 2020 2020  asis(None)..    
-000076d0: 2020 2020 7365 6c66 2e73 6967 6e61 6c28      self.signal(
-000076e0: 226f 7065 7261 7469 6f6e 5f72 656d 6f76  "operation_remov
-000076f0: 6564 2229 0d0a 0d0a 2020 2020 4074 7265  ed")....    @tre
-00007700: 655f 636f 6e64 6974 696f 6e61 6c28 0d0a  e_conditional(..
-00007710: 2020 2020 2020 2020 6c61 6d62 6461 2063          lambda c
-00007720: 6f6e 643a 206c 656e 286c 6973 7428 7365  ond: len(list(se
-00007730: 6c66 2e66 6c61 7428 7365 6c65 6374 6564  lf.flat(selected
-00007740: 3d54 7275 652c 2063 6173 6361 6465 3d46  =True, cascade=F
-00007750: 616c 7365 2c20 7479 7065 733d 6f70 5f6e  alse, types=op_n
-00007760: 6f64 6573 2929 290d 0a20 2020 2020 2020  odes)))..       
-00007770: 203e 2031 0d0a 2020 2020 290d 0a20 2020   > 1..    )..   
-00007780: 2040 7472 6565 5f63 616c 6328 0d0a 2020   @tree_calc(..  
-00007790: 2020 2020 2020 2265 636f 756e 7422 2c0d        "ecount",.
-000077a0: 0a20 2020 2020 2020 206c 616d 6264 6120  .        lambda 
-000077b0: 693a 206c 656e 286c 6973 7428 7365 6c66  i: len(list(self
-000077c0: 2e66 6c61 7428 7365 6c65 6374 6564 3d54  .flat(selected=T
-000077d0: 7275 652c 2063 6173 6361 6465 3d46 616c  rue, cascade=Fal
-000077e0: 7365 2c20 7479 7065 733d 6f70 5f6e 6f64  se, types=op_nod
-000077f0: 6573 2929 292c 0d0a 2020 2020 290d 0a20  es))),..    ).. 
-00007800: 2020 2040 7472 6565 5f6f 7065 7261 7469     @tree_operati
-00007810: 6f6e 280d 0a20 2020 2020 2020 205f 2822  on(..        _("
-00007820: 4465 6c65 7465 207b 6563 6f75 6e74 7d20  Delete {ecount} 
-00007830: 6f70 6572 6174 696f 6e73 2066 756c 6c79  operations fully
-00007840: 2229 2c0d 0a20 2020 2020 2020 206e 6f64  "),..        nod
-00007850: 655f 7479 7065 3d6f 705f 6e6f 6465 732c  e_type=op_nodes,
-00007860: 0d0a 2020 2020 2020 2020 6865 6c70 3d22  ..        help="
-00007870: 222c 0d0a 2020 2020 290d 0a20 2020 2064  ",..    )..    d
-00007880: 6566 2072 656d 6f76 655f 7479 7065 5f6f  ef remove_type_o
-00007890: 705f 6d75 6c74 6970 6c65 286e 6f64 652c  p_multiple(node,
-000078a0: 202a 2a6b 7761 7267 7329 3a0d 0a20 2020   **kwargs):..   
-000078b0: 2020 2020 2066 6f72 206f 7020 696e 206c       for op in l
-000078c0: 6973 7428 7365 6c66 2e66 6c61 7428 7365  ist(self.flat(se
-000078d0: 6c65 6374 6564 3d54 7275 652c 2063 6173  lected=True, cas
-000078e0: 6361 6465 3d46 616c 7365 2c20 7479 7065  cade=False, type
-000078f0: 733d 6f70 5f6e 6f64 6573 2929 3a0d 0a20  s=op_nodes)):.. 
-00007900: 2020 2020 2020 2020 2020 206f 702e 7265             op.re
-00007910: 6d6f 7665 5f6e 6f64 6528 290d 0a20 2020  move_node()..   
-00007920: 2020 2020 2073 656c 662e 7365 745f 656d       self.set_em
-00007930: 7068 6173 6973 284e 6f6e 6529 0d0a 2020  phasis(None)..  
-00007940: 2020 2020 2020 7365 6c66 2e73 6967 6e61        self.signa
-00007950: 6c28 226f 7065 7261 7469 6f6e 5f72 656d  l("operation_rem
-00007960: 6f76 6564 2229 0d0a 0d0a 2020 2020 6465  oved")....    de
-00007970: 6620 636f 6e74 6169 6e73 5f6e 6f5f 6c6f  f contains_no_lo
-00007980: 636b 6564 5f69 7465 6d73 2829 3a0d 0a20  cked_items():.. 
-00007990: 2020 2020 2020 206e 6f6c 6f63 6b20 3d20         nolock = 
-000079a0: 5472 7565 0d0a 2020 2020 2020 2020 666f  True..        fo
-000079b0: 7220 6520 696e 206c 6973 7428 7365 6c66  r e in list(self
-000079c0: 2e66 6c61 7428 7365 6c65 6374 6564 3d54  .flat(selected=T
-000079d0: 7275 652c 2063 6173 6361 6465 3d54 7275  rue, cascade=Tru
-000079e0: 6529 293a 0d0a 2020 2020 2020 2020 2020  e)):..          
-000079f0: 2020 6966 2068 6173 6174 7472 2865 2c20    if hasattr(e, 
-00007a00: 226c 6f63 6b22 2920 616e 6420 652e 6c6f  "lock") and e.lo
-00007a10: 636b 3a0d 0a20 2020 2020 2020 2020 2020  ck:..           
-00007a20: 2020 2020 206e 6f6c 6f63 6b20 3d20 4661       nolock = Fa
-00007a30: 6c73 650d 0a20 2020 2020 2020 2020 2020  lse..           
-00007a40: 2020 2020 2062 7265 616b 0d0a 2020 2020       break..    
-00007a50: 2020 2020 7265 7475 726e 206e 6f6c 6f63      return noloc
-00007a60: 6b0d 0a0d 0a20 2020 2040 7472 6565 5f63  k....    @tree_c
-00007a70: 6f6e 6469 7469 6f6e 616c 286c 616d 6264  onditional(lambd
-00007a80: 6120 636f 6e64 3a20 636f 6e74 6169 6e73  a cond: contains
-00007a90: 5f6e 6f5f 6c6f 636b 6564 5f69 7465 6d73  _no_locked_items
-00007aa0: 2829 290d 0a20 2020 2040 7472 6565 5f63  ())..    @tree_c
-00007ab0: 6f6e 6469 7469 6f6e 616c 280d 0a20 2020  onditional(..   
-00007ac0: 2020 2020 206c 616d 6264 6120 636f 6e64       lambda cond
-00007ad0: 3a20 6c65 6e28 0d0a 2020 2020 2020 2020  : len(..        
-00007ae0: 2020 2020 6c69 7374 2873 656c 662e 666c      list(self.fl
-00007af0: 6174 2873 656c 6563 7465 643d 5472 7565  at(selected=True
-00007b00: 2c20 6361 7363 6164 653d 4661 6c73 652c  , cascade=False,
-00007b10: 2074 7970 6573 3d28 2266 696c 6522 2c20   types=("file", 
-00007b20: 2267 726f 7570 2229 2929 0d0a 2020 2020  "group")))..    
-00007b30: 2020 2020 290d 0a20 2020 2020 2020 203d      )..        =
-00007b40: 3d20 310d 0a20 2020 2029 0d0a 2020 2020  = 1..    )..    
-00007b50: 4074 7265 655f 6f70 6572 6174 696f 6e28  @tree_operation(
-00007b60: 0d0a 2020 2020 2020 2020 5f28 2244 656c  ..        _("Del
-00007b70: 6574 6520 6772 6f75 7020 277b 6e61 6d65  ete group '{name
-00007b80: 7d27 2061 6e64 2061 6c6c 2069 7473 2063  }' and all its c
-00007b90: 6869 6c64 2d65 6c65 6d65 6e74 7320 6675  hild-elements fu
-00007ba0: 6c6c 7922 292c 0d0a 2020 2020 2020 2020  lly"),..        
-00007bb0: 6e6f 6465 5f74 7970 653d 2267 726f 7570  node_type="group
-00007bc0: 222c 0d0a 2020 2020 2020 2020 6865 6c70  ",..        help
-00007bd0: 3d22 222c 0d0a 2020 2020 290d 0a20 2020  ="",..    )..   
-00007be0: 2064 6566 2072 656d 6f76 655f 7479 7065   def remove_type
-00007bf0: 5f67 7270 286e 6f64 652c 202a 2a6b 7761  _grp(node, **kwa
-00007c00: 7267 7329 3a0d 0a20 2020 2020 2020 206e  rgs):..        n
-00007c10: 6f64 652e 7265 6d6f 7665 5f6e 6f64 6528  ode.remove_node(
-00007c20: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-00007c30: 7365 745f 656d 7068 6173 6973 284e 6f6e  set_emphasis(Non
-00007c40: 6529 0d0a 0d0a 2020 2020 4074 7265 655f  e)....    @tree_
-00007c50: 636f 6e64 6974 696f 6e61 6c28 6c61 6d62  conditional(lamb
-00007c60: 6461 2063 6f6e 643a 2063 6f6e 7461 696e  da cond: contain
-00007c70: 735f 6e6f 5f6c 6f63 6b65 645f 6974 656d  s_no_locked_item
-00007c80: 7328 2929 0d0a 2020 2020 4074 7265 655f  s())..    @tree_
-00007c90: 636f 6e64 6974 696f 6e61 6c28 0d0a 2020  conditional(..  
-00007ca0: 2020 2020 2020 6c61 6d62 6461 2063 6f6e        lambda con
-00007cb0: 643a 206c 656e 280d 0a20 2020 2020 2020  d: len(..       
-00007cc0: 2020 2020 206c 6973 7428 7365 6c66 2e66       list(self.f
-00007cd0: 6c61 7428 7365 6c65 6374 6564 3d54 7275  lat(selected=Tru
-00007ce0: 652c 2063 6173 6361 6465 3d46 616c 7365  e, cascade=False
-00007cf0: 2c20 7479 7065 733d 2822 6669 6c65 222c  , types=("file",
-00007d00: 2022 6772 6f75 7022 2929 290d 0a20 2020   "group")))..   
-00007d10: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
-00007d20: 3d3d 2031 0d0a 2020 2020 290d 0a20 2020  == 1..    )..   
-00007d30: 2040 7472 6565 5f6f 7065 7261 7469 6f6e   @tree_operation
-00007d40: 280d 0a20 2020 2020 2020 205f 2822 5265  (..        _("Re
-00007d50: 6d6f 7665 206c 6f61 6465 6420 6669 6c65  move loaded file
-00007d60: 2027 7b6e 616d 657d 2720 616e 6420 616c   '{name}' and al
-00007d70: 6c20 6974 7320 6368 696c 642d 656c 656d  l its child-elem
-00007d80: 656e 7473 2066 756c 6c79 2229 2c0d 0a20  ents fully"),.. 
-00007d90: 2020 2020 2020 206e 6f64 655f 7479 7065         node_type
-00007da0: 3d22 6669 6c65 222c 0d0a 2020 2020 2020  ="file",..      
-00007db0: 2020 6865 6c70 3d22 222c 0d0a 2020 2020    help="",..    
-00007dc0: 290d 0a20 2020 2064 6566 2072 656d 6f76  )..    def remov
-00007dd0: 655f 7479 7065 5f66 696c 6528 6e6f 6465  e_type_file(node
-00007de0: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
-00007df0: 2020 2020 2020 6e6f 6465 2e72 656d 6f76        node.remov
-00007e00: 655f 6e6f 6465 2829 0d0a 2020 2020 2020  e_node()..      
-00007e10: 2020 7365 6c66 2e73 6574 5f65 6d70 6861    self.set_empha
-00007e20: 7369 7328 4e6f 6e65 290d 0a0d 0a20 2020  sis(None)....   
-00007e30: 2040 7472 6565 5f63 6f6e 6469 7469 6f6e   @tree_condition
-00007e40: 616c 286c 616d 6264 6120 6e6f 6465 3a20  al(lambda node: 
-00007e50: 6e6f 7420 6973 5f72 6567 6d61 726b 286e  not is_regmark(n
-00007e60: 6f64 6529 290d 0a20 2020 2040 7472 6565  ode))..    @tree
-00007e70: 5f6f 7065 7261 7469 6f6e 280d 0a20 2020  _operation(..   
-00007e80: 2020 2020 205f 2822 5265 6d6f 7665 2074       _("Remove t
-00007e90: 7261 6e73 7061 7265 6e74 206f 626a 6563  ransparent objec
-00007ea0: 7473 2229 2c0d 0a20 2020 2020 2020 206e  ts"),..        n
-00007eb0: 6f64 655f 7479 7065 3d28 2267 726f 7570  ode_type=("group
-00007ec0: 222c 2022 6669 6c65 2229 2c0d 0a20 2020  ", "file"),..   
-00007ed0: 2020 2020 2068 656c 703d 5f28 2252 656d       help=_("Rem
-00007ee0: 6f76 6520 616c 6c20 656c 656d 656e 7473  ove all elements
-00007ef0: 2074 6861 7420 6e65 6974 6865 7220 6861   that neither ha
-00007f00: 7665 2061 2062 6f72 6465 7220 6e6f 7220  ve a border nor 
-00007f10: 6120 6669 6c6c 2063 6f6c 6f72 2229 2c0d  a fill color"),.
-00007f20: 0a20 2020 2029 0d0a 2020 2020 6465 6620  .    )..    def 
-00007f30: 7265 6d6f 7665 5f74 7261 6e73 7061 7265  remove_transpare
-00007f40: 6e74 286e 6f64 652c 202a 2a6b 7761 7267  nt(node, **kwarg
-00007f50: 7329 3a0d 0a20 2020 2020 2020 2072 6573  s):..        res
-00007f60: 203d 2030 0d0a 2020 2020 2020 2020 746f   = 0..        to
-00007f70: 5f72 656d 6f76 6520 3d20 5b5d 0d0a 2020  _remove = []..  
-00007f80: 2020 2020 2020 666f 7220 656e 6f64 6520        for enode 
-00007f90: 696e 2073 656c 662e 666c 6174 280d 0a20  in self.flat(.. 
-00007fa0: 2020 2020 2020 2020 2020 2073 656c 6563             selec
-00007fb0: 7465 643d 5472 7565 2c0d 0a20 2020 2020  ted=True,..     
-00007fc0: 2020 2020 2020 2063 6173 6361 6465 3d54         cascade=T
-00007fd0: 7275 652c 0d0a 2020 2020 2020 2020 2020  rue,..          
-00007fe0: 2020 7479 7065 733d 280d 0a20 2020 2020    types=(..     
-00007ff0: 2020 2020 2020 2020 2020 2022 656c 656d             "elem
-00008000: 2072 6563 7422 2c0d 0a20 2020 2020 2020   rect",..       
-00008010: 2020 2020 2020 2020 2022 656c 656d 2065           "elem e
-00008020: 6c6c 6970 7365 222c 0d0a 2020 2020 2020  llipse",..      
-00008030: 2020 2020 2020 2020 2020 2265 6c65 6d20            "elem 
-00008040: 7061 7468 222c 0d0a 2020 2020 2020 2020  path",..        
-00008050: 2020 2020 2020 2020 2265 6c65 6d20 6c69          "elem li
-00008060: 6e65 222c 0d0a 2020 2020 2020 2020 2020  ne",..          
-00008070: 2020 2020 2020 2265 6c65 6d20 706f 6c79        "elem poly
-00008080: 6c69 6e65 222c 0d0a 2020 2020 2020 2020  line",..        
-00008090: 2020 2020 292c 0d0a 2020 2020 2020 2020      ),..        
-000080a0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-000080b0: 636f 6c6f 7265 6420 3d20 4661 6c73 650d  colored = False.
-000080c0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000080d0: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
-000080e0: 2020 2068 6173 6174 7472 2865 6e6f 6465     hasattr(enode
-000080f0: 2c20 2266 696c 6c22 290d 0a20 2020 2020  , "fill")..     
-00008100: 2020 2020 2020 2020 2020 2061 6e64 2065             and e
-00008110: 6e6f 6465 2e66 696c 6c20 6973 206e 6f74  node.fill is not
-00008120: 204e 6f6e 650d 0a20 2020 2020 2020 2020   None..         
-00008130: 2020 2020 2020 2061 6e64 2065 6e6f 6465         and enode
-00008140: 2e66 696c 6c2e 6172 6762 2069 7320 6e6f  .fill.argb is no
-00008150: 7420 4e6f 6e65 0d0a 2020 2020 2020 2020  t None..        
-00008160: 2020 2020 293a 0d0a 2020 2020 2020 2020      ):..        
-00008170: 2020 2020 2020 2020 636f 6c6f 7265 6420          colored 
-00008180: 3d20 5472 7565 0d0a 2020 2020 2020 2020  = True..        
-00008190: 2020 2020 6966 2028 0d0a 2020 2020 2020      if (..      
-000081a0: 2020 2020 2020 2020 2020 6861 7361 7474            hasatt
-000081b0: 7228 656e 6f64 652c 2022 7374 726f 6b65  r(enode, "stroke
-000081c0: 2229 0d0a 2020 2020 2020 2020 2020 2020  ")..            
-000081d0: 2020 2020 616e 6420 656e 6f64 652e 7374      and enode.st
-000081e0: 726f 6b65 2069 7320 6e6f 7420 4e6f 6e65  roke is not None
-000081f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00008200: 2020 616e 6420 656e 6f64 652e 7374 726f    and enode.stro
-00008210: 6b65 2e61 7267 6220 6973 206e 6f74 204e  ke.argb is not N
-00008220: 6f6e 650d 0a20 2020 2020 2020 2020 2020  one..           
-00008230: 2029 3a0d 0a20 2020 2020 2020 2020 2020   ):..           
-00008240: 2020 2020 2063 6f6c 6f72 6564 203d 2054       colored = T
-00008250: 7275 650d 0a20 2020 2020 2020 2020 2020  rue..           
-00008260: 2069 6620 6e6f 7420 636f 6c6f 7265 643a   if not colored:
-00008270: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00008280: 2020 7265 7320 2b3d 2031 0d0a 2020 2020    res += 1..    
-00008290: 2020 2020 2020 2020 2020 2020 656e 6f64              enod
-000082a0: 652e 7265 6d6f 7665 5f6e 6f64 6528 290d  e.remove_node().
-000082b0: 0a0d 0a20 2020 2020 2020 2069 6620 7265  ...        if re
-000082c0: 7320 3e20 303a 0d0a 2020 2020 2020 2020  s > 0:..        
-000082d0: 2020 2020 7365 6c66 2e73 6967 6e61 6c28      self.signal(
-000082e0: 2272 6562 7569 6c64 5f74 7265 6522 290d  "rebuild_tree").
-000082f0: 0a0d 0a20 2020 2023 203d 3d3d 3d3d 3d3d  ...    # =======
-00008300: 3d3d 3d0d 0a20 2020 2023 2052 656d 6f76  ===..    # Remov
-00008310: 6520 4f70 6572 6174 696f 6e73 2028 4966  e Operations (If
-00008320: 204e 6f20 5472 6565 2053 656c 6563 7465   No Tree Selecte
-00008330: 6429 0d0a 2020 2020 2320 4e6f 7465 3a20  d)..    # Note: 
-00008340: 5468 6973 2063 6f64 6520 776f 756c 6420  This code would 
-00008350: 7261 7265 6c79 206d 6174 6368 2061 6e79  rarely match any
-00008360: 7468 696e 6720 7369 6e63 6520 7468 6520  thing since the 
-00008370: 7472 6565 2073 656c 6563 7465 6420 7769  tree selected wi
-00008380: 6c6c 2061 6c6d 6f73 7420 616c 7761 7973  ll almost always
-00008390: 2062 6520 7472 7565 2069 6620 7765 2068   be true if we h
-000083a0: 6176 650d 0a20 2020 2023 206d 6174 6368  ave..    # match
-000083b0: 2074 6869 7320 636f 6e64 6974 696f 6e61   this conditiona
-000083c0: 6c2e 2054 6865 2074 7265 652d 7365 6c65  l. The tree-sele
-000083d0: 6374 6564 2064 656c 6574 6520 6675 6e63  cted delete func
-000083e0: 7469 6f6e 7320 6172 6520 7375 7065 7269  tions are superi
-000083f0: 6f72 2e0d 0a20 2020 2023 203d 3d3d 3d3d  or...    # =====
-00008400: 3d3d 3d3d 3d0d 0a20 2020 2040 7472 6565  =====..    @tree
-00008410: 5f63 6f6e 6469 7469 6f6e 616c 280d 0a20  _conditional(.. 
-00008420: 2020 2020 2020 206c 616d 6264 6120 636f         lambda co
-00008430: 6e64 3a20 6c65 6e28 0d0a 2020 2020 2020  nd: len(..      
-00008440: 2020 2020 2020 6c69 7374 2873 656c 662e        list(self.
-00008450: 666c 6174 2873 656c 6563 7465 643d 5472  flat(selected=Tr
-00008460: 7565 2c20 6361 7363 6164 653d 4661 6c73  ue, cascade=Fals
-00008470: 652c 2074 7970 6573 3d6e 6f6e 5f73 7472  e, types=non_str
-00008480: 7563 7475 7261 6c5f 6e6f 6465 7329 290d  uctural_nodes)).
-00008490: 0a20 2020 2020 2020 2029 0d0a 2020 2020  .        )..    
-000084a0: 2020 2020 3d3d 2030 0d0a 2020 2020 290d      == 0..    ).
-000084b0: 0a20 2020 2040 7472 6565 5f63 6f6e 6469  .    @tree_condi
-000084c0: 7469 6f6e 616c 286c 616d 6264 6120 6e6f  tional(lambda no
-000084d0: 6465 3a20 6c65 6e28 6c69 7374 2873 656c  de: len(list(sel
-000084e0: 662e 6f70 7328 7365 6c65 6374 6564 3d54  f.ops(selected=T
-000084f0: 7275 6529 2929 203e 2031 290d 0a20 2020  rue))) > 1)..   
-00008500: 2040 7472 6565 5f63 616c 6328 2265 636f   @tree_calc("eco
-00008510: 756e 7422 2c20 6c61 6d62 6461 2069 3a20  unt", lambda i: 
-00008520: 6c65 6e28 6c69 7374 2873 656c 662e 6f70  len(list(self.op
-00008530: 7328 7365 6c65 6374 6564 3d54 7275 6529  s(selected=True)
-00008540: 2929 290d 0a20 2020 2040 7472 6565 5f6f  )))..    @tree_o
-00008550: 7065 7261 7469 6f6e 280d 0a20 2020 2020  peration(..     
-00008560: 2020 205f 2822 4465 6c65 7465 207b 6563     _("Delete {ec
-00008570: 6f75 6e74 7d20 6f70 6572 6174 696f 6e73  ount} operations
-00008580: 2229 2c0d 0a20 2020 2020 2020 206e 6f64  "),..        nod
-00008590: 655f 7479 7065 3d28 0d0a 2020 2020 2020  e_type=(..      
-000085a0: 2020 2020 2020 226f 7020 6375 7422 2c0d        "op cut",.
-000085b0: 0a20 2020 2020 2020 2020 2020 2022 6f70  .            "op
-000085c0: 2072 6173 7465 7222 2c0d 0a20 2020 2020   raster",..     
-000085d0: 2020 2020 2020 2022 6f70 2069 6d61 6765         "op image
-000085e0: 222c 0d0a 2020 2020 2020 2020 2020 2020  ",..            
-000085f0: 226f 7020 656e 6772 6176 6522 2c0d 0a20  "op engrave",.. 
-00008600: 2020 2020 2020 2020 2020 2022 6f70 2064             "op d
-00008610: 6f74 7322 2c0d 0a20 2020 2020 2020 2020  ots",..         
-00008620: 2020 2022 6f70 2068 6174 6368 222c 0d0a     "op hatch",..
-00008630: 2020 2020 2020 2020 2020 2020 2275 7469              "uti
-00008640: 6c20 636f 6e73 6f6c 6522 2c0d 0a20 2020  l console",..   
-00008650: 2020 2020 2020 2020 2022 7574 696c 2077           "util w
-00008660: 6169 7422 2c0d 0a20 2020 2020 2020 2020  ait",..         
-00008670: 2020 2022 7574 696c 2068 6f6d 6522 2c0d     "util home",.
-00008680: 0a20 2020 2020 2020 2020 2020 2022 7574  .            "ut
-00008690: 696c 2067 6f74 6f22 2c0d 0a20 2020 2020  il goto",..     
-000086a0: 2020 2020 2020 2022 7574 696c 206f 7269         "util ori
-000086b0: 6769 6e22 2c0d 0a20 2020 2020 2020 2020  gin",..         
-000086c0: 2020 2022 7574 696c 206f 7574 7075 7422     "util output"
-000086d0: 2c0d 0a20 2020 2020 2020 2020 2020 2022  ,..            "
-000086e0: 7574 696c 2069 6e70 7574 222c 0d0a 2020  util input",..  
-000086f0: 2020 2020 2020 2020 2020 226c 6173 6572            "laser
-00008700: 636f 6465 222c 0d0a 2020 2020 2020 2020  code",..        
-00008710: 2020 2020 2263 7574 636f 6465 222c 0d0a      "cutcode",..
-00008720: 2020 2020 2020 2020 2020 2020 2262 6c6f              "blo
-00008730: 6222 2c0d 0a20 2020 2020 2020 2029 2c0d  b",..        ),.
-00008740: 0a20 2020 2020 2020 2068 656c 703d 2222  .        help=""
-00008750: 2c0d 0a20 2020 2029 0d0a 2020 2020 6465  ,..    )..    de
-00008760: 6620 7265 6d6f 7665 5f6e 5f6f 7073 286e  f remove_n_ops(n
-00008770: 6f64 652c 202a 2a6b 7761 7267 7329 3a0d  ode, **kwargs):.
-00008780: 0a20 2020 2020 2020 2073 656c 6628 226f  .        self("o
-00008790: 7065 7261 7469 6f6e 2064 656c 6574 655c  peration delete\
-000087a0: 6e22 290d 0a0d 0a20 2020 2040 7472 6565  n")....    @tree
-000087b0: 5f6f 7065 7261 7469 6f6e 280d 0a20 2020  _operation(..   
-000087c0: 2020 2020 205f 2822 5365 6c65 6374 2061       _("Select a
-000087d0: 6c6c 2065 6c65 6d65 6e74 7320 6f66 2073  ll elements of s
-000087e0: 616d 6520 7479 7065 2229 2c0d 0a20 2020  ame type"),..   
-000087f0: 2020 2020 206e 6f64 655f 7479 7065 3d65       node_type=e
-00008800: 6c65 6d5f 6e6f 6465 732c 0d0a 2020 2020  lem_nodes,..    
-00008810: 2020 2020 6865 6c70 3d5f 2822 5365 6c65      help=_("Sele
-00008820: 6374 2061 6c6c 2065 6c65 6d65 6e74 7320  ct all elements 
-00008830: 696e 2073 6365 6e65 2c20 7468 6174 2068  in scene, that h
-00008840: 6176 6520 7468 6520 7361 6d65 2074 7970  ave the same typ
-00008850: 6520 6173 2074 6869 7320 6e6f 6465 2229  e as this node")
-00008860: 2c0d 0a20 2020 2029 0d0a 2020 2020 6465  ,..    )..    de
-00008870: 6620 7365 6c65 6374 5f73 696d 696c 6172  f select_similar
-00008880: 286e 6f64 652c 202a 2a6b 7761 7267 7329  (node, **kwargs)
-00008890: 3a0d 0a20 2020 2020 2020 206e 7479 7065  :..        ntype
-000088a0: 203d 206e 6f64 652e 7479 7065 0d0a 2020   = node.type..  
-000088b0: 2020 2020 2020 6368 616e 6765 7320 3d20        changes = 
-000088c0: 4661 6c73 650d 0a20 2020 2020 2020 2066  False..        f
-000088d0: 6f72 2065 2069 6e20 7365 6c66 2e65 6c65  or e in self.ele
-000088e0: 6d73 2829 3a0d 0a20 2020 2020 2020 2020  ms():..         
-000088f0: 2020 2069 6620 652e 7479 7065 203d 3d20     if e.type == 
-00008900: 6e74 7970 6520 616e 6420 6e6f 7420 652e  ntype and not e.
-00008910: 656d 7068 6173 697a 6564 3a0d 0a20 2020  emphasized:..   
-00008920: 2020 2020 2020 2020 2020 2020 2065 2e65               e.e
-00008930: 6d70 6861 7369 7a65 6420 3d20 5472 7565  mphasized = True
-00008940: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00008950: 2020 652e 7365 6c65 6374 6564 203d 2054    e.selected = T
-00008960: 7275 650d 0a20 2020 2020 2020 2020 2020  rue..           
-00008970: 2020 2020 2063 6861 6e67 6573 203d 2054       changes = T
-00008980: 7275 650d 0a20 2020 2020 2020 2069 6620  rue..        if 
-00008990: 6368 616e 6765 733a 0d0a 2020 2020 2020  changes:..      
-000089a0: 2020 2020 2020 7365 6c66 2e76 616c 6964        self.valid
-000089b0: 6174 655f 7365 6c65 6374 6564 5f61 7265  ate_selected_are
-000089c0: 6128 290d 0a20 2020 2020 2020 2020 2020  a()..           
-000089d0: 2073 656c 662e 7369 676e 616c 2822 7265   self.signal("re
-000089e0: 6672 6573 685f 7363 656e 6522 2c20 2253  fresh_scene", "S
-000089f0: 6365 6e65 2229 0d0a 0d0a 2020 2020 2320  cene")....    # 
-00008a00: 3d3d 3d3d 3d3d 3d3d 3d3d 0d0a 2020 2020  ==========..    
-00008a10: 2320 5245 4d4f 5645 2045 4c45 4d45 4e54  # REMOVE ELEMENT
-00008a20: 530d 0a20 2020 2023 203d 3d3d 3d3d 3d3d  S..    # =======
-00008a30: 3d3d 3d0d 0a20 2020 2023 204d 6f72 6520  ===..    # More 
-00008a40: 7468 616e 206f 6e65 2c20 7370 6563 6961  than one, specia
-00008a50: 6c20 6361 7365 203d 3d20 3120 616c 7265  l case == 1 alre
-00008a60: 6164 7920 6465 616c 7420 7769 7468 0d0a  ady dealt with..
-00008a70: 2020 2020 4074 7265 655f 636f 6e64 6974      @tree_condit
-00008a80: 696f 6e61 6c28 6c61 6d62 6461 206e 6f64  ional(lambda nod
-00008a90: 653a 206c 656e 286c 6973 7428 7365 6c66  e: len(list(self
-00008aa0: 2e65 6c65 6d73 2865 6d70 6861 7369 7a65  .elems(emphasize
-00008ab0: 643d 5472 7565 2929 2920 3e20 3129 0d0a  d=True))) > 1)..
-00008ac0: 2020 2020 4074 7265 655f 6361 6c63 2822      @tree_calc("
-00008ad0: 6563 6f75 6e74 222c 206c 616d 6264 6120  ecount", lambda 
-00008ae0: 693a 206c 656e 286c 6973 7428 7365 6c66  i: len(list(self
-00008af0: 2e65 6c65 6d73 2865 6d70 6861 7369 7a65  .elems(emphasize
-00008b00: 643d 5472 7565 2929 2929 0d0a 2020 2020  d=True))))..    
-00008b10: 4074 7265 655f 6f70 6572 6174 696f 6e28  @tree_operation(
-00008b20: 0d0a 2020 2020 2020 2020 5f28 2244 656c  ..        _("Del
-00008b30: 6574 6520 7b65 636f 756e 747d 2065 6c65  ete {ecount} ele
-00008b40: 6d65 6e74 732c 2061 7320 7365 6c65 6374  ments, as select
-00008b50: 6564 2069 6e20 7363 656e 6522 292c 0d0a  ed in scene"),..
-00008b60: 2020 2020 2020 2020 6e6f 6465 5f74 7970          node_typ
-00008b70: 653d 656c 656d 5f67 726f 7570 5f6e 6f64  e=elem_group_nod
-00008b80: 6573 2c0d 0a20 2020 2020 2020 2068 656c  es,..        hel
-00008b90: 703d 2222 2c0d 0a20 2020 2029 0d0a 2020  p="",..    )..  
-00008ba0: 2020 6465 6620 7265 6d6f 7665 5f6e 5f65    def remove_n_e
-00008bb0: 6c65 6d65 6e74 7328 6e6f 6465 2c20 2a2a  lements(node, **
-00008bc0: 6b77 6172 6773 293a 0d0a 2020 2020 2020  kwargs):..      
-00008bd0: 2020 7365 6c66 2822 656c 656d 656e 7420    self("element 
-00008be0: 6465 6c65 7465 5c6e 2229 0d0a 0d0a 2020  delete\n")....  
-00008bf0: 2020 4074 7265 655f 636f 6e64 6974 696f    @tree_conditio
-00008c00: 6e61 6c28 0d0a 2020 2020 2020 2020 6c61  nal(..        la
-00008c10: 6d62 6461 206e 6f64 653a 2069 7369 6e73  mbda node: isins
-00008c20: 7461 6e63 6528 6e6f 6465 2e73 6861 7065  tance(node.shape
-00008c30: 2c20 506f 6c79 676f 6e29 2061 6e64 206c  , Polygon) and l
-00008c40: 656e 286e 6f64 652e 7368 6170 652e 706f  en(node.shape.po
-00008c50: 696e 7473 2920 3e3d 2033 0d0a 2020 2020  ints) >= 3..    
-00008c60: 290d 0a20 2020 2040 7472 6565 5f6f 7065  )..    @tree_ope
-00008c70: 7261 7469 6f6e 280d 0a20 2020 2020 2020  ration(..       
-00008c80: 205f 2822 4d61 6b65 2050 6f6c 7967 6f6e   _("Make Polygon
-00008c90: 2072 6567 756c 6172 2229 2c0d 0a20 2020   regular"),..   
-00008ca0: 2020 2020 206e 6f64 655f 7479 7065 3d22       node_type="
-00008cb0: 656c 656d 2070 6f6c 796c 696e 6522 2c0d  elem polyline",.
-00008cc0: 0a20 2020 2020 2020 2068 656c 703d 2222  .        help=""
-00008cd0: 2c0d 0a20 2020 2029 0d0a 2020 2020 6465  ,..    )..    de
-00008ce0: 6620 6d61 6b65 5f70 6f6c 7967 6f6e 5f72  f make_polygon_r
-00008cf0: 6567 756c 6172 286e 6f64 652c 202a 2a6b  egular(node, **k
-00008d00: 7761 7267 7329 3a0d 0a20 2020 2020 2020  wargs):..       
-00008d10: 2023 2066 726f 6d20 2e75 6e69 7473 2069   # from .units i
-00008d20: 6d70 6f72 7420 4c65 6e67 7468 0d0a 2020  mport Length..  
-00008d30: 2020 2020 2020 2320 6672 6f6d 202e 2e73        # from ..s
-00008d40: 7667 656c 656d 656e 7473 2069 6d70 6f72  vgelements impor
-00008d50: 7420 436f 6c6f 720d 0a0d 0a20 2020 2020  t Color....     
-00008d60: 2020 2023 2064 6566 206d 6b5f 6465 6275     # def mk_debu
-00008d70: 675f 706f 696e 7428 782c 2079 2c20 636f  g_point(x, y, co
-00008d80: 6c29 3a0d 0a20 2020 2020 2020 2023 2020  l):..        #  
-00008d90: 2020 2063 6972 6320 3d20 456c 6c69 7073     circ = Ellips
-00008da0: 6528 6378 3d78 2c20 6379 3d79 2c20 723d  e(cx=x, cy=y, r=
-00008db0: 666c 6f61 7428 4c65 6e67 7468 2822 316d  float(Length("1m
-00008dc0: 6d22 2929 290d 0a20 2020 2020 2020 2023  m")))..        #
-00008dd0: 2020 2020 2063 6972 632e 7472 616e 7366       circ.transf
-00008de0: 6f72 6d20 3d20 636f 7079 286e 6f64 652e  orm = copy(node.
-00008df0: 7368 6170 652e 7472 616e 7366 6f72 6d29  shape.transform)
-00008e00: 0d0a 2020 2020 2020 2020 2320 2020 2020  ..        #     
-00008e10: 7365 6c66 2e65 6c65 6d5f 6272 616e 6368  self.elem_branch
-00008e20: 2e61 6464 280d 0a20 2020 2020 2020 2023  .add(..        #
-00008e30: 2020 2020 2020 2020 2073 6861 7065 3d63           shape=c
-00008e40: 6972 632c 0d0a 2020 2020 2020 2020 2320  irc,..        # 
-00008e50: 2020 2020 2020 2020 7479 7065 3d22 656c          type="el
-00008e60: 656d 2065 6c6c 6970 7365 222c 0d0a 2020  em ellipse",..  
-00008e70: 2020 2020 2020 2320 2020 2020 2020 2020        #         
-00008e80: 7374 726f 6b65 3d43 6f6c 6f72 2863 6f6c  stroke=Color(col
-00008e90: 292c 0d0a 2020 2020 2020 2020 2320 2020  ),..        #   
-00008ea0: 2020 2020 2020 6669 6c6c 3d43 6f6c 6f72        fill=Color
-00008eb0: 2863 6f6c 292c 0d0a 2020 2020 2020 2020  (col),..        
-00008ec0: 2320 2020 2020 2020 2020 6d61 7472 6978  #         matrix
-00008ed0: 3d63 6f70 7928 6e6f 6465 2e6d 6174 7269  =copy(node.matri
-00008ee0: 7829 2c0d 0a20 2020 2020 2020 2023 2020  x),..        #  
-00008ef0: 2020 2029 0d0a 0d0a 2020 2020 2020 2020     )....        
-00008f00: 6966 206e 6f64 6520 6973 204e 6f6e 6520  if node is None 
-00008f10: 6f72 206e 6f64 652e 7479 7065 2021 3d20  or node.type != 
-00008f20: 2265 6c65 6d20 706f 6c79 6c69 6e65 223a  "elem polyline":
-00008f30: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
-00008f40: 7475 726e 0d0a 2020 2020 2020 2020 6e75  turn..        nu
-00008f50: 6d62 6572 5f70 6f69 6e74 7320 3d20 6c65  mber_points = le
-00008f60: 6e28 6e6f 6465 2e73 6861 7065 2e70 6f69  n(node.shape.poi
-00008f70: 6e74 7329 0d0a 2020 2020 2020 2020 2320  nts)..        # 
-00008f80: 7072 696e 7420 2866 224e 756d 6265 7220  print (f"Number 
-00008f90: 6f66 2070 6f69 6e74 733a 207b 6e75 6d62  of points: {numb
-00008fa0: 6572 5f70 6f69 6e74 737d 2229 0d0a 2020  er_points}")..  
-00008fb0: 2020 2020 2020 2320 666f 7220 7072 6f70        # for prop
-00008fc0: 2069 6e20 6469 7228 6e6f 6465 293a 0d0a   in dir(node):..
-00008fd0: 2020 2020 2020 2020 2320 2020 2020 7072          #     pr
-00008fe0: 696e 7420 2866 227b 7072 6f70 7d20 2d20  int (f"{prop} - 
-00008ff0: 7b67 6574 6174 7472 286e 6f64 652c 2027  {getattr(node, '
-00009000: 7072 6f70 272c 2027 2729 7d22 290d 0a20  prop', '')}").. 
-00009010: 2020 2020 2020 2023 2066 6f72 2069 6478         # for idx
-00009020: 2c20 7074 2069 6e20 656e 756d 6572 6174  , pt in enumerat
-00009030: 6528 6e6f 6465 2e73 6861 7065 2e70 6f69  e(node.shape.poi
-00009040: 6e74 7329 3a0d 0a20 2020 2020 2020 2023  nts):..        #
-00009050: 2020 2020 2070 7269 6e74 2028 6622 7b69       print (f"{i
-00009060: 6478 7d3a 207b 7074 2e78 3a2e 3166 7d2c  dx}: {pt.x:.1f},
-00009070: 207b 7074 2e79 3a2e 3166 7d22 290d 0a20   {pt.y:.1f}").. 
-00009080: 2020 2020 2020 2069 6620 6e75 6d62 6572         if number
-00009090: 5f70 6f69 6e74 7320 3c20 3320 6f72 206e  _points < 3 or n
-000090a0: 6f74 2069 7369 6e73 7461 6e63 6528 6e6f  ot isinstance(no
-000090b0: 6465 2e73 6861 7065 2c20 506f 6c79 676f  de.shape, Polygo
-000090c0: 6e29 3a0d 0a20 2020 2020 2020 2020 2020  n):..           
-000090d0: 2072 6574 7572 6e0d 0a20 2020 2020 2020   return..       
-000090e0: 2070 7473 203d 206e 6f64 652e 7368 6170   pts = node.shap
-000090f0: 652e 706f 696e 7473 0d0a 2020 2020 2020  e.points..      
-00009100: 2020 6478 203d 2070 7473 5b31 5d2e 7820    dx = pts[1].x 
-00009110: 2d20 7074 735b 305d 2e78 0d0a 2020 2020  - pts[0].x..    
-00009120: 2020 2020 6479 203d 2070 7473 5b31 5d2e      dy = pts[1].
-00009130: 7920 2d20 7074 735b 305d 2e79 0d0a 2020  y - pts[0].y..  
-00009140: 2020 2020 2020 6261 7365 6c69 6e65 203d        baseline =
-00009150: 206d 6174 682e 7371 7274 2864 7820 2a20   math.sqrt(dx * 
-00009160: 6478 202b 2064 7920 2a20 6479 290d 0a20  dx + dy * dy).. 
-00009170: 2020 2020 2020 2061 706f 7468 656d 203d         apothem =
-00009180: 2062 6173 656c 696e 6520 2f20 2832 202a   baseline / (2 *
-00009190: 206d 6174 682e 7461 6e28 6d61 7468 2e74   math.tan(math.t
-000091a0: 6175 202f 2028 3220 2a20 6e75 6d62 6572  au / (2 * number
-000091b0: 5f70 6f69 6e74 7329 2929 0d0a 2020 2020  _points)))..    
-000091c0: 2020 2020 6369 7263 756d 7261 6469 7573      circumradius
-000091d0: 203d 2062 6173 656c 696e 6520 2f20 2832   = baseline / (2
-000091e0: 202a 206d 6174 682e 7369 6e28 6d61 7468   * math.sin(math
-000091f0: 2e74 6175 202f 2028 3220 2a20 6e75 6d62  .tau / (2 * numb
-00009200: 6572 5f70 6f69 6e74 7329 2929 0d0a 2020  er_points)))..  
-00009210: 2020 2020 2020 6d69 6470 6f69 6e74 203d        midpoint =
-00009220: 2050 6f69 6e74 2870 7473 5b30 5d2e 7820   Point(pts[0].x 
-00009230: 2b20 302e 3520 2a20 6478 2c20 7074 735b  + 0.5 * dx, pts[
-00009240: 305d 2e79 202b 2030 2e35 202a 2064 7929  0].y + 0.5 * dy)
-00009250: 0d0a 2020 2020 2020 2020 2320 206d 6b5f  ..        #  mk_
-00009260: 6465 6275 675f 706f 696e 7428 6d69 6470  debug_point(midp
-00009270: 6f69 6e74 2e78 2c20 6d69 6470 6f69 6e74  oint.x, midpoint
-00009280: 2e79 2c20 2262 6c61 636b 2229 0d0a 2020  .y, "black")..  
-00009290: 2020 2020 2020 6178 203d 2030 0d0a 2020        ax = 0..  
-000092a0: 2020 2020 2020 6179 203d 2030 0d0a 2020        ay = 0..  
-000092b0: 2020 2020 2020 666f 7220 6964 782c 2070        for idx, p
-000092c0: 7420 696e 2065 6e75 6d65 7261 7465 2870  t in enumerate(p
-000092d0: 7473 293a 0d0a 2020 2020 2020 2020 2020  ts):..          
-000092e0: 2020 6178 202b 3d20 7074 2e78 0d0a 2020    ax += pt.x..  
-000092f0: 2020 2020 2020 2020 2020 6179 202b 3d20            ay += 
-00009300: 7074 2e79 0d0a 2020 2020 2020 2020 6178  pt.y..        ax
-00009310: 202f 3d20 6e75 6d62 6572 5f70 6f69 6e74   /= number_point
-00009320: 730d 0a20 2020 2020 2020 2061 7920 2f3d  s..        ay /=
-00009330: 206e 756d 6265 725f 706f 696e 7473 0d0a   number_points..
-00009340: 2020 2020 2020 2020 2320 5468 6520 6172          # The ar
-00009350: 6974 686d 6574 6963 2063 656e 7465 7220  ithmetic center 
-00009360: 2861 782c 2061 7929 2069 6e64 6963 6174  (ax, ay) indicat
-00009370: 6573 2074 6f20 7768 6963 680d 0a20 2020  es to which..   
-00009380: 2020 2020 2023 2027 7369 6465 2720 6f66       # 'side' of
-00009390: 2074 6865 2062 6173 656c 696e 6520 7468   the baseline th
-000093a0: 6520 706f 6c79 676f 6e20 6e65 6564 7320  e polygon needs 
-000093b0: 746f 2062 6520 636f 6e73 7472 7563 7465  to be constructe
-000093c0: 640d 0a20 2020 2020 2020 2061 7269 7468  d..        arith
-000093d0: 6d65 7469 635f 6365 6e74 6572 203d 2050  metic_center = P
-000093e0: 6f69 6e74 2861 782c 2061 7929 0d0a 2020  oint(ax, ay)..  
-000093f0: 2020 2020 2020 2320 6d6b 5f64 6562 7567        # mk_debug
-00009400: 5f70 6f69 6e74 2861 782c 2061 792c 2022  _point(ax, ay, "
-00009410: 6772 6565 6e22 290d 0a20 2020 2020 2020  green")..       
-00009420: 2061 6e67 6c65 203d 2070 7473 5b30 5d2e   angle = pts[0].
-00009430: 616e 676c 655f 746f 2870 7473 5b31 5d29  angle_to(pts[1])
-00009440: 0d0a 2020 2020 2020 2020 6d69 6461 6e67  ..        midang
-00009450: 6c65 203d 206d 6964 706f 696e 742e 616e  le = midpoint.an
-00009460: 676c 655f 746f 2861 7269 7468 6d65 7469  gle_to(arithmeti
-00009470: 635f 6365 6e74 6572 290d 0a20 2020 2020  c_center)..     
-00009480: 2020 2061 6e67 6c65 202b 3d20 6d61 7468     angle += math
-00009490: 2e74 6175 202f 2034 0d0a 2020 2020 2020  .tau / 4..      
-000094a0: 2020 6669 7273 745f 706f 696e 7420 3d20    first_point = 
-000094b0: 506f 696e 742e 706f 6c61 7228 6d69 6470  Point.polar(midp
-000094c0: 6f69 6e74 2c20 616e 676c 652c 2061 706f  oint, angle, apo
-000094d0: 7468 656d 290d 0a20 2020 2020 2020 2073  them)..        s
-000094e0: 6563 6f6e 645f 706f 696e 7420 3d20 506f  econd_point = Po
-000094f0: 696e 742e 706f 6c61 7228 6d69 6470 6f69  int.polar(midpoi
-00009500: 6e74 2c20 616e 676c 6520 2b20 6d61 7468  nt, angle + math
-00009510: 2e74 6175 202f 2032 2c20 6170 6f74 6865  .tau / 2, apothe
-00009520: 6d29 0d0a 2020 2020 2020 2020 2320 6d6b  m)..        # mk
-00009530: 5f64 6562 7567 5f70 6f69 6e74 2866 6972  _debug_point(fir
-00009540: 7374 5f70 6f69 6e74 2e78 2c20 6669 7273  st_point.x, firs
-00009550: 745f 706f 696e 742e 792c 2022 7965 6c6c  t_point.y, "yell
-00009560: 6f77 2229 0d0a 2020 2020 2020 2020 2320  ow")..        # 
-00009570: 6d6b 5f64 6562 7567 5f70 6f69 6e74 2873  mk_debug_point(s
-00009580: 6563 6f6e 645f 706f 696e 742e 782c 2073  econd_point.x, s
-00009590: 6563 6f6e 645f 706f 696e 742e 792c 2022  econd_point.y, "
-000095a0: 6379 616e 2229 0d0a 2020 2020 2020 2020  cyan")..        
-000095b0: 6465 6c74 6161 6e67 6c65 203d 206d 6174  deltaangle = mat
-000095c0: 682e 7461 7520 2f20 6e75 6d62 6572 5f70  h.tau / number_p
-000095d0: 6f69 6e74 730d 0a20 2020 2020 2020 2064  oints..        d
-000095e0: 3120 3d20 6172 6974 686d 6574 6963 5f63  1 = arithmetic_c
-000095f0: 656e 7465 722e 6469 7374 616e 6365 5f74  enter.distance_t
-00009600: 6f28 6669 7273 745f 706f 696e 7429 0d0a  o(first_point)..
-00009610: 2020 2020 2020 2020 6432 203d 2061 7269          d2 = ari
-00009620: 7468 6d65 7469 635f 6365 6e74 6572 2e64  thmetic_center.d
-00009630: 6973 7461 6e63 655f 746f 2873 6563 6f6e  istance_to(secon
-00009640: 645f 706f 696e 7429 0d0a 2020 2020 2020  d_point)..      
-00009650: 2020 6966 2064 3120 3c20 6432 3a0d 0a20    if d1 < d2:.. 
-00009660: 2020 2020 2020 2020 2020 2063 656e 7465             cente
-00009670: 725f 706f 696e 7420 3d20 636f 7079 2866  r_point = copy(f
-00009680: 6972 7374 5f70 6f69 6e74 290d 0a20 2020  irst_point)..   
-00009690: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-000096a0: 2020 2020 2020 2020 6365 6e74 6572 5f70          center_p
-000096b0: 6f69 6e74 203d 2063 6f70 7928 7365 636f  oint = copy(seco
-000096c0: 6e64 5f70 6f69 6e74 290d 0a20 2020 2020  nd_point)..     
-000096d0: 2020 2023 206d 6b5f 6465 6275 675f 706f     # mk_debug_po
-000096e0: 696e 7428 6365 6e74 6572 5f70 6f69 6e74  int(center_point
-000096f0: 2e78 2c20 6365 6e74 6572 5f70 6f69 6e74  .x, center_point
-00009700: 2e79 2c20 2272 6564 2229 0d0a 0d0a 2020  .y, "red")....  
-00009710: 2020 2020 2020 6966 2063 656e 7465 725f        if center_
-00009720: 706f 696e 742e 616e 676c 655f 746f 2870  point.angle_to(p
-00009730: 7473 5b30 5d29 203e 2063 656e 7465 725f  ts[0]) > center_
-00009740: 706f 696e 742e 616e 676c 655f 746f 2870  point.angle_to(p
-00009750: 7473 5b31 5d29 3a0d 0a20 2020 2020 2020  ts[1]):..       
-00009760: 2020 2020 2064 656c 7461 616e 676c 6520       deltaangle 
-00009770: 2a3d 202d 310d 0a20 2020 2020 2020 2061  *= -1..        a
-00009780: 6e67 6c65 203d 2063 656e 7465 725f 706f  ngle = center_po
-00009790: 696e 742e 616e 676c 655f 746f 2870 7473  int.angle_to(pts
-000097a0: 5b30 5d29 0d0a 2020 2020 2020 2020 666f  [0])..        fo
-000097b0: 7220 6964 7820 696e 2072 616e 6765 286e  r idx in range(n
-000097c0: 756d 6265 725f 706f 696e 7473 293a 0d0a  umber_points):..
-000097d0: 2020 2020 2020 2020 2020 2020 2320 6966              # if
-000097e0: 2069 6478 203e 2031 3a0d 0a20 2020 2020   idx > 1:..     
-000097f0: 2020 2020 2020 2070 7420 3d20 506f 696e         pt = Poin
-00009800: 742e 706f 6c61 7228 6365 6e74 6572 5f70  t.polar(center_p
-00009810: 6f69 6e74 2c20 616e 676c 652c 2063 6972  oint, angle, cir
-00009820: 6375 6d72 6164 6975 7329 0d0a 2020 2020  cumradius)..    
-00009830: 2020 2020 2020 2020 7074 735b 6964 785d          pts[idx]
-00009840: 2e78 203d 2070 742e 780d 0a20 2020 2020  .x = pt.x..     
-00009850: 2020 2020 2020 2070 7473 5b69 6478 5d2e         pts[idx].
-00009860: 7920 3d20 7074 2e79 0d0a 2020 2020 2020  y = pt.y..      
-00009870: 2020 2020 2020 616e 676c 6520 2b3d 2064        angle += d
-00009880: 656c 7461 616e 676c 650d 0a20 2020 2020  eltaangle..     
-00009890: 2020 206e 6f64 652e 616c 7465 7265 6428     node.altered(
-000098a0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-000098b0: 7369 676e 616c 2822 7265 6672 6573 685f  signal("refresh_
-000098c0: 7363 656e 6522 2c20 2253 6365 6e65 2229  scene", "Scene")
-000098d0: 0d0a 0d0a 2020 2020 2320 3d3d 3d3d 3d3d  ....    # ======
-000098e0: 3d3d 3d3d 0d0a 2020 2020 2320 434f 4e56  ====..    # CONV
-000098f0: 4552 5420 5452 4545 204f 5045 5241 5449  ERT TREE OPERATI
-00009900: 4f4e 530d 0a20 2020 2023 203d 3d3d 3d3d  ONS..    # =====
-00009910: 3d3d 3d3d 3d0d 0a20 2020 2040 7472 6565  =====..    @tree
-00009920: 5f6f 7065 7261 7469 6f6e 280d 0a20 2020  _operation(..   
-00009930: 2020 2020 205f 2822 436f 6e76 6572 7420       _("Convert 
-00009940: 746f 2043 7574 636f 6465 2229 2c0d 0a20  to Cutcode"),.. 
-00009950: 2020 2020 2020 206e 6f64 655f 7479 7065         node_type
-00009960: 3d22 6c61 7365 7263 6f64 6522 2c0d 0a20  ="lasercode",.. 
-00009970: 2020 2020 2020 2068 656c 703d 2222 2c0d         help="",.
-00009980: 0a20 2020 2029 0d0a 2020 2020 6465 6620  .    )..    def 
-00009990: 6c61 7365 7263 6f64 6532 6375 7428 6e6f  lasercode2cut(no
-000099a0: 6465 2c20 2a2a 6b77 6172 6773 293a 0d0a  de, **kwargs):..
-000099b0: 2020 2020 2020 2020 6e6f 6465 2e72 6570          node.rep
-000099c0: 6c61 6365 5f6e 6f64 6528 4375 7443 6f64  lace_node(CutCod
-000099d0: 652e 6672 6f6d 5f6c 6173 6572 636f 6465  e.from_lasercode
-000099e0: 286e 6f64 652e 636f 6d6d 616e 6473 292c  (node.commands),
-000099f0: 2074 7970 653d 2263 7574 636f 6465 2229   type="cutcode")
-00009a00: 0d0a 0d0a 2020 2020 4074 7265 655f 636f  ....    @tree_co
-00009a10: 6e64 6974 696f 6e61 6c5f 7472 7928 0d0a  nditional_try(..
-00009a20: 2020 2020 2020 2020 6c61 6d62 6461 206e          lambda n
-00009a30: 6f64 653a 206b 6572 6e65 6c2e 6c6f 6f6b  ode: kernel.look
-00009a40: 7570 2866 2273 706f 6f6c 6572 6a6f 622f  up(f"spoolerjob/
-00009a50: 7b6e 6f64 652e 6461 7461 5f74 7970 657d  {node.data_type}
-00009a60: 2229 2069 7320 6e6f 7420 4e6f 6e65 0d0a  ") is not None..
-00009a70: 2020 2020 290d 0a20 2020 2040 7472 6565      )..    @tree
-00009a80: 5f6f 7065 7261 7469 6f6e 280d 0a20 2020  _operation(..   
-00009a90: 2020 2020 205f 2822 436f 6e76 6572 7420       _("Convert 
-00009aa0: 746f 2045 6c65 6d65 6e74 7322 292c 0d0a  to Elements"),..
-00009ab0: 2020 2020 2020 2020 6e6f 6465 5f74 7970          node_typ
-00009ac0: 653d 2262 6c6f 6222 2c0d 0a20 2020 2020  e="blob",..     
-00009ad0: 2020 2068 656c 703d 5f28 2243 6f6e 7665     help=_("Conve
-00009ae0: 7274 2061 7474 6163 6865 6420 6269 6e61  rt attached bina
-00009af0: 7279 206f 626a 6563 7420 746f 2065 6c65  ry object to ele
-00009b00: 6d65 6e74 7322 292c 0d0a 2020 2020 290d  ments"),..    ).
-00009b10: 0a20 2020 2064 6566 2062 6c6f 6232 7061  .    def blob2pa
-00009b20: 7468 286e 6f64 652c 202a 2a6b 7761 7267  th(node, **kwarg
-00009b30: 7329 3a0d 0a20 2020 2020 2020 2063 616e  s):..        can
-00009b40: 6365 6c6c 6564 203d 2046 616c 7365 0d0a  celled = False..
-00009b50: 2020 2020 2020 2020 6672 6f6d 206d 6565          from mee
-00009b60: 726b 3430 742e 746f 6f6c 732e 6472 6976  rk40t.tools.driv
-00009b70: 6572 5f74 6f5f 7061 7468 2069 6d70 6f72  er_to_path impor
-00009b80: 7420 4472 6976 6572 546f 5061 7468 0d0a  t DriverToPath..
-00009b90: 0d0a 2020 2020 2020 2020 6432 7020 3d20  ..        d2p = 
-00009ba0: 4472 6976 6572 546f 5061 7468 2829 0d0a  DriverToPath()..
-00009bb0: 2020 2020 2020 2020 6469 616c 6f67 5f63          dialog_c
-00009bc0: 6c61 7373 203d 206b 6572 6e65 6c2e 6c6f  lass = kernel.lo
-00009bd0: 6f6b 7570 2822 6469 616c 6f67 2f6f 7074  okup("dialog/opt
-00009be0: 696f 6e73 2229 0d0a 2020 2020 2020 2020  ions")..        
-00009bf0: 6966 2064 6961 6c6f 675f 636c 6173 7320  if dialog_class 
-00009c00: 616e 6420 6861 7361 7474 7228 6432 702c  and hasattr(d2p,
-00009c10: 2022 6f70 7469 6f6e 7322 293a 0d0a 2020   "options"):..  
-00009c20: 2020 2020 2020 2020 2020 6368 6f69 6365            choice
-00009c30: 7320 3d20 6765 7461 7474 7228 6432 702c  s = getattr(d2p,
-00009c40: 2022 6f70 7469 6f6e 7322 2c20 4e6f 6e65   "options", None
-00009c50: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
-00009c60: 6620 6368 6f69 6365 7320 6973 206e 6f74  f choices is not
-00009c70: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
-00009c80: 2020 2020 2020 2020 666f 7220 656e 7472          for entr
-00009c90: 7920 696e 2063 686f 6963 6573 3a0d 0a20  y in choices:.. 
-00009ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009cb0: 2020 2069 6620 226c 6162 656c 2220 696e     if "label" in
-00009cc0: 2065 6e74 7279 3a0d 0a20 2020 2020 2020   entry:..       
-00009cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009ce0: 2065 6e74 7279 5b22 6c61 6265 6c22 5d20   entry["label"] 
-00009cf0: 3d20 5f28 656e 7472 795b 226c 6162 656c  = _(entry["label
-00009d00: 225d 290d 0a20 2020 2020 2020 2020 2020  "])..           
-00009d10: 2020 2020 2020 2020 2069 6620 2274 6970           if "tip
-00009d20: 2220 696e 2065 6e74 7279 3a0d 0a20 2020  " in entry:..   
-00009d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009d40: 2020 2020 2065 6e74 7279 5b22 7469 7022       entry["tip"
-00009d50: 5d20 3d20 5f28 656e 7472 795b 2274 6970  ] = _(entry["tip
-00009d60: 225d 290d 0a20 2020 2020 2020 2020 2020  "])..           
-00009d70: 2020 2020 2020 2020 2069 6620 2264 6973           if "dis
-00009d80: 706c 6179 2220 696e 2065 6e74 7279 3a0d  play" in entry:.
-00009d90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009da0: 2020 2020 2020 2020 206e 6577 6469 7370           newdisp
-00009db0: 6c61 7920 3d20 5b5d 0d0a 2020 2020 2020  lay = []..      
-00009dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009dd0: 2020 666f 7220 6465 6e74 7279 2069 6e20    for dentry in 
-00009de0: 656e 7472 795b 2264 6973 706c 6179 225d  entry["display"]
-00009df0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00009e00: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-00009e10: 6577 6469 7370 6c61 792e 6170 7065 6e64  ewdisplay.append
-00009e20: 285f 2864 656e 7472 7929 290d 0a20 2020  (_(dentry))..   
-00009e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009e40: 2020 2020 2065 6e74 7279 5b22 6469 7370       entry["disp
-00009e50: 6c61 7922 5d20 3d20 6e65 7764 6973 706c  lay"] = newdispl
-00009e60: 6179 0d0a 2020 2020 2020 2020 2020 2020  ay..            
-00009e70: 2020 2020 6469 616c 6f67 203d 2064 6961      dialog = dia
-00009e80: 6c6f 675f 636c 6173 7328 7365 6c66 2e6b  log_class(self.k
-00009e90: 6572 6e65 6c2c 2063 686f 6963 6573 3d63  ernel, choices=c
-00009ea0: 686f 6963 6573 290d 0a20 2020 2020 2020  hoices)..       
-00009eb0: 2020 2020 2020 2020 2072 6573 203d 2064           res = d
-00009ec0: 6961 6c6f 672e 6469 616c 6f67 5f6f 7074  ialog.dialog_opt
-00009ed0: 696f 6e73 280d 0a20 2020 2020 2020 2020  ions(..         
-00009ee0: 2020 2020 2020 2020 2020 2074 6974 6c65             title
-00009ef0: 3d5f 2822 426c 6f62 2d43 6f6e 7665 7273  =_("Blob-Convers
-00009f00: 696f 6e22 292c 0d0a 2020 2020 2020 2020  ion"),..        
-00009f10: 2020 2020 2020 2020 2020 2020 696e 7472              intr
-00009f20: 6f3d 5f28 0d0a 2020 2020 2020 2020 2020  o=_(..          
-00009f30: 2020 2020 2020 2020 2020 2020 2020 2259                "Y
-00009f40: 6f75 2063 616e 2069 6e66 6c75 656e 6365  ou can influence
-00009f50: 2074 6865 2077 6179 204d 4b20 7769 6c6c   the way MK will
-00009f60: 2070 726f 6365 7373 2074 6865 2061 7474   process the att
-00009f70: 6163 6865 6420 6269 6e61 7279 2064 6174  ached binary dat
-00009f80: 613a 220d 0a20 2020 2020 2020 2020 2020  a:"..           
-00009f90: 2020 2020 2020 2020 2029 2c0d 0a20 2020           ),..   
-00009fa0: 2020 2020 2020 2020 2020 2020 2029 0d0a               )..
-00009fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009fc0: 6966 206e 6f74 2072 6573 3a0d 0a20 2020  if not res:..   
-00009fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009fe0: 2063 616e 6365 6c6c 6564 203d 2054 7275   cancelled = Tru
-00009ff0: 650d 0a20 2020 2020 2020 2069 6620 6e6f  e..        if no
-0000a000: 7420 6361 6e63 656c 6c65 643a 0d0a 2020  t cancelled:..  
-0000a010: 2020 2020 2020 2020 2020 6432 702e 7061            d2p.pa
-0000a020: 7273 6528 6e6f 6465 2e64 6174 615f 7479  rse(node.data_ty
-0000a030: 7065 2c20 6e6f 6465 2e64 6174 612c 2073  pe, node.data, s
-0000a040: 656c 6629 0d0a 2020 2020 2020 2020 7265  elf)..        re
-0000a050: 7475 726e 2054 7275 650d 0a0d 0a20 2020  turn True....   
-0000a060: 2040 7472 6565 5f63 6f6e 6469 7469 6f6e   @tree_condition
-0000a070: 616c 5f74 7279 280d 0a20 2020 2020 2020  al_try(..       
-0000a080: 206c 616d 6264 6120 6e6f 6465 3a20 6b65   lambda node: ke
-0000a090: 726e 656c 2e6c 6f6f 6b75 7028 6622 7370  rnel.lookup(f"sp
-0000a0a0: 6f6f 6c65 726a 6f62 2f7b 6e6f 6465 2e64  oolerjob/{node.d
-0000a0b0: 6174 615f 7479 7065 7d22 2920 6973 206e  ata_type}") is n
-0000a0c0: 6f74 204e 6f6e 650d 0a20 2020 2029 0d0a  ot None..    )..
-0000a0d0: 2020 2020 4074 7265 655f 6f70 6572 6174      @tree_operat
-0000a0e0: 696f 6e28 0d0a 2020 2020 2020 2020 5f28  ion(..        _(
-0000a0f0: 2245 7865 6375 7465 2042 6c6f 6222 292c  "Execute Blob"),
-0000a100: 0d0a 2020 2020 2020 2020 6e6f 6465 5f74  ..        node_t
-0000a110: 7970 653d 2262 6c6f 6222 2c0d 0a20 2020  ype="blob",..   
-0000a120: 2020 2020 2068 656c 703d 5f28 2252 756e       help=_("Run
-0000a130: 2074 6865 2067 6976 656e 2062 6c6f 6220   the given blob 
-0000a140: 6f6e 2074 6865 2063 7572 7265 6e74 2064  on the current d
-0000a150: 6576 6963 6522 292c 0d0a 2020 2020 290d  evice"),..    ).
-0000a160: 0a20 2020 2064 6566 2062 6c6f 625f 6578  .    def blob_ex
-0000a170: 6563 7574 6528 6e6f 6465 2c20 2a2a 6b77  ecute(node, **kw
-0000a180: 6172 6773 293a 0d0a 2020 2020 2020 2020  args):..        
-0000a190: 7370 6f6f 6c65 725f 6a6f 6220 3d20 7365  spooler_job = se
-0000a1a0: 6c66 2e6c 6f6f 6b75 7028 6622 7370 6f6f  lf.lookup(f"spoo
-0000a1b0: 6c65 726a 6f62 2f7b 6e6f 6465 2e64 6174  lerjob/{node.dat
-0000a1c0: 615f 7479 7065 7d22 290d 0a20 2020 2020  a_type}")..     
-0000a1d0: 2020 206d 6174 7269 7820 3d20 7365 6c66     matrix = self
-0000a1e0: 2e64 6576 6963 652e 7363 656e 655f 746f  .device.scene_to
-0000a1f0: 5f64 6576 6963 655f 6d61 7472 6978 2829  _device_matrix()
-0000a200: 0d0a 2020 2020 2020 2020 6a6f 625f 6f62  ..        job_ob
-0000a210: 6a65 6374 203d 2073 706f 6f6c 6572 5f6a  ject = spooler_j
-0000a220: 6f62 2873 656c 662e 6465 7669 6365 2e64  ob(self.device.d
-0000a230: 7269 7665 722c 206d 6174 7269 7829 0d0a  river, matrix)..
-0000a240: 2020 2020 2020 2020 6a6f 625f 6f62 6a65          job_obje
-0000a250: 6374 2e77 7269 7465 5f62 6c6f 6228 6e6f  ct.write_blob(no
-0000a260: 6465 2e64 6174 6129 0d0a 2020 2020 2020  de.data)..      
-0000a270: 2020 7365 6c66 2e64 6576 6963 652e 7370    self.device.sp
-0000a280: 6f6f 6c65 722e 7365 6e64 286a 6f62 5f6f  ooler.send(job_o
-0000a290: 626a 6563 7429 0d0a 0d0a 2020 2020 4074  bject)....    @t
-0000a2a0: 7265 655f 636f 6e64 6974 696f 6e61 6c5f  ree_conditional_
-0000a2b0: 7472 7928 6c61 6d62 6461 206e 6f64 653a  try(lambda node:
-0000a2c0: 2068 6173 6174 7472 286e 6f64 652c 2022   hasattr(node, "
-0000a2d0: 6173 5f63 7574 6f62 6a65 6374 7322 2929  as_cutobjects"))
-0000a2e0: 0d0a 2020 2020 4074 7265 655f 6f70 6572  ..    @tree_oper
-0000a2f0: 6174 696f 6e28 0d0a 2020 2020 2020 2020  ation(..        
-0000a300: 5f28 2243 6f6e 7665 7274 2074 6f20 4375  _("Convert to Cu
-0000a310: 7463 6f64 6522 292c 0d0a 2020 2020 2020  tcode"),..      
-0000a320: 2020 6e6f 6465 5f74 7970 653d 2262 6c6f    node_type="blo
-0000a330: 6222 2c0d 0a20 2020 2020 2020 2068 656c  b",..        hel
-0000a340: 703d 2222 2c0d 0a20 2020 2029 0d0a 2020  p="",..    )..  
-0000a350: 2020 6465 6620 626c 6f62 3263 7574 286e    def blob2cut(n
-0000a360: 6f64 652c 202a 2a6b 7761 7267 7329 3a0d  ode, **kwargs):.
-0000a370: 0a20 2020 2020 2020 206e 6f64 652e 7265  .        node.re
-0000a380: 706c 6163 655f 6e6f 6465 286e 6f64 652e  place_node(node.
-0000a390: 6173 5f63 7574 6f62 6a65 6374 7328 292c  as_cutobjects(),
-0000a3a0: 2074 7970 653d 2263 7574 636f 6465 2229   type="cutcode")
-0000a3b0: 0d0a 0d0a 2020 2020 4074 7265 655f 6f70  ....    @tree_op
-0000a3c0: 6572 6174 696f 6e28 0d0a 2020 2020 2020  eration(..      
-0000a3d0: 2020 5f28 2243 6f6e 7665 7274 2074 6f20    _("Convert to 
-0000a3e0: 5061 7468 2229 2c0d 0a20 2020 2020 2020  Path"),..       
-0000a3f0: 206e 6f64 655f 7479 7065 3d22 6375 7463   node_type="cutc
-0000a400: 6f64 6522 2c0d 0a20 2020 2020 2020 2068  ode",..        h
-0000a410: 656c 703d 2222 2c0d 0a20 2020 2029 0d0a  elp="",..    )..
-0000a420: 2020 2020 6465 6620 6375 7463 6f64 6532      def cutcode2
-0000a430: 7061 7468 6375 7428 6e6f 6465 2c20 2a2a  pathcut(node, **
-0000a440: 6b77 6172 6773 293a 0d0a 2020 2020 2020  kwargs):..      
-0000a450: 2020 6375 7463 6f64 6520 3d20 6e6f 6465    cutcode = node
-0000a460: 2e63 7574 636f 6465 0d0a 2020 2020 2020  .cutcode..      
-0000a470: 2020 6966 2063 7574 636f 6465 2069 7320    if cutcode is 
-0000a480: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
-0000a490: 2020 2072 6574 7572 6e0d 0a20 2020 2020     return..     
-0000a4a0: 2020 2065 6c65 6d65 6e74 7320 3d20 6c69     elements = li
-0000a4b0: 7374 2863 7574 636f 6465 2e61 735f 656c  st(cutcode.as_el
-0000a4c0: 656d 656e 7473 2829 290d 0a20 2020 2020  ements())..     
-0000a4d0: 2020 206e 203d 204e 6f6e 650d 0a20 2020     n = None..   
-0000a4e0: 2020 2020 2066 6f72 2065 6c65 6d65 6e74       for element
-0000a4f0: 2069 6e20 656c 656d 656e 7473 3a0d 0a20   in elements:.. 
-0000a500: 2020 2020 2020 2020 2020 206e 203d 2073             n = s
-0000a510: 656c 662e 656c 656d 5f62 7261 6e63 682e  elf.elem_branch.
-0000a520: 6164 6428 7479 7065 3d22 656c 656d 2070  add(type="elem p
-0000a530: 6174 6822 2c20 7061 7468 3d65 6c65 6d65  ath", path=eleme
-0000a540: 6e74 290d 0a20 2020 2020 2020 206e 6f64  nt)..        nod
-0000a550: 652e 7265 6d6f 7665 5f6e 6f64 6528 290d  e.remove_node().
-0000a560: 0a20 2020 2020 2020 2069 6620 6e20 6973  .        if n is
-0000a570: 206e 6f74 204e 6f6e 653a 0d0a 2020 2020   not None:..    
-0000a580: 2020 2020 2020 2020 6e2e 666f 6375 7328          n.focus(
-0000a590: 290d 0a0d 0a20 2020 2040 7472 6565 5f73  )....    @tree_s
-0000a5a0: 7562 6d65 6e75 285f 2822 436c 6f6e 6520  ubmenu(_("Clone 
-0000a5b0: 7265 6665 7265 6e63 6522 2929 0d0a 2020  reference"))..  
-0000a5c0: 2020 4074 7265 655f 6f70 6572 6174 696f    @tree_operatio
-0000a5d0: 6e28 5f28 224d 616b 6520 3120 636f 7079  n(_("Make 1 copy
-0000a5e0: 2229 2c20 6e6f 6465 5f74 7970 653d 2822  "), node_type=("
-0000a5f0: 7265 6665 7265 6e63 6522 2c29 2c20 6865  reference",), he
-0000a600: 6c70 3d22 2229 0d0a 2020 2020 6465 6620  lp="")..    def 
-0000a610: 636c 6f6e 655f 7369 6e67 6c65 5f65 6c65  clone_single_ele
-0000a620: 6d65 6e74 5f6f 7028 6e6f 6465 2c20 2a2a  ment_op(node, **
-0000a630: 6b77 6172 6773 293a 0d0a 2020 2020 2020  kwargs):..      
-0000a640: 2020 636c 6f6e 655f 656c 656d 656e 745f    clone_element_
-0000a650: 6f70 286e 6f64 652c 2063 6f70 6965 733d  op(node, copies=
-0000a660: 312c 202a 2a6b 7761 7267 7329 0d0a 0d0a  1, **kwargs)....
-0000a670: 2020 2020 4074 7265 655f 7375 626d 656e      @tree_submen
-0000a680: 7528 5f28 2243 6c6f 6e65 2072 6566 6572  u(_("Clone refer
-0000a690: 656e 6365 2229 290d 0a20 2020 2040 7472  ence"))..    @tr
-0000a6a0: 6565 5f69 7465 7261 7465 2822 636f 7069  ee_iterate("copi
-0000a6b0: 6573 222c 2032 2c20 3130 290d 0a20 2020  es", 2, 10)..   
-0000a6c0: 2040 7472 6565 5f6f 7065 7261 7469 6f6e   @tree_operation
-0000a6d0: 285f 2822 4d61 6b65 207b 636f 7069 6573  (_("Make {copies
-0000a6e0: 7d20 636f 7069 6573 2229 2c20 6e6f 6465  } copies"), node
-0000a6f0: 5f74 7970 653d 2822 7265 6665 7265 6e63  _type=("referenc
-0000a700: 6522 2c29 2c20 6865 6c70 3d22 2229 0d0a  e",), help="")..
-0000a710: 2020 2020 6465 6620 636c 6f6e 655f 656c      def clone_el
-0000a720: 656d 656e 745f 6f70 286e 6f64 652c 2063  ement_op(node, c
-0000a730: 6f70 6965 733d 312c 202a 2a6b 7761 7267  opies=1, **kwarg
-0000a740: 7329 3a0d 0a20 2020 2020 2020 2077 6974  s):..        wit
-0000a750: 6820 7365 6c66 2e73 7461 7469 6328 2263  h self.static("c
-0000a760: 6c6f 6e65 5f65 6c65 6d5f 6f70 2229 3a0d  lone_elem_op"):.
-0000a770: 0a20 2020 2020 2020 2020 2020 206e 6f64  .            nod
-0000a780: 6573 203d 206c 6973 7428 7365 6c66 2e66  es = list(self.f
-0000a790: 6c61 7428 7365 6c65 6374 6564 3d54 7275  lat(selected=Tru
-0000a7a0: 652c 2063 6173 6361 6465 3d46 616c 7365  e, cascade=False
-0000a7b0: 2c20 7479 7065 733d 2272 6566 6572 656e  , types="referen
-0000a7c0: 6365 2229 290d 0a20 2020 2020 2020 2020  ce"))..         
-0000a7d0: 2020 2066 6f72 2073 6e6f 6465 2069 6e20     for snode in 
-0000a7e0: 6e6f 6465 733a 0d0a 2020 2020 2020 2020  nodes:..        
-0000a7f0: 2020 2020 2020 2020 696e 6465 7820 3d20          index = 
-0000a800: 736e 6f64 652e 7061 7265 6e74 2e63 6869  snode.parent.chi
-0000a810: 6c64 7265 6e2e 696e 6465 7828 736e 6f64  ldren.index(snod
-0000a820: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
-0000a830: 2020 2020 666f 7220 6920 696e 2072 616e      for i in ran
-0000a840: 6765 2863 6f70 6965 7329 3a0d 0a20 2020  ge(copies):..   
-0000a850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a860: 2073 6e6f 6465 2e70 6172 656e 742e 6164   snode.parent.ad
-0000a870: 645f 7265 6665 7265 6e63 6528 736e 6f64  d_reference(snod
-0000a880: 652e 6e6f 6465 2c20 706f 733d 696e 6465  e.node, pos=inde
-0000a890: 7829 0d0a 2020 2020 2020 2020 2020 2020  x)..            
-0000a8a0: 2020 2020 736e 6f64 652e 6d6f 6469 6669      snode.modifi
-0000a8b0: 6564 2829 0d0a 0d0a 2020 2020 4074 7265  ed()....    @tre
-0000a8c0: 655f 636f 6e64 6974 696f 6e61 6c28 6c61  e_conditional(la
-0000a8d0: 6d62 6461 206e 6f64 653a 206e 6f64 652e  mbda node: node.
-0000a8e0: 636f 756e 745f 6368 696c 6472 656e 2829  count_children()
-0000a8f0: 203e 2031 290d 0a20 2020 2040 7472 6565   > 1)..    @tree
-0000a900: 5f6f 7065 7261 7469 6f6e 280d 0a20 2020  _operation(..   
-0000a910: 2020 2020 205f 2822 5265 7665 7273 6520       _("Reverse 
-0000a920: 7375 6269 7465 6d73 206f 7264 6572 2229  subitems order")
-0000a930: 2c0d 0a20 2020 2020 2020 206e 6f64 655f  ,..        node_
-0000a940: 7479 7065 3d28 0d0a 2020 2020 2020 2020  type=(..        
-0000a950: 2020 2020 226f 7020 6375 7422 2c0d 0a20      "op cut",.. 
-0000a960: 2020 2020 2020 2020 2020 2022 6f70 2072             "op r
-0000a970: 6173 7465 7222 2c0d 0a20 2020 2020 2020  aster",..       
-0000a980: 2020 2020 2022 6f70 2069 6d61 6765 222c       "op image",
-0000a990: 0d0a 2020 2020 2020 2020 2020 2020 226f  ..            "o
-0000a9a0: 7020 656e 6772 6176 6522 2c0d 0a20 2020  p engrave",..   
-0000a9b0: 2020 2020 2020 2020 2022 6f70 2064 6f74           "op dot
-0000a9c0: 7322 2c0d 0a20 2020 2020 2020 2020 2020  s",..           
-0000a9d0: 2022 6f70 2068 6174 6368 222c 0d0a 2020   "op hatch",..  
-0000a9e0: 2020 2020 2020 2020 2020 2267 726f 7570            "group
-0000a9f0: 222c 0d0a 2020 2020 2020 2020 2020 2020  ",..            
-0000aa00: 2262 7261 6e63 6820 656c 656d 7322 2c0d  "branch elems",.
-0000aa10: 0a20 2020 2020 2020 2020 2020 2022 6669  .            "fi
-0000aa20: 6c65 222c 0d0a 2020 2020 2020 2020 2020  le",..          
-0000aa30: 2020 2262 7261 6e63 6820 6f70 7322 2c0d    "branch ops",.
-0000aa40: 0a20 2020 2020 2020 2029 2c0d 0a20 2020  .        ),..   
-0000aa50: 2020 2020 2068 656c 703d 5f28 2252 6576       help=_("Rev
-0000aa60: 6572 7365 2074 6865 2069 7465 6d73 2077  erse the items w
-0000aa70: 6974 6869 6e20 7468 6973 2073 7562 6974  ithin this subit
-0000aa80: 656d 2229 2c0d 0a20 2020 2029 0d0a 2020  em"),..    )..  
-0000aa90: 2020 6465 6620 7265 7665 7273 655f 6c61    def reverse_la
-0000aaa0: 7965 725f 6f72 6465 7228 6e6f 6465 2c20  yer_order(node, 
-0000aab0: 2a2a 6b77 6172 6773 293a 0d0a 2020 2020  **kwargs):..    
-0000aac0: 2020 2020 6e6f 6465 2e72 6576 6572 7365      node.reverse
-0000aad0: 2829 0d0a 2020 2020 2020 2020 7365 6c66  ()..        self
-0000aae0: 2e73 6967 6e61 6c28 2272 6566 7265 7368  .signal("refresh
-0000aaf0: 5f74 7265 6522 2c20 6c69 7374 2873 656c  _tree", list(sel
-0000ab00: 662e 666c 6174 2874 7970 6573 3d22 7265  f.flat(types="re
-0000ab10: 6665 7265 6e63 6522 2929 290d 0a0d 0a20  ference"))).... 
-0000ab20: 2020 2040 7472 6565 5f73 6570 6172 6174     @tree_separat
-0000ab30: 6f72 5f61 6674 6572 2829 0d0a 2020 2020  or_after()..    
-0000ab40: 4074 7265 655f 636f 6e64 6974 696f 6e61  @tree_conditiona
-0000ab50: 6c28 6c61 6d62 6461 206e 6f64 653a 2073  l(lambda node: s
-0000ab60: 656c 662e 636c 6173 7369 6679 5f61 7574  elf.classify_aut
-0000ab70: 6f67 656e 6572 6174 6529 0d0a 2020 2020  ogenerate)..    
-0000ab80: 4074 7265 655f 6f70 6572 6174 696f 6e28  @tree_operation(
-0000ab90: 0d0a 2020 2020 2020 2020 5f28 2252 6566  ..        _("Ref
-0000aba0: 7265 7368 2063 6c61 7373 6966 6963 6174  resh classificat
-0000abb0: 696f 6e22 292c 0d0a 2020 2020 2020 2020  ion"),..        
-0000abc0: 6e6f 6465 5f74 7970 653d 2262 7261 6e63  node_type="branc
-0000abd0: 6820 6f70 7322 2c0d 0a20 2020 2020 2020  h ops",..       
-0000abe0: 2068 656c 703d 5f28 2252 6563 6c61 7373   help=_("Reclass
-0000abf0: 6966 7920 656c 656d 656e 7473 2061 6e64  ify elements and
-0000ac00: 2063 7265 6174 6520 6f70 6572 6174 696f   create operatio
-0000ac10: 6e73 2069 6620 6e65 6365 7373 6172 7922  ns if necessary"
-0000ac20: 292c 0d0a 2020 2020 290d 0a20 2020 2064  ),..    )..    d
-0000ac30: 6566 2072 6566 7265 7368 5f63 6c61 7369  ef refresh_clasi
-0000ac40: 6669 6361 7469 6f6e 735f 3128 6e6f 6465  fications_1(node
-0000ac50: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
-0000ac60: 2020 2020 2020 7365 6c66 2e72 656d 6f76        self.remov
-0000ac70: 655f 656c 656d 656e 7473 5f66 726f 6d5f  e_elements_from_
-0000ac80: 6f70 6572 6174 696f 6e73 286c 6973 7428  operations(list(
-0000ac90: 7365 6c66 2e65 6c65 6d73 2829 2929 0d0a  self.elems()))..
-0000aca0: 2020 2020 2020 2020 7365 6c66 2e63 6c61          self.cla
-0000acb0: 7373 6966 7928 6c69 7374 2873 656c 662e  ssify(list(self.
-0000acc0: 656c 656d 7328 2929 290d 0a20 2020 2020  elems()))..     
-0000acd0: 2020 2073 656c 662e 7369 676e 616c 2822     self.signal("
-0000ace0: 7265 6672 6573 685f 7472 6565 222c 206c  refresh_tree", l
-0000acf0: 6973 7428 7365 6c66 2e66 6c61 7428 7479  ist(self.flat(ty
-0000ad00: 7065 733d 2272 6566 6572 656e 6365 2229  pes="reference")
-0000ad10: 2929 0d0a 0d0a 2020 2020 4074 7265 655f  ))....    @tree_
-0000ad20: 636f 6e64 6974 696f 6e61 6c28 6c61 6d62  conditional(lamb
-0000ad30: 6461 206e 6f64 653a 206e 6f74 2073 656c  da node: not sel
-0000ad40: 662e 636c 6173 7369 6679 5f61 7574 6f67  f.classify_autog
-0000ad50: 656e 6572 6174 6529 0d0a 2020 2020 4074  enerate)..    @t
-0000ad60: 7265 655f 6f70 6572 6174 696f 6e28 0d0a  ree_operation(..
-0000ad70: 2020 2020 2020 2020 5f28 2252 6566 7265          _("Refre
-0000ad80: 7368 2063 6c61 7373 6966 6963 6174 696f  sh classificatio
-0000ad90: 6e22 292c 0d0a 2020 2020 2020 2020 6e6f  n"),..        no
-0000ada0: 6465 5f74 7970 653d 2262 7261 6e63 6820  de_type="branch 
-0000adb0: 6f70 7322 2c0d 0a20 2020 2020 2020 2068  ops",..        h
-0000adc0: 656c 703d 5f28 2252 6563 6c61 7373 6966  elp=_("Reclassif
-0000add0: 7920 656c 656d 656e 7473 2061 6e64 2075  y elements and u
-0000ade0: 7365 206f 6e6c 7920 6578 6973 7469 6e67  se only existing
-0000adf0: 206f 7065 7261 7469 6f6e 7322 292c 0d0a   operations"),..
-0000ae00: 2020 2020 290d 0a20 2020 2064 6566 2072      )..    def r
-0000ae10: 6566 7265 7368 5f63 6c61 7369 6669 6361  efresh_clasifica
-0000ae20: 7469 6f6e 735f 3228 6e6f 6465 2c20 2a2a  tions_2(node, **
-0000ae30: 6b77 6172 6773 293a 0d0a 2020 2020 2020  kwargs):..      
-0000ae40: 2020 7365 6c66 2e72 656d 6f76 655f 656c    self.remove_el
-0000ae50: 656d 656e 7473 5f66 726f 6d5f 6f70 6572  ements_from_oper
-0000ae60: 6174 696f 6e73 286c 6973 7428 7365 6c66  ations(list(self
-0000ae70: 2e65 6c65 6d73 2829 2929 0d0a 2020 2020  .elems()))..    
-0000ae80: 2020 2020 7365 6c66 2e63 6c61 7373 6966      self.classif
-0000ae90: 7928 6c69 7374 2873 656c 662e 656c 656d  y(list(self.elem
-0000aea0: 7328 2929 290d 0a20 2020 2020 2020 2073  s()))..        s
-0000aeb0: 656c 662e 7369 676e 616c 2822 7265 6672  elf.signal("refr
-0000aec0: 6573 685f 7472 6565 222c 206c 6973 7428  esh_tree", list(
-0000aed0: 7365 6c66 2e66 6c61 7428 7479 7065 733d  self.flat(types=
-0000aee0: 2272 6566 6572 656e 6365 2229 2929 0d0a  "reference")))..
-0000aef0: 0d0a 2020 2020 4074 7265 655f 7365 7061  ..    @tree_sepa
-0000af00: 7261 746f 725f 6166 7465 7228 290d 0a20  rator_after().. 
-0000af10: 2020 2040 7472 6565 5f63 6f6e 6469 7469     @tree_conditi
-0000af20: 6f6e 616c 286c 616d 6264 6120 6e6f 6465  onal(lambda node
-0000af30: 3a20 6e6f 7420 7365 6c66 2e63 6c61 7373  : not self.class
-0000af40: 6966 795f 6175 746f 6765 6e65 7261 7465  ify_autogenerate
-0000af50: 290d 0a20 2020 2040 7472 6565 5f6f 7065  )..    @tree_ope
-0000af60: 7261 7469 6f6e 280d 0a20 2020 2020 2020  ration(..       
-0000af70: 205f 2822 5265 6672 6573 6820 2e2e 2e20   _("Refresh ... 
-0000af80: 2869 6e63 6c20 6175 746f 6765 6e65 7261  (incl autogenera
-0000af90: 7469 6f6e 2922 292c 0d0a 2020 2020 2020  tion)"),..      
-0000afa0: 2020 6e6f 6465 5f74 7970 653d 2262 7261    node_type="bra
-0000afb0: 6e63 6820 6f70 7322 2c0d 0a20 2020 2020  nch ops",..     
-0000afc0: 2020 2068 656c 703d 5f28 2252 6563 6c61     help=_("Recla
-0000afd0: 7373 6966 7920 656c 656d 656e 7473 2061  ssify elements a
-0000afe0: 6e64 2063 7265 6174 6520 6f70 6572 6174  nd create operat
-0000aff0: 696f 6e73 2069 6620 6e65 6365 7373 6172  ions if necessar
-0000b000: 7922 292c 0d0a 2020 2020 290d 0a20 2020  y"),..    )..   
-0000b010: 2064 6566 2072 6566 7265 7368 5f63 6c61   def refresh_cla
-0000b020: 7369 6669 6361 7469 6f6e 735f 3328 6e6f  sifications_3(no
-0000b030: 6465 2c20 2a2a 6b77 6172 6773 293a 0d0a  de, **kwargs):..
-0000b040: 2020 2020 2020 2020 7072 6576 696f 7573          previous
-0000b050: 203d 2073 656c 662e 636c 6173 7369 6679   = self.classify
-0000b060: 5f61 7574 6f67 656e 6572 6174 650d 0a20  _autogenerate.. 
-0000b070: 2020 2020 2020 2073 656c 662e 636c 6173         self.clas
-0000b080: 7369 6679 5f61 7574 6f67 656e 6572 6174  sify_autogenerat
-0000b090: 6520 3d20 5472 7565 0d0a 2020 2020 2020  e = True..      
-0000b0a0: 2020 7365 6c66 2e72 656d 6f76 655f 656c    self.remove_el
-0000b0b0: 656d 656e 7473 5f66 726f 6d5f 6f70 6572  ements_from_oper
-0000b0c0: 6174 696f 6e73 286c 6973 7428 7365 6c66  ations(list(self
-0000b0d0: 2e65 6c65 6d73 2829 2929 0d0a 2020 2020  .elems()))..    
-0000b0e0: 2020 2020 7365 6c66 2e63 6c61 7373 6966      self.classif
-0000b0f0: 7928 6c69 7374 2873 656c 662e 656c 656d  y(list(self.elem
-0000b100: 7328 2929 290d 0a20 2020 2020 2020 2073  s()))..        s
-0000b110: 656c 662e 636c 6173 7369 6679 5f61 7574  elf.classify_aut
-0000b120: 6f67 656e 6572 6174 6520 3d20 7072 6576  ogenerate = prev
-0000b130: 696f 7573 0d0a 2020 2020 2020 2020 7365  ious..        se
-0000b140: 6c66 2e73 6967 6e61 6c28 2272 6566 7265  lf.signal("refre
-0000b150: 7368 5f74 7265 6522 2c20 6c69 7374 2873  sh_tree", list(s
-0000b160: 656c 662e 666c 6174 2874 7970 6573 3d22  elf.flat(types="
-0000b170: 7265 6665 7265 6e63 6522 2929 290d 0a0d  reference")))...
-0000b180: 0a20 2020 2040 7472 6565 5f63 6f6e 6469  .    @tree_condi
-0000b190: 7469 6f6e 616c 286c 616d 6264 6120 636f  tional(lambda co
-0000b1a0: 6e64 3a20 7365 6c66 2e68 6176 655f 756e  nd: self.have_un
-0000b1b0: 6173 7369 676e 6564 5f65 6c65 6d65 6e74  assigned_element
-0000b1c0: 7328 2929 0d0a 2020 2020 4074 7265 655f  s())..    @tree_
-0000b1d0: 6f70 6572 6174 696f 6e28 0d0a 2020 2020  operation(..    
-0000b1e0: 2020 2020 5f28 2253 656c 6563 7420 756e      _("Select un
-0000b1f0: 6173 7369 676e 6564 2065 6c65 6d65 6e74  assigned element
-0000b200: 7322 292c 0d0a 2020 2020 2020 2020 6e6f  s"),..        no
-0000b210: 6465 5f74 7970 653d 2262 7261 6e63 6820  de_type="branch 
-0000b220: 6f70 7322 2c0d 0a20 2020 2020 2020 2068  ops",..        h
-0000b230: 656c 703d 5f28 2253 656c 6563 7420 616c  elp=_("Select al
-0000b240: 6c20 656c 656d 656e 7473 2074 6861 7420  l elements that 
-0000b250: 776f 6e27 7420 6265 2062 7572 6e65 6422  won't be burned"
-0000b260: 292c 0d0a 2020 2020 290d 0a20 2020 2064  ),..    )..    d
-0000b270: 6566 2073 656c 6563 745f 756e 6173 7369  ef select_unassi
-0000b280: 676e 6564 286e 6f64 652c 202a 2a6b 7761  gned(node, **kwa
-0000b290: 7267 7329 3a0d 0a20 2020 2020 2020 2063  rgs):..        c
-0000b2a0: 6861 6e67 6573 203d 2046 616c 7365 0d0a  hanges = False..
-0000b2b0: 2020 2020 2020 2020 666f 7220 6e6f 6465          for node
-0000b2c0: 2069 6e20 7365 6c66 2e65 6c65 6d73 2829   in self.elems()
-0000b2d0: 3a0d 0a20 2020 2020 2020 2020 2020 2065  :..            e
-0000b2e0: 6d70 6861 7369 7320 3d20 626f 6f6c 286c  mphasis = bool(l
-0000b2f0: 656e 286e 6f64 652e 7265 6665 7265 6e63  en(node.referenc
-0000b300: 6573 2920 3d3d 2030 290d 0a20 2020 2020  es) == 0)..     
-0000b310: 2020 2020 2020 2069 6620 6e6f 6465 2e65         if node.e
-0000b320: 6d70 6861 7369 7a65 6420 213d 2065 6d70  mphasized != emp
-0000b330: 6861 7369 733a 0d0a 2020 2020 2020 2020  hasis:..        
-0000b340: 2020 2020 2020 2020 6368 616e 6765 7320          changes 
-0000b350: 3d20 5472 7565 0d0a 2020 2020 2020 2020  = True..        
-0000b360: 2020 2020 2020 2020 6e6f 6465 2e65 6d70          node.emp
-0000b370: 6861 7369 7a65 6420 3d20 656d 7068 6173  hasized = emphas
-0000b380: 6973 0d0a 2020 2020 2020 2020 6966 2063  is..        if c
-0000b390: 6861 6e67 6573 3a0d 0a20 2020 2020 2020  hanges:..       
-0000b3a0: 2020 2020 2073 656c 662e 7661 6c69 6461       self.valida
-0000b3b0: 7465 5f73 656c 6563 7465 645f 6172 6561  te_selected_area
-0000b3c0: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
-0000b3d0: 7365 6c66 2e73 6967 6e61 6c28 2272 6566  self.signal("ref
-0000b3e0: 7265 7368 5f73 6365 6e65 222c 2022 5363  resh_scene", "Sc
-0000b3f0: 656e 6522 290d 0a0d 0a20 2020 206d 6174  ene")....    mat
-0000b400: 6572 6961 6c73 203d 205b 0d0a 2020 2020  erials = [..    
-0000b410: 2020 2020 5f28 2257 6f6f 6422 292c 0d0a      _("Wood"),..
-0000b420: 2020 2020 2020 2020 5f28 2241 6372 796c          _("Acryl
-0000b430: 6963 2229 2c0d 0a20 2020 2020 2020 205f  ic"),..        _
-0000b440: 2822 466f 616d 2229 2c0d 0a20 2020 2020  ("Foam"),..     
-0000b450: 2020 205f 2822 4c65 6174 6865 7222 292c     _("Leather"),
-0000b460: 0d0a 2020 2020 2020 2020 5f28 2243 6172  ..        _("Car
-0000b470: 6462 6f61 7264 2229 2c0d 0a20 2020 2020  dboard"),..     
-0000b480: 2020 205f 2822 436f 726b 2229 2c0d 0a20     _("Cork"),.. 
-0000b490: 2020 2020 2020 205f 2822 5465 7874 696c         _("Textil
-0000b4a0: 6573 2229 2c0d 0a20 2020 2020 2020 205f  es"),..        _
-0000b4b0: 2822 5061 7065 7222 292c 0d0a 2020 2020  ("Paper"),..    
-0000b4c0: 2020 2020 5f28 2253 6176 652d 3122 292c      _("Save-1"),
-0000b4d0: 0d0a 2020 2020 2020 2020 5f28 2253 6176  ..        _("Sav
-0000b4e0: 652d 3222 292c 0d0a 2020 2020 2020 2020  e-2"),..        
-0000b4f0: 5f28 2253 6176 652d 3322 292c 0d0a 2020  _("Save-3"),..  
-0000b500: 2020 5d0d 0a0d 0a20 2020 2064 6566 2075    ]....    def u
-0000b510: 6e69 6f6e 5f6d 6174 6572 6961 6c73 5f73  nion_materials_s
-0000b520: 6176 6564 2829 3a0d 0a20 2020 2020 2020  aved():..       
-0000b530: 2075 6e69 6f6e 203d 205b 0d0a 2020 2020   union = [..    
-0000b540: 2020 2020 2020 2020 640d 0a20 2020 2020          d..     
-0000b550: 2020 2020 2020 2066 6f72 2064 2069 6e20         for d in 
-0000b560: 7365 6c66 2e6f 705f 6461 7461 2e73 6563  self.op_data.sec
-0000b570: 7469 6f6e 5f73 6574 2829 0d0a 2020 2020  tion_set()..    
-0000b580: 2020 2020 2020 2020 6966 2064 206e 6f74          if d not
-0000b590: 2069 6e20 6d61 7465 7269 616c 7320 616e   in materials an
-0000b5a0: 6420 6420 213d 2022 7072 6576 696f 7573  d d != "previous
-0000b5b0: 220d 0a20 2020 2020 2020 205d 0d0a 2020  "..        ]..  
-0000b5c0: 2020 2020 2020 756e 696f 6e2e 6578 7465        union.exte
-0000b5d0: 6e64 286d 6174 6572 6961 6c73 290d 0a20  nd(materials).. 
-0000b5e0: 2020 2020 2020 2072 6574 7572 6e20 756e         return un
-0000b5f0: 696f 6e0d 0a0d 0a20 2020 2064 6566 2064  ion....    def d
-0000b600: 6966 6665 7265 6e63 655f 6d61 7465 7269  ifference_materi
-0000b610: 616c 735f 7361 7665 6428 293a 0d0a 2020  als_saved():..  
-0000b620: 2020 2020 2020 7365 6373 203d 2073 656c        secs = sel
-0000b630: 662e 6f70 5f64 6174 612e 7365 6374 696f  f.op_data.sectio
-0000b640: 6e5f 7365 7428 290d 0a20 2020 2020 2020  n_set()..       
-0000b650: 2064 6966 6665 7265 6e63 6520 3d20 5b6d   difference = [m
-0000b660: 2066 6f72 206d 2069 6e20 6d61 7465 7269   for m in materi
-0000b670: 616c 7320 6966 206d 206e 6f74 2069 6e20  als if m not in 
-0000b680: 7365 6373 5d0d 0a20 2020 2020 2020 2072  secs]..        r
-0000b690: 6574 7572 6e20 6469 6666 6572 656e 6365  eturn difference
-0000b6a0: 0d0a 0d0a 2020 2020 4074 7265 655f 7375  ....    @tree_su
-0000b6b0: 626d 656e 7528 5f28 224c 6f61 6422 2929  bmenu(_("Load"))
-0000b6c0: 0d0a 2020 2020 4074 7265 655f 7661 6c75  ..    @tree_valu
-0000b6d0: 6573 2822 6f70 6e61 6d65 222c 2076 616c  es("opname", val
-0000b6e0: 7565 733d 7365 6c66 2e6f 705f 6461 7461  ues=self.op_data
-0000b6f0: 2e73 6563 7469 6f6e 5f73 6574 290d 0a20  .section_set).. 
-0000b700: 2020 2040 7472 6565 5f6f 7065 7261 7469     @tree_operati
-0000b710: 6f6e 2822 7b6f 706e 616d 657d 222c 206e  on("{opname}", n
-0000b720: 6f64 655f 7479 7065 3d22 6272 616e 6368  ode_type="branch
-0000b730: 206f 7073 222c 2068 656c 703d 2222 290d   ops", help="").
-0000b740: 0a20 2020 2064 6566 206c 6f61 645f 6f70  .    def load_op
-0000b750: 7328 6e6f 6465 2c20 6f70 6e61 6d65 2c20  s(node, opname, 
-0000b760: 2a2a 6b77 6172 6773 293a 0d0a 2020 2020  **kwargs):..    
-0000b770: 2020 2020 7365 6c66 2866 226d 6174 6572      self(f"mater
-0000b780: 6961 6c20 6c6f 6164 207b 6f70 6e61 6d65  ial load {opname
-0000b790: 7d5c 6e22 290d 0a0d 0a20 2020 2040 7472  }\n")....    @tr
-0000b7a0: 6565 5f73 6570 6172 6174 6f72 5f62 6566  ee_separator_bef
-0000b7b0: 6f72 6528 290d 0a20 2020 2040 7472 6565  ore()..    @tree
-0000b7c0: 5f73 7562 6d65 6e75 285f 2822 4c6f 6164  _submenu(_("Load
-0000b7d0: 2229 290d 0a20 2020 2040 7472 6565 5f6f  "))..    @tree_o
-0000b7e0: 7065 7261 7469 6f6e 285f 2822 4f74 6865  peration(_("Othe
-0000b7f0: 722f 426c 7565 2f52 6564 2229 2c20 6e6f  r/Blue/Red"), no
-0000b800: 6465 5f74 7970 653d 2262 7261 6e63 6820  de_type="branch 
-0000b810: 6f70 7322 2c20 6865 6c70 3d22 2229 0d0a  ops", help="")..
-0000b820: 2020 2020 6465 6620 6465 6661 756c 745f      def default_
-0000b830: 636c 6173 7369 6669 6361 7469 6f6e 7328  classifications(
-0000b840: 6e6f 6465 2c20 2a2a 6b77 6172 6773 293a  node, **kwargs):
-0000b850: 0d0a 2020 2020 2020 2020 7365 6c66 2e6c  ..        self.l
-0000b860: 6f61 645f 6465 6661 756c 7428 7065 7266  oad_default(perf
-0000b870: 6f72 6d63 6c61 7373 6966 793d 5472 7565  ormclassify=True
-0000b880: 290d 0a0d 0a20 2020 2040 7472 6565 5f73  )....    @tree_s
-0000b890: 7562 6d65 6e75 285f 2822 4c6f 6164 2229  ubmenu(_("Load")
-0000b8a0: 290d 0a20 2020 2040 7472 6565 5f73 6570  )..    @tree_sep
-0000b8b0: 6172 6174 6f72 5f61 6674 6572 2829 0d0a  arator_after()..
-0000b8c0: 2020 2020 4074 7265 655f 6f70 6572 6174      @tree_operat
-0000b8d0: 696f 6e28 5f28 2242 6173 6963 2229 2c20  ion(_("Basic"), 
-0000b8e0: 6e6f 6465 5f74 7970 653d 2262 7261 6e63  node_type="branc
-0000b8f0: 6820 6f70 7322 2c20 6865 6c70 3d22 2229  h ops", help="")
-0000b900: 0d0a 2020 2020 6465 6620 6261 7369 635f  ..    def basic_
-0000b910: 636c 6173 7369 6669 6361 7469 6f6e 7328  classifications(
-0000b920: 6e6f 6465 2c20 2a2a 6b77 6172 6773 293a  node, **kwargs):
-0000b930: 0d0a 2020 2020 2020 2020 7365 6c66 2e6c  ..        self.l
-0000b940: 6f61 645f 6465 6661 756c 7432 2870 6572  oad_default2(per
-0000b950: 666f 726d 636c 6173 7369 6679 3d54 7275  formclassify=Tru
-0000b960: 6529 0d0a 0d0a 2020 2020 4074 7265 655f  e)....    @tree_
-0000b970: 7375 626d 656e 7528 5f28 2253 6176 6522  submenu(_("Save"
-0000b980: 2929 0d0a 2020 2020 4074 7265 655f 7661  ))..    @tree_va
-0000b990: 6c75 6573 2822 6f70 6e61 6d65 222c 2076  lues("opname", v
-0000b9a0: 616c 7565 733d 7365 6c66 2e6f 705f 6461  alues=self.op_da
-0000b9b0: 7461 2e73 6563 7469 6f6e 5f73 6574 290d  ta.section_set).
-0000b9c0: 0a20 2020 2040 7472 6565 5f6f 7065 7261  .    @tree_opera
-0000b9d0: 7469 6f6e 2822 7b6f 706e 616d 657d 222c  tion("{opname}",
-0000b9e0: 206e 6f64 655f 7479 7065 3d22 6272 616e   node_type="bran
-0000b9f0: 6368 206f 7073 222c 2068 656c 703d 2222  ch ops", help=""
-0000ba00: 290d 0a20 2020 2064 6566 2073 6176 655f  )..    def save_
-0000ba10: 6d61 7465 7269 616c 7328 6e6f 6465 2c20  materials(node, 
-0000ba20: 6f70 6e61 6d65 3d22 7361 7665 6422 2c20  opname="saved", 
-0000ba30: 2a2a 6b77 6172 6773 293a 0d0a 2020 2020  **kwargs):..    
-0000ba40: 2020 2020 7365 6c66 2866 226d 6174 6572      self(f"mater
-0000ba50: 6961 6c20 7361 7665 207b 6f70 6e61 6d65  ial save {opname
-0000ba60: 7d5c 6e22 290d 0a0d 0a20 2020 2040 7472  }\n")....    @tr
-0000ba70: 6565 5f73 6570 6172 6174 6f72 5f62 6566  ee_separator_bef
-0000ba80: 6f72 6528 290d 0a20 2020 2040 7472 6565  ore()..    @tree
-0000ba90: 5f73 7562 6d65 6e75 285f 2822 5361 7665  _submenu(_("Save
-0000baa0: 2229 290d 0a20 2020 2040 7472 6565 5f70  "))..    @tree_p
-0000bab0: 726f 6d70 7428 226f 706e 616d 6522 2c20  rompt("opname", 
-0000bac0: 5f28 224e 616d 6520 746f 2073 746f 7265  _("Name to store
-0000bad0: 2063 7572 7265 6e74 206f 7065 7261 7469   current operati
-0000bae0: 6f6e 7320 756e 6465 723f 2229 290d 0a20  ons under?")).. 
-0000baf0: 2020 2040 7472 6565 5f6f 7065 7261 7469     @tree_operati
-0000bb00: 6f6e 285f 2822 4e65 7722 292c 206e 6f64  on(_("New"), nod
-0000bb10: 655f 7479 7065 3d22 6272 616e 6368 206f  e_type="branch o
-0000bb20: 7073 222c 2068 656c 703d 2222 290d 0a20  ps", help="").. 
-0000bb30: 2020 2064 6566 2073 6176 655f 6d61 7465     def save_mate
-0000bb40: 7269 616c 5f63 7573 746f 6d28 6e6f 6465  rial_custom(node
-0000bb50: 2c20 6f70 6e61 6d65 2c20 2a2a 6b77 6172  , opname, **kwar
-0000bb60: 6773 293a 0d0a 2020 2020 2020 2020 7365  gs):..        se
-0000bb70: 6c66 2866 226d 6174 6572 6961 6c20 7361  lf(f"material sa
-0000bb80: 7665 207b 6f70 6e61 6d65 2e72 6570 6c61  ve {opname.repla
-0000bb90: 6365 2827 2027 2c20 275f 2729 7d5c 6e22  ce(' ', '_')}\n"
-0000bba0: 290d 0a0d 0a20 2020 2040 7472 6565 5f73  )....    @tree_s
-0000bbb0: 7562 6d65 6e75 285f 2822 4465 6c65 7465  ubmenu(_("Delete
-0000bbc0: 2229 290d 0a20 2020 2040 7472 6565 5f76  "))..    @tree_v
-0000bbd0: 616c 7565 7328 226f 706e 616d 6522 2c20  alues("opname", 
-0000bbe0: 7661 6c75 6573 3d73 656c 662e 6f70 5f64  values=self.op_d
-0000bbf0: 6174 612e 7365 6374 696f 6e5f 7365 7429  ata.section_set)
-0000bc00: 0d0a 2020 2020 4074 7265 655f 6f70 6572  ..    @tree_oper
-0000bc10: 6174 696f 6e28 227b 6f70 6e61 6d65 7d22  ation("{opname}"
-0000bc20: 2c20 6e6f 6465 5f74 7970 653d 2262 7261  , node_type="bra
-0000bc30: 6e63 6820 6f70 7322 2c20 6865 6c70 3d22  nch ops", help="
-0000bc40: 2229 0d0a 2020 2020 6465 6620 7265 6d6f  ")..    def remo
-0000bc50: 7665 5f6f 7073 286e 6f64 652c 206f 706e  ve_ops(node, opn
-0000bc60: 616d 653d 2273 6176 6564 222c 202a 2a6b  ame="saved", **k
-0000bc70: 7761 7267 7329 3a0d 0a20 2020 2020 2020  wargs):..       
-0000bc80: 2073 656c 6628 6622 6d61 7465 7269 616c   self(f"material
-0000bc90: 2064 656c 6574 6520 7b6f 706e 616d 657d   delete {opname}
-0000bca0: 5c6e 2229 0d0a 0d0a 2020 2020 4074 7265  \n")....    @tre
-0000bcb0: 655f 7365 7061 7261 746f 725f 6265 666f  e_separator_befo
-0000bcc0: 7265 2829 0d0a 2020 2020 4074 7265 655f  re()..    @tree_
-0000bcd0: 7375 626d 656e 7528 5f28 2241 7070 656e  submenu(_("Appen
-0000bce0: 6420 6f70 6572 6174 696f 6e22 2929 0d0a  d operation"))..
-0000bcf0: 2020 2020 4074 7265 655f 6f70 6572 6174      @tree_operat
-0000bd00: 696f 6e28 5f28 2241 7070 656e 6420 496d  ion(_("Append Im
-0000bd10: 6167 6522 292c 206e 6f64 655f 7479 7065  age"), node_type
-0000bd20: 3d22 6272 616e 6368 206f 7073 222c 2068  ="branch ops", h
-0000bd30: 656c 703d 2222 290d 0a20 2020 2064 6566  elp="")..    def
-0000bd40: 2061 7070 656e 645f 6f70 6572 6174 696f   append_operatio
-0000bd50: 6e5f 696d 6167 6528 6e6f 6465 2c20 706f  n_image(node, po
-0000bd60: 733d 4e6f 6e65 2c20 2a2a 6b77 6172 6773  s=None, **kwargs
-0000bd70: 293a 0d0a 2020 2020 2020 2020 7365 6c66  ):..        self
-0000bd80: 2e6f 705f 6272 616e 6368 2e61 6464 2822  .op_branch.add("
-0000bd90: 6f70 2069 6d61 6765 222c 2070 6f73 3d70  op image", pos=p
-0000bda0: 6f73 290d 0a20 2020 2020 2020 2073 656c  os)..        sel
-0000bdb0: 662e 7369 676e 616c 2822 7570 6461 7465  f.signal("update
-0000bdc0: 6f70 5f74 7265 6522 290d 0a0d 0a20 2020  op_tree")....   
-0000bdd0: 2040 7472 6565 5f73 7562 6d65 6e75 285f   @tree_submenu(_
-0000bde0: 2822 4170 7065 6e64 206f 7065 7261 7469  ("Append operati
-0000bdf0: 6f6e 2229 290d 0a20 2020 2040 7472 6565  on"))..    @tree
-0000be00: 5f6f 7065 7261 7469 6f6e 285f 2822 4170  _operation(_("Ap
-0000be10: 7065 6e64 2052 6173 7465 7222 292c 206e  pend Raster"), n
-0000be20: 6f64 655f 7479 7065 3d22 6272 616e 6368  ode_type="branch
-0000be30: 206f 7073 222c 2068 656c 703d 2222 290d   ops", help="").
-0000be40: 0a20 2020 2064 6566 2061 7070 656e 645f  .    def append_
-0000be50: 6f70 6572 6174 696f 6e5f 7261 7374 6572  operation_raster
-0000be60: 286e 6f64 652c 2070 6f73 3d4e 6f6e 652c  (node, pos=None,
-0000be70: 202a 2a6b 7761 7267 7329 3a0d 0a20 2020   **kwargs):..   
-0000be80: 2020 2020 2073 656c 662e 6f70 5f62 7261       self.op_bra
-0000be90: 6e63 682e 6164 6428 226f 7020 7261 7374  nch.add("op rast
-0000bea0: 6572 222c 2070 6f73 3d70 6f73 290d 0a20  er", pos=pos).. 
-0000beb0: 2020 2020 2020 2073 656c 662e 7369 676e         self.sign
-0000bec0: 616c 2822 7570 6461 7465 6f70 5f74 7265  al("updateop_tre
-0000bed0: 6522 290d 0a0d 0a20 2020 2040 7472 6565  e")....    @tree
-0000bee0: 5f73 7562 6d65 6e75 285f 2822 4170 7065  _submenu(_("Appe
-0000bef0: 6e64 206f 7065 7261 7469 6f6e 2229 290d  nd operation")).
-0000bf00: 0a20 2020 2040 7472 6565 5f6f 7065 7261  .    @tree_opera
-0000bf10: 7469 6f6e 285f 2822 4170 7065 6e64 2045  tion(_("Append E
-0000bf20: 6e67 7261 7665 2229 2c20 6e6f 6465 5f74  ngrave"), node_t
-0000bf30: 7970 653d 2262 7261 6e63 6820 6f70 7322  ype="branch ops"
-0000bf40: 2c20 6865 6c70 3d22 2229 0d0a 2020 2020  , help="")..    
-0000bf50: 6465 6620 6170 7065 6e64 5f6f 7065 7261  def append_opera
-0000bf60: 7469 6f6e 5f65 6e67 7261 7665 286e 6f64  tion_engrave(nod
-0000bf70: 652c 2070 6f73 3d4e 6f6e 652c 202a 2a6b  e, pos=None, **k
-0000bf80: 7761 7267 7329 3a0d 0a20 2020 2020 2020  wargs):..       
-0000bf90: 2073 656c 662e 6f70 5f62 7261 6e63 682e   self.op_branch.
-0000bfa0: 6164 6428 226f 7020 656e 6772 6176 6522  add("op engrave"
-0000bfb0: 2c20 706f 733d 706f 7329 0d0a 2020 2020  , pos=pos)..    
-0000bfc0: 2020 2020 7365 6c66 2e73 6967 6e61 6c28      self.signal(
-0000bfd0: 2275 7064 6174 656f 705f 7472 6565 2229  "updateop_tree")
-0000bfe0: 0d0a 0d0a 2020 2020 4074 7265 655f 7375  ....    @tree_su
-0000bff0: 626d 656e 7528 5f28 2241 7070 656e 6420  bmenu(_("Append 
-0000c000: 6f70 6572 6174 696f 6e22 2929 0d0a 2020  operation"))..  
-0000c010: 2020 4074 7265 655f 6f70 6572 6174 696f    @tree_operatio
-0000c020: 6e28 5f28 2241 7070 656e 6420 4375 7422  n(_("Append Cut"
-0000c030: 292c 206e 6f64 655f 7479 7065 3d22 6272  ), node_type="br
-0000c040: 616e 6368 206f 7073 222c 2068 656c 703d  anch ops", help=
-0000c050: 2222 290d 0a20 2020 2064 6566 2061 7070  "")..    def app
-0000c060: 656e 645f 6f70 6572 6174 696f 6e5f 6375  end_operation_cu
-0000c070: 7428 6e6f 6465 2c20 706f 733d 4e6f 6e65  t(node, pos=None
-0000c080: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
-0000c090: 2020 2020 2020 7365 6c66 2e6f 705f 6272        self.op_br
-0000c0a0: 616e 6368 2e61 6464 2822 6f70 2063 7574  anch.add("op cut
-0000c0b0: 222c 2070 6f73 3d70 6f73 290d 0a20 2020  ", pos=pos)..   
-0000c0c0: 2020 2020 2073 656c 662e 7369 676e 616c       self.signal
-0000c0d0: 2822 7570 6461 7465 6f70 5f74 7265 6522  ("updateop_tree"
-0000c0e0: 290d 0a0d 0a20 2020 2040 7472 6565 5f73  )....    @tree_s
-0000c0f0: 7562 6d65 6e75 285f 2822 4170 7065 6e64  ubmenu(_("Append
-0000c100: 206f 7065 7261 7469 6f6e 2229 290d 0a20   operation")).. 
-0000c110: 2020 2040 7472 6565 5f6f 7065 7261 7469     @tree_operati
-0000c120: 6f6e 285f 2822 4170 7065 6e64 2048 6174  on(_("Append Hat
-0000c130: 6368 2229 2c20 6e6f 6465 5f74 7970 653d  ch"), node_type=
-0000c140: 2262 7261 6e63 6820 6f70 7322 2c20 6865  "branch ops", he
-0000c150: 6c70 3d22 2229 0d0a 2020 2020 6465 6620  lp="")..    def 
-0000c160: 6170 7065 6e64 5f6f 7065 7261 7469 6f6e  append_operation
-0000c170: 5f68 6174 6368 286e 6f64 652c 2070 6f73  _hatch(node, pos
-0000c180: 3d4e 6f6e 652c 202a 2a6b 7761 7267 7329  =None, **kwargs)
-0000c190: 3a0d 0a20 2020 2020 2020 2073 656c 662e  :..        self.
-0000c1a0: 6f70 5f62 7261 6e63 682e 6164 6428 226f  op_branch.add("o
-0000c1b0: 7020 6861 7463 6822 2c20 706f 733d 706f  p hatch", pos=po
-0000c1c0: 7329 0d0a 2020 2020 2020 2020 7365 6c66  s)..        self
-0000c1d0: 2e73 6967 6e61 6c28 2275 7064 6174 656f  .signal("updateo
-0000c1e0: 705f 7472 6565 2229 0d0a 0d0a 2020 2020  p_tree")....    
-0000c1f0: 4074 7265 655f 7375 626d 656e 7528 5f28  @tree_submenu(_(
-0000c200: 2241 7070 656e 6420 6f70 6572 6174 696f  "Append operatio
-0000c210: 6e22 2929 0d0a 2020 2020 4074 7265 655f  n"))..    @tree_
-0000c220: 6f70 6572 6174 696f 6e28 5f28 2241 7070  operation(_("App
-0000c230: 656e 6420 446f 7473 2229 2c20 6e6f 6465  end Dots"), node
-0000c240: 5f74 7970 653d 2262 7261 6e63 6820 6f70  _type="branch op
-0000c250: 7322 2c20 6865 6c70 3d22 2229 0d0a 2020  s", help="")..  
-0000c260: 2020 6465 6620 6170 7065 6e64 5f6f 7065    def append_ope
-0000c270: 7261 7469 6f6e 5f64 6f74 7328 6e6f 6465  ration_dots(node
-0000c280: 2c20 706f 733d 4e6f 6e65 2c20 2a2a 6b77  , pos=None, **kw
-0000c290: 6172 6773 293a 0d0a 2020 2020 2020 2020  args):..        
-0000c2a0: 7365 6c66 2e6f 705f 6272 616e 6368 2e61  self.op_branch.a
-0000c2b0: 6464 2822 6f70 2064 6f74 7322 2c20 706f  dd("op dots", po
-0000c2c0: 733d 706f 7329 0d0a 2020 2020 2020 2020  s=pos)..        
-0000c2d0: 7365 6c66 2e73 6967 6e61 6c28 2275 7064  self.signal("upd
-0000c2e0: 6174 656f 705f 7472 6565 2229 0d0a 0d0a  ateop_tree")....
-0000c2f0: 2020 2020 4074 7265 655f 7375 626d 656e      @tree_submen
-0000c300: 7528 5f28 2241 7070 656e 6420 7370 6563  u(_("Append spec
-0000c310: 6961 6c20 6f70 6572 6174 696f 6e28 7329  ial operation(s)
-0000c320: 2229 290d 0a20 2020 2040 7472 6565 5f6f  "))..    @tree_o
-0000c330: 7065 7261 7469 6f6e 285f 2822 4170 7065  peration(_("Appe
-0000c340: 6e64 2048 6f6d 6522 292c 206e 6f64 655f  nd Home"), node_
-0000c350: 7479 7065 3d22 6272 616e 6368 206f 7073  type="branch ops
-0000c360: 222c 2068 656c 703d 2222 290d 0a20 2020  ", help="")..   
-0000c370: 2064 6566 2061 7070 656e 645f 6f70 6572   def append_oper
-0000c380: 6174 696f 6e5f 686f 6d65 286e 6f64 652c  ation_home(node,
-0000c390: 2070 6f73 3d4e 6f6e 652c 202a 2a6b 7761   pos=None, **kwa
-0000c3a0: 7267 7329 3a0d 0a20 2020 2020 2020 2073  rgs):..        s
-0000c3b0: 656c 662e 6f70 5f62 7261 6e63 682e 6164  elf.op_branch.ad
-0000c3c0: 6428 7479 7065 3d22 7574 696c 2068 6f6d  d(type="util hom
-0000c3d0: 6522 2c20 706f 733d 706f 7329 0d0a 2020  e", pos=pos)..  
-0000c3e0: 2020 2020 2020 7365 6c66 2e73 6967 6e61        self.signa
-0000c3f0: 6c28 2275 7064 6174 656f 705f 7472 6565  l("updateop_tree
-0000c400: 2229 0d0a 0d0a 2020 2020 4074 7265 655f  ")....    @tree_
-0000c410: 7375 626d 656e 7528 5f28 2241 7070 656e  submenu(_("Appen
-0000c420: 6420 7370 6563 6961 6c20 6f70 6572 6174  d special operat
-0000c430: 696f 6e28 7329 2229 290d 0a20 2020 2040  ion(s)"))..    @
-0000c440: 7472 6565 5f6f 7065 7261 7469 6f6e 285f  tree_operation(_
-0000c450: 2822 4170 7065 6e64 2052 6574 7572 6e20  ("Append Return 
-0000c460: 746f 204f 7269 6769 6e22 292c 206e 6f64  to Origin"), nod
-0000c470: 655f 7479 7065 3d22 6272 616e 6368 206f  e_type="branch o
-0000c480: 7073 222c 2068 656c 703d 2222 290d 0a20  ps", help="").. 
-0000c490: 2020 2064 6566 2061 7070 656e 645f 6f70     def append_op
-0000c4a0: 6572 6174 696f 6e5f 676f 746f 286e 6f64  eration_goto(nod
-0000c4b0: 652c 2070 6f73 3d4e 6f6e 652c 202a 2a6b  e, pos=None, **k
-0000c4c0: 7761 7267 7329 3a0d 0a20 2020 2020 2020  wargs):..       
-0000c4d0: 2073 656c 662e 6f70 5f62 7261 6e63 682e   self.op_branch.
-0000c4e0: 6164 6428 7479 7065 3d22 7574 696c 2067  add(type="util g
-0000c4f0: 6f74 6f22 2c20 706f 733d 706f 732c 2078  oto", pos=pos, x
-0000c500: 3d30 2c20 793d 3029 0d0a 2020 2020 2020  =0, y=0)..      
-0000c510: 2020 7365 6c66 2e73 6967 6e61 6c28 2275    self.signal("u
-0000c520: 7064 6174 656f 705f 7472 6565 2229 0d0a  pdateop_tree")..
-0000c530: 0d0a 2020 2020 4074 7265 655f 7375 626d  ..    @tree_subm
-0000c540: 656e 7528 5f28 2241 7070 656e 6420 7370  enu(_("Append sp
-0000c550: 6563 6961 6c20 6f70 6572 6174 696f 6e28  ecial operation(
-0000c560: 7329 2229 290d 0a20 2020 2040 7472 6565  s)"))..    @tree
-0000c570: 5f6f 7065 7261 7469 6f6e 280d 0a20 2020  _operation(..   
-0000c580: 2020 2020 205f 2822 4170 7065 6e64 2053       _("Append S
-0000c590: 6574 204f 7269 6769 6e22 292c 0d0a 2020  et Origin"),..  
-0000c5a0: 2020 2020 2020 6e6f 6465 5f74 7970 653d        node_type=
-0000c5b0: 2262 7261 6e63 6820 6f70 7322 2c0d 0a20  "branch ops",.. 
-0000c5c0: 2020 2020 2020 2068 656c 703d 2222 2c0d         help="",.
-0000c5d0: 0a20 2020 2029 0d0a 2020 2020 6465 6620  .    )..    def 
-0000c5e0: 6170 7065 6e64 5f6f 7065 7261 7469 6f6e  append_operation
-0000c5f0: 5f73 6574 6f72 6967 696e 286e 6f64 652c  _setorigin(node,
-0000c600: 2070 6f73 3d4e 6f6e 652c 202a 2a6b 7761   pos=None, **kwa
-0000c610: 7267 7329 3a0d 0a20 2020 2020 2020 2073  rgs):..        s
-0000c620: 656c 662e 6f70 5f62 7261 6e63 682e 6164  elf.op_branch.ad
-0000c630: 6428 0d0a 2020 2020 2020 2020 2020 2020  d(..            
-0000c640: 7479 7065 3d22 7574 696c 206f 7269 6769  type="util origi
-0000c650: 6e22 2c0d 0a20 2020 2020 2020 2020 2020  n",..           
-0000c660: 2070 6f73 3d70 6f73 2c0d 0a20 2020 2020   pos=pos,..     
-0000c670: 2020 2020 2020 2078 3d4e 6f6e 652c 0d0a         x=None,..
-0000c680: 2020 2020 2020 2020 2020 2020 793d 4e6f              y=No
-0000c690: 6e65 2c0d 0a20 2020 2020 2020 2029 0d0a  ne,..        )..
-0000c6a0: 2020 2020 2020 2020 7365 6c66 2e73 6967          self.sig
-0000c6b0: 6e61 6c28 2275 7064 6174 656f 705f 7472  nal("updateop_tr
-0000c6c0: 6565 2229 0d0a 0d0a 2020 2020 4074 7265  ee")....    @tre
-0000c6d0: 655f 7375 626d 656e 7528 5f28 2241 7070  e_submenu(_("App
-0000c6e0: 656e 6420 7370 6563 6961 6c20 6f70 6572  end special oper
-0000c6f0: 6174 696f 6e28 7329 2229 290d 0a20 2020  ation(s)"))..   
-0000c700: 2040 7472 6565 5f6f 7065 7261 7469 6f6e   @tree_operation
-0000c710: 285f 2822 4170 7065 6e64 2042 6565 7022  (_("Append Beep"
-0000c720: 292c 206e 6f64 655f 7479 7065 3d22 6272  ), node_type="br
-0000c730: 616e 6368 206f 7073 222c 2068 656c 703d  anch ops", help=
-0000c740: 2222 290d 0a20 2020 2064 6566 2061 7070  "")..    def app
-0000c750: 656e 645f 6f70 6572 6174 696f 6e5f 6265  end_operation_be
-0000c760: 6570 286e 6f64 652c 2070 6f73 3d4e 6f6e  ep(node, pos=Non
-0000c770: 652c 202a 2a6b 7761 7267 7329 3a0d 0a20  e, **kwargs):.. 
-0000c780: 2020 2020 2020 2073 656c 662e 6f70 5f62         self.op_b
-0000c790: 7261 6e63 682e 6164 6428 0d0a 2020 2020  ranch.add(..    
-0000c7a0: 2020 2020 2020 2020 7479 7065 3d22 7574          type="ut
-0000c7b0: 696c 2063 6f6e 736f 6c65 222c 0d0a 2020  il console",..  
-0000c7c0: 2020 2020 2020 2020 2020 706f 733d 706f            pos=po
-0000c7d0: 732c 0d0a 2020 2020 2020 2020 2020 2020  s,..            
-0000c7e0: 636f 6d6d 616e 643d 2262 6565 7022 2c0d  command="beep",.
-0000c7f0: 0a20 2020 2020 2020 2029 0d0a 2020 2020  .        )..    
-0000c800: 2020 2020 7365 6c66 2e73 6967 6e61 6c28      self.signal(
-0000c810: 2275 7064 6174 656f 705f 7472 6565 2229  "updateop_tree")
-0000c820: 0d0a 0d0a 2020 2020 4074 7265 655f 7375  ....    @tree_su
-0000c830: 626d 656e 7528 5f28 2241 7070 656e 6420  bmenu(_("Append 
-0000c840: 7370 6563 6961 6c20 6f70 6572 6174 696f  special operatio
-0000c850: 6e28 7329 2229 290d 0a20 2020 2040 7472  n(s)"))..    @tr
-0000c860: 6565 5f6f 7065 7261 7469 6f6e 285f 2822  ee_operation(_("
-0000c870: 4170 7065 6e64 2049 6e74 6572 7275 7074  Append Interrupt
-0000c880: 2229 2c20 6e6f 6465 5f74 7970 653d 2262  "), node_type="b
-0000c890: 7261 6e63 6820 6f70 7322 2c20 6865 6c70  ranch ops", help
-0000c8a0: 3d22 2229 0d0a 2020 2020 6465 6620 6170  ="")..    def ap
-0000c8b0: 7065 6e64 5f6f 7065 7261 7469 6f6e 5f69  pend_operation_i
-0000c8c0: 6e74 6572 7275 7074 286e 6f64 652c 2070  nterrupt(node, p
-0000c8d0: 6f73 3d4e 6f6e 652c 202a 2a6b 7761 7267  os=None, **kwarg
-0000c8e0: 7329 3a0d 0a20 2020 2020 2020 2073 656c  s):..        sel
-0000c8f0: 662e 6f70 5f62 7261 6e63 682e 6164 6428  f.op_branch.add(
-0000c900: 0d0a 2020 2020 2020 2020 2020 2020 7479  ..            ty
-0000c910: 7065 3d22 7574 696c 2063 6f6e 736f 6c65  pe="util console
-0000c920: 222c 0d0a 2020 2020 2020 2020 2020 2020  ",..            
-0000c930: 706f 733d 706f 732c 0d0a 2020 2020 2020  pos=pos,..      
-0000c940: 2020 2020 2020 636f 6d6d 616e 643d 2769        command='i
-0000c950: 6e74 6572 7275 7074 2022 5370 6f6f 6c69  nterrupt "Spooli
-0000c960: 6e67 2077 6173 2069 6e74 6572 7275 7074  ng was interrupt
-0000c970: 6564 2227 2c0d 0a20 2020 2020 2020 2029  ed"',..        )
-0000c980: 0d0a 2020 2020 2020 2020 7365 6c66 2e73  ..        self.s
-0000c990: 6967 6e61 6c28 2275 7064 6174 656f 705f  ignal("updateop_
-0000c9a0: 7472 6565 2229 0d0a 0d0a 2020 2020 4074  tree")....    @t
-0000c9b0: 7265 655f 7375 626d 656e 7528 5f28 2241  ree_submenu(_("A
-0000c9c0: 7070 656e 6420 7370 6563 6961 6c20 6f70  ppend special op
-0000c9d0: 6572 6174 696f 6e28 7329 2229 290d 0a20  eration(s)")).. 
-0000c9e0: 2020 2040 7472 6565 5f70 726f 6d70 7428     @tree_prompt(
-0000c9f0: 2277 6169 745f 7469 6d65 222c 205f 2822  "wait_time", _("
-0000ca00: 5761 6974 2066 6f72 2068 6f77 206c 6f6e  Wait for how lon
-0000ca10: 6720 2869 6e20 7365 636f 6e64 7329 3f22  g (in seconds)?"
-0000ca20: 292c 2064 6174 615f 7479 7065 3d66 6c6f  ), data_type=flo
-0000ca30: 6174 290d 0a20 2020 2040 7472 6565 5f6f  at)..    @tree_o
-0000ca40: 7065 7261 7469 6f6e 285f 2822 4170 7065  peration(_("Appe
-0000ca50: 6e64 2057 6169 7422 292c 206e 6f64 655f  nd Wait"), node_
-0000ca60: 7479 7065 3d22 6272 616e 6368 206f 7073  type="branch ops
-0000ca70: 222c 2068 656c 703d 2222 290d 0a20 2020  ", help="")..   
-0000ca80: 2064 6566 2061 7070 656e 645f 6f70 6572   def append_oper
-0000ca90: 6174 696f 6e5f 7761 6974 286e 6f64 652c  ation_wait(node,
-0000caa0: 2077 6169 745f 7469 6d65 2c20 706f 733d   wait_time, pos=
-0000cab0: 4e6f 6e65 2c20 2a2a 6b77 6172 6773 293a  None, **kwargs):
-0000cac0: 0d0a 2020 2020 2020 2020 7365 6c66 2e6f  ..        self.o
-0000cad0: 705f 6272 616e 6368 2e61 6464 280d 0a20  p_branch.add(.. 
-0000cae0: 2020 2020 2020 2020 2020 2074 7970 653d             type=
-0000caf0: 2275 7469 6c20 7761 6974 222c 0d0a 2020  "util wait",..  
-0000cb00: 2020 2020 2020 2020 2020 706f 733d 706f            pos=po
-0000cb10: 732c 0d0a 2020 2020 2020 2020 2020 2020  s,..            
-0000cb20: 7761 6974 3d77 6169 745f 7469 6d65 2c0d  wait=wait_time,.
-0000cb30: 0a20 2020 2020 2020 2029 0d0a 2020 2020  .        )..    
-0000cb40: 2020 2020 7365 6c66 2e73 6967 6e61 6c28      self.signal(
-0000cb50: 2275 7064 6174 656f 705f 7472 6565 2229  "updateop_tree")
-0000cb60: 0d0a 0d0a 2020 2020 4074 7265 655f 7375  ....    @tree_su
-0000cb70: 626d 656e 7528 5f28 2241 7070 656e 6420  bmenu(_("Append 
-0000cb80: 7370 6563 6961 6c20 6f70 6572 6174 696f  special operatio
-0000cb90: 6e28 7329 2229 290d 0a20 2020 2040 7472  n(s)"))..    @tr
-0000cba0: 6565 5f6f 7065 7261 7469 6f6e 285f 2822  ee_operation(_("
-0000cbb0: 4170 7065 6e64 204f 7574 7075 7422 292c  Append Output"),
-0000cbc0: 206e 6f64 655f 7479 7065 3d22 6272 616e   node_type="bran
-0000cbd0: 6368 206f 7073 222c 2068 656c 703d 2222  ch ops", help=""
-0000cbe0: 290d 0a20 2020 2064 6566 2061 7070 656e  )..    def appen
-0000cbf0: 645f 6f70 6572 6174 696f 6e5f 6f75 7470  d_operation_outp
-0000cc00: 7574 286e 6f64 652c 2070 6f73 3d4e 6f6e  ut(node, pos=Non
-0000cc10: 652c 202a 2a6b 7761 7267 7329 3a0d 0a20  e, **kwargs):.. 
-0000cc20: 2020 2020 2020 2073 656c 662e 6f70 5f62         self.op_b
-0000cc30: 7261 6e63 682e 6164 6428 0d0a 2020 2020  ranch.add(..    
-0000cc40: 2020 2020 2020 2020 7479 7065 3d22 7574          type="ut
-0000cc50: 696c 206f 7574 7075 7422 2c0d 0a20 2020  il output",..   
-0000cc60: 2020 2020 2020 2020 2070 6f73 3d70 6f73           pos=pos
-0000cc70: 2c0d 0a20 2020 2020 2020 2020 2020 206f  ,..            o
-0000cc80: 7574 7075 745f 6d61 736b 3d30 2c0d 0a20  utput_mask=0,.. 
-0000cc90: 2020 2020 2020 2020 2020 206f 7574 7075             outpu
-0000cca0: 745f 7661 6c75 653d 302c 0d0a 2020 2020  t_value=0,..    
-0000ccb0: 2020 2020 2020 2020 6f75 7470 7574 5f6d          output_m
-0000ccc0: 6573 7361 6765 3d4e 6f6e 652c 0d0a 2020  essage=None,..  
-0000ccd0: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
-0000cce0: 2073 656c 662e 7369 676e 616c 2822 7570   self.signal("up
-0000ccf0: 6461 7465 6f70 5f74 7265 6522 290d 0a0d  dateop_tree")...
-0000cd00: 0a20 2020 2040 7472 6565 5f73 7562 6d65  .    @tree_subme
-0000cd10: 6e75 285f 2822 4170 7065 6e64 2073 7065  nu(_("Append spe
-0000cd20: 6369 616c 206f 7065 7261 7469 6f6e 2873  cial operation(s
-0000cd30: 2922 2929 0d0a 2020 2020 4074 7265 655f  )"))..    @tree_
-0000cd40: 6f70 6572 6174 696f 6e28 5f28 2241 7070  operation(_("App
-0000cd50: 656e 6420 496e 7075 7422 292c 206e 6f64  end Input"), nod
-0000cd60: 655f 7479 7065 3d22 6272 616e 6368 206f  e_type="branch o
-0000cd70: 7073 222c 2068 656c 703d 2222 290d 0a20  ps", help="").. 
-0000cd80: 2020 2064 6566 2061 7070 656e 645f 6f70     def append_op
-0000cd90: 6572 6174 696f 6e5f 696e 7075 7428 6e6f  eration_input(no
-0000cda0: 6465 2c20 706f 733d 4e6f 6e65 2c20 2a2a  de, pos=None, **
-0000cdb0: 6b77 6172 6773 293a 0d0a 2020 2020 2020  kwargs):..      
-0000cdc0: 2020 7365 6c66 2e6f 705f 6272 616e 6368    self.op_branch
-0000cdd0: 2e61 6464 280d 0a20 2020 2020 2020 2020  .add(..         
-0000cde0: 2020 2074 7970 653d 2275 7469 6c20 696e     type="util in
-0000cdf0: 7075 7422 2c0d 0a20 2020 2020 2020 2020  put",..         
-0000ce00: 2020 2070 6f73 3d70 6f73 2c0d 0a20 2020     pos=pos,..   
-0000ce10: 2020 2020 2020 2020 2069 6e70 7574 5f6d           input_m
-0000ce20: 6173 6b3d 302c 0d0a 2020 2020 2020 2020  ask=0,..        
-0000ce30: 2020 2020 696e 7075 745f 7661 6c75 653d      input_value=
-0000ce40: 302c 0d0a 2020 2020 2020 2020 2020 2020  0,..            
-0000ce50: 696e 7075 745f 6d65 7373 6167 653d 4e6f  input_message=No
-0000ce60: 6e65 2c0d 0a20 2020 2020 2020 2029 0d0a  ne,..        )..
-0000ce70: 2020 2020 2020 2020 7365 6c66 2e73 6967          self.sig
-0000ce80: 6e61 6c28 2275 7064 6174 656f 705f 7472  nal("updateop_tr
-0000ce90: 6565 2229 0d0a 0d0a 2020 2020 4074 7265  ee")....    @tre
-0000cea0: 655f 7375 626d 656e 7528 5f28 2241 7070  e_submenu(_("App
-0000ceb0: 656e 6420 7370 6563 6961 6c20 6f70 6572  end special oper
-0000cec0: 6174 696f 6e28 7329 2229 290d 0a20 2020  ation(s)"))..   
-0000ced0: 2040 7472 6565 5f6f 7065 7261 7469 6f6e   @tree_operation
-0000cee0: 285f 2822 4170 7065 6e64 2048 6f6d 652f  (_("Append Home/
-0000cef0: 4265 6570 2f49 6e74 6572 7275 7074 2229  Beep/Interrupt")
-0000cf00: 2c20 6e6f 6465 5f74 7970 653d 2262 7261  , node_type="bra
-0000cf10: 6e63 6820 6f70 7322 2c20 6865 6c70 3d22  nch ops", help="
-0000cf20: 2229 0d0a 2020 2020 6465 6620 6170 7065  ")..    def appe
-0000cf30: 6e64 5f6f 7065 7261 7469 6f6e 5f68 6f6d  nd_operation_hom
-0000cf40: 655f 6265 6570 5f69 6e74 6572 7275 7074  e_beep_interrupt
-0000cf50: 286e 6f64 652c 202a 2a6b 7761 7267 7329  (node, **kwargs)
-0000cf60: 3a0d 0a20 2020 2020 2020 2061 7070 656e  :..        appen
-0000cf70: 645f 6f70 6572 6174 696f 6e5f 686f 6d65  d_operation_home
-0000cf80: 286e 6f64 652c 202a 2a6b 7761 7267 7329  (node, **kwargs)
-0000cf90: 0d0a 2020 2020 2020 2020 6170 7065 6e64  ..        append
-0000cfa0: 5f6f 7065 7261 7469 6f6e 5f62 6565 7028  _operation_beep(
-0000cfb0: 6e6f 6465 2c20 2a2a 6b77 6172 6773 290d  node, **kwargs).
-0000cfc0: 0a20 2020 2020 2020 2061 7070 656e 645f  .        append_
-0000cfd0: 6f70 6572 6174 696f 6e5f 696e 7465 7272  operation_interr
-0000cfe0: 7570 7428 6e6f 6465 2c20 2a2a 6b77 6172  upt(node, **kwar
-0000cff0: 6773 290d 0a20 2020 2020 2020 2073 656c  gs)..        sel
-0000d000: 662e 7369 676e 616c 2822 7570 6461 7465  f.signal("update
-0000d010: 6f70 5f74 7265 6522 290d 0a0d 0a20 2020  op_tree")....   
-0000d020: 2040 7472 6565 5f73 7562 6d65 6e75 285f   @tree_submenu(_
-0000d030: 2822 4170 7065 6e64 2073 7065 6369 616c  ("Append special
-0000d040: 206f 7065 7261 7469 6f6e 2873 2922 2929   operation(s)"))
-0000d050: 0d0a 2020 2020 4074 7265 655f 6f70 6572  ..    @tree_oper
-0000d060: 6174 696f 6e28 5f28 2241 7070 656e 6420  ation(_("Append 
-0000d070: 4f72 6967 696e 2f42 6565 702f 496e 7465  Origin/Beep/Inte
-0000d080: 7272 7570 7422 292c 206e 6f64 655f 7479  rrupt"), node_ty
-0000d090: 7065 3d22 6272 616e 6368 206f 7073 222c  pe="branch ops",
-0000d0a0: 2068 656c 703d 2222 290d 0a20 2020 2064   help="")..    d
-0000d0b0: 6566 2061 7070 656e 645f 6f70 6572 6174  ef append_operat
-0000d0c0: 696f 6e5f 6f72 6967 696e 5f62 6565 705f  ion_origin_beep_
-0000d0d0: 696e 7465 7272 7570 7428 6e6f 6465 2c20  interrupt(node, 
-0000d0e0: 2a2a 6b77 6172 6773 293a 0d0a 2020 2020  **kwargs):..    
-0000d0f0: 2020 2020 6170 7065 6e64 5f6f 7065 7261      append_opera
-0000d100: 7469 6f6e 5f67 6f74 6f28 6e6f 6465 2c20  tion_goto(node, 
-0000d110: 2a2a 6b77 6172 6773 290d 0a20 2020 2020  **kwargs)..     
-0000d120: 2020 2061 7070 656e 645f 6f70 6572 6174     append_operat
-0000d130: 696f 6e5f 6265 6570 286e 6f64 652c 202a  ion_beep(node, *
-0000d140: 2a6b 7761 7267 7329 0d0a 2020 2020 2020  *kwargs)..      
-0000d150: 2020 6170 7065 6e64 5f6f 7065 7261 7469    append_operati
-0000d160: 6f6e 5f69 6e74 6572 7275 7074 286e 6f64  on_interrupt(nod
-0000d170: 652c 202a 2a6b 7761 7267 7329 0d0a 2020  e, **kwargs)..  
-0000d180: 2020 2020 2020 7365 6c66 2e73 6967 6e61        self.signa
-0000d190: 6c28 2275 7064 6174 656f 705f 7472 6565  l("updateop_tree
-0000d1a0: 2229 0d0a 0d0a 2020 2020 4074 7265 655f  ")....    @tree_
-0000d1b0: 7375 626d 656e 7528 5f28 2241 7070 656e  submenu(_("Appen
-0000d1c0: 6420 7370 6563 6961 6c20 6f70 6572 6174  d special operat
-0000d1d0: 696f 6e28 7329 2229 290d 0a20 2020 2040  ion(s)"))..    @
-0000d1e0: 7472 6565 5f6f 7065 7261 7469 6f6e 285f  tree_operation(_
-0000d1f0: 2822 4170 7065 6e64 2053 6875 7464 6f77  ("Append Shutdow
-0000d200: 6e22 292c 206e 6f64 655f 7479 7065 3d22  n"), node_type="
-0000d210: 6272 616e 6368 206f 7073 222c 2068 656c  branch ops", hel
-0000d220: 703d 2222 290d 0a20 2020 2064 6566 2061  p="")..    def a
-0000d230: 7070 656e 645f 6f70 6572 6174 696f 6e5f  ppend_operation_
-0000d240: 7368 7574 646f 776e 286e 6f64 652c 2070  shutdown(node, p
-0000d250: 6f73 3d4e 6f6e 652c 202a 2a6b 7761 7267  os=None, **kwarg
-0000d260: 7329 3a0d 0a20 2020 2020 2020 2073 656c  s):..        sel
-0000d270: 662e 6f70 5f62 7261 6e63 682e 6164 6428  f.op_branch.add(
-0000d280: 0d0a 2020 2020 2020 2020 2020 2020 7479  ..            ty
-0000d290: 7065 3d22 7574 696c 2063 6f6e 736f 6c65  pe="util console
-0000d2a0: 222c 0d0a 2020 2020 2020 2020 2020 2020  ",..            
-0000d2b0: 706f 733d 706f 732c 0d0a 2020 2020 2020  pos=pos,..      
-0000d2c0: 2020 2020 2020 636f 6d6d 616e 643d 2271        command="q
-0000d2d0: 7569 7422 2c0d 0a20 2020 2020 2020 2029  uit",..        )
-0000d2e0: 0d0a 2020 2020 2020 2020 7365 6c66 2e73  ..        self.s
-0000d2f0: 6967 6e61 6c28 2275 7064 6174 656f 705f  ignal("updateop_
-0000d300: 7472 6565 2229 0d0a 0d0a 2020 2020 4074  tree")....    @t
-0000d310: 7265 655f 7375 626d 656e 7528 5f28 2241  ree_submenu(_("A
-0000d320: 7070 656e 6420 7370 6563 6961 6c20 6f70  ppend special op
-0000d330: 6572 6174 696f 6e28 7329 2229 290d 0a20  eration(s)")).. 
-0000d340: 2020 2040 7472 6565 5f70 726f 6d70 7428     @tree_prompt(
-0000d350: 226f 706e 616d 6522 2c20 5f28 2243 6f6e  "opname", _("Con
-0000d360: 736f 6c65 2063 6f6d 6d61 6e64 2074 6f20  sole command to 
-0000d370: 6170 7065 6e64 2074 6f20 6f70 6572 6174  append to operat
-0000d380: 696f 6e73 3f22 2929 0d0a 2020 2020 4074  ions?"))..    @t
-0000d390: 7265 655f 6f70 6572 6174 696f 6e28 5f28  ree_operation(_(
-0000d3a0: 2241 7070 656e 6420 436f 6e73 6f6c 6522  "Append Console"
-0000d3b0: 292c 206e 6f64 655f 7479 7065 3d22 6272  ), node_type="br
-0000d3c0: 616e 6368 206f 7073 222c 2068 656c 703d  anch ops", help=
-0000d3d0: 2222 290d 0a20 2020 2064 6566 2061 7070  "")..    def app
-0000d3e0: 656e 645f 6f70 6572 6174 696f 6e5f 6375  end_operation_cu
-0000d3f0: 7374 6f6d 286e 6f64 652c 206f 706e 616d  stom(node, opnam
-0000d400: 652c 2070 6f73 3d4e 6f6e 652c 202a 2a6b  e, pos=None, **k
-0000d410: 7761 7267 7329 3a0d 0a20 2020 2020 2020  wargs):..       
-0000d420: 2073 656c 662e 6f70 5f62 7261 6e63 682e   self.op_branch.
-0000d430: 6164 6428 0d0a 2020 2020 2020 2020 2020  add(..          
-0000d440: 2020 7479 7065 3d22 7574 696c 2063 6f6e    type="util con
-0000d450: 736f 6c65 222c 0d0a 2020 2020 2020 2020  sole",..        
-0000d460: 2020 2020 706f 733d 706f 732c 0d0a 2020      pos=pos,..  
-0000d470: 2020 2020 2020 2020 2020 636f 6d6d 616e            comman
-0000d480: 643d 6f70 6e61 6d65 2c0d 0a20 2020 2020  d=opname,..     
-0000d490: 2020 2029 0d0a 2020 2020 2020 2020 7365     )..        se
-0000d4a0: 6c66 2e73 6967 6e61 6c28 2275 7064 6174  lf.signal("updat
-0000d4b0: 656f 705f 7472 6565 2229 0d0a 0d0a 2020  eop_tree")....  
-0000d4c0: 2020 4074 7265 655f 6f70 6572 6174 696f    @tree_operatio
-0000d4d0: 6e28 5f28 2252 6563 6c61 7373 6966 7920  n(_("Reclassify 
-0000d4e0: 6f70 6572 6174 696f 6e73 2229 2c20 6e6f  operations"), no
-0000d4f0: 6465 5f74 7970 653d 2262 7261 6e63 6820  de_type="branch 
-0000d500: 656c 656d 7322 2c20 6865 6c70 3d22 2229  elems", help="")
-0000d510: 0d0a 2020 2020 6465 6620 7265 636c 6173  ..    def reclas
-0000d520: 7369 6679 5f6f 7065 7261 7469 6f6e 7328  sify_operations(
-0000d530: 6e6f 6465 2c20 2a2a 6b77 6172 6773 293a  node, **kwargs):
-0000d540: 0d0a 2020 2020 2020 2020 656c 656d 7320  ..        elems 
-0000d550: 3d20 6c69 7374 2873 656c 662e 656c 656d  = list(self.elem
-0000d560: 7328 2929 0d0a 2020 2020 2020 2020 7365  s())..        se
-0000d570: 6c66 2e72 656d 6f76 655f 656c 656d 656e  lf.remove_elemen
-0000d580: 7473 5f66 726f 6d5f 6f70 6572 6174 696f  ts_from_operatio
-0000d590: 6e73 2865 6c65 6d73 290d 0a20 2020 2020  ns(elems)..     
-0000d5a0: 2020 2073 656c 662e 636c 6173 7369 6679     self.classify
-0000d5b0: 286c 6973 7428 7365 6c66 2e65 6c65 6d73  (list(self.elems
-0000d5c0: 2829 2929 0d0a 2020 2020 2020 2020 7365  ()))..        se
-0000d5d0: 6c66 2e73 6967 6e61 6c28 2272 6566 7265  lf.signal("refre
-0000d5e0: 7368 5f74 7265 6522 290d 0a0d 0a20 2020  sh_tree")....   
-0000d5f0: 2040 7472 6565 5f6f 7065 7261 7469 6f6e   @tree_operation
-0000d600: 280d 0a20 2020 2020 2020 205f 2822 5265  (..        _("Re
-0000d610: 6d6f 7665 2061 6c6c 2061 7373 6967 6e6d  move all assignm
-0000d620: 656e 7473 2066 726f 6d20 6f70 6572 6174  ents from operat
-0000d630: 696f 6e73 2229 2c0d 0a20 2020 2020 2020  ions"),..       
-0000d640: 206e 6f64 655f 7479 7065 3d22 6272 616e   node_type="bran
-0000d650: 6368 2065 6c65 6d73 222c 0d0a 2020 2020  ch elems",..    
-0000d660: 2020 2020 6865 6c70 3d5f 2822 416e 7920      help=_("Any 
-0000d670: 6578 6973 7469 6e67 2061 7373 6967 6e6d  existing assignm
-0000d680: 656e 7420 6f66 2065 6c65 6d65 6e74 7320  ent of elements 
-0000d690: 746f 206f 7065 7261 7469 6f6e 7320 7769  to operations wi
-0000d6a0: 6c6c 2062 6520 7265 6d6f 7665 6422 292c  ll be removed"),
-0000d6b0: 0d0a 2020 2020 290d 0a20 2020 2064 6566  ..    )..    def
-0000d6c0: 2072 656d 6f76 655f 616c 6c5f 6173 7369   remove_all_assi
-0000d6d0: 676e 6d65 6e74 7328 6e6f 6465 2c20 2a2a  gnments(node, **
-0000d6e0: 6b77 6172 6773 293a 0d0a 2020 2020 2020  kwargs):..      
-0000d6f0: 2020 7769 7468 2073 656c 662e 7374 6174    with self.stat
-0000d700: 6963 2822 7265 6d6f 7665 5f61 6c6c 5f61  ic("remove_all_a
-0000d710: 7373 6967 6e22 293a 0d0a 2020 2020 2020  ssign"):..      
-0000d720: 2020 2020 2020 666f 7220 6e6f 6465 2069        for node i
-0000d730: 6e20 7365 6c66 2e65 6c65 6d73 2829 3a0d  n self.elems():.
-0000d740: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d750: 2066 6f72 2072 6566 2069 6e20 6c69 7374   for ref in list
-0000d760: 286e 6f64 652e 7265 6665 7265 6e63 6573  (node.references
-0000d770: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-0000d780: 2020 2020 2020 2020 7265 662e 7265 6d6f          ref.remo
-0000d790: 7665 5f6e 6f64 6528 290d 0a20 2020 2020  ve_node()..     
-0000d7a0: 2020 2073 656c 662e 7369 676e 616c 2822     self.signal("
-0000d7b0: 7265 6672 6573 685f 7472 6565 2229 0d0a  refresh_tree")..
-0000d7c0: 0d0a 2020 2020 4074 7265 655f 6f70 6572  ..    @tree_oper
-0000d7d0: 6174 696f 6e28 0d0a 2020 2020 2020 2020  ation(..        
-0000d7e0: 5f28 2244 7570 6c69 6361 7465 206f 7065  _("Duplicate ope
-0000d7f0: 7261 7469 6f6e 2873 2922 292c 0d0a 2020  ration(s)"),..  
-0000d800: 2020 2020 2020 6e6f 6465 5f74 7970 653d        node_type=
-0000d810: 6f70 5f6e 6f64 6573 2c0d 0a20 2020 2020  op_nodes,..     
-0000d820: 2020 2068 656c 703d 5f28 2264 7570 6c69     help=_("dupli
-0000d830: 6361 7465 206f 7065 7261 7469 6f6e 206e  cate operation n
-0000d840: 6f64 6573 2229 2c0d 0a20 2020 2029 0d0a  odes"),..    )..
-0000d850: 2020 2020 6465 6620 6475 706c 6963 6174      def duplicat
-0000d860: 655f 6f70 6572 6174 696f 6e28 6e6f 6465  e_operation(node
-0000d870: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
-0000d880: 2020 2020 2020 7769 7468 2073 656c 662e        with self.
-0000d890: 7374 6174 6963 2822 6475 706c 6963 6174  static("duplicat
-0000d8a0: 655f 6f70 6572 6174 696f 6e22 293a 0d0a  e_operation"):..
-0000d8b0: 2020 2020 2020 2020 2020 2020 6f70 6572              oper
-0000d8c0: 6174 696f 6e73 203d 2073 656c 662e 5f74  ations = self._t
-0000d8d0: 7265 652e 6765 7428 7479 7065 3d22 6272  ree.get(type="br
-0000d8e0: 616e 6368 206f 7073 2229 2e63 6869 6c64  anch ops").child
-0000d8f0: 7265 6e0d 0a20 2020 2020 2020 2020 2020  ren..           
-0000d900: 2066 6f72 206f 7020 696e 2073 656c 662e   for op in self.
-0000d910: 6f70 7328 7365 6c65 6374 6564 3d54 7275  ops(selected=Tru
-0000d920: 6529 3a0d 0a20 2020 2020 2020 2020 2020  e):..           
-0000d930: 2020 2020 2074 7279 3a0d 0a20 2020 2020       try:..     
-0000d940: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0000d950: 6f73 203d 206f 7065 7261 7469 6f6e 732e  os = operations.
-0000d960: 696e 6465 7828 6f70 2920 2b20 310d 0a20  index(op) + 1.. 
-0000d970: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0000d980: 7863 6570 7420 5661 6c75 6545 7272 6f72  xcept ValueError
-0000d990: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0000d9a0: 2020 2020 2020 2070 6f73 203d 204e 6f6e         pos = Non
-0000d9b0: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
-0000d9c0: 2020 2063 6f70 795f 6f70 203d 2063 6f70     copy_op = cop
-0000d9d0: 7928 6f70 290d 0a20 2020 2020 2020 2020  y(op)..         
-0000d9e0: 2020 2020 2020 2073 656c 662e 6164 645f         self.add_
-0000d9f0: 6f70 2863 6f70 795f 6f70 2c20 706f 733d  op(copy_op, pos=
-0000da00: 706f 7329 0d0a 2020 2020 2020 2020 2020  pos)..          
-0000da10: 2020 2020 2020 666f 7220 6368 696c 6420        for child 
-0000da20: 696e 206f 702e 6368 696c 6472 656e 3a0d  in op.children:.
-0000da30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000da40: 2020 2020 2074 7279 3a0d 0a20 2020 2020       try:..     
-0000da50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000da60: 2020 2063 6f70 795f 6f70 2e61 6464 5f72     copy_op.add_r
-0000da70: 6566 6572 656e 6365 2863 6869 6c64 2e6e  eference(child.n
-0000da80: 6f64 6529 0d0a 2020 2020 2020 2020 2020  ode)..          
-0000da90: 2020 2020 2020 2020 2020 6578 6365 7074            except
-0000daa0: 2041 7474 7269 6275 7465 4572 726f 723a   AttributeError:
-0000dab0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000dac0: 2020 2020 2020 2020 2020 7061 7373 0d0a            pass..
-0000dad0: 0d0a 2020 2020 4074 7265 655f 636f 6e64  ..    @tree_cond
-0000dae0: 6974 696f 6e61 6c28 6c61 6d62 6461 206e  itional(lambda n
-0000daf0: 6f64 653a 206e 6f64 652e 636f 756e 745f  ode: node.count_
-0000db00: 6368 696c 6472 656e 2829 203e 2031 290d  children() > 1).
-0000db10: 0a20 2020 2040 7472 6565 5f73 7562 6d65  .    @tree_subme
-0000db20: 6e75 285f 2822 5061 7373 6573 2229 290d  nu(_("Passes")).
-0000db30: 0a20 2020 2040 7472 6565 5f6f 7065 7261  .    @tree_opera
-0000db40: 7469 6f6e 280d 0a20 2020 2020 2020 205f  tion(..        _
-0000db50: 2822 4164 6420 3120 7061 7373 2229 2c0d  ("Add 1 pass"),.
-0000db60: 0a20 2020 2020 2020 206e 6f64 655f 7479  .        node_ty
-0000db70: 7065 3d28 226f 7020 696d 6167 6522 2c20  pe=("op image", 
-0000db80: 226f 7020 656e 6772 6176 6522 2c20 226f  "op engrave", "o
-0000db90: 7020 6375 7422 2c20 226f 7020 6861 7463  p cut", "op hatc
-0000dba0: 6822 292c 0d0a 2020 2020 2020 2020 6865  h"),..        he
-0000dbb0: 6c70 3d22 222c 0d0a 2020 2020 290d 0a20  lp="",..    ).. 
-0000dbc0: 2020 2064 6566 2061 6464 5f31 5f70 6173     def add_1_pas
-0000dbd0: 7328 6e6f 6465 2c20 2a2a 6b77 6172 6773  s(node, **kwargs
-0000dbe0: 293a 0d0a 2020 2020 2020 2020 6164 645f  ):..        add_
-0000dbf0: 6e5f 7061 7373 6573 286e 6f64 652c 2063  n_passes(node, c
-0000dc00: 6f70 6965 733d 312c 202a 2a6b 7761 7267  opies=1, **kwarg
-0000dc10: 7329 0d0a 0d0a 2020 2020 4074 7265 655f  s)....    @tree_
-0000dc20: 636f 6e64 6974 696f 6e61 6c28 6c61 6d62  conditional(lamb
-0000dc30: 6461 206e 6f64 653a 206e 6f64 652e 636f  da node: node.co
-0000dc40: 756e 745f 6368 696c 6472 656e 2829 203e  unt_children() >
-0000dc50: 2031 290d 0a20 2020 2040 7472 6565 5f73   1)..    @tree_s
-0000dc60: 7562 6d65 6e75 285f 2822 5061 7373 6573  ubmenu(_("Passes
-0000dc70: 2229 290d 0a20 2020 2040 7472 6565 5f69  "))..    @tree_i
-0000dc80: 7465 7261 7465 2822 636f 7069 6573 222c  terate("copies",
-0000dc90: 2032 2c20 3130 290d 0a20 2020 2040 7472   2, 10)..    @tr
-0000dca0: 6565 5f6f 7065 7261 7469 6f6e 280d 0a20  ee_operation(.. 
-0000dcb0: 2020 2020 2020 205f 2822 4164 6420 7b63         _("Add {c
-0000dcc0: 6f70 6965 737d 2070 6173 7365 7322 292c  opies} passes"),
-0000dcd0: 0d0a 2020 2020 2020 2020 6e6f 6465 5f74  ..        node_t
-0000dce0: 7970 653d 2822 6f70 2069 6d61 6765 222c  ype=("op image",
-0000dcf0: 2022 6f70 2065 6e67 7261 7665 222c 2022   "op engrave", "
-0000dd00: 6f70 2063 7574 222c 2022 6f70 2068 6174  op cut", "op hat
-0000dd10: 6368 2229 2c0d 0a20 2020 2020 2020 2068  ch"),..        h
-0000dd20: 656c 703d 2222 2c0d 0a20 2020 2029 0d0a  elp="",..    )..
-0000dd30: 2020 2020 6465 6620 6164 645f 6e5f 7061      def add_n_pa
-0000dd40: 7373 6573 286e 6f64 652c 2063 6f70 6965  sses(node, copie
-0000dd50: 733d 312c 202a 2a6b 7761 7267 7329 3a0d  s=1, **kwargs):.
-0000dd60: 0a20 2020 2020 2020 2061 6464 5f6e 6f64  .        add_nod
-0000dd70: 6573 203d 206c 6973 7428 6e6f 6465 2e63  es = list(node.c
-0000dd80: 6869 6c64 7265 6e29 0d0a 0d0a 2020 2020  hildren)....    
-0000dd90: 2020 2020 7265 6d6f 7665 6420 3d20 4661      removed = Fa
-0000dda0: 6c73 650d 0a20 2020 2020 2020 2066 6f72  lse..        for
-0000ddb0: 2069 2069 6e20 7261 6e67 6528 302c 206c   i in range(0, l
-0000ddc0: 656e 2861 6464 5f6e 6f64 6573 2929 3a0d  en(add_nodes)):.
-0000ddd0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-0000dde0: 2071 2069 6e20 7261 6e67 6528 302c 2069   q in range(0, i
-0000ddf0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-0000de00: 2020 2020 6966 2061 6464 5f6e 6f64 6573      if add_nodes
-0000de10: 5b71 5d20 6973 2061 6464 5f6e 6f64 6573  [q] is add_nodes
-0000de20: 5b69 5d3a 0d0a 2020 2020 2020 2020 2020  [i]:..          
-0000de30: 2020 2020 2020 2020 2020 6164 645f 6e6f            add_no
-0000de40: 6465 735b 695d 203d 204e 6f6e 650d 0a20  des[i] = None.. 
-0000de50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000de60: 2020 2072 656d 6f76 6564 203d 2054 7275     removed = Tru
-0000de70: 650d 0a20 2020 2020 2020 2069 6620 7265  e..        if re
-0000de80: 6d6f 7665 643a 0d0a 2020 2020 2020 2020  moved:..        
-0000de90: 2020 2020 6164 645f 6e6f 6465 7320 3d20      add_nodes = 
-0000dea0: 5b63 2066 6f72 2063 2069 6e20 6164 645f  [c for c in add_
-0000deb0: 6e6f 6465 7320 6966 2063 2069 7320 6e6f  nodes if c is no
-0000dec0: 7420 4e6f 6e65 5d0d 0a20 2020 2020 2020  t None]..       
-0000ded0: 2061 6464 5f6e 6f64 6573 202a 3d20 636f   add_nodes *= co
-0000dee0: 7069 6573 0d0a 2020 2020 2020 2020 666f  pies..        fo
-0000def0: 7220 6e20 696e 2061 6464 5f6e 6f64 6573  r n in add_nodes
-0000df00: 3a0d 0a20 2020 2020 2020 2020 2020 206e  :..            n
-0000df10: 6f64 652e 6164 645f 7265 6665 7265 6e63  ode.add_referenc
-0000df20: 6528 6e2e 6e6f 6465 290d 0a20 2020 2020  e(n.node)..     
-0000df30: 2020 2073 656c 662e 7369 676e 616c 2822     self.signal("
-0000df40: 7265 6275 696c 645f 7472 6565 2229 0d0a  rebuild_tree")..
-0000df50: 0d0a 2020 2020 4074 7265 655f 636f 6e64  ..    @tree_cond
-0000df60: 6974 696f 6e61 6c28 6c61 6d62 6461 206e  itional(lambda n
-0000df70: 6f64 653a 206e 6f64 652e 636f 756e 745f  ode: node.count_
-0000df80: 6368 696c 6472 656e 2829 203e 2031 290d  children() > 1).
-0000df90: 0a20 2020 2040 7472 6565 5f73 7562 6d65  .    @tree_subme
-0000dfa0: 6e75 285f 2822 4475 706c 6963 6174 6520  nu(_("Duplicate 
-0000dfb0: 656c 656d 656e 7428 7329 2229 290d 0a20  element(s)")).. 
-0000dfc0: 2020 2040 7472 6565 5f6f 7065 7261 7469     @tree_operati
-0000dfd0: 6f6e 280d 0a20 2020 2020 2020 205f 2822  on(..        _("
-0000dfe0: 4475 706c 6963 6174 6520 656c 656d 656e  Duplicate elemen
-0000dff0: 7473 2031 2074 696d 6522 292c 0d0a 2020  ts 1 time"),..  
-0000e000: 2020 2020 2020 6e6f 6465 5f74 7970 653d        node_type=
-0000e010: 2822 6f70 2069 6d61 6765 222c 2022 6f70  ("op image", "op
-0000e020: 2065 6e67 7261 7665 222c 2022 6f70 2063   engrave", "op c
-0000e030: 7574 2229 2c0d 0a20 2020 2020 2020 2068  ut"),..        h
-0000e040: 656c 703d 2222 2c0d 0a20 2020 2029 0d0a  elp="",..    )..
-0000e050: 2020 2020 6465 6620 6475 705f 315f 636f      def dup_1_co
-0000e060: 7079 286e 6f64 652c 202a 2a6b 7761 7267  py(node, **kwarg
-0000e070: 7329 3a0d 0a20 2020 2020 2020 2064 7570  s):..        dup
-0000e080: 5f6e 5f63 6f70 6965 7328 6e6f 6465 2c20  _n_copies(node, 
-0000e090: 636f 7069 6573 3d31 2c20 2a2a 6b77 6172  copies=1, **kwar
-0000e0a0: 6773 290d 0a0d 0a20 2020 2040 7472 6565  gs)....    @tree
-0000e0b0: 5f63 6f6e 6469 7469 6f6e 616c 286c 616d  _conditional(lam
-0000e0c0: 6264 6120 6e6f 6465 3a20 6e6f 6465 2e63  bda node: node.c
-0000e0d0: 6f75 6e74 5f63 6869 6c64 7265 6e28 2920  ount_children() 
-0000e0e0: 3e20 3129 0d0a 2020 2020 4074 7265 655f  > 1)..    @tree_
-0000e0f0: 7375 626d 656e 7528 5f28 2244 7570 6c69  submenu(_("Dupli
-0000e100: 6361 7465 2065 6c65 6d65 6e74 2873 2922  cate element(s)"
-0000e110: 2929 0d0a 2020 2020 4074 7265 655f 6974  ))..    @tree_it
-0000e120: 6572 6174 6528 2263 6f70 6965 7322 2c20  erate("copies", 
-0000e130: 322c 2031 3029 0d0a 2020 2020 4074 7265  2, 10)..    @tre
-0000e140: 655f 6f70 6572 6174 696f 6e28 0d0a 2020  e_operation(..  
-0000e150: 2020 2020 2020 5f28 2244 7570 6c69 6361        _("Duplica
-0000e160: 7465 2065 6c65 6d65 6e74 7320 7b63 6f70  te elements {cop
-0000e170: 6965 737d 2074 696d 6573 2229 2c0d 0a20  ies} times"),.. 
-0000e180: 2020 2020 2020 206e 6f64 655f 7479 7065         node_type
-0000e190: 3d28 226f 7020 696d 6167 6522 2c20 226f  =("op image", "o
-0000e1a0: 7020 656e 6772 6176 6522 2c20 226f 7020  p engrave", "op 
-0000e1b0: 6375 7422 292c 0d0a 2020 2020 2020 2020  cut"),..        
-0000e1c0: 6865 6c70 3d22 222c 0d0a 2020 2020 290d  help="",..    ).
-0000e1d0: 0a20 2020 2064 6566 2064 7570 5f6e 5f63  .    def dup_n_c
-0000e1e0: 6f70 6965 7328 6e6f 6465 2c20 636f 7069  opies(node, copi
-0000e1f0: 6573 3d31 2c20 2a2a 6b77 6172 6773 293a  es=1, **kwargs):
-0000e200: 0d0a 2020 2020 2020 2020 2320 436f 6465  ..        # Code
-0000e210: 2069 6e20 7365 7269 6573 2e0d 0a20 2020   in series...   
-0000e220: 2020 2020 2023 2061 6464 5f6e 6f64 6573       # add_nodes
-0000e230: 203d 206c 6973 7428 6e6f 6465 2e63 6869   = list(node.chi
-0000e240: 6c64 7265 6e29 0d0a 2020 2020 2020 2020  ldren)..        
-0000e250: 2320 6164 645f 6e6f 6465 7320 2a3d 2063  # add_nodes *= c
-0000e260: 6f70 6965 730d 0a20 2020 2020 2020 2023  opies..        #
-0000e270: 2066 6f72 206e 2069 6e20 6164 645f 6e6f   for n in add_no
-0000e280: 6465 733a 0d0a 2020 2020 2020 2020 2320  des:..        # 
-0000e290: 2020 2020 6e6f 6465 2e61 6464 5f72 6566      node.add_ref
-0000e2a0: 6572 656e 6365 286e 2e6e 6f64 6529 0d0a  erence(n.node)..
-0000e2b0: 0d0a 2020 2020 2020 2020 2320 436f 6465  ..        # Code
-0000e2c0: 2069 6e20 7061 7261 6c6c 656c 2e0d 0a20   in parallel... 
-0000e2d0: 2020 2020 2020 2061 6464 5f6e 6f64 6573         add_nodes
-0000e2e0: 203d 206c 6973 7428 6e6f 6465 2e63 6869   = list(node.chi
-0000e2f0: 6c64 7265 6e29 0d0a 2020 2020 2020 2020  ldren)..        
-0000e300: 666f 7220 6920 696e 2072 616e 6765 286c  for i in range(l
-0000e310: 656e 2861 6464 5f6e 6f64 6573 2920 2d20  en(add_nodes) - 
-0000e320: 312c 202d 312c 202d 3129 3a0d 0a20 2020  1, -1, -1):..   
-0000e330: 2020 2020 2020 2020 206e 203d 2061 6464           n = add
-0000e340: 5f6e 6f64 6573 5b69 5d0d 0a20 2020 2020  _nodes[i]..     
-0000e350: 2020 2020 2020 2066 6f72 206b 2069 6e20         for k in 
-0000e360: 7261 6e67 6528 636f 7069 6573 293a 0d0a  range(copies):..
-0000e370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e380: 6e6f 6465 2e61 6464 5f72 6566 6572 656e  node.add_referen
-0000e390: 6365 286e 2e6e 6f64 652c 2070 6f73 3d69  ce(n.node, pos=i
-0000e3a0: 290d 0a0d 0a20 2020 2020 2020 2073 656c  )....        sel
-0000e3b0: 662e 7369 676e 616c 2822 7265 6672 6573  f.signal("refres
-0000e3c0: 685f 7472 6565 2229 0d0a 0d0a 2020 2020  h_tree")....    
-0000e3d0: 4074 7265 655f 6f70 6572 6174 696f 6e28  @tree_operation(
-0000e3e0: 0d0a 2020 2020 2020 2020 5f28 224d 616b  ..        _("Mak
-0000e3f0: 6520 7261 7374 6572 2069 6d61 6765 2229  e raster image")
-0000e400: 2c0d 0a20 2020 2020 2020 206e 6f64 655f  ,..        node_
-0000e410: 7479 7065 3d28 226f 7020 696d 6167 6522  type=("op image"
-0000e420: 2c20 226f 7020 7261 7374 6572 2229 2c0d  , "op raster"),.
-0000e430: 0a20 2020 2020 2020 2068 656c 703d 5f28  .        help=_(
-0000e440: 2243 7265 6174 6520 616e 2069 6d61 6765  "Create an image
-0000e450: 2066 726f 6d20 7468 6520 6173 7369 676e   from the assign
-0000e460: 6564 2065 6c65 6d65 6e74 732e 2229 2c0d  ed elements."),.
-0000e470: 0a20 2020 2029 0d0a 2020 2020 6465 6620  .    )..    def 
-0000e480: 6d61 6b65 5f72 6173 7465 725f 696d 6167  make_raster_imag
-0000e490: 6528 6e6f 6465 2c20 2a2a 6b77 6172 6773  e(node, **kwargs
-0000e4a0: 293a 0d0a 2020 2020 2020 2020 6461 7461  ):..        data
-0000e4b0: 203d 206c 6973 7428 6e6f 6465 2e66 6c61   = list(node.fla
-0000e4c0: 7428 7479 7065 733d 656c 656d 5f72 6566  t(types=elem_ref
-0000e4d0: 5f6e 6f64 6573 2929 0d0a 2020 2020 2020  _nodes))..      
-0000e4e0: 2020 6966 206c 656e 2864 6174 6129 203d    if len(data) =
-0000e4f0: 3d20 303a 0d0a 2020 2020 2020 2020 2020  = 0:..          
-0000e500: 2020 7265 7475 726e 0d0a 2020 2020 2020    return..      
-0000e510: 2020 7472 793a 0d0a 2020 2020 2020 2020    try:..        
-0000e520: 2020 2020 626f 756e 6473 203d 204e 6f64      bounds = Nod
-0000e530: 652e 756e 696f 6e5f 626f 756e 6473 2864  e.union_bounds(d
-0000e540: 6174 612c 2061 7474 723d 2270 6169 6e74  ata, attr="paint
-0000e550: 5f62 6f75 6e64 7322 290d 0a20 2020 2020  _bounds")..     
-0000e560: 2020 2020 2020 2077 6964 7468 203d 2062         width = b
-0000e570: 6f75 6e64 735b 325d 202d 2062 6f75 6e64  ounds[2] - bound
-0000e580: 735b 305d 0d0a 2020 2020 2020 2020 2020  s[0]..          
-0000e590: 2020 6865 6967 6874 203d 2062 6f75 6e64    height = bound
-0000e5a0: 735b 335d 202d 2062 6f75 6e64 735b 315d  s[3] - bounds[1]
-0000e5b0: 0d0a 2020 2020 2020 2020 6578 6365 7074  ..        except
-0000e5c0: 2054 7970 6545 7272 6f72 3a0d 0a20 2020   TypeError:..   
-0000e5d0: 2020 2020 2020 2020 2072 6169 7365 2043           raise C
-0000e5e0: 6f6d 6d61 6e64 5379 6e74 6178 4572 726f  ommandSyntaxErro
-0000e5f0: 720d 0a20 2020 2020 2020 206d 616b 655f  r..        make_
-0000e600: 7261 7374 6572 203d 2073 656c 662e 6c6f  raster = self.lo
-0000e610: 6f6b 7570 2822 7265 6e64 6572 2d6f 702f  okup("render-op/
-0000e620: 6d61 6b65 5f72 6173 7465 7222 290d 0a20  make_raster").. 
-0000e630: 2020 2020 2020 2069 6620 6e6f 7420 6d61         if not ma
-0000e640: 6b65 5f72 6173 7465 723a 0d0a 2020 2020  ke_raster:..    
-0000e650: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-0000e660: 6c75 6545 7272 6f72 2822 4e6f 2072 656e  lueError("No ren
-0000e670: 6465 7265 7220 6973 2072 6567 6973 7465  derer is registe
-0000e680: 7265 6420 746f 2070 6572 666f 726d 2072  red to perform r
-0000e690: 656e 6465 722e 2229 0d0a 0d0a 2020 2020  ender.")....    
-0000e6a0: 2020 2020 646f 7473 5f70 6572 5f75 6e69      dots_per_uni
-0000e6b0: 7473 203d 206e 6f64 652e 6470 6920 2f20  ts = node.dpi / 
-0000e6c0: 554e 4954 535f 5045 525f 494e 4348 0d0a  UNITS_PER_INCH..
-0000e6d0: 2020 2020 2020 2020 6e65 775f 7769 6474          new_widt
-0000e6e0: 6820 3d20 7769 6474 6820 2a20 646f 7473  h = width * dots
-0000e6f0: 5f70 6572 5f75 6e69 7473 0d0a 2020 2020  _per_units..    
-0000e700: 2020 2020 6e65 775f 6865 6967 6874 203d      new_height =
-0000e710: 2068 6569 6768 7420 2a20 646f 7473 5f70   height * dots_p
-0000e720: 6572 5f75 6e69 7473 0d0a 0d0a 2020 2020  er_units....    
-0000e730: 2020 2020 696d 6167 6520 3d20 6d61 6b65      image = make
-0000e740: 5f72 6173 7465 7228 0d0a 2020 2020 2020  _raster(..      
-0000e750: 2020 2020 2020 6461 7461 2c0d 0a20 2020        data,..   
-0000e760: 2020 2020 2020 2020 2062 6f75 6e64 733d           bounds=
-0000e770: 626f 756e 6473 2c0d 0a20 2020 2020 2020  bounds,..       
-0000e780: 2020 2020 2077 6964 7468 3d6e 6577 5f77       width=new_w
-0000e790: 6964 7468 2c0d 0a20 2020 2020 2020 2020  idth,..         
-0000e7a0: 2020 2068 6569 6768 743d 6e65 775f 6865     height=new_he
-0000e7b0: 6967 6874 2c0d 0a20 2020 2020 2020 2029  ight,..        )
-0000e7c0: 0d0a 2020 2020 2020 2020 6d61 7472 6978  ..        matrix
-0000e7d0: 203d 204d 6174 7269 782e 7363 616c 6528   = Matrix.scale(
-0000e7e0: 7769 6474 6820 2f20 6e65 775f 7769 6474  width / new_widt
-0000e7f0: 682c 2068 6569 6768 7420 2f20 6e65 775f  h, height / new_
-0000e800: 6865 6967 6874 290d 0a20 2020 2020 2020  height)..       
-0000e810: 206d 6174 7269 782e 706f 7374 5f74 7261   matrix.post_tra
-0000e820: 6e73 6c61 7465 2862 6f75 6e64 735b 305d  nslate(bounds[0]
-0000e830: 2c20 626f 756e 6473 5b31 5d29 0d0a 0d0a  , bounds[1])....
-0000e840: 2020 2020 2020 2020 696d 6167 655f 6e6f          image_no
-0000e850: 6465 203d 2049 6d61 6765 4e6f 6465 2869  de = ImageNode(i
-0000e860: 6d61 6765 3d69 6d61 6765 2c20 6d61 7472  mage=image, matr
-0000e870: 6978 3d6d 6174 7269 782c 2064 7069 3d6e  ix=matrix, dpi=n
-0000e880: 6f64 652e 6470 6929 0d0a 2020 2020 2020  ode.dpi)..      
-0000e890: 2020 7365 6c66 2e65 6c65 6d5f 6272 616e    self.elem_bran
-0000e8a0: 6368 2e61 6464 5f6e 6f64 6528 696d 6167  ch.add_node(imag
-0000e8b0: 655f 6e6f 6465 290d 0a20 2020 2020 2020  e_node)..       
-0000e8c0: 206e 6f64 652e 6164 645f 7265 6665 7265   node.add_refere
-0000e8d0: 6e63 6528 696d 6167 655f 6e6f 6465 290d  nce(image_node).
-0000e8e0: 0a20 2020 2020 2020 2073 656c 662e 7369  .        self.si
-0000e8f0: 676e 616c 2822 7265 6672 6573 685f 7363  gnal("refresh_sc
-0000e900: 656e 6522 2c20 2253 6365 6e65 2229 0d0a  ene", "Scene")..
-0000e910: 0d0a 2020 2020 6465 6620 6164 645f 6166  ..    def add_af
-0000e920: 7465 725f 696e 6465 7828 6e6f 6465 3d4e  ter_index(node=N
-0000e930: 6f6e 6529 3a0d 0a20 2020 2020 2020 2074  one):..        t
-0000e940: 7279 3a0d 0a20 2020 2020 2020 2020 2020  ry:..           
-0000e950: 2069 6620 6e6f 6465 2069 7320 4e6f 6e65   if node is None
-0000e960: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0000e970: 2020 206e 6f64 6520 3d20 6c69 7374 2873     node = list(s
-0000e980: 656c 662e 6f70 7328 7365 6c65 6374 6564  elf.ops(selected
-0000e990: 3d54 7275 6529 295b 2d31 5d0d 0a20 2020  =True))[-1]..   
-0000e9a0: 2020 2020 2020 2020 206f 7065 7261 7469           operati
-0000e9b0: 6f6e 7320 3d20 7365 6c66 2e5f 7472 6565  ons = self._tree
-0000e9c0: 2e67 6574 2874 7970 653d 2262 7261 6e63  .get(type="branc
-0000e9d0: 6820 6f70 7322 292e 6368 696c 6472 656e  h ops").children
-0000e9e0: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
-0000e9f0: 7475 726e 206f 7065 7261 7469 6f6e 732e  turn operations.
-0000ea00: 696e 6465 7828 6e6f 6465 2920 2b20 310d  index(node) + 1.
-0000ea10: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
-0000ea20: 2856 616c 7565 4572 726f 722c 2049 6e64  (ValueError, Ind
-0000ea30: 6578 4572 726f 7229 3a0d 0a20 2020 2020  exError):..     
-0000ea40: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
-0000ea50: 6e65 0d0a 0d0a 2020 2020 4074 7265 655f  ne....    @tree_
-0000ea60: 7365 7061 7261 746f 725f 6265 666f 7265  separator_before
-0000ea70: 2829 0d0a 2020 2020 4074 7265 655f 7375  ()..    @tree_su
-0000ea80: 626d 656e 7528 5f28 2249 6e73 6572 7420  bmenu(_("Insert 
-0000ea90: 6f70 6572 6174 696f 6e22 2929 0d0a 2020  operation"))..  
-0000eaa0: 2020 4074 7265 655f 6f70 6572 6174 696f    @tree_operatio
-0000eab0: 6e28 5f28 2241 6464 2049 6d61 6765 2229  n(_("Add Image")
-0000eac0: 2c20 6e6f 6465 5f74 7970 653d 6f70 5f6e  , node_type=op_n
-0000ead0: 6f64 6573 2c20 6865 6c70 3d22 2229 0d0a  odes, help="")..
-0000eae0: 2020 2020 6465 6620 6164 645f 6f70 6572      def add_oper
-0000eaf0: 6174 696f 6e5f 696d 6167 6528 6e6f 6465  ation_image(node
-0000eb00: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
-0000eb10: 2020 2020 2020 6170 7065 6e64 5f6f 7065        append_ope
-0000eb20: 7261 7469 6f6e 5f69 6d61 6765 286e 6f64  ration_image(nod
-0000eb30: 652c 2070 6f73 3d61 6464 5f61 6674 6572  e, pos=add_after
-0000eb40: 5f69 6e64 6578 286e 6f64 6529 2c20 2a2a  _index(node), **
-0000eb50: 6b77 6172 6773 290d 0a0d 0a20 2020 2040  kwargs)....    @
-0000eb60: 7472 6565 5f73 7562 6d65 6e75 285f 2822  tree_submenu(_("
-0000eb70: 496e 7365 7274 206f 7065 7261 7469 6f6e  Insert operation
-0000eb80: 2229 290d 0a20 2020 2040 7472 6565 5f6f  "))..    @tree_o
-0000eb90: 7065 7261 7469 6f6e 285f 2822 4164 6420  peration(_("Add 
-0000eba0: 5261 7374 6572 2229 2c20 6e6f 6465 5f74  Raster"), node_t
-0000ebb0: 7970 653d 6f70 5f6e 6f64 6573 2c20 6865  ype=op_nodes, he
-0000ebc0: 6c70 3d22 2229 0d0a 2020 2020 6465 6620  lp="")..    def 
-0000ebd0: 6164 645f 6f70 6572 6174 696f 6e5f 7261  add_operation_ra
-0000ebe0: 7374 6572 286e 6f64 652c 202a 2a6b 7761  ster(node, **kwa
-0000ebf0: 7267 7329 3a0d 0a20 2020 2020 2020 2061  rgs):..        a
-0000ec00: 7070 656e 645f 6f70 6572 6174 696f 6e5f  ppend_operation_
-0000ec10: 7261 7374 6572 286e 6f64 652c 2070 6f73  raster(node, pos
-0000ec20: 3d61 6464 5f61 6674 6572 5f69 6e64 6578  =add_after_index
-0000ec30: 286e 6f64 6529 2c20 2a2a 6b77 6172 6773  (node), **kwargs
-0000ec40: 290d 0a0d 0a20 2020 2040 7472 6565 5f73  )....    @tree_s
-0000ec50: 7562 6d65 6e75 285f 2822 496e 7365 7274  ubmenu(_("Insert
-0000ec60: 206f 7065 7261 7469 6f6e 2229 290d 0a20   operation")).. 
-0000ec70: 2020 2040 7472 6565 5f6f 7065 7261 7469     @tree_operati
-0000ec80: 6f6e 285f 2822 4164 6420 456e 6772 6176  on(_("Add Engrav
-0000ec90: 6522 292c 206e 6f64 655f 7479 7065 3d6f  e"), node_type=o
-0000eca0: 705f 6e6f 6465 732c 2068 656c 703d 2222  p_nodes, help=""
-0000ecb0: 290d 0a20 2020 2064 6566 2061 6464 5f6f  )..    def add_o
-0000ecc0: 7065 7261 7469 6f6e 5f65 6e67 7261 7665  peration_engrave
-0000ecd0: 286e 6f64 652c 202a 2a6b 7761 7267 7329  (node, **kwargs)
-0000ece0: 3a0d 0a20 2020 2020 2020 2061 7070 656e  :..        appen
-0000ecf0: 645f 6f70 6572 6174 696f 6e5f 656e 6772  d_operation_engr
-0000ed00: 6176 6528 6e6f 6465 2c20 706f 733d 6164  ave(node, pos=ad
-0000ed10: 645f 6166 7465 725f 696e 6465 7828 6e6f  d_after_index(no
-0000ed20: 6465 292c 202a 2a6b 7761 7267 7329 0d0a  de), **kwargs)..
-0000ed30: 0d0a 2020 2020 4074 7265 655f 7375 626d  ..    @tree_subm
-0000ed40: 656e 7528 5f28 2249 6e73 6572 7420 6f70  enu(_("Insert op
-0000ed50: 6572 6174 696f 6e22 2929 0d0a 2020 2020  eration"))..    
-0000ed60: 4074 7265 655f 6f70 6572 6174 696f 6e28  @tree_operation(
-0000ed70: 5f28 2241 6464 2043 7574 2229 2c20 6e6f  _("Add Cut"), no
-0000ed80: 6465 5f74 7970 653d 6f70 5f6e 6f64 6573  de_type=op_nodes
-0000ed90: 2c20 6865 6c70 3d22 2229 0d0a 2020 2020  , help="")..    
-0000eda0: 6465 6620 6164 645f 6f70 6572 6174 696f  def add_operatio
-0000edb0: 6e5f 6375 7428 6e6f 6465 2c20 2a2a 6b77  n_cut(node, **kw
-0000edc0: 6172 6773 293a 0d0a 2020 2020 2020 2020  args):..        
-0000edd0: 6170 7065 6e64 5f6f 7065 7261 7469 6f6e  append_operation
-0000ede0: 5f63 7574 286e 6f64 652c 2070 6f73 3d61  _cut(node, pos=a
-0000edf0: 6464 5f61 6674 6572 5f69 6e64 6578 286e  dd_after_index(n
-0000ee00: 6f64 6529 2c20 2a2a 6b77 6172 6773 290d  ode), **kwargs).
-0000ee10: 0a0d 0a20 2020 2040 7472 6565 5f73 7562  ...    @tree_sub
-0000ee20: 6d65 6e75 285f 2822 496e 7365 7274 206f  menu(_("Insert o
-0000ee30: 7065 7261 7469 6f6e 2229 290d 0a20 2020  peration"))..   
-0000ee40: 2040 7472 6565 5f6f 7065 7261 7469 6f6e   @tree_operation
-0000ee50: 285f 2822 4164 6420 4861 7463 6822 292c  (_("Add Hatch"),
-0000ee60: 206e 6f64 655f 7479 7065 3d6f 705f 6e6f   node_type=op_no
-0000ee70: 6465 732c 2068 656c 703d 2222 290d 0a20  des, help="").. 
-0000ee80: 2020 2064 6566 2061 6464 5f6f 7065 7261     def add_opera
-0000ee90: 7469 6f6e 5f68 6174 6368 286e 6f64 652c  tion_hatch(node,
-0000eea0: 202a 2a6b 7761 7267 7329 3a0d 0a20 2020   **kwargs):..   
-0000eeb0: 2020 2020 2061 7070 656e 645f 6f70 6572       append_oper
-0000eec0: 6174 696f 6e5f 6861 7463 6828 6e6f 6465  ation_hatch(node
-0000eed0: 2c20 706f 733d 6164 645f 6166 7465 725f  , pos=add_after_
-0000eee0: 696e 6465 7828 6e6f 6465 292c 202a 2a6b  index(node), **k
-0000eef0: 7761 7267 7329 0d0a 0d0a 2020 2020 4074  wargs)....    @t
-0000ef00: 7265 655f 7375 626d 656e 7528 5f28 2249  ree_submenu(_("I
-0000ef10: 6e73 6572 7420 6f70 6572 6174 696f 6e22  nsert operation"
-0000ef20: 2929 0d0a 2020 2020 4074 7265 655f 6f70  ))..    @tree_op
-0000ef30: 6572 6174 696f 6e28 5f28 2241 6464 2044  eration(_("Add D
-0000ef40: 6f74 7322 292c 206e 6f64 655f 7479 7065  ots"), node_type
-0000ef50: 3d6f 705f 6e6f 6465 732c 2068 656c 703d  =op_nodes, help=
-0000ef60: 2222 290d 0a20 2020 2064 6566 2061 6464  "")..    def add
-0000ef70: 5f6f 7065 7261 7469 6f6e 5f64 6f74 7328  _operation_dots(
-0000ef80: 6e6f 6465 2c20 2a2a 6b77 6172 6773 293a  node, **kwargs):
-0000ef90: 0d0a 2020 2020 2020 2020 6170 7065 6e64  ..        append
-0000efa0: 5f6f 7065 7261 7469 6f6e 5f64 6f74 7328  _operation_dots(
-0000efb0: 6e6f 6465 2c20 706f 733d 6164 645f 6166  node, pos=add_af
-0000efc0: 7465 725f 696e 6465 7828 6e6f 6465 292c  ter_index(node),
-0000efd0: 202a 2a6b 7761 7267 7329 0d0a 0d0a 2020   **kwargs)....  
-0000efe0: 2020 4074 7265 655f 7375 626d 656e 7528    @tree_submenu(
-0000eff0: 5f28 2249 6e73 6572 7420 7370 6563 6961  _("Insert specia
-0000f000: 6c20 6f70 6572 6174 696f 6e28 7329 2229  l operation(s)")
-0000f010: 290d 0a20 2020 2040 7472 6565 5f6f 7065  )..    @tree_ope
-0000f020: 7261 7469 6f6e 285f 2822 4164 6420 486f  ration(_("Add Ho
-0000f030: 6d65 2229 2c20 6e6f 6465 5f74 7970 653d  me"), node_type=
-0000f040: 6f70 5f6e 6f64 6573 2c20 6865 6c70 3d22  op_nodes, help="
-0000f050: 2229 0d0a 2020 2020 6465 6620 6164 645f  ")..    def add_
-0000f060: 6f70 6572 6174 696f 6e5f 686f 6d65 286e  operation_home(n
-0000f070: 6f64 652c 202a 2a6b 7761 7267 7329 3a0d  ode, **kwargs):.
-0000f080: 0a20 2020 2020 2020 2061 7070 656e 645f  .        append_
-0000f090: 6f70 6572 6174 696f 6e5f 686f 6d65 286e  operation_home(n
-0000f0a0: 6f64 652c 2070 6f73 3d61 6464 5f61 6674  ode, pos=add_aft
-0000f0b0: 6572 5f69 6e64 6578 286e 6f64 6529 2c20  er_index(node), 
-0000f0c0: 2a2a 6b77 6172 6773 290d 0a0d 0a20 2020  **kwargs)....   
-0000f0d0: 2040 7472 6565 5f73 7562 6d65 6e75 285f   @tree_submenu(_
-0000f0e0: 2822 496e 7365 7274 2073 7065 6369 616c  ("Insert special
-0000f0f0: 206f 7065 7261 7469 6f6e 2873 2922 2929   operation(s)"))
-0000f100: 0d0a 2020 2020 4074 7265 655f 6f70 6572  ..    @tree_oper
-0000f110: 6174 696f 6e28 5f28 2241 6464 2052 6574  ation(_("Add Ret
-0000f120: 7572 6e20 746f 204f 7269 6769 6e22 292c  urn to Origin"),
-0000f130: 206e 6f64 655f 7479 7065 3d6f 705f 6e6f   node_type=op_no
-0000f140: 6465 732c 2068 656c 703d 2222 290d 0a20  des, help="").. 
-0000f150: 2020 2064 6566 2061 6464 5f6f 7065 7261     def add_opera
-0000f160: 7469 6f6e 5f6f 7269 6769 6e28 6e6f 6465  tion_origin(node
-0000f170: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
-0000f180: 2020 2020 2020 6170 7065 6e64 5f6f 7065        append_ope
-0000f190: 7261 7469 6f6e 5f67 6f74 6f28 6e6f 6465  ration_goto(node
-0000f1a0: 2c20 706f 733d 6164 645f 6166 7465 725f  , pos=add_after_
-0000f1b0: 696e 6465 7828 6e6f 6465 292c 202a 2a6b  index(node), **k
-0000f1c0: 7761 7267 7329 0d0a 0d0a 2020 2020 4074  wargs)....    @t
-0000f1d0: 7265 655f 7375 626d 656e 7528 5f28 2249  ree_submenu(_("I
-0000f1e0: 6e73 6572 7420 7370 6563 6961 6c20 6f70  nsert special op
-0000f1f0: 6572 6174 696f 6e28 7329 2229 290d 0a20  eration(s)")).. 
-0000f200: 2020 2040 7472 6565 5f6f 7065 7261 7469     @tree_operati
-0000f210: 6f6e 285f 2822 4164 6420 4265 6570 2229  on(_("Add Beep")
-0000f220: 2c20 6e6f 6465 5f74 7970 653d 6f70 5f6e  , node_type=op_n
-0000f230: 6f64 6573 2c20 6865 6c70 3d22 2229 0d0a  odes, help="")..
-0000f240: 2020 2020 6465 6620 6164 645f 6f70 6572      def add_oper
-0000f250: 6174 696f 6e5f 6265 6570 286e 6f64 652c  ation_beep(node,
-0000f260: 202a 2a6b 7761 7267 7329 3a0d 0a20 2020   **kwargs):..   
-0000f270: 2020 2020 2061 7070 656e 645f 6f70 6572       append_oper
-0000f280: 6174 696f 6e5f 6265 6570 286e 6f64 652c  ation_beep(node,
-0000f290: 2070 6f73 3d61 6464 5f61 6674 6572 5f69   pos=add_after_i
-0000f2a0: 6e64 6578 286e 6f64 6529 2c20 2a2a 6b77  ndex(node), **kw
-0000f2b0: 6172 6773 290d 0a0d 0a20 2020 2040 7472  args)....    @tr
-0000f2c0: 6565 5f73 7562 6d65 6e75 285f 2822 496e  ee_submenu(_("In
-0000f2d0: 7365 7274 2073 7065 6369 616c 206f 7065  sert special ope
-0000f2e0: 7261 7469 6f6e 2873 2922 2929 0d0a 2020  ration(s)"))..  
-0000f2f0: 2020 4074 7265 655f 6f70 6572 6174 696f    @tree_operatio
-0000f300: 6e28 5f28 2241 6464 2049 6e74 6572 7275  n(_("Add Interru
-0000f310: 7074 2229 2c20 6e6f 6465 5f74 7970 653d  pt"), node_type=
-0000f320: 6f70 5f6e 6f64 6573 2c20 6865 6c70 3d22  op_nodes, help="
-0000f330: 2229 0d0a 2020 2020 6465 6620 6164 645f  ")..    def add_
-0000f340: 6f70 6572 6174 696f 6e5f 696e 7465 7272  operation_interr
-0000f350: 7570 7428 6e6f 6465 2c20 2a2a 6b77 6172  upt(node, **kwar
-0000f360: 6773 293a 0d0a 2020 2020 2020 2020 6170  gs):..        ap
-0000f370: 7065 6e64 5f6f 7065 7261 7469 6f6e 5f69  pend_operation_i
-0000f380: 6e74 6572 7275 7074 286e 6f64 652c 2070  nterrupt(node, p
-0000f390: 6f73 3d61 6464 5f61 6674 6572 5f69 6e64  os=add_after_ind
-0000f3a0: 6578 286e 6f64 6529 2c20 2a2a 6b77 6172  ex(node), **kwar
-0000f3b0: 6773 290d 0a0d 0a20 2020 2040 7472 6565  gs)....    @tree
-0000f3c0: 5f73 7562 6d65 6e75 285f 2822 496e 7365  _submenu(_("Inse
-0000f3d0: 7274 2073 7065 6369 616c 206f 7065 7261  rt special opera
-0000f3e0: 7469 6f6e 2873 2922 2929 0d0a 2020 2020  tion(s)"))..    
-0000f3f0: 4074 7265 655f 7072 6f6d 7074 2822 7761  @tree_prompt("wa
-0000f400: 6974 5f74 696d 6522 2c20 5f28 2257 6169  it_time", _("Wai
-0000f410: 7420 666f 7220 686f 7720 6c6f 6e67 2028  t for how long (
-0000f420: 696e 2073 6563 6f6e 6473 293f 2229 2c20  in seconds)?"), 
-0000f430: 6461 7461 5f74 7970 653d 666c 6f61 7429  data_type=float)
-0000f440: 0d0a 2020 2020 4074 7265 655f 6f70 6572  ..    @tree_oper
-0000f450: 6174 696f 6e28 5f28 2241 6464 2057 6169  ation(_("Add Wai
-0000f460: 7422 292c 206e 6f64 655f 7479 7065 3d6f  t"), node_type=o
-0000f470: 705f 6e6f 6465 732c 2068 656c 703d 2222  p_nodes, help=""
-0000f480: 290d 0a20 2020 2064 6566 2061 6464 5f6f  )..    def add_o
-0000f490: 7065 7261 7469 6f6e 5f77 6169 7428 6e6f  peration_wait(no
-0000f4a0: 6465 2c20 7761 6974 5f74 696d 652c 202a  de, wait_time, *
-0000f4b0: 2a6b 7761 7267 7329 3a0d 0a20 2020 2020  *kwargs):..     
-0000f4c0: 2020 2061 7070 656e 645f 6f70 6572 6174     append_operat
-0000f4d0: 696f 6e5f 7761 6974 280d 0a20 2020 2020  ion_wait(..     
-0000f4e0: 2020 2020 2020 206e 6f64 652c 2077 6169         node, wai
-0000f4f0: 745f 7469 6d65 3d77 6169 745f 7469 6d65  t_time=wait_time
-0000f500: 2c20 706f 733d 6164 645f 6166 7465 725f  , pos=add_after_
-0000f510: 696e 6465 7828 6e6f 6465 292c 202a 2a6b  index(node), **k
-0000f520: 7761 7267 730d 0a20 2020 2020 2020 2029  wargs..        )
-0000f530: 0d0a 0d0a 2020 2020 4074 7265 655f 7375  ....    @tree_su
-0000f540: 626d 656e 7528 5f28 2249 6e73 6572 7420  bmenu(_("Insert 
-0000f550: 7370 6563 6961 6c20 6f70 6572 6174 696f  special operatio
-0000f560: 6e28 7329 2229 290d 0a20 2020 2040 7472  n(s)"))..    @tr
-0000f570: 6565 5f6f 7065 7261 7469 6f6e 285f 2822  ee_operation(_("
-0000f580: 4164 6420 4f75 7470 7574 2229 2c20 6e6f  Add Output"), no
-0000f590: 6465 5f74 7970 653d 6f70 5f6e 6f64 6573  de_type=op_nodes
-0000f5a0: 2c20 6865 6c70 3d22 2229 0d0a 2020 2020  , help="")..    
-0000f5b0: 6465 6620 6164 645f 6f70 6572 6174 696f  def add_operatio
-0000f5c0: 6e5f 6f75 7470 7574 286e 6f64 652c 202a  n_output(node, *
-0000f5d0: 2a6b 7761 7267 7329 3a0d 0a20 2020 2020  *kwargs):..     
-0000f5e0: 2020 2061 7070 656e 645f 6f70 6572 6174     append_operat
-0000f5f0: 696f 6e5f 6f75 7470 7574 286e 6f64 652c  ion_output(node,
-0000f600: 2070 6f73 3d61 6464 5f61 6674 6572 5f69   pos=add_after_i
-0000f610: 6e64 6578 286e 6f64 6529 2c20 2a2a 6b77  ndex(node), **kw
-0000f620: 6172 6773 290d 0a0d 0a20 2020 2040 7472  args)....    @tr
-0000f630: 6565 5f73 7562 6d65 6e75 285f 2822 496e  ee_submenu(_("In
-0000f640: 7365 7274 2073 7065 6369 616c 206f 7065  sert special ope
-0000f650: 7261 7469 6f6e 2873 2922 2929 0d0a 2020  ration(s)"))..  
-0000f660: 2020 4074 7265 655f 6f70 6572 6174 696f    @tree_operatio
-0000f670: 6e28 5f28 2241 6464 2049 6e70 7574 2229  n(_("Add Input")
-0000f680: 2c20 6e6f 6465 5f74 7970 653d 6f70 5f6e  , node_type=op_n
-0000f690: 6f64 6573 2c20 6865 6c70 3d22 2229 0d0a  odes, help="")..
-0000f6a0: 2020 2020 6465 6620 6164 645f 6f70 6572      def add_oper
-0000f6b0: 6174 696f 6e5f 696e 7075 7428 6e6f 6465  ation_input(node
-0000f6c0: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
-0000f6d0: 2020 2020 2020 6170 7065 6e64 5f6f 7065        append_ope
-0000f6e0: 7261 7469 6f6e 5f69 6e70 7574 286e 6f64  ration_input(nod
-0000f6f0: 652c 2070 6f73 3d61 6464 5f61 6674 6572  e, pos=add_after
-0000f700: 5f69 6e64 6578 286e 6f64 6529 2c20 2a2a  _index(node), **
-0000f710: 6b77 6172 6773 290d 0a0d 0a20 2020 2040  kwargs)....    @
-0000f720: 7472 6565 5f73 7562 6d65 6e75 285f 2822  tree_submenu(_("
-0000f730: 496e 7365 7274 2073 7065 6369 616c 206f  Insert special o
-0000f740: 7065 7261 7469 6f6e 2873 2922 2929 0d0a  peration(s)"))..
-0000f750: 2020 2020 4074 7265 655f 6f70 6572 6174      @tree_operat
-0000f760: 696f 6e28 5f28 2241 6464 2048 6f6d 652f  ion(_("Add Home/
-0000f770: 4265 6570 2f49 6e74 6572 7275 7074 2229  Beep/Interrupt")
-0000f780: 2c20 6e6f 6465 5f74 7970 653d 6f70 5f6e  , node_type=op_n
-0000f790: 6f64 6573 2c20 6865 6c70 3d22 2229 0d0a  odes, help="")..
-0000f7a0: 2020 2020 6465 6620 6164 645f 6f70 6572      def add_oper
-0000f7b0: 6174 696f 6e5f 686f 6d65 5f62 6565 705f  ation_home_beep_
-0000f7c0: 696e 7465 7272 7570 7428 6e6f 6465 2c20  interrupt(node, 
-0000f7d0: 2a2a 6b77 6172 6773 293a 0d0a 2020 2020  **kwargs):..    
-0000f7e0: 2020 2020 706f 7320 3d20 6164 645f 6166      pos = add_af
-0000f7f0: 7465 725f 696e 6465 7828 6e6f 6465 290d  ter_index(node).
-0000f800: 0a20 2020 2020 2020 2061 7070 656e 645f  .        append_
-0000f810: 6f70 6572 6174 696f 6e5f 686f 6d65 286e  operation_home(n
-0000f820: 6f64 652c 2070 6f73 3d70 6f73 2c20 2a2a  ode, pos=pos, **
-0000f830: 6b77 6172 6773 290d 0a20 2020 2020 2020  kwargs)..       
-0000f840: 2069 6620 706f 733a 0d0a 2020 2020 2020   if pos:..      
-0000f850: 2020 2020 2020 706f 7320 2b3d 2031 0d0a        pos += 1..
-0000f860: 2020 2020 2020 2020 6170 7065 6e64 5f6f          append_o
-0000f870: 7065 7261 7469 6f6e 5f62 6565 7028 6e6f  peration_beep(no
-0000f880: 6465 2c20 706f 733d 706f 732c 202a 2a6b  de, pos=pos, **k
-0000f890: 7761 7267 7329 0d0a 2020 2020 2020 2020  wargs)..        
-0000f8a0: 6966 2070 6f73 3a0d 0a20 2020 2020 2020  if pos:..       
-0000f8b0: 2020 2020 2070 6f73 202b 3d20 310d 0a20       pos += 1.. 
-0000f8c0: 2020 2020 2020 2061 7070 656e 645f 6f70         append_op
-0000f8d0: 6572 6174 696f 6e5f 696e 7465 7272 7570  eration_interrup
-0000f8e0: 7428 6e6f 6465 2c20 706f 733d 706f 732c  t(node, pos=pos,
-0000f8f0: 202a 2a6b 7761 7267 7329 0d0a 0d0a 2020   **kwargs)....  
-0000f900: 2020 4074 7265 655f 7375 626d 656e 7528    @tree_submenu(
-0000f910: 5f28 2249 6e73 6572 7420 7370 6563 6961  _("Insert specia
-0000f920: 6c20 6f70 6572 6174 696f 6e28 7329 2229  l operation(s)")
-0000f930: 290d 0a20 2020 2040 7472 6565 5f6f 7065  )..    @tree_ope
-0000f940: 7261 7469 6f6e 285f 2822 4164 6420 4f72  ration(_("Add Or
-0000f950: 6967 696e 2f42 6565 702f 496e 7465 7272  igin/Beep/Interr
-0000f960: 7570 7422 292c 206e 6f64 655f 7479 7065  upt"), node_type
-0000f970: 3d6f 705f 6e6f 6465 732c 2068 656c 703d  =op_nodes, help=
-0000f980: 2222 290d 0a20 2020 2064 6566 2061 6464  "")..    def add
-0000f990: 5f6f 7065 7261 7469 6f6e 5f6f 7269 6769  _operation_origi
-0000f9a0: 6e5f 6265 6570 5f69 6e74 6572 7275 7074  n_beep_interrupt
-0000f9b0: 286e 6f64 652c 202a 2a6b 7761 7267 7329  (node, **kwargs)
-0000f9c0: 3a0d 0a20 2020 2020 2020 2070 6f73 203d  :..        pos =
-0000f9d0: 2061 6464 5f61 6674 6572 5f69 6e64 6578   add_after_index
-0000f9e0: 286e 6f64 6529 0d0a 2020 2020 2020 2020  (node)..        
-0000f9f0: 6170 7065 6e64 5f6f 7065 7261 7469 6f6e  append_operation
-0000fa00: 5f67 6f74 6f28 6e6f 6465 2c20 706f 733d  _goto(node, pos=
-0000fa10: 706f 732c 202a 2a6b 7761 7267 7329 0d0a  pos, **kwargs)..
-0000fa20: 2020 2020 2020 2020 6966 2070 6f73 3a0d          if pos:.
-0000fa30: 0a20 2020 2020 2020 2020 2020 2070 6f73  .            pos
-0000fa40: 202b 3d20 310d 0a20 2020 2020 2020 2061   += 1..        a
-0000fa50: 7070 656e 645f 6f70 6572 6174 696f 6e5f  ppend_operation_
-0000fa60: 6265 6570 286e 6f64 652c 2070 6f73 3d70  beep(node, pos=p
-0000fa70: 6f73 2c20 2a2a 6b77 6172 6773 290d 0a20  os, **kwargs).. 
-0000fa80: 2020 2020 2020 2069 6620 706f 733a 0d0a         if pos:..
-0000fa90: 2020 2020 2020 2020 2020 2020 706f 7320              pos 
-0000faa0: 2b3d 2031 0d0a 2020 2020 2020 2020 6170  += 1..        ap
-0000fab0: 7065 6e64 5f6f 7065 7261 7469 6f6e 5f69  pend_operation_i
-0000fac0: 6e74 6572 7275 7074 286e 6f64 652c 2070  nterrupt(node, p
-0000fad0: 6f73 3d70 6f73 2c20 2a2a 6b77 6172 6773  os=pos, **kwargs
-0000fae0: 290d 0a0d 0a20 2020 2040 7472 6565 5f6f  )....    @tree_o
-0000faf0: 7065 7261 7469 6f6e 285f 2822 5265 6c6f  peration(_("Relo
-0000fb00: 6164 2027 7b6e 616d 657d 2722 292c 206e  ad '{name}'"), n
-0000fb10: 6f64 655f 7479 7065 3d22 6669 6c65 222c  ode_type="file",
-0000fb20: 2068 656c 703d 2222 290d 0a20 2020 2064   help="")..    d
-0000fb30: 6566 2072 656c 6f61 645f 6669 6c65 286e  ef reload_file(n
-0000fb40: 6f64 652c 202a 2a6b 7761 7267 7329 3a0d  ode, **kwargs):.
-0000fb50: 0a20 2020 2020 2020 2066 696c 6570 6174  .        filepat
-0000fb60: 6820 3d20 6e6f 6465 2e66 696c 6570 6174  h = node.filepat
-0000fb70: 680d 0a20 2020 2020 2020 206e 6f64 652e  h..        node.
-0000fb80: 7265 6d6f 7665 5f6e 6f64 6528 290d 0a20  remove_node().. 
-0000fb90: 2020 2020 2020 2073 656c 662e 6c6f 6164         self.load
-0000fba0: 2866 696c 6570 6174 6829 0d0a 0d0a 2020  (filepath)....  
-0000fbb0: 2020 4074 7265 655f 6f70 6572 6174 696f    @tree_operatio
-0000fbc0: 6e28 0d0a 2020 2020 2020 2020 5f28 224f  n(..        _("O
-0000fbd0: 7065 6e20 696e 2053 7973 7465 6d3a 2027  pen in System: '
-0000fbe0: 7b6e 616d 657d 2722 292c 0d0a 2020 2020  {name}'"),..    
-0000fbf0: 2020 2020 6e6f 6465 5f74 7970 653d 2266      node_type="f
-0000fc00: 696c 6522 2c0d 0a20 2020 2020 2020 2068  ile",..        h
-0000fc10: 656c 703d 5f28 0d0a 2020 2020 2020 2020  elp=_(..        
-0000fc20: 2020 2020 224f 7065 6e20 7468 6973 2066      "Open this f
-0000fc30: 696c 6520 696e 2074 6865 2073 7973 7465  ile in the syste
-0000fc40: 6d20 6170 706c 6963 6174 696f 6e20 6173  m application as
-0000fc50: 736f 6369 6174 6564 2077 6974 6820 7468  sociated with th
-0000fc60: 6973 2074 7970 6520 6f66 2066 696c 6522  is type of file"
-0000fc70: 0d0a 2020 2020 2020 2020 292c 0d0a 2020  ..        ),..  
-0000fc80: 2020 290d 0a20 2020 2064 6566 206f 7065    )..    def ope
-0000fc90: 6e5f 7379 7374 656d 5f66 696c 6528 6e6f  n_system_file(no
-0000fca0: 6465 2c20 2a2a 6b77 6172 6773 293a 0d0a  de, **kwargs):..
-0000fcb0: 2020 2020 2020 2020 6669 6c65 7061 7468          filepath
-0000fcc0: 203d 206e 6f64 652e 6669 6c65 7061 7468   = node.filepath
-0000fcd0: 0d0a 2020 2020 2020 2020 6e6f 726d 616c  ..        normal
-0000fce0: 697a 6564 203d 206f 732e 7061 7468 2e72  ized = os.path.r
-0000fcf0: 6561 6c70 6174 6828 6669 6c65 7061 7468  ealpath(filepath
-0000fd00: 290d 0a0d 0a20 2020 2020 2020 2069 6d70  )....        imp
-0000fd10: 6f72 7420 706c 6174 666f 726d 0d0a 0d0a  ort platform....
-0000fd20: 2020 2020 2020 2020 7379 7374 656d 203d          system =
-0000fd30: 2070 6c61 7466 6f72 6d2e 7379 7374 656d   platform.system
-0000fd40: 2829 0d0a 2020 2020 2020 2020 6966 2073  ()..        if s
-0000fd50: 7973 7465 6d20 3d3d 2022 4461 7277 696e  ystem == "Darwin
-0000fd60: 223a 0d0a 2020 2020 2020 2020 2020 2020  ":..            
-0000fd70: 6672 6f6d 206f 7320 696d 706f 7274 2073  from os import s
-0000fd80: 7973 7465 6d20 6173 206f 7065 6e5f 696e  ystem as open_in
-0000fd90: 5f73 6865 6c6c 0d0a 0d0a 2020 2020 2020  _shell....      
-0000fda0: 2020 2020 2020 6f70 656e 5f69 6e5f 7368        open_in_sh
-0000fdb0: 656c 6c28 6622 6f70 656e 2027 7b6e 6f72  ell(f"open '{nor
-0000fdc0: 6d61 6c69 7a65 647d 2722 290d 0a20 2020  malized}'")..   
-0000fdd0: 2020 2020 2065 6c69 6620 7379 7374 656d       elif system
-0000fde0: 203d 3d20 2257 696e 646f 7773 223a 0d0a   == "Windows":..
-0000fdf0: 2020 2020 2020 2020 2020 2020 6672 6f6d              from
-0000fe00: 206f 7320 696d 706f 7274 2073 7461 7274   os import start
-0000fe10: 6669 6c65 2061 7320 6f70 656e 5f69 6e5f  file as open_in_
-0000fe20: 7368 656c 6c0d 0a0d 0a20 2020 2020 2020  shell....       
-0000fe30: 2020 2020 206f 7065 6e5f 696e 5f73 6865       open_in_she
-0000fe40: 6c6c 2866 2722 7b6e 6f72 6d61 6c69 7a65  ll(f'"{normalize
-0000fe50: 647d 2227 290d 0a20 2020 2020 2020 2065  d}"')..        e
-0000fe60: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-0000fe70: 2020 6672 6f6d 206f 7320 696d 706f 7274    from os import
-0000fe80: 2073 7973 7465 6d20 6173 206f 7065 6e5f   system as open_
-0000fe90: 696e 5f73 6865 6c6c 0d0a 0d0a 2020 2020  in_shell....    
-0000fea0: 2020 2020 2020 2020 6f70 656e 5f69 6e5f          open_in_
-0000feb0: 7368 656c 6c28 6622 7864 672d 6f70 656e  shell(f"xdg-open
-0000fec0: 2027 7b6e 6f72 6d61 6c69 7a65 647d 2722   '{normalized}'"
-0000fed0: 290d 0a0d 0a20 2020 2064 6566 2067 6574  )....    def get
-0000fee0: 5f76 616c 7565 7328 293a 0d0a 2020 2020  _values():..    
-0000fef0: 2020 2020 7265 7475 726e 205b 6f20 666f      return [o fo
-0000ff00: 7220 6f20 696e 2073 656c 662e 6f70 7328  r o in self.ops(
-0000ff10: 2920 6966 206f 2e74 7970 652e 7374 6172  ) if o.type.star
-0000ff20: 7473 7769 7468 2822 6f70 2229 5d0d 0a0d  tswith("op")]...
-0000ff30: 0a20 2020 2040 7472 6565 5f63 6f6e 6469  .    @tree_condi
-0000ff40: 7469 6f6e 616c 286c 616d 6264 6120 6e6f  tional(lambda no
-0000ff50: 6465 3a20 6e6f 7420 6973 5f72 6567 6d61  de: not is_regma
-0000ff60: 726b 286e 6f64 6529 290d 0a20 2020 2040  rk(node))..    @
-0000ff70: 7472 6565 5f73 7562 6d65 6e75 285f 2822  tree_submenu(_("
-0000ff80: 4173 7369 676e 204f 7065 7261 7469 6f6e  Assign Operation
-0000ff90: 2229 290d 0a20 2020 2040 7472 6565 5f76  "))..    @tree_v
-0000ffa0: 616c 7565 7328 226f 705f 6173 7369 676e  alues("op_assign
-0000ffb0: 222c 2076 616c 7565 733d 6765 745f 7661  ", values=get_va
-0000ffc0: 6c75 6573 290d 0a20 2020 2040 7472 6565  lues)..    @tree
-0000ffd0: 5f6f 7065 7261 7469 6f6e 2822 7b6f 705f  _operation("{op_
-0000ffe0: 6173 7369 676e 7d22 2c20 6e6f 6465 5f74  assign}", node_t
-0000fff0: 7970 653d 656c 656d 5f6e 6f64 6573 2c20  ype=elem_nodes, 
-00010000: 6865 6c70 3d22 2229 0d0a 2020 2020 6465  help="")..    de
-00010010: 6620 6d65 6e75 5f61 7373 6967 6e5f 6f70  f menu_assign_op
-00010020: 6572 6174 696f 6e73 286e 6f64 652c 206f  erations(node, o
-00010030: 705f 6173 7369 676e 2c20 2a2a 6b77 6172  p_assign, **kwar
-00010040: 6773 293a 0d0a 2020 2020 2020 2020 6966  gs):..        if
-00010050: 2073 656c 662e 636c 6173 7369 6679 5f69   self.classify_i
-00010060: 6e68 6572 6974 5f73 7472 6f6b 653a 0d0a  nherit_stroke:..
-00010070: 2020 2020 2020 2020 2020 2020 696d 706f              impo
-00010080: 7365 203d 2022 746f 5f6f 7022 0d0a 2020  se = "to_op"..  
-00010090: 2020 2020 2020 2020 2020 6174 7472 6962            attrib
-000100a0: 203d 2022 7374 726f 6b65 220d 0a20 2020   = "stroke"..   
-000100b0: 2020 2020 2020 2020 2073 696d 696c 6172           similar
-000100c0: 203d 2054 7275 650d 0a20 2020 2020 2020   = True..       
-000100d0: 2065 6c69 6620 7365 6c66 2e63 6c61 7373   elif self.class
-000100e0: 6966 795f 696e 6865 7269 745f 6669 6c6c  ify_inherit_fill
-000100f0: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
-00010100: 6d70 6f73 6520 3d20 2274 6f5f 6f70 220d  mpose = "to_op".
-00010110: 0a20 2020 2020 2020 2020 2020 2061 7474  .            att
-00010120: 7269 6220 3d20 2266 696c 6c22 0d0a 2020  rib = "fill"..  
-00010130: 2020 2020 2020 2020 2020 7369 6d69 6c61            simila
-00010140: 7220 3d20 5472 7565 0d0a 2020 2020 2020  r = True..      
-00010150: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-00010160: 2020 2020 2069 6d70 6f73 6520 3d20 4e6f       impose = No
-00010170: 6e65 0d0a 2020 2020 2020 2020 2020 2020  ne..            
-00010180: 6174 7472 6962 203d 204e 6f6e 650d 0a20  attrib = None.. 
-00010190: 2020 2020 2020 2020 2020 2073 696d 696c             simil
-000101a0: 6172 203d 2046 616c 7365 0d0a 2020 2020  ar = False..    
-000101b0: 2020 2020 6578 636c 7573 6976 6520 3d20      exclusive = 
-000101c0: 7365 6c66 2e63 6c61 7373 6966 795f 696e  self.classify_in
-000101d0: 6865 7269 745f 6578 636c 7573 6976 650d  herit_exclusive.
-000101e0: 0a20 2020 2020 2020 2064 6174 6120 3d20  .        data = 
-000101f0: 6c69 7374 2873 656c 662e 656c 656d 7328  list(self.elems(
-00010200: 656d 7068 6173 697a 6564 3d54 7275 6529  emphasized=True)
-00010210: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-00010220: 6173 7369 676e 5f6f 7065 7261 7469 6f6e  assign_operation
-00010230: 280d 0a20 2020 2020 2020 2020 2020 206f  (..            o
-00010240: 705f 6173 7369 676e 3d6f 705f 6173 7369  p_assign=op_assi
-00010250: 676e 2c0d 0a20 2020 2020 2020 2020 2020  gn,..           
-00010260: 2064 6174 613d 6461 7461 2c0d 0a20 2020   data=data,..   
-00010270: 2020 2020 2020 2020 2069 6d70 6f73 653d           impose=
-00010280: 696d 706f 7365 2c0d 0a20 2020 2020 2020  impose,..       
-00010290: 2020 2020 2061 7474 7269 623d 6174 7472       attrib=attr
-000102a0: 6962 2c0d 0a20 2020 2020 2020 2020 2020  ib,..           
-000102b0: 2073 696d 696c 6172 3d73 696d 696c 6172   similar=similar
-000102c0: 2c0d 0a20 2020 2020 2020 2020 2020 2065  ,..            e
-000102d0: 7863 6c75 7369 7665 3d65 7863 6c75 7369  xclusive=exclusi
-000102e0: 7665 2c0d 0a20 2020 2020 2020 2029 0d0a  ve,..        )..
-000102f0: 0d0a 2020 2020 6465 6620 6578 636c 7573  ..    def exclus
-00010300: 6976 655f 6d61 7463 6828 6e6f 6465 2c20  ive_match(node, 
-00010310: 2a2a 6b77 6172 6773 293a 0d0a 2020 2020  **kwargs):..    
-00010320: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-00010330: 636c 6173 7369 6679 5f69 6e68 6572 6974  classify_inherit
-00010340: 5f65 7863 6c75 7369 7665 0d0a 0d0a 2020  _exclusive....  
-00010350: 2020 4074 7265 655f 7365 7061 7261 746f    @tree_separato
-00010360: 725f 6265 666f 7265 2829 0d0a 2020 2020  r_before()..    
-00010370: 4074 7265 655f 7375 626d 656e 7528 5f28  @tree_submenu(_(
-00010380: 2241 7373 6967 6e20 4f70 6572 6174 696f  "Assign Operatio
-00010390: 6e22 2929 0d0a 2020 2020 4074 7265 655f  n"))..    @tree_
-000103a0: 6f70 6572 6174 696f 6e28 0d0a 2020 2020  operation(..    
-000103b0: 2020 2020 5f28 2252 656d 6f76 6520 616c      _("Remove al
-000103c0: 6c20 6173 7369 676e 6d65 6e74 7320 6672  l assignments fr
-000103d0: 6f6d 206f 7065 7261 7469 6f6e 7322 292c  om operations"),
-000103e0: 0d0a 2020 2020 2020 2020 6e6f 6465 5f74  ..        node_t
-000103f0: 7970 653d 656c 656d 5f67 726f 7570 5f6e  ype=elem_group_n
-00010400: 6f64 6573 2c0d 0a20 2020 2020 2020 2068  odes,..        h
-00010410: 656c 703d 5f28 2241 6e79 2065 7869 7374  elp=_("Any exist
-00010420: 696e 6720 6173 7369 676e 6d65 6e74 206f  ing assignment o
-00010430: 6620 7468 6973 2065 6c65 6d65 6e74 2074  f this element t
-00010440: 6f20 6f70 6572 6174 696f 6e73 2077 696c  o operations wil
-00010450: 6c20 6265 2072 656d 6f76 6564 2229 2c0d  l be removed"),.
-00010460: 0a20 2020 2029 0d0a 2020 2020 6465 6620  .    )..    def 
-00010470: 7265 6d6f 7665 5f61 7373 6967 6e6d 656e  remove_assignmen
-00010480: 7473 2873 696e 676c 656e 6f64 652c 202a  ts(singlenode, *
-00010490: 2a6b 7761 7267 7329 3a0d 0a20 2020 2020  *kwargs):..     
-000104a0: 2020 2064 6566 2072 656d 5f6e 6f64 6528     def rem_node(
-000104b0: 726e 6f64 6529 3a0d 0a20 2020 2020 2020  rnode):..       
-000104c0: 2020 2020 2023 2072 6563 7572 7369 7665       # recursive
-000104d0: 6c79 2072 656d 6f76 6520 6173 7369 676e  ly remove assign
-000104e0: 6d65 6e74 732e 2e2e 0d0a 2020 2020 2020  ments.....      
-000104f0: 2020 2020 2020 6966 2072 6e6f 6465 2e74        if rnode.t
-00010500: 7970 6520 696e 2028 2266 696c 6522 2c20  ype in ("file", 
-00010510: 2267 726f 7570 2229 3a0d 0a20 2020 2020  "group"):..     
-00010520: 2020 2020 2020 2020 2020 2066 6f72 2063             for c
-00010530: 6e6f 6465 2069 6e20 6c69 7374 2872 6e6f  node in list(rno
-00010540: 6465 2e5f 6368 696c 6472 656e 293a 0d0a  de._children):..
-00010550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010560: 2020 2020 7265 6d5f 6e6f 6465 2863 6e6f      rem_node(cno
-00010570: 6465 290d 0a20 2020 2020 2020 2020 2020  de)..           
-00010580: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-00010590: 2020 2020 2020 2020 666f 7220 7265 6620          for ref 
-000105a0: 696e 206c 6973 7428 726e 6f64 652e 7265  in list(rnode.re
-000105b0: 6665 7265 6e63 6573 293a 0d0a 2020 2020  ferences):..    
-000105c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000105d0: 7265 662e 7265 6d6f 7665 5f6e 6f64 6528  ref.remove_node(
-000105e0: 290d 0a0d 0a20 2020 2020 2020 2077 6974  )....        wit
-000105f0: 6820 7365 6c66 2e73 7461 7469 6328 2272  h self.static("r
-00010600: 656d 6f76 655f 6173 7369 676e 2229 3a0d  emove_assign"):.
-00010610: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-00010620: 206e 6f64 6520 696e 206c 6973 7428 7365   node in list(se
-00010630: 6c66 2e65 6c65 6d73 2865 6d70 6861 7369  lf.elems(emphasi
-00010640: 7a65 643d 5472 7565 2929 3a0d 0a20 2020  zed=True)):..   
-00010650: 2020 2020 2020 2020 2020 2020 2072 656d               rem
-00010660: 5f6e 6f64 6528 6e6f 6465 290d 0a20 2020  _node(node)..   
-00010670: 2020 2020 2073 656c 662e 7369 676e 616c       self.signal
-00010680: 2822 7265 6672 6573 685f 7472 6565 2229  ("refresh_tree")
-00010690: 0d0a 0d0a 2020 2020 4074 7265 655f 7365  ....    @tree_se
-000106a0: 7061 7261 746f 725f 6265 666f 7265 2829  parator_before()
-000106b0: 0d0a 2020 2020 4074 7265 655f 7375 626d  ..    @tree_subm
-000106c0: 656e 7528 5f28 2241 7373 6967 6e20 4f70  enu(_("Assign Op
-000106d0: 6572 6174 696f 6e22 2929 0d0a 2020 2020  eration"))..    
-000106e0: 4074 7265 655f 6368 6563 6b28 6578 636c  @tree_check(excl
-000106f0: 7573 6976 655f 6d61 7463 6829 0d0a 2020  usive_match)..  
-00010700: 2020 4074 7265 655f 6f70 6572 6174 696f    @tree_operatio
-00010710: 6e28 0d0a 2020 2020 2020 2020 5f28 2245  n(..        _("E
-00010720: 7863 6c75 7369 7665 2061 7373 6967 6e6d  xclusive assignm
-00010730: 656e 7422 292c 0d0a 2020 2020 2020 2020  ent"),..        
-00010740: 6e6f 6465 5f74 7970 653d 656c 656d 5f6e  node_type=elem_n
-00010750: 6f64 6573 2c0d 0a20 2020 2020 2020 2068  odes,..        h
-00010760: 656c 703d 5f28 0d0a 2020 2020 2020 2020  elp=_(..        
-00010770: 2020 2020 2241 6e20 6173 7369 676e 6d65      "An assignme
-00010780: 6e74 2077 696c 6c20 7265 6d6f 7665 2061  nt will remove a
-00010790: 6c6c 206f 7468 6572 2063 6c61 7373 6966  ll other classif
-000107a0: 6963 6174 696f 6e73 206f 6620 7468 6973  ications of this
-000107b0: 2065 6c65 6d65 6e74 2069 6620 6368 6563   element if chec
-000107c0: 6b65 6422 0d0a 2020 2020 2020 2020 292c  ked"..        ),
-000107d0: 0d0a 2020 2020 290d 0a20 2020 2064 6566  ..    )..    def
-000107e0: 2073 6574 5f61 7373 6967 6e5f 6f70 7469   set_assign_opti
-000107f0: 6f6e 5f65 7863 6c75 7369 7665 286e 6f64  on_exclusive(nod
-00010800: 652c 202a 2a6b 7761 7267 7329 3a0d 0a20  e, **kwargs):.. 
-00010810: 2020 2020 2020 2073 656c 662e 636c 6173         self.clas
-00010820: 7369 6679 5f69 6e68 6572 6974 5f65 7863  sify_inherit_exc
-00010830: 6c75 7369 7665 203d 206e 6f74 2073 656c  lusive = not sel
-00010840: 662e 636c 6173 7369 6679 5f69 6e68 6572  f.classify_inher
-00010850: 6974 5f65 7863 6c75 7369 7665 0d0a 0d0a  it_exclusive....
-00010860: 2020 2020 6465 6620 7374 726f 6b65 5f6d      def stroke_m
-00010870: 6174 6368 286e 6f64 652c 202a 2a6b 7761  atch(node, **kwa
-00010880: 7267 7329 3a0d 0a20 2020 2020 2020 2072  rgs):..        r
-00010890: 6574 7572 6e20 7365 6c66 2e63 6c61 7373  eturn self.class
-000108a0: 6966 795f 696e 6865 7269 745f 7374 726f  ify_inherit_stro
-000108b0: 6b65 0d0a 0d0a 2020 2020 4074 7265 655f  ke....    @tree_
-000108c0: 7365 7061 7261 746f 725f 6265 666f 7265  separator_before
-000108d0: 2829 0d0a 2020 2020 4074 7265 655f 7375  ()..    @tree_su
-000108e0: 626d 656e 7528 5f28 2241 7373 6967 6e20  bmenu(_("Assign 
-000108f0: 4f70 6572 6174 696f 6e22 2929 0d0a 2020  Operation"))..  
-00010900: 2020 4074 7265 655f 6368 6563 6b28 7374    @tree_check(st
-00010910: 726f 6b65 5f6d 6174 6368 290d 0a20 2020  roke_match)..   
-00010920: 2040 7472 6565 5f6f 7065 7261 7469 6f6e   @tree_operation
-00010930: 280d 0a20 2020 2020 2020 205f 2822 496e  (..        _("In
-00010940: 6865 7269 7420 7374 726f 6b65 2061 6e64  herit stroke and
-00010950: 2063 6c61 7373 6966 7920 7369 6d69 6c61   classify simila
-00010960: 7222 292c 0d0a 2020 2020 2020 2020 6e6f  r"),..        no
-00010970: 6465 5f74 7970 653d 656c 656d 5f6e 6f64  de_type=elem_nod
-00010980: 6573 2c0d 0a20 2020 2020 2020 2068 656c  es,..        hel
-00010990: 703d 5f28 224f 7065 7261 7469 6f6e 2077  p=_("Operation w
-000109a0: 696c 6c20 696e 6865 7269 7420 656c 656d  ill inherit elem
-000109b0: 656e 7420 7374 726f 6b65 2063 6f6c 6f72  ent stroke color
-000109c0: 2229 2c0d 0a20 2020 2029 0d0a 2020 2020  "),..    )..    
-000109d0: 6465 6620 7365 745f 6173 7369 676e 5f6f  def set_assign_o
-000109e0: 7074 696f 6e5f 7374 726f 6b65 286e 6f64  ption_stroke(nod
-000109f0: 652c 202a 2a6b 7761 7267 7329 3a0d 0a20  e, **kwargs):.. 
-00010a00: 2020 2020 2020 2073 656c 662e 636c 6173         self.clas
-00010a10: 7369 6679 5f69 6e68 6572 6974 5f73 7472  sify_inherit_str
-00010a20: 6f6b 6520 3d20 6e6f 7420 7365 6c66 2e63  oke = not self.c
-00010a30: 6c61 7373 6966 795f 696e 6865 7269 745f  lassify_inherit_
-00010a40: 7374 726f 6b65 0d0a 2020 2020 2020 2020  stroke..        
-00010a50: 2320 506f 6f72 206d 616e 7320 7261 6469  # Poor mans radi
-00010a60: 6f0d 0a20 2020 2020 2020 2069 6620 7365  o..        if se
-00010a70: 6c66 2e63 6c61 7373 6966 795f 696e 6865  lf.classify_inhe
-00010a80: 7269 745f 7374 726f 6b65 3a0d 0a20 2020  rit_stroke:..   
-00010a90: 2020 2020 2020 2020 2073 656c 662e 636c           self.cl
-00010aa0: 6173 7369 6679 5f69 6e68 6572 6974 5f66  assify_inherit_f
-00010ab0: 696c 6c20 3d20 4661 6c73 650d 0a0d 0a20  ill = False.... 
-00010ac0: 2020 2064 6566 2066 696c 6c5f 6d61 7463     def fill_matc
-00010ad0: 6828 6e6f 6465 2c20 2a2a 6b77 6172 6773  h(node, **kwargs
-00010ae0: 293a 0d0a 2020 2020 2020 2020 7265 7475  ):..        retu
-00010af0: 726e 2073 656c 662e 636c 6173 7369 6679  rn self.classify
-00010b00: 5f69 6e68 6572 6974 5f66 696c 6c0d 0a0d  _inherit_fill...
-00010b10: 0a20 2020 2040 7472 6565 5f73 7562 6d65  .    @tree_subme
-00010b20: 6e75 285f 2822 4173 7369 676e 204f 7065  nu(_("Assign Ope
-00010b30: 7261 7469 6f6e 2229 290d 0a20 2020 2040  ration"))..    @
-00010b40: 7472 6565 5f63 6865 636b 2866 696c 6c5f  tree_check(fill_
-00010b50: 6d61 7463 6829 0d0a 2020 2020 4074 7265  match)..    @tre
-00010b60: 655f 6f70 6572 6174 696f 6e28 0d0a 2020  e_operation(..  
-00010b70: 2020 2020 2020 5f28 2249 6e68 6572 6974        _("Inherit
-00010b80: 2066 696c 6c20 616e 6420 636c 6173 7369   fill and classi
-00010b90: 6679 2073 696d 696c 6172 2229 2c0d 0a20  fy similar"),.. 
-00010ba0: 2020 2020 2020 206e 6f64 655f 7479 7065         node_type
-00010bb0: 3d65 6c65 6d5f 6e6f 6465 732c 0d0a 2020  =elem_nodes,..  
-00010bc0: 2020 2020 2020 6865 6c70 3d5f 2822 4f70        help=_("Op
-00010bd0: 6572 6174 696f 6e20 7769 6c6c 2069 6e68  eration will inh
-00010be0: 6572 6974 2065 6c65 6d65 6e74 2066 696c  erit element fil
-00010bf0: 6c20 636f 6c6f 7222 292c 0d0a 2020 2020  l color"),..    
-00010c00: 290d 0a20 2020 2064 6566 2073 6574 5f61  )..    def set_a
-00010c10: 7373 6967 6e5f 6f70 7469 6f6e 5f66 696c  ssign_option_fil
-00010c20: 6c28 6e6f 6465 2c20 2a2a 6b77 6172 6773  l(node, **kwargs
-00010c30: 293a 0d0a 2020 2020 2020 2020 7365 6c66  ):..        self
-00010c40: 2e63 6c61 7373 6966 795f 696e 6865 7269  .classify_inheri
-00010c50: 745f 6669 6c6c 203d 206e 6f74 2073 656c  t_fill = not sel
-00010c60: 662e 636c 6173 7369 6679 5f69 6e68 6572  f.classify_inher
-00010c70: 6974 5f66 696c 6c0d 0a20 2020 2020 2020  it_fill..       
-00010c80: 2023 2050 6f6f 7220 6d61 6e73 2072 6164   # Poor mans rad
-00010c90: 696f 0d0a 2020 2020 2020 2020 6966 2073  io..        if s
-00010ca0: 656c 662e 636c 6173 7369 6679 5f69 6e68  elf.classify_inh
-00010cb0: 6572 6974 5f66 696c 6c3a 0d0a 2020 2020  erit_fill:..    
-00010cc0: 2020 2020 2020 2020 7365 6c66 2e63 6c61          self.cla
-00010cd0: 7373 6966 795f 696e 6865 7269 745f 7374  ssify_inherit_st
-00010ce0: 726f 6b65 203d 2046 616c 7365 0d0a 0d0a  roke = False....
-00010cf0: 2020 2020 4074 7265 655f 636f 6e64 6974      @tree_condit
-00010d00: 696f 6e61 6c28 6c61 6d62 6461 206e 6f64  ional(lambda nod
-00010d10: 653a 206e 6f74 2069 735f 7265 676d 6172  e: not is_regmar
-00010d20: 6b28 6e6f 6465 2929 0d0a 2020 2020 4074  k(node))..    @t
-00010d30: 7265 655f 7375 626d 656e 7528 5f28 2244  ree_submenu(_("D
-00010d40: 7570 6c69 6361 7465 2065 6c65 6d65 6e74  uplicate element
-00010d50: 2873 2922 2929 0d0a 2020 2020 4074 7265  (s)"))..    @tre
-00010d60: 655f 6f70 6572 6174 696f 6e28 5f28 224d  e_operation(_("M
-00010d70: 616b 6520 3120 636f 7079 2229 2c20 6e6f  ake 1 copy"), no
-00010d80: 6465 5f74 7970 653d 656c 656d 5f67 726f  de_type=elem_gro
-00010d90: 7570 5f6e 6f64 6573 2c20 6865 6c70 3d22  up_nodes, help="
-00010da0: 2229 0d0a 2020 2020 6465 6620 6475 706c  ")..    def dupl
-00010db0: 6963 6174 655f 656c 656d 656e 745f 3128  icate_element_1(
-00010dc0: 6e6f 6465 2c20 2a2a 6b77 6172 6773 293a  node, **kwargs):
-00010dd0: 0d0a 2020 2020 2020 2020 6475 706c 6963  ..        duplic
-00010de0: 6174 655f 656c 656d 656e 745f 6e28 6e6f  ate_element_n(no
-00010df0: 6465 2c20 636f 7069 6573 3d31 2c20 2a2a  de, copies=1, **
-00010e00: 6b77 6172 6773 290d 0a0d 0a20 2020 2040  kwargs)....    @
-00010e10: 7472 6565 5f63 6f6e 6469 7469 6f6e 616c  tree_conditional
-00010e20: 286c 616d 6264 6120 6e6f 6465 3a20 6e6f  (lambda node: no
-00010e30: 7420 6973 5f72 6567 6d61 726b 286e 6f64  t is_regmark(nod
-00010e40: 6529 290d 0a20 2020 2040 7472 6565 5f73  e))..    @tree_s
-00010e50: 7562 6d65 6e75 285f 2822 4475 706c 6963  ubmenu(_("Duplic
-00010e60: 6174 6520 656c 656d 656e 7428 7329 2229  ate element(s)")
-00010e70: 290d 0a20 2020 2040 7472 6565 5f69 7465  )..    @tree_ite
-00010e80: 7261 7465 2822 636f 7069 6573 222c 2032  rate("copies", 2
-00010e90: 2c20 3130 290d 0a20 2020 2040 7472 6565  , 10)..    @tree
-00010ea0: 5f6f 7065 7261 7469 6f6e 285f 2822 4d61  _operation(_("Ma
-00010eb0: 6b65 207b 636f 7069 6573 7d20 636f 7069  ke {copies} copi
-00010ec0: 6573 2229 2c20 6e6f 6465 5f74 7970 653d  es"), node_type=
-00010ed0: 656c 656d 5f67 726f 7570 5f6e 6f64 6573  elem_group_nodes
-00010ee0: 2c20 6865 6c70 3d22 2229 0d0a 2020 2020  , help="")..    
-00010ef0: 6465 6620 6475 706c 6963 6174 655f 656c  def duplicate_el
-00010f00: 656d 656e 745f 6e28 6e6f 6465 2c20 636f  ement_n(node, co
-00010f10: 7069 6573 2c20 2a2a 6b77 6172 6773 293a  pies, **kwargs):
-00010f20: 0d0a 2020 2020 2020 2020 6465 6620 636f  ..        def co
-00010f30: 7079 5f73 696e 676c 655f 6e6f 6465 286f  py_single_node(o
-00010f40: 7267 6e6f 6465 2c20 6f72 6770 6172 656e  rgnode, orgparen
-00010f50: 742c 2074 696d 6573 2c20 6478 2c20 6479  t, times, dx, dy
-00010f60: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00010f70: 6465 6c74 615f 776f 7264 6c69 7374 203d  delta_wordlist =
-00010f80: 2030 0d0a 2020 2020 2020 2020 2020 2020   0..            
-00010f90: 666f 7220 6e20 696e 2072 616e 6765 2874  for n in range(t
-00010fa0: 696d 6573 293a 0d0a 2020 2020 2020 2020  imes):..        
-00010fb0: 2020 2020 2020 2020 6465 6c74 615f 776f          delta_wo
-00010fc0: 7264 6c69 7374 202b 3d20 310d 0a0d 0a20  rdlist += 1.... 
-00010fd0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00010fe0: 6f70 795f 6e6f 6465 203d 2063 6f70 7928  opy_node = copy(
-00010ff0: 6f72 676e 6f64 6529 0d0a 2020 2020 2020  orgnode)..      
-00011000: 2020 2020 2020 2020 2020 6966 2068 6173            if has
-00011010: 6174 7472 2863 6f70 795f 6e6f 6465 2c20  attr(copy_node, 
-00011020: 226d 6174 7269 7822 293a 0d0a 2020 2020  "matrix"):..    
-00011030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011040: 636f 7079 5f6e 6f64 652e 6d61 7472 6978  copy_node.matrix
-00011050: 202a 3d20 4d61 7472 6978 2e74 7261 6e73   *= Matrix.trans
-00011060: 6c61 7465 2828 6e20 2b20 3129 202a 2064  late((n + 1) * d
-00011070: 782c 2028 6e20 2b20 3129 202a 2064 7929  x, (n + 1) * dy)
-00011080: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00011090: 2020 6861 645f 6f70 7469 6f6e 616c 203d    had_optional =
-000110a0: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
-000110b0: 2020 2020 2020 2020 2320 4e65 6564 2074          # Need t
-000110c0: 6f20 6164 6420 7374 726f 6b65 2061 6e64  o add stroke and
-000110d0: 2066 696c 6c2c 2061 7320 636f 7079 2077   fill, as copy w
-000110e0: 696c 6c20 7461 6b65 2074 6865 0d0a 2020  ill take the..  
-000110f0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00011100: 6465 6661 756c 7420 7661 6c75 6573 2066  default values f
-00011110: 6f72 2074 6865 7365 2061 7474 7269 6275  or these attribu
-00011120: 7465 730d 0a20 2020 2020 2020 2020 2020  tes..           
-00011130: 2020 2020 2066 6f72 206f 7074 696f 6e61       for optiona
-00011140: 6c20 696e 2028 2266 696c 6c22 2c20 2273  l in ("fill", "s
-00011150: 7472 6f6b 6522 293a 0d0a 2020 2020 2020  troke"):..      
-00011160: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00011170: 2068 6173 6174 7472 286f 7267 6e6f 6465   hasattr(orgnode
-00011180: 2c20 6f70 7469 6f6e 616c 293a 0d0a 2020  , optional):..  
-00011190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000111a0: 2020 2020 2020 7365 7461 7474 7228 636f        setattr(co
-000111b0: 7079 5f6e 6f64 652c 206f 7074 696f 6e61  py_node, optiona
-000111c0: 6c2c 2067 6574 6174 7472 286f 7267 6e6f  l, getattr(orgno
-000111d0: 6465 2c20 6f70 7469 6f6e 616c 2929 0d0a  de, optional))..
-000111e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000111f0: 666f 7220 6f70 7469 6f6e 616c 2069 6e20  for optional in 
-00011200: 2822 7778 666f 6e74 222c 2022 6d6b 7465  ("wxfont", "mkte
-00011210: 7874 222c 2022 6d6b 666f 6e74 222c 2022  xt", "mkfont", "
-00011220: 6d6b 666f 6e74 7369 7a65 2229 3a0d 0a20  mkfontsize"):.. 
-00011230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011240: 2020 2069 6620 6861 7361 7474 7228 6f72     if hasattr(or
-00011250: 676e 6f64 652c 206f 7074 696f 6e61 6c29  gnode, optional)
-00011260: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00011270: 2020 2020 2020 2020 2020 2068 6164 5f6f             had_o
-00011280: 7074 696f 6e61 6c20 3d20 5472 7565 0d0a  ptional = True..
-00011290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000112a0: 2020 2020 2020 2020 7365 7461 7474 7228          setattr(
-000112b0: 636f 7079 5f6e 6f64 652c 206f 7074 696f  copy_node, optio
-000112c0: 6e61 6c2c 2067 6574 6174 7472 286f 7267  nal, getattr(org
-000112d0: 6e6f 6465 2c20 6f70 7469 6f6e 616c 2929  node, optional))
-000112e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000112f0: 2020 6966 2073 656c 662e 636f 7079 5f69    if self.copy_i
-00011300: 6e63 7265 6173 6573 5f77 6f72 646c 6973  ncreases_wordlis
-00011310: 745f 7265 6665 7265 6e63 6573 2061 6e64  t_references and
-00011320: 2068 6173 6174 7472 286f 7267 6e6f 6465   hasattr(orgnode
-00011330: 2c20 2274 6578 7422 293a 0d0a 2020 2020  , "text"):..    
-00011340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011350: 636f 7079 5f6e 6f64 652e 7465 7874 203d  copy_node.text =
-00011360: 2073 656c 662e 776f 7264 6c69 7374 5f64   self.wordlist_d
-00011370: 656c 7461 286f 7267 6e6f 6465 2e74 6578  elta(orgnode.tex
-00011380: 742c 2064 656c 7461 5f77 6f72 646c 6973  t, delta_wordlis
-00011390: 7429 0d0a 2020 2020 2020 2020 2020 2020  t)..            
-000113a0: 2020 2020 656c 6966 2073 656c 662e 636f      elif self.co
-000113b0: 7079 5f69 6e63 7265 6173 6573 5f77 6f72  py_increases_wor
-000113c0: 646c 6973 745f 7265 6665 7265 6e63 6573  dlist_references
-000113d0: 2061 6e64 2068 6173 6174 7472 2865 2c20   and hasattr(e, 
-000113e0: 226d 6b74 6578 7422 293a 0d0a 2020 2020  "mktext"):..    
-000113f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011400: 636f 7079 5f6e 6f64 652e 6d6b 7465 7874  copy_node.mktext
-00011410: 203d 2073 656c 662e 776f 7264 6c69 7374   = self.wordlist
-00011420: 5f64 656c 7461 2865 2e6d 6b74 6578 742c  _delta(e.mktext,
-00011430: 2064 656c 7461 5f77 6f72 646c 6973 7429   delta_wordlist)
-00011440: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00011450: 2020 6f72 6770 6172 656e 742e 6164 645f    orgparent.add_
-00011460: 6e6f 6465 2863 6f70 795f 6e6f 6465 290d  node(copy_node).
-00011470: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011480: 2069 6620 6861 645f 6f70 7469 6f6e 616c   if had_optional
-00011490: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-000114a0: 2020 2020 2020 2066 6f72 2070 726f 7065         for prope
-000114b0: 7274 795f 6f70 2069 6e20 7365 6c66 2e6b  rty_op in self.k
-000114c0: 6572 6e65 6c2e 6c6f 6f6b 7570 5f61 6c6c  ernel.lookup_all
-000114d0: 2822 7061 7468 5f75 7064 6174 6572 2f2e  ("path_updater/.
-000114e0: 2a22 293a 0d0a 2020 2020 2020 2020 2020  *"):..          
-000114f0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-00011500: 6f70 6572 7479 5f6f 7028 7365 6c66 2e6b  operty_op(self.k
-00011510: 6572 6e65 6c2e 726f 6f74 2c20 636f 7079  ernel.root, copy
-00011520: 5f6e 6f64 6529 0d0a 0d0a 2020 2020 2020  _node)....      
-00011530: 2020 2020 2020 2020 2020 636f 7079 5f6e            copy_n
-00011540: 6f64 6573 2e61 7070 656e 6428 636f 7079  odes.append(copy
-00011550: 5f6e 6f64 6529 0d0a 0d0a 2020 2020 2020  _node)....      
-00011560: 2020 2020 2020 2020 2020 6966 206f 7267            if org
-00011570: 6e6f 6465 2e74 7970 6520 696e 2028 2266  node.type in ("f
-00011580: 696c 6522 2c20 2267 726f 7570 2229 3a0d  ile", "group"):.
-00011590: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000115a0: 2020 2020 206e 6577 7061 7265 6e74 203d       newparent =
-000115b0: 2063 6f70 795f 6e6f 6465 0d0a 2020 2020   copy_node..    
-000115c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000115d0: 666f 7220 636e 6f64 6520 696e 206f 7267  for cnode in org
-000115e0: 6e6f 6465 2e63 6869 6c64 7265 6e3a 0d0a  node.children:..
-000115f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011600: 2020 2020 2020 2020 636f 7079 5f73 696e          copy_sin
-00011610: 676c 655f 6e6f 6465 280d 0a20 2020 2020  gle_node(..     
-00011620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011630: 2020 2020 2020 2063 6e6f 6465 2c20 6e65         cnode, ne
-00011640: 7770 6172 656e 742c 2031 2c20 286e 202b  wparent, 1, (n +
-00011650: 2031 2920 2a20 6478 2c20 286e 202b 2031   1) * dx, (n + 1
-00011660: 2920 2a20 6479 0d0a 2020 2020 2020 2020  ) * dy..        
-00011670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011680: 290d 0a0d 0a20 2020 2020 2020 2063 6f70  )....        cop
-00011690: 795f 6e6f 6465 7320 3d20 6c69 7374 2829  y_nodes = list()
-000116a0: 0d0a 2020 2020 2020 2020 6478 203d 2073  ..        dx = s
-000116b0: 656c 662e 6c65 6e67 7468 5f78 2822 336d  elf.length_x("3m
-000116c0: 6d22 290d 0a20 2020 2020 2020 2064 7920  m")..        dy 
-000116d0: 3d20 7365 6c66 2e6c 656e 6774 685f 7928  = self.length_y(
-000116e0: 2233 6d6d 2229 0d0a 2020 2020 2020 2020  "3mm")..        
-000116f0: 616c 6c64 6174 6120 3d20 6c69 7374 2873  alldata = list(s
-00011700: 656c 662e 656c 656d 7328 656d 7068 6173  elf.elems(emphas
-00011710: 697a 6564 3d54 7275 6529 290d 0a20 2020  ized=True))..   
-00011720: 2020 2020 206d 696e 696d 616c 6461 7461       minimaldata
-00011730: 203d 2073 656c 662e 636f 6e64 656e 7365   = self.condense
-00011740: 5f65 6c65 6d65 6e74 7328 616c 6c64 6174  _elements(alldat
-00011750: 612c 2065 7870 616e 645f 6174 5f65 6e64  a, expand_at_end
-00011760: 3d46 616c 7365 290d 0a20 2020 2020 2020  =False)..       
-00011770: 2066 6f72 2065 2069 6e20 6d69 6e69 6d61   for e in minima
-00011780: 6c64 6174 613a 0d0a 2020 2020 2020 2020  ldata:..        
-00011790: 2020 2020 7061 7265 6e74 203d 2065 2e70      parent = e.p
-000117a0: 6172 656e 740d 0a20 2020 2020 2020 2020  arent..         
-000117b0: 2020 2063 6f70 795f 7369 6e67 6c65 5f6e     copy_single_n
-000117c0: 6f64 6528 652c 2070 6172 656e 742c 2063  ode(e, parent, c
-000117d0: 6f70 6965 732c 2064 782c 2064 7929 0d0a  opies, dx, dy)..
-000117e0: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
-000117f0: 662e 636c 6173 7369 6679 5f6e 6577 3a0d  f.classify_new:.
-00011800: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00011810: 662e 636c 6173 7369 6679 2863 6f70 795f  f.classify(copy_
-00011820: 6e6f 6465 7329 0d0a 0d0a 2020 2020 2020  nodes)....      
-00011830: 2020 7365 6c66 2e73 6574 5f65 6d70 6861    self.set_empha
-00011840: 7369 7328 4e6f 6e65 290d 0a0d 0a20 2020  sis(None)....   
-00011850: 2064 6566 2068 6173 5f77 6f72 646c 6973   def has_wordlis
-00011860: 7428 6e6f 6465 293a 0d0a 2020 2020 2020  t(node):..      
-00011870: 2020 7265 7375 6c74 203d 2046 616c 7365    result = False
-00011880: 0d0a 2020 2020 2020 2020 7478 7420 3d20  ..        txt = 
-00011890: 2222 0d0a 2020 2020 2020 2020 6966 2068  ""..        if h
-000118a0: 6173 6174 7472 286e 6f64 652c 2022 7465  asattr(node, "te
-000118b0: 7874 2229 2061 6e64 206e 6f64 652e 7465  xt") and node.te
-000118c0: 7874 2069 7320 6e6f 7420 4e6f 6e65 3a0d  xt is not None:.
-000118d0: 0a20 2020 2020 2020 2020 2020 2074 7874  .            txt
-000118e0: 203d 2073 7472 286e 6f64 652e 7465 7874   = str(node.text
-000118f0: 290d 0a20 2020 2020 2020 2069 6620 6861  )..        if ha
-00011900: 7361 7474 7228 6e6f 6465 2c20 226d 6b74  sattr(node, "mkt
-00011910: 6578 7422 2920 616e 6420 6e6f 6465 2e6d  ext") and node.m
-00011920: 6b74 6578 7420 6973 206e 6f74 204e 6f6e  ktext is not Non
-00011930: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00011940: 7478 7420 3d20 7374 7228 6e6f 6465 2e6d  txt = str(node.m
-00011950: 6b74 6578 7429 0d0a 2020 2020 2020 2020  ktext)..        
-00011960: 2320 5665 7279 2073 7475 7069 642c 2062  # Very stupid, b
-00011970: 7574 2067 6f6f 6420 656e 6f75 6768 0d0a  ut good enough..
-00011980: 2020 2020 2020 2020 6966 2022 7b22 2069          if "{" i
-00011990: 6e20 7478 7420 616e 6420 227d 2220 696e  n txt and "}" in
-000119a0: 2074 7874 3a0d 0a20 2020 2020 2020 2020   txt:..         
-000119b0: 2020 2072 6573 756c 7420 3d20 5472 7565     result = True
-000119c0: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-000119d0: 2072 6573 756c 740d 0a0d 0a20 2020 2040   result....    @
-000119e0: 7472 6565 5f63 6f6e 6469 7469 6f6e 616c  tree_conditional
-000119f0: 286c 616d 6264 6120 6e6f 6465 3a20 6861  (lambda node: ha
-00011a00: 735f 776f 7264 6c69 7374 286e 6f64 6529  s_wordlist(node)
-00011a10: 290d 0a20 2020 2040 7472 6565 5f6f 7065  )..    @tree_ope
-00011a20: 7261 7469 6f6e 280d 0a20 2020 2020 2020  ration(..       
-00011a30: 205f 2822 496e 6372 6561 7365 2057 6f72   _("Increase Wor
-00011a40: 646c 6973 742d 5265 6665 7265 6e63 6522  dlist-Reference"
-00011a50: 292c 0d0a 2020 2020 2020 2020 6e6f 6465  ),..        node
-00011a60: 5f74 7970 653d 280d 0a20 2020 2020 2020  _type=(..       
-00011a70: 2020 2020 2022 656c 656d 2074 6578 7422       "elem text"
-00011a80: 2c0d 0a20 2020 2020 2020 2020 2020 2022  ,..            "
-00011a90: 656c 656d 2070 6174 6822 2c0d 0a20 2020  elem path",..   
-00011aa0: 2020 2020 2029 2c0d 0a20 2020 2020 2020       ),..       
-00011ab0: 2068 656c 703d 5f28 2241 646a 7573 7473   help=_("Adjusts
-00011ac0: 2074 6865 2072 6566 6572 656e 6365 2076   the reference v
-00011ad0: 616c 7565 2066 6f72 2061 2077 6f72 646c  alue for a wordl
-00011ae0: 6973 742c 2069 6520 7b6e 616d 657d 2074  ist, ie {name} t
-00011af0: 6f20 7b6e 616d 6523 2b31 7d22 292c 0d0a  o {name#+1}"),..
-00011b00: 2020 2020 290d 0a20 2020 2064 6566 2077      )..    def w
-00011b10: 6c69 7374 5f70 6c75 7328 7369 6e67 6c65  list_plus(single
-00011b20: 6e6f 6465 2c20 2a2a 6b77 6172 6773 293a  node, **kwargs):
-00011b30: 0d0a 2020 2020 2020 2020 6461 7461 203d  ..        data =
-00011b40: 206c 6973 7428 290d 0a20 2020 2020 2020   list()..       
-00011b50: 2066 6f72 206e 6f64 6520 696e 206c 6973   for node in lis
-00011b60: 7428 7365 6c66 2e65 6c65 6d73 2865 6d70  t(self.elems(emp
-00011b70: 6861 7369 7a65 643d 5472 7565 2929 3a0d  hasized=True)):.
-00011b80: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00011b90: 6e6f 7420 6861 735f 776f 7264 6c69 7374  not has_wordlist
-00011ba0: 286e 6f64 6529 3a0d 0a20 2020 2020 2020  (node):..       
-00011bb0: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
-00011bc0: 650d 0a20 2020 2020 2020 2020 2020 2064  e..            d
-00011bd0: 656c 7461 5f77 6f72 646c 6973 7420 3d20  elta_wordlist = 
-00011be0: 310d 0a20 2020 2020 2020 2020 2020 2069  1..            i
-00011bf0: 6620 6861 7361 7474 7228 6e6f 6465 2c20  f hasattr(node, 
-00011c00: 2274 6578 7422 293a 0d0a 2020 2020 2020  "text"):..      
-00011c10: 2020 2020 2020 2020 2020 6e6f 6465 2e74            node.t
-00011c20: 6578 7420 3d20 7365 6c66 2e77 6f72 646c  ext = self.wordl
-00011c30: 6973 745f 6465 6c74 6128 6e6f 6465 2e74  ist_delta(node.t
-00011c40: 6578 742c 2064 656c 7461 5f77 6f72 646c  ext, delta_wordl
-00011c50: 6973 7429 0d0a 2020 2020 2020 2020 2020  ist)..          
-00011c60: 2020 2020 2020 6e6f 6465 2e61 6c74 6572        node.alter
-00011c70: 6564 2829 0d0a 2020 2020 2020 2020 2020  ed()..          
-00011c80: 2020 2020 2020 6461 7461 2e61 7070 656e        data.appen
-00011c90: 6428 6e6f 6465 290d 0a20 2020 2020 2020  d(node)..       
-00011ca0: 2020 2020 2065 6c69 6620 6861 7361 7474       elif hasatt
-00011cb0: 7228 6e6f 6465 2c20 226d 6b74 6578 7422  r(node, "mktext"
-00011cc0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00011cd0: 2020 2020 6e6f 6465 2e6d 6b74 6578 7420      node.mktext 
-00011ce0: 3d20 7365 6c66 2e77 6f72 646c 6973 745f  = self.wordlist_
-00011cf0: 6465 6c74 6128 6e6f 6465 2e6d 6b74 6578  delta(node.mktex
-00011d00: 742c 2064 656c 7461 5f77 6f72 646c 6973  t, delta_wordlis
-00011d10: 7429 0d0a 2020 2020 2020 2020 2020 2020  t)..            
-00011d20: 2020 2020 666f 7220 7072 6f70 6572 7479      for property
-00011d30: 5f6f 7020 696e 2073 656c 662e 6b65 726e  _op in self.kern
-00011d40: 656c 2e6c 6f6f 6b75 705f 616c 6c28 2270  el.lookup_all("p
-00011d50: 6174 685f 7570 6461 7465 722f 2e2a 2229  ath_updater/.*")
-00011d60: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00011d70: 2020 2020 2020 2070 726f 7065 7274 795f         property_
-00011d80: 6f70 2873 656c 662e 6b65 726e 656c 2e72  op(self.kernel.r
-00011d90: 6f6f 742c 206e 6f64 6529 0d0a 2020 2020  oot, node)..    
-00011da0: 2020 2020 2020 2020 2020 2020 6461 7461              data
-00011db0: 2e61 7070 656e 6428 6e6f 6465 290d 0a20  .append(node).. 
-00011dc0: 2020 2020 2020 2073 656c 662e 7369 676e         self.sign
-00011dd0: 616c 2822 656c 656d 656e 745f 7072 6f70  al("element_prop
-00011de0: 6572 7479 5f75 7064 6174 6522 2c20 6461  erty_update", da
-00011df0: 7461 290d 0a0d 0a20 2020 2040 7472 6565  ta)....    @tree
-00011e00: 5f63 6f6e 6469 7469 6f6e 616c 286c 616d  _conditional(lam
-00011e10: 6264 6120 6e6f 6465 3a20 6861 735f 776f  bda node: has_wo
-00011e20: 7264 6c69 7374 286e 6f64 6529 290d 0a20  rdlist(node)).. 
-00011e30: 2020 2040 7472 6565 5f6f 7065 7261 7469     @tree_operati
-00011e40: 6f6e 280d 0a20 2020 2020 2020 205f 2822  on(..        _("
-00011e50: 4465 6372 6561 7365 2057 6f72 646c 6973  Decrease Wordlis
-00011e60: 742d 5265 6665 7265 6e63 6522 292c 0d0a  t-Reference"),..
-00011e70: 2020 2020 2020 2020 6e6f 6465 5f74 7970          node_typ
-00011e80: 653d 280d 0a20 2020 2020 2020 2020 2020  e=(..           
-00011e90: 2022 656c 656d 2074 6578 7422 2c0d 0a20   "elem text",.. 
-00011ea0: 2020 2020 2020 2020 2020 2022 656c 656d             "elem
-00011eb0: 2070 6174 6822 2c0d 0a20 2020 2020 2020   path",..       
-00011ec0: 2029 2c0d 0a20 2020 2020 2020 2068 656c   ),..        hel
-00011ed0: 703d 5f28 2241 646a 7573 7473 2074 6865  p=_("Adjusts the
-00011ee0: 2072 6566 6572 656e 6365 2076 616c 7565   reference value
-00011ef0: 2066 6f72 2061 2077 6f72 646c 6973 742c   for a wordlist,
-00011f00: 2069 6520 7b6e 616d 6523 2b33 7d20 746f   ie {name#+3} to
-00011f10: 207b 6e61 6d65 232b 327d 2229 2c0d 0a20   {name#+2}"),.. 
-00011f20: 2020 2029 0d0a 2020 2020 6465 6620 776c     )..    def wl
-00011f30: 6973 745f 6d69 6e75 7328 7369 6e67 6c65  ist_minus(single
-00011f40: 6e6f 6465 2c20 2a2a 6b77 6172 6773 293a  node, **kwargs):
-00011f50: 0d0a 2020 2020 2020 2020 6461 7461 203d  ..        data =
-00011f60: 206c 6973 7428 290d 0a20 2020 2020 2020   list()..       
-00011f70: 2066 6f72 206e 6f64 6520 696e 206c 6973   for node in lis
-00011f80: 7428 7365 6c66 2e65 6c65 6d73 2865 6d70  t(self.elems(emp
-00011f90: 6861 7369 7a65 643d 5472 7565 2929 3a0d  hasized=True)):.
-00011fa0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00011fb0: 6e6f 7420 6861 735f 776f 7264 6c69 7374  not has_wordlist
-00011fc0: 286e 6f64 6529 3a0d 0a20 2020 2020 2020  (node):..       
-00011fd0: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
-00011fe0: 650d 0a20 2020 2020 2020 2020 2020 2064  e..            d
-00011ff0: 656c 7461 5f77 6f72 646c 6973 7420 3d20  elta_wordlist = 
-00012000: 2d31 0d0a 2020 2020 2020 2020 2020 2020  -1..            
-00012010: 6966 2068 6173 6174 7472 286e 6f64 652c  if hasattr(node,
-00012020: 2022 7465 7874 2229 3a0d 0a20 2020 2020   "text"):..     
-00012030: 2020 2020 2020 2020 2020 206e 6f64 652e             node.
-00012040: 7465 7874 203d 2073 656c 662e 776f 7264  text = self.word
-00012050: 6c69 7374 5f64 656c 7461 286e 6f64 652e  list_delta(node.
-00012060: 7465 7874 2c20 6465 6c74 615f 776f 7264  text, delta_word
-00012070: 6c69 7374 290d 0a20 2020 2020 2020 2020  list)..         
-00012080: 2020 2020 2020 206e 6f64 652e 616c 7465         node.alte
-00012090: 7265 6428 290d 0a20 2020 2020 2020 2020  red()..         
-000120a0: 2020 2020 2020 2064 6174 612e 6170 7065         data.appe
-000120b0: 6e64 286e 6f64 6529 0d0a 2020 2020 2020  nd(node)..      
-000120c0: 2020 2020 2020 656c 6966 2068 6173 6174        elif hasat
-000120d0: 7472 286e 6f64 652c 2022 6d6b 7465 7874  tr(node, "mktext
-000120e0: 2229 3a0d 0a20 2020 2020 2020 2020 2020  "):..           
-000120f0: 2020 2020 206e 6f64 652e 6d6b 7465 7874       node.mktext
-00012100: 203d 2073 656c 662e 776f 7264 6c69 7374   = self.wordlist
-00012110: 5f64 656c 7461 286e 6f64 652e 6d6b 7465  _delta(node.mkte
-00012120: 7874 2c20 6465 6c74 615f 776f 7264 6c69  xt, delta_wordli
-00012130: 7374 290d 0a20 2020 2020 2020 2020 2020  st)..           
-00012140: 2020 2020 2066 6f72 2070 726f 7065 7274       for propert
-00012150: 795f 6f70 2069 6e20 7365 6c66 2e6b 6572  y_op in self.ker
-00012160: 6e65 6c2e 6c6f 6f6b 7570 5f61 6c6c 2822  nel.lookup_all("
-00012170: 7061 7468 5f75 7064 6174 6572 2f2e 2a22  path_updater/.*"
-00012180: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00012190: 2020 2020 2020 2020 7072 6f70 6572 7479          property
-000121a0: 5f6f 7028 7365 6c66 2e6b 6572 6e65 6c2e  _op(self.kernel.
-000121b0: 726f 6f74 2c20 6e6f 6465 290d 0a20 2020  root, node)..   
-000121c0: 2020 2020 2020 2020 2020 2020 2064 6174               dat
-000121d0: 612e 6170 7065 6e64 286e 6f64 6529 0d0a  a.append(node)..
-000121e0: 2020 2020 2020 2020 7365 6c66 2e73 6967          self.sig
-000121f0: 6e61 6c28 2265 6c65 6d65 6e74 5f70 726f  nal("element_pro
-00012200: 7065 7274 795f 7570 6461 7465 222c 2064  perty_update", d
-00012210: 6174 6129 0d0a 0d0a 2020 2020 4074 7265  ata)....    @tre
-00012220: 655f 636f 6e64 6974 696f 6e61 6c28 6c61  e_conditional(la
-00012230: 6d62 6461 206e 6f64 653a 2068 6173 5f76  mbda node: has_v
-00012240: 6563 746f 7269 7a65 286e 6f64 6529 290d  ectorize(node)).
-00012250: 0a20 2020 2040 7472 6565 5f73 7562 6d65  .    @tree_subme
-00012260: 6e75 285f 2822 4f75 746c 696e 6520 656c  nu(_("Outline el
-00012270: 656d 656e 7428 7329 2e2e 2e22 2929 0d0a  ement(s)..."))..
-00012280: 2020 2020 4074 7265 655f 6974 6572 6174      @tree_iterat
-00012290: 6528 226f 6666 7365 7422 2c20 312c 2031  e("offset", 1, 1
-000122a0: 3029 0d0a 2020 2020 4074 7265 655f 6f70  0)..    @tree_op
-000122b0: 6572 6174 696f 6e28 0d0a 2020 2020 2020  eration(..      
-000122c0: 2020 5f28 222e 2e2e 7769 7468 207b 6f66    _("...with {of
-000122d0: 6673 6574 7d6d 6d20 6469 7374 616e 6365  fset}mm distance
-000122e0: 2229 2c0d 0a20 2020 2020 2020 206e 6f64  "),..        nod
-000122f0: 655f 7479 7065 3d65 6c65 6d5f 6e6f 6465  e_type=elem_node
-00012300: 732c 0d0a 2020 2020 2020 2020 6865 6c70  s,..        help
-00012310: 3d22 222c 0d0a 2020 2020 290d 0a20 2020  ="",..    )..   
-00012320: 2064 6566 206d 616b 655f 6f75 746c 696e   def make_outlin
-00012330: 6573 286e 6f64 652c 206f 6666 7365 743d  es(node, offset=
-00012340: 312c 202a 2a6b 7761 7267 7329 3a0d 0a20  1, **kwargs):.. 
-00012350: 2020 2020 2020 2073 656c 6628 6622 6f75         self(f"ou
-00012360: 746c 696e 6520 7b6f 6666 7365 747d 6d6d  tline {offset}mm
-00012370: 5c6e 2229 0d0a 2020 2020 2020 2020 7365  \n")..        se
-00012380: 6c66 2e73 6967 6e61 6c28 2272 6566 7265  lf.signal("refre
-00012390: 7368 5f74 7265 6522 290d 0a0d 0a20 2020  sh_tree")....   
-000123a0: 2064 6566 2068 6173 5f76 6563 746f 7269   def has_vectori
-000123b0: 7a65 286e 6f64 6529 3a0d 0a20 2020 2020  ze(node):..     
-000123c0: 2020 2072 6573 756c 7420 3d20 4661 6c73     result = Fals
-000123d0: 650d 0a20 2020 2020 2020 206d 616b 655f  e..        make_
-000123e0: 7665 6374 6f72 203d 2073 656c 662e 6c6f  vector = self.lo
-000123f0: 6f6b 7570 2822 7265 6e64 6572 2d6f 702f  okup("render-op/
-00012400: 6d61 6b65 5f76 6563 746f 7222 290d 0a20  make_vector").. 
-00012410: 2020 2020 2020 2069 6620 6d61 6b65 5f76         if make_v
-00012420: 6563 746f 723a 0d0a 2020 2020 2020 2020  ector:..        
-00012430: 2020 2020 7265 7375 6c74 203d 2054 7275      result = Tru
-00012440: 650d 0a20 2020 2020 2020 2072 6574 7572  e..        retur
-00012450: 6e20 7265 7375 6c74 0d0a 0d0a 2020 2020  n result....    
-00012460: 4074 7265 655f 636f 6e64 6974 696f 6e61  @tree_conditiona
-00012470: 6c28 6c61 6d62 6461 206e 6f64 653a 2068  l(lambda node: h
-00012480: 6173 5f76 6563 746f 7269 7a65 286e 6f64  as_vectorize(nod
-00012490: 6529 290d 0a20 2020 2040 7472 6565 5f6f  e))..    @tree_o
-000124a0: 7065 7261 7469 6f6e 280d 0a20 2020 2020  peration(..     
-000124b0: 2020 205f 2822 5472 6163 6520 6269 746d     _("Trace bitm
-000124c0: 6170 2229 2c0d 0a20 2020 2020 2020 206e  ap"),..        n
-000124d0: 6f64 655f 7479 7065 3d28 0d0a 2020 2020  ode_type=(..    
-000124e0: 2020 2020 2020 2020 2265 6c65 6d20 7465          "elem te
-000124f0: 7874 222c 0d0a 2020 2020 2020 2020 2020  xt",..          
-00012500: 2020 2265 6c65 6d20 696d 6167 6522 2c0d    "elem image",.
-00012510: 0a20 2020 2020 2020 2029 2c0d 0a20 2020  .        ),..   
-00012520: 2020 2020 2068 656c 703d 5f28 2256 6563       help=_("Vec
-00012530: 746f 7269 7a65 2074 6865 2067 6976 656e  torize the given
-00012540: 2065 6c65 6d65 6e74 2229 2c0d 0a20 2020   element"),..   
-00012550: 2029 0d0a 2020 2020 6465 6620 7472 6163   )..    def trac
-00012560: 655f 6269 746d 6170 286e 6f64 652c 202a  e_bitmap(node, *
-00012570: 2a6b 7761 7267 7329 3a0d 0a20 2020 2020  *kwargs):..     
-00012580: 2020 2073 656c 6628 2276 6563 746f 7269     self("vectori
-00012590: 7a65 5c6e 2229 0d0a 0d0a 2020 2020 4074  ze\n")....    @t
-000125a0: 7265 655f 636f 6e64 6974 696f 6e61 6c28  ree_conditional(
-000125b0: 6c61 6d62 6461 206e 6f64 653a 206e 6f74  lambda node: not
-000125c0: 2069 735f 7265 676d 6172 6b28 6e6f 6465   is_regmark(node
-000125d0: 2929 0d0a 2020 2020 4074 7265 655f 6f70  ))..    @tree_op
-000125e0: 6572 6174 696f 6e28 0d0a 2020 2020 2020  eration(..      
-000125f0: 2020 5f28 2243 6f6e 7665 7274 2074 6f20    _("Convert to 
-00012600: 7061 7468 2229 2c0d 0a20 2020 2020 2020  path"),..       
-00012610: 206e 6f64 655f 7479 7065 3d28 0d0a 2020   node_type=(..  
-00012620: 2020 2020 2020 2020 2020 2265 6c65 6d20            "elem 
-00012630: 656c 6c69 7073 6522 2c0d 0a20 2020 2020  ellipse",..     
-00012640: 2020 2020 2020 2022 656c 656d 2070 6174         "elem pat
-00012650: 6822 2c0d 0a20 2020 2020 2020 2020 2020  h",..           
-00012660: 2022 656c 656d 2070 6f6c 796c 696e 6522   "elem polyline"
-00012670: 2c0d 0a20 2020 2020 2020 2020 2020 2022  ,..            "
-00012680: 656c 656d 2072 6563 7422 2c0d 0a20 2020  elem rect",..   
-00012690: 2020 2020 2020 2020 2022 656c 656d 206c           "elem l
-000126a0: 696e 6522 2c0d 0a20 2020 2020 2020 2029  ine",..        )
-000126b0: 2c0d 0a20 2020 2020 2020 2068 656c 703d  ,..        help=
-000126c0: 2222 2c0d 0a20 2020 2029 0d0a 2020 2020  "",..    )..    
-000126d0: 6465 6620 636f 6e76 6572 745f 746f 5f70  def convert_to_p
-000126e0: 6174 6828 7369 6e67 6c65 6e6f 6465 2c20  ath(singlenode, 
-000126f0: 2a2a 6b77 6172 6773 293a 0d0a 2020 2020  **kwargs):..    
-00012700: 2020 2020 666f 7220 6e6f 6465 2069 6e20      for node in 
-00012710: 6c69 7374 2873 656c 662e 656c 656d 7328  list(self.elems(
-00012720: 656d 7068 6173 697a 6564 3d54 7275 6529  emphasized=True)
-00012730: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00012740: 6966 206e 6f74 206e 6f64 6520 6e6f 7420  if not node not 
-00012750: 696e 2028 0d0a 2020 2020 2020 2020 2020  in (..          
-00012760: 2020 2020 2020 2265 6c65 6d20 656c 6c69        "elem elli
-00012770: 7073 6522 2c0d 0a20 2020 2020 2020 2020  pse",..         
-00012780: 2020 2020 2020 2022 656c 656d 2070 6174         "elem pat
-00012790: 6822 2c0d 0a20 2020 2020 2020 2020 2020  h",..           
-000127a0: 2020 2020 2022 656c 656d 2070 6f6c 796c       "elem polyl
-000127b0: 696e 6522 2c0d 0a20 2020 2020 2020 2020  ine",..         
-000127c0: 2020 2020 2020 2022 656c 656d 2072 6563         "elem rec
-000127d0: 7422 2c0d 0a20 2020 2020 2020 2020 2020  t",..           
-000127e0: 2020 2020 2022 656c 656d 206c 696e 6522       "elem line"
-000127f0: 2c0d 0a20 2020 2020 2020 2020 2020 2029  ,..            )
-00012800: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00012810: 2020 2063 6f6e 7469 6e75 650d 0a20 2020     continue..   
-00012820: 2020 2020 2020 2020 206f 6c64 7374 7566           oldstuf
-00012830: 6620 3d20 5b5d 0d0a 2020 2020 2020 2020  f = []..        
-00012840: 2020 2020 666f 7220 6174 7472 6962 2069      for attrib i
-00012850: 6e20 2822 7374 726f 6b65 222c 2022 6669  n ("stroke", "fi
-00012860: 6c6c 222c 2022 7374 726f 6b65 5f77 6964  ll", "stroke_wid
-00012870: 7468 222c 2022 7374 726f 6b65 5f73 6361  th", "stroke_sca
-00012880: 6c65 6422 293a 0d0a 2020 2020 2020 2020  led"):..        
-00012890: 2020 2020 2020 2020 6966 2068 6173 6174          if hasat
-000128a0: 7472 286e 6f64 652c 2061 7474 7269 6229  tr(node, attrib)
-000128b0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-000128c0: 2020 2020 2020 206f 6c64 7661 6c20 3d20         oldval = 
-000128d0: 6765 7461 7474 7228 6e6f 6465 2c20 6174  getattr(node, at
-000128e0: 7472 6962 2c20 4e6f 6e65 290d 0a20 2020  trib, None)..   
-000128f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012900: 206f 6c64 7374 7566 662e 6170 7065 6e64   oldstuff.append
-00012910: 285b 6174 7472 6962 2c20 6f6c 6476 616c  ([attrib, oldval
-00012920: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
-00012930: 7472 793a 0d0a 2020 2020 2020 2020 2020  try:..          
-00012940: 2020 2020 2020 7061 7468 203d 206e 6f64        path = nod
-00012950: 652e 6173 5f70 6174 6828 290d 0a20 2020  e.as_path()..   
-00012960: 2020 2020 2020 2020 2020 2020 2023 2054               # T
-00012970: 6865 7265 2061 7265 2073 6f6d 6520 6368  here are some ch
-00012980: 616c 6c65 6e67 6573 2061 726f 756e 6420  allenges around 
-00012990: 7468 6520 7472 6561 746d 656e 740d 0a20  the treatment.. 
-000129a0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-000129b0: 206f 6620 6172 6373 2077 6974 6869 6e20   of arcs within 
-000129c0: 7376 6765 6c65 6d65 6e74 732c 2073 6f20  svgelements, so 
-000129d0: 6c65 7427 7320 6369 7263 756d 7665 6e74  let's circumvent
-000129e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000129f0: 2020 2320 7468 656d 2066 6f72 2074 6865    # them for the
-00012a00: 2074 696d 6520 6265 696e 6720 2875 6e74   time being (unt
-00012a10: 696c 2072 6573 6f6c 7665 6429 0d0a 2020  il resolved)..  
-00012a20: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00012a30: 6279 2072 6570 6c61 6369 6e67 2061 7263  by replacing arc
-00012a40: 2073 6567 6d65 6e74 7320 7769 7468 2063   segments with c
-00012a50: 7562 6963 2062 657a 6965 7273 0d0a 2020  ubic beziers..  
-00012a60: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00012a70: 206e 6f64 652e 7479 7065 2069 6e20 2822   node.type in ("
-00012a80: 656c 656d 2070 6174 6822 2c20 2265 6c65  elem path", "ele
-00012a90: 6d20 656c 6c69 7073 6522 293a 0d0a 2020  m ellipse"):..  
-00012aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012ab0: 2020 7061 7468 2e61 7070 726f 7869 6d61    path.approxima
-00012ac0: 7465 5f61 7263 735f 7769 7468 5f63 7562  te_arcs_with_cub
-00012ad0: 6963 7328 290d 0a20 2020 2020 2020 2020  ics()..         
-00012ae0: 2020 2065 7863 6570 7420 4174 7472 6962     except Attrib
-00012af0: 7574 6545 7272 6f72 3a0d 0a20 2020 2020  uteError:..     
-00012b00: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00012b10: 6e0d 0a20 2020 2020 2020 2020 2020 206e  n..            n
-00012b20: 6577 6e6f 6465 203d 206e 6f64 652e 7265  ewnode = node.re
-00012b30: 706c 6163 655f 6e6f 6465 2870 6174 683d  place_node(path=
-00012b40: 7061 7468 2c20 7479 7065 3d22 656c 656d  path, type="elem
-00012b50: 2070 6174 6822 290d 0a20 2020 2020 2020   path")..       
-00012b60: 2020 2020 2066 6f72 2069 7465 6d20 696e       for item in
-00012b70: 206f 6c64 7374 7566 663a 0d0a 2020 2020   oldstuff:..    
-00012b80: 2020 2020 2020 2020 2020 2020 7365 7461              seta
-00012b90: 7474 7228 6e65 776e 6f64 652c 2069 7465  ttr(newnode, ite
-00012ba0: 6d5b 305d 2c20 6974 656d 5b31 5d29 0d0a  m[0], item[1])..
-00012bb0: 2020 2020 2020 2020 2020 2020 6e65 776e              newn
-00012bc0: 6f64 652e 616c 7465 7265 6428 290d 0a0d  ode.altered()...
-00012bd0: 0a20 2020 2040 7472 6565 5f73 7562 6d65  .    @tree_subme
-00012be0: 6e75 285f 2822 466c 6970 2229 290d 0a20  nu(_("Flip")).. 
-00012bf0: 2020 2040 7472 6565 5f73 6570 6172 6174     @tree_separat
-00012c00: 6f72 5f62 6566 6f72 6528 290d 0a20 2020  or_before()..   
-00012c10: 2040 7472 6565 5f63 6f6e 6469 7469 6f6e   @tree_condition
-00012c20: 616c 286c 616d 6264 6120 6e6f 6465 3a20  al(lambda node: 
-00012c30: 6e6f 7420 6973 5f72 6567 6d61 726b 286e  not is_regmark(n
-00012c40: 6f64 6529 290d 0a20 2020 2040 7472 6565  ode))..    @tree
-00012c50: 5f63 6f6e 6469 7469 6f6e 616c 5f74 7279  _conditional_try
-00012c60: 286c 616d 6264 6120 6e6f 6465 3a20 6e6f  (lambda node: no
-00012c70: 7420 6e6f 6465 2e6c 6f63 6b29 0d0a 2020  t node.lock)..  
-00012c80: 2020 4074 7265 655f 6f70 6572 6174 696f    @tree_operatio
-00012c90: 6e28 0d0a 2020 2020 2020 2020 5f28 2248  n(..        _("H
-00012ca0: 6f72 697a 6f6e 7461 6c6c 7922 292c 0d0a  orizontally"),..
-00012cb0: 2020 2020 2020 2020 6e6f 6465 5f74 7970          node_typ
-00012cc0: 653d 656c 656d 5f67 726f 7570 5f6e 6f64  e=elem_group_nod
-00012cd0: 6573 2c0d 0a20 2020 2020 2020 2068 656c  es,..        hel
-00012ce0: 703d 5f28 224d 6972 726f 7220 486f 7269  p=_("Mirror Hori
-00012cf0: 7a6f 6e74 616c 6c79 2229 2c0d 0a20 2020  zontally"),..   
-00012d00: 2029 0d0a 2020 2020 6465 6620 6d69 7272   )..    def mirr
-00012d10: 6f72 5f65 6c65 6d28 6e6f 6465 2c20 2a2a  or_elem(node, **
-00012d20: 6b77 6172 6773 293a 0d0a 2020 2020 2020  kwargs):..      
-00012d30: 2020 626f 756e 6473 203d 2073 656c 662e    bounds = self.
-00012d40: 5f65 6d70 6861 7369 7a65 645f 626f 756e  _emphasized_boun
-00012d50: 6473 0d0a 2020 2020 2020 2020 6966 2062  ds..        if b
-00012d60: 6f75 6e64 7320 6973 204e 6f6e 653a 0d0a  ounds is None:..
-00012d70: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00012d80: 726e 0d0a 2020 2020 2020 2020 6365 6e74  rn..        cent
-00012d90: 6572 5f78 203d 2028 626f 756e 6473 5b32  er_x = (bounds[2
-00012da0: 5d20 2b20 626f 756e 6473 5b30 5d29 202f  ] + bounds[0]) /
-00012db0: 2032 2e30 0d0a 2020 2020 2020 2020 6365   2.0..        ce
-00012dc0: 6e74 6572 5f79 203d 2028 626f 756e 6473  nter_y = (bounds
-00012dd0: 5b33 5d20 2b20 626f 756e 6473 5b31 5d29  [3] + bounds[1])
-00012de0: 202f 2032 2e30 0d0a 2020 2020 2020 2020   / 2.0..        
-00012df0: 7365 6c66 2866 2273 6361 6c65 202d 3120  self(f"scale -1 
-00012e00: 3120 7b63 656e 7465 725f 787d 207b 6365  1 {center_x} {ce
-00012e10: 6e74 6572 5f79 7d5c 6e22 290d 0a0d 0a20  nter_y}\n").... 
-00012e20: 2020 2040 7472 6565 5f63 6f6e 6469 7469     @tree_conditi
-00012e30: 6f6e 616c 286c 616d 6264 6120 6e6f 6465  onal(lambda node
-00012e40: 3a20 6e6f 7420 6973 5f72 6567 6d61 726b  : not is_regmark
-00012e50: 286e 6f64 6529 290d 0a20 2020 2040 7472  (node))..    @tr
-00012e60: 6565 5f73 7562 6d65 6e75 285f 2822 466c  ee_submenu(_("Fl
-00012e70: 6970 2229 290d 0a20 2020 2040 7472 6565  ip"))..    @tree
-00012e80: 5f63 6f6e 6469 7469 6f6e 616c 5f74 7279  _conditional_try
-00012e90: 286c 616d 6264 6120 6e6f 6465 3a20 6e6f  (lambda node: no
-00012ea0: 7420 6e6f 6465 2e6c 6f63 6b29 0d0a 2020  t node.lock)..  
-00012eb0: 2020 4074 7265 655f 6f70 6572 6174 696f    @tree_operatio
-00012ec0: 6e28 0d0a 2020 2020 2020 2020 5f28 2256  n(..        _("V
-00012ed0: 6572 7469 6361 6c6c 7922 292c 0d0a 2020  ertically"),..  
-00012ee0: 2020 2020 2020 6e6f 6465 5f74 7970 653d        node_type=
-00012ef0: 656c 656d 5f67 726f 7570 5f6e 6f64 6573  elem_group_nodes
-00012f00: 2c0d 0a20 2020 2020 2020 2068 656c 703d  ,..        help=
-00012f10: 5f28 2246 6c69 7020 5665 7274 6963 616c  _("Flip Vertical
-00012f20: 6c79 2229 2c0d 0a20 2020 2029 0d0a 2020  ly"),..    )..  
-00012f30: 2020 6465 6620 666c 6970 5f65 6c65 6d28    def flip_elem(
-00012f40: 6e6f 6465 2c20 2a2a 6b77 6172 6773 293a  node, **kwargs):
-00012f50: 0d0a 2020 2020 2020 2020 626f 756e 6473  ..        bounds
-00012f60: 203d 2073 656c 662e 5f65 6d70 6861 7369   = self._emphasi
-00012f70: 7a65 645f 626f 756e 6473 0d0a 2020 2020  zed_bounds..    
-00012f80: 2020 2020 6966 2062 6f75 6e64 7320 6973      if bounds is
-00012f90: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
-00012fa0: 2020 2020 7265 7475 726e 0d0a 2020 2020      return..    
-00012fb0: 2020 2020 6365 6e74 6572 5f78 203d 2028      center_x = (
-00012fc0: 626f 756e 6473 5b32 5d20 2b20 626f 756e  bounds[2] + boun
-00012fd0: 6473 5b30 5d29 202f 2032 2e30 0d0a 2020  ds[0]) / 2.0..  
-00012fe0: 2020 2020 2020 6365 6e74 6572 5f79 203d        center_y =
-00012ff0: 2028 626f 756e 6473 5b33 5d20 2b20 626f   (bounds[3] + bo
-00013000: 756e 6473 5b31 5d29 202f 2032 2e30 0d0a  unds[1]) / 2.0..
-00013010: 2020 2020 2020 2020 7365 6c66 2866 2273          self(f"s
-00013020: 6361 6c65 2031 202d 3120 7b63 656e 7465  cale 1 -1 {cente
-00013030: 725f 787d 207b 6365 6e74 6572 5f79 7d5c  r_x} {center_y}\
-00013040: 6e22 290d 0a0d 0a20 2020 2040 7472 6565  n")....    @tree
-00013050: 5f63 6f6e 6469 7469 6f6e 616c 286c 616d  _conditional(lam
-00013060: 6264 6120 6e6f 6465 3a20 6e6f 7420 6973  bda node: not is
-00013070: 5f72 6567 6d61 726b 286e 6f64 6529 290d  _regmark(node)).
-00013080: 0a20 2020 2040 7472 6565 5f63 6f6e 6469  .    @tree_condi
-00013090: 7469 6f6e 616c 5f74 7279 286c 616d 6264  tional_try(lambd
-000130a0: 6120 6e6f 6465 3a20 6e6f 7420 6e6f 6465  a node: not node
-000130b0: 2e6c 6f63 6b29 0d0a 2020 2020 4074 7265  .lock)..    @tre
-000130c0: 655f 7375 626d 656e 7528 5f28 2253 6361  e_submenu(_("Sca
-000130d0: 6c65 2229 290d 0a20 2020 2040 7472 6565  le"))..    @tree
-000130e0: 5f69 7465 7261 7465 2822 7363 616c 6522  _iterate("scale"
-000130f0: 2c20 3235 2c20 312c 202d 3129 0d0a 2020  , 25, 1, -1)..  
-00013100: 2020 4074 7265 655f 6361 6c63 2822 7363    @tree_calc("sc
-00013110: 616c 655f 7065 7263 656e 7422 2c20 6c61  ale_percent", la
-00013120: 6d62 6461 2069 3a20 6622 7b28 3630 302e  mbda i: f"{(600.
-00013130: 3020 2f20 666c 6f61 7428 6929 293a 2e32  0 / float(i)):.2
-00013140: 667d 2229 0d0a 2020 2020 4074 7265 655f  f}")..    @tree_
-00013150: 6f70 6572 6174 696f 6e28 0d0a 2020 2020  operation(..    
-00013160: 2020 2020 5f28 2253 6361 6c65 207b 7363      _("Scale {sc
-00013170: 616c 655f 7065 7263 656e 747d 2522 292c  ale_percent}%"),
-00013180: 0d0a 2020 2020 2020 2020 6e6f 6465 5f74  ..        node_t
-00013190: 7970 653d 656c 656d 5f67 726f 7570 5f6e  ype=elem_group_n
-000131a0: 6f64 6573 2c0d 0a20 2020 2020 2020 2068  odes,..        h
-000131b0: 656c 703d 5f28 2253 6361 6c65 2045 6c65  elp=_("Scale Ele
-000131c0: 6d65 6e74 2229 2c0d 0a20 2020 2029 0d0a  ment"),..    )..
-000131d0: 2020 2020 6465 6620 7363 616c 655f 656c      def scale_el
-000131e0: 656d 5f61 6d6f 756e 7428 6e6f 6465 2c20  em_amount(node, 
-000131f0: 7363 616c 652c 202a 2a6b 7761 7267 7329  scale, **kwargs)
-00013200: 3a0d 0a20 2020 2020 2020 2073 6361 6c65  :..        scale
-00013210: 203d 2036 2e30 202f 2066 6c6f 6174 2873   = 6.0 / float(s
-00013220: 6361 6c65 290d 0a20 2020 2020 2020 2062  cale)..        b
-00013230: 6f75 6e64 7320 3d20 7365 6c66 2e5f 656d  ounds = self._em
-00013240: 7068 6173 697a 6564 5f62 6f75 6e64 730d  phasized_bounds.
-00013250: 0a20 2020 2020 2020 2069 6620 626f 756e  .        if boun
-00013260: 6473 2069 7320 4e6f 6e65 3a0d 0a20 2020  ds is None:..   
-00013270: 2020 2020 2020 2020 2072 6574 7572 6e0d           return.
-00013280: 0a20 2020 2020 2020 2063 656e 7465 725f  .        center_
-00013290: 7820 3d20 2862 6f75 6e64 735b 325d 202b  x = (bounds[2] +
-000132a0: 2062 6f75 6e64 735b 305d 2920 2f20 322e   bounds[0]) / 2.
-000132b0: 300d 0a20 2020 2020 2020 2063 656e 7465  0..        cente
-000132c0: 725f 7920 3d20 2862 6f75 6e64 735b 335d  r_y = (bounds[3]
-000132d0: 202b 2062 6f75 6e64 735b 315d 2920 2f20   + bounds[1]) / 
-000132e0: 322e 300d 0a20 2020 2020 2020 2073 656c  2.0..        sel
-000132f0: 6628 6622 7363 616c 6520 7b73 6361 6c65  f(f"scale {scale
-00013300: 7d20 7b73 6361 6c65 7d20 7b63 656e 7465  } {scale} {cente
-00013310: 725f 787d 207b 6365 6e74 6572 5f79 7d5c  r_x} {center_y}\
-00013320: 6e22 290d 0a0d 0a20 2020 2023 2040 7472  n")....    # @tr
-00013330: 6565 5f63 6f6e 6469 7469 6f6e 616c 286c  ee_conditional(l
-00013340: 616d 6264 6120 6e6f 6465 3a20 6973 696e  ambda node: isin
-00013350: 7374 616e 6365 286e 6f64 652e 6f62 6a65  stance(node.obje
-00013360: 6374 2c20 5356 4745 6c65 6d65 6e74 2929  ct, SVGElement))
-00013370: 0d0a 2020 2020 4074 7265 655f 636f 6e64  ..    @tree_cond
-00013380: 6974 696f 6e61 6c28 6c61 6d62 6461 206e  itional(lambda n
-00013390: 6f64 653a 206e 6f74 2069 735f 7265 676d  ode: not is_regm
-000133a0: 6172 6b28 6e6f 6465 2929 0d0a 2020 2020  ark(node))..    
-000133b0: 4074 7265 655f 636f 6e64 6974 696f 6e61  @tree_conditiona
-000133c0: 6c5f 7472 7928 6c61 6d62 6461 206e 6f64  l_try(lambda nod
-000133d0: 653a 206e 6f74 206e 6f64 652e 6c6f 636b  e: not node.lock
-000133e0: 290d 0a20 2020 2040 7472 6565 5f73 7562  )..    @tree_sub
-000133f0: 6d65 6e75 285f 2822 526f 7461 7465 2229  menu(_("Rotate")
-00013400: 290d 0a20 2020 2040 7472 6565 5f76 616c  )..    @tree_val
-00013410: 7565 7328 0d0a 2020 2020 2020 2020 2261  ues(..        "a
-00013420: 6e67 6c65 222c 0d0a 2020 2020 2020 2020  ngle",..        
-00013430: 280d 0a20 2020 2020 2020 2020 2020 2031  (..            1
-00013440: 3830 2c0d 0a20 2020 2020 2020 2020 2020  80,..           
-00013450: 2031 3335 2c0d 0a20 2020 2020 2020 2020   135,..         
-00013460: 2020 2039 302c 0d0a 2020 2020 2020 2020     90,..        
-00013470: 2020 2020 3630 2c0d 0a20 2020 2020 2020      60,..       
-00013480: 2020 2020 2034 352c 0d0a 2020 2020 2020       45,..      
-00013490: 2020 2020 2020 3330 2c0d 0a20 2020 2020        30,..     
-000134a0: 2020 2020 2020 2032 302c 0d0a 2020 2020         20,..    
-000134b0: 2020 2020 2020 2020 3135 2c0d 0a20 2020          15,..   
-000134c0: 2020 2020 2020 2020 2031 302c 0d0a 2020           10,..  
-000134d0: 2020 2020 2020 2020 2020 352c 0d0a 2020            5,..  
-000134e0: 2020 2020 2020 2020 2020 342c 0d0a 2020            4,..  
-000134f0: 2020 2020 2020 2020 2020 332c 0d0a 2020            3,..  
-00013500: 2020 2020 2020 2020 2020 322c 0d0a 2020            2,..  
-00013510: 2020 2020 2020 2020 2020 312c 0d0a 2020            1,..  
-00013520: 2020 2020 2020 2020 2020 2d31 2c0d 0a20            -1,.. 
-00013530: 2020 2020 2020 2020 2020 202d 322c 0d0a             -2,..
-00013540: 2020 2020 2020 2020 2020 2020 2d33 2c0d              -3,.
-00013550: 0a20 2020 2020 2020 2020 2020 202d 342c  .            -4,
-00013560: 0d0a 2020 2020 2020 2020 2020 2020 2d35  ..            -5
-00013570: 2c0d 0a20 2020 2020 2020 2020 2020 202d  ,..            -
-00013580: 3130 2c0d 0a20 2020 2020 2020 2020 2020  10,..           
-00013590: 202d 3135 2c0d 0a20 2020 2020 2020 2020   -15,..         
-000135a0: 2020 202d 3230 2c0d 0a20 2020 2020 2020     -20,..       
-000135b0: 2020 2020 202d 3330 2c0d 0a20 2020 2020       -30,..     
-000135c0: 2020 2020 2020 202d 3435 2c0d 0a20 2020         -45,..   
-000135d0: 2020 2020 2020 2020 202d 3630 2c0d 0a20           -60,.. 
-000135e0: 2020 2020 2020 2020 2020 202d 3930 2c0d             -90,.
-000135f0: 0a20 2020 2020 2020 2029 2c0d 0a20 2020  .        ),..   
-00013600: 2029 0d0a 2020 2020 4074 7265 655f 6f70   )..    @tree_op
-00013610: 6572 6174 696f 6e28 5f28 2252 6f74 6174  eration(_("Rotat
-00013620: 6520 7b61 6e67 6c65 7dc2 b022 292c 206e  e {angle}.."), n
-00013630: 6f64 655f 7479 7065 3d65 6c65 6d5f 6772  ode_type=elem_gr
-00013640: 6f75 705f 6e6f 6465 732c 2068 656c 703d  oup_nodes, help=
-00013650: 2222 290d 0a20 2020 2064 6566 2072 6f74  "")..    def rot
-00013660: 6174 655f 656c 656d 5f61 6d6f 756e 7428  ate_elem_amount(
-00013670: 6e6f 6465 2c20 616e 676c 652c 202a 2a6b  node, angle, **k
-00013680: 7761 7267 7329 3a0d 0a20 2020 2020 2020  wargs):..       
-00013690: 2074 7572 6e73 203d 2066 6c6f 6174 2861   turns = float(a
-000136a0: 6e67 6c65 2920 2f20 3336 302e 300d 0a20  ngle) / 360.0.. 
-000136b0: 2020 2020 2020 2062 6f75 6e64 7320 3d20         bounds = 
-000136c0: 7365 6c66 2e5f 656d 7068 6173 697a 6564  self._emphasized
-000136d0: 5f62 6f75 6e64 730d 0a20 2020 2020 2020  _bounds..       
-000136e0: 2069 6620 626f 756e 6473 2069 7320 4e6f   if bounds is No
-000136f0: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
-00013700: 2072 6574 7572 6e0d 0a20 2020 2020 2020   return..       
-00013710: 2063 656e 7465 725f 7820 3d20 2862 6f75   center_x = (bou
-00013720: 6e64 735b 325d 202b 2062 6f75 6e64 735b  nds[2] + bounds[
-00013730: 305d 2920 2f20 322e 300d 0a20 2020 2020  0]) / 2.0..     
-00013740: 2020 2063 656e 7465 725f 7920 3d20 2862     center_y = (b
-00013750: 6f75 6e64 735b 335d 202b 2062 6f75 6e64  ounds[3] + bound
-00013760: 735b 315d 2920 2f20 322e 300d 0a20 2020  s[1]) / 2.0..   
-00013770: 2020 2020 2073 656c 6628 6622 726f 7461       self(f"rota
-00013780: 7465 207b 7475 726e 737d 7475 726e 207b  te {turns}turn {
-00013790: 6365 6e74 6572 5f78 7d20 7b63 656e 7465  center_x} {cente
-000137a0: 725f 797d 5c6e 2229 0d0a 2020 2020 2020  r_y}\n")..      
-000137b0: 2020 7365 6c66 2e73 6967 6e61 6c28 2265    self.signal("e
-000137c0: 7874 2d6d 6f64 6966 6965 6422 290d 0a0d  xt-modified")...
-000137d0: 0a20 2020 2040 7472 6565 5f63 6f6e 6469  .    @tree_condi
-000137e0: 7469 6f6e 616c 286c 616d 6264 6120 6e6f  tional(lambda no
-000137f0: 6465 3a20 6e6f 7420 6973 5f72 6567 6d61  de: not is_regma
-00013800: 726b 286e 6f64 6529 290d 0a20 2020 2040  rk(node))..    @
-00013810: 7472 6565 5f63 6f6e 6469 7469 6f6e 616c  tree_conditional
-00013820: 286c 616d 6264 6120 6e6f 6465 3a20 6861  (lambda node: ha
-00013830: 735f 6368 616e 6765 7328 6e6f 6465 2929  s_changes(node))
-00013840: 0d0a 2020 2020 4074 7265 655f 636f 6e64  ..    @tree_cond
-00013850: 6974 696f 6e61 6c5f 7472 7928 6c61 6d62  itional_try(lamb
-00013860: 6461 206e 6f64 653a 206e 6f74 206e 6f64  da node: not nod
-00013870: 652e 6c6f 636b 290d 0a20 2020 2040 7472  e.lock)..    @tr
-00013880: 6565 5f6f 7065 7261 7469 6f6e 285f 2822  ee_operation(_("
-00013890: 5265 6966 7920 5573 6572 2043 6861 6e67  Reify User Chang
-000138a0: 6573 2229 2c20 6e6f 6465 5f74 7970 653d  es"), node_type=
-000138b0: 656c 656d 5f67 726f 7570 5f6e 6f64 6573  elem_group_nodes
-000138c0: 2c20 6865 6c70 3d22 2229 0d0a 2020 2020  , help="")..    
-000138d0: 6465 6620 7265 6966 795f 656c 656d 5f63  def reify_elem_c
-000138e0: 6861 6e67 6573 286e 6f64 652c 202a 2a6b  hanges(node, **k
-000138f0: 7761 7267 7329 3a0d 0a20 2020 2020 2020  wargs):..       
-00013900: 2073 656c 6628 2272 6569 6679 5c6e 2229   self("reify\n")
-00013910: 0d0a 2020 2020 2020 2020 7365 6c66 2e73  ..        self.s
-00013920: 6967 6e61 6c28 2265 7874 2d6d 6f64 6966  ignal("ext-modif
-00013930: 6965 6422 290d 0a0d 0a20 2020 2040 7472  ied")....    @tr
-00013940: 6565 5f63 6f6e 6469 7469 6f6e 616c 286c  ee_conditional(l
-00013950: 616d 6264 6120 6e6f 6465 3a20 6e6f 7420  ambda node: not 
-00013960: 6973 5f72 6567 6d61 726b 286e 6f64 6529  is_regmark(node)
-00013970: 290d 0a20 2020 2040 7472 6565 5f63 6f6e  )..    @tree_con
-00013980: 6469 7469 6f6e 616c 5f74 7279 286c 616d  ditional_try(lam
-00013990: 6264 6120 6e6f 6465 3a20 6e6f 7420 6e6f  bda node: not no
-000139a0: 6465 2e6c 6f63 6b29 0d0a 2020 2020 4074  de.lock)..    @t
-000139b0: 7265 655f 6f70 6572 6174 696f 6e28 5f28  ree_operation(_(
-000139c0: 2242 7265 616b 2053 7562 7061 7468 7322  "Break Subpaths"
-000139d0: 292c 206e 6f64 655f 7479 7065 3d22 656c  ), node_type="el
-000139e0: 656d 2070 6174 6822 2c20 6865 6c70 3d22  em path", help="
-000139f0: 2229 0d0a 2020 2020 6465 6620 6272 6561  ")..    def brea
-00013a00: 6b5f 7375 6270 6174 685f 656c 656d 286e  k_subpath_elem(n
-00013a10: 6f64 652c 202a 2a6b 7761 7267 7329 3a0d  ode, **kwargs):.
-00013a20: 0a20 2020 2020 2020 2073 656c 6628 2265  .        self("e
-00013a30: 6c65 6d65 6e74 2073 7562 7061 7468 5c6e  lement subpath\n
-00013a40: 2229 0d0a 0d0a 2020 2020 4074 7265 655f  ")....    @tree_
-00013a50: 636f 6e64 6974 696f 6e61 6c28 6c61 6d62  conditional(lamb
-00013a60: 6461 206e 6f64 653a 206e 6f74 2069 735f  da node: not is_
-00013a70: 7265 676d 6172 6b28 6e6f 6465 2929 0d0a  regmark(node))..
-00013a80: 2020 2020 4074 7265 655f 636f 6e64 6974      @tree_condit
-00013a90: 696f 6e61 6c28 6c61 6d62 6461 206e 6f64  ional(lambda nod
-00013aa0: 653a 2068 6173 5f63 6861 6e67 6573 286e  e: has_changes(n
-00013ab0: 6f64 6529 290d 0a20 2020 2040 7472 6565  ode))..    @tree
-00013ac0: 5f63 6f6e 6469 7469 6f6e 616c 5f74 7279  _conditional_try
-00013ad0: 286c 616d 6264 6120 6e6f 6465 3a20 6e6f  (lambda node: no
-00013ae0: 7420 6e6f 6465 2e6c 6f63 6b29 0d0a 2020  t node.lock)..  
-00013af0: 2020 4074 7265 655f 6f70 6572 6174 696f    @tree_operatio
-00013b00: 6e28 5f28 2252 6573 6574 2075 7365 7220  n(_("Reset user 
-00013b10: 6368 616e 6765 7322 292c 206e 6f64 655f  changes"), node_
-00013b20: 7479 7065 3d65 6c65 6d5f 6772 6f75 705f  type=elem_group_
-00013b30: 6e6f 6465 732c 2068 656c 703d 2222 290d  nodes, help="").
-00013b40: 0a20 2020 2064 6566 2072 6573 6574 5f75  .    def reset_u
-00013b50: 7365 725f 6368 616e 6765 7328 6e6f 6465  ser_changes(node
-00013b60: 2c20 636f 7069 6573 3d31 2c20 2a2a 6b77  , copies=1, **kw
-00013b70: 6172 6773 293a 0d0a 2020 2020 2020 2020  args):..        
-00013b80: 7365 6c66 2822 7265 7365 745c 6e22 290d  self("reset\n").
-00013b90: 0a20 2020 2020 2020 2073 656c 662e 7369  .        self.si
-00013ba0: 676e 616c 2822 6578 742d 6d6f 6469 6669  gnal("ext-modifi
-00013bb0: 6564 2229 0d0a 0d0a 2020 2020 4074 7265  ed")....    @tre
-00013bc0: 655f 6f70 6572 6174 696f 6e28 0d0a 2020  e_operation(..  
-00013bd0: 2020 2020 2020 5f28 224d 6572 6765 2069        _("Merge i
-00013be0: 7465 6d73 2229 2c0d 0a20 2020 2020 2020  tems"),..       
-00013bf0: 206e 6f64 655f 7479 7065 3d22 6772 6f75   node_type="grou
-00013c00: 7022 2c0d 0a20 2020 2020 2020 2068 656c  p",..        hel
-00013c10: 703d 5f28 224d 6572 6765 2074 6869 7320  p=_("Merge this 
-00013c20: 6e6f 6465 2773 2063 6869 6c64 7265 6e20  node's children 
-00013c30: 696e 746f 2031 2070 6174 682e 2229 2c0d  into 1 path."),.
-00013c40: 0a20 2020 2029 0d0a 2020 2020 6465 6620  .    )..    def 
-00013c50: 6d65 7267 655f 656c 656d 656e 7473 286e  merge_elements(n
-00013c60: 6f64 652c 202a 2a6b 7761 7267 7329 3a0d  ode, **kwargs):.
-00013c70: 0a20 2020 2020 2020 2073 656c 6628 2265  .        self("e
-00013c80: 6c65 6d65 6e74 206d 6572 6765 5c6e 2229  lement merge\n")
-00013c90: 0d0a 2020 2020 2020 2020 2320 4973 2074  ..        # Is t
-00013ca0: 6865 2067 726f 7570 206e 6f77 2065 6d70  he group now emp
-00013cb0: 7479 3f20 2d2d 3e20 6465 6c65 7465 0d0a  ty? --> delete..
-00013cc0: 2020 2020 2020 2020 6966 206c 656e 286e          if len(n
-00013cd0: 6f64 652e 6368 696c 6472 656e 2920 3d3d  ode.children) ==
-00013ce0: 2030 3a0d 0a20 2020 2020 2020 2020 2020   0:..           
-00013cf0: 206e 6f64 652e 7265 6d6f 7665 5f6e 6f64   node.remove_nod
-00013d00: 6528 290d 0a0d 0a20 2020 2040 7472 6565  e()....    @tree
-00013d10: 5f63 6f6e 6469 7469 6f6e 616c 286c 616d  _conditional(lam
-00013d20: 6264 6120 6e6f 6465 3a20 6e6f 6465 2e6c  bda node: node.l
-00013d30: 6f63 6b29 0d0a 2020 2020 4074 7265 655f  ock)..    @tree_
-00013d40: 7365 7061 7261 746f 725f 6265 666f 7265  separator_before
-00013d50: 2829 0d0a 2020 2020 4074 7265 655f 6f70  ()..    @tree_op
-00013d60: 6572 6174 696f 6e28 0d0a 2020 2020 2020  eration(..      
-00013d70: 2020 5f28 2255 6e6c 6f63 6b20 656c 656d    _("Unlock elem
-00013d80: 656e 742c 2061 6c6c 6f77 7320 6d61 6e69  ent, allows mani
-00013d90: 7075 6c61 7469 6f6e 2229 2c20 6e6f 6465  pulation"), node
-00013da0: 5f74 7970 653d 656c 656d 5f6e 6f64 6573  _type=elem_nodes
-00013db0: 2c20 6865 6c70 3d22 220d 0a20 2020 2029  , help=""..    )
-00013dc0: 0d0a 2020 2020 6465 6620 656c 656d 656e  ..    def elemen
-00013dd0: 745f 756e 6c6f 636b 5f6d 616e 6970 756c  t_unlock_manipul
-00013de0: 6174 696f 6e73 286e 6f64 652c 202a 2a6b  ations(node, **k
-00013df0: 7761 7267 7329 3a0d 0a20 2020 2020 2020  wargs):..       
-00013e00: 2073 656c 6628 2265 6c65 6d65 6e74 2075   self("element u
-00013e10: 6e6c 6f63 6b5c 6e22 290d 0a0d 0a20 2020  nlock\n")....   
-00013e20: 2040 7472 6565 5f63 6f6e 6469 7469 6f6e   @tree_condition
-00013e30: 616c 286c 616d 6264 6120 6e6f 6465 3a20  al(lambda node: 
-00013e40: 6e6f 7420 6e6f 6465 2e6c 6f63 6b29 0d0a  not node.lock)..
-00013e50: 2020 2020 4074 7265 655f 7365 7061 7261      @tree_separa
-00013e60: 746f 725f 6265 666f 7265 2829 0d0a 2020  tor_before()..  
-00013e70: 2020 4074 7265 655f 6f70 6572 6174 696f    @tree_operatio
-00013e80: 6e28 0d0a 2020 2020 2020 2020 5f28 224c  n(..        _("L
-00013e90: 6f63 6b20 656c 656d 656e 7473 2c20 7072  ock elements, pr
-00013ea0: 6576 656e 7473 206d 616e 6970 756c 6174  events manipulat
-00013eb0: 696f 6e73 2229 2c20 6e6f 6465 5f74 7970  ions"), node_typ
-00013ec0: 653d 656c 656d 5f6e 6f64 6573 2c20 6865  e=elem_nodes, he
-00013ed0: 6c70 3d22 220d 0a20 2020 2029 0d0a 2020  lp=""..    )..  
-00013ee0: 2020 6465 6620 656c 656d 656e 745f 6c6f    def element_lo
-00013ef0: 636b 5f6d 616e 6970 756c 6174 696f 6e73  ck_manipulations
-00013f00: 286e 6f64 652c 202a 2a6b 7761 7267 7329  (node, **kwargs)
-00013f10: 3a0d 0a20 2020 2020 2020 2073 656c 6628  :..        self(
-00013f20: 2265 6c65 6d65 6e74 206c 6f63 6b5c 6e22  "element lock\n"
-00013f30: 290d 0a0d 0a20 2020 2040 7472 6565 5f63  )....    @tree_c
-00013f40: 6f6e 6469 7469 6f6e 616c 286c 616d 6264  onditional(lambd
-00013f50: 6120 6e6f 6465 3a20 6e6f 6465 2e74 7970  a node: node.typ
-00013f60: 6520 3d3d 2022 6272 616e 6368 2072 6567  e == "branch reg
-00013f70: 2229 0d0a 2020 2020 4074 7265 655f 7365  ")..    @tree_se
-00013f80: 7061 7261 746f 725f 6265 666f 7265 2829  parator_before()
-00013f90: 0d0a 2020 2020 4074 7265 655f 6f70 6572  ..    @tree_oper
-00013fa0: 6174 696f 6e28 5f28 2254 6f67 676c 6520  ation(_("Toggle 
-00013fb0: 7669 7369 6269 6c69 7479 206f 6620 7265  visibility of re
-00013fc0: 676d 6172 6b73 2229 2c20 6e6f 6465 5f74  gmarks"), node_t
-00013fd0: 7970 653d 2262 7261 6e63 6820 7265 6722  ype="branch reg"
-00013fe0: 2c20 6865 6c70 3d22 2229 0d0a 2020 2020  , help="")..    
-00013ff0: 6465 6620 746f 6767 6c65 5f76 6973 6962  def toggle_visib
-00014000: 696c 6974 7928 6e6f 6465 2c20 2a2a 6b77  ility(node, **kw
-00014010: 6172 6773 293a 0d0a 2020 2020 2020 2020  args):..        
-00014020: 7365 6c66 2e73 6967 6e61 6c28 2274 6f67  self.signal("tog
-00014030: 676c 655f 7265 676d 6172 6b73 2229 0d0a  gle_regmarks")..
-00014040: 0d0a 2020 2020 4074 7265 655f 636f 6e64  ..    @tree_cond
-00014050: 6974 696f 6e61 6c28 6c61 6d62 6461 206e  itional(lambda n
-00014060: 6f64 653a 2069 735f 7265 676d 6172 6b28  ode: is_regmark(
-00014070: 6e6f 6465 2929 0d0a 2020 2020 4074 7265  node))..    @tre
-00014080: 655f 7365 7061 7261 746f 725f 6265 666f  e_separator_befo
-00014090: 7265 2829 0d0a 2020 2020 4074 7265 655f  re()..    @tree_
-000140a0: 6f70 6572 6174 696f 6e28 5f28 224d 6f76  operation(_("Mov
-000140b0: 6520 6261 636b 2074 6f20 656c 656d 656e  e back to elemen
-000140c0: 7473 2229 2c20 6e6f 6465 5f74 7970 653d  ts"), node_type=
-000140d0: 656c 656d 5f67 726f 7570 5f6e 6f64 6573  elem_group_nodes
-000140e0: 2c20 6865 6c70 3d22 2229 0d0a 2020 2020  , help="")..    
-000140f0: 6465 6620 6d6f 7665 5f62 6163 6b28 6e6f  def move_back(no
-00014100: 6465 2c20 2a2a 6b77 6172 6773 293a 0d0a  de, **kwargs):..
-00014110: 2020 2020 2020 2020 2320 4472 6167 2061          # Drag a
-00014120: 6e64 2044 726f 700d 0a20 2020 2020 2020  nd Drop..       
-00014130: 2077 6974 6820 7365 6c66 2e73 7461 7469   with self.stati
-00014140: 6328 226d 6f76 655f 6261 636b 2229 3a0d  c("move_back"):.
-00014150: 0a20 2020 2020 2020 2020 2020 2073 6967  .            sig
-00014160: 6e61 6c5f 6e65 6564 6564 203d 2046 616c  nal_needed = Fal
-00014170: 7365 0d0a 2020 2020 2020 2020 2020 2020  se..            
-00014180: 6472 6f70 5f6e 6f64 6520 3d20 7365 6c66  drop_node = self
-00014190: 2e65 6c65 6d5f 6272 616e 6368 0d0a 2020  .elem_branch..  
-000141a0: 2020 2020 2020 2020 2020 6461 7461 203d            data =
-000141b0: 206c 6973 7428 290d 0a20 2020 2020 2020   list()..       
-000141c0: 2020 2020 2066 6f72 2069 7465 6d20 696e       for item in
-000141d0: 206c 6973 7428 7365 6c66 2e72 6567 6d61   list(self.regma
-000141e0: 726b 7328 2929 3a0d 0a20 2020 2020 2020  rks()):..       
-000141f0: 2020 2020 2020 2020 2069 6620 6974 656d           if item
-00014200: 2e73 656c 6563 7465 643a 0d0a 2020 2020  .selected:..    
-00014210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014220: 6461 7461 2e61 7070 656e 6428 6974 656d  data.append(item
-00014230: 290d 0a20 2020 2020 2020 2020 2020 2066  )..            f
-00014240: 6f72 2069 7465 6d20 696e 2064 6174 613a  or item in data:
-00014250: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00014260: 2020 6472 6f70 5f6e 6f64 652e 6472 6f70    drop_node.drop
-00014270: 2869 7465 6d29 0d0a 2020 2020 2020 2020  (item)..        
-00014280: 2020 2020 2020 2020 7369 676e 616c 5f6e          signal_n
-00014290: 6565 6465 6420 3d20 5472 7565 0d0a 0d0a  eeded = True....
-000142a0: 2020 2020 4074 7265 655f 636f 6e64 6974      @tree_condit
-000142b0: 696f 6e61 6c28 6c61 6d62 6461 206e 6f64  ional(lambda nod
-000142c0: 653a 206e 6f74 2069 735f 7265 676d 6172  e: not is_regmar
-000142d0: 6b28 6e6f 6465 2929 0d0a 2020 2020 4074  k(node))..    @t
-000142e0: 7265 655f 7365 7061 7261 746f 725f 6265  ree_separator_be
-000142f0: 666f 7265 2829 0d0a 2020 2020 4074 7265  fore()..    @tre
-00014300: 655f 6f70 6572 6174 696f 6e28 5f28 224d  e_operation(_("M
-00014310: 6f76 6520 746f 2072 6567 6d61 726b 7322  ove to regmarks"
-00014320: 292c 206e 6f64 655f 7479 7065 3d65 6c65  ), node_type=ele
-00014330: 6d5f 6772 6f75 705f 6e6f 6465 732c 2068  m_group_nodes, h
-00014340: 656c 703d 2222 290d 0a20 2020 2064 6566  elp="")..    def
-00014350: 206d 6f76 655f 746f 5f72 6567 6d61 726b   move_to_regmark
-00014360: 286e 6f64 652c 202a 2a6b 7761 7267 7329  (node, **kwargs)
-00014370: 3a0d 0a20 2020 2020 2020 2023 2044 7261  :..        # Dra
-00014380: 6720 616e 6420 4472 6f70 0d0a 2020 2020  g and Drop..    
-00014390: 2020 2020 7769 7468 2073 656c 662e 7374      with self.st
-000143a0: 6174 6963 2822 6d6f 7665 5f74 6f5f 7265  atic("move_to_re
-000143b0: 6722 293a 0d0a 2020 2020 2020 2020 2020  g"):..          
-000143c0: 2020 6472 6f70 5f6e 6f64 6520 3d20 7365    drop_node = se
-000143d0: 6c66 2e72 6567 5f62 7261 6e63 680d 0a20  lf.reg_branch.. 
-000143e0: 2020 2020 2020 2020 2020 2064 6174 6120             data 
-000143f0: 3d20 6c69 7374 2829 0d0a 2020 2020 2020  = list()..      
-00014400: 2020 2020 2020 666f 7220 6974 656d 2069        for item i
-00014410: 6e20 6c69 7374 2873 656c 662e 656c 656d  n list(self.elem
-00014420: 735f 6e6f 6465 7328 2929 3a0d 0a20 2020  s_nodes()):..   
-00014430: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00014440: 6974 656d 2e73 656c 6563 7465 643a 0d0a  item.selected:..
-00014450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014460: 2020 2020 6461 7461 2e61 7070 656e 6428      data.append(
-00014470: 6974 656d 290d 0a20 2020 2020 2020 2020  item)..         
-00014480: 2020 2066 6f72 2069 7465 6d20 696e 2064     for item in d
-00014490: 6174 613a 0d0a 2020 2020 2020 2020 2020  ata:..          
-000144a0: 2020 2020 2020 2320 4e6f 2075 7365 6361        # No useca
-000144b0: 7365 2066 6f72 2068 6176 696e 6720 6120  se for having a 
-000144c0: 6c6f 636b 6564 2072 6567 6d61 726b 2065  locked regmark e
-000144d0: 6c65 6d65 6e74 0d0a 2020 2020 2020 2020  lement..        
-000144e0: 2020 2020 2020 2020 6966 2068 6173 6174          if hasat
-000144f0: 7472 2869 7465 6d2c 2022 6c6f 636b 2229  tr(item, "lock")
-00014500: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00014510: 2020 2020 2020 2069 7465 6d2e 6c6f 636b         item.lock
-00014520: 203d 2046 616c 7365 0d0a 2020 2020 2020   = False..      
-00014530: 2020 2020 2020 2020 2020 6472 6f70 5f6e            drop_n
-00014540: 6f64 652e 6472 6f70 2869 7465 6d29 0d0a  ode.drop(item)..
-00014550: 0d0a 2020 2020 2320 4074 7265 655f 636f  ..    # @tree_co
-00014560: 6e64 6974 696f 6e61 6c28 6c61 6d62 6461  nditional(lambda
-00014570: 206e 6f64 653a 206e 6f74 206e 6f64 652e   node: not node.
-00014580: 6c6f 636b 290d 0a20 2020 2023 2040 7472  lock)..    # @tr
-00014590: 6565 5f63 6f6e 6469 7469 6f6e 616c 5f74  ee_conditional_t
-000145a0: 7279 286c 616d 6264 6120 6e6f 6465 3a20  ry(lambda node: 
-000145b0: 6e6f 7420 6e6f 6465 2e6c 6f63 6b29 0d0a  not node.lock)..
-000145c0: 2020 2020 2320 4074 7265 655f 6f70 6572      # @tree_oper
-000145d0: 6174 696f 6e28 5f28 2241 6374 7561 6c69  ation(_("Actuali
-000145e0: 7a65 2070 6978 656c 7322 292c 206e 6f64  ze pixels"), nod
-000145f0: 655f 7479 7065 3d22 656c 656d 2069 6d61  e_type="elem ima
-00014600: 6765 222c 2068 656c 703d 2222 290d 0a20  ge", help="").. 
-00014610: 2020 2023 2064 6566 2069 6d61 6765 5f61     # def image_a
-00014620: 6374 7561 6c69 7a65 5f70 6978 656c 7328  ctualize_pixels(
-00014630: 6e6f 6465 2c20 2a2a 6b77 6172 6773 293a  node, **kwargs):
-00014640: 0d0a 2020 2020 2320 2020 2020 7365 6c66  ..    #     self
-00014650: 2822 696d 6167 6520 7265 7361 6d70 6c65  ("image resample
-00014660: 5c6e 2229 0d0a 0d0a 2020 2020 4074 7265  \n")....    @tre
-00014670: 655f 636f 6e64 6974 696f 6e61 6c28 6c61  e_conditional(la
-00014680: 6d62 6461 206e 6f64 653a 206e 6f74 206e  mbda node: not n
-00014690: 6f64 652e 6c6f 636b 290d 0a20 2020 2040  ode.lock)..    @
-000146a0: 7472 6565 5f73 7562 6d65 6e75 285f 2822  tree_submenu(_("
-000146b0: 5a2d 6465 7074 6820 6469 7669 6465 2229  Z-depth divide")
-000146c0: 290d 0a20 2020 2040 7472 6565 5f69 7465  )..    @tree_ite
-000146d0: 7261 7465 2822 6469 7669 6465 222c 2032  rate("divide", 2
-000146e0: 2c20 3130 290d 0a20 2020 2040 7472 6565  , 10)..    @tree
-000146f0: 5f6f 7065 7261 7469 6f6e 285f 2822 4469  _operation(_("Di
-00014700: 7669 6465 2069 6e74 6f20 7b64 6976 6964  vide into {divid
-00014710: 657d 2069 6d61 6765 7322 292c 206e 6f64  e} images"), nod
-00014720: 655f 7479 7065 3d22 656c 656d 2069 6d61  e_type="elem ima
-00014730: 6765 222c 2068 656c 703d 2222 290d 0a20  ge", help="").. 
-00014740: 2020 2064 6566 2069 6d61 6765 5f7a 6465     def image_zde
-00014750: 7074 6828 6e6f 6465 2c20 6469 7669 6465  pth(node, divide
-00014760: 3d31 2c20 2a2a 6b77 6172 6773 293a 0d0a  =1, **kwargs):..
-00014770: 2020 2020 2020 2020 6966 206e 6f64 652e          if node.
-00014780: 696d 6167 652e 6d6f 6465 2021 3d20 2252  image.mode != "R
-00014790: 4742 4122 3a0d 0a20 2020 2020 2020 2020  GBA":..         
-000147a0: 2020 206e 6f64 652e 696d 6167 6520 3d20     node.image = 
-000147b0: 6e6f 6465 2e69 6d61 6765 2e63 6f6e 7665  node.image.conve
-000147c0: 7274 2822 5247 4241 2229 0d0a 2020 2020  rt("RGBA")..    
-000147d0: 2020 2020 6261 6e64 203d 2032 3535 202f      band = 255 /
-000147e0: 2064 6976 6964 650d 0a20 2020 2020 2020   divide..       
-000147f0: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
-00014800: 302c 2064 6976 6964 6529 3a0d 0a20 2020  0, divide):..   
-00014810: 2020 2020 2020 2020 2074 6872 6573 686f           thresho
-00014820: 6c64 5f6d 696e 203d 2069 202a 2062 616e  ld_min = i * ban
-00014830: 640d 0a20 2020 2020 2020 2020 2020 2074  d..            t
-00014840: 6872 6573 686f 6c64 5f6d 6178 203d 2074  hreshold_max = t
-00014850: 6872 6573 686f 6c64 5f6d 696e 202b 2062  hreshold_min + b
-00014860: 616e 640d 0a20 2020 2020 2020 2020 2020  and..           
-00014870: 2073 656c 6628 6622 696d 6167 6520 7468   self(f"image th
-00014880: 7265 7368 6f6c 6420 7b74 6872 6573 686f  reshold {thresho
-00014890: 6c64 5f6d 696e 7d20 7b74 6872 6573 686f  ld_min} {thresho
-000148a0: 6c64 5f6d 6178 7d5c 6e22 290d 0a0d 0a20  ld_max}\n").... 
-000148b0: 2020 2040 7472 6565 5f63 6f6e 6469 7469     @tree_conditi
-000148c0: 6f6e 616c 286c 616d 6264 6120 6e6f 6465  onal(lambda node
-000148d0: 3a20 6e6f 6465 2e6c 6f63 6b29 0d0a 2020  : node.lock)..  
-000148e0: 2020 4074 7265 655f 7375 626d 656e 7528    @tree_submenu(
-000148f0: 5f28 2249 6d61 6765 2229 290d 0a20 2020  _("Image"))..   
-00014900: 2040 7472 6565 5f6f 7065 7261 7469 6f6e   @tree_operation
-00014910: 285f 2822 556e 6c6f 636b 206d 616e 6970  (_("Unlock manip
-00014920: 756c 6174 696f 6e73 2229 2c20 6e6f 6465  ulations"), node
-00014930: 5f74 7970 653d 2265 6c65 6d20 696d 6167  _type="elem imag
-00014940: 6522 2c20 6865 6c70 3d22 2229 0d0a 2020  e", help="")..  
-00014950: 2020 6465 6620 696d 6167 655f 756e 6c6f    def image_unlo
-00014960: 636b 5f6d 616e 6970 756c 6174 696f 6e73  ck_manipulations
-00014970: 286e 6f64 652c 202a 2a6b 7761 7267 7329  (node, **kwargs)
-00014980: 3a0d 0a20 2020 2020 2020 2073 656c 6628  :..        self(
-00014990: 2269 6d61 6765 2075 6e6c 6f63 6b5c 6e22  "image unlock\n"
-000149a0: 290d 0a0d 0a20 2020 2040 7472 6565 5f63  )....    @tree_c
-000149b0: 6f6e 6469 7469 6f6e 616c 286c 616d 6264  onditional(lambd
-000149c0: 6120 6e6f 6465 3a20 6e6f 7420 6e6f 6465  a node: not node
-000149d0: 2e6c 6f63 6b29 0d0a 2020 2020 4074 7265  .lock)..    @tre
-000149e0: 655f 7375 626d 656e 7528 5f28 2249 6d61  e_submenu(_("Ima
-000149f0: 6765 2229 290d 0a20 2020 2040 7472 6565  ge"))..    @tree
-00014a00: 5f6f 7065 7261 7469 6f6e 285f 2822 4c6f  _operation(_("Lo
-00014a10: 636b 206d 616e 6970 756c 6174 696f 6e73  ck manipulations
-00014a20: 2229 2c20 6e6f 6465 5f74 7970 653d 2265  "), node_type="e
-00014a30: 6c65 6d20 696d 6167 6522 2c20 6865 6c70  lem image", help
-00014a40: 3d22 2229 0d0a 2020 2020 6465 6620 696d  ="")..    def im
-00014a50: 6167 655f 6c6f 636b 5f6d 616e 6970 756c  age_lock_manipul
-00014a60: 6174 696f 6e73 286e 6f64 652c 202a 2a6b  ations(node, **k
-00014a70: 7761 7267 7329 3a0d 0a20 2020 2020 2020  wargs):..       
-00014a80: 2073 656c 6628 2269 6d61 6765 206c 6f63   self("image loc
-00014a90: 6b5c 6e22 290d 0a0d 0a20 2020 2040 7472  k\n")....    @tr
-00014aa0: 6565 5f63 6f6e 6469 7469 6f6e 616c 286c  ee_conditional(l
-00014ab0: 616d 6264 6120 6e6f 6465 3a20 6e6f 7420  ambda node: not 
-00014ac0: 6e6f 6465 2e6c 6f63 6b29 0d0a 2020 2020  node.lock)..    
-00014ad0: 4074 7265 655f 7375 626d 656e 7528 5f28  @tree_submenu(_(
-00014ae0: 2249 6d61 6765 2229 290d 0a20 2020 2040  "Image"))..    @
-00014af0: 7472 6565 5f6f 7065 7261 7469 6f6e 285f  tree_operation(_
-00014b00: 2822 4469 7468 6572 2074 6f20 3120 6269  ("Dither to 1 bi
-00014b10: 7422 292c 206e 6f64 655f 7479 7065 3d22  t"), node_type="
-00014b20: 656c 656d 2069 6d61 6765 222c 2068 656c  elem image", hel
-00014b30: 703d 2222 290d 0a20 2020 2064 6566 2069  p="")..    def i
-00014b40: 6d61 6765 5f64 6974 6865 7228 6e6f 6465  mage_dither(node
-00014b50: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
-00014b60: 2020 2020 2020 7365 6c66 2822 696d 6167        self("imag
-00014b70: 6520 6469 7468 6572 5c6e 2229 0d0a 0d0a  e dither\n")....
-00014b80: 2020 2020 4074 7265 655f 636f 6e64 6974      @tree_condit
-00014b90: 696f 6e61 6c28 6c61 6d62 6461 206e 6f64  ional(lambda nod
-00014ba0: 653a 206e 6f74 206e 6f64 652e 6c6f 636b  e: not node.lock
-00014bb0: 290d 0a20 2020 2040 7472 6565 5f73 7562  )..    @tree_sub
-00014bc0: 6d65 6e75 285f 2822 496d 6167 6522 2929  menu(_("Image"))
-00014bd0: 0d0a 2020 2020 4074 7265 655f 6f70 6572  ..    @tree_oper
-00014be0: 6174 696f 6e28 5f28 2249 6e76 6572 7420  ation(_("Invert 
-00014bf0: 696d 6167 6522 292c 206e 6f64 655f 7479  image"), node_ty
-00014c00: 7065 3d22 656c 656d 2069 6d61 6765 222c  pe="elem image",
-00014c10: 2068 656c 703d 2222 290d 0a20 2020 2064   help="")..    d
-00014c20: 6566 2069 6d61 6765 5f69 6e76 6572 7428  ef image_invert(
-00014c30: 6e6f 6465 2c20 2a2a 6b77 6172 6773 293a  node, **kwargs):
-00014c40: 0d0a 2020 2020 2020 2020 7365 6c66 2822  ..        self("
-00014c50: 696d 6167 6520 696e 7665 7274 5c6e 2229  image invert\n")
-00014c60: 0d0a 0d0a 2020 2020 4074 7265 655f 636f  ....    @tree_co
-00014c70: 6e64 6974 696f 6e61 6c28 6c61 6d62 6461  nditional(lambda
-00014c80: 206e 6f64 653a 206e 6f74 206e 6f64 652e   node: not node.
-00014c90: 6c6f 636b 290d 0a20 2020 2040 7472 6565  lock)..    @tree
-00014ca0: 5f73 7562 6d65 6e75 285f 2822 496d 6167  _submenu(_("Imag
-00014cb0: 6522 2929 0d0a 2020 2020 4074 7265 655f  e"))..    @tree_
-00014cc0: 6f70 6572 6174 696f 6e28 5f28 224d 6972  operation(_("Mir
-00014cd0: 726f 7220 686f 7269 7a6f 6e74 616c 2229  ror horizontal")
-00014ce0: 2c20 6e6f 6465 5f74 7970 653d 2265 6c65  , node_type="ele
-00014cf0: 6d20 696d 6167 6522 2c20 6865 6c70 3d22  m image", help="
-00014d00: 2229 0d0a 2020 2020 6465 6620 696d 6167  ")..    def imag
-00014d10: 655f 6d69 7272 6f72 286e 6f64 652c 202a  e_mirror(node, *
-00014d20: 2a6b 7761 7267 7329 3a0d 0a20 2020 2020  *kwargs):..     
-00014d30: 2020 2073 656c 6628 2269 6d61 6765 206d     self("image m
-00014d40: 6972 726f 725c 6e22 290d 0a0d 0a20 2020  irror\n")....   
-00014d50: 2040 7472 6565 5f63 6f6e 6469 7469 6f6e   @tree_condition
-00014d60: 616c 286c 616d 6264 6120 6e6f 6465 3a20  al(lambda node: 
-00014d70: 6e6f 7420 6e6f 6465 2e6c 6f63 6b29 0d0a  not node.lock)..
-00014d80: 2020 2020 4074 7265 655f 7375 626d 656e      @tree_submen
-00014d90: 7528 5f28 2249 6d61 6765 2229 290d 0a20  u(_("Image")).. 
-00014da0: 2020 2040 7472 6565 5f6f 7065 7261 7469     @tree_operati
-00014db0: 6f6e 285f 2822 466c 6970 2076 6572 7469  on(_("Flip verti
-00014dc0: 6361 6c22 292c 206e 6f64 655f 7479 7065  cal"), node_type
-00014dd0: 3d22 656c 656d 2069 6d61 6765 222c 2068  ="elem image", h
-00014de0: 656c 703d 2222 290d 0a20 2020 2064 6566  elp="")..    def
-00014df0: 2069 6d61 6765 5f66 6c69 7028 6e6f 6465   image_flip(node
-00014e00: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
-00014e10: 2020 2020 2020 7365 6c66 2822 696d 6167        self("imag
-00014e20: 6520 666c 6970 5c6e 2229 0d0a 0d0a 2020  e flip\n")....  
-00014e30: 2020 4074 7265 655f 636f 6e64 6974 696f    @tree_conditio
-00014e40: 6e61 6c28 6c61 6d62 6461 206e 6f64 653a  nal(lambda node:
-00014e50: 206e 6f74 206e 6f64 652e 6c6f 636b 290d   not node.lock).
-00014e60: 0a20 2020 2040 7472 6565 5f73 7562 6d65  .    @tree_subme
-00014e70: 6e75 285f 2822 496d 6167 6522 2929 0d0a  nu(_("Image"))..
-00014e80: 2020 2020 4074 7265 655f 6f70 6572 6174      @tree_operat
-00014e90: 696f 6e28 5f28 2252 6f74 6174 6520 3930  ion(_("Rotate 90
-00014ea0: c2b0 2043 5722 292c 206e 6f64 655f 7479  .. CW"), node_ty
-00014eb0: 7065 3d22 656c 656d 2069 6d61 6765 222c  pe="elem image",
-00014ec0: 2068 656c 703d 2222 290d 0a20 2020 2064   help="")..    d
-00014ed0: 6566 2069 6d61 6765 5f63 7728 6e6f 6465  ef image_cw(node
-00014ee0: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
-00014ef0: 2020 2020 2020 7365 6c66 2822 696d 6167        self("imag
-00014f00: 6520 6377 5c6e 2229 0d0a 0d0a 2020 2020  e cw\n")....    
-00014f10: 4074 7265 655f 636f 6e64 6974 696f 6e61  @tree_conditiona
-00014f20: 6c28 6c61 6d62 6461 206e 6f64 653a 206e  l(lambda node: n
-00014f30: 6f74 206e 6f64 652e 6c6f 636b 290d 0a20  ot node.lock).. 
-00014f40: 2020 2040 7472 6565 5f73 7562 6d65 6e75     @tree_submenu
-00014f50: 285f 2822 496d 6167 6522 2929 0d0a 2020  (_("Image"))..  
-00014f60: 2020 4074 7265 655f 6f70 6572 6174 696f    @tree_operatio
-00014f70: 6e28 5f28 2252 6f74 6174 6520 3930 c2b0  n(_("Rotate 90..
-00014f80: 2043 4357 2229 2c20 6e6f 6465 5f74 7970   CCW"), node_typ
-00014f90: 653d 2265 6c65 6d20 696d 6167 6522 2c20  e="elem image", 
-00014fa0: 6865 6c70 3d22 2229 0d0a 2020 2020 6465  help="")..    de
-00014fb0: 6620 696d 6167 655f 6363 7728 6e6f 6465  f image_ccw(node
-00014fc0: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
-00014fd0: 2020 2020 2020 7365 6c66 2822 696d 6167        self("imag
-00014fe0: 6520 6363 775c 6e22 290d 0a0d 0a20 2020  e ccw\n")....   
-00014ff0: 2040 7472 6565 5f73 7562 6d65 6e75 285f   @tree_submenu(_
-00015000: 2822 496d 6167 6522 2929 0d0a 2020 2020  ("Image"))..    
-00015010: 4074 7265 655f 6f70 6572 6174 696f 6e28  @tree_operation(
-00015020: 0d0a 2020 2020 2020 2020 5f28 2253 6176  ..        _("Sav
-00015030: 6520 6f72 6967 696e 616c 2069 6d61 6765  e original image
-00015040: 2074 6f20 6f75 7470 7574 2e70 6e67 2229   to output.png")
-00015050: 2c20 6e6f 6465 5f74 7970 653d 2265 6c65  , node_type="ele
-00015060: 6d20 696d 6167 6522 2c20 6865 6c70 3d22  m image", help="
-00015070: 220d 0a20 2020 2029 0d0a 2020 2020 6465  "..    )..    de
-00015080: 6620 696d 6167 655f 7361 7665 286e 6f64  f image_save(nod
-00015090: 652c 202a 2a6b 7761 7267 7329 3a0d 0a20  e, **kwargs):.. 
-000150a0: 2020 2020 2020 2073 656c 6628 2269 6d61         self("ima
-000150b0: 6765 2073 6176 6520 6f75 7470 7574 2e70  ge save output.p
-000150c0: 6e67 5c6e 2229 0d0a 0d0a 2020 2020 4074  ng\n")....    @t
-000150d0: 7265 655f 7375 626d 656e 7528 5f28 2249  ree_submenu(_("I
-000150e0: 6d61 6765 2229 290d 0a20 2020 2040 7472  mage"))..    @tr
-000150f0: 6565 5f6f 7065 7261 7469 6f6e 280d 0a20  ee_operation(.. 
-00015100: 2020 2020 2020 205f 2822 5361 7665 2070         _("Save p
-00015110: 726f 6365 7373 6564 2069 6d61 6765 2074  rocessed image t
-00015120: 6f20 6f75 7470 7574 2e70 6e67 2229 2c20  o output.png"), 
-00015130: 6e6f 6465 5f74 7970 653d 2265 6c65 6d20  node_type="elem 
-00015140: 696d 6167 6522 2c20 6865 6c70 3d22 220d  image", help="".
-00015150: 0a20 2020 2029 0d0a 2020 2020 6465 6620  .    )..    def 
-00015160: 696d 6167 655f 7361 7665 5f70 726f 6365  image_save_proce
-00015170: 7373 6564 286e 6f64 652c 202a 2a6b 7761  ssed(node, **kwa
-00015180: 7267 7329 3a0d 0a20 2020 2020 2020 2073  rgs):..        s
-00015190: 656c 6628 2269 6d61 6765 2073 6176 6520  elf("image save 
-000151a0: 6f75 7470 7574 2e70 6e67 202d 2d70 726f  output.png --pro
-000151b0: 6365 7373 6564 5c6e 2229 0d0a 0d0a 2020  cessed\n")....  
-000151c0: 2020 4074 7265 655f 636f 6e64 6974 696f    @tree_conditio
-000151d0: 6e61 6c28 6c61 6d62 6461 206e 6f64 653a  nal(lambda node:
-000151e0: 206c 656e 286e 6f64 652e 6368 696c 6472   len(node.childr
-000151f0: 656e 2920 3e20 3029 0d0a 2020 2020 4074  en) > 0)..    @t
-00015200: 7265 655f 7365 7061 7261 746f 725f 6265  ree_separator_be
-00015210: 666f 7265 2829 0d0a 2020 2020 4074 7265  fore()..    @tre
-00015220: 655f 6f70 6572 6174 696f 6e28 0d0a 2020  e_operation(..  
-00015230: 2020 2020 2020 5f28 2245 7870 616e 6420        _("Expand 
-00015240: 616c 6c20 6368 696c 6472 656e 2229 2c0d  all children"),.
-00015250: 0a20 2020 2020 2020 206e 6f64 655f 7479  .        node_ty
-00015260: 7065 3d28 0d0a 2020 2020 2020 2020 2020  pe=(..          
-00015270: 2020 226f 7020 6375 7422 2c0d 0a20 2020    "op cut",..   
-00015280: 2020 2020 2020 2020 2022 6f70 2072 6173           "op ras
-00015290: 7465 7222 2c0d 0a20 2020 2020 2020 2020  ter",..         
-000152a0: 2020 2022 6f70 2069 6d61 6765 222c 0d0a     "op image",..
-000152b0: 2020 2020 2020 2020 2020 2020 226f 7020              "op 
-000152c0: 656e 6772 6176 6522 2c0d 0a20 2020 2020  engrave",..     
-000152d0: 2020 2020 2020 2022 6f70 2064 6f74 7322         "op dots"
-000152e0: 2c0d 0a20 2020 2020 2020 2020 2020 2022  ,..            "
-000152f0: 6f70 2068 6174 6368 222c 0d0a 2020 2020  op hatch",..    
-00015300: 2020 2020 2020 2020 2262 7261 6e63 6820          "branch 
-00015310: 656c 656d 7322 2c0d 0a20 2020 2020 2020  elems",..       
-00015320: 2020 2020 2022 6272 616e 6368 206f 7073       "branch ops
-00015330: 222c 0d0a 2020 2020 2020 2020 2020 2020  ",..            
-00015340: 2262 7261 6e63 6820 7265 6722 2c0d 0a20  "branch reg",.. 
-00015350: 2020 2020 2020 2020 2020 2022 6772 6f75             "grou
-00015360: 7022 2c0d 0a20 2020 2020 2020 2020 2020  p",..           
-00015370: 2022 6669 6c65 222c 0d0a 2020 2020 2020   "file",..      
-00015380: 2020 2020 2020 2272 6f6f 7422 2c0d 0a20        "root",.. 
-00015390: 2020 2020 2020 2029 2c0d 0a20 2020 2020         ),..     
-000153a0: 2020 2068 656c 703d 5f28 2245 7870 616e     help=_("Expan
-000153b0: 6420 616c 6c20 6368 696c 6472 656e 206f  d all children o
-000153c0: 6620 7468 6973 2067 6976 656e 206e 6f64  f this given nod
-000153d0: 652e 2229 2c0d 0a20 2020 2029 0d0a 2020  e."),..    )..  
-000153e0: 2020 6465 6620 6578 7061 6e64 5f61 6c6c    def expand_all
-000153f0: 5f63 6869 6c64 7265 6e28 6e6f 6465 2c20  _children(node, 
-00015400: 2a2a 6b77 6172 6773 293a 0d0a 2020 2020  **kwargs):..    
-00015410: 2020 2020 6e6f 6465 2e6e 6f74 6966 795f      node.notify_
-00015420: 6578 7061 6e64 2829 0d0a 0d0a 2020 2020  expand()....    
-00015430: 4074 7265 655f 636f 6e64 6974 696f 6e61  @tree_conditiona
-00015440: 6c28 6c61 6d62 6461 206e 6f64 653a 206c  l(lambda node: l
-00015450: 656e 286e 6f64 652e 6368 696c 6472 656e  en(node.children
-00015460: 2920 3e20 3029 0d0a 2020 2020 4074 7265  ) > 0)..    @tre
-00015470: 655f 6f70 6572 6174 696f 6e28 0d0a 2020  e_operation(..  
-00015480: 2020 2020 2020 5f28 2243 6f6c 6c61 7073        _("Collaps
-00015490: 6520 616c 6c20 6368 696c 6472 656e 2229  e all children")
-000154a0: 2c0d 0a20 2020 2020 2020 206e 6f64 655f  ,..        node_
-000154b0: 7479 7065 3d28 0d0a 2020 2020 2020 2020  type=(..        
-000154c0: 2020 2020 226f 7020 6375 7422 2c0d 0a20      "op cut",.. 
-000154d0: 2020 2020 2020 2020 2020 2022 6f70 2072             "op r
-000154e0: 6173 7465 7222 2c0d 0a20 2020 2020 2020  aster",..       
-000154f0: 2020 2020 2022 6f70 2069 6d61 6765 222c       "op image",
-00015500: 0d0a 2020 2020 2020 2020 2020 2020 226f  ..            "o
-00015510: 7020 656e 6772 6176 6522 2c0d 0a20 2020  p engrave",..   
-00015520: 2020 2020 2020 2020 2022 6f70 2064 6f74           "op dot
-00015530: 7322 2c0d 0a20 2020 2020 2020 2020 2020  s",..           
-00015540: 2022 6f70 2068 6174 6368 222c 0d0a 2020   "op hatch",..  
-00015550: 2020 2020 2020 2020 2020 2262 7261 6e63            "branc
-00015560: 6820 656c 656d 7322 2c0d 0a20 2020 2020  h elems",..     
-00015570: 2020 2020 2020 2022 6272 616e 6368 206f         "branch o
-00015580: 7073 222c 0d0a 2020 2020 2020 2020 2020  ps",..          
-00015590: 2020 2262 7261 6e63 6820 7265 6722 2c0d    "branch reg",.
-000155a0: 0a20 2020 2020 2020 2020 2020 2022 6772  .            "gr
-000155b0: 6f75 7022 2c0d 0a20 2020 2020 2020 2020  oup",..         
-000155c0: 2020 2022 6669 6c65 222c 0d0a 2020 2020     "file",..    
-000155d0: 2020 2020 2020 2020 2272 6f6f 7422 2c0d          "root",.
-000155e0: 0a20 2020 2020 2020 2029 2c0d 0a20 2020  .        ),..   
-000155f0: 2020 2020 2068 656c 703d 5f28 2243 6f6c       help=_("Col
-00015600: 6c61 7073 6520 616c 6c20 6368 696c 6472  lapse all childr
-00015610: 656e 206f 6620 7468 6973 2067 6976 656e  en of this given
-00015620: 206e 6f64 652e 2229 2c0d 0a20 2020 2029   node."),..    )
-00015630: 0d0a 2020 2020 6465 6620 636f 6c6c 6170  ..    def collap
-00015640: 7365 5f61 6c6c 5f63 6869 6c64 7265 6e28  se_all_children(
-00015650: 6e6f 6465 2c20 2a2a 6b77 6172 6773 293a  node, **kwargs):
-00015660: 0d0a 2020 2020 2020 2020 6e6f 6465 2e6e  ..        node.n
-00015670: 6f74 6966 795f 636f 6c6c 6170 7365 2829  otify_collapse()
-00015680: 0d0a                                     ..
+000021c0: 2020 2020 2020 2020 6e65 7766 6c61 6720          newflag 
+000021d0: 3d20 626f 6f6c 286e 6f74 206e 2e69 735f  = bool(not n.is_
+000021e0: 7669 7369 626c 6529 0d0a 2020 2020 2020  visible)..      
+000021f0: 2020 2020 2020 2020 2020 6e2e 6973 5f76            n.is_v
+00002200: 6973 6962 6c65 203d 206e 6577 666c 6167  isible = newflag
+00002210: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00002220: 2020 6e2e 7570 6461 7465 6428 290d 0a20    n.updated().. 
+00002230: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00002240: 6861 6e67 6573 2e61 7070 656e 6428 6e29  hanges.append(n)
+00002250: 0d0a 2020 2020 2020 2020 6966 206c 656e  ..        if len
+00002260: 2863 6861 6e67 6573 2920 3e20 303a 0d0a  (changes) > 0:..
+00002270: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00002280: 2e76 616c 6964 6174 655f 7365 6c65 6374  .validate_select
+00002290: 6564 5f61 7265 6128 290d 0a20 2020 2020  ed_area()..     
+000022a0: 2020 2020 2020 2073 656c 662e 7369 676e         self.sign
+000022b0: 616c 2822 656c 656d 656e 745f 7072 6f70  al("element_prop
+000022c0: 6572 7479 5f75 7064 6174 6522 2c20 6368  erty_update", ch
+000022d0: 616e 6765 7329 0d0a 2020 2020 2020 2020  anges)..        
+000022e0: 2020 2020 7365 6c66 2e73 6967 6e61 6c28      self.signal(
+000022f0: 2272 6566 7265 7368 5f73 6365 6e65 222c  "refresh_scene",
+00002300: 2022 5363 656e 6522 290d 0a0d 0a20 2020   "Scene")....   
+00002310: 2040 7472 6565 5f63 6f6e 6469 7469 6f6e   @tree_condition
+00002320: 616c 286c 616d 6264 6120 6e6f 6465 3a20  al(lambda node: 
+00002330: 6861 7361 7474 7228 6e6f 6465 2c20 226f  hasattr(node, "o
+00002340: 7574 7075 7422 2929 0d0a 2020 2020 4074  utput"))..    @t
+00002350: 7265 655f 6f70 6572 6174 696f 6e28 0d0a  ree_operation(..
+00002360: 2020 2020 2020 2020 5f28 2245 6e61 626c          _("Enabl
+00002370: 6520 7369 6d69 6c61 7222 292c 0d0a 2020  e similar"),..  
+00002380: 2020 2020 2020 6e6f 6465 5f74 7970 653d        node_type=
+00002390: 6f70 5f6e 6f64 6573 2c0d 0a20 2020 2020  op_nodes,..     
+000023a0: 2020 2068 656c 703d 5f28 2245 6e61 626c     help=_("Enabl
+000023b0: 6520 616c 6c20 6f70 6572 6174 696f 6e73  e all operations
+000023c0: 206f 6620 7468 6973 2074 7970 6522 292c   of this type"),
+000023d0: 0d0a 2020 2020 290d 0a20 2020 2064 6566  ..    )..    def
+000023e0: 206f 7073 5f65 6e61 626c 655f 7369 6d69   ops_enable_simi
+000023f0: 6c61 7228 6e6f 6465 2c20 2a2a 6b77 6172  lar(node, **kwar
+00002400: 6773 293a 0d0a 2020 2020 2020 2020 6f70  gs):..        op
+00002410: 6c69 7374 203d 205b 5d0d 0a20 2020 2020  list = []..     
+00002420: 2020 2066 6f72 206e 2069 6e20 7365 6c66     for n in self
+00002430: 2e6f 7073 2829 3a0d 0a20 2020 2020 2020  .ops():..       
+00002440: 2020 2020 2069 6620 6e2e 7479 7065 203d       if n.type =
+00002450: 3d20 6e6f 6465 2e74 7970 653a 0d0a 2020  = node.type:..  
+00002460: 2020 2020 2020 2020 2020 2020 2020 6f70                op
+00002470: 6c69 7374 2e61 7070 656e 6428 6e29 0d0a  list.append(n)..
+00002480: 2020 2020 2020 2020 7365 745f 6f70 5f6f          set_op_o
+00002490: 7574 7075 7428 6f70 6c69 7374 2c20 5472  utput(oplist, Tr
+000024a0: 7565 290d 0a0d 0a20 2020 2040 7472 6565  ue)....    @tree
+000024b0: 5f63 6f6e 6469 7469 6f6e 616c 286c 616d  _conditional(lam
+000024c0: 6264 6120 6e6f 6465 3a20 6861 7361 7474  bda node: hasatt
+000024d0: 7228 6e6f 6465 2c20 226f 7574 7075 7422  r(node, "output"
+000024e0: 2929 0d0a 2020 2020 4074 7265 655f 7365  ))..    @tree_se
+000024f0: 7061 7261 746f 725f 6166 7465 7228 290d  parator_after().
+00002500: 0a20 2020 2040 7472 6565 5f6f 7065 7261  .    @tree_opera
+00002510: 7469 6f6e 280d 0a20 2020 2020 2020 205f  tion(..        _
+00002520: 2822 4469 7361 626c 6520 7369 6d69 6c61  ("Disable simila
+00002530: 7222 292c 0d0a 2020 2020 2020 2020 6e6f  r"),..        no
+00002540: 6465 5f74 7970 653d 6f70 5f6e 6f64 6573  de_type=op_nodes
+00002550: 2c0d 0a20 2020 2020 2020 2068 656c 703d  ,..        help=
+00002560: 5f28 2244 6973 6162 6c65 2061 6c6c 206f  _("Disable all o
+00002570: 7065 7261 7469 6f6e 7320 6f66 2074 6869  perations of thi
+00002580: 7320 7479 7065 2229 2c0d 0a20 2020 2029  s type"),..    )
+00002590: 0d0a 2020 2020 6465 6620 6f70 735f 6469  ..    def ops_di
+000025a0: 7361 626c 655f 7369 6d69 6c61 7228 6e6f  sable_similar(no
+000025b0: 6465 2c20 2a2a 6b77 6172 6773 293a 0d0a  de, **kwargs):..
+000025c0: 2020 2020 2020 2020 6f70 6c69 7374 203d          oplist =
+000025d0: 205b 5d0d 0a20 2020 2020 2020 2066 6f72   []..        for
+000025e0: 206e 2069 6e20 7365 6c66 2e6f 7073 2829   n in self.ops()
+000025f0: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
+00002600: 6620 6e2e 7479 7065 203d 3d20 6e6f 6465  f n.type == node
+00002610: 2e74 7970 653a 0d0a 2020 2020 2020 2020  .type:..        
+00002620: 2020 2020 2020 2020 6f70 6c69 7374 2e61          oplist.a
+00002630: 7070 656e 6428 6e29 0d0a 2020 2020 2020  ppend(n)..      
+00002640: 2020 7365 745f 6f70 5f6f 7574 7075 7428    set_op_output(
+00002650: 6f70 6c69 7374 2c20 4661 6c73 6529 0d0a  oplist, False)..
+00002660: 0d0a 2020 2020 4074 7265 655f 7375 626d  ..    @tree_subm
+00002670: 656e 7528 5f28 2243 6f6e 7665 7274 206f  enu(_("Convert o
+00002680: 7065 7261 7469 6f6e 2229 290d 0a20 2020  peration"))..   
+00002690: 2040 7472 6565 5f6f 7065 7261 7469 6f6e   @tree_operation
+000026a0: 285f 2822 436f 6e76 6572 7420 746f 2049  (_("Convert to I
+000026b0: 6d61 6765 2229 2c20 6e6f 6465 5f74 7970  mage"), node_typ
+000026c0: 653d 6f70 5f70 6172 656e 745f 6e6f 6465  e=op_parent_node
+000026d0: 732c 2068 656c 703d 2222 290d 0a20 2020  s, help="")..   
+000026e0: 2064 6566 2063 6f6e 7665 7274 5f6f 7065   def convert_ope
+000026f0: 7261 7469 6f6e 5f69 6d61 6765 286e 6f64  ration_image(nod
+00002700: 652c 202a 2a6b 7761 7267 7329 3a0d 0a20  e, **kwargs):.. 
+00002710: 2020 2020 2020 2066 6f72 206e 2069 6e20         for n in 
+00002720: 6c69 7374 2873 656c 662e 6f70 7328 7365  list(self.ops(se
+00002730: 6c65 6374 6564 3d54 7275 6529 293a 0d0a  lected=True)):..
+00002740: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
+00002750: 7365 7474 696e 6773 203d 2064 6963 7428  settings = dict(
+00002760: 6e2e 7365 7474 696e 6773 290d 0a20 2020  n.settings)..   
+00002770: 2020 2020 2020 2020 206e 6577 5f73 6574           new_set
+00002780: 7469 6e67 735b 2274 7970 6522 5d20 3d20  tings["type"] = 
+00002790: 226f 7020 696d 6167 6522 0d0a 2020 2020  "op image"..    
+000027a0: 2020 2020 2020 2020 6e2e 7265 706c 6163          n.replac
+000027b0: 655f 6e6f 6465 286b 6565 705f 6368 696c  e_node(keep_chil
+000027c0: 6472 656e 3d54 7275 652c 202a 2a6e 6577  dren=True, **new
+000027d0: 5f73 6574 7469 6e67 7329 0d0a 2020 2020  _settings)..    
+000027e0: 2020 2020 7365 6c66 2e73 6967 6e61 6c28      self.signal(
+000027f0: 2272 6562 7569 6c64 5f74 7265 6522 290d  "rebuild_tree").
+00002800: 0a0d 0a20 2020 2040 7472 6565 5f73 7562  ...    @tree_sub
+00002810: 6d65 6e75 285f 2822 436f 6e76 6572 7420  menu(_("Convert 
+00002820: 6f70 6572 6174 696f 6e22 2929 0d0a 2020  operation"))..  
+00002830: 2020 4074 7265 655f 6f70 6572 6174 696f    @tree_operatio
+00002840: 6e28 5f28 2243 6f6e 7665 7274 2074 6f20  n(_("Convert to 
+00002850: 5261 7374 6572 2229 2c20 6e6f 6465 5f74  Raster"), node_t
+00002860: 7970 653d 6f70 5f70 6172 656e 745f 6e6f  ype=op_parent_no
+00002870: 6465 732c 2068 656c 703d 2222 290d 0a20  des, help="").. 
+00002880: 2020 2064 6566 2063 6f6e 7665 7274 5f6f     def convert_o
+00002890: 7065 7261 7469 6f6e 5f72 6173 7465 7228  peration_raster(
+000028a0: 6e6f 6465 2c20 2a2a 6b77 6172 6773 293a  node, **kwargs):
+000028b0: 0d0a 2020 2020 2020 2020 666f 7220 6e20  ..        for n 
+000028c0: 696e 206c 6973 7428 7365 6c66 2e6f 7073  in list(self.ops
+000028d0: 2873 656c 6563 7465 643d 5472 7565 2929  (selected=True))
+000028e0: 3a0d 0a20 2020 2020 2020 2020 2020 206e  :..            n
+000028f0: 6577 5f73 6574 7469 6e67 7320 3d20 6469  ew_settings = di
+00002900: 6374 286e 2e73 6574 7469 6e67 7329 0d0a  ct(n.settings)..
+00002910: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
+00002920: 7365 7474 696e 6773 5b22 7479 7065 225d  settings["type"]
+00002930: 203d 2022 6f70 2072 6173 7465 7222 0d0a   = "op raster"..
+00002940: 2020 2020 2020 2020 2020 2020 6e2e 7265              n.re
+00002950: 706c 6163 655f 6e6f 6465 286b 6565 705f  place_node(keep_
+00002960: 6368 696c 6472 656e 3d54 7275 652c 202a  children=True, *
+00002970: 2a6e 6577 5f73 6574 7469 6e67 7329 0d0a  *new_settings)..
+00002980: 2020 2020 2020 2020 7365 6c66 2e73 6967          self.sig
+00002990: 6e61 6c28 2272 6562 7569 6c64 5f74 7265  nal("rebuild_tre
+000029a0: 6522 290d 0a0d 0a20 2020 2040 7472 6565  e")....    @tree
+000029b0: 5f73 7562 6d65 6e75 285f 2822 436f 6e76  _submenu(_("Conv
+000029c0: 6572 7420 6f70 6572 6174 696f 6e22 2929  ert operation"))
+000029d0: 0d0a 2020 2020 4074 7265 655f 6f70 6572  ..    @tree_oper
+000029e0: 6174 696f 6e28 5f28 2243 6f6e 7665 7274  ation(_("Convert
+000029f0: 2074 6f20 456e 6772 6176 6522 292c 206e   to Engrave"), n
+00002a00: 6f64 655f 7479 7065 3d6f 705f 7061 7265  ode_type=op_pare
+00002a10: 6e74 5f6e 6f64 6573 2c20 6865 6c70 3d22  nt_nodes, help="
+00002a20: 2229 0d0a 2020 2020 6465 6620 636f 6e76  ")..    def conv
+00002a30: 6572 745f 6f70 6572 6174 696f 6e5f 656e  ert_operation_en
+00002a40: 6772 6176 6528 6e6f 6465 2c20 2a2a 6b77  grave(node, **kw
+00002a50: 6172 6773 293a 0d0a 2020 2020 2020 2020  args):..        
+00002a60: 666f 7220 6e20 696e 206c 6973 7428 7365  for n in list(se
+00002a70: 6c66 2e6f 7073 2873 656c 6563 7465 643d  lf.ops(selected=
+00002a80: 5472 7565 2929 3a0d 0a20 2020 2020 2020  True)):..       
+00002a90: 2020 2020 206e 6577 5f73 6574 7469 6e67       new_setting
+00002aa0: 7320 3d20 6469 6374 286e 2e73 6574 7469  s = dict(n.setti
+00002ab0: 6e67 7329 0d0a 2020 2020 2020 2020 2020  ngs)..          
+00002ac0: 2020 6e65 775f 7365 7474 696e 6773 5b22    new_settings["
+00002ad0: 7479 7065 225d 203d 2022 6f70 2065 6e67  type"] = "op eng
+00002ae0: 7261 7665 220d 0a20 2020 2020 2020 2020  rave"..         
+00002af0: 2020 206e 2e72 6570 6c61 6365 5f6e 6f64     n.replace_nod
+00002b00: 6528 6b65 6570 5f63 6869 6c64 7265 6e3d  e(keep_children=
+00002b10: 5472 7565 2c20 2a2a 6e65 775f 7365 7474  True, **new_sett
+00002b20: 696e 6773 290d 0a20 2020 2020 2020 2073  ings)..        s
+00002b30: 656c 662e 7369 676e 616c 2822 7265 6275  elf.signal("rebu
+00002b40: 696c 645f 7472 6565 2229 0d0a 0d0a 2020  ild_tree")....  
+00002b50: 2020 4074 7265 655f 7375 626d 656e 7528    @tree_submenu(
+00002b60: 5f28 2243 6f6e 7665 7274 206f 7065 7261  _("Convert opera
+00002b70: 7469 6f6e 2229 290d 0a20 2020 2040 7472  tion"))..    @tr
+00002b80: 6565 5f6f 7065 7261 7469 6f6e 285f 2822  ee_operation(_("
+00002b90: 436f 6e76 6572 7420 746f 2043 7574 2229  Convert to Cut")
+00002ba0: 2c20 6e6f 6465 5f74 7970 653d 6f70 5f70  , node_type=op_p
+00002bb0: 6172 656e 745f 6e6f 6465 732c 2068 656c  arent_nodes, hel
+00002bc0: 703d 2222 290d 0a20 2020 2064 6566 2063  p="")..    def c
+00002bd0: 6f6e 7665 7274 5f6f 7065 7261 7469 6f6e  onvert_operation
+00002be0: 5f63 7574 286e 6f64 652c 202a 2a6b 7761  _cut(node, **kwa
+00002bf0: 7267 7329 3a0d 0a20 2020 2020 2020 2066  rgs):..        f
+00002c00: 6f72 206e 2069 6e20 6c69 7374 2873 656c  or n in list(sel
+00002c10: 662e 6f70 7328 7365 6c65 6374 6564 3d54  f.ops(selected=T
+00002c20: 7275 6529 293a 0d0a 2020 2020 2020 2020  rue)):..        
+00002c30: 2020 2020 6e65 775f 7365 7474 696e 6773      new_settings
+00002c40: 203d 2064 6963 7428 6e2e 7365 7474 696e   = dict(n.settin
+00002c50: 6773 290d 0a20 2020 2020 2020 2020 2020  gs)..           
+00002c60: 206e 6577 5f73 6574 7469 6e67 735b 2274   new_settings["t
+00002c70: 7970 6522 5d20 3d20 226f 7020 6375 7422  ype"] = "op cut"
+00002c80: 0d0a 2020 2020 2020 2020 2020 2020 6e2e  ..            n.
+00002c90: 7265 706c 6163 655f 6e6f 6465 286b 6565  replace_node(kee
+00002ca0: 705f 6368 696c 6472 656e 3d54 7275 652c  p_children=True,
+00002cb0: 202a 2a6e 6577 5f73 6574 7469 6e67 7329   **new_settings)
+00002cc0: 0d0a 2020 2020 2020 2020 7365 6c66 2e73  ..        self.s
+00002cd0: 6967 6e61 6c28 2272 6562 7569 6c64 5f74  ignal("rebuild_t
+00002ce0: 7265 6522 290d 0a0d 0a20 2020 2040 7472  ree")....    @tr
+00002cf0: 6565 5f73 7562 6d65 6e75 285f 2822 436f  ee_submenu(_("Co
+00002d00: 6e76 6572 7420 6f70 6572 6174 696f 6e22  nvert operation"
+00002d10: 2929 0d0a 2020 2020 4074 7265 655f 6f70  ))..    @tree_op
+00002d20: 6572 6174 696f 6e28 5f28 2243 6f6e 7665  eration(_("Conve
+00002d30: 7274 2074 6f20 4861 7463 6822 292c 206e  rt to Hatch"), n
+00002d40: 6f64 655f 7479 7065 3d6f 705f 7061 7265  ode_type=op_pare
+00002d50: 6e74 5f6e 6f64 6573 2c20 6865 6c70 3d22  nt_nodes, help="
+00002d60: 2229 0d0a 2020 2020 6465 6620 636f 6e76  ")..    def conv
+00002d70: 6572 745f 6f70 6572 6174 696f 6e5f 6861  ert_operation_ha
+00002d80: 7463 6828 6e6f 6465 2c20 2a2a 6b77 6172  tch(node, **kwar
+00002d90: 6773 293a 0d0a 2020 2020 2020 2020 666f  gs):..        fo
+00002da0: 7220 6e20 696e 206c 6973 7428 7365 6c66  r n in list(self
+00002db0: 2e6f 7073 2873 656c 6563 7465 643d 5472  .ops(selected=Tr
+00002dc0: 7565 2929 3a0d 0a20 2020 2020 2020 2020  ue)):..         
+00002dd0: 2020 206e 6577 5f73 6574 7469 6e67 7320     new_settings 
+00002de0: 3d20 6469 6374 286e 2e73 6574 7469 6e67  = dict(n.setting
+00002df0: 7329 0d0a 2020 2020 2020 2020 2020 2020  s)..            
+00002e00: 6e65 775f 7365 7474 696e 6773 5b22 7479  new_settings["ty
+00002e10: 7065 225d 203d 2022 6f70 2068 6174 6368  pe"] = "op hatch
+00002e20: 220d 0a20 2020 2020 2020 2020 2020 206e  "..            n
+00002e30: 2e72 6570 6c61 6365 5f6e 6f64 6528 6b65  .replace_node(ke
+00002e40: 6570 5f63 6869 6c64 7265 6e3d 5472 7565  ep_children=True
+00002e50: 2c20 2a2a 6e65 775f 7365 7474 696e 6773  , **new_settings
+00002e60: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00002e70: 7369 676e 616c 2822 7265 6275 696c 645f  signal("rebuild_
+00002e80: 7472 6565 2229 0d0a 0d0a 2020 2020 4074  tree")....    @t
+00002e90: 7265 655f 7375 626d 656e 7528 5f28 2243  ree_submenu(_("C
+00002ea0: 6f6e 7665 7274 206f 7065 7261 7469 6f6e  onvert operation
+00002eb0: 2229 290d 0a20 2020 2040 7472 6565 5f6f  "))..    @tree_o
+00002ec0: 7065 7261 7469 6f6e 285f 2822 436f 6e76  peration(_("Conv
+00002ed0: 6572 7420 746f 2044 6f74 7322 292c 206e  ert to Dots"), n
+00002ee0: 6f64 655f 7479 7065 3d6f 705f 7061 7265  ode_type=op_pare
+00002ef0: 6e74 5f6e 6f64 6573 2c20 6865 6c70 3d22  nt_nodes, help="
+00002f00: 2229 0d0a 2020 2020 6465 6620 636f 6e76  ")..    def conv
+00002f10: 6572 745f 6f70 6572 6174 696f 6e5f 646f  ert_operation_do
+00002f20: 7473 286e 6f64 652c 202a 2a6b 7761 7267  ts(node, **kwarg
+00002f30: 7329 3a0d 0a20 2020 2020 2020 2066 6f72  s):..        for
+00002f40: 206e 2069 6e20 6c69 7374 2873 656c 662e   n in list(self.
+00002f50: 6f70 7328 7365 6c65 6374 6564 3d54 7275  ops(selected=Tru
+00002f60: 6529 293a 0d0a 2020 2020 2020 2020 2020  e)):..          
+00002f70: 2020 6e65 775f 7365 7474 696e 6773 203d    new_settings =
+00002f80: 2064 6963 7428 6e2e 7365 7474 696e 6773   dict(n.settings
+00002f90: 290d 0a20 2020 2020 2020 2020 2020 206e  )..            n
+00002fa0: 6577 5f73 6574 7469 6e67 735b 2274 7970  ew_settings["typ
+00002fb0: 6522 5d20 3d20 226f 7020 646f 7473 220d  e"] = "op dots".
+00002fc0: 0a20 2020 2020 2020 2020 2020 206e 2e72  .            n.r
+00002fd0: 6570 6c61 6365 5f6e 6f64 6528 6b65 6570  eplace_node(keep
+00002fe0: 5f63 6869 6c64 7265 6e3d 5472 7565 2c20  _children=True, 
+00002ff0: 2a2a 6e65 775f 7365 7474 696e 6773 290d  **new_settings).
+00003000: 0a20 2020 2020 2020 2073 656c 662e 7369  .        self.si
+00003010: 676e 616c 2822 7265 6275 696c 645f 7472  gnal("rebuild_tr
+00003020: 6565 2229 0d0a 0d0a 2020 2020 4074 7265  ee")....    @tre
+00003030: 655f 7375 626d 656e 7528 5f28 2252 6173  e_submenu(_("Ras
+00003040: 7465 7257 697a 6172 6422 2929 0d0a 2020  terWizard"))..  
+00003050: 2020 4074 7265 655f 6f70 6572 6174 696f    @tree_operatio
+00003060: 6e28 5f28 2253 6574 2074 6f20 4e6f 6e65  n(_("Set to None
+00003070: 2229 2c20 6e6f 6465 5f74 7970 653d 2265  "), node_type="e
+00003080: 6c65 6d20 696d 6167 6522 2c20 6865 6c70  lem image", help
+00003090: 3d22 2229 0d0a 2020 2020 6465 6620 696d  ="")..    def im
+000030a0: 6167 655f 7261 7374 6572 7769 7a61 7264  age_rasterwizard
+000030b0: 5f61 7070 6c79 5f6e 6f6e 6528 6e6f 6465  _apply_none(node
+000030c0: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
+000030d0: 2020 2020 2020 6669 7273 746e 6f64 6520        firstnode 
+000030e0: 3d20 4e6f 6e65 0d0a 2020 2020 2020 2020  = None..        
+000030f0: 666f 7220 6520 696e 206c 6973 7428 7365  for e in list(se
+00003100: 6c66 2e65 6c65 6d73 2865 6d70 6861 7369  lf.elems(emphasi
+00003110: 7a65 643d 5472 7565 2929 3a0d 0a20 2020  zed=True)):..   
+00003120: 2020 2020 2020 2020 2069 6620 652e 7479           if e.ty
+00003130: 7065 2021 3d20 2265 6c65 6d20 696d 6167  pe != "elem imag
+00003140: 6522 3a0d 0a20 2020 2020 2020 2020 2020  e":..           
+00003150: 2020 2020 2063 6f6e 7469 6e75 650d 0a20       continue.. 
+00003160: 2020 2020 2020 2020 2020 2065 2e6f 7065             e.ope
+00003170: 7261 7469 6f6e 7320 3d20 5b5d 0d0a 2020  rations = []..  
+00003180: 2020 2020 2020 2020 2020 652e 7570 6461            e.upda
+00003190: 7465 284e 6f6e 6529 0d0a 2020 2020 2020  te(None)..      
+000031a0: 2020 2020 2020 6966 2066 6972 7374 6e6f        if firstno
+000031b0: 6465 2069 7320 4e6f 6e65 3a0d 0a20 2020  de is None:..   
+000031c0: 2020 2020 2020 2020 2020 2020 2066 6972               fir
+000031d0: 7374 6e6f 6465 203d 2065 0d0a 2020 2020  stnode = e..    
+000031e0: 2020 2020 7365 6c66 2e73 6967 6e61 6c28      self.signal(
+000031f0: 2272 6566 7265 7368 5f73 6365 6e65 222c  "refresh_scene",
+00003200: 2022 5363 656e 6522 290d 0a20 2020 2020   "Scene")..     
+00003210: 2020 2061 6374 6976 6174 6520 3d20 7365     activate = se
+00003220: 6c66 2e6b 6572 6e65 6c2e 6c6f 6f6b 7570  lf.kernel.lookup
+00003230: 2822 6675 6e63 7469 6f6e 2f6f 7065 6e5f  ("function/open_
+00003240: 7072 6f70 6572 7479 5f77 696e 646f 775f  property_window_
+00003250: 666f 725f 6e6f 6465 2229 0d0a 2020 2020  for_node")..    
+00003260: 2020 2020 6966 2061 6374 6976 6174 6520      if activate 
+00003270: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
+00003280: 6669 7273 746e 6f64 6520 6973 206e 6f74  firstnode is not
+00003290: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+000032a0: 2020 2020 6163 7469 7661 7465 2866 6972      activate(fir
+000032b0: 7374 6e6f 6465 290d 0a20 2020 2020 2020  stnode)..       
+000032c0: 2020 2020 2073 656c 662e 7369 676e 616c       self.signal
+000032d0: 2822 7072 6f70 7570 6461 7465 222c 2066  ("propupdate", f
+000032e0: 6972 7374 6e6f 6465 290d 0a0d 0a20 2020  irstnode)....   
+000032f0: 2040 7472 6565 5f73 7562 6d65 6e75 285f   @tree_submenu(_
+00003300: 2822 5261 7374 6572 5769 7a61 7264 2229  ("RasterWizard")
+00003310: 290d 0a20 2020 2040 7472 6565 5f76 616c  )..    @tree_val
+00003320: 7565 7328 2273 6372 6970 7422 2c20 7661  ues("script", va
+00003330: 6c75 6573 3d6c 6973 7428 7365 6c66 2e6d  lues=list(self.m
+00003340: 6174 6368 2822 7261 7374 6572 5f73 6372  atch("raster_scr
+00003350: 6970 7422 2c20 7375 6666 6978 3d54 7275  ipt", suffix=Tru
+00003360: 6529 2929 0d0a 2020 2020 4074 7265 655f  e)))..    @tree_
+00003370: 6f70 6572 6174 696f 6e28 5f28 2241 7070  operation(_("App
+00003380: 6c79 3a20 7b73 6372 6970 747d 2229 2c20  ly: {script}"), 
+00003390: 6e6f 6465 5f74 7970 653d 2265 6c65 6d20  node_type="elem 
+000033a0: 696d 6167 6522 2c20 6865 6c70 3d22 2229  image", help="")
+000033b0: 0d0a 2020 2020 6465 6620 696d 6167 655f  ..    def image_
+000033c0: 7261 7374 6572 7769 7a61 7264 5f61 7070  rasterwizard_app
+000033d0: 6c79 286e 6f64 652c 2073 6372 6970 743d  ly(node, script=
+000033e0: 4e6f 6e65 2c20 2a2a 6b77 6172 6773 293a  None, **kwargs):
+000033f0: 0d0a 2020 2020 2020 2020 7261 7374 6572  ..        raster
+00003400: 5f73 6372 6970 7420 3d20 7365 6c66 2e6c  _script = self.l
+00003410: 6f6f 6b75 7028 6622 7261 7374 6572 5f73  ookup(f"raster_s
+00003420: 6372 6970 742f 7b73 6372 6970 747d 2229  cript/{script}")
+00003430: 0d0a 2020 2020 2020 2020 6669 7273 746e  ..        firstn
+00003440: 6f64 6520 3d20 4e6f 6e65 0d0a 2020 2020  ode = None..    
+00003450: 2020 2020 666f 7220 6520 696e 206c 6973      for e in lis
+00003460: 7428 7365 6c66 2e65 6c65 6d73 2865 6d70  t(self.elems(emp
+00003470: 6861 7369 7a65 643d 5472 7565 2929 3a0d  hasized=True)):.
+00003480: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00003490: 652e 7479 7065 2021 3d20 2265 6c65 6d20  e.type != "elem 
+000034a0: 696d 6167 6522 3a0d 0a20 2020 2020 2020  image":..       
+000034b0: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
+000034c0: 650d 0a20 2020 2020 2020 2020 2020 2065  e..            e
+000034d0: 2e6f 7065 7261 7469 6f6e 7320 3d20 7261  .operations = ra
+000034e0: 7374 6572 5f73 6372 6970 740d 0a20 2020  ster_script..   
+000034f0: 2020 2020 2020 2020 2065 2e75 7064 6174           e.updat
+00003500: 6528 4e6f 6e65 290d 0a20 2020 2020 2020  e(None)..       
+00003510: 2020 2020 2069 6620 6669 7273 746e 6f64       if firstnod
+00003520: 6520 6973 204e 6f6e 653a 0d0a 2020 2020  e is None:..    
+00003530: 2020 2020 2020 2020 2020 2020 6669 7273              firs
+00003540: 746e 6f64 6520 3d20 650d 0a20 2020 2020  tnode = e..     
+00003550: 2020 2073 656c 662e 7369 676e 616c 2822     self.signal("
+00003560: 7265 6672 6573 685f 7363 656e 6522 2c20  refresh_scene", 
+00003570: 2253 6365 6e65 2229 0d0a 2020 2020 2020  "Scene")..      
+00003580: 2020 6163 7469 7661 7465 203d 2073 656c    activate = sel
+00003590: 662e 6b65 726e 656c 2e6c 6f6f 6b75 7028  f.kernel.lookup(
+000035a0: 2266 756e 6374 696f 6e2f 6f70 656e 5f70  "function/open_p
+000035b0: 726f 7065 7274 795f 7769 6e64 6f77 5f66  roperty_window_f
+000035c0: 6f72 5f6e 6f64 6522 290d 0a20 2020 2020  or_node")..     
+000035d0: 2020 2069 6620 6163 7469 7661 7465 2069     if activate i
+000035e0: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
+000035f0: 2020 2020 2020 2020 2061 6374 6976 6174           activat
+00003600: 6528 6e6f 6465 290d 0a20 2020 2020 2020  e(node)..       
+00003610: 2020 2020 2073 656c 662e 7369 676e 616c       self.signal
+00003620: 2822 7072 6f70 7570 6461 7465 222c 206e  ("propupdate", n
+00003630: 6f64 6529 0d0a 0d0a 2020 2020 6465 6620  ode)....    def 
+00003640: 7261 6469 6f5f 6d61 7463 685f 7370 6565  radio_match_spee
+00003650: 6428 6e6f 6465 2c20 7370 6565 643d 302c  d(node, speed=0,
+00003660: 202a 2a6b 7761 7267 7329 3a0d 0a20 2020   **kwargs):..   
+00003670: 2020 2020 2072 6574 7572 6e20 6e6f 6465       return node
+00003680: 2e73 7065 6564 203d 3d20 666c 6f61 7428  .speed == float(
+00003690: 7370 6565 6429 0d0a 0d0a 2020 2020 4074  speed)....    @t
+000036a0: 7265 655f 7375 626d 656e 7528 5f28 2253  ree_submenu(_("S
+000036b0: 7065 6564 2066 6f72 2052 6173 7465 722d  peed for Raster-
+000036c0: 4f70 6572 6174 696f 6e22 2929 0d0a 2020  Operation"))..  
+000036d0: 2020 4074 7265 655f 7261 6469 6f28 7261    @tree_radio(ra
+000036e0: 6469 6f5f 6d61 7463 685f 7370 6565 6429  dio_match_speed)
+000036f0: 0d0a 2020 2020 4074 7265 655f 7661 6c75  ..    @tree_valu
+00003700: 6573 2822 7370 6565 6422 2c20 2835 2c20  es("speed", (5, 
+00003710: 3130 2c20 3530 2c20 3735 2c20 3130 302c  10, 50, 75, 100,
+00003720: 2031 3530 2c20 3230 302c 2032 3530 2c20   150, 200, 250, 
+00003730: 3330 302c 2033 3530 2c20 3430 302c 2034  300, 350, 400, 4
+00003740: 3530 2c20 3530 3029 290d 0a20 2020 2040  50, 500))..    @
+00003750: 7472 6565 5f6f 7065 7261 7469 6f6e 285f  tree_operation(_
+00003760: 2822 7b73 7065 6564 7d6d 6d2f 7322 292c  ("{speed}mm/s"),
+00003770: 206e 6f64 655f 7479 7065 3d28 226f 7020   node_type=("op 
+00003780: 7261 7374 6572 222c 2022 6f70 2069 6d61  raster", "op ima
+00003790: 6765 2229 2c20 6865 6c70 3d22 2229 0d0a  ge"), help="")..
+000037a0: 2020 2020 6465 6620 7365 745f 7370 6565      def set_spee
+000037b0: 645f 7261 7374 6572 286e 6f64 652c 2073  d_raster(node, s
+000037c0: 7065 6564 3d31 3530 2c20 2a2a 6b77 6172  peed=150, **kwar
+000037d0: 6773 293a 0d0a 2020 2020 2020 2020 6461  gs):..        da
+000037e0: 7461 203d 206c 6973 7428 290d 0a20 2020  ta = list()..   
+000037f0: 2020 2020 2066 6f72 206e 2069 6e20 6c69       for n in li
+00003800: 7374 2873 656c 662e 6f70 7328 7365 6c65  st(self.ops(sele
+00003810: 6374 6564 3d54 7275 6529 293a 0d0a 2020  cted=True)):..  
+00003820: 2020 2020 2020 2020 2020 6966 206e 2e74            if n.t
+00003830: 7970 6520 6e6f 7420 696e 2028 226f 7020  ype not in ("op 
+00003840: 7261 7374 6572 222c 2022 6f70 2069 6d61  raster", "op ima
+00003850: 6765 2229 3a0d 0a20 2020 2020 2020 2020  ge"):..         
+00003860: 2020 2020 2020 2063 6f6e 7469 6e75 650d         continue.
+00003870: 0a20 2020 2020 2020 2020 2020 206e 2e73  .            n.s
+00003880: 7065 6564 203d 2066 6c6f 6174 2873 7065  peed = float(spe
+00003890: 6564 290d 0a20 2020 2020 2020 2020 2020  ed)..           
+000038a0: 2064 6174 612e 6170 7065 6e64 286e 290d   data.append(n).
+000038b0: 0a20 2020 2020 2020 2073 656c 662e 7369  .        self.si
+000038c0: 676e 616c 2822 656c 656d 656e 745f 7072  gnal("element_pr
+000038d0: 6f70 6572 7479 5f72 656c 6f61 6422 2c20  operty_reload", 
+000038e0: 6461 7461 290d 0a0d 0a20 2020 2040 7472  data)....    @tr
+000038f0: 6565 5f73 7562 6d65 6e75 285f 2822 5370  ee_submenu(_("Sp
+00003900: 6565 6420 666f 7220 5665 6374 6f72 2d4f  eed for Vector-O
+00003910: 7065 7261 7469 6f6e 2229 290d 0a20 2020  peration"))..   
+00003920: 2040 7472 6565 5f72 6164 696f 2872 6164   @tree_radio(rad
+00003930: 696f 5f6d 6174 6368 5f73 7065 6564 290d  io_match_speed).
+00003940: 0a20 2020 2040 7472 6565 5f76 616c 7565  .    @tree_value
+00003950: 7328 2273 7065 6564 222c 2028 322c 2033  s("speed", (2, 3
+00003960: 2c20 342c 2035 2c20 362c 2037 2c20 3130  , 4, 5, 6, 7, 10
+00003970: 2c20 3135 2c20 3230 2c20 3235 2c20 3330  , 15, 20, 25, 30
+00003980: 2c20 3335 2c20 3430 2c20 3530 2929 0d0a  , 35, 40, 50))..
+00003990: 2020 2020 4074 7265 655f 6f70 6572 6174      @tree_operat
+000039a0: 696f 6e28 0d0a 2020 2020 2020 2020 5f28  ion(..        _(
+000039b0: 227b 7370 6565 647d 6d6d 2f73 2229 2c0d  "{speed}mm/s"),.
+000039c0: 0a20 2020 2020 2020 206e 6f64 655f 7479  .        node_ty
+000039d0: 7065 3d28 226f 7020 6375 7422 2c20 226f  pe=("op cut", "o
+000039e0: 7020 656e 6772 6176 6522 2c20 226f 7020  p engrave", "op 
+000039f0: 6861 7463 6822 292c 0d0a 2020 2020 2020  hatch"),..      
+00003a00: 2020 6865 6c70 3d22 222c 0d0a 2020 2020    help="",..    
+00003a10: 290d 0a20 2020 2064 6566 2073 6574 5f73  )..    def set_s
+00003a20: 7065 6564 5f76 6563 746f 725f 6375 7428  peed_vector_cut(
+00003a30: 6e6f 6465 2c20 7370 6565 643d 3230 2c20  node, speed=20, 
+00003a40: 2a2a 6b77 6172 6773 293a 0d0a 2020 2020  **kwargs):..    
+00003a50: 2020 2020 6461 7461 203d 206c 6973 7428      data = list(
+00003a60: 290d 0a20 2020 2020 2020 2066 6f72 206e  )..        for n
+00003a70: 2069 6e20 6c69 7374 2873 656c 662e 6f70   in list(self.op
+00003a80: 7328 7365 6c65 6374 6564 3d54 7275 6529  s(selected=True)
+00003a90: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00003aa0: 6966 206e 2e74 7970 6520 6e6f 7420 696e  if n.type not in
+00003ab0: 2028 226f 7020 6375 7422 2c20 226f 7020   ("op cut", "op 
+00003ac0: 656e 6772 6176 6522 2c20 226f 7020 6861  engrave", "op ha
+00003ad0: 7463 6822 293a 0d0a 2020 2020 2020 2020  tch"):..        
+00003ae0: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
+00003af0: 0d0a 2020 2020 2020 2020 2020 2020 6e2e  ..            n.
+00003b00: 7370 6565 6420 3d20 666c 6f61 7428 7370  speed = float(sp
+00003b10: 6565 6429 0d0a 2020 2020 2020 2020 2020  eed)..          
+00003b20: 2020 6461 7461 2e61 7070 656e 6428 6e29    data.append(n)
+00003b30: 0d0a 2020 2020 2020 2020 7365 6c66 2e73  ..        self.s
+00003b40: 6967 6e61 6c28 2265 6c65 6d65 6e74 5f70  ignal("element_p
+00003b50: 726f 7065 7274 795f 7265 6c6f 6164 222c  roperty_reload",
+00003b60: 2064 6174 6129 0d0a 0d0a 2020 2020 6465   data)....    de
+00003b70: 6620 7261 6469 6f5f 6d61 7463 685f 706f  f radio_match_po
+00003b80: 7765 7228 6e6f 6465 2c20 706f 7765 723d  wer(node, power=
+00003b90: 302c 202a 2a6b 7761 7267 7329 3a0d 0a20  0, **kwargs):.. 
+00003ba0: 2020 2020 2020 2072 6574 7572 6e20 6e6f         return no
+00003bb0: 6465 2e70 6f77 6572 203d 3d20 666c 6f61  de.power == floa
+00003bc0: 7428 706f 7765 7229 0d0a 0d0a 2020 2020  t(power)....    
+00003bd0: 4074 7265 655f 7375 626d 656e 7528 5f28  @tree_submenu(_(
+00003be0: 2250 6f77 6572 2229 290d 0a20 2020 2040  "Power"))..    @
+00003bf0: 7472 6565 5f72 6164 696f 2872 6164 696f  tree_radio(radio
+00003c00: 5f6d 6174 6368 5f70 6f77 6572 290d 0a20  _match_power).. 
+00003c10: 2020 2040 7472 6565 5f76 616c 7565 7328     @tree_values(
+00003c20: 2270 6f77 6572 222c 2028 3130 302c 2032  "power", (100, 2
+00003c30: 3530 2c20 3333 332c 2035 3030 2c20 3636  50, 333, 500, 66
+00003c40: 372c 2037 3530 2c20 3130 3030 2929 0d0a  7, 750, 1000))..
+00003c50: 2020 2020 4074 7265 655f 6361 6c63 2822      @tree_calc("
+00003c60: 706f 7765 725f 3130 222c 206c 616d 6264  power_10", lambd
+00003c70: 6120 693a 2072 6f75 6e64 2869 202f 2031  a i: round(i / 1
+00003c80: 302c 2031 2929 0d0a 2020 2020 4074 7265  0, 1))..    @tre
+00003c90: 655f 6f70 6572 6174 696f 6e28 0d0a 2020  e_operation(..  
+00003ca0: 2020 2020 2020 5f28 227b 706f 7765 727d        _("{power}
+00003cb0: 7070 6920 287b 706f 7765 725f 3130 7d25  ppi ({power_10}%
+00003cc0: 2922 292c 0d0a 2020 2020 2020 2020 6e6f  )"),..        no
+00003cd0: 6465 5f74 7970 653d 2822 6f70 2063 7574  de_type=("op cut
+00003ce0: 222c 2022 6f70 2072 6173 7465 7222 2c20  ", "op raster", 
+00003cf0: 226f 7020 696d 6167 6522 2c20 226f 7020  "op image", "op 
+00003d00: 656e 6772 6176 6522 2c20 226f 7020 6861  engrave", "op ha
+00003d10: 7463 6822 292c 0d0a 2020 2020 2020 2020  tch"),..        
+00003d20: 6865 6c70 3d22 222c 0d0a 2020 2020 290d  help="",..    ).
+00003d30: 0a20 2020 2064 6566 2073 6574 5f70 6f77  .    def set_pow
+00003d40: 6572 286e 6f64 652c 2070 6f77 6572 3d31  er(node, power=1
+00003d50: 3030 302c 202a 2a6b 7761 7267 7329 3a0d  000, **kwargs):.
+00003d60: 0a20 2020 2020 2020 2064 6174 6120 3d20  .        data = 
+00003d70: 6c69 7374 2829 0d0a 2020 2020 2020 2020  list()..        
+00003d80: 666f 7220 6e20 696e 206c 6973 7428 7365  for n in list(se
+00003d90: 6c66 2e6f 7073 2873 656c 6563 7465 643d  lf.ops(selected=
+00003da0: 5472 7565 2929 3a0d 0a20 2020 2020 2020  True)):..       
+00003db0: 2020 2020 2069 6620 6e6f 7420 6861 7361       if not hasa
+00003dc0: 7474 7228 6e2c 2022 706f 7765 7222 293a  ttr(n, "power"):
+00003dd0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00003de0: 2020 636f 6e74 696e 7565 0d0a 2020 2020    continue..    
+00003df0: 2020 2020 2020 2020 6e2e 706f 7765 7220          n.power 
+00003e00: 3d20 666c 6f61 7428 706f 7765 7229 0d0a  = float(power)..
+00003e10: 2020 2020 2020 2020 2020 2020 6461 7461              data
+00003e20: 2e61 7070 656e 6428 6e29 0d0a 2020 2020  .append(n)..    
+00003e30: 2020 2020 6966 206c 656e 2864 6174 6129      if len(data)
+00003e40: 203e 2030 3a0d 0a20 2020 2020 2020 2020   > 0:..         
+00003e50: 2020 2073 656c 662e 7369 676e 616c 2822     self.signal("
+00003e60: 656c 656d 656e 745f 7072 6f70 6572 7479  element_property
+00003e70: 5f72 656c 6f61 6422 2c20 6461 7461 290d  _reload", data).
+00003e80: 0a0d 0a20 2020 2064 6566 2072 6164 696f  ...    def radio
+00003e90: 5f6d 6174 6368 286e 6f64 652c 2064 7069  _match(node, dpi
+00003ea0: 3d31 3030 2c20 2a2a 6b77 6172 6773 293a  =100, **kwargs):
+00003eb0: 0d0a 2020 2020 2020 2020 7472 793a 0d0a  ..        try:..
+00003ec0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00003ed0: 726e 2072 6f75 6e64 286e 6f64 652e 6470  rn round(node.dp
+00003ee0: 692c 2030 2920 3d3d 2072 6f75 6e64 2864  i, 0) == round(d
+00003ef0: 7069 2c20 3029 0d0a 2020 2020 2020 2020  pi, 0)..        
+00003f00: 6578 6365 7074 2056 616c 7565 4572 726f  except ValueErro
+00003f10: 723a 0d0a 2020 2020 2020 2020 2020 2020  r:..            
+00003f20: 7265 7475 726e 2046 616c 7365 0d0a 0d0a  return False....
+00003f30: 2020 2020 4074 7265 655f 7375 626d 656e      @tree_submen
+00003f40: 7528 5f28 2244 5049 2229 290d 0a20 2020  u(_("DPI"))..   
+00003f50: 2040 7472 6565 5f72 6164 696f 2872 6164   @tree_radio(rad
+00003f60: 696f 5f6d 6174 6368 290d 0a20 2020 2040  io_match)..    @
+00003f70: 7472 6565 5f76 616c 7565 7328 2264 7069  tree_values("dpi
+00003f80: 222c 2028 3130 302c 2032 3530 2c20 3333  ", (100, 250, 33
+00003f90: 332c 2035 3030 2c20 3636 372c 2037 3530  3, 500, 667, 750
+00003fa0: 2c20 3130 3030 2929 0d0a 2020 2020 4074  , 1000))..    @t
+00003fb0: 7265 655f 6f70 6572 6174 696f 6e28 0d0a  ree_operation(..
+00003fc0: 2020 2020 2020 2020 5f28 2244 5049 207b          _("DPI {
+00003fd0: 6470 697d 2229 2c0d 0a20 2020 2020 2020  dpi}"),..       
+00003fe0: 206e 6f64 655f 7479 7065 3d28 226f 7020   node_type=("op 
+00003ff0: 7261 7374 6572 222c 2022 656c 656d 2069  raster", "elem i
+00004000: 6d61 6765 2229 2c0d 0a20 2020 2020 2020  mage"),..       
+00004010: 2068 656c 703d 5f28 2243 6861 6e67 6520   help=_("Change 
+00004020: 6470 6920 7661 6c75 6573 2229 2c0d 0a20  dpi values"),.. 
+00004030: 2020 2029 0d0a 2020 2020 6465 6620 7365     )..    def se
+00004040: 745f 7374 6570 5f6e 286e 6f64 652c 2064  t_step_n(node, d
+00004050: 7069 3d31 2c20 2a2a 6b77 6172 6773 293a  pi=1, **kwargs):
+00004060: 0d0a 2020 2020 2020 2020 6461 7461 203d  ..        data =
+00004070: 206c 6973 7428 290d 0a20 2020 2020 2020   list()..       
+00004080: 2066 6f72 206e 2069 6e20 6c69 7374 2873   for n in list(s
+00004090: 656c 662e 6f70 7328 7365 6c65 6374 6564  elf.ops(selected
+000040a0: 3d54 7275 6529 293a 0d0a 2020 2020 2020  =True)):..      
+000040b0: 2020 2020 2020 6966 206e 6f74 2068 6173        if not has
+000040c0: 6174 7472 286e 2c20 2264 7069 2229 3a0d  attr(n, "dpi"):.
+000040d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000040e0: 2063 6f6e 7469 6e75 650d 0a20 2020 2020   continue..     
+000040f0: 2020 2020 2020 206e 2e64 7069 203d 2064         n.dpi = d
+00004100: 7069 0d0a 2020 2020 2020 2020 2020 2020  pi..            
+00004110: 6461 7461 2e61 7070 656e 6428 6e29 0d0a  data.append(n)..
+00004120: 2020 2020 2020 2020 666f 7220 6e20 696e          for n in
+00004130: 206c 6973 7428 7365 6c66 2e65 6c65 6d73   list(self.elems
+00004140: 2865 6d70 6861 7369 7a65 643d 5472 7565  (emphasized=True
+00004150: 2929 3a0d 0a20 2020 2020 2020 2020 2020  )):..           
+00004160: 2069 6620 6e2e 7479 7065 203d 3d20 2265   if n.type == "e
+00004170: 6c65 6d20 696d 6167 6522 3a0d 0a20 2020  lem image":..   
+00004180: 2020 2020 2020 2020 2020 2020 206e 2e64               n.d
+00004190: 7069 203d 2064 7069 0d0a 2020 2020 2020  pi = dpi..      
+000041a0: 2020 2020 2020 2020 2020 6e2e 7570 6461            n.upda
+000041b0: 7465 284e 6f6e 6529 0d0a 2020 2020 2020  te(None)..      
+000041c0: 2020 2020 2020 2020 2020 6461 7461 2e61            data.a
+000041d0: 7070 656e 6428 6e29 0d0a 2020 2020 2020  ppend(n)..      
+000041e0: 2020 6966 206c 656e 2864 6174 6129 203e    if len(data) >
+000041f0: 2030 3a0d 0a20 2020 2020 2020 2020 2020   0:..           
+00004200: 2073 656c 662e 7369 676e 616c 2822 7265   self.signal("re
+00004210: 6672 6573 685f 7363 656e 6522 2c20 2253  fresh_scene", "S
+00004220: 6365 6e65 2229 0d0a 2020 2020 2020 2020  cene")..        
+00004230: 2020 2020 7365 6c66 2e73 6967 6e61 6c28      self.signal(
+00004240: 2265 6c65 6d65 6e74 5f70 726f 7065 7274  "element_propert
+00004250: 795f 7265 6c6f 6164 222c 2064 6174 6129  y_reload", data)
+00004260: 0d0a 0d0a 2020 2020 6465 6620 7261 6469  ....    def radi
+00004270: 6f5f 6d61 7463 685f 7061 7373 6573 286e  o_match_passes(n
+00004280: 6f64 652c 2070 6173 7376 616c 7565 3d31  ode, passvalue=1
+00004290: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
+000042a0: 2020 2020 2020 7265 7475 726e 2028 6e6f        return (no
+000042b0: 6465 2e70 6173 7365 735f 6375 7374 6f6d  de.passes_custom
+000042c0: 2061 6e64 2070 6173 7376 616c 7565 203d   and passvalue =
+000042d0: 3d20 6e6f 6465 2e70 6173 7365 7329 206f  = node.passes) o
+000042e0: 7220 280d 0a20 2020 2020 2020 2020 2020  r (..           
+000042f0: 206e 6f74 206e 6f64 652e 7061 7373 6573   not node.passes
+00004300: 5f63 7573 746f 6d20 616e 6420 7061 7373  _custom and pass
+00004310: 7661 6c75 6520 3d3d 2031 0d0a 2020 2020  value == 1..    
+00004320: 2020 2020 290d 0a0d 0a20 2020 2040 7472      )....    @tr
+00004330: 6565 5f73 7562 6d65 6e75 285f 2822 5365  ee_submenu(_("Se
+00004340: 7420 6f70 6572 6174 696f 6e20 7061 7373  t operation pass
+00004350: 6573 2229 290d 0a20 2020 2040 7472 6565  es"))..    @tree
+00004360: 5f72 6164 696f 2872 6164 696f 5f6d 6174  _radio(radio_mat
+00004370: 6368 5f70 6173 7365 7329 0d0a 2020 2020  ch_passes)..    
+00004380: 4074 7265 655f 6974 6572 6174 6528 2270  @tree_iterate("p
+00004390: 6173 7376 616c 7565 222c 2031 2c20 3130  assvalue", 1, 10
+000043a0: 290d 0a20 2020 2040 7472 6565 5f6f 7065  )..    @tree_ope
+000043b0: 7261 7469 6f6e 285f 2822 5061 7373 6573  ration(_("Passes
+000043c0: 207b 7061 7373 7661 6c75 657d 2229 2c20   {passvalue}"), 
+000043d0: 6e6f 6465 5f74 7970 653d 6f70 5f70 6172  node_type=op_par
+000043e0: 656e 745f 6e6f 6465 732c 2068 656c 703d  ent_nodes, help=
+000043f0: 2222 290d 0a20 2020 2064 6566 2073 6574  "")..    def set
+00004400: 5f6e 5f70 6173 7365 7328 6e6f 6465 2c20  _n_passes(node, 
+00004410: 7061 7373 7661 6c75 653d 312c 202a 2a6b  passvalue=1, **k
+00004420: 7761 7267 7329 3a0d 0a20 2020 2020 2020  wargs):..       
+00004430: 2064 6174 6120 3d20 6c69 7374 2829 0d0a   data = list()..
+00004440: 2020 2020 2020 2020 666f 7220 6e20 696e          for n in
+00004450: 206c 6973 7428 7365 6c66 2e6f 7073 2873   list(self.ops(s
+00004460: 656c 6563 7465 643d 5472 7565 2929 3a0d  elected=True)):.
+00004470: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00004480: 6e6f 7420 6861 7361 7474 7228 6e2c 2022  not hasattr(n, "
+00004490: 7061 7373 6573 2229 3a0d 0a20 2020 2020  passes"):..     
+000044a0: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
+000044b0: 6e75 650d 0a20 2020 2020 2020 2020 2020  nue..           
+000044c0: 206e 2e70 6173 7365 7320 3d20 7061 7373   n.passes = pass
+000044d0: 7661 6c75 650d 0a20 2020 2020 2020 2020  value..         
+000044e0: 2020 206e 2e70 6173 7365 735f 6375 7374     n.passes_cust
+000044f0: 6f6d 203d 2070 6173 7376 616c 7565 2021  om = passvalue !
+00004500: 3d20 310d 0a20 2020 2020 2020 2020 2020  = 1..           
+00004510: 2064 6174 612e 6170 7065 6e64 286e 290d   data.append(n).
+00004520: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
+00004530: 6461 7461 2920 3e20 303a 0d0a 2020 2020  data) > 0:..    
+00004540: 2020 2020 2020 2020 7365 6c66 2e73 6967          self.sig
+00004550: 6e61 6c28 2265 6c65 6d65 6e74 5f70 726f  nal("element_pro
+00004560: 7065 7274 795f 7265 6c6f 6164 222c 2064  perty_reload", d
+00004570: 6174 6129 0d0a 0d0a 2020 2020 6465 6620  ata)....    def 
+00004580: 7261 6469 6f5f 6d61 7463 685f 6c6f 6f70  radio_match_loop
+00004590: 7328 6e6f 6465 2c20 6c6f 6f70 7661 6c75  s(node, loopvalu
+000045a0: 653d 312c 202a 2a6b 7761 7267 7329 3a0d  e=1, **kwargs):.
+000045b0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000045c0: 6e6f 6465 2e6c 6f6f 7073 203d 3d20 6c6f  node.loops == lo
+000045d0: 6f70 7661 6c75 650d 0a0d 0a20 2020 2040  opvalue....    @
+000045e0: 7472 6565 5f73 7562 6d65 6e75 285f 2822  tree_submenu(_("
+000045f0: 5365 7420 706c 6163 656d 656e 7420 6c6f  Set placement lo
+00004600: 6f70 7322 2929 0d0a 2020 2020 4074 7265  ops"))..    @tre
+00004610: 655f 7261 6469 6f28 7261 6469 6f5f 6d61  e_radio(radio_ma
+00004620: 7463 685f 6c6f 6f70 7329 0d0a 2020 2020  tch_loops)..    
+00004630: 4074 7265 655f 6974 6572 6174 6528 226c  @tree_iterate("l
+00004640: 6f6f 7076 616c 7565 222c 2031 2c20 3130  oopvalue", 1, 10
+00004650: 290d 0a20 2020 2040 7472 6565 5f6f 7065  )..    @tree_ope
+00004660: 7261 7469 6f6e 285f 2822 4c6f 6f70 7320  ration(_("Loops 
+00004670: 7b6c 6f6f 7076 616c 7565 7d22 292c 206e  {loopvalue}"), n
+00004680: 6f64 655f 7479 7065 3d70 6c61 6365 5f6e  ode_type=place_n
+00004690: 6f64 6573 2c20 6865 6c70 3d22 2229 0d0a  odes, help="")..
+000046a0: 2020 2020 6465 6620 7365 745f 6e5f 6c6f      def set_n_lo
+000046b0: 6f70 7328 6e6f 6465 2c20 6c6f 6f70 7661  ops(node, loopva
+000046c0: 6c75 653d 312c 202a 2a6b 7761 7267 7329  lue=1, **kwargs)
+000046d0: 3a0d 0a20 2020 2020 2020 2064 6174 6120  :..        data 
+000046e0: 3d20 6c69 7374 2829 0d0a 2020 2020 2020  = list()..      
+000046f0: 2020 666f 7220 6e20 696e 206c 6973 7428    for n in list(
+00004700: 7365 6c66 2e6f 7073 2873 656c 6563 7465  self.ops(selecte
+00004710: 643d 5472 7565 2929 3a0d 0a20 2020 2020  d=True)):..     
+00004720: 2020 2020 2020 2069 6620 6e6f 7420 6861         if not ha
+00004730: 7361 7474 7228 6e2c 2022 6c6f 6f70 7322  sattr(n, "loops"
+00004740: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00004750: 2020 2020 636f 6e74 696e 7565 0d0a 2020      continue..  
+00004760: 2020 2020 2020 2020 2020 6e2e 6c6f 6f70            n.loop
+00004770: 7320 3d20 6c6f 6f70 7661 6c75 650d 0a20  s = loopvalue.. 
+00004780: 2020 2020 2020 2020 2020 2064 6174 612e             data.
+00004790: 6170 7065 6e64 286e 290d 0a20 2020 2020  append(n)..     
+000047a0: 2020 2069 6620 6c65 6e28 6461 7461 2920     if len(data) 
+000047b0: 3e20 303a 0d0a 2020 2020 2020 2020 2020  > 0:..          
+000047c0: 2020 7365 6c66 2e73 6967 6e61 6c28 2265    self.signal("e
+000047d0: 6c65 6d65 6e74 5f70 726f 7065 7274 795f  lement_property_
+000047e0: 7570 6461 7465 222c 2064 6174 6129 0d0a  update", data)..
+000047f0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00004800: 2e73 6967 6e61 6c28 2272 6566 7265 7368  .signal("refresh
+00004810: 5f73 6365 6e65 222c 2022 5363 656e 6522  _scene", "Scene"
+00004820: 290d 0a0d 0a20 2020 2040 7472 6565 5f73  )....    @tree_s
+00004830: 7562 6d65 6e75 285f 2822 4c61 796f 7574  ubmenu(_("Layout
+00004840: 2229 290d 0a20 2020 2040 7472 6565 5f70  "))..    @tree_p
+00004850: 726f 6d70 7428 2264 7822 2c20 5f28 2244  rompt("dx", _("D
+00004860: 6973 7461 6e63 6520 6265 7477 6565 6e20  istance between 
+00004870: 706c 6163 656d 656e 7473 3f22 2929 0d0a  placements?"))..
+00004880: 2020 2020 4074 7265 655f 7072 6f6d 7074      @tree_prompt
+00004890: 280d 0a20 2020 2020 2020 2022 6e78 222c  (..        "nx",
+000048a0: 0d0a 2020 2020 2020 2020 5f28 0d0a 2020  ..        _(..  
+000048b0: 2020 2020 2020 2020 2020 2248 6f77 206d            "How m
+000048c0: 616e 7920 6164 6469 7469 6f6e 616c 2070  any additional p
+000048d0: 6c61 6365 6d65 6e74 7320 6f6e 2074 6865  lacements on the
+000048e0: 2058 2d41 7869 733f 5c6e 2830 203d 2061   X-Axis?\n(0 = a
+000048f0: 7320 6d61 6e79 2061 7320 6669 7420 6f6e  s many as fit on
+00004900: 2074 6865 2062 6564 2922 0d0a 2020 2020   the bed)"..    
+00004910: 2020 2020 292c 0d0a 2020 2020 290d 0a20      ),..    ).. 
+00004920: 2020 2040 7472 6565 5f6f 7065 7261 7469     @tree_operati
+00004930: 6f6e 280d 0a20 2020 2020 2020 205f 2822  on(..        _("
+00004940: 4372 6561 7465 2070 6c61 6365 6d65 6e74  Create placement
+00004950: 7320 686f 7269 7a6f 6e74 616c 6c79 2229  s horizontally")
+00004960: 2c20 6e6f 6465 5f74 7970 653d 2270 6c61  , node_type="pla
+00004970: 6365 2070 6f69 6e74 222c 2068 656c 703d  ce point", help=
+00004980: 2222 0d0a 2020 2020 290d 0a20 2020 2064  ""..    )..    d
+00004990: 6566 2063 6f70 6965 735f 686f 7269 7a6f  ef copies_horizo
+000049a0: 6e74 616c 6c79 286e 6f64 652c 2064 782c  ntally(node, dx,
+000049b0: 206e 782c 2070 6f73 3d4e 6f6e 652c 202a   nx, pos=None, *
+000049c0: 2a6b 7761 7267 7329 3a0d 0a20 2020 2020  *kwargs):..     
+000049d0: 2020 2023 0d0a 2020 2020 2020 2020 6966     #..        if
+000049e0: 2064 7820 6973 204e 6f6e 6520 6f72 2064   dx is None or d
+000049f0: 7820 3d3d 2022 223a 0d0a 2020 2020 2020  x == "":..      
+00004a00: 2020 2020 2020 7265 7475 726e 0d0a 2020        return..  
+00004a10: 2020 2020 2020 7472 793a 0d0a 2020 2020        try:..    
+00004a20: 2020 2020 2020 2020 6c65 6e5f 6478 203d          len_dx =
+00004a30: 204c 656e 6774 6828 6478 290d 0a20 2020   Length(dx)..   
+00004a40: 2020 2020 2020 2020 2064 785f 7661 6c20           dx_val 
+00004a50: 3d20 666c 6f61 7428 6c65 6e5f 6478 290d  = float(len_dx).
+00004a60: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+00004a70: 5661 6c75 6545 7272 6f72 3a0d 0a20 2020  ValueError:..   
+00004a80: 2020 2020 2020 2020 2072 6574 7572 6e0d           return.
+00004a90: 0a20 2020 2020 2020 2069 6620 6e78 2069  .        if nx i
+00004aa0: 7320 4e6f 6e65 206f 7220 6e78 203d 3d20  s None or nx == 
+00004ab0: 2222 3a0d 0a20 2020 2020 2020 2020 2020  "":..           
+00004ac0: 2072 6574 7572 6e0d 0a20 2020 2020 2020   return..       
+00004ad0: 2074 7279 3a0d 0a20 2020 2020 2020 2020   try:..         
+00004ae0: 2020 206e 7820 3d20 696e 7428 6e78 290d     nx = int(nx).
+00004af0: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+00004b00: 5661 6c75 6545 7272 6f72 3a0d 0a20 2020  ValueError:..   
+00004b10: 2020 2020 2020 2020 2072 6574 7572 6e0d           return.
+00004b20: 0a20 2020 2020 2020 2069 6620 6e78 203c  .        if nx <
+00004b30: 2030 3a0d 0a20 2020 2020 2020 2020 2020   0:..           
+00004b40: 2023 204e 6f74 6869 6e67 2074 6f20 646f   # Nothing to do
+00004b50: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+00004b60: 7475 726e 0d0a 2020 2020 2020 2020 6461  turn..        da
+00004b70: 7461 203d 205b 5d0d 0a20 2020 2020 2020  ta = []..       
+00004b80: 206d 6178 5f78 203d 2073 656c 662e 6465   max_x = self.de
+00004b90: 7669 6365 2e77 6964 7468 0d0a 2020 2020  vice.width..    
+00004ba0: 2020 2020 666f 7220 6e20 696e 206c 6973      for n in lis
+00004bb0: 7428 7365 6c66 2e6f 7073 2873 656c 6563  t(self.ops(selec
+00004bc0: 7465 643d 5472 7565 2929 3a0d 0a20 2020  ted=True)):..   
+00004bd0: 2020 2020 2020 2020 2069 6620 6e2e 7479           if n.ty
+00004be0: 7065 203d 3d20 2270 6c61 6365 2070 6f69  pe == "place poi
+00004bf0: 6e74 223a 0d0a 2020 2020 2020 2020 2020  nt":..          
+00004c00: 2020 2020 2020 6461 7461 2e61 7070 656e        data.appen
+00004c10: 6428 6e29 0d0a 2020 2020 2020 2020 6966  d(n)..        if
+00004c20: 206c 656e 2864 6174 6129 203d 3d20 303a   len(data) == 0:
+00004c30: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+00004c40: 7475 726e 0d0a 2020 2020 2020 2020 706f  turn..        po
+00004c50: 7320 3d20 4e6f 6e65 0d0a 2020 2020 2020  s = None..      
+00004c60: 2020 666f 7220 706e 6f64 6520 696e 2064    for pnode in d
+00004c70: 6174 613a 0d0a 2020 2020 2020 2020 2020  ata:..          
+00004c80: 2020 7374 6172 7478 203d 2070 6e6f 6465    startx = pnode
+00004c90: 2e78 202b 2064 785f 7661 6c0d 0a20 2020  .x + dx_val..   
+00004ca0: 2020 2020 2020 2020 2073 7461 7274 7920           starty 
+00004cb0: 3d20 706e 6f64 652e 790d 0a20 2020 2020  = pnode.y..     
+00004cc0: 2020 2020 2020 2063 6f72 6e65 7220 3d20         corner = 
+00004cd0: 706e 6f64 652e 636f 726e 6572 0d0a 2020  pnode.corner..  
+00004ce0: 2020 2020 2020 2020 2020 726f 7461 7469            rotati
+00004cf0: 6f6e 203d 2070 6e6f 6465 2e72 6f74 6174  on = pnode.rotat
+00004d00: 696f 6e0d 0a20 2020 2020 2020 2020 2020  ion..           
+00004d10: 2069 6620 6e78 203d 3d20 303a 0d0a 2020   if nx == 0:..  
+00004d20: 2020 2020 2020 2020 2020 2020 2020 7768                wh
+00004d30: 696c 6520 7374 6172 7478 203c 206d 6178  ile startx < max
+00004d40: 5f78 3a0d 0a20 2020 2020 2020 2020 2020  _x:..           
+00004d50: 2020 2020 2020 2020 2073 656c 662e 6f70           self.op
+00004d60: 5f62 7261 6e63 682e 6164 6428 0d0a 2020  _branch.add(..  
+00004d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004d80: 2020 2020 2020 7479 7065 3d22 706c 6163        type="plac
+00004d90: 6520 706f 696e 7422 2c0d 0a20 2020 2020  e point",..     
+00004da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004db0: 2020 2070 6f73 3d70 6f73 2c0d 0a20 2020     pos=pos,..   
+00004dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004dd0: 2020 2020 2078 3d73 7461 7274 782c 0d0a       x=startx,..
+00004de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004df0: 2020 2020 2020 2020 793d 7374 6172 7479          y=starty
+00004e00: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00004e10: 2020 2020 2020 2020 2020 2072 6f74 6174             rotat
+00004e20: 696f 6e3d 726f 7461 7469 6f6e 2c0d 0a20  ion=rotation,.. 
+00004e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004e40: 2020 2020 2020 2063 6f72 6e65 723d 636f         corner=co
+00004e50: 726e 6572 2c0d 0a20 2020 2020 2020 2020  rner,..         
+00004e60: 2020 2020 2020 2020 2020 2029 0d0a 2020             )..  
+00004e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004e80: 2020 7374 6172 7478 202b 3d20 6478 5f76    startx += dx_v
+00004e90: 616c 0d0a 2020 2020 2020 2020 2020 2020  al..            
+00004ea0: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+00004eb0: 2020 2020 2020 2066 6f72 2069 6478 2069         for idx i
+00004ec0: 6e20 7261 6e67 6528 6e78 293a 0d0a 2020  n range(nx):..  
+00004ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004ee0: 2020 7365 6c66 2e6f 705f 6272 616e 6368    self.op_branch
+00004ef0: 2e61 6464 280d 0a20 2020 2020 2020 2020  .add(..         
+00004f00: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00004f10: 7970 653d 2270 6c61 6365 2070 6f69 6e74  ype="place point
+00004f20: 222c 0d0a 2020 2020 2020 2020 2020 2020  ",..            
+00004f30: 2020 2020 2020 2020 2020 2020 706f 733d              pos=
+00004f40: 706f 732c 0d0a 2020 2020 2020 2020 2020  pos,..          
+00004f50: 2020 2020 2020 2020 2020 2020 2020 783d                x=
+00004f60: 7374 6172 7478 2c0d 0a20 2020 2020 2020  startx,..       
+00004f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004f80: 2079 3d73 7461 7274 792c 0d0a 2020 2020   y=starty,..    
+00004f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004fa0: 2020 2020 726f 7461 7469 6f6e 3d72 6f74      rotation=rot
+00004fb0: 6174 696f 6e2c 0d0a 2020 2020 2020 2020  ation,..        
+00004fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004fd0: 636f 726e 6572 3d63 6f72 6e65 722c 0d0a  corner=corner,..
+00004fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004ff0: 2020 2020 290d 0a20 2020 2020 2020 2020      )..         
+00005000: 2020 2020 2020 2020 2020 2073 7461 7274             start
+00005010: 7820 2b3d 2064 785f 7661 6c0d 0a20 2020  x += dx_val..   
+00005020: 2020 2020 2073 656c 662e 7369 676e 616c       self.signal
+00005030: 2822 7570 6461 7465 6f70 5f74 7265 6522  ("updateop_tree"
+00005040: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00005050: 7369 676e 616c 2822 7265 6672 6573 685f  signal("refresh_
+00005060: 7363 656e 6522 2c20 2253 6365 6e65 2229  scene", "Scene")
+00005070: 0d0a 0d0a 2020 2020 4074 7265 655f 7375  ....    @tree_su
+00005080: 626d 656e 7528 5f28 224c 6179 6f75 7422  bmenu(_("Layout"
+00005090: 2929 0d0a 2020 2020 4074 7265 655f 7072  ))..    @tree_pr
+000050a0: 6f6d 7074 2822 6479 222c 205f 2822 4469  ompt("dy", _("Di
+000050b0: 7374 616e 6365 2062 6574 7765 656e 2070  stance between p
+000050c0: 6c61 6365 6d65 6e74 733f 2229 290d 0a20  lacements?")).. 
+000050d0: 2020 2040 7472 6565 5f70 726f 6d70 7428     @tree_prompt(
+000050e0: 0d0a 2020 2020 2020 2020 226e 7922 2c0d  ..        "ny",.
+000050f0: 0a20 2020 2020 2020 205f 280d 0a20 2020  .        _(..   
+00005100: 2020 2020 2020 2020 2022 486f 7720 6d61           "How ma
+00005110: 6e79 2061 6464 6974 696f 6e61 6c20 706c  ny additional pl
+00005120: 6163 656d 656e 7473 206f 6e20 7468 6520  acements on the 
+00005130: 592d 4178 6973 3f5c 6e28 3020 3d20 6173  Y-Axis?\n(0 = as
+00005140: 206d 616e 7920 6173 2066 6974 206f 6e20   many as fit on 
+00005150: 7468 6520 6265 6429 220d 0a20 2020 2020  the bed)"..     
+00005160: 2020 2029 2c0d 0a20 2020 2029 0d0a 2020     ),..    )..  
+00005170: 2020 4074 7265 655f 6f70 6572 6174 696f    @tree_operatio
+00005180: 6e28 5f28 2243 7265 6174 6520 706c 6163  n(_("Create plac
+00005190: 656d 656e 7473 2076 6572 7469 6361 6c6c  ements verticall
+000051a0: 7922 292c 206e 6f64 655f 7479 7065 3d22  y"), node_type="
+000051b0: 706c 6163 6520 706f 696e 7422 2c20 6865  place point", he
+000051c0: 6c70 3d22 2229 0d0a 2020 2020 6465 6620  lp="")..    def 
+000051d0: 636f 7069 6573 5f76 6572 7469 6361 6c6c  copies_verticall
+000051e0: 7928 6e6f 6465 2c20 6479 2c20 6e79 2c20  y(node, dy, ny, 
+000051f0: 706f 733d 4e6f 6e65 2c20 2a2a 6b77 6172  pos=None, **kwar
+00005200: 6773 293a 0d0a 2020 2020 2020 2020 230d  gs):..        #.
+00005210: 0a20 2020 2020 2020 2069 6620 6479 2069  .        if dy i
+00005220: 7320 4e6f 6e65 206f 7220 6479 203d 3d20  s None or dy == 
+00005230: 2222 3a0d 0a20 2020 2020 2020 2020 2020  "":..           
+00005240: 2072 6574 7572 6e0d 0a20 2020 2020 2020   return..       
+00005250: 2074 7279 3a0d 0a20 2020 2020 2020 2020   try:..         
+00005260: 2020 206c 656e 5f64 7920 3d20 4c65 6e67     len_dy = Leng
+00005270: 7468 2864 7929 0d0a 2020 2020 2020 2020  th(dy)..        
+00005280: 2020 2020 6479 5f76 616c 203d 2066 6c6f      dy_val = flo
+00005290: 6174 286c 656e 5f64 7929 0d0a 2020 2020  at(len_dy)..    
+000052a0: 2020 2020 6578 6365 7074 2056 616c 7565      except Value
+000052b0: 4572 726f 723a 0d0a 2020 2020 2020 2020  Error:..        
+000052c0: 2020 2020 7265 7475 726e 0d0a 2020 2020      return..    
+000052d0: 2020 2020 6966 206e 7920 6973 204e 6f6e      if ny is Non
+000052e0: 6520 6f72 206e 7920 3d3d 2022 223a 0d0a  e or ny == "":..
+000052f0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00005300: 726e 0d0a 2020 2020 2020 2020 7472 793a  rn..        try:
+00005310: 0d0a 2020 2020 2020 2020 2020 2020 6e79  ..            ny
+00005320: 203d 2069 6e74 286e 7929 0d0a 2020 2020   = int(ny)..    
+00005330: 2020 2020 6578 6365 7074 2056 616c 7565      except Value
+00005340: 4572 726f 723a 0d0a 2020 2020 2020 2020  Error:..        
+00005350: 2020 2020 7265 7475 726e 0d0a 2020 2020      return..    
+00005360: 2020 2020 6966 206e 7920 3c20 303a 0d0a      if ny < 0:..
+00005370: 2020 2020 2020 2020 2020 2020 2320 4e6f              # No
+00005380: 7468 696e 6720 746f 2064 6f0d 0a20 2020  thing to do..   
+00005390: 2020 2020 2020 2020 2072 6574 7572 6e0d           return.
+000053a0: 0a20 2020 2020 2020 2064 6174 6120 3d20  .        data = 
+000053b0: 5b5d 0d0a 2020 2020 2020 2020 6d61 785f  []..        max_
+000053c0: 7920 3d20 7365 6c66 2e64 6576 6963 652e  y = self.device.
+000053d0: 6865 6967 6874 0d0a 2020 2020 2020 2020  height..        
+000053e0: 666f 7220 6e20 696e 206c 6973 7428 7365  for n in list(se
+000053f0: 6c66 2e6f 7073 2873 656c 6563 7465 643d  lf.ops(selected=
+00005400: 5472 7565 2929 3a0d 0a20 2020 2020 2020  True)):..       
+00005410: 2020 2020 2069 6620 6e2e 7479 7065 203d       if n.type =
+00005420: 3d20 2270 6c61 6365 2070 6f69 6e74 223a  = "place point":
+00005430: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00005440: 2020 6461 7461 2e61 7070 656e 6428 6e29    data.append(n)
+00005450: 0d0a 2020 2020 2020 2020 6966 206c 656e  ..        if len
+00005460: 2864 6174 6129 203d 3d20 303a 0d0a 2020  (data) == 0:..  
+00005470: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00005480: 0d0a 2020 2020 2020 2020 706f 7320 3d20  ..        pos = 
+00005490: 4e6f 6e65 0d0a 2020 2020 2020 2020 666f  None..        fo
+000054a0: 7220 706e 6f64 6520 696e 2064 6174 613a  r pnode in data:
+000054b0: 0d0a 2020 2020 2020 2020 2020 2020 7374  ..            st
+000054c0: 6172 7478 203d 2070 6e6f 6465 2e78 0d0a  artx = pnode.x..
+000054d0: 2020 2020 2020 2020 2020 2020 7374 6172              star
+000054e0: 7479 203d 2070 6e6f 6465 2e79 202b 2064  ty = pnode.y + d
+000054f0: 795f 7661 6c0d 0a20 2020 2020 2020 2020  y_val..         
+00005500: 2020 2063 6f72 6e65 7220 3d20 706e 6f64     corner = pnod
+00005510: 652e 636f 726e 6572 0d0a 2020 2020 2020  e.corner..      
+00005520: 2020 2020 2020 726f 7461 7469 6f6e 203d        rotation =
+00005530: 2070 6e6f 6465 2e72 6f74 6174 696f 6e0d   pnode.rotation.
+00005540: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00005550: 6e79 203d 3d20 303a 0d0a 2020 2020 2020  ny == 0:..      
+00005560: 2020 2020 2020 2020 2020 7768 696c 6520            while 
+00005570: 7374 6172 7479 203c 206d 6178 5f79 3a0d  starty < max_y:.
+00005580: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005590: 2020 2020 2073 656c 662e 6f70 5f62 7261       self.op_bra
+000055a0: 6e63 682e 6164 6428 0d0a 2020 2020 2020  nch.add(..      
+000055b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000055c0: 2020 7479 7065 3d22 706c 6163 6520 706f    type="place po
+000055d0: 696e 7422 2c0d 0a20 2020 2020 2020 2020  int",..         
+000055e0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+000055f0: 6f73 3d70 6f73 2c0d 0a20 2020 2020 2020  os=pos,..       
+00005600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005610: 2078 3d73 7461 7274 782c 0d0a 2020 2020   x=startx,..    
+00005620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005630: 2020 2020 793d 7374 6172 7479 2c0d 0a20      y=starty,.. 
+00005640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005650: 2020 2020 2020 2072 6f74 6174 696f 6e3d         rotation=
+00005660: 726f 7461 7469 6f6e 2c0d 0a20 2020 2020  rotation,..     
+00005670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005680: 2020 2063 6f72 6e65 723d 636f 726e 6572     corner=corner
+00005690: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+000056a0: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
+000056b0: 2020 2020 2020 2020 2020 2020 2020 7374                st
+000056c0: 6172 7479 202b 3d20 6479 5f76 616c 0d0a  arty += dy_val..
+000056d0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+000056e0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+000056f0: 2020 2066 6f72 2069 6478 2069 6e20 7261     for idx in ra
+00005700: 6e67 6528 6e79 293a 0d0a 2020 2020 2020  nge(ny):..      
+00005710: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00005720: 6c66 2e6f 705f 6272 616e 6368 2e61 6464  lf.op_branch.add
+00005730: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
+00005740: 2020 2020 2020 2020 2020 2074 7970 653d             type=
+00005750: 2270 6c61 6365 2070 6f69 6e74 222c 0d0a  "place point",..
+00005760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005770: 2020 2020 2020 2020 706f 733d 706f 732c          pos=pos,
+00005780: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00005790: 2020 2020 2020 2020 2020 783d 7374 6172            x=star
+000057a0: 7478 2c0d 0a20 2020 2020 2020 2020 2020  tx,..           
+000057b0: 2020 2020 2020 2020 2020 2020 2079 3d73               y=s
+000057c0: 7461 7274 792c 0d0a 2020 2020 2020 2020  tarty,..        
+000057d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000057e0: 726f 7461 7469 6f6e 3d72 6f74 6174 696f  rotation=rotatio
+000057f0: 6e2c 0d0a 2020 2020 2020 2020 2020 2020  n,..            
+00005800: 2020 2020 2020 2020 2020 2020 636f 726e              corn
+00005810: 6572 3d63 6f72 6e65 722c 0d0a 2020 2020  er=corner,..    
+00005820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005830: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00005840: 2020 2020 2020 2073 7461 7274 7920 2b3d         starty +=
+00005850: 2064 795f 7661 6c0d 0a20 2020 2020 2020   dy_val..       
+00005860: 2073 656c 662e 7369 676e 616c 2822 7570   self.signal("up
+00005870: 6461 7465 6f70 5f74 7265 6522 290d 0a20  dateop_tree").. 
+00005880: 2020 2020 2020 2073 656c 662e 7369 676e         self.sign
+00005890: 616c 2822 7265 6672 6573 685f 7363 656e  al("refresh_scen
+000058a0: 6522 2c20 2253 6365 6e65 2229 0d0a 0d0a  e", "Scene")....
+000058b0: 2020 2020 2320 2d2d 2d2d 2042 7572 6e20      # ---- Burn 
+000058c0: 4469 7265 6374 696f 6e0d 0a20 2020 2064  Direction..    d
+000058d0: 6566 2067 6574 5f64 6972 6563 7469 6f6e  ef get_direction
+000058e0: 5f76 616c 7565 7328 293a 0d0a 2020 2020  _values():..    
+000058f0: 2020 2020 7265 7475 726e 2028 0d0a 2020      return (..  
+00005900: 2020 2020 2020 2020 2020 2254 6f70 2054            "Top T
+00005910: 6f20 426f 7474 6f6d 222c 0d0a 2020 2020  o Bottom",..    
+00005920: 2020 2020 2020 2020 2242 6f74 746f 6d20          "Bottom 
+00005930: 546f 2054 6f70 222c 0d0a 2020 2020 2020  To Top",..      
+00005940: 2020 2020 2020 2252 6967 6874 2054 6f20        "Right To 
+00005950: 4c65 6674 222c 0d0a 2020 2020 2020 2020  Left",..        
+00005960: 2020 2020 224c 6566 7420 546f 2052 6967      "Left To Rig
+00005970: 6874 222c 0d0a 2020 2020 2020 2020 2020  ht",..          
+00005980: 2020 2243 726f 7373 6861 7463 6822 2c0d    "Crosshatch",.
+00005990: 0a20 2020 2020 2020 2029 0d0a 0d0a 2020  .        )....  
+000059a0: 2020 6465 6620 7261 6469 6f5f 6d61 7463    def radio_matc
+000059b0: 685f 6469 7265 6374 696f 6e28 6e6f 6465  h_direction(node
+000059c0: 2c20 7261 7374 6572 5f64 6972 6563 7469  , raster_directi
+000059d0: 6f6e 3d22 222c 202a 2a6b 7761 7267 7329  on="", **kwargs)
+000059e0: 3a0d 0a20 2020 2020 2020 2076 616c 7565  :..        value
+000059f0: 7320 3d20 6765 745f 6469 7265 6374 696f  s = get_directio
+00005a00: 6e5f 7661 6c75 6573 2829 0d0a 2020 2020  n_values()..    
+00005a10: 2020 2020 666f 7220 6964 782c 206b 6579      for idx, key
+00005a20: 2069 6e20 656e 756d 6572 6174 6528 7661   in enumerate(va
+00005a30: 6c75 6573 293a 0d0a 2020 2020 2020 2020  lues):..        
+00005a40: 2020 2020 6966 206b 6579 203d 3d20 7261      if key == ra
+00005a50: 7374 6572 5f64 6972 6563 7469 6f6e 3a0d  ster_direction:.
+00005a60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005a70: 2072 6574 7572 6e20 6e6f 6465 2e72 6173   return node.ras
+00005a80: 7465 725f 6469 7265 6374 696f 6e20 3d3d  ter_direction ==
+00005a90: 2069 6478 0d0a 2020 2020 2020 2020 7265   idx..        re
+00005aa0: 7475 726e 2046 616c 7365 0d0a 0d0a 2020  turn False....  
+00005ab0: 2020 4074 7265 655f 7375 626d 656e 7528    @tree_submenu(
+00005ac0: 5f28 2242 7572 6e20 4469 7265 6374 696f  _("Burn Directio
+00005ad0: 6e22 2929 0d0a 2020 2020 4074 7265 655f  n"))..    @tree_
+00005ae0: 7261 6469 6f28 7261 6469 6f5f 6d61 7463  radio(radio_matc
+00005af0: 685f 6469 7265 6374 696f 6e29 0d0a 2020  h_direction)..  
+00005b00: 2020 4074 7265 655f 7661 6c75 6573 2822    @tree_values("
+00005b10: 7261 7374 6572 5f64 6972 6563 7469 6f6e  raster_direction
+00005b20: 222c 2076 616c 7565 733d 6765 745f 6469  ", values=get_di
+00005b30: 7265 6374 696f 6e5f 7661 6c75 6573 2829  rection_values()
+00005b40: 290d 0a20 2020 2040 7472 6565 5f6f 7065  )..    @tree_ope
+00005b50: 7261 7469 6f6e 280d 0a20 2020 2020 2020  ration(..       
+00005b60: 2022 7b72 6173 7465 725f 6469 7265 6374   "{raster_direct
+00005b70: 696f 6e7d 222c 0d0a 2020 2020 2020 2020  ion}",..        
+00005b80: 6e6f 6465 5f74 7970 653d 2822 6f70 2072  node_type=("op r
+00005b90: 6173 7465 7222 2c20 226f 7020 696d 6167  aster", "op imag
+00005ba0: 6522 292c 0d0a 2020 2020 2020 2020 6865  e"),..        he
+00005bb0: 6c70 3d22 222c 0d0a 2020 2020 290d 0a20  lp="",..    ).. 
+00005bc0: 2020 2064 6566 2073 6574 5f64 6972 6563     def set_direc
+00005bd0: 7469 6f6e 286e 6f64 652c 2072 6173 7465  tion(node, raste
+00005be0: 725f 6469 7265 6374 696f 6e3d 2222 2c20  r_direction="", 
+00005bf0: 2a2a 6b77 6172 6773 293a 0d0a 2020 2020  **kwargs):..    
+00005c00: 2020 2020 7661 6c75 6573 203d 2067 6574      values = get
+00005c10: 5f64 6972 6563 7469 6f6e 5f76 616c 7565  _direction_value
+00005c20: 7328 290d 0a20 2020 2020 2020 2066 6f72  s()..        for
+00005c30: 2069 6478 2c20 6b65 7920 696e 2065 6e75   idx, key in enu
+00005c40: 6d65 7261 7465 2876 616c 7565 7329 3a0d  merate(values):.
+00005c50: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00005c60: 6b65 7920 3d3d 2072 6173 7465 725f 6469  key == raster_di
+00005c70: 7265 6374 696f 6e3a 0d0a 2020 2020 2020  rection:..      
+00005c80: 2020 2020 2020 2020 2020 6461 7461 203d            data =
+00005c90: 206c 6973 7428 290d 0a20 2020 2020 2020   list()..       
+00005ca0: 2020 2020 2020 2020 2066 6f72 206e 2069           for n i
+00005cb0: 6e20 6c69 7374 2873 656c 662e 6f70 7328  n list(self.ops(
+00005cc0: 7365 6c65 6374 6564 3d54 7275 6529 293a  selected=True)):
+00005cd0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00005ce0: 2020 2020 2020 6966 206e 2e74 7970 6520        if n.type 
+00005cf0: 6e6f 7420 696e 2028 226f 7020 7261 7374  not in ("op rast
+00005d00: 6572 222c 2022 6f70 2069 6d61 6765 2229  er", "op image")
+00005d10: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00005d20: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
+00005d30: 6e75 650d 0a20 2020 2020 2020 2020 2020  nue..           
+00005d40: 2020 2020 2020 2020 206e 2e72 6173 7465           n.raste
+00005d50: 725f 6469 7265 6374 696f 6e20 3d20 6964  r_direction = id
+00005d60: 780d 0a20 2020 2020 2020 2020 2020 2020  x..             
+00005d70: 2020 2020 2020 2064 6174 612e 6170 7065         data.appe
+00005d80: 6e64 286e 290d 0a20 2020 2020 2020 2020  nd(n)..         
+00005d90: 2020 2020 2020 2073 656c 662e 7369 676e         self.sign
+00005da0: 616c 2822 656c 656d 656e 745f 7072 6f70  al("element_prop
+00005db0: 6572 7479 5f72 656c 6f61 6422 2c20 6461  erty_reload", da
+00005dc0: 7461 290d 0a20 2020 2020 2020 2020 2020  ta)..           
+00005dd0: 2020 2020 2062 7265 616b 0d0a 0d0a 2020       break....  
+00005de0: 2020 6465 6620 6765 745f 7377 696e 675f    def get_swing_
+00005df0: 7661 6c75 6573 2829 3a0d 0a20 2020 2020  values():..     
+00005e00: 2020 2072 6574 7572 6e20 280d 0a20 2020     return (..   
+00005e10: 2020 2020 2020 2020 205f 2822 556e 6964           _("Unid
+00005e20: 6972 6563 7469 6f6e 616c 2229 2c0d 0a20  irectional"),.. 
+00005e30: 2020 2020 2020 2020 2020 205f 2822 4269             _("Bi
+00005e40: 6469 7265 6374 696f 6e61 6c22 292c 0d0a  directional"),..
+00005e50: 2020 2020 2020 2020 290d 0a0d 0a20 2020          )....   
+00005e60: 2064 6566 2072 6164 696f 5f6d 6174 6368   def radio_match
+00005e70: 5f73 7769 6e67 286e 6f64 652c 2072 6173  _swing(node, ras
+00005e80: 7465 725f 7377 696e 673d 2222 2c20 2a2a  ter_swing="", **
+00005e90: 6b77 6172 6773 293a 0d0a 2020 2020 2020  kwargs):..      
+00005ea0: 2020 7661 6c75 6573 203d 2067 6574 5f73    values = get_s
+00005eb0: 7769 6e67 5f76 616c 7565 7328 290d 0a20  wing_values().. 
+00005ec0: 2020 2020 2020 2066 6f72 2069 6478 2c20         for idx, 
+00005ed0: 6b65 7920 696e 2065 6e75 6d65 7261 7465  key in enumerate
+00005ee0: 2876 616c 7565 7329 3a0d 0a20 2020 2020  (values):..     
+00005ef0: 2020 2020 2020 2069 6620 6b65 7920 3d3d         if key ==
+00005f00: 2072 6173 7465 725f 7377 696e 673a 0d0a   raster_swing:..
+00005f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005f20: 7265 7475 726e 206e 6f64 652e 6269 6469  return node.bidi
+00005f30: 7265 6374 696f 6e61 6c20 3d3d 2069 6478  rectional == idx
+00005f40: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00005f50: 2046 616c 7365 0d0a 0d0a 2020 2020 4074   False....    @t
+00005f60: 7265 655f 7375 626d 656e 7528 5f28 2244  ree_submenu(_("D
+00005f70: 6972 6563 7469 6f6e 616c 2052 6173 7465  irectional Raste
+00005f80: 7222 2929 0d0a 2020 2020 4074 7265 655f  r"))..    @tree_
+00005f90: 7261 6469 6f28 7261 6469 6f5f 6d61 7463  radio(radio_matc
+00005fa0: 685f 7377 696e 6729 0d0a 2020 2020 4074  h_swing)..    @t
+00005fb0: 7265 655f 7661 6c75 6573 2822 7261 7374  ree_values("rast
+00005fc0: 6572 5f73 7769 6e67 222c 2076 616c 7565  er_swing", value
+00005fd0: 733d 6765 745f 7377 696e 675f 7661 6c75  s=get_swing_valu
+00005fe0: 6573 2829 290d 0a20 2020 2040 7472 6565  es())..    @tree
+00005ff0: 5f6f 7065 7261 7469 6f6e 280d 0a20 2020  _operation(..   
+00006000: 2020 2020 2022 7b72 6173 7465 725f 7377       "{raster_sw
+00006010: 696e 677d 222c 0d0a 2020 2020 2020 2020  ing}",..        
+00006020: 6e6f 6465 5f74 7970 653d 2822 6f70 2072  node_type=("op r
+00006030: 6173 7465 7222 2c20 226f 7020 696d 6167  aster", "op imag
+00006040: 6522 292c 0d0a 2020 2020 2020 2020 6865  e"),..        he
+00006050: 6c70 3d22 222c 0d0a 2020 2020 290d 0a20  lp="",..    ).. 
+00006060: 2020 2064 6566 2073 6574 5f73 7769 6e67     def set_swing
+00006070: 286e 6f64 652c 2072 6173 7465 725f 7377  (node, raster_sw
+00006080: 696e 673d 2222 2c20 2a2a 6b77 6172 6773  ing="", **kwargs
+00006090: 293a 0d0a 2020 2020 2020 2020 7661 6c75  ):..        valu
+000060a0: 6573 203d 2067 6574 5f73 7769 6e67 5f76  es = get_swing_v
+000060b0: 616c 7565 7328 290d 0a20 2020 2020 2020  alues()..       
+000060c0: 2066 6f72 2069 6478 2c20 6b65 7920 696e   for idx, key in
+000060d0: 2065 6e75 6d65 7261 7465 2876 616c 7565   enumerate(value
+000060e0: 7329 3a0d 0a20 2020 2020 2020 2020 2020  s):..           
+000060f0: 2069 6620 6b65 7920 3d3d 2072 6173 7465   if key == raste
+00006100: 725f 7377 696e 673a 0d0a 2020 2020 2020  r_swing:..      
+00006110: 2020 2020 2020 2020 2020 6461 7461 203d            data =
+00006120: 206c 6973 7428 290d 0a20 2020 2020 2020   list()..       
+00006130: 2020 2020 2020 2020 2066 6f72 206e 2069           for n i
+00006140: 6e20 6c69 7374 2873 656c 662e 6f70 7328  n list(self.ops(
+00006150: 7365 6c65 6374 6564 3d54 7275 6529 293a  selected=True)):
+00006160: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00006170: 2020 2020 2020 6966 206e 2e74 7970 6520        if n.type 
+00006180: 6e6f 7420 696e 2028 226f 7020 7261 7374  not in ("op rast
+00006190: 6572 222c 2022 6f70 2069 6d61 6765 2229  er", "op image")
+000061a0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+000061b0: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
+000061c0: 6e75 650d 0a20 2020 2020 2020 2020 2020  nue..           
+000061d0: 2020 2020 2020 2020 206e 2e62 6964 6972           n.bidir
+000061e0: 6563 7469 6f6e 616c 203d 2062 6f6f 6c28  ectional = bool(
+000061f0: 6964 7829 0d0a 2020 2020 2020 2020 2020  idx)..          
+00006200: 2020 2020 2020 2020 2020 6461 7461 2e61            data.a
+00006210: 7070 656e 6428 6e29 0d0a 2020 2020 2020  ppend(n)..      
+00006220: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
+00006230: 6967 6e61 6c28 2265 6c65 6d65 6e74 5f70  ignal("element_p
+00006240: 726f 7065 7274 795f 7265 6c6f 6164 222c  roperty_reload",
+00006250: 2064 6174 6129 0d0a 2020 2020 2020 2020   data)..        
+00006260: 2020 2020 2020 2020 6272 6561 6b0d 0a0d          break...
+00006270: 0a20 2020 2040 7472 6565 5f73 6570 6172  .    @tree_separ
+00006280: 6174 6f72 5f62 6566 6f72 6528 290d 0a20  ator_before().. 
+00006290: 2020 2040 7472 6565 5f6f 7065 7261 7469     @tree_operati
+000062a0: 6f6e 280d 0a20 2020 2020 2020 205f 2822  on(..        _("
+000062b0: 4578 6563 7574 6520 6f70 6572 6174 696f  Execute operatio
+000062c0: 6e28 7329 2229 2c0d 0a20 2020 2020 2020  n(s)"),..       
+000062d0: 206e 6f64 655f 7479 7065 3d6f 705f 6e6f   node_type=op_no
+000062e0: 6465 732c 0d0a 2020 2020 2020 2020 6865  des,..        he
+000062f0: 6c70 3d5f 2822 4578 6563 7574 6520 4a6f  lp=_("Execute Jo
+00006300: 6220 666f 7220 7468 6520 7365 6c65 6374  b for the select
+00006310: 6564 206f 7065 7261 7469 6f6e 2873 292e  ed operation(s).
+00006320: 2229 2c0d 0a20 2020 2029 0d0a 2020 2020  "),..    )..    
+00006330: 6465 6620 6578 6563 7574 655f 6a6f 6228  def execute_job(
+00006340: 6e6f 6465 2c20 2a2a 6b77 6172 6773 293a  node, **kwargs):
+00006350: 0d0a 2020 2020 2020 2020 7365 6c66 2e73  ..        self.s
+00006360: 6574 5f6e 6f64 655f 656d 7068 6173 6973  et_node_emphasis
+00006370: 286e 6f64 652c 2054 7275 6529 0d0a 2020  (node, True)..  
+00006380: 2020 2020 2020 7365 6c66 2822 706c 616e        self("plan
+00006390: 3020 636c 6561 7220 636f 7079 2d73 656c  0 clear copy-sel
+000063a0: 6563 7465 645c 6e22 290d 0a20 2020 2020  ected\n")..     
+000063b0: 2020 2073 656c 6628 2277 696e 646f 7720     self("window 
+000063c0: 6f70 656e 2045 7865 6375 7465 4a6f 6220  open ExecuteJob 
+000063d0: 305c 6e22 290d 0a0d 0a20 2020 2040 7472  0\n")....    @tr
+000063e0: 6565 5f73 6570 6172 6174 6f72 5f61 6674  ee_separator_aft
+000063f0: 6572 2829 0d0a 2020 2020 4074 7265 655f  er()..    @tree_
+00006400: 6f70 6572 6174 696f 6e28 0d0a 2020 2020  operation(..    
+00006410: 2020 2020 5f28 2253 696d 756c 6174 6520      _("Simulate 
+00006420: 6f70 6572 6174 696f 6e28 7329 2229 2c0d  operation(s)"),.
+00006430: 0a20 2020 2020 2020 206e 6f64 655f 7479  .        node_ty
+00006440: 7065 3d6f 705f 6e6f 6465 732c 0d0a 2020  pe=op_nodes,..  
+00006450: 2020 2020 2020 6865 6c70 3d5f 2822 5275        help=_("Ru
+00006460: 6e20 7369 6d75 6c61 7469 6f6e 2066 6f72  n simulation for
+00006470: 2074 6865 2073 656c 6563 7465 6420 6f70   the selected op
+00006480: 6572 6174 696f 6e28 7329 2229 2c0d 0a20  eration(s)"),.. 
+00006490: 2020 2029 0d0a 2020 2020 6465 6620 636f     )..    def co
+000064a0: 6d70 696c 655f 616e 645f 7369 6d75 6c61  mpile_and_simula
+000064b0: 7465 286e 6f64 652c 202a 2a6b 7761 7267  te(node, **kwarg
+000064c0: 7329 3a0d 0a20 2020 2020 2020 2073 656c  s):..        sel
+000064d0: 662e 7365 745f 6e6f 6465 5f65 6d70 6861  f.set_node_empha
+000064e0: 7369 7328 6e6f 6465 2c20 5472 7565 290d  sis(node, True).
+000064f0: 0a20 2020 2020 2020 2073 656c 6628 2270  .        self("p
+00006500: 6c61 6e30 2063 6f70 792d 7365 6c65 6374  lan0 copy-select
+00006510: 6564 2070 7265 7072 6f63 6573 7320 7661  ed preprocess va
+00006520: 6c69 6461 7465 2062 6c6f 6220 7072 656f  lidate blob preo
+00006530: 7074 206f 7074 696d 697a 655c 6e22 290d  pt optimize\n").
+00006540: 0a20 2020 2020 2020 2073 656c 6628 2277  .        self("w
+00006550: 696e 646f 7720 6f70 656e 2053 696d 756c  indow open Simul
+00006560: 6174 696f 6e20 3020 3120 315c 6e22 2920  ation 0 1 1\n") 
+00006570: 2023 2050 6c61 6e20 4e61 6d65 2c20 4175   # Plan Name, Au
+00006580: 746f 2d43 6c65 6172 2c20 4f70 7469 6d69  to-Clear, Optimi
+00006590: 7365 0d0a 0d0a 2020 2020 2320 3d3d 3d3d  se....    # ====
+000065a0: 3d3d 3d3d 3d3d 0d0a 2020 2020 2320 4765  ======..    # Ge
+000065b0: 6e65 7261 6c20 6d65 6e75 2d65 6e74 7269  neral menu-entri
+000065c0: 6573 2066 6f72 206f 7065 7261 7469 6f6e  es for operation
+000065d0: 2062 7261 6e63 680d 0a20 2020 2023 203d   branch..    # =
+000065e0: 3d3d 3d3d 3d3d 3d3d 3d0d 0a0d 0a20 2020  =========....   
+000065f0: 2040 7472 6565 5f6f 7065 7261 7469 6f6e   @tree_operation
+00006600: 285f 2822 476c 6f62 616c 2053 6574 7469  (_("Global Setti
+00006610: 6e67 7322 292c 206e 6f64 655f 7479 7065  ngs"), node_type
+00006620: 3d22 6272 616e 6368 206f 7073 222c 2068  ="branch ops", h
+00006630: 656c 703d 2222 290d 0a20 2020 2064 6566  elp="")..    def
+00006640: 206f 705f 7072 6f70 286e 6f64 652c 202a   op_prop(node, *
+00006650: 2a6b 7761 7267 7329 3a0d 0a20 2020 2020  *kwargs):..     
+00006660: 2020 2061 6374 6976 6174 6520 3d20 7365     activate = se
+00006670: 6c66 2e6b 6572 6e65 6c2e 6c6f 6f6b 7570  lf.kernel.lookup
+00006680: 2822 6675 6e63 7469 6f6e 2f6f 7065 6e5f  ("function/open_
+00006690: 7072 6f70 6572 7479 5f77 696e 646f 775f  property_window_
+000066a0: 666f 725f 6e6f 6465 2229 0d0a 2020 2020  for_node")..    
+000066b0: 2020 2020 6966 2061 6374 6976 6174 6520      if activate 
+000066c0: 6973 206e 6f74 204e 6f6e 653a 0d0a 2020  is not None:..  
+000066d0: 2020 2020 2020 2020 2020 6163 7469 7661            activa
+000066e0: 7465 286e 6f64 6529 0d0a 0d0a 2020 2020  te(node)....    
+000066f0: 4074 7265 655f 6f70 6572 6174 696f 6e28  @tree_operation(
+00006700: 5f28 2243 6c65 6172 2061 6c6c 2229 2c20  _("Clear all"), 
+00006710: 6e6f 6465 5f74 7970 653d 2262 7261 6e63  node_type="branc
+00006720: 6820 6f70 7322 2c20 6865 6c70 3d22 2229  h ops", help="")
+00006730: 0d0a 2020 2020 6465 6620 636c 6561 725f  ..    def clear_
+00006740: 616c 6c28 6e6f 6465 2c20 2a2a 6b77 6172  all(node, **kwar
+00006750: 6773 293a 0d0a 2020 2020 2020 2020 7365  gs):..        se
+00006760: 6c66 2822 6f70 6572 6174 696f 6e2a 2064  lf("operation* d
+00006770: 656c 6574 655c 6e22 290d 0a0d 0a20 2020  elete\n")....   
+00006780: 2040 7472 6565 5f6f 7065 7261 7469 6f6e   @tree_operation
+00006790: 280d 0a20 2020 2020 2020 205f 2822 436c  (..        _("Cl
+000067a0: 6561 7220 756e 7573 6564 2229 2c0d 0a20  ear unused"),.. 
+000067b0: 2020 2020 2020 206e 6f64 655f 7479 7065         node_type
+000067c0: 3d22 6272 616e 6368 206f 7073 222c 0d0a  ="branch ops",..
+000067d0: 2020 2020 2020 2020 6865 6c70 3d5f 2822          help=_("
+000067e0: 436c 6561 7220 6f70 6572 6174 696f 6e73  Clear operations
+000067f0: 2077 6974 686f 7574 2063 6869 6c64 7265   without childre
+00006800: 6e22 292c 0d0a 2020 2020 290d 0a20 2020  n"),..    )..   
+00006810: 2064 6566 2063 6c65 6172 5f75 6e75 7365   def clear_unuse
+00006820: 6428 6e6f 6465 2c20 2a2a 6b77 6172 6773  d(node, **kwargs
+00006830: 293a 0d0a 2020 2020 2020 2020 746f 5f64  ):..        to_d
+00006840: 656c 6574 6520 3d20 5b5d 0d0a 2020 2020  elete = []..    
+00006850: 2020 2020 666f 7220 6f70 2069 6e20 7365      for op in se
+00006860: 6c66 2e6f 7073 2829 3a0d 0a20 2020 2020  lf.ops():..     
+00006870: 2020 2020 2020 2023 2070 7269 6e74 2028         # print (
+00006880: 6622 7b6f 702e 7479 7065 7d2c 2072 6566  f"{op.type}, ref
+00006890: 733d 7b6c 656e 286f 702e 5f72 6566 6572  s={len(op._refer
+000068a0: 656e 6365 7329 7d2c 2063 6869 6c64 7265  ences)}, childre
+000068b0: 6e3d 7b6c 656e 286f 702e 5f63 6869 6c64  n={len(op._child
+000068c0: 7265 6e29 7d22 290d 0a20 2020 2020 2020  ren)}")..       
+000068d0: 2020 2020 2069 6620 6c65 6e28 6f70 2e5f       if len(op._
+000068e0: 6368 696c 6472 656e 2920 3d3d 2030 2061  children) == 0 a
+000068f0: 6e64 206e 6f74 206f 702e 7479 7065 203d  nd not op.type =
+00006900: 3d20 2262 6c6f 6222 3a0d 0a20 2020 2020  = "blob":..     
+00006910: 2020 2020 2020 2020 2020 2074 6f5f 6465             to_de
+00006920: 6c65 7465 2e61 7070 656e 6428 6f70 290d  lete.append(op).
+00006930: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
+00006940: 746f 5f64 656c 6574 6529 203e 2030 3a0d  to_delete) > 0:.
+00006950: 0a20 2020 2020 2020 2020 2020 2077 6974  .            wit
+00006960: 6820 7365 6c66 2e73 7461 7469 6328 2263  h self.static("c
+00006970: 6c65 6172 5f75 6e75 7365 6422 293a 0d0a  lear_unused"):..
+00006980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006990: 7365 6c66 2e72 656d 6f76 655f 6f70 6572  self.remove_oper
+000069a0: 6174 696f 6e73 2874 6f5f 6465 6c65 7465  ations(to_delete
+000069b0: 290d 0a0d 0a20 2020 2064 6566 2072 6164  )....    def rad
+000069c0: 696f 5f6d 6174 6368 5f73 7065 6564 5f61  io_match_speed_a
+000069d0: 6c6c 286e 6f64 652c 2073 7065 6564 3d30  ll(node, speed=0
+000069e0: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
+000069f0: 2020 2020 2020 6d61 7873 7065 6564 203d        maxspeed =
+00006a00: 2030 0d0a 2020 2020 2020 2020 666f 7220   0..        for 
+00006a10: 6e20 696e 206c 6973 7428 7365 6c66 2e6f  n in list(self.o
+00006a20: 7073 2829 293a 0d0a 2020 2020 2020 2020  ps()):..        
+00006a30: 2020 2020 6966 206e 6f74 2068 6173 6174      if not hasat
+00006a40: 7472 286e 2c20 2273 7065 6564 2229 3a0d  tr(n, "speed"):.
+00006a50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006a60: 2063 6f6e 7469 6e75 650d 0a20 2020 2020   continue..     
+00006a70: 2020 2020 2020 2069 6620 6e2e 7370 6565         if n.spee
+00006a80: 6420 6973 206e 6f74 204e 6f6e 653a 0d0a  d is not None:..
+00006a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006aa0: 6d61 7873 7065 6564 203d 206d 6178 286d  maxspeed = max(m
+00006ab0: 6178 7370 6565 642c 206e 2e73 7065 6564  axspeed, n.speed
+00006ac0: 290d 0a20 2020 2020 2020 2072 6574 7572  )..        retur
+00006ad0: 6e20 626f 6f6c 2861 6273 286d 6178 7370  n bool(abs(maxsp
+00006ae0: 6565 6420 2d20 666c 6f61 7428 7370 6565  eed - float(spee
+00006af0: 6429 2920 3c20 302e 3529 0d0a 0d0a 2020  d)) < 0.5)....  
+00006b00: 2020 4074 7265 655f 7375 626d 656e 7528    @tree_submenu(
+00006b10: 5f28 2253 6361 6c65 2073 7065 6564 2073  _("Scale speed s
+00006b20: 6574 7469 6e67 7322 2929 0d0a 2020 2020  ettings"))..    
+00006b30: 4074 7265 655f 7261 6469 6f28 7261 6469  @tree_radio(radi
+00006b40: 6f5f 6d61 7463 685f 7370 6565 645f 616c  o_match_speed_al
+00006b50: 6c29 0d0a 2020 2020 4074 7265 655f 7661  l)..    @tree_va
+00006b60: 6c75 6573 2822 7370 6565 6422 2c20 2835  lues("speed", (5
+00006b70: 2c20 3130 2c20 3530 2c20 3735 2c20 3130  , 10, 50, 75, 10
+00006b80: 302c 2031 3530 2c20 3230 302c 2032 3530  0, 150, 200, 250
+00006b90: 2c20 3330 302c 2033 3530 2c20 3430 302c  , 300, 350, 400,
+00006ba0: 2034 3530 2c20 3530 3029 290d 0a20 2020   450, 500))..   
+00006bb0: 2040 7472 6565 5f6f 7065 7261 7469 6f6e   @tree_operation
+00006bc0: 280d 0a20 2020 2020 2020 205f 2822 4d61  (..        _("Ma
+00006bd0: 7820 7370 6565 6420 3d20 7b73 7065 6564  x speed = {speed
+00006be0: 7d6d 6d2f 7322 292c 0d0a 2020 2020 2020  }mm/s"),..      
+00006bf0: 2020 6e6f 6465 5f74 7970 653d 2262 7261    node_type="bra
+00006c00: 6e63 6820 6f70 7322 2c0d 0a20 2020 2020  nch ops",..     
+00006c10: 2020 2068 656c 703d 2222 2c0d 0a20 2020     help="",..   
+00006c20: 2029 0d0a 2020 2020 6465 6620 7365 745f   )..    def set_
+00006c30: 7370 6565 645f 6c65 7665 6c73 286e 6f64  speed_levels(nod
+00006c40: 652c 2073 7065 6564 3d31 3530 2c20 2a2a  e, speed=150, **
+00006c50: 6b77 6172 6773 293a 0d0a 2020 2020 2020  kwargs):..      
+00006c60: 2020 6461 7461 203d 206c 6973 7428 290d    data = list().
+00006c70: 0a20 2020 2020 2020 206d 6178 7370 6565  .        maxspee
+00006c80: 6420 3d20 300d 0a20 2020 2020 2020 2066  d = 0..        f
+00006c90: 6f72 206e 2069 6e20 6c69 7374 2873 656c  or n in list(sel
+00006ca0: 662e 6f70 7328 2929 3a0d 0a20 2020 2020  f.ops()):..     
+00006cb0: 2020 2020 2020 2069 6620 6861 7361 7474         if hasatt
+00006cc0: 7228 6e6f 6465 2c20 2273 7065 6564 2229  r(node, "speed")
+00006cd0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00006ce0: 2020 2069 6620 6e2e 7370 6565 6420 6973     if n.speed is
+00006cf0: 206e 6f74 204e 6f6e 653a 0d0a 2020 2020   not None:..    
+00006d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006d10: 6d61 7873 7065 6564 203d 206d 6178 286d  maxspeed = max(m
+00006d20: 6178 7370 6565 642c 206e 2e73 7065 6564  axspeed, n.speed
+00006d30: 290d 0a20 2020 2020 2020 2069 6620 6d61  )..        if ma
+00006d40: 7873 7065 6564 203d 3d20 303a 0d0a 2020  xspeed == 0:..  
+00006d50: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00006d60: 0d0a 2020 2020 2020 2020 666f 7220 6e20  ..        for n 
+00006d70: 696e 206c 6973 7428 7365 6c66 2e6f 7073  in list(self.ops
+00006d80: 2829 293a 0d0a 2020 2020 2020 2020 2020  ()):..          
+00006d90: 2020 6966 206e 6f74 2068 6173 6174 7472    if not hasattr
+00006da0: 286e 6f64 652c 2022 7370 6565 6422 293a  (node, "speed"):
+00006db0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00006dc0: 2020 636f 6e74 696e 7565 0d0a 2020 2020    continue..    
+00006dd0: 2020 2020 2020 2020 6966 206e 2e73 7065          if n.spe
+00006de0: 6564 2069 7320 6e6f 7420 4e6f 6e65 3a0d  ed is not None:.
+00006df0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006e00: 206f 6c64 7370 6565 6420 3d20 666c 6f61   oldspeed = floa
+00006e10: 7428 6e2e 7370 6565 6429 0d0a 2020 2020  t(n.speed)..    
+00006e20: 2020 2020 2020 2020 2020 2020 6e65 7773              news
+00006e30: 7065 6564 203d 206f 6c64 7370 6565 6420  peed = oldspeed 
+00006e40: 2f20 6d61 7873 7065 6564 202a 2073 7065  / maxspeed * spe
+00006e50: 6564 0d0a 2020 2020 2020 2020 2020 2020  ed..            
+00006e60: 2020 2020 6e2e 7370 6565 6420 3d20 666c      n.speed = fl
+00006e70: 6f61 7428 6e65 7773 7065 6564 290d 0a20  oat(newspeed).. 
+00006e80: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00006e90: 6174 612e 6170 7065 6e64 286e 290d 0a20  ata.append(n).. 
+00006ea0: 2020 2020 2020 2073 656c 662e 7369 676e         self.sign
+00006eb0: 616c 2822 656c 656d 656e 745f 7072 6f70  al("element_prop
+00006ec0: 6572 7479 5f72 656c 6f61 6422 2c20 6461  erty_reload", da
+00006ed0: 7461 290d 0a0d 0a20 2020 2064 6566 2072  ta)....    def r
+00006ee0: 6164 696f 5f6d 6174 6368 5f70 6f77 6572  adio_match_power
+00006ef0: 5f61 6c6c 286e 6f64 652c 2070 6f77 6572  _all(node, power
+00006f00: 3d30 2c20 2a2a 6b77 6172 6773 293a 0d0a  =0, **kwargs):..
+00006f10: 2020 2020 2020 2020 6d61 7870 6f77 6572          maxpower
+00006f20: 203d 2030 0d0a 2020 2020 2020 2020 666f   = 0..        fo
+00006f30: 7220 6e20 696e 206c 6973 7428 7365 6c66  r n in list(self
+00006f40: 2e6f 7073 2829 293a 0d0a 2020 2020 2020  .ops()):..      
+00006f50: 2020 2020 2020 6966 206e 6f74 2068 6173        if not has
+00006f60: 6174 7472 286e 2c20 2270 6f77 6572 2229  attr(n, "power")
+00006f70: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00006f80: 2020 2063 6f6e 7469 6e75 650d 0a20 2020     continue..   
+00006f90: 2020 2020 2020 2020 2069 6620 6e2e 706f           if n.po
+00006fa0: 7765 7220 6973 206e 6f74 204e 6f6e 653a  wer is not None:
+00006fb0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00006fc0: 2020 6d61 7870 6f77 6572 203d 206d 6178    maxpower = max
+00006fd0: 286d 6178 706f 7765 722c 206e 2e70 6f77  (maxpower, n.pow
+00006fe0: 6572 290d 0a20 2020 2020 2020 2072 6574  er)..        ret
+00006ff0: 7572 6e20 626f 6f6c 2861 6273 286d 6178  urn bool(abs(max
+00007000: 706f 7765 7220 2d20 666c 6f61 7428 706f  power - float(po
+00007010: 7765 7229 2920 3c20 302e 3529 0d0a 0d0a  wer)) < 0.5)....
+00007020: 2020 2020 4074 7265 655f 7375 626d 656e      @tree_submen
+00007030: 7528 5f28 2253 6361 6c65 2070 6f77 6572  u(_("Scale power
+00007040: 2073 6574 7469 6e67 7322 2929 0d0a 2020   settings"))..  
+00007050: 2020 4074 7265 655f 7261 6469 6f28 7261    @tree_radio(ra
+00007060: 6469 6f5f 6d61 7463 685f 706f 7765 725f  dio_match_power_
+00007070: 616c 6c29 0d0a 2020 2020 4074 7265 655f  all)..    @tree_
+00007080: 7661 6c75 6573 2822 706f 7765 7222 2c20  values("power", 
+00007090: 2831 3030 2c20 3235 302c 2033 3333 2c20  (100, 250, 333, 
+000070a0: 3530 302c 2036 3637 2c20 3735 302c 2031  500, 667, 750, 1
+000070b0: 3030 3029 290d 0a20 2020 2040 7472 6565  000))..    @tree
+000070c0: 5f63 616c 6328 2270 6f77 6572 5f31 3022  _calc("power_10"
+000070d0: 2c20 6c61 6d62 6461 2069 3a20 726f 756e  , lambda i: roun
+000070e0: 6428 6920 2f20 3130 2c20 3129 290d 0a20  d(i / 10, 1)).. 
+000070f0: 2020 2040 7472 6565 5f6f 7065 7261 7469     @tree_operati
+00007100: 6f6e 280d 0a20 2020 2020 2020 205f 2822  on(..        _("
+00007110: 4d61 7820 706f 7765 7220 3d20 7b70 6f77  Max power = {pow
+00007120: 6572 7d70 7069 2028 7b70 6f77 6572 5f31  er}ppi ({power_1
+00007130: 307d 2529 2229 2c0d 0a20 2020 2020 2020  0}%)"),..       
+00007140: 206e 6f64 655f 7479 7065 3d22 6272 616e   node_type="bran
+00007150: 6368 206f 7073 222c 0d0a 2020 2020 2020  ch ops",..      
+00007160: 2020 6865 6c70 3d22 222c 0d0a 2020 2020    help="",..    
+00007170: 290d 0a20 2020 2064 6566 2073 6574 5f70  )..    def set_p
+00007180: 6f77 6572 5f6c 6576 656c 7328 6e6f 6465  ower_levels(node
+00007190: 2c20 706f 7765 723d 3130 3030 2c20 2a2a  , power=1000, **
+000071a0: 6b77 6172 6773 293a 0d0a 2020 2020 2020  kwargs):..      
+000071b0: 2020 6461 7461 203d 206c 6973 7428 290d    data = list().
+000071c0: 0a20 2020 2020 2020 206d 6178 706f 7765  .        maxpowe
+000071d0: 7220 3d20 300d 0a20 2020 2020 2020 2066  r = 0..        f
+000071e0: 6f72 206e 2069 6e20 6c69 7374 2873 656c  or n in list(sel
+000071f0: 662e 6f70 7328 2929 3a0d 0a20 2020 2020  f.ops()):..     
+00007200: 2020 2020 2020 2069 6620 6e6f 7420 6861         if not ha
+00007210: 7361 7474 7228 6e2c 2022 706f 7765 7222  sattr(n, "power"
+00007220: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00007230: 2020 2020 636f 6e74 696e 7565 0d0a 2020      continue..  
+00007240: 2020 2020 2020 2020 2020 6966 206e 2e70            if n.p
+00007250: 6f77 6572 2069 7320 6e6f 7420 4e6f 6e65  ower is not None
+00007260: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00007270: 2020 206d 6178 706f 7765 7220 3d20 6d61     maxpower = ma
+00007280: 7828 6d61 7870 6f77 6572 2c20 6e2e 706f  x(maxpower, n.po
+00007290: 7765 7229 0d0a 2020 2020 2020 2020 6966  wer)..        if
+000072a0: 206d 6178 706f 7765 7220 3d3d 2030 3a0d   maxpower == 0:.
+000072b0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+000072c0: 7572 6e0d 0a20 2020 2020 2020 2066 6f72  urn..        for
+000072d0: 206e 2069 6e20 6c69 7374 2873 656c 662e   n in list(self.
+000072e0: 6f70 7328 2929 3a0d 0a20 2020 2020 2020  ops()):..       
+000072f0: 2020 2020 2069 6620 6e6f 7420 6861 7361       if not hasa
+00007300: 7474 7228 6e2c 2022 706f 7765 7222 293a  ttr(n, "power"):
+00007310: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00007320: 2020 636f 6e74 696e 7565 0d0a 2020 2020    continue..    
+00007330: 2020 2020 2020 2020 6966 206e 2e70 6f77          if n.pow
+00007340: 6572 2069 7320 6e6f 7420 4e6f 6e65 3a0d  er is not None:.
+00007350: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007360: 206f 6c64 706f 7765 7220 3d20 666c 6f61   oldpower = floa
+00007370: 7428 6e2e 706f 7765 7229 0d0a 2020 2020  t(n.power)..    
+00007380: 2020 2020 2020 2020 2020 2020 6e65 7770              newp
+00007390: 6f77 6572 203d 206f 6c64 706f 7765 7220  ower = oldpower 
+000073a0: 2f20 6d61 7870 6f77 6572 202a 2070 6f77  / maxpower * pow
+000073b0: 6572 0d0a 2020 2020 2020 2020 2020 2020  er..            
+000073c0: 2020 2020 6e2e 706f 7765 7220 3d20 666c      n.power = fl
+000073d0: 6f61 7428 6e65 7770 6f77 6572 290d 0a20  oat(newpower).. 
+000073e0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+000073f0: 6174 612e 6170 7065 6e64 286e 290d 0a20  ata.append(n).. 
+00007400: 2020 2020 2020 2073 656c 662e 7369 676e         self.sign
+00007410: 616c 2822 656c 656d 656e 745f 7072 6f70  al("element_prop
+00007420: 6572 7479 5f72 656c 6f61 6422 2c20 6461  erty_reload", da
+00007430: 7461 290d 0a0d 0a20 2020 2064 6566 2073  ta)....    def s
+00007440: 6574 5f6f 705f 6f75 7470 7574 286f 7073  et_op_output(ops
+00007450: 2c20 7661 6c75 6529 3a0d 0a20 2020 2020  , value):..     
+00007460: 2020 206e 6577 7661 6c75 6520 3d20 7661     newvalue = va
+00007470: 6c75 650d 0a20 2020 2020 2020 2066 6f72  lue..        for
+00007480: 206e 2069 6e20 6f70 733a 0d0a 2020 2020   n in ops:..    
+00007490: 2020 2020 2020 2020 6966 2076 616c 7565          if value
+000074a0: 2069 7320 4e6f 6e65 3a0d 0a20 2020 2020   is None:..     
+000074b0: 2020 2020 2020 2020 2020 206e 6577 7661             newva
+000074c0: 6c75 6520 3d20 6e6f 7420 6e2e 6f75 7470  lue = not n.outp
+000074d0: 7574 0d0a 2020 2020 2020 2020 2020 2020  ut..            
+000074e0: 7472 793a 0d0a 2020 2020 2020 2020 2020  try:..          
+000074f0: 2020 2020 2020 6e2e 6f75 7470 7574 203d        n.output =
+00007500: 206e 6577 7661 6c75 650d 0a20 2020 2020   newvalue..     
+00007510: 2020 2020 2020 2020 2020 206e 2e75 7064             n.upd
+00007520: 6174 6564 2829 0d0a 2020 2020 2020 2020  ated()..        
+00007530: 2020 2020 6578 6365 7074 2041 7474 7269      except Attri
+00007540: 6275 7465 4572 726f 723a 0d0a 2020 2020  buteError:..    
+00007550: 2020 2020 2020 2020 2020 2020 7061 7373              pass
+00007560: 0d0a 2020 2020 2020 2020 7365 6c66 2e73  ..        self.s
+00007570: 6967 6e61 6c28 2265 6c65 6d65 6e74 5f70  ignal("element_p
+00007580: 726f 7065 7274 795f 7570 6461 7465 222c  roperty_update",
+00007590: 206f 7073 290d 0a0d 0a20 2020 2040 7472   ops)....    @tr
+000075a0: 6565 5f73 6570 6172 6174 6f72 5f62 6566  ee_separator_bef
+000075b0: 6f72 6528 290d 0a20 2020 2040 7472 6565  ore()..    @tree
+000075c0: 5f6f 7065 7261 7469 6f6e 280d 0a20 2020  _operation(..   
+000075d0: 2020 2020 205f 2822 456e 6162 6c65 2061       _("Enable a
+000075e0: 6c6c 206f 7065 7261 7469 6f6e 7322 292c  ll operations"),
+000075f0: 0d0a 2020 2020 2020 2020 6e6f 6465 5f74  ..        node_t
+00007600: 7970 653d 2262 7261 6e63 6820 6f70 7322  ype="branch ops"
+00007610: 2c0d 0a20 2020 2020 2020 2068 656c 703d  ,..        help=
+00007620: 5f28 2245 6e61 626c 6520 616c 6c20 6f70  _("Enable all op
+00007630: 6572 6174 696f 6e73 2229 2c0d 0a20 2020  erations"),..   
+00007640: 2029 0d0a 2020 2020 6465 6620 6f70 735f   )..    def ops_
+00007650: 656e 6162 6c65 5f61 6c6c 286e 6f64 652c  enable_all(node,
+00007660: 202a 2a6b 7761 7267 7329 3a0d 0a20 2020   **kwargs):..   
+00007670: 2020 2020 2073 6574 5f6f 705f 6f75 7470       set_op_outp
+00007680: 7574 286c 6973 7428 7365 6c66 2e6f 7073  ut(list(self.ops
+00007690: 2829 292c 2054 7275 6529 0d0a 0d0a 2020  ()), True)....  
+000076a0: 2020 4074 7265 655f 6f70 6572 6174 696f    @tree_operatio
+000076b0: 6e28 0d0a 2020 2020 2020 2020 5f28 2244  n(..        _("D
+000076c0: 6973 6162 6c65 2061 6c6c 206f 7065 7261  isable all opera
+000076d0: 7469 6f6e 7322 292c 0d0a 2020 2020 2020  tions"),..      
+000076e0: 2020 6e6f 6465 5f74 7970 653d 2262 7261    node_type="bra
+000076f0: 6e63 6820 6f70 7322 2c0d 0a20 2020 2020  nch ops",..     
+00007700: 2020 2068 656c 703d 5f28 2244 6973 6162     help=_("Disab
+00007710: 6c65 2061 6c6c 206f 7065 7261 7469 6f6e  le all operation
+00007720: 7322 292c 0d0a 2020 2020 290d 0a20 2020  s"),..    )..   
+00007730: 2064 6566 206f 7073 5f64 6973 6162 6c65   def ops_disable
+00007740: 5f61 6c6c 286e 6f64 652c 202a 2a6b 7761  _all(node, **kwa
+00007750: 7267 7329 3a0d 0a20 2020 2020 2020 2073  rgs):..        s
+00007760: 6574 5f6f 705f 6f75 7470 7574 286c 6973  et_op_output(lis
+00007770: 7428 7365 6c66 2e6f 7073 2829 292c 2046  t(self.ops()), F
+00007780: 616c 7365 290d 0a0d 0a20 2020 2040 7472  alse)....    @tr
+00007790: 6565 5f73 6570 6172 6174 6f72 5f61 6674  ee_separator_aft
+000077a0: 6572 2829 0d0a 2020 2020 4074 7265 655f  er()..    @tree_
+000077b0: 6f70 6572 6174 696f 6e28 0d0a 2020 2020  operation(..    
+000077c0: 2020 2020 5f28 2254 6f67 676c 6520 616c      _("Toggle al
+000077d0: 6c20 6f70 6572 6174 696f 6e73 2229 2c0d  l operations"),.
+000077e0: 0a20 2020 2020 2020 206e 6f64 655f 7479  .        node_ty
+000077f0: 7065 3d22 6272 616e 6368 206f 7073 222c  pe="branch ops",
+00007800: 0d0a 2020 2020 2020 2020 6865 6c70 3d5f  ..        help=_
+00007810: 2822 546f 6767 6c65 2065 6e61 626c 6564  ("Toggle enabled
+00007820: 2d73 7461 7475 7320 6f66 2061 6c6c 206f  -status of all o
+00007830: 7065 7261 7469 6f6e 7322 292c 0d0a 2020  perations"),..  
+00007840: 2020 290d 0a20 2020 2064 6566 206f 7073    )..    def ops
+00007850: 5f74 6f67 676c 655f 616c 6c28 6e6f 6465  _toggle_all(node
+00007860: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
+00007870: 2020 2020 2020 7365 745f 6f70 5f6f 7574        set_op_out
+00007880: 7075 7428 6c69 7374 2873 656c 662e 6f70  put(list(self.op
+00007890: 7328 2929 2c20 4e6f 6e65 290d 0a0d 0a20  s()), None).... 
+000078a0: 2020 2023 203d 3d3d 3d3d 3d3d 3d3d 3d0d     # ==========.
+000078b0: 0a20 2020 2023 2047 656e 6572 616c 206d  .    # General m
+000078c0: 656e 752d 656e 7472 6965 7320 666f 7220  enu-entries for 
+000078d0: 656c 656d 2062 7261 6e63 680d 0a20 2020  elem branch..   
+000078e0: 2023 203d 3d3d 3d3d 3d3d 3d3d 3d0d 0a0d   # ==========...
+000078f0: 0a20 2020 2040 7472 6565 5f6f 7065 7261  .    @tree_opera
+00007900: 7469 6f6e 285f 2822 436c 6561 7220 616c  tion(_("Clear al
+00007910: 6c22 292c 206e 6f64 655f 7479 7065 3d22  l"), node_type="
+00007920: 6272 616e 6368 2065 6c65 6d73 222c 2068  branch elems", h
+00007930: 656c 703d 2222 290d 0a20 2020 2064 6566  elp="")..    def
+00007940: 2063 6c65 6172 5f61 6c6c 5f65 6c65 6d73   clear_all_elems
+00007950: 286e 6f64 652c 202a 2a6b 7761 7267 7329  (node, **kwargs)
+00007960: 3a0d 0a20 2020 2020 2020 2023 2073 656c  :..        # sel
+00007970: 6628 2265 6c65 6d65 6e74 2a20 6465 6c65  f("element* dele
+00007980: 7465 5c6e 2229 0d0a 2020 2020 2020 2020  te\n")..        
+00007990: 7769 7468 2073 656c 662e 7374 6174 6963  with self.static
+000079a0: 2822 636c 6561 725f 656c 656d 7322 293a  ("clear_elems"):
+000079b0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+000079c0: 6c66 2e65 6c65 6d5f 6272 616e 6368 2e72  lf.elem_branch.r
+000079d0: 656d 6f76 655f 616c 6c5f 6368 696c 6472  emove_all_childr
+000079e0: 656e 2829 0d0a 0d0a 2020 2020 2320 3d3d  en()....    # ==
+000079f0: 3d3d 3d3d 3d3d 3d3d 0d0a 2020 2020 2320  ========..    # 
+00007a00: 4765 6e65 7261 6c20 6d65 6e75 2d65 6e74  General menu-ent
+00007a10: 7269 6573 2066 6f72 2072 6567 6d61 726b  ries for regmark
+00007a20: 2062 7261 6e63 680d 0a20 2020 2023 203d   branch..    # =
+00007a30: 3d3d 3d3d 3d3d 3d3d 3d0d 0a0d 0a20 2020  =========....   
+00007a40: 2040 7472 6565 5f6f 7065 7261 7469 6f6e   @tree_operation
+00007a50: 285f 2822 436c 6561 7220 616c 6c22 292c  (_("Clear all"),
+00007a60: 206e 6f64 655f 7479 7065 3d22 6272 616e   node_type="bran
+00007a70: 6368 2072 6567 222c 2068 656c 703d 2222  ch reg", help=""
+00007a80: 290d 0a20 2020 2064 6566 2063 6c65 6172  )..    def clear
+00007a90: 5f61 6c6c 5f72 6567 6d61 726b 7328 6e6f  _all_regmarks(no
+00007aa0: 6465 2c20 2a2a 6b77 6172 6773 293a 0d0a  de, **kwargs):..
+00007ab0: 2020 2020 2020 2020 7769 7468 2073 656c          with sel
+00007ac0: 662e 7374 6174 6963 2822 636c 6561 725f  f.static("clear_
+00007ad0: 7265 676d 6172 6b73 2229 3a0d 0a20 2020  regmarks"):..   
+00007ae0: 2020 2020 2020 2020 2073 656c 662e 7265           self.re
+00007af0: 675f 6272 616e 6368 2e72 656d 6f76 655f  g_branch.remove_
+00007b00: 616c 6c5f 6368 696c 6472 656e 2829 0d0a  all_children()..
+00007b10: 0d0a 2020 2020 2320 3d3d 3d3d 3d3d 3d3d  ..    # ========
+00007b20: 3d3d 0d0a 2020 2020 2320 5245 4d4f 5645  ==..    # REMOVE
+00007b30: 204d 554c 5449 2028 5472 6565 2053 656c   MULTI (Tree Sel
+00007b40: 6563 7465 6429 0d0a 2020 2020 2320 3d3d  ected)..    # ==
+00007b50: 3d3d 3d3d 3d3d 3d3d 0d0a 2020 2020 2320  ========..    # 
+00007b60: 4361 6c63 756c 6174 6520 7468 6520 616d  Calculate the am
+00007b70: 6f75 6e74 206f 6620 7365 6c65 6374 6564  ount of selected
+00007b80: 206e 6f64 6573 2069 6e20 7468 6520 7472   nodes in the tr
+00007b90: 6565 3a0d 0a20 2020 2023 2049 6620 7468  ee:..    # If th
+00007ba0: 6572 6520 6172 6520 6f70 7320 7365 6c65  ere are ops sele
+00007bb0: 6374 6564 2074 6865 6e20 7468 6579 2074  cted then they t
+00007bc0: 616b 6520 7072 6563 6564 656e 6365 0d0a  ake precedence..
+00007bd0: 2020 2020 2320 616e 6420 7769 6c6c 206f      # and will o
+00007be0: 6e6c 7920 6265 2063 6f75 6e74 6564 0d0a  nly be counted..
+00007bf0: 0d0a 2020 2020 4074 7265 655f 636f 6e64  ..    @tree_cond
+00007c00: 6974 696f 6e61 6c28 0d0a 2020 2020 2020  itional(..      
+00007c10: 2020 6c61 6d62 6461 2063 6f6e 643a 206c    lambda cond: l
+00007c20: 656e 280d 0a20 2020 2020 2020 2020 2020  en(..           
+00007c30: 206c 6973 7428 7365 6c66 2e66 6c61 7428   list(self.flat(
+00007c40: 7365 6c65 6374 6564 3d54 7275 652c 2063  selected=True, c
+00007c50: 6173 6361 6465 3d46 616c 7365 2c20 7479  ascade=False, ty
+00007c60: 7065 733d 2272 6566 6572 656e 6365 2229  pes="reference")
+00007c70: 290d 0a20 2020 2020 2020 2029 0d0a 2020  )..        )..  
+00007c80: 2020 2020 2020 3e3d 2031 0d0a 2020 2020        >= 1..    
+00007c90: 290d 0a20 2020 2040 7472 6565 5f63 616c  )..    @tree_cal
+00007ca0: 6328 0d0a 2020 2020 2020 2020 2265 636f  c(..        "eco
+00007cb0: 756e 7422 2c0d 0a20 2020 2020 2020 206c  unt",..        l
+00007cc0: 616d 6264 6120 693a 206c 656e 286c 6973  ambda i: len(lis
+00007cd0: 7428 7365 6c66 2e66 6c61 7428 7365 6c65  t(self.flat(sele
+00007ce0: 6374 6564 3d54 7275 652c 2063 6173 6361  cted=True, casca
+00007cf0: 6465 3d46 616c 7365 2c20 7479 7065 733d  de=False, types=
+00007d00: 2272 6566 6572 656e 6365 2229 2929 2c0d  "reference"))),.
+00007d10: 0a20 2020 2029 0d0a 2020 2020 4074 7265  .    )..    @tre
+00007d20: 655f 6f70 6572 6174 696f 6e28 0d0a 2020  e_operation(..  
+00007d30: 2020 2020 2020 5f28 2252 656d 6f76 6520        _("Remove 
+00007d40: 7b65 636f 756e 747d 2073 656c 6563 7465  {ecount} selecte
+00007d50: 6420 6974 656d 7320 6672 6f6d 206f 7065  d items from ope
+00007d60: 7261 7469 6f6e 7322 292c 0d0a 2020 2020  rations"),..    
+00007d70: 2020 2020 6e6f 6465 5f74 7970 653d 2272      node_type="r
+00007d80: 6566 6572 656e 6365 222c 0d0a 2020 2020  eference",..    
+00007d90: 2020 2020 6865 6c70 3d22 222c 0d0a 2020      help="",..  
+00007da0: 2020 290d 0a20 2020 2064 6566 2072 656d    )..    def rem
+00007db0: 6f76 655f 6d75 6c74 695f 7265 6665 7265  ove_multi_refere
+00007dc0: 6e63 6573 286e 6f64 652c 202a 2a6b 7761  nces(node, **kwa
+00007dd0: 7267 7329 3a0d 0a20 2020 2020 2020 206e  rgs):..        n
+00007de0: 6f64 6573 203d 206c 6973 7428 7365 6c66  odes = list(self
+00007df0: 2e66 6c61 7428 7365 6c65 6374 6564 3d54  .flat(selected=T
+00007e00: 7275 652c 2063 6173 6361 6465 3d46 616c  rue, cascade=Fal
+00007e10: 7365 2c20 7479 7065 733d 2272 6566 6572  se, types="refer
+00007e20: 656e 6365 2229 290d 0a20 2020 2020 2020  ence"))..       
+00007e30: 2066 6f72 206e 6f64 6520 696e 206e 6f64   for node in nod
+00007e40: 6573 3a0d 0a20 2020 2020 2020 2020 2020  es:..           
+00007e50: 2069 6620 6e6f 6465 2e70 6172 656e 7420   if node.parent 
+00007e60: 6973 206e 6f74 204e 6f6e 653a 2020 2320  is not None:  # 
+00007e70: 4d61 7920 6861 7665 2061 6c72 6561 6479  May have already
+00007e80: 2072 656d 6f76 6564 2e0d 0a20 2020 2020   removed...     
+00007e90: 2020 2020 2020 2020 2020 206e 6f64 652e             node.
+00007ea0: 7265 6d6f 7665 5f6e 6f64 6528 290d 0a20  remove_node().. 
+00007eb0: 2020 2020 2020 2073 656c 662e 7365 745f         self.set_
+00007ec0: 656d 7068 6173 6973 284e 6f6e 6529 0d0a  emphasis(None)..
+00007ed0: 2020 2020 2020 2020 7365 6c66 2e73 6967          self.sig
+00007ee0: 6e61 6c28 2272 6566 7265 7368 5f74 7265  nal("refresh_tre
+00007ef0: 6522 290d 0a0d 0a20 2020 2023 2040 7472  e")....    # @tr
+00007f00: 6565 5f63 6f6e 6469 7469 6f6e 616c 280d  ee_conditional(.
+00007f10: 0a20 2020 2023 2020 2020 206c 616d 6264  .    #     lambd
+00007f20: 6120 636f 6e64 3a20 6c65 6e28 0d0a 2020  a cond: len(..  
+00007f30: 2020 2320 2020 2020 2020 2020 6c69 7374    #         list
+00007f40: 2873 656c 662e 666c 6174 2873 656c 6563  (self.flat(selec
+00007f50: 7465 643d 5472 7565 2c20 6361 7363 6164  ted=True, cascad
+00007f60: 653d 4661 6c73 652c 2074 7970 6573 3d6f  e=False, types=o
+00007f70: 7065 7261 7465 5f6e 6f64 6573 2929 0d0a  perate_nodes))..
+00007f80: 2020 2020 2320 2020 2020 290d 0a20 2020      #     )..   
+00007f90: 2023 2020 2020 2069 6620 6c65 6e28 6c69   #     if len(li
+00007fa0: 7374 2873 656c 662e 666c 6174 2873 656c  st(self.flat(sel
+00007fb0: 6563 7465 643d 5472 7565 2c20 6361 7363  ected=True, casc
+00007fc0: 6164 653d 4661 6c73 652c 2074 7970 6573  ade=False, types
+00007fd0: 3d6f 7065 7261 7465 5f6e 6f64 6573 2929  =operate_nodes))
+00007fe0: 290d 0a20 2020 2023 2020 2020 203e 2030  )..    #     > 0
+00007ff0: 0d0a 2020 2020 2320 2020 2020 656c 7365  ..    #     else
+00008000: 206c 656e 280d 0a20 2020 2023 2020 2020   len(..    #    
+00008010: 2020 2020 206c 6973 7428 7365 6c66 2e66       list(self.f
+00008020: 6c61 7428 7365 6c65 6374 6564 3d54 7275  lat(selected=Tru
+00008030: 652c 2063 6173 6361 6465 3d46 616c 7365  e, cascade=False
+00008040: 2c20 7479 7065 733d 656c 656d 5f67 726f  , types=elem_gro
+00008050: 7570 5f6e 6f64 6573 2929 0d0a 2020 2020  up_nodes))..    
+00008060: 2320 2020 2020 290d 0a20 2020 2023 2020  #     )..    #  
+00008070: 2020 203e 2031 0d0a 2020 2020 2320 290d     > 1..    # ).
+00008080: 0a20 2020 2023 2040 7472 6565 5f63 616c  .    # @tree_cal
+00008090: 6328 0d0a 2020 2020 2320 2020 2020 2265  c(..    #     "e
+000080a0: 636f 756e 7422 2c0d 0a20 2020 2023 2020  count",..    #  
+000080b0: 2020 206c 616d 6264 6120 693a 206c 656e     lambda i: len
+000080c0: 280d 0a20 2020 2023 2020 2020 2020 2020  (..    #        
+000080d0: 206c 6973 7428 7365 6c66 2e66 6c61 7428   list(self.flat(
+000080e0: 7365 6c65 6374 6564 3d54 7275 652c 2063  selected=True, c
+000080f0: 6173 6361 6465 3d46 616c 7365 2c20 7479  ascade=False, ty
+00008100: 7065 733d 6f70 6572 6174 655f 6e6f 6465  pes=operate_node
+00008110: 7329 290d 0a20 2020 2023 2020 2020 2029  s))..    #     )
+00008120: 0d0a 2020 2020 2320 2020 2020 6966 206c  ..    #     if l
+00008130: 656e 286c 6973 7428 7365 6c66 2e66 6c61  en(list(self.fla
+00008140: 7428 7365 6c65 6374 6564 3d54 7275 652c  t(selected=True,
+00008150: 2063 6173 6361 6465 3d46 616c 7365 2c20   cascade=False, 
+00008160: 7479 7065 733d 6f70 6572 6174 655f 6e6f  types=operate_no
+00008170: 6465 7329 2929 0d0a 2020 2020 2320 2020  des)))..    #   
+00008180: 2020 3e20 300d 0a20 2020 2023 2020 2020    > 0..    #    
+00008190: 2065 6c73 6520 6c65 6e28 0d0a 2020 2020   else len(..    
+000081a0: 2320 2020 2020 2020 2020 6c69 7374 2873  #         list(s
+000081b0: 656c 662e 666c 6174 2873 656c 6563 7465  elf.flat(selecte
+000081c0: 643d 5472 7565 2c20 6361 7363 6164 653d  d=True, cascade=
+000081d0: 4661 6c73 652c 2074 7970 6573 3d65 6c65  False, types=ele
+000081e0: 6d5f 6772 6f75 705f 6e6f 6465 7329 290d  m_group_nodes)).
+000081f0: 0a20 2020 2023 2020 2020 2029 2c0d 0a20  .    #     ),.. 
+00008200: 2020 2023 2029 0d0a 2020 2020 2320 4074     # )..    # @t
+00008210: 7265 655f 6361 6c63 280d 0a20 2020 2023  ree_calc(..    #
+00008220: 2020 2020 2022 7263 6f75 6e74 222c 0d0a       "rcount",..
+00008230: 2020 2020 2320 2020 2020 6c61 6d62 6461      #     lambda
+00008240: 2069 3a20 6c65 6e28 0d0a 2020 2020 2320   i: len(..    # 
+00008250: 2020 2020 2020 2020 6c69 7374 2873 656c          list(sel
+00008260: 662e 666c 6174 2873 656c 6563 7465 643d  f.flat(selected=
+00008270: 5472 7565 2c20 6361 7363 6164 653d 4661  True, cascade=Fa
+00008280: 6c73 652c 2074 7970 6573 3d28 2272 6566  lse, types=("ref
+00008290: 6572 656e 6365 2229 2929 0d0a 2020 2020  erence")))..    
+000082a0: 2320 2020 2020 292c 0d0a 2020 2020 2320  #     ),..    # 
+000082b0: 290d 0a20 2020 2023 2040 7472 6565 5f63  )..    # @tree_c
+000082c0: 616c 6328 0d0a 2020 2020 2320 2020 2020  alc(..    #     
+000082d0: 2265 6c6f 6322 2c0d 0a20 2020 2023 2020  "eloc",..    #  
+000082e0: 2020 206c 616d 6264 6120 733a 2022 6f70     lambda s: "op
+000082f0: 6572 6174 696f 6e73 220d 0a20 2020 2023  erations"..    #
+00008300: 2020 2020 2069 6620 6c65 6e28 6c69 7374       if len(list
+00008310: 2873 656c 662e 666c 6174 2873 656c 6563  (self.flat(selec
+00008320: 7465 643d 5472 7565 2c20 6361 7363 6164  ted=True, cascad
+00008330: 653d 4661 6c73 652c 2074 7970 6573 3d6f  e=False, types=o
+00008340: 7065 7261 7465 5f6e 6f64 6573 2929 290d  perate_nodes))).
+00008350: 0a20 2020 2023 2020 2020 203e 2030 0d0a  .    #     > 0..
+00008360: 2020 2020 2320 2020 2020 656c 7365 2022      #     else "
+00008370: 656c 656d 656e 742d 6c69 7374 222c 0d0a  element-list",..
+00008380: 2020 2020 2320 290d 0a20 2020 2023 2040      # )..    # @
+00008390: 7472 6565 5f6f 7065 7261 7469 6f6e 280d  tree_operation(.
+000083a0: 0a20 2020 2023 2020 2020 205f 2822 4465  .    #     _("De
+000083b0: 6c65 7465 2025 7320 7365 6c65 6374 6564  lete %s selected
+000083c0: 2069 7465 6d73 2066 726f 6d20 2573 2028   items from %s (
+000083d0: 5265 663d 2573 2922 2920 2520 2822 7b65  Ref=%s)") % ("{e
+000083e0: 636f 756e 747d 222c 2022 7b65 6c6f 637d  count}", "{eloc}
+000083f0: 222c 2022 7b72 636f 756e 747d 2229 2c0d  ", "{rcount}"),.
+00008400: 0a20 2020 2023 2020 2020 206e 6f64 655f  .    #     node_
+00008410: 7479 7065 3d6e 6f6e 5f73 7472 7563 7475  type=non_structu
+00008420: 7261 6c5f 6e6f 6465 732c 0d0a 2020 2020  ral_nodes,..    
+00008430: 2320 2020 2020 6865 6c70 3d22 222c 0d0a  #     help="",..
+00008440: 2020 2020 2320 290d 0a20 2020 2023 2064      # )..    # d
+00008450: 6566 2072 656d 6f76 655f 6d75 6c74 695f  ef remove_multi_
+00008460: 6e6f 6465 7328 6e6f 6465 2c20 2a2a 6b77  nodes(node, **kw
+00008470: 6172 6773 293a 0d0a 2020 2020 2320 2020  args):..    #   
+00008480: 2020 6966 2028 0d0a 2020 2020 2320 2020    if (..    #   
+00008490: 2020 2020 2020 6c65 6e28 6c69 7374 2873        len(list(s
+000084a0: 656c 662e 666c 6174 2873 656c 6563 7465  elf.flat(selecte
+000084b0: 643d 5472 7565 2c20 6361 7363 6164 653d  d=True, cascade=
+000084c0: 4661 6c73 652c 2074 7970 6573 3d6f 7065  False, types=ope
+000084d0: 7261 7465 5f6e 6f64 6573 2929 290d 0a20  rate_nodes))).. 
+000084e0: 2020 2023 2020 2020 2020 2020 203e 2030     #         > 0
+000084f0: 0d0a 2020 2020 2320 2020 2020 293a 0d0a  ..    #     ):..
+00008500: 2020 2020 2320 2020 2020 2020 2020 7479      #         ty
+00008510: 7065 7320 3d20 6f70 6572 6174 655f 6e6f  pes = operate_no
+00008520: 6465 730d 0a20 2020 2023 2020 2020 2065  des..    #     e
+00008530: 6c73 653a 0d0a 2020 2020 2320 2020 2020  lse:..    #     
+00008540: 2020 2020 7479 7065 7320 3d20 656c 656d      types = elem
+00008550: 5f67 726f 7570 5f6e 6f64 6573 0d0a 2020  _group_nodes..  
+00008560: 2020 2320 2020 2020 6e6f 6465 7320 3d20    #     nodes = 
+00008570: 6c69 7374 2873 656c 662e 666c 6174 2873  list(self.flat(s
+00008580: 656c 6563 7465 643d 5472 7565 2c20 6361  elected=True, ca
+00008590: 7363 6164 653d 4661 6c73 652c 2074 7970  scade=False, typ
+000085a0: 6573 3d74 7970 6573 2929 0d0a 2020 2020  es=types))..    
+000085b0: 2320 2020 2020 666f 7220 6e6f 6465 2069  #     for node i
+000085c0: 6e20 6e6f 6465 733a 0d0a 2020 2020 2320  n nodes:..    # 
+000085d0: 2020 2020 2020 2020 2320 4966 2077 6520          # If we 
+000085e0: 6172 6520 7365 6c65 6374 696e 6720 616e  are selecting an
+000085f0: 206f 7065 7261 7469 6f6e 202f 2061 6e20   operation / an 
+00008600: 656c 656d 656e 7420 7769 7468 696e 2061  element within a
+00008610: 6e20 6f70 6572 6174 696f 6e2c 2074 6865  n operation, the
+00008620: 6e20 6974 0d0a 2020 2020 2320 2020 2020  n it..    #     
+00008630: 2020 2020 2320 616c 736f 2073 656c 6563      # also selec
+00008640: 7473 2f65 6d70 6861 7369 7a65 7320 7468  ts/emphasizes th
+00008650: 6520 636f 6e74 6169 6e65 6420 656c 656d  e contained elem
+00008660: 656e 7473 2069 6e20 7468 6520 656c 656d  ents in the elem
+00008670: 656e 7473 2062 7261 6e63 682e 2e2e 0d0a  ents branch.....
+00008680: 2020 2020 2320 2020 2020 2020 2020 2320      #         # 
+00008690: 536f 2062 6f74 6820 7769 6c6c 2062 6520  So both will be 
+000086a0: 6465 6c65 7465 642e 2e2e 0d0a 2020 2020  deleted.....    
+000086b0: 2320 2020 2020 2020 2020 2320 546f 2063  #         # To c
+000086c0: 6972 6375 6d76 656e 7420 7468 6973 2c20  ircumvent this, 
+000086d0: 7765 2069 6e71 7569 7265 206f 6e63 6520  we inquire once 
+000086e0: 6d6f 7265 2074 6865 2073 656c 6563 7465  more the selecte
+000086f0: 6420 7374 6174 7573 2e2e 2e0d 0a20 2020  d status.....   
+00008700: 2023 2020 2020 2020 2020 2069 6620 6e6f   #         if no
+00008710: 6465 2e73 656c 6563 7465 643a 0d0a 2020  de.selected:..  
+00008720: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+00008730: 6966 206e 6f64 652e 7061 7265 6e74 2069  if node.parent i
+00008740: 7320 6e6f 7420 4e6f 6e65 3a20 2023 204d  s not None:  # M
+00008750: 6179 2068 6176 6520 616c 7265 6164 7920  ay have already 
+00008760: 7265 6d6f 7665 642e 0d0a 2020 2020 2320  removed...    # 
+00008770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008780: 6e6f 6465 2e72 656d 6f76 655f 6e6f 6465  node.remove_node
+00008790: 2829 0d0a 2020 2020 2320 2020 2020 7365  ()..    #     se
+000087a0: 6c66 2e73 6574 5f65 6d70 6861 7369 7328  lf.set_emphasis(
+000087b0: 4e6f 6e65 290d 0a0d 0a20 2020 2023 203d  None)....    # =
+000087c0: 3d3d 3d3d 3d3d 3d3d 3d0d 0a20 2020 2023  =========..    #
+000087d0: 2052 454d 4f56 4520 5349 4e47 4c45 2028   REMOVE SINGLE (
+000087e0: 5472 6565 2053 656c 6563 7465 6420 2d20  Tree Selected - 
+000087f0: 454c 454d 454e 5429 0d0a 2020 2020 2320  ELEMENT)..    # 
+00008800: 3d3d 3d3d 3d3d 3d3d 3d3d 0d0a 2020 2020  ==========..    
+00008810: 4074 7265 655f 636f 6e64 6974 696f 6e61  @tree_conditiona
+00008820: 6c28 6c61 6d62 6461 206e 6f64 653a 206e  l(lambda node: n
+00008830: 6f64 652e 6361 6e5f 7265 6d6f 7665 290d  ode.can_remove).
+00008840: 0a20 2020 2040 7472 6565 5f63 6f6e 6469  .    @tree_condi
+00008850: 7469 6f6e 616c 280d 0a20 2020 2020 2020  tional(..       
+00008860: 206c 616d 6264 6120 636f 6e64 3a20 6c65   lambda cond: le
+00008870: 6e28 0d0a 2020 2020 2020 2020 2020 2020  n(..            
+00008880: 6c69 7374 2873 656c 662e 666c 6174 2873  list(self.flat(s
+00008890: 656c 6563 7465 643d 5472 7565 2c20 6361  elected=True, ca
+000088a0: 7363 6164 653d 4661 6c73 652c 2074 7970  scade=False, typ
+000088b0: 6573 3d65 6c65 6d5f 6e6f 6465 7329 290d  es=elem_nodes)).
+000088c0: 0a20 2020 2020 2020 2029 0d0a 2020 2020  .        )..    
+000088d0: 2020 2020 3d3d 2031 0d0a 2020 2020 290d      == 1..    ).
+000088e0: 0a20 2020 2040 7472 6565 5f6f 7065 7261  .    @tree_opera
+000088f0: 7469 6f6e 280d 0a20 2020 2020 2020 205f  tion(..        _
+00008900: 2822 4465 6c65 7465 2065 6c65 6d65 6e74  ("Delete element
+00008910: 2027 7b6e 616d 657d 2720 6675 6c6c 7922   '{name}' fully"
+00008920: 292c 0d0a 2020 2020 2020 2020 6e6f 6465  ),..        node
+00008930: 5f74 7970 653d 656c 656d 5f6e 6f64 6573  _type=elem_nodes
+00008940: 2c0d 0a20 2020 2020 2020 2068 656c 703d  ,..        help=
+00008950: 2222 2c0d 0a20 2020 2029 0d0a 2020 2020  "",..    )..    
+00008960: 6465 6620 7265 6d6f 7665 5f74 7970 655f  def remove_type_
+00008970: 656c 656d 286e 6f64 652c 202a 2a6b 7761  elem(node, **kwa
+00008980: 7267 7329 3a0d 0a20 2020 2020 2020 2069  rgs):..        i
+00008990: 6620 6861 7361 7474 7228 6e6f 6465 2c20  f hasattr(node, 
+000089a0: 2263 616e 5f72 656d 6f76 6522 2920 616e  "can_remove") an
+000089b0: 6420 6e6f 7420 6e6f 6465 2e63 616e 5f72  d not node.can_r
+000089c0: 656d 6f76 653a 0d0a 2020 2020 2020 2020  emove:..        
+000089d0: 2020 2020 7061 7373 0d0a 2020 2020 2020      pass..      
+000089e0: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+000089f0: 2020 2020 206e 6f64 652e 7265 6d6f 7665       node.remove
+00008a00: 5f6e 6f64 6528 290d 0a20 2020 2020 2020  _node()..       
+00008a10: 2020 2020 2073 656c 662e 7365 745f 656d       self.set_em
+00008a20: 7068 6173 6973 284e 6f6e 6529 0d0a 0d0a  phasis(None)....
+00008a30: 2020 2020 4074 7265 655f 636f 6e64 6974      @tree_condit
+00008a40: 696f 6e61 6c28 0d0a 2020 2020 2020 2020  ional(..        
+00008a50: 6c61 6d62 6461 2063 6f6e 643a 206c 656e  lambda cond: len
+00008a60: 286c 6973 7428 7365 6c66 2e66 6c61 7428  (list(self.flat(
+00008a70: 7365 6c65 6374 6564 3d54 7275 652c 2063  selected=True, c
+00008a80: 6173 6361 6465 3d46 616c 7365 2c20 7479  ascade=False, ty
+00008a90: 7065 733d 6f70 5f6e 6f64 6573 2929 290d  pes=op_nodes))).
+00008aa0: 0a20 2020 2020 2020 203d 3d20 310d 0a20  .        == 1.. 
+00008ab0: 2020 2029 0d0a 2020 2020 4074 7265 655f     )..    @tree_
+00008ac0: 6f70 6572 6174 696f 6e28 0d0a 2020 2020  operation(..    
+00008ad0: 2020 2020 5f28 2244 656c 6574 6520 6f70      _("Delete op
+00008ae0: 6572 6174 696f 6e20 277b 6e61 6d65 7d27  eration '{name}'
+00008af0: 2066 756c 6c79 2229 2c0d 0a20 2020 2020   fully"),..     
+00008b00: 2020 206e 6f64 655f 7479 7065 3d6f 705f     node_type=op_
+00008b10: 6e6f 6465 732c 0d0a 2020 2020 2020 2020  nodes,..        
+00008b20: 6865 6c70 3d22 222c 0d0a 2020 2020 290d  help="",..    ).
+00008b30: 0a20 2020 2064 6566 2072 656d 6f76 655f  .    def remove_
+00008b40: 7479 7065 5f6f 7028 6e6f 6465 2c20 2a2a  type_op(node, **
+00008b50: 6b77 6172 6773 293a 0d0a 0d0a 2020 2020  kwargs):....    
+00008b60: 2020 2020 6e6f 6465 2e72 656d 6f76 655f      node.remove_
+00008b70: 6e6f 6465 2829 0d0a 2020 2020 2020 2020  node()..        
+00008b80: 7365 6c66 2e73 6574 5f65 6d70 6861 7369  self.set_emphasi
+00008b90: 7328 4e6f 6e65 290d 0a20 2020 2020 2020  s(None)..       
+00008ba0: 2073 656c 662e 7369 676e 616c 2822 6f70   self.signal("op
+00008bb0: 6572 6174 696f 6e5f 7265 6d6f 7665 6422  eration_removed"
+00008bc0: 290d 0a0d 0a20 2020 2040 7472 6565 5f63  )....    @tree_c
+00008bd0: 6f6e 6469 7469 6f6e 616c 280d 0a20 2020  onditional(..   
+00008be0: 2020 2020 206c 616d 6264 6120 636f 6e64       lambda cond
+00008bf0: 3a20 6c65 6e28 6c69 7374 2873 656c 662e  : len(list(self.
+00008c00: 666c 6174 2873 656c 6563 7465 643d 5472  flat(selected=Tr
+00008c10: 7565 2c20 6361 7363 6164 653d 4661 6c73  ue, cascade=Fals
+00008c20: 652c 2074 7970 6573 3d22 626c 6f62 2229  e, types="blob")
+00008c30: 2929 0d0a 2020 2020 2020 2020 3d3d 2031  ))..        == 1
+00008c40: 0d0a 2020 2020 290d 0a20 2020 2040 7472  ..    )..    @tr
+00008c50: 6565 5f6f 7065 7261 7469 6f6e 280d 0a20  ee_operation(.. 
+00008c60: 2020 2020 2020 205f 2822 4465 6c65 7465         _("Delete
+00008c70: 2062 6c6f 6220 277b 6e61 6d65 7d27 2066   blob '{name}' f
+00008c80: 756c 6c79 2229 2c0d 0a20 2020 2020 2020  ully"),..       
+00008c90: 206e 6f64 655f 7479 7065 3d22 626c 6f62   node_type="blob
+00008ca0: 222c 0d0a 2020 2020 2020 2020 6865 6c70  ",..        help
+00008cb0: 3d22 222c 0d0a 2020 2020 290d 0a20 2020  ="",..    )..   
+00008cc0: 2064 6566 2072 656d 6f76 655f 7479 7065   def remove_type
+00008cd0: 5f62 6c6f 6228 6e6f 6465 2c20 2a2a 6b77  _blob(node, **kw
+00008ce0: 6172 6773 293a 0d0a 2020 2020 2020 2020  args):..        
+00008cf0: 6e6f 6465 2e72 656d 6f76 655f 6e6f 6465  node.remove_node
+00008d00: 2829 0d0a 2020 2020 2020 2020 7365 6c66  ()..        self
+00008d10: 2e73 6574 5f65 6d70 6861 7369 7328 4e6f  .set_emphasis(No
+00008d20: 6e65 290d 0a20 2020 2020 2020 2073 656c  ne)..        sel
+00008d30: 662e 7369 676e 616c 2822 6f70 6572 6174  f.signal("operat
+00008d40: 696f 6e5f 7265 6d6f 7665 6422 290d 0a0d  ion_removed")...
+00008d50: 0a20 2020 2040 7472 6565 5f63 6f6e 6469  .    @tree_condi
+00008d60: 7469 6f6e 616c 280d 0a20 2020 2020 2020  tional(..       
+00008d70: 206c 616d 6264 6120 636f 6e64 3a20 6c65   lambda cond: le
+00008d80: 6e28 6c69 7374 2873 656c 662e 666c 6174  n(list(self.flat
+00008d90: 2873 656c 6563 7465 643d 5472 7565 2c20  (selected=True, 
+00008da0: 6361 7363 6164 653d 4661 6c73 652c 2074  cascade=False, t
+00008db0: 7970 6573 3d6f 705f 6e6f 6465 7329 2929  ypes=op_nodes)))
+00008dc0: 0d0a 2020 2020 2020 2020 3e20 310d 0a20  ..        > 1.. 
+00008dd0: 2020 2029 0d0a 2020 2020 4074 7265 655f     )..    @tree_
+00008de0: 6361 6c63 280d 0a20 2020 2020 2020 2022  calc(..        "
+00008df0: 6563 6f75 6e74 222c 0d0a 2020 2020 2020  ecount",..      
+00008e00: 2020 6c61 6d62 6461 2069 3a20 6c65 6e28    lambda i: len(
+00008e10: 6c69 7374 2873 656c 662e 666c 6174 2873  list(self.flat(s
+00008e20: 656c 6563 7465 643d 5472 7565 2c20 6361  elected=True, ca
+00008e30: 7363 6164 653d 4661 6c73 652c 2074 7970  scade=False, typ
+00008e40: 6573 3d6f 705f 6e6f 6465 7329 2929 2c0d  es=op_nodes))),.
+00008e50: 0a20 2020 2029 0d0a 2020 2020 4074 7265  .    )..    @tre
+00008e60: 655f 6f70 6572 6174 696f 6e28 0d0a 2020  e_operation(..  
+00008e70: 2020 2020 2020 5f28 2244 656c 6574 6520        _("Delete 
+00008e80: 7b65 636f 756e 747d 206f 7065 7261 7469  {ecount} operati
+00008e90: 6f6e 7320 6675 6c6c 7922 292c 0d0a 2020  ons fully"),..  
+00008ea0: 2020 2020 2020 6e6f 6465 5f74 7970 653d        node_type=
+00008eb0: 6f70 5f6e 6f64 6573 2c0d 0a20 2020 2020  op_nodes,..     
+00008ec0: 2020 2068 656c 703d 2222 2c0d 0a20 2020     help="",..   
+00008ed0: 2029 0d0a 2020 2020 6465 6620 7265 6d6f   )..    def remo
+00008ee0: 7665 5f74 7970 655f 6f70 5f6d 756c 7469  ve_type_op_multi
+00008ef0: 706c 6528 6e6f 6465 2c20 2a2a 6b77 6172  ple(node, **kwar
+00008f00: 6773 293a 0d0a 2020 2020 2020 2020 666f  gs):..        fo
+00008f10: 7220 6f70 2069 6e20 6c69 7374 2873 656c  r op in list(sel
+00008f20: 662e 666c 6174 2873 656c 6563 7465 643d  f.flat(selected=
+00008f30: 5472 7565 2c20 6361 7363 6164 653d 4661  True, cascade=Fa
+00008f40: 6c73 652c 2074 7970 6573 3d6f 705f 6e6f  lse, types=op_no
+00008f50: 6465 7329 293a 0d0a 2020 2020 2020 2020  des)):..        
+00008f60: 2020 2020 6f70 2e72 656d 6f76 655f 6e6f      op.remove_no
+00008f70: 6465 2829 0d0a 2020 2020 2020 2020 7365  de()..        se
+00008f80: 6c66 2e73 6574 5f65 6d70 6861 7369 7328  lf.set_emphasis(
+00008f90: 4e6f 6e65 290d 0a20 2020 2020 2020 2073  None)..        s
+00008fa0: 656c 662e 7369 676e 616c 2822 6f70 6572  elf.signal("oper
+00008fb0: 6174 696f 6e5f 7265 6d6f 7665 6422 290d  ation_removed").
+00008fc0: 0a0d 0a20 2020 2064 6566 2063 6f6e 7461  ...    def conta
+00008fd0: 696e 735f 6e6f 5f75 6e72 656d 6f76 6162  ins_no_unremovab
+00008fe0: 6c65 5f69 7465 6d73 2829 3a0d 0a20 2020  le_items():..   
+00008ff0: 2020 2020 206e 6f6c 6f63 6b20 3d20 5472       nolock = Tr
+00009000: 7565 0d0a 2020 2020 2020 2020 666f 7220  ue..        for 
+00009010: 6520 696e 206c 6973 7428 7365 6c66 2e66  e in list(self.f
+00009020: 6c61 7428 7365 6c65 6374 6564 3d54 7275  lat(selected=Tru
+00009030: 652c 2063 6173 6361 6465 3d54 7275 6529  e, cascade=True)
+00009040: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00009050: 6966 2068 6173 6174 7472 2865 2c20 2263  if hasattr(e, "c
+00009060: 616e 5f72 656d 6f76 6522 2920 616e 6420  an_remove") and 
+00009070: 6e6f 7420 652e 6361 6e5f 7265 6d6f 7665  not e.can_remove
+00009080: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00009090: 2020 206e 6f6c 6f63 6b20 3d20 4661 6c73     nolock = Fals
+000090a0: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
+000090b0: 2020 2062 7265 616b 0d0a 2020 2020 2020     break..      
+000090c0: 2020 7265 7475 726e 206e 6f6c 6f63 6b0d    return nolock.
+000090d0: 0a0d 0a20 2020 2040 7472 6565 5f63 6f6e  ...    @tree_con
+000090e0: 6469 7469 6f6e 616c 286c 616d 6264 6120  ditional(lambda 
+000090f0: 636f 6e64 3a20 636f 6e74 6169 6e73 5f6e  cond: contains_n
+00009100: 6f5f 756e 7265 6d6f 7661 626c 655f 6974  o_unremovable_it
+00009110: 656d 7328 2929 0d0a 2020 2020 4074 7265  ems())..    @tre
+00009120: 655f 636f 6e64 6974 696f 6e61 6c28 0d0a  e_conditional(..
+00009130: 2020 2020 2020 2020 6c61 6d62 6461 2063          lambda c
+00009140: 6f6e 643a 206c 656e 280d 0a20 2020 2020  ond: len(..     
+00009150: 2020 2020 2020 206c 6973 7428 7365 6c66         list(self
+00009160: 2e66 6c61 7428 7365 6c65 6374 6564 3d54  .flat(selected=T
+00009170: 7275 652c 2063 6173 6361 6465 3d46 616c  rue, cascade=Fal
+00009180: 7365 2c20 7479 7065 733d 2822 6669 6c65  se, types=("file
+00009190: 222c 2022 6772 6f75 7022 2929 290d 0a20  ", "group"))).. 
+000091a0: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
+000091b0: 2020 3d3d 2031 0d0a 2020 2020 290d 0a20    == 1..    ).. 
+000091c0: 2020 2040 7472 6565 5f6f 7065 7261 7469     @tree_operati
+000091d0: 6f6e 280d 0a20 2020 2020 2020 205f 2822  on(..        _("
+000091e0: 4465 6c65 7465 2067 726f 7570 2027 7b6e  Delete group '{n
+000091f0: 616d 657d 2720 616e 6420 616c 6c20 6974  ame}' and all it
+00009200: 7320 6368 696c 642d 656c 656d 656e 7473  s child-elements
+00009210: 2066 756c 6c79 2229 2c0d 0a20 2020 2020   fully"),..     
+00009220: 2020 206e 6f64 655f 7479 7065 3d22 6772     node_type="gr
+00009230: 6f75 7022 2c0d 0a20 2020 2020 2020 2068  oup",..        h
+00009240: 656c 703d 2222 2c0d 0a20 2020 2029 0d0a  elp="",..    )..
+00009250: 2020 2020 6465 6620 7265 6d6f 7665 5f74      def remove_t
+00009260: 7970 655f 6772 7028 6e6f 6465 2c20 2a2a  ype_grp(node, **
+00009270: 6b77 6172 6773 293a 0d0a 2020 2020 2020  kwargs):..      
+00009280: 2020 6e6f 6465 2e72 656d 6f76 655f 6e6f    node.remove_no
+00009290: 6465 2829 0d0a 2020 2020 2020 2020 7365  de()..        se
+000092a0: 6c66 2e73 6574 5f65 6d70 6861 7369 7328  lf.set_emphasis(
+000092b0: 4e6f 6e65 290d 0a0d 0a20 2020 2040 7472  None)....    @tr
+000092c0: 6565 5f63 6f6e 6469 7469 6f6e 616c 286c  ee_conditional(l
+000092d0: 616d 6264 6120 636f 6e64 3a20 636f 6e74  ambda cond: cont
+000092e0: 6169 6e73 5f6e 6f5f 756e 7265 6d6f 7661  ains_no_unremova
+000092f0: 626c 655f 6974 656d 7328 2929 0d0a 2020  ble_items())..  
+00009300: 2020 4074 7265 655f 636f 6e64 6974 696f    @tree_conditio
+00009310: 6e61 6c28 0d0a 2020 2020 2020 2020 6c61  nal(..        la
+00009320: 6d62 6461 2063 6f6e 643a 206c 656e 280d  mbda cond: len(.
+00009330: 0a20 2020 2020 2020 2020 2020 206c 6973  .            lis
+00009340: 7428 7365 6c66 2e66 6c61 7428 7365 6c65  t(self.flat(sele
+00009350: 6374 6564 3d54 7275 652c 2063 6173 6361  cted=True, casca
+00009360: 6465 3d46 616c 7365 2c20 7479 7065 733d  de=False, types=
+00009370: 2822 6669 6c65 222c 2022 6772 6f75 7022  ("file", "group"
+00009380: 2929 290d 0a20 2020 2020 2020 2029 0d0a  )))..        )..
+00009390: 2020 2020 2020 2020 3d3d 2031 0d0a 2020          == 1..  
+000093a0: 2020 290d 0a20 2020 2040 7472 6565 5f6f    )..    @tree_o
+000093b0: 7065 7261 7469 6f6e 280d 0a20 2020 2020  peration(..     
+000093c0: 2020 205f 2822 5265 6d6f 7665 206c 6f61     _("Remove loa
+000093d0: 6465 6420 6669 6c65 2027 7b6e 616d 657d  ded file '{name}
+000093e0: 2720 616e 6420 616c 6c20 6974 7320 6368  ' and all its ch
+000093f0: 696c 642d 656c 656d 656e 7473 2066 756c  ild-elements ful
+00009400: 6c79 2229 2c0d 0a20 2020 2020 2020 206e  ly"),..        n
+00009410: 6f64 655f 7479 7065 3d22 6669 6c65 222c  ode_type="file",
+00009420: 0d0a 2020 2020 2020 2020 6865 6c70 3d22  ..        help="
+00009430: 222c 0d0a 2020 2020 290d 0a20 2020 2064  ",..    )..    d
+00009440: 6566 2072 656d 6f76 655f 7479 7065 5f66  ef remove_type_f
+00009450: 696c 6528 6e6f 6465 2c20 2a2a 6b77 6172  ile(node, **kwar
+00009460: 6773 293a 0d0a 2020 2020 2020 2020 6e6f  gs):..        no
+00009470: 6465 2e72 656d 6f76 655f 6e6f 6465 2829  de.remove_node()
+00009480: 0d0a 2020 2020 2020 2020 7365 6c66 2e73  ..        self.s
+00009490: 6574 5f65 6d70 6861 7369 7328 4e6f 6e65  et_emphasis(None
+000094a0: 290d 0a0d 0a20 2020 2040 7472 6565 5f63  )....    @tree_c
+000094b0: 6f6e 6469 7469 6f6e 616c 286c 616d 6264  onditional(lambd
+000094c0: 6120 6e6f 6465 3a20 6e6f 7420 6973 5f72  a node: not is_r
+000094d0: 6567 6d61 726b 286e 6f64 6529 290d 0a20  egmark(node)).. 
+000094e0: 2020 2040 7472 6565 5f6f 7065 7261 7469     @tree_operati
+000094f0: 6f6e 280d 0a20 2020 2020 2020 205f 2822  on(..        _("
+00009500: 5265 6d6f 7665 2074 7261 6e73 7061 7265  Remove transpare
+00009510: 6e74 206f 626a 6563 7473 2229 2c0d 0a20  nt objects"),.. 
+00009520: 2020 2020 2020 206e 6f64 655f 7479 7065         node_type
+00009530: 3d28 2267 726f 7570 222c 2022 6669 6c65  =("group", "file
+00009540: 2229 2c0d 0a20 2020 2020 2020 2068 656c  "),..        hel
+00009550: 703d 5f28 2252 656d 6f76 6520 616c 6c20  p=_("Remove all 
+00009560: 656c 656d 656e 7473 2074 6861 7420 6e65  elements that ne
+00009570: 6974 6865 7220 6861 7665 2061 2062 6f72  ither have a bor
+00009580: 6465 7220 6e6f 7220 6120 6669 6c6c 2063  der nor a fill c
+00009590: 6f6c 6f72 2229 2c0d 0a20 2020 2029 0d0a  olor"),..    )..
+000095a0: 2020 2020 6465 6620 7265 6d6f 7665 5f74      def remove_t
+000095b0: 7261 6e73 7061 7265 6e74 286e 6f64 652c  ransparent(node,
+000095c0: 202a 2a6b 7761 7267 7329 3a0d 0a20 2020   **kwargs):..   
+000095d0: 2020 2020 2072 6573 203d 2030 0d0a 2020       res = 0..  
+000095e0: 2020 2020 2020 746f 5f72 656d 6f76 6520        to_remove 
+000095f0: 3d20 5b5d 0d0a 2020 2020 2020 2020 666f  = []..        fo
+00009600: 7220 656e 6f64 6520 696e 2073 656c 662e  r enode in self.
+00009610: 666c 6174 280d 0a20 2020 2020 2020 2020  flat(..         
+00009620: 2020 2073 656c 6563 7465 643d 5472 7565     selected=True
+00009630: 2c0d 0a20 2020 2020 2020 2020 2020 2063  ,..            c
+00009640: 6173 6361 6465 3d54 7275 652c 0d0a 2020  ascade=True,..  
+00009650: 2020 2020 2020 2020 2020 7479 7065 733d            types=
+00009660: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
+00009670: 2020 2022 656c 656d 2072 6563 7422 2c0d     "elem rect",.
+00009680: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009690: 2022 656c 656d 2065 6c6c 6970 7365 222c   "elem ellipse",
+000096a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000096b0: 2020 2265 6c65 6d20 7061 7468 222c 0d0a    "elem path",..
+000096c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000096d0: 2265 6c65 6d20 6c69 6e65 222c 0d0a 2020  "elem line",..  
+000096e0: 2020 2020 2020 2020 2020 2020 2020 2265                "e
+000096f0: 6c65 6d20 706f 6c79 6c69 6e65 222c 0d0a  lem polyline",..
+00009700: 2020 2020 2020 2020 2020 2020 292c 0d0a              ),..
+00009710: 2020 2020 2020 2020 293a 0d0a 2020 2020          ):..    
+00009720: 2020 2020 2020 2020 636f 6c6f 7265 6420          colored 
+00009730: 3d20 4661 6c73 650d 0a20 2020 2020 2020  = False..       
+00009740: 2020 2020 2069 6620 280d 0a20 2020 2020       if (..     
+00009750: 2020 2020 2020 2020 2020 2068 6173 6174             hasat
+00009760: 7472 2865 6e6f 6465 2c20 2266 696c 6c22  tr(enode, "fill"
+00009770: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00009780: 2020 2061 6e64 2065 6e6f 6465 2e66 696c     and enode.fil
+00009790: 6c20 6973 206e 6f74 204e 6f6e 650d 0a20  l is not None.. 
+000097a0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+000097b0: 6e64 2065 6e6f 6465 2e66 696c 6c2e 6172  nd enode.fill.ar
+000097c0: 6762 2069 7320 6e6f 7420 4e6f 6e65 0d0a  gb is not None..
+000097d0: 2020 2020 2020 2020 2020 2020 293a 0d0a              ):..
+000097e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000097f0: 636f 6c6f 7265 6420 3d20 5472 7565 0d0a  colored = True..
+00009800: 2020 2020 2020 2020 2020 2020 6966 2028              if (
+00009810: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00009820: 2020 6861 7361 7474 7228 656e 6f64 652c    hasattr(enode,
+00009830: 2022 7374 726f 6b65 2229 0d0a 2020 2020   "stroke")..    
+00009840: 2020 2020 2020 2020 2020 2020 616e 6420              and 
+00009850: 656e 6f64 652e 7374 726f 6b65 2069 7320  enode.stroke is 
+00009860: 6e6f 7420 4e6f 6e65 0d0a 2020 2020 2020  not None..      
+00009870: 2020 2020 2020 2020 2020 616e 6420 656e            and en
+00009880: 6f64 652e 7374 726f 6b65 2e61 7267 6220  ode.stroke.argb 
+00009890: 6973 206e 6f74 204e 6f6e 650d 0a20 2020  is not None..   
+000098a0: 2020 2020 2020 2020 2029 3a0d 0a20 2020           ):..   
+000098b0: 2020 2020 2020 2020 2020 2020 2063 6f6c               col
+000098c0: 6f72 6564 203d 2054 7275 650d 0a20 2020  ored = True..   
+000098d0: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+000098e0: 636f 6c6f 7265 643a 0d0a 2020 2020 2020  colored:..      
+000098f0: 2020 2020 2020 2020 2020 7265 7320 2b3d            res +=
+00009900: 2031 0d0a 2020 2020 2020 2020 2020 2020   1..            
+00009910: 2020 2020 656e 6f64 652e 7265 6d6f 7665      enode.remove
+00009920: 5f6e 6f64 6528 290d 0a0d 0a20 2020 2020  _node()....     
+00009930: 2020 2069 6620 7265 7320 3e20 303a 0d0a     if res > 0:..
+00009940: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00009950: 2e73 6967 6e61 6c28 2272 6562 7569 6c64  .signal("rebuild
+00009960: 5f74 7265 6522 290d 0a0d 0a20 2020 2023  _tree")....    #
+00009970: 203d 3d3d 3d3d 3d3d 3d3d 3d0d 0a20 2020   ==========..   
+00009980: 2023 2052 656d 6f76 6520 4f70 6572 6174   # Remove Operat
+00009990: 696f 6e73 2028 4966 204e 6f20 5472 6565  ions (If No Tree
+000099a0: 2053 656c 6563 7465 6429 0d0a 2020 2020   Selected)..    
+000099b0: 2320 4e6f 7465 3a20 5468 6973 2063 6f64  # Note: This cod
+000099c0: 6520 776f 756c 6420 7261 7265 6c79 206d  e would rarely m
+000099d0: 6174 6368 2061 6e79 7468 696e 6720 7369  atch anything si
+000099e0: 6e63 6520 7468 6520 7472 6565 2073 656c  nce the tree sel
+000099f0: 6563 7465 6420 7769 6c6c 2061 6c6d 6f73  ected will almos
+00009a00: 7420 616c 7761 7973 2062 6520 7472 7565  t always be true
+00009a10: 2069 6620 7765 2068 6176 650d 0a20 2020   if we have..   
+00009a20: 2023 206d 6174 6368 2074 6869 7320 636f   # match this co
+00009a30: 6e64 6974 696f 6e61 6c2e 2054 6865 2074  nditional. The t
+00009a40: 7265 652d 7365 6c65 6374 6564 2064 656c  ree-selected del
+00009a50: 6574 6520 6675 6e63 7469 6f6e 7320 6172  ete functions ar
+00009a60: 6520 7375 7065 7269 6f72 2e0d 0a20 2020  e superior...   
+00009a70: 2023 203d 3d3d 3d3d 3d3d 3d3d 3d0d 0a20   # ==========.. 
+00009a80: 2020 2040 7472 6565 5f63 6f6e 6469 7469     @tree_conditi
+00009a90: 6f6e 616c 280d 0a20 2020 2020 2020 206c  onal(..        l
+00009aa0: 616d 6264 6120 636f 6e64 3a20 6c65 6e28  ambda cond: len(
+00009ab0: 0d0a 2020 2020 2020 2020 2020 2020 6c69  ..            li
+00009ac0: 7374 2873 656c 662e 666c 6174 2873 656c  st(self.flat(sel
+00009ad0: 6563 7465 643d 5472 7565 2c20 6361 7363  ected=True, casc
+00009ae0: 6164 653d 4661 6c73 652c 2074 7970 6573  ade=False, types
+00009af0: 3d6e 6f6e 5f73 7472 7563 7475 7261 6c5f  =non_structural_
+00009b00: 6e6f 6465 7329 290d 0a20 2020 2020 2020  nodes))..       
+00009b10: 2029 0d0a 2020 2020 2020 2020 3d3d 2030   )..        == 0
+00009b20: 0d0a 2020 2020 290d 0a20 2020 2040 7472  ..    )..    @tr
+00009b30: 6565 5f63 6f6e 6469 7469 6f6e 616c 286c  ee_conditional(l
+00009b40: 616d 6264 6120 6e6f 6465 3a20 6c65 6e28  ambda node: len(
+00009b50: 6c69 7374 2873 656c 662e 6f70 7328 7365  list(self.ops(se
+00009b60: 6c65 6374 6564 3d54 7275 6529 2929 203e  lected=True))) >
+00009b70: 2031 290d 0a20 2020 2040 7472 6565 5f63   1)..    @tree_c
+00009b80: 616c 6328 2265 636f 756e 7422 2c20 6c61  alc("ecount", la
+00009b90: 6d62 6461 2069 3a20 6c65 6e28 6c69 7374  mbda i: len(list
+00009ba0: 2873 656c 662e 6f70 7328 7365 6c65 6374  (self.ops(select
+00009bb0: 6564 3d54 7275 6529 2929 290d 0a20 2020  ed=True))))..   
+00009bc0: 2040 7472 6565 5f6f 7065 7261 7469 6f6e   @tree_operation
+00009bd0: 280d 0a20 2020 2020 2020 205f 2822 4465  (..        _("De
+00009be0: 6c65 7465 207b 6563 6f75 6e74 7d20 6f70  lete {ecount} op
+00009bf0: 6572 6174 696f 6e73 2229 2c0d 0a20 2020  erations"),..   
+00009c00: 2020 2020 206e 6f64 655f 7479 7065 3d28       node_type=(
+00009c10: 0d0a 2020 2020 2020 2020 2020 2020 226f  ..            "o
+00009c20: 7020 6375 7422 2c0d 0a20 2020 2020 2020  p cut",..       
+00009c30: 2020 2020 2022 6f70 2072 6173 7465 7222       "op raster"
+00009c40: 2c0d 0a20 2020 2020 2020 2020 2020 2022  ,..            "
+00009c50: 6f70 2069 6d61 6765 222c 0d0a 2020 2020  op image",..    
+00009c60: 2020 2020 2020 2020 226f 7020 656e 6772          "op engr
+00009c70: 6176 6522 2c0d 0a20 2020 2020 2020 2020  ave",..         
+00009c80: 2020 2022 6f70 2064 6f74 7322 2c0d 0a20     "op dots",.. 
+00009c90: 2020 2020 2020 2020 2020 2022 6f70 2068             "op h
+00009ca0: 6174 6368 222c 0d0a 2020 2020 2020 2020  atch",..        
+00009cb0: 2020 2020 2275 7469 6c20 636f 6e73 6f6c      "util consol
+00009cc0: 6522 2c0d 0a20 2020 2020 2020 2020 2020  e",..           
+00009cd0: 2022 7574 696c 2077 6169 7422 2c0d 0a20   "util wait",.. 
+00009ce0: 2020 2020 2020 2020 2020 2022 7574 696c             "util
+00009cf0: 2068 6f6d 6522 2c0d 0a20 2020 2020 2020   home",..       
+00009d00: 2020 2020 2022 7574 696c 2067 6f74 6f22       "util goto"
+00009d10: 2c0d 0a20 2020 2020 2020 2020 2020 2022  ,..            "
+00009d20: 7574 696c 206f 7269 6769 6e22 2c0d 0a20  util origin",.. 
+00009d30: 2020 2020 2020 2020 2020 2022 7574 696c             "util
+00009d40: 206f 7574 7075 7422 2c0d 0a20 2020 2020   output",..     
+00009d50: 2020 2020 2020 2022 7574 696c 2069 6e70         "util inp
+00009d60: 7574 222c 0d0a 2020 2020 2020 2020 2020  ut",..          
+00009d70: 2020 226c 6173 6572 636f 6465 222c 0d0a    "lasercode",..
+00009d80: 2020 2020 2020 2020 2020 2020 2263 7574              "cut
+00009d90: 636f 6465 222c 0d0a 2020 2020 2020 2020  code",..        
+00009da0: 2020 2020 2262 6c6f 6222 2c0d 0a20 2020      "blob",..   
+00009db0: 2020 2020 2029 2c0d 0a20 2020 2020 2020       ),..       
+00009dc0: 2068 656c 703d 2222 2c0d 0a20 2020 2029   help="",..    )
+00009dd0: 0d0a 2020 2020 6465 6620 7265 6d6f 7665  ..    def remove
+00009de0: 5f6e 5f6f 7073 286e 6f64 652c 202a 2a6b  _n_ops(node, **k
+00009df0: 7761 7267 7329 3a0d 0a20 2020 2020 2020  wargs):..       
+00009e00: 2073 656c 6628 226f 7065 7261 7469 6f6e   self("operation
+00009e10: 2064 656c 6574 655c 6e22 290d 0a0d 0a20   delete\n").... 
+00009e20: 2020 2040 7472 6565 5f6f 7065 7261 7469     @tree_operati
+00009e30: 6f6e 280d 0a20 2020 2020 2020 205f 2822  on(..        _("
+00009e40: 5365 6c65 6374 2061 6c6c 2065 6c65 6d65  Select all eleme
+00009e50: 6e74 7320 6f66 2073 616d 6520 7479 7065  nts of same type
+00009e60: 2229 2c0d 0a20 2020 2020 2020 206e 6f64  "),..        nod
+00009e70: 655f 7479 7065 3d65 6c65 6d5f 6e6f 6465  e_type=elem_node
+00009e80: 732c 0d0a 2020 2020 2020 2020 6865 6c70  s,..        help
+00009e90: 3d5f 2822 5365 6c65 6374 2061 6c6c 2065  =_("Select all e
+00009ea0: 6c65 6d65 6e74 7320 696e 2073 6365 6e65  lements in scene
+00009eb0: 2c20 7468 6174 2068 6176 6520 7468 6520  , that have the 
+00009ec0: 7361 6d65 2074 7970 6520 6173 2074 6869  same type as thi
+00009ed0: 7320 6e6f 6465 2229 2c0d 0a20 2020 2029  s node"),..    )
+00009ee0: 0d0a 2020 2020 6465 6620 7365 6c65 6374  ..    def select
+00009ef0: 5f73 696d 696c 6172 286e 6f64 652c 202a  _similar(node, *
+00009f00: 2a6b 7761 7267 7329 3a0d 0a20 2020 2020  *kwargs):..     
+00009f10: 2020 206e 7479 7065 203d 206e 6f64 652e     ntype = node.
+00009f20: 7479 7065 0d0a 2020 2020 2020 2020 6368  type..        ch
+00009f30: 616e 6765 7320 3d20 4661 6c73 650d 0a20  anges = False.. 
+00009f40: 2020 2020 2020 2066 6f72 2065 2069 6e20         for e in 
+00009f50: 7365 6c66 2e65 6c65 6d73 2829 3a0d 0a20  self.elems():.. 
+00009f60: 2020 2020 2020 2020 2020 2069 6620 652e             if e.
+00009f70: 7479 7065 203d 3d20 6e74 7970 6520 616e  type == ntype an
+00009f80: 6420 6e6f 7420 652e 656d 7068 6173 697a  d not e.emphasiz
+00009f90: 6564 2061 6e64 2065 2e63 616e 5f65 6d70  ed and e.can_emp
+00009fa0: 6861 7369 7a65 3a0d 0a20 2020 2020 2020  hasize:..       
+00009fb0: 2020 2020 2020 2020 2065 2e65 6d70 6861           e.empha
+00009fc0: 7369 7a65 6420 3d20 5472 7565 0d0a 2020  sized = True..  
+00009fd0: 2020 2020 2020 2020 2020 2020 2020 652e                e.
+00009fe0: 7365 6c65 6374 6564 203d 2054 7275 650d  selected = True.
+00009ff0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a000: 2063 6861 6e67 6573 203d 2054 7275 650d   changes = True.
+0000a010: 0a20 2020 2020 2020 2069 6620 6368 616e  .        if chan
+0000a020: 6765 733a 0d0a 2020 2020 2020 2020 2020  ges:..          
+0000a030: 2020 7365 6c66 2e76 616c 6964 6174 655f    self.validate_
+0000a040: 7365 6c65 6374 6564 5f61 7265 6128 290d  selected_area().
+0000a050: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0000a060: 662e 7369 676e 616c 2822 7265 6672 6573  f.signal("refres
+0000a070: 685f 7363 656e 6522 2c20 2253 6365 6e65  h_scene", "Scene
+0000a080: 2229 0d0a 0d0a 2020 2020 2320 3d3d 3d3d  ")....    # ====
+0000a090: 3d3d 3d3d 3d3d 0d0a 2020 2020 2320 5245  ======..    # RE
+0000a0a0: 4d4f 5645 2045 4c45 4d45 4e54 530d 0a20  MOVE ELEMENTS.. 
+0000a0b0: 2020 2023 203d 3d3d 3d3d 3d3d 3d3d 3d0d     # ==========.
+0000a0c0: 0a20 2020 2023 204d 6f72 6520 7468 616e  .    # More than
+0000a0d0: 206f 6e65 2c20 7370 6563 6961 6c20 6361   one, special ca
+0000a0e0: 7365 203d 3d20 3120 616c 7265 6164 7920  se == 1 already 
+0000a0f0: 6465 616c 7420 7769 7468 0d0a 2020 2020  dealt with..    
+0000a100: 4074 7265 655f 636f 6e64 6974 696f 6e61  @tree_conditiona
+0000a110: 6c28 6c61 6d62 6461 206e 6f64 653a 206c  l(lambda node: l
+0000a120: 656e 286c 6973 7428 7365 6c66 2e65 6c65  en(list(self.ele
+0000a130: 6d73 2865 6d70 6861 7369 7a65 643d 5472  ms(emphasized=Tr
+0000a140: 7565 2929 2920 3e20 3129 0d0a 2020 2020  ue))) > 1)..    
+0000a150: 4074 7265 655f 6361 6c63 2822 6563 6f75  @tree_calc("ecou
+0000a160: 6e74 222c 206c 616d 6264 6120 693a 206c  nt", lambda i: l
+0000a170: 656e 286c 6973 7428 7365 6c66 2e65 6c65  en(list(self.ele
+0000a180: 6d73 2865 6d70 6861 7369 7a65 643d 5472  ms(emphasized=Tr
+0000a190: 7565 2929 2929 0d0a 2020 2020 4074 7265  ue))))..    @tre
+0000a1a0: 655f 6f70 6572 6174 696f 6e28 0d0a 2020  e_operation(..  
+0000a1b0: 2020 2020 2020 5f28 2244 656c 6574 6520        _("Delete 
+0000a1c0: 7b65 636f 756e 747d 2065 6c65 6d65 6e74  {ecount} element
+0000a1d0: 732c 2061 7320 7365 6c65 6374 6564 2069  s, as selected i
+0000a1e0: 6e20 7363 656e 6522 292c 0d0a 2020 2020  n scene"),..    
+0000a1f0: 2020 2020 6e6f 6465 5f74 7970 653d 656c      node_type=el
+0000a200: 656d 5f67 726f 7570 5f6e 6f64 6573 2c0d  em_group_nodes,.
+0000a210: 0a20 2020 2020 2020 2068 656c 703d 2222  .        help=""
+0000a220: 2c0d 0a20 2020 2029 0d0a 2020 2020 6465  ,..    )..    de
+0000a230: 6620 7265 6d6f 7665 5f6e 5f65 6c65 6d65  f remove_n_eleme
+0000a240: 6e74 7328 6e6f 6465 2c20 2a2a 6b77 6172  nts(node, **kwar
+0000a250: 6773 293a 0d0a 2020 2020 2020 2020 7365  gs):..        se
+0000a260: 6c66 2822 656c 656d 656e 7420 6465 6c65  lf("element dele
+0000a270: 7465 5c6e 2229 0d0a 0d0a 2020 2020 4074  te\n")....    @t
+0000a280: 7265 655f 6f70 6572 6174 696f 6e28 0d0a  ree_operation(..
+0000a290: 2020 2020 2020 2020 5f28 2242 6563 6f6d          _("Becom
+0000a2a0: 6520 7265 6665 7265 6e63 6520 6f62 6a65  e reference obje
+0000a2b0: 6374 2229 2c0d 0a20 2020 2020 2020 206e  ct"),..        n
+0000a2c0: 6f64 655f 7479 7065 3d65 6c65 6d5f 6e6f  ode_type=elem_no
+0000a2d0: 6465 732c 0d0a 2020 2020 2020 2020 6865  des,..        he
+0000a2e0: 6c70 3d22 222c 0d0a 2020 2020 290d 0a20  lp="",..    ).. 
+0000a2f0: 2020 2064 6566 206d 616b 655f 6e6f 6465     def make_node
+0000a300: 5f72 6566 6572 656e 6365 286e 6f64 652c  _reference(node,
+0000a310: 202a 2a6b 7761 7267 7329 3a0d 0a20 2020   **kwargs):..   
+0000a320: 2020 2020 2073 656c 662e 7369 676e 616c       self.signal
+0000a330: 2822 6d61 6b65 5f72 6566 6572 656e 6365  ("make_reference
+0000a340: 222c 206e 6f64 6529 0d0a 0d0a 2020 2020  ", node)....    
+0000a350: 4074 7265 655f 636f 6e64 6974 696f 6e61  @tree_conditiona
+0000a360: 6c28 0d0a 2020 2020 2020 2020 6c61 6d62  l(..        lamb
+0000a370: 6461 206e 6f64 653a 2069 7369 6e73 7461  da node: isinsta
+0000a380: 6e63 6528 6e6f 6465 2e73 6861 7065 2c20  nce(node.shape, 
+0000a390: 506f 6c79 676f 6e29 2061 6e64 206c 656e  Polygon) and len
+0000a3a0: 286e 6f64 652e 7368 6170 652e 706f 696e  (node.shape.poin
+0000a3b0: 7473 2920 3e3d 2033 0d0a 2020 2020 290d  ts) >= 3..    ).
+0000a3c0: 0a20 2020 2040 7472 6565 5f6f 7065 7261  .    @tree_opera
+0000a3d0: 7469 6f6e 280d 0a20 2020 2020 2020 205f  tion(..        _
+0000a3e0: 2822 4d61 6b65 2050 6f6c 7967 6f6e 2072  ("Make Polygon r
+0000a3f0: 6567 756c 6172 2229 2c0d 0a20 2020 2020  egular"),..     
+0000a400: 2020 206e 6f64 655f 7479 7065 3d22 656c     node_type="el
+0000a410: 656d 2070 6f6c 796c 696e 6522 2c0d 0a20  em polyline",.. 
+0000a420: 2020 2020 2020 2068 656c 703d 2222 2c0d         help="",.
+0000a430: 0a20 2020 2029 0d0a 2020 2020 6465 6620  .    )..    def 
+0000a440: 6d61 6b65 5f70 6f6c 7967 6f6e 5f72 6567  make_polygon_reg
+0000a450: 756c 6172 286e 6f64 652c 202a 2a6b 7761  ular(node, **kwa
+0000a460: 7267 7329 3a0d 0a20 2020 2020 2020 2023  rgs):..        #
+0000a470: 2066 726f 6d20 2e75 6e69 7473 2069 6d70   from .units imp
+0000a480: 6f72 7420 4c65 6e67 7468 0d0a 2020 2020  ort Length..    
+0000a490: 2020 2020 2320 6672 6f6d 202e 2e73 7667      # from ..svg
+0000a4a0: 656c 656d 656e 7473 2069 6d70 6f72 7420  elements import 
+0000a4b0: 436f 6c6f 720d 0a0d 0a20 2020 2020 2020  Color....       
+0000a4c0: 2023 2064 6566 206d 6b5f 6465 6275 675f   # def mk_debug_
+0000a4d0: 706f 696e 7428 782c 2079 2c20 636f 6c29  point(x, y, col)
+0000a4e0: 3a0d 0a20 2020 2020 2020 2023 2020 2020  :..        #    
+0000a4f0: 2063 6972 6320 3d20 456c 6c69 7073 6528   circ = Ellipse(
+0000a500: 6378 3d78 2c20 6379 3d79 2c20 723d 666c  cx=x, cy=y, r=fl
+0000a510: 6f61 7428 4c65 6e67 7468 2822 316d 6d22  oat(Length("1mm"
+0000a520: 2929 290d 0a20 2020 2020 2020 2023 2020  )))..        #  
+0000a530: 2020 2063 6972 632e 7472 616e 7366 6f72     circ.transfor
+0000a540: 6d20 3d20 636f 7079 286e 6f64 652e 7368  m = copy(node.sh
+0000a550: 6170 652e 7472 616e 7366 6f72 6d29 0d0a  ape.transform)..
+0000a560: 2020 2020 2020 2020 2320 2020 2020 7365          #     se
+0000a570: 6c66 2e65 6c65 6d5f 6272 616e 6368 2e61  lf.elem_branch.a
+0000a580: 6464 280d 0a20 2020 2020 2020 2023 2020  dd(..        #  
+0000a590: 2020 2020 2020 2073 6861 7065 3d63 6972         shape=cir
+0000a5a0: 632c 0d0a 2020 2020 2020 2020 2320 2020  c,..        #   
+0000a5b0: 2020 2020 2020 7479 7065 3d22 656c 656d        type="elem
+0000a5c0: 2065 6c6c 6970 7365 222c 0d0a 2020 2020   ellipse",..    
+0000a5d0: 2020 2020 2320 2020 2020 2020 2020 7374      #         st
+0000a5e0: 726f 6b65 3d43 6f6c 6f72 2863 6f6c 292c  roke=Color(col),
+0000a5f0: 0d0a 2020 2020 2020 2020 2320 2020 2020  ..        #     
+0000a600: 2020 2020 6669 6c6c 3d43 6f6c 6f72 2863      fill=Color(c
+0000a610: 6f6c 292c 0d0a 2020 2020 2020 2020 2320  ol),..        # 
+0000a620: 2020 2020 2020 2020 6d61 7472 6978 3d63          matrix=c
+0000a630: 6f70 7928 6e6f 6465 2e6d 6174 7269 7829  opy(node.matrix)
+0000a640: 2c0d 0a20 2020 2020 2020 2023 2020 2020  ,..        #    
+0000a650: 2029 0d0a 0d0a 2020 2020 2020 2020 6966   )....        if
+0000a660: 206e 6f64 6520 6973 204e 6f6e 6520 6f72   node is None or
+0000a670: 206e 6f64 652e 7479 7065 2021 3d20 2265   node.type != "e
+0000a680: 6c65 6d20 706f 6c79 6c69 6e65 223a 0d0a  lem polyline":..
+0000a690: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0000a6a0: 726e 0d0a 2020 2020 2020 2020 6e75 6d62  rn..        numb
+0000a6b0: 6572 5f70 6f69 6e74 7320 3d20 6c65 6e28  er_points = len(
+0000a6c0: 6e6f 6465 2e73 6861 7065 2e70 6f69 6e74  node.shape.point
+0000a6d0: 7329 0d0a 2020 2020 2020 2020 2320 7072  s)..        # pr
+0000a6e0: 696e 7420 2866 224e 756d 6265 7220 6f66  int (f"Number of
+0000a6f0: 2070 6f69 6e74 733a 207b 6e75 6d62 6572   points: {number
+0000a700: 5f70 6f69 6e74 737d 2229 0d0a 2020 2020  _points}")..    
+0000a710: 2020 2020 2320 666f 7220 7072 6f70 2069      # for prop i
+0000a720: 6e20 6469 7228 6e6f 6465 293a 0d0a 2020  n dir(node):..  
+0000a730: 2020 2020 2020 2320 2020 2020 7072 696e        #     prin
+0000a740: 7420 2866 227b 7072 6f70 7d20 2d20 7b67  t (f"{prop} - {g
+0000a750: 6574 6174 7472 286e 6f64 652c 2027 7072  etattr(node, 'pr
+0000a760: 6f70 272c 2027 2729 7d22 290d 0a20 2020  op', '')}")..   
+0000a770: 2020 2020 2023 2066 6f72 2069 6478 2c20       # for idx, 
+0000a780: 7074 2069 6e20 656e 756d 6572 6174 6528  pt in enumerate(
+0000a790: 6e6f 6465 2e73 6861 7065 2e70 6f69 6e74  node.shape.point
+0000a7a0: 7329 3a0d 0a20 2020 2020 2020 2023 2020  s):..        #  
+0000a7b0: 2020 2070 7269 6e74 2028 6622 7b69 6478     print (f"{idx
+0000a7c0: 7d3a 207b 7074 2e78 3a2e 3166 7d2c 207b  }: {pt.x:.1f}, {
+0000a7d0: 7074 2e79 3a2e 3166 7d22 290d 0a20 2020  pt.y:.1f}")..   
+0000a7e0: 2020 2020 2069 6620 6e75 6d62 6572 5f70       if number_p
+0000a7f0: 6f69 6e74 7320 3c20 3320 6f72 206e 6f74  oints < 3 or not
+0000a800: 2069 7369 6e73 7461 6e63 6528 6e6f 6465   isinstance(node
+0000a810: 2e73 6861 7065 2c20 506f 6c79 676f 6e29  .shape, Polygon)
+0000a820: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
+0000a830: 6574 7572 6e0d 0a20 2020 2020 2020 2070  eturn..        p
+0000a840: 7473 203d 206e 6f64 652e 7368 6170 652e  ts = node.shape.
+0000a850: 706f 696e 7473 0d0a 2020 2020 2020 2020  points..        
+0000a860: 6478 203d 2070 7473 5b31 5d2e 7820 2d20  dx = pts[1].x - 
+0000a870: 7074 735b 305d 2e78 0d0a 2020 2020 2020  pts[0].x..      
+0000a880: 2020 6479 203d 2070 7473 5b31 5d2e 7920    dy = pts[1].y 
+0000a890: 2d20 7074 735b 305d 2e79 0d0a 2020 2020  - pts[0].y..    
+0000a8a0: 2020 2020 6261 7365 6c69 6e65 203d 206d      baseline = m
+0000a8b0: 6174 682e 7371 7274 2864 7820 2a20 6478  ath.sqrt(dx * dx
+0000a8c0: 202b 2064 7920 2a20 6479 290d 0a20 2020   + dy * dy)..   
+0000a8d0: 2020 2020 2061 706f 7468 656d 203d 2062       apothem = b
+0000a8e0: 6173 656c 696e 6520 2f20 2832 202a 206d  aseline / (2 * m
+0000a8f0: 6174 682e 7461 6e28 6d61 7468 2e74 6175  ath.tan(math.tau
+0000a900: 202f 2028 3220 2a20 6e75 6d62 6572 5f70   / (2 * number_p
+0000a910: 6f69 6e74 7329 2929 0d0a 2020 2020 2020  oints)))..      
+0000a920: 2020 6369 7263 756d 7261 6469 7573 203d    circumradius =
+0000a930: 2062 6173 656c 696e 6520 2f20 2832 202a   baseline / (2 *
+0000a940: 206d 6174 682e 7369 6e28 6d61 7468 2e74   math.sin(math.t
+0000a950: 6175 202f 2028 3220 2a20 6e75 6d62 6572  au / (2 * number
+0000a960: 5f70 6f69 6e74 7329 2929 0d0a 2020 2020  _points)))..    
+0000a970: 2020 2020 6d69 6470 6f69 6e74 203d 2050      midpoint = P
+0000a980: 6f69 6e74 2870 7473 5b30 5d2e 7820 2b20  oint(pts[0].x + 
+0000a990: 302e 3520 2a20 6478 2c20 7074 735b 305d  0.5 * dx, pts[0]
+0000a9a0: 2e79 202b 2030 2e35 202a 2064 7929 0d0a  .y + 0.5 * dy)..
+0000a9b0: 2020 2020 2020 2020 2320 206d 6b5f 6465          #  mk_de
+0000a9c0: 6275 675f 706f 696e 7428 6d69 6470 6f69  bug_point(midpoi
+0000a9d0: 6e74 2e78 2c20 6d69 6470 6f69 6e74 2e79  nt.x, midpoint.y
+0000a9e0: 2c20 2262 6c61 636b 2229 0d0a 2020 2020  , "black")..    
+0000a9f0: 2020 2020 6178 203d 2030 0d0a 2020 2020      ax = 0..    
+0000aa00: 2020 2020 6179 203d 2030 0d0a 2020 2020      ay = 0..    
+0000aa10: 2020 2020 666f 7220 6964 782c 2070 7420      for idx, pt 
+0000aa20: 696e 2065 6e75 6d65 7261 7465 2870 7473  in enumerate(pts
+0000aa30: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+0000aa40: 6178 202b 3d20 7074 2e78 0d0a 2020 2020  ax += pt.x..    
+0000aa50: 2020 2020 2020 2020 6179 202b 3d20 7074          ay += pt
+0000aa60: 2e79 0d0a 2020 2020 2020 2020 6178 202f  .y..        ax /
+0000aa70: 3d20 6e75 6d62 6572 5f70 6f69 6e74 730d  = number_points.
+0000aa80: 0a20 2020 2020 2020 2061 7920 2f3d 206e  .        ay /= n
+0000aa90: 756d 6265 725f 706f 696e 7473 0d0a 2020  umber_points..  
+0000aaa0: 2020 2020 2020 2320 5468 6520 6172 6974        # The arit
+0000aab0: 686d 6574 6963 2063 656e 7465 7220 2861  hmetic center (a
+0000aac0: 782c 2061 7929 2069 6e64 6963 6174 6573  x, ay) indicates
+0000aad0: 2074 6f20 7768 6963 680d 0a20 2020 2020   to which..     
+0000aae0: 2020 2023 2027 7369 6465 2720 6f66 2074     # 'side' of t
+0000aaf0: 6865 2062 6173 656c 696e 6520 7468 6520  he baseline the 
+0000ab00: 706f 6c79 676f 6e20 6e65 6564 7320 746f  polygon needs to
+0000ab10: 2062 6520 636f 6e73 7472 7563 7465 640d   be constructed.
+0000ab20: 0a20 2020 2020 2020 2061 7269 7468 6d65  .        arithme
+0000ab30: 7469 635f 6365 6e74 6572 203d 2050 6f69  tic_center = Poi
+0000ab40: 6e74 2861 782c 2061 7929 0d0a 2020 2020  nt(ax, ay)..    
+0000ab50: 2020 2020 2320 6d6b 5f64 6562 7567 5f70      # mk_debug_p
+0000ab60: 6f69 6e74 2861 782c 2061 792c 2022 6772  oint(ax, ay, "gr
+0000ab70: 6565 6e22 290d 0a20 2020 2020 2020 2061  een")..        a
+0000ab80: 6e67 6c65 203d 2070 7473 5b30 5d2e 616e  ngle = pts[0].an
+0000ab90: 676c 655f 746f 2870 7473 5b31 5d29 0d0a  gle_to(pts[1])..
+0000aba0: 2020 2020 2020 2020 6d69 6461 6e67 6c65          midangle
+0000abb0: 203d 206d 6964 706f 696e 742e 616e 676c   = midpoint.angl
+0000abc0: 655f 746f 2861 7269 7468 6d65 7469 635f  e_to(arithmetic_
+0000abd0: 6365 6e74 6572 290d 0a20 2020 2020 2020  center)..       
+0000abe0: 2061 6e67 6c65 202b 3d20 6d61 7468 2e74   angle += math.t
+0000abf0: 6175 202f 2034 0d0a 2020 2020 2020 2020  au / 4..        
+0000ac00: 6669 7273 745f 706f 696e 7420 3d20 506f  first_point = Po
+0000ac10: 696e 742e 706f 6c61 7228 6d69 6470 6f69  int.polar(midpoi
+0000ac20: 6e74 2c20 616e 676c 652c 2061 706f 7468  nt, angle, apoth
+0000ac30: 656d 290d 0a20 2020 2020 2020 2073 6563  em)..        sec
+0000ac40: 6f6e 645f 706f 696e 7420 3d20 506f 696e  ond_point = Poin
+0000ac50: 742e 706f 6c61 7228 6d69 6470 6f69 6e74  t.polar(midpoint
+0000ac60: 2c20 616e 676c 6520 2b20 6d61 7468 2e74  , angle + math.t
+0000ac70: 6175 202f 2032 2c20 6170 6f74 6865 6d29  au / 2, apothem)
+0000ac80: 0d0a 2020 2020 2020 2020 2320 6d6b 5f64  ..        # mk_d
+0000ac90: 6562 7567 5f70 6f69 6e74 2866 6972 7374  ebug_point(first
+0000aca0: 5f70 6f69 6e74 2e78 2c20 6669 7273 745f  _point.x, first_
+0000acb0: 706f 696e 742e 792c 2022 7965 6c6c 6f77  point.y, "yellow
+0000acc0: 2229 0d0a 2020 2020 2020 2020 2320 6d6b  ")..        # mk
+0000acd0: 5f64 6562 7567 5f70 6f69 6e74 2873 6563  _debug_point(sec
+0000ace0: 6f6e 645f 706f 696e 742e 782c 2073 6563  ond_point.x, sec
+0000acf0: 6f6e 645f 706f 696e 742e 792c 2022 6379  ond_point.y, "cy
+0000ad00: 616e 2229 0d0a 2020 2020 2020 2020 6465  an")..        de
+0000ad10: 6c74 6161 6e67 6c65 203d 206d 6174 682e  ltaangle = math.
+0000ad20: 7461 7520 2f20 6e75 6d62 6572 5f70 6f69  tau / number_poi
+0000ad30: 6e74 730d 0a20 2020 2020 2020 2064 3120  nts..        d1 
+0000ad40: 3d20 6172 6974 686d 6574 6963 5f63 656e  = arithmetic_cen
+0000ad50: 7465 722e 6469 7374 616e 6365 5f74 6f28  ter.distance_to(
+0000ad60: 6669 7273 745f 706f 696e 7429 0d0a 2020  first_point)..  
+0000ad70: 2020 2020 2020 6432 203d 2061 7269 7468        d2 = arith
+0000ad80: 6d65 7469 635f 6365 6e74 6572 2e64 6973  metic_center.dis
+0000ad90: 7461 6e63 655f 746f 2873 6563 6f6e 645f  tance_to(second_
+0000ada0: 706f 696e 7429 0d0a 2020 2020 2020 2020  point)..        
+0000adb0: 6966 2064 3120 3c20 6432 3a0d 0a20 2020  if d1 < d2:..   
+0000adc0: 2020 2020 2020 2020 2063 656e 7465 725f           center_
+0000add0: 706f 696e 7420 3d20 636f 7079 2866 6972  point = copy(fir
+0000ade0: 7374 5f70 6f69 6e74 290d 0a20 2020 2020  st_point)..     
+0000adf0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+0000ae00: 2020 2020 2020 6365 6e74 6572 5f70 6f69        center_poi
+0000ae10: 6e74 203d 2063 6f70 7928 7365 636f 6e64  nt = copy(second
+0000ae20: 5f70 6f69 6e74 290d 0a20 2020 2020 2020  _point)..       
+0000ae30: 2023 206d 6b5f 6465 6275 675f 706f 696e   # mk_debug_poin
+0000ae40: 7428 6365 6e74 6572 5f70 6f69 6e74 2e78  t(center_point.x
+0000ae50: 2c20 6365 6e74 6572 5f70 6f69 6e74 2e79  , center_point.y
+0000ae60: 2c20 2272 6564 2229 0d0a 0d0a 2020 2020  , "red")....    
+0000ae70: 2020 2020 6966 2063 656e 7465 725f 706f      if center_po
+0000ae80: 696e 742e 616e 676c 655f 746f 2870 7473  int.angle_to(pts
+0000ae90: 5b30 5d29 203e 2063 656e 7465 725f 706f  [0]) > center_po
+0000aea0: 696e 742e 616e 676c 655f 746f 2870 7473  int.angle_to(pts
+0000aeb0: 5b31 5d29 3a0d 0a20 2020 2020 2020 2020  [1]):..         
+0000aec0: 2020 2064 656c 7461 616e 676c 6520 2a3d     deltaangle *=
+0000aed0: 202d 310d 0a20 2020 2020 2020 2061 6e67   -1..        ang
+0000aee0: 6c65 203d 2063 656e 7465 725f 706f 696e  le = center_poin
+0000aef0: 742e 616e 676c 655f 746f 2870 7473 5b30  t.angle_to(pts[0
+0000af00: 5d29 0d0a 2020 2020 2020 2020 666f 7220  ])..        for 
+0000af10: 6964 7820 696e 2072 616e 6765 286e 756d  idx in range(num
+0000af20: 6265 725f 706f 696e 7473 293a 0d0a 2020  ber_points):..  
+0000af30: 2020 2020 2020 2020 2020 2320 6966 2069            # if i
+0000af40: 6478 203e 2031 3a0d 0a20 2020 2020 2020  dx > 1:..       
+0000af50: 2020 2020 2070 7420 3d20 506f 696e 742e       pt = Point.
+0000af60: 706f 6c61 7228 6365 6e74 6572 5f70 6f69  polar(center_poi
+0000af70: 6e74 2c20 616e 676c 652c 2063 6972 6375  nt, angle, circu
+0000af80: 6d72 6164 6975 7329 0d0a 2020 2020 2020  mradius)..      
+0000af90: 2020 2020 2020 7074 735b 6964 785d 2e78        pts[idx].x
+0000afa0: 203d 2070 742e 780d 0a20 2020 2020 2020   = pt.x..       
+0000afb0: 2020 2020 2070 7473 5b69 6478 5d2e 7920       pts[idx].y 
+0000afc0: 3d20 7074 2e79 0d0a 2020 2020 2020 2020  = pt.y..        
+0000afd0: 2020 2020 616e 676c 6520 2b3d 2064 656c      angle += del
+0000afe0: 7461 616e 676c 650d 0a20 2020 2020 2020  taangle..       
+0000aff0: 206e 6f64 652e 616c 7465 7265 6428 290d   node.altered().
+0000b000: 0a20 2020 2020 2020 2073 656c 662e 7369  .        self.si
+0000b010: 676e 616c 2822 7265 6672 6573 685f 7363  gnal("refresh_sc
+0000b020: 656e 6522 2c20 2253 6365 6e65 2229 0d0a  ene", "Scene")..
+0000b030: 0d0a 2020 2020 2320 3d3d 3d3d 3d3d 3d3d  ..    # ========
+0000b040: 3d3d 0d0a 2020 2020 2320 434f 4e56 4552  ==..    # CONVER
+0000b050: 5420 5452 4545 204f 5045 5241 5449 4f4e  T TREE OPERATION
+0000b060: 530d 0a20 2020 2023 203d 3d3d 3d3d 3d3d  S..    # =======
+0000b070: 3d3d 3d0d 0a20 2020 2040 7472 6565 5f6f  ===..    @tree_o
+0000b080: 7065 7261 7469 6f6e 280d 0a20 2020 2020  peration(..     
+0000b090: 2020 205f 2822 436f 6e76 6572 7420 746f     _("Convert to
+0000b0a0: 2043 7574 636f 6465 2229 2c0d 0a20 2020   Cutcode"),..   
+0000b0b0: 2020 2020 206e 6f64 655f 7479 7065 3d22       node_type="
+0000b0c0: 6c61 7365 7263 6f64 6522 2c0d 0a20 2020  lasercode",..   
+0000b0d0: 2020 2020 2068 656c 703d 2222 2c0d 0a20       help="",.. 
+0000b0e0: 2020 2029 0d0a 2020 2020 6465 6620 6c61     )..    def la
+0000b0f0: 7365 7263 6f64 6532 6375 7428 6e6f 6465  sercode2cut(node
+0000b100: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
+0000b110: 2020 2020 2020 6e6f 6465 2e72 6570 6c61        node.repla
+0000b120: 6365 5f6e 6f64 6528 4375 7443 6f64 652e  ce_node(CutCode.
+0000b130: 6672 6f6d 5f6c 6173 6572 636f 6465 286e  from_lasercode(n
+0000b140: 6f64 652e 636f 6d6d 616e 6473 292c 2074  ode.commands), t
+0000b150: 7970 653d 2263 7574 636f 6465 2229 0d0a  ype="cutcode")..
+0000b160: 0d0a 2020 2020 4074 7265 655f 636f 6e64  ..    @tree_cond
+0000b170: 6974 696f 6e61 6c5f 7472 7928 0d0a 2020  itional_try(..  
+0000b180: 2020 2020 2020 6c61 6d62 6461 206e 6f64        lambda nod
+0000b190: 653a 206b 6572 6e65 6c2e 6c6f 6f6b 7570  e: kernel.lookup
+0000b1a0: 2866 2273 706f 6f6c 6572 6a6f 622f 7b6e  (f"spoolerjob/{n
+0000b1b0: 6f64 652e 6461 7461 5f74 7970 657d 2229  ode.data_type}")
+0000b1c0: 2069 7320 6e6f 7420 4e6f 6e65 0d0a 2020   is not None..  
+0000b1d0: 2020 290d 0a20 2020 2040 7472 6565 5f6f    )..    @tree_o
+0000b1e0: 7065 7261 7469 6f6e 280d 0a20 2020 2020  peration(..     
+0000b1f0: 2020 205f 2822 436f 6e76 6572 7420 746f     _("Convert to
+0000b200: 2045 6c65 6d65 6e74 7322 292c 0d0a 2020   Elements"),..  
+0000b210: 2020 2020 2020 6e6f 6465 5f74 7970 653d        node_type=
+0000b220: 2262 6c6f 6222 2c0d 0a20 2020 2020 2020  "blob",..       
+0000b230: 2068 656c 703d 5f28 2243 6f6e 7665 7274   help=_("Convert
+0000b240: 2061 7474 6163 6865 6420 6269 6e61 7279   attached binary
+0000b250: 206f 626a 6563 7420 746f 2065 6c65 6d65   object to eleme
+0000b260: 6e74 7322 292c 0d0a 2020 2020 290d 0a20  nts"),..    ).. 
+0000b270: 2020 2064 6566 2062 6c6f 6232 7061 7468     def blob2path
+0000b280: 286e 6f64 652c 202a 2a6b 7761 7267 7329  (node, **kwargs)
+0000b290: 3a0d 0a20 2020 2020 2020 2063 616e 6365  :..        cance
+0000b2a0: 6c6c 6564 203d 2046 616c 7365 0d0a 2020  lled = False..  
+0000b2b0: 2020 2020 2020 6672 6f6d 206d 6565 726b        from meerk
+0000b2c0: 3430 742e 746f 6f6c 732e 6472 6976 6572  40t.tools.driver
+0000b2d0: 5f74 6f5f 7061 7468 2069 6d70 6f72 7420  _to_path import 
+0000b2e0: 4472 6976 6572 546f 5061 7468 0d0a 0d0a  DriverToPath....
+0000b2f0: 2020 2020 2020 2020 6432 7020 3d20 4472          d2p = Dr
+0000b300: 6976 6572 546f 5061 7468 2829 0d0a 2020  iverToPath()..  
+0000b310: 2020 2020 2020 6469 616c 6f67 5f63 6c61        dialog_cla
+0000b320: 7373 203d 206b 6572 6e65 6c2e 6c6f 6f6b  ss = kernel.look
+0000b330: 7570 2822 6469 616c 6f67 2f6f 7074 696f  up("dialog/optio
+0000b340: 6e73 2229 0d0a 2020 2020 2020 2020 6966  ns")..        if
+0000b350: 2064 6961 6c6f 675f 636c 6173 7320 616e   dialog_class an
+0000b360: 6420 6861 7361 7474 7228 6432 702c 2022  d hasattr(d2p, "
+0000b370: 6f70 7469 6f6e 7322 293a 0d0a 2020 2020  options"):..    
+0000b380: 2020 2020 2020 2020 6368 6f69 6365 7320          choices 
+0000b390: 3d20 6765 7461 7474 7228 6432 702c 2022  = getattr(d2p, "
+0000b3a0: 6f70 7469 6f6e 7322 2c20 4e6f 6e65 290d  options", None).
+0000b3b0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000b3c0: 6368 6f69 6365 7320 6973 206e 6f74 204e  choices is not N
+0000b3d0: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
+0000b3e0: 2020 2020 2020 666f 7220 656e 7472 7920        for entry 
+0000b3f0: 696e 2063 686f 6963 6573 3a0d 0a20 2020  in choices:..   
+0000b400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b410: 2069 6620 226c 6162 656c 2220 696e 2065   if "label" in e
+0000b420: 6e74 7279 3a0d 0a20 2020 2020 2020 2020  ntry:..         
+0000b430: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0000b440: 6e74 7279 5b22 6c61 6265 6c22 5d20 3d20  ntry["label"] = 
+0000b450: 5f28 656e 7472 795b 226c 6162 656c 225d  _(entry["label"]
+0000b460: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+0000b470: 2020 2020 2020 2069 6620 2274 6970 2220         if "tip" 
+0000b480: 696e 2065 6e74 7279 3a0d 0a20 2020 2020  in entry:..     
+0000b490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b4a0: 2020 2065 6e74 7279 5b22 7469 7022 5d20     entry["tip"] 
+0000b4b0: 3d20 5f28 656e 7472 795b 2274 6970 225d  = _(entry["tip"]
+0000b4c0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+0000b4d0: 2020 2020 2020 2069 6620 2264 6973 706c         if "displ
+0000b4e0: 6179 2220 696e 2065 6e74 7279 3a0d 0a20  ay" in entry:.. 
+0000b4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b500: 2020 2020 2020 206e 6577 6469 7370 6c61         newdispla
+0000b510: 7920 3d20 5b5d 0d0a 2020 2020 2020 2020  y = []..        
+0000b520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b530: 666f 7220 6465 6e74 7279 2069 6e20 656e  for dentry in en
+0000b540: 7472 795b 2264 6973 706c 6179 225d 3a0d  try["display"]:.
+0000b550: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b560: 2020 2020 2020 2020 2020 2020 206e 6577               new
+0000b570: 6469 7370 6c61 792e 6170 7065 6e64 285f  display.append(_
+0000b580: 2864 656e 7472 7929 290d 0a20 2020 2020  (dentry))..     
+0000b590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b5a0: 2020 2065 6e74 7279 5b22 6469 7370 6c61     entry["displa
+0000b5b0: 7922 5d20 3d20 6e65 7764 6973 706c 6179  y"] = newdisplay
+0000b5c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000b5d0: 2020 6469 616c 6f67 203d 2064 6961 6c6f    dialog = dialo
+0000b5e0: 675f 636c 6173 7328 7365 6c66 2e6b 6572  g_class(self.ker
+0000b5f0: 6e65 6c2c 2063 686f 6963 6573 3d63 686f  nel, choices=cho
+0000b600: 6963 6573 290d 0a20 2020 2020 2020 2020  ices)..         
+0000b610: 2020 2020 2020 2072 6573 203d 2064 6961         res = dia
+0000b620: 6c6f 672e 6469 616c 6f67 5f6f 7074 696f  log.dialog_optio
+0000b630: 6e73 280d 0a20 2020 2020 2020 2020 2020  ns(..           
+0000b640: 2020 2020 2020 2020 2074 6974 6c65 3d5f           title=_
+0000b650: 2822 426c 6f62 2d43 6f6e 7665 7273 696f  ("Blob-Conversio
+0000b660: 6e22 292c 0d0a 2020 2020 2020 2020 2020  n"),..          
+0000b670: 2020 2020 2020 2020 2020 696e 7472 6f3d            intro=
+0000b680: 5f28 0d0a 2020 2020 2020 2020 2020 2020  _(..            
+0000b690: 2020 2020 2020 2020 2020 2020 2259 6f75              "You
+0000b6a0: 2063 616e 2069 6e66 6c75 656e 6365 2074   can influence t
+0000b6b0: 6865 2077 6179 204d 4b20 7769 6c6c 2070  he way MK will p
+0000b6c0: 726f 6365 7373 2074 6865 2061 7474 6163  rocess the attac
+0000b6d0: 6865 6420 6269 6e61 7279 2064 6174 613a  hed binary data:
+0000b6e0: 220d 0a20 2020 2020 2020 2020 2020 2020  "..             
+0000b6f0: 2020 2020 2020 2029 2c0d 0a20 2020 2020         ),..     
+0000b700: 2020 2020 2020 2020 2020 2029 0d0a 2020             )..  
+0000b710: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0000b720: 206e 6f74 2072 6573 3a0d 0a20 2020 2020   not res:..     
+0000b730: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0000b740: 616e 6365 6c6c 6564 203d 2054 7275 650d  ancelled = True.
+0000b750: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+0000b760: 6361 6e63 656c 6c65 643a 0d0a 2020 2020  cancelled:..    
+0000b770: 2020 2020 2020 2020 6432 702e 7061 7273          d2p.pars
+0000b780: 6528 6e6f 6465 2e64 6174 615f 7479 7065  e(node.data_type
+0000b790: 2c20 6e6f 6465 2e64 6174 612c 2073 656c  , node.data, sel
+0000b7a0: 6629 0d0a 2020 2020 2020 2020 7265 7475  f)..        retu
+0000b7b0: 726e 2054 7275 650d 0a0d 0a20 2020 2040  rn True....    @
+0000b7c0: 7472 6565 5f63 6f6e 6469 7469 6f6e 616c  tree_conditional
+0000b7d0: 5f74 7279 280d 0a20 2020 2020 2020 206c  _try(..        l
+0000b7e0: 616d 6264 6120 6e6f 6465 3a20 6b65 726e  ambda node: kern
+0000b7f0: 656c 2e6c 6f6f 6b75 7028 6622 7370 6f6f  el.lookup(f"spoo
+0000b800: 6c65 726a 6f62 2f7b 6e6f 6465 2e64 6174  lerjob/{node.dat
+0000b810: 615f 7479 7065 7d22 2920 6973 206e 6f74  a_type}") is not
+0000b820: 204e 6f6e 650d 0a20 2020 2029 0d0a 2020   None..    )..  
+0000b830: 2020 4074 7265 655f 6f70 6572 6174 696f    @tree_operatio
+0000b840: 6e28 0d0a 2020 2020 2020 2020 5f28 2245  n(..        _("E
+0000b850: 7865 6375 7465 2042 6c6f 6222 292c 0d0a  xecute Blob"),..
+0000b860: 2020 2020 2020 2020 6e6f 6465 5f74 7970          node_typ
+0000b870: 653d 2262 6c6f 6222 2c0d 0a20 2020 2020  e="blob",..     
+0000b880: 2020 2068 656c 703d 5f28 2252 756e 2074     help=_("Run t
+0000b890: 6865 2067 6976 656e 2062 6c6f 6220 6f6e  he given blob on
+0000b8a0: 2074 6865 2063 7572 7265 6e74 2064 6576   the current dev
+0000b8b0: 6963 6522 292c 0d0a 2020 2020 290d 0a20  ice"),..    ).. 
+0000b8c0: 2020 2064 6566 2062 6c6f 625f 6578 6563     def blob_exec
+0000b8d0: 7574 6528 6e6f 6465 2c20 2a2a 6b77 6172  ute(node, **kwar
+0000b8e0: 6773 293a 0d0a 2020 2020 2020 2020 7370  gs):..        sp
+0000b8f0: 6f6f 6c65 725f 6a6f 6220 3d20 7365 6c66  ooler_job = self
+0000b900: 2e6c 6f6f 6b75 7028 6622 7370 6f6f 6c65  .lookup(f"spoole
+0000b910: 726a 6f62 2f7b 6e6f 6465 2e64 6174 615f  rjob/{node.data_
+0000b920: 7479 7065 7d22 290d 0a20 2020 2020 2020  type}")..       
+0000b930: 206d 6174 7269 7820 3d20 7365 6c66 2e64   matrix = self.d
+0000b940: 6576 6963 652e 7363 656e 655f 746f 5f64  evice.scene_to_d
+0000b950: 6576 6963 655f 6d61 7472 6978 2829 0d0a  evice_matrix()..
+0000b960: 2020 2020 2020 2020 6a6f 625f 6f62 6a65          job_obje
+0000b970: 6374 203d 2073 706f 6f6c 6572 5f6a 6f62  ct = spooler_job
+0000b980: 2873 656c 662e 6465 7669 6365 2e64 7269  (self.device.dri
+0000b990: 7665 722c 206d 6174 7269 7829 0d0a 2020  ver, matrix)..  
+0000b9a0: 2020 2020 2020 6a6f 625f 6f62 6a65 6374        job_object
+0000b9b0: 2e77 7269 7465 5f62 6c6f 6228 6e6f 6465  .write_blob(node
+0000b9c0: 2e64 6174 6129 0d0a 2020 2020 2020 2020  .data)..        
+0000b9d0: 7365 6c66 2e64 6576 6963 652e 7370 6f6f  self.device.spoo
+0000b9e0: 6c65 722e 7365 6e64 286a 6f62 5f6f 626a  ler.send(job_obj
+0000b9f0: 6563 7429 0d0a 0d0a 2020 2020 4074 7265  ect)....    @tre
+0000ba00: 655f 636f 6e64 6974 696f 6e61 6c5f 7472  e_conditional_tr
+0000ba10: 7928 6c61 6d62 6461 206e 6f64 653a 2068  y(lambda node: h
+0000ba20: 6173 6174 7472 286e 6f64 652c 2022 6173  asattr(node, "as
+0000ba30: 5f63 7574 6f62 6a65 6374 7322 2929 0d0a  _cutobjects"))..
+0000ba40: 2020 2020 4074 7265 655f 6f70 6572 6174      @tree_operat
+0000ba50: 696f 6e28 0d0a 2020 2020 2020 2020 5f28  ion(..        _(
+0000ba60: 2243 6f6e 7665 7274 2074 6f20 4375 7463  "Convert to Cutc
+0000ba70: 6f64 6522 292c 0d0a 2020 2020 2020 2020  ode"),..        
+0000ba80: 6e6f 6465 5f74 7970 653d 2262 6c6f 6222  node_type="blob"
+0000ba90: 2c0d 0a20 2020 2020 2020 2068 656c 703d  ,..        help=
+0000baa0: 2222 2c0d 0a20 2020 2029 0d0a 2020 2020  "",..    )..    
+0000bab0: 6465 6620 626c 6f62 3263 7574 286e 6f64  def blob2cut(nod
+0000bac0: 652c 202a 2a6b 7761 7267 7329 3a0d 0a20  e, **kwargs):.. 
+0000bad0: 2020 2020 2020 206e 6f64 652e 7265 706c         node.repl
+0000bae0: 6163 655f 6e6f 6465 286e 6f64 652e 6173  ace_node(node.as
+0000baf0: 5f63 7574 6f62 6a65 6374 7328 292c 2074  _cutobjects(), t
+0000bb00: 7970 653d 2263 7574 636f 6465 2229 0d0a  ype="cutcode")..
+0000bb10: 0d0a 2020 2020 4074 7265 655f 6f70 6572  ..    @tree_oper
+0000bb20: 6174 696f 6e28 0d0a 2020 2020 2020 2020  ation(..        
+0000bb30: 5f28 2243 6f6e 7665 7274 2074 6f20 5061  _("Convert to Pa
+0000bb40: 7468 2229 2c0d 0a20 2020 2020 2020 206e  th"),..        n
+0000bb50: 6f64 655f 7479 7065 3d22 6375 7463 6f64  ode_type="cutcod
+0000bb60: 6522 2c0d 0a20 2020 2020 2020 2068 656c  e",..        hel
+0000bb70: 703d 2222 2c0d 0a20 2020 2029 0d0a 2020  p="",..    )..  
+0000bb80: 2020 6465 6620 6375 7463 6f64 6532 7061    def cutcode2pa
+0000bb90: 7468 6375 7428 6e6f 6465 2c20 2a2a 6b77  thcut(node, **kw
+0000bba0: 6172 6773 293a 0d0a 2020 2020 2020 2020  args):..        
+0000bbb0: 6375 7463 6f64 6520 3d20 6e6f 6465 2e63  cutcode = node.c
+0000bbc0: 7574 636f 6465 0d0a 2020 2020 2020 2020  utcode..        
+0000bbd0: 6966 2063 7574 636f 6465 2069 7320 4e6f  if cutcode is No
+0000bbe0: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
+0000bbf0: 2072 6574 7572 6e0d 0a20 2020 2020 2020   return..       
+0000bc00: 2065 6c65 6d65 6e74 7320 3d20 6c69 7374   elements = list
+0000bc10: 2863 7574 636f 6465 2e61 735f 656c 656d  (cutcode.as_elem
+0000bc20: 656e 7473 2829 290d 0a20 2020 2020 2020  ents())..       
+0000bc30: 206e 203d 204e 6f6e 650d 0a20 2020 2020   n = None..     
+0000bc40: 2020 2066 6f72 2065 6c65 6d65 6e74 2069     for element i
+0000bc50: 6e20 656c 656d 656e 7473 3a0d 0a20 2020  n elements:..   
+0000bc60: 2020 2020 2020 2020 206e 203d 2073 656c           n = sel
+0000bc70: 662e 656c 656d 5f62 7261 6e63 682e 6164  f.elem_branch.ad
+0000bc80: 6428 7479 7065 3d22 656c 656d 2070 6174  d(type="elem pat
+0000bc90: 6822 2c20 7061 7468 3d65 6c65 6d65 6e74  h", path=element
+0000bca0: 290d 0a20 2020 2020 2020 206e 6f64 652e  )..        node.
+0000bcb0: 7265 6d6f 7665 5f6e 6f64 6528 290d 0a20  remove_node().. 
+0000bcc0: 2020 2020 2020 2069 6620 6e20 6973 206e         if n is n
+0000bcd0: 6f74 204e 6f6e 653a 0d0a 2020 2020 2020  ot None:..      
+0000bce0: 2020 2020 2020 6e2e 666f 6375 7328 290d        n.focus().
+0000bcf0: 0a0d 0a20 2020 2040 7472 6565 5f73 7562  ...    @tree_sub
+0000bd00: 6d65 6e75 285f 2822 436c 6f6e 6520 7265  menu(_("Clone re
+0000bd10: 6665 7265 6e63 6522 2929 0d0a 2020 2020  ference"))..    
+0000bd20: 4074 7265 655f 6f70 6572 6174 696f 6e28  @tree_operation(
+0000bd30: 5f28 224d 616b 6520 3120 636f 7079 2229  _("Make 1 copy")
+0000bd40: 2c20 6e6f 6465 5f74 7970 653d 2822 7265  , node_type=("re
+0000bd50: 6665 7265 6e63 6522 2c29 2c20 6865 6c70  ference",), help
+0000bd60: 3d22 2229 0d0a 2020 2020 6465 6620 636c  ="")..    def cl
+0000bd70: 6f6e 655f 7369 6e67 6c65 5f65 6c65 6d65  one_single_eleme
+0000bd80: 6e74 5f6f 7028 6e6f 6465 2c20 2a2a 6b77  nt_op(node, **kw
+0000bd90: 6172 6773 293a 0d0a 2020 2020 2020 2020  args):..        
+0000bda0: 636c 6f6e 655f 656c 656d 656e 745f 6f70  clone_element_op
+0000bdb0: 286e 6f64 652c 2063 6f70 6965 733d 312c  (node, copies=1,
+0000bdc0: 202a 2a6b 7761 7267 7329 0d0a 0d0a 2020   **kwargs)....  
+0000bdd0: 2020 4074 7265 655f 7375 626d 656e 7528    @tree_submenu(
+0000bde0: 5f28 2243 6c6f 6e65 2072 6566 6572 656e  _("Clone referen
+0000bdf0: 6365 2229 290d 0a20 2020 2040 7472 6565  ce"))..    @tree
+0000be00: 5f69 7465 7261 7465 2822 636f 7069 6573  _iterate("copies
+0000be10: 222c 2032 2c20 3130 290d 0a20 2020 2040  ", 2, 10)..    @
+0000be20: 7472 6565 5f6f 7065 7261 7469 6f6e 285f  tree_operation(_
+0000be30: 2822 4d61 6b65 207b 636f 7069 6573 7d20  ("Make {copies} 
+0000be40: 636f 7069 6573 2229 2c20 6e6f 6465 5f74  copies"), node_t
+0000be50: 7970 653d 2822 7265 6665 7265 6e63 6522  ype=("reference"
+0000be60: 2c29 2c20 6865 6c70 3d22 2229 0d0a 2020  ,), help="")..  
+0000be70: 2020 6465 6620 636c 6f6e 655f 656c 656d    def clone_elem
+0000be80: 656e 745f 6f70 286e 6f64 652c 2063 6f70  ent_op(node, cop
+0000be90: 6965 733d 312c 202a 2a6b 7761 7267 7329  ies=1, **kwargs)
+0000bea0: 3a0d 0a20 2020 2020 2020 2077 6974 6820  :..        with 
+0000beb0: 7365 6c66 2e73 7461 7469 6328 2263 6c6f  self.static("clo
+0000bec0: 6e65 5f65 6c65 6d5f 6f70 2229 3a0d 0a20  ne_elem_op"):.. 
+0000bed0: 2020 2020 2020 2020 2020 206e 6f64 6573             nodes
+0000bee0: 203d 206c 6973 7428 7365 6c66 2e66 6c61   = list(self.fla
+0000bef0: 7428 7365 6c65 6374 6564 3d54 7275 652c  t(selected=True,
+0000bf00: 2063 6173 6361 6465 3d46 616c 7365 2c20   cascade=False, 
+0000bf10: 7479 7065 733d 2272 6566 6572 656e 6365  types="reference
+0000bf20: 2229 290d 0a20 2020 2020 2020 2020 2020  "))..           
+0000bf30: 2066 6f72 2073 6e6f 6465 2069 6e20 6e6f   for snode in no
+0000bf40: 6465 733a 0d0a 2020 2020 2020 2020 2020  des:..          
+0000bf50: 2020 2020 2020 696e 6465 7820 3d20 736e        index = sn
+0000bf60: 6f64 652e 7061 7265 6e74 2e63 6869 6c64  ode.parent.child
+0000bf70: 7265 6e2e 696e 6465 7828 736e 6f64 6529  ren.index(snode)
+0000bf80: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000bf90: 2020 666f 7220 6920 696e 2072 616e 6765    for i in range
+0000bfa0: 2863 6f70 6965 7329 3a0d 0a20 2020 2020  (copies):..     
+0000bfb0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000bfc0: 6e6f 6465 2e70 6172 656e 742e 6164 645f  node.parent.add_
+0000bfd0: 7265 6665 7265 6e63 6528 736e 6f64 652e  reference(snode.
+0000bfe0: 6e6f 6465 2c20 706f 733d 696e 6465 7829  node, pos=index)
+0000bff0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000c000: 2020 736e 6f64 652e 6d6f 6469 6669 6564    snode.modified
+0000c010: 2829 0d0a 0d0a 2020 2020 4074 7265 655f  ()....    @tree_
+0000c020: 636f 6e64 6974 696f 6e61 6c28 6c61 6d62  conditional(lamb
+0000c030: 6461 206e 6f64 653a 206e 6f64 652e 636f  da node: node.co
+0000c040: 756e 745f 6368 696c 6472 656e 2829 203e  unt_children() >
+0000c050: 2031 290d 0a20 2020 2040 7472 6565 5f6f   1)..    @tree_o
+0000c060: 7065 7261 7469 6f6e 280d 0a20 2020 2020  peration(..     
+0000c070: 2020 205f 2822 5265 7665 7273 6520 7375     _("Reverse su
+0000c080: 6269 7465 6d73 206f 7264 6572 2229 2c0d  bitems order"),.
+0000c090: 0a20 2020 2020 2020 206e 6f64 655f 7479  .        node_ty
+0000c0a0: 7065 3d28 0d0a 2020 2020 2020 2020 2020  pe=(..          
+0000c0b0: 2020 226f 7020 6375 7422 2c0d 0a20 2020    "op cut",..   
+0000c0c0: 2020 2020 2020 2020 2022 6f70 2072 6173           "op ras
+0000c0d0: 7465 7222 2c0d 0a20 2020 2020 2020 2020  ter",..         
+0000c0e0: 2020 2022 6f70 2069 6d61 6765 222c 0d0a     "op image",..
+0000c0f0: 2020 2020 2020 2020 2020 2020 226f 7020              "op 
+0000c100: 656e 6772 6176 6522 2c0d 0a20 2020 2020  engrave",..     
+0000c110: 2020 2020 2020 2022 6f70 2064 6f74 7322         "op dots"
+0000c120: 2c0d 0a20 2020 2020 2020 2020 2020 2022  ,..            "
+0000c130: 6f70 2068 6174 6368 222c 0d0a 2020 2020  op hatch",..    
+0000c140: 2020 2020 2020 2020 2267 726f 7570 222c          "group",
+0000c150: 0d0a 2020 2020 2020 2020 2020 2020 2262  ..            "b
+0000c160: 7261 6e63 6820 656c 656d 7322 2c0d 0a20  ranch elems",.. 
+0000c170: 2020 2020 2020 2020 2020 2022 6669 6c65             "file
+0000c180: 222c 0d0a 2020 2020 2020 2020 2020 2020  ",..            
+0000c190: 2262 7261 6e63 6820 6f70 7322 2c0d 0a20  "branch ops",.. 
+0000c1a0: 2020 2020 2020 2029 2c0d 0a20 2020 2020         ),..     
+0000c1b0: 2020 2068 656c 703d 5f28 2252 6576 6572     help=_("Rever
+0000c1c0: 7365 2074 6865 2069 7465 6d73 2077 6974  se the items wit
+0000c1d0: 6869 6e20 7468 6973 2073 7562 6974 656d  hin this subitem
+0000c1e0: 2229 2c0d 0a20 2020 2029 0d0a 2020 2020  "),..    )..    
+0000c1f0: 6465 6620 7265 7665 7273 655f 6c61 7965  def reverse_laye
+0000c200: 725f 6f72 6465 7228 6e6f 6465 2c20 2a2a  r_order(node, **
+0000c210: 6b77 6172 6773 293a 0d0a 2020 2020 2020  kwargs):..      
+0000c220: 2020 6e6f 6465 2e72 6576 6572 7365 2829    node.reverse()
+0000c230: 0d0a 2020 2020 2020 2020 7365 6c66 2e73  ..        self.s
+0000c240: 6967 6e61 6c28 2272 6566 7265 7368 5f74  ignal("refresh_t
+0000c250: 7265 6522 2c20 6c69 7374 2873 656c 662e  ree", list(self.
+0000c260: 666c 6174 2874 7970 6573 3d22 7265 6665  flat(types="refe
+0000c270: 7265 6e63 6522 2929 290d 0a0d 0a20 2020  rence")))....   
+0000c280: 2040 7472 6565 5f73 6570 6172 6174 6f72   @tree_separator
+0000c290: 5f61 6674 6572 2829 0d0a 2020 2020 4074  _after()..    @t
+0000c2a0: 7265 655f 636f 6e64 6974 696f 6e61 6c28  ree_conditional(
+0000c2b0: 6c61 6d62 6461 206e 6f64 653a 2073 656c  lambda node: sel
+0000c2c0: 662e 636c 6173 7369 6679 5f61 7574 6f67  f.classify_autog
+0000c2d0: 656e 6572 6174 6529 0d0a 2020 2020 4074  enerate)..    @t
+0000c2e0: 7265 655f 6f70 6572 6174 696f 6e28 0d0a  ree_operation(..
+0000c2f0: 2020 2020 2020 2020 5f28 2252 6566 7265          _("Refre
+0000c300: 7368 2063 6c61 7373 6966 6963 6174 696f  sh classificatio
+0000c310: 6e22 292c 0d0a 2020 2020 2020 2020 6e6f  n"),..        no
+0000c320: 6465 5f74 7970 653d 2262 7261 6e63 6820  de_type="branch 
+0000c330: 6f70 7322 2c0d 0a20 2020 2020 2020 2068  ops",..        h
+0000c340: 656c 703d 5f28 2252 6563 6c61 7373 6966  elp=_("Reclassif
+0000c350: 7920 656c 656d 656e 7473 2061 6e64 2063  y elements and c
+0000c360: 7265 6174 6520 6f70 6572 6174 696f 6e73  reate operations
+0000c370: 2069 6620 6e65 6365 7373 6172 7922 292c   if necessary"),
+0000c380: 0d0a 2020 2020 290d 0a20 2020 2064 6566  ..    )..    def
+0000c390: 2072 6566 7265 7368 5f63 6c61 7369 6669   refresh_clasifi
+0000c3a0: 6361 7469 6f6e 735f 3128 6e6f 6465 2c20  cations_1(node, 
+0000c3b0: 2a2a 6b77 6172 6773 293a 0d0a 2020 2020  **kwargs):..    
+0000c3c0: 2020 2020 7365 6c66 2e72 656d 6f76 655f      self.remove_
+0000c3d0: 656c 656d 656e 7473 5f66 726f 6d5f 6f70  elements_from_op
+0000c3e0: 6572 6174 696f 6e73 286c 6973 7428 7365  erations(list(se
+0000c3f0: 6c66 2e65 6c65 6d73 2829 2929 0d0a 2020  lf.elems()))..  
+0000c400: 2020 2020 2020 7365 6c66 2e63 6c61 7373        self.class
+0000c410: 6966 7928 6c69 7374 2873 656c 662e 656c  ify(list(self.el
+0000c420: 656d 7328 2929 290d 0a20 2020 2020 2020  ems()))..       
+0000c430: 2073 656c 662e 7369 676e 616c 2822 7265   self.signal("re
+0000c440: 6672 6573 685f 7472 6565 222c 206c 6973  fresh_tree", lis
+0000c450: 7428 7365 6c66 2e66 6c61 7428 7479 7065  t(self.flat(type
+0000c460: 733d 2272 6566 6572 656e 6365 2229 2929  s="reference")))
+0000c470: 0d0a 0d0a 2020 2020 4074 7265 655f 636f  ....    @tree_co
+0000c480: 6e64 6974 696f 6e61 6c28 6c61 6d62 6461  nditional(lambda
+0000c490: 206e 6f64 653a 206e 6f74 2073 656c 662e   node: not self.
+0000c4a0: 636c 6173 7369 6679 5f61 7574 6f67 656e  classify_autogen
+0000c4b0: 6572 6174 6529 0d0a 2020 2020 4074 7265  erate)..    @tre
+0000c4c0: 655f 6f70 6572 6174 696f 6e28 0d0a 2020  e_operation(..  
+0000c4d0: 2020 2020 2020 5f28 2252 6566 7265 7368        _("Refresh
+0000c4e0: 2063 6c61 7373 6966 6963 6174 696f 6e22   classification"
+0000c4f0: 292c 0d0a 2020 2020 2020 2020 6e6f 6465  ),..        node
+0000c500: 5f74 7970 653d 2262 7261 6e63 6820 6f70  _type="branch op
+0000c510: 7322 2c0d 0a20 2020 2020 2020 2068 656c  s",..        hel
+0000c520: 703d 5f28 2252 6563 6c61 7373 6966 7920  p=_("Reclassify 
+0000c530: 656c 656d 656e 7473 2061 6e64 2075 7365  elements and use
+0000c540: 206f 6e6c 7920 6578 6973 7469 6e67 206f   only existing o
+0000c550: 7065 7261 7469 6f6e 7322 292c 0d0a 2020  perations"),..  
+0000c560: 2020 290d 0a20 2020 2064 6566 2072 6566    )..    def ref
+0000c570: 7265 7368 5f63 6c61 7369 6669 6361 7469  resh_clasificati
+0000c580: 6f6e 735f 3228 6e6f 6465 2c20 2a2a 6b77  ons_2(node, **kw
+0000c590: 6172 6773 293a 0d0a 2020 2020 2020 2020  args):..        
+0000c5a0: 7365 6c66 2e72 656d 6f76 655f 656c 656d  self.remove_elem
+0000c5b0: 656e 7473 5f66 726f 6d5f 6f70 6572 6174  ents_from_operat
+0000c5c0: 696f 6e73 286c 6973 7428 7365 6c66 2e65  ions(list(self.e
+0000c5d0: 6c65 6d73 2829 2929 0d0a 2020 2020 2020  lems()))..      
+0000c5e0: 2020 7365 6c66 2e63 6c61 7373 6966 7928    self.classify(
+0000c5f0: 6c69 7374 2873 656c 662e 656c 656d 7328  list(self.elems(
+0000c600: 2929 290d 0a20 2020 2020 2020 2073 656c  )))..        sel
+0000c610: 662e 7369 676e 616c 2822 7265 6672 6573  f.signal("refres
+0000c620: 685f 7472 6565 222c 206c 6973 7428 7365  h_tree", list(se
+0000c630: 6c66 2e66 6c61 7428 7479 7065 733d 2272  lf.flat(types="r
+0000c640: 6566 6572 656e 6365 2229 2929 0d0a 0d0a  eference")))....
+0000c650: 2020 2020 4074 7265 655f 7365 7061 7261      @tree_separa
+0000c660: 746f 725f 6166 7465 7228 290d 0a20 2020  tor_after()..   
+0000c670: 2040 7472 6565 5f63 6f6e 6469 7469 6f6e   @tree_condition
+0000c680: 616c 286c 616d 6264 6120 6e6f 6465 3a20  al(lambda node: 
+0000c690: 6e6f 7420 7365 6c66 2e63 6c61 7373 6966  not self.classif
+0000c6a0: 795f 6175 746f 6765 6e65 7261 7465 290d  y_autogenerate).
+0000c6b0: 0a20 2020 2040 7472 6565 5f6f 7065 7261  .    @tree_opera
+0000c6c0: 7469 6f6e 280d 0a20 2020 2020 2020 205f  tion(..        _
+0000c6d0: 2822 5265 6672 6573 6820 2e2e 2e20 2869  ("Refresh ... (i
+0000c6e0: 6e63 6c20 6175 746f 6765 6e65 7261 7469  ncl autogenerati
+0000c6f0: 6f6e 2922 292c 0d0a 2020 2020 2020 2020  on)"),..        
+0000c700: 6e6f 6465 5f74 7970 653d 2262 7261 6e63  node_type="branc
+0000c710: 6820 6f70 7322 2c0d 0a20 2020 2020 2020  h ops",..       
+0000c720: 2068 656c 703d 5f28 2252 6563 6c61 7373   help=_("Reclass
+0000c730: 6966 7920 656c 656d 656e 7473 2061 6e64  ify elements and
+0000c740: 2063 7265 6174 6520 6f70 6572 6174 696f   create operatio
+0000c750: 6e73 2069 6620 6e65 6365 7373 6172 7922  ns if necessary"
+0000c760: 292c 0d0a 2020 2020 290d 0a20 2020 2064  ),..    )..    d
+0000c770: 6566 2072 6566 7265 7368 5f63 6c61 7369  ef refresh_clasi
+0000c780: 6669 6361 7469 6f6e 735f 3328 6e6f 6465  fications_3(node
+0000c790: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
+0000c7a0: 2020 2020 2020 7072 6576 696f 7573 203d        previous =
+0000c7b0: 2073 656c 662e 636c 6173 7369 6679 5f61   self.classify_a
+0000c7c0: 7574 6f67 656e 6572 6174 650d 0a20 2020  utogenerate..   
+0000c7d0: 2020 2020 2073 656c 662e 636c 6173 7369       self.classi
+0000c7e0: 6679 5f61 7574 6f67 656e 6572 6174 6520  fy_autogenerate 
+0000c7f0: 3d20 5472 7565 0d0a 2020 2020 2020 2020  = True..        
+0000c800: 7365 6c66 2e72 656d 6f76 655f 656c 656d  self.remove_elem
+0000c810: 656e 7473 5f66 726f 6d5f 6f70 6572 6174  ents_from_operat
+0000c820: 696f 6e73 286c 6973 7428 7365 6c66 2e65  ions(list(self.e
+0000c830: 6c65 6d73 2829 2929 0d0a 2020 2020 2020  lems()))..      
+0000c840: 2020 7365 6c66 2e63 6c61 7373 6966 7928    self.classify(
+0000c850: 6c69 7374 2873 656c 662e 656c 656d 7328  list(self.elems(
+0000c860: 2929 290d 0a20 2020 2020 2020 2073 656c  )))..        sel
+0000c870: 662e 636c 6173 7369 6679 5f61 7574 6f67  f.classify_autog
+0000c880: 656e 6572 6174 6520 3d20 7072 6576 696f  enerate = previo
+0000c890: 7573 0d0a 2020 2020 2020 2020 7365 6c66  us..        self
+0000c8a0: 2e73 6967 6e61 6c28 2272 6566 7265 7368  .signal("refresh
+0000c8b0: 5f74 7265 6522 2c20 6c69 7374 2873 656c  _tree", list(sel
+0000c8c0: 662e 666c 6174 2874 7970 6573 3d22 7265  f.flat(types="re
+0000c8d0: 6665 7265 6e63 6522 2929 290d 0a0d 0a20  ference"))).... 
+0000c8e0: 2020 2040 7472 6565 5f63 6f6e 6469 7469     @tree_conditi
+0000c8f0: 6f6e 616c 286c 616d 6264 6120 636f 6e64  onal(lambda cond
+0000c900: 3a20 7365 6c66 2e68 6176 655f 756e 6173  : self.have_unas
+0000c910: 7369 676e 6564 5f65 6c65 6d65 6e74 7328  signed_elements(
+0000c920: 2929 0d0a 2020 2020 4074 7265 655f 6f70  ))..    @tree_op
+0000c930: 6572 6174 696f 6e28 0d0a 2020 2020 2020  eration(..      
+0000c940: 2020 5f28 2253 656c 6563 7420 756e 6173    _("Select unas
+0000c950: 7369 676e 6564 2065 6c65 6d65 6e74 7322  signed elements"
+0000c960: 292c 0d0a 2020 2020 2020 2020 6e6f 6465  ),..        node
+0000c970: 5f74 7970 653d 2262 7261 6e63 6820 6f70  _type="branch op
+0000c980: 7322 2c0d 0a20 2020 2020 2020 2068 656c  s",..        hel
+0000c990: 703d 5f28 2253 656c 6563 7420 616c 6c20  p=_("Select all 
+0000c9a0: 656c 656d 656e 7473 2074 6861 7420 776f  elements that wo
+0000c9b0: 6e27 7420 6265 2062 7572 6e65 6422 292c  n't be burned"),
+0000c9c0: 0d0a 2020 2020 290d 0a20 2020 2064 6566  ..    )..    def
+0000c9d0: 2073 656c 6563 745f 756e 6173 7369 676e   select_unassign
+0000c9e0: 6564 286e 6f64 652c 202a 2a6b 7761 7267  ed(node, **kwarg
+0000c9f0: 7329 3a0d 0a20 2020 2020 2020 2063 6861  s):..        cha
+0000ca00: 6e67 6573 203d 2046 616c 7365 0d0a 2020  nges = False..  
+0000ca10: 2020 2020 2020 666f 7220 6e6f 6465 2069        for node i
+0000ca20: 6e20 7365 6c66 2e65 6c65 6d73 2829 3a0d  n self.elems():.
+0000ca30: 0a20 2020 2020 2020 2020 2020 2065 6d70  .            emp
+0000ca40: 6861 7369 7320 3d20 626f 6f6c 286c 656e  hasis = bool(len
+0000ca50: 286e 6f64 652e 7265 6665 7265 6e63 6573  (node.references
+0000ca60: 2920 3d3d 2030 290d 0a20 2020 2020 2020  ) == 0)..       
+0000ca70: 2020 2020 2069 6620 6e6f 6465 2e65 6d70       if node.emp
+0000ca80: 6861 7369 7a65 6420 213d 2065 6d70 6861  hasized != empha
+0000ca90: 7369 7320 616e 6420 6e6f 6465 2e63 616e  sis and node.can
+0000caa0: 5f65 6d70 6861 7369 7a65 3a0d 0a20 2020  _emphasize:..   
+0000cab0: 2020 2020 2020 2020 2020 2020 2063 6861               cha
+0000cac0: 6e67 6573 203d 2054 7275 650d 0a20 2020  nges = True..   
+0000cad0: 2020 2020 2020 2020 2020 2020 206e 6f64               nod
+0000cae0: 652e 656d 7068 6173 697a 6564 203d 2065  e.emphasized = e
+0000caf0: 6d70 6861 7369 730d 0a20 2020 2020 2020  mphasis..       
+0000cb00: 2069 6620 6368 616e 6765 733a 0d0a 2020   if changes:..  
+0000cb10: 2020 2020 2020 2020 2020 7365 6c66 2e76            self.v
+0000cb20: 616c 6964 6174 655f 7365 6c65 6374 6564  alidate_selected
+0000cb30: 5f61 7265 6128 290d 0a20 2020 2020 2020  _area()..       
+0000cb40: 2020 2020 2073 656c 662e 7369 676e 616c       self.signal
+0000cb50: 2822 7265 6672 6573 685f 7363 656e 6522  ("refresh_scene"
+0000cb60: 2c20 2253 6365 6e65 2229 0d0a 0d0a 2020  , "Scene")....  
+0000cb70: 2020 6d61 7465 7269 616c 7320 3d20 5b0d    materials = [.
+0000cb80: 0a20 2020 2020 2020 205f 2822 576f 6f64  .        _("Wood
+0000cb90: 2229 2c0d 0a20 2020 2020 2020 205f 2822  "),..        _("
+0000cba0: 4163 7279 6c69 6322 292c 0d0a 2020 2020  Acrylic"),..    
+0000cbb0: 2020 2020 5f28 2246 6f61 6d22 292c 0d0a      _("Foam"),..
+0000cbc0: 2020 2020 2020 2020 5f28 224c 6561 7468          _("Leath
+0000cbd0: 6572 2229 2c0d 0a20 2020 2020 2020 205f  er"),..        _
+0000cbe0: 2822 4361 7264 626f 6172 6422 292c 0d0a  ("Cardboard"),..
+0000cbf0: 2020 2020 2020 2020 5f28 2243 6f72 6b22          _("Cork"
+0000cc00: 292c 0d0a 2020 2020 2020 2020 5f28 2254  ),..        _("T
+0000cc10: 6578 7469 6c65 7322 292c 0d0a 2020 2020  extiles"),..    
+0000cc20: 2020 2020 5f28 2250 6170 6572 2229 2c0d      _("Paper"),.
+0000cc30: 0a20 2020 2020 2020 205f 2822 5361 7665  .        _("Save
+0000cc40: 2d31 2229 2c0d 0a20 2020 2020 2020 205f  -1"),..        _
+0000cc50: 2822 5361 7665 2d32 2229 2c0d 0a20 2020  ("Save-2"),..   
+0000cc60: 2020 2020 205f 2822 5361 7665 2d33 2229       _("Save-3")
+0000cc70: 2c0d 0a20 2020 205d 0d0a 0d0a 2020 2020  ,..    ]....    
+0000cc80: 6465 6620 756e 696f 6e5f 6d61 7465 7269  def union_materi
+0000cc90: 616c 735f 7361 7665 6428 293a 0d0a 2020  als_saved():..  
+0000cca0: 2020 2020 2020 756e 696f 6e20 3d20 5b0d        union = [.
+0000ccb0: 0a20 2020 2020 2020 2020 2020 2064 0d0a  .            d..
+0000ccc0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+0000ccd0: 6420 696e 2073 656c 662e 6f70 5f64 6174  d in self.op_dat
+0000cce0: 612e 7365 6374 696f 6e5f 7365 7428 290d  a.section_set().
+0000ccf0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000cd00: 6420 6e6f 7420 696e 206d 6174 6572 6961  d not in materia
+0000cd10: 6c73 2061 6e64 2064 2021 3d20 2270 7265  ls and d != "pre
+0000cd20: 7669 6f75 7322 0d0a 2020 2020 2020 2020  vious"..        
+0000cd30: 5d0d 0a20 2020 2020 2020 2075 6e69 6f6e  ]..        union
+0000cd40: 2e65 7874 656e 6428 6d61 7465 7269 616c  .extend(material
+0000cd50: 7329 0d0a 2020 2020 2020 2020 7265 7475  s)..        retu
+0000cd60: 726e 2075 6e69 6f6e 0d0a 0d0a 2020 2020  rn union....    
+0000cd70: 6465 6620 6469 6666 6572 656e 6365 5f6d  def difference_m
+0000cd80: 6174 6572 6961 6c73 5f73 6176 6564 2829  aterials_saved()
+0000cd90: 3a0d 0a20 2020 2020 2020 2073 6563 7320  :..        secs 
+0000cda0: 3d20 7365 6c66 2e6f 705f 6461 7461 2e73  = self.op_data.s
+0000cdb0: 6563 7469 6f6e 5f73 6574 2829 0d0a 2020  ection_set()..  
+0000cdc0: 2020 2020 2020 6469 6666 6572 656e 6365        difference
+0000cdd0: 203d 205b 6d20 666f 7220 6d20 696e 206d   = [m for m in m
+0000cde0: 6174 6572 6961 6c73 2069 6620 6d20 6e6f  aterials if m no
+0000cdf0: 7420 696e 2073 6563 735d 0d0a 2020 2020  t in secs]..    
+0000ce00: 2020 2020 7265 7475 726e 2064 6966 6665      return diffe
+0000ce10: 7265 6e63 650d 0a0d 0a20 2020 2040 7472  rence....    @tr
+0000ce20: 6565 5f73 7562 6d65 6e75 285f 2822 4c6f  ee_submenu(_("Lo
+0000ce30: 6164 2229 290d 0a20 2020 2040 7472 6565  ad"))..    @tree
+0000ce40: 5f76 616c 7565 7328 226f 706e 616d 6522  _values("opname"
+0000ce50: 2c20 7661 6c75 6573 3d73 656c 662e 6f70  , values=self.op
+0000ce60: 5f64 6174 612e 7365 6374 696f 6e5f 7365  _data.section_se
+0000ce70: 7429 0d0a 2020 2020 4074 7265 655f 6f70  t)..    @tree_op
+0000ce80: 6572 6174 696f 6e28 227b 6f70 6e61 6d65  eration("{opname
+0000ce90: 7d22 2c20 6e6f 6465 5f74 7970 653d 2262  }", node_type="b
+0000cea0: 7261 6e63 6820 6f70 7322 2c20 6865 6c70  ranch ops", help
+0000ceb0: 3d22 2229 0d0a 2020 2020 6465 6620 6c6f  ="")..    def lo
+0000cec0: 6164 5f6f 7073 286e 6f64 652c 206f 706e  ad_ops(node, opn
+0000ced0: 616d 652c 202a 2a6b 7761 7267 7329 3a0d  ame, **kwargs):.
+0000cee0: 0a20 2020 2020 2020 2073 656c 6628 6622  .        self(f"
+0000cef0: 6d61 7465 7269 616c 206c 6f61 6420 7b6f  material load {o
+0000cf00: 706e 616d 657d 5c6e 2229 0d0a 0d0a 2020  pname}\n")....  
+0000cf10: 2020 4074 7265 655f 7365 7061 7261 746f    @tree_separato
+0000cf20: 725f 6265 666f 7265 2829 0d0a 2020 2020  r_before()..    
+0000cf30: 4074 7265 655f 7375 626d 656e 7528 5f28  @tree_submenu(_(
+0000cf40: 224c 6f61 6422 2929 0d0a 2020 2020 4074  "Load"))..    @t
+0000cf50: 7265 655f 6f70 6572 6174 696f 6e28 5f28  ree_operation(_(
+0000cf60: 224f 7468 6572 2f42 6c75 652f 5265 6422  "Other/Blue/Red"
+0000cf70: 292c 206e 6f64 655f 7479 7065 3d22 6272  ), node_type="br
+0000cf80: 616e 6368 206f 7073 222c 2068 656c 703d  anch ops", help=
+0000cf90: 2222 290d 0a20 2020 2064 6566 2064 6566  "")..    def def
+0000cfa0: 6175 6c74 5f63 6c61 7373 6966 6963 6174  ault_classificat
+0000cfb0: 696f 6e73 286e 6f64 652c 202a 2a6b 7761  ions(node, **kwa
+0000cfc0: 7267 7329 3a0d 0a20 2020 2020 2020 2073  rgs):..        s
+0000cfd0: 656c 662e 6c6f 6164 5f64 6566 6175 6c74  elf.load_default
+0000cfe0: 2870 6572 666f 726d 636c 6173 7369 6679  (performclassify
+0000cff0: 3d54 7275 6529 0d0a 0d0a 2020 2020 4074  =True)....    @t
+0000d000: 7265 655f 7375 626d 656e 7528 5f28 224c  ree_submenu(_("L
+0000d010: 6f61 6422 2929 0d0a 2020 2020 4074 7265  oad"))..    @tre
+0000d020: 655f 7365 7061 7261 746f 725f 6166 7465  e_separator_afte
+0000d030: 7228 290d 0a20 2020 2040 7472 6565 5f6f  r()..    @tree_o
+0000d040: 7065 7261 7469 6f6e 285f 2822 4261 7369  peration(_("Basi
+0000d050: 6322 292c 206e 6f64 655f 7479 7065 3d22  c"), node_type="
+0000d060: 6272 616e 6368 206f 7073 222c 2068 656c  branch ops", hel
+0000d070: 703d 2222 290d 0a20 2020 2064 6566 2062  p="")..    def b
+0000d080: 6173 6963 5f63 6c61 7373 6966 6963 6174  asic_classificat
+0000d090: 696f 6e73 286e 6f64 652c 202a 2a6b 7761  ions(node, **kwa
+0000d0a0: 7267 7329 3a0d 0a20 2020 2020 2020 2073  rgs):..        s
+0000d0b0: 656c 662e 6c6f 6164 5f64 6566 6175 6c74  elf.load_default
+0000d0c0: 3228 7065 7266 6f72 6d63 6c61 7373 6966  2(performclassif
+0000d0d0: 793d 5472 7565 290d 0a0d 0a20 2020 2040  y=True)....    @
+0000d0e0: 7472 6565 5f73 7562 6d65 6e75 285f 2822  tree_submenu(_("
+0000d0f0: 5361 7665 2229 290d 0a20 2020 2040 7472  Save"))..    @tr
+0000d100: 6565 5f76 616c 7565 7328 226f 706e 616d  ee_values("opnam
+0000d110: 6522 2c20 7661 6c75 6573 3d73 656c 662e  e", values=self.
+0000d120: 6f70 5f64 6174 612e 7365 6374 696f 6e5f  op_data.section_
+0000d130: 7365 7429 0d0a 2020 2020 4074 7265 655f  set)..    @tree_
+0000d140: 6f70 6572 6174 696f 6e28 227b 6f70 6e61  operation("{opna
+0000d150: 6d65 7d22 2c20 6e6f 6465 5f74 7970 653d  me}", node_type=
+0000d160: 2262 7261 6e63 6820 6f70 7322 2c20 6865  "branch ops", he
+0000d170: 6c70 3d22 2229 0d0a 2020 2020 6465 6620  lp="")..    def 
+0000d180: 7361 7665 5f6d 6174 6572 6961 6c73 286e  save_materials(n
+0000d190: 6f64 652c 206f 706e 616d 653d 2273 6176  ode, opname="sav
+0000d1a0: 6564 222c 202a 2a6b 7761 7267 7329 3a0d  ed", **kwargs):.
+0000d1b0: 0a20 2020 2020 2020 2073 656c 6628 6622  .        self(f"
+0000d1c0: 6d61 7465 7269 616c 2073 6176 6520 7b6f  material save {o
+0000d1d0: 706e 616d 657d 5c6e 2229 0d0a 0d0a 2020  pname}\n")....  
+0000d1e0: 2020 4074 7265 655f 7365 7061 7261 746f    @tree_separato
+0000d1f0: 725f 6265 666f 7265 2829 0d0a 2020 2020  r_before()..    
+0000d200: 4074 7265 655f 7375 626d 656e 7528 5f28  @tree_submenu(_(
+0000d210: 2253 6176 6522 2929 0d0a 2020 2020 4074  "Save"))..    @t
+0000d220: 7265 655f 7072 6f6d 7074 2822 6f70 6e61  ree_prompt("opna
+0000d230: 6d65 222c 205f 2822 4e61 6d65 2074 6f20  me", _("Name to 
+0000d240: 7374 6f72 6520 6375 7272 656e 7420 6f70  store current op
+0000d250: 6572 6174 696f 6e73 2075 6e64 6572 3f22  erations under?"
+0000d260: 2929 0d0a 2020 2020 4074 7265 655f 6f70  ))..    @tree_op
+0000d270: 6572 6174 696f 6e28 5f28 224e 6577 2229  eration(_("New")
+0000d280: 2c20 6e6f 6465 5f74 7970 653d 2262 7261  , node_type="bra
+0000d290: 6e63 6820 6f70 7322 2c20 6865 6c70 3d22  nch ops", help="
+0000d2a0: 2229 0d0a 2020 2020 6465 6620 7361 7665  ")..    def save
+0000d2b0: 5f6d 6174 6572 6961 6c5f 6375 7374 6f6d  _material_custom
+0000d2c0: 286e 6f64 652c 206f 706e 616d 652c 202a  (node, opname, *
+0000d2d0: 2a6b 7761 7267 7329 3a0d 0a20 2020 2020  *kwargs):..     
+0000d2e0: 2020 2073 656c 6628 6622 6d61 7465 7269     self(f"materi
+0000d2f0: 616c 2073 6176 6520 7b6f 706e 616d 652e  al save {opname.
+0000d300: 7265 706c 6163 6528 2720 272c 2027 5f27  replace(' ', '_'
+0000d310: 297d 5c6e 2229 0d0a 0d0a 2020 2020 4074  )}\n")....    @t
+0000d320: 7265 655f 7375 626d 656e 7528 5f28 2244  ree_submenu(_("D
+0000d330: 656c 6574 6522 2929 0d0a 2020 2020 4074  elete"))..    @t
+0000d340: 7265 655f 7661 6c75 6573 2822 6f70 6e61  ree_values("opna
+0000d350: 6d65 222c 2076 616c 7565 733d 7365 6c66  me", values=self
+0000d360: 2e6f 705f 6461 7461 2e73 6563 7469 6f6e  .op_data.section
+0000d370: 5f73 6574 290d 0a20 2020 2040 7472 6565  _set)..    @tree
+0000d380: 5f6f 7065 7261 7469 6f6e 2822 7b6f 706e  _operation("{opn
+0000d390: 616d 657d 222c 206e 6f64 655f 7479 7065  ame}", node_type
+0000d3a0: 3d22 6272 616e 6368 206f 7073 222c 2068  ="branch ops", h
+0000d3b0: 656c 703d 2222 290d 0a20 2020 2064 6566  elp="")..    def
+0000d3c0: 2072 656d 6f76 655f 6f70 7328 6e6f 6465   remove_ops(node
+0000d3d0: 2c20 6f70 6e61 6d65 3d22 7361 7665 6422  , opname="saved"
+0000d3e0: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
+0000d3f0: 2020 2020 2020 7365 6c66 2866 226d 6174        self(f"mat
+0000d400: 6572 6961 6c20 6465 6c65 7465 207b 6f70  erial delete {op
+0000d410: 6e61 6d65 7d5c 6e22 290d 0a0d 0a20 2020  name}\n")....   
+0000d420: 2040 7472 6565 5f73 6570 6172 6174 6f72   @tree_separator
+0000d430: 5f62 6566 6f72 6528 290d 0a20 2020 2040  _before()..    @
+0000d440: 7472 6565 5f73 7562 6d65 6e75 285f 2822  tree_submenu(_("
+0000d450: 4170 7065 6e64 206f 7065 7261 7469 6f6e  Append operation
+0000d460: 2229 290d 0a20 2020 2040 7472 6565 5f6f  "))..    @tree_o
+0000d470: 7065 7261 7469 6f6e 285f 2822 4170 7065  peration(_("Appe
+0000d480: 6e64 2049 6d61 6765 2229 2c20 6e6f 6465  nd Image"), node
+0000d490: 5f74 7970 653d 2262 7261 6e63 6820 6f70  _type="branch op
+0000d4a0: 7322 2c20 6865 6c70 3d22 2229 0d0a 2020  s", help="")..  
+0000d4b0: 2020 6465 6620 6170 7065 6e64 5f6f 7065    def append_ope
+0000d4c0: 7261 7469 6f6e 5f69 6d61 6765 286e 6f64  ration_image(nod
+0000d4d0: 652c 2070 6f73 3d4e 6f6e 652c 202a 2a6b  e, pos=None, **k
+0000d4e0: 7761 7267 7329 3a0d 0a20 2020 2020 2020  wargs):..       
+0000d4f0: 2073 656c 662e 6f70 5f62 7261 6e63 682e   self.op_branch.
+0000d500: 6164 6428 226f 7020 696d 6167 6522 2c20  add("op image", 
+0000d510: 706f 733d 706f 7329 0d0a 2020 2020 2020  pos=pos)..      
+0000d520: 2020 7365 6c66 2e73 6967 6e61 6c28 2275    self.signal("u
+0000d530: 7064 6174 656f 705f 7472 6565 2229 0d0a  pdateop_tree")..
+0000d540: 0d0a 2020 2020 4074 7265 655f 7375 626d  ..    @tree_subm
+0000d550: 656e 7528 5f28 2241 7070 656e 6420 6f70  enu(_("Append op
+0000d560: 6572 6174 696f 6e22 2929 0d0a 2020 2020  eration"))..    
+0000d570: 4074 7265 655f 6f70 6572 6174 696f 6e28  @tree_operation(
+0000d580: 5f28 2241 7070 656e 6420 5261 7374 6572  _("Append Raster
+0000d590: 2229 2c20 6e6f 6465 5f74 7970 653d 2262  "), node_type="b
+0000d5a0: 7261 6e63 6820 6f70 7322 2c20 6865 6c70  ranch ops", help
+0000d5b0: 3d22 2229 0d0a 2020 2020 6465 6620 6170  ="")..    def ap
+0000d5c0: 7065 6e64 5f6f 7065 7261 7469 6f6e 5f72  pend_operation_r
+0000d5d0: 6173 7465 7228 6e6f 6465 2c20 706f 733d  aster(node, pos=
+0000d5e0: 4e6f 6e65 2c20 2a2a 6b77 6172 6773 293a  None, **kwargs):
+0000d5f0: 0d0a 2020 2020 2020 2020 7365 6c66 2e6f  ..        self.o
+0000d600: 705f 6272 616e 6368 2e61 6464 2822 6f70  p_branch.add("op
+0000d610: 2072 6173 7465 7222 2c20 706f 733d 706f   raster", pos=po
+0000d620: 7329 0d0a 2020 2020 2020 2020 7365 6c66  s)..        self
+0000d630: 2e73 6967 6e61 6c28 2275 7064 6174 656f  .signal("updateo
+0000d640: 705f 7472 6565 2229 0d0a 0d0a 2020 2020  p_tree")....    
+0000d650: 4074 7265 655f 7375 626d 656e 7528 5f28  @tree_submenu(_(
+0000d660: 2241 7070 656e 6420 6f70 6572 6174 696f  "Append operatio
+0000d670: 6e22 2929 0d0a 2020 2020 4074 7265 655f  n"))..    @tree_
+0000d680: 6f70 6572 6174 696f 6e28 5f28 2241 7070  operation(_("App
+0000d690: 656e 6420 456e 6772 6176 6522 292c 206e  end Engrave"), n
+0000d6a0: 6f64 655f 7479 7065 3d22 6272 616e 6368  ode_type="branch
+0000d6b0: 206f 7073 222c 2068 656c 703d 2222 290d   ops", help="").
+0000d6c0: 0a20 2020 2064 6566 2061 7070 656e 645f  .    def append_
+0000d6d0: 6f70 6572 6174 696f 6e5f 656e 6772 6176  operation_engrav
+0000d6e0: 6528 6e6f 6465 2c20 706f 733d 4e6f 6e65  e(node, pos=None
+0000d6f0: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
+0000d700: 2020 2020 2020 7365 6c66 2e6f 705f 6272        self.op_br
+0000d710: 616e 6368 2e61 6464 2822 6f70 2065 6e67  anch.add("op eng
+0000d720: 7261 7665 222c 2070 6f73 3d70 6f73 290d  rave", pos=pos).
+0000d730: 0a20 2020 2020 2020 2073 656c 662e 7369  .        self.si
+0000d740: 676e 616c 2822 7570 6461 7465 6f70 5f74  gnal("updateop_t
+0000d750: 7265 6522 290d 0a0d 0a20 2020 2040 7472  ree")....    @tr
+0000d760: 6565 5f73 7562 6d65 6e75 285f 2822 4170  ee_submenu(_("Ap
+0000d770: 7065 6e64 206f 7065 7261 7469 6f6e 2229  pend operation")
+0000d780: 290d 0a20 2020 2040 7472 6565 5f6f 7065  )..    @tree_ope
+0000d790: 7261 7469 6f6e 285f 2822 4170 7065 6e64  ration(_("Append
+0000d7a0: 2043 7574 2229 2c20 6e6f 6465 5f74 7970   Cut"), node_typ
+0000d7b0: 653d 2262 7261 6e63 6820 6f70 7322 2c20  e="branch ops", 
+0000d7c0: 6865 6c70 3d22 2229 0d0a 2020 2020 6465  help="")..    de
+0000d7d0: 6620 6170 7065 6e64 5f6f 7065 7261 7469  f append_operati
+0000d7e0: 6f6e 5f63 7574 286e 6f64 652c 2070 6f73  on_cut(node, pos
+0000d7f0: 3d4e 6f6e 652c 202a 2a6b 7761 7267 7329  =None, **kwargs)
+0000d800: 3a0d 0a20 2020 2020 2020 2073 656c 662e  :..        self.
+0000d810: 6f70 5f62 7261 6e63 682e 6164 6428 226f  op_branch.add("o
+0000d820: 7020 6375 7422 2c20 706f 733d 706f 7329  p cut", pos=pos)
+0000d830: 0d0a 2020 2020 2020 2020 7365 6c66 2e73  ..        self.s
+0000d840: 6967 6e61 6c28 2275 7064 6174 656f 705f  ignal("updateop_
+0000d850: 7472 6565 2229 0d0a 0d0a 2020 2020 4074  tree")....    @t
+0000d860: 7265 655f 7375 626d 656e 7528 5f28 2241  ree_submenu(_("A
+0000d870: 7070 656e 6420 6f70 6572 6174 696f 6e22  ppend operation"
+0000d880: 2929 0d0a 2020 2020 4074 7265 655f 6f70  ))..    @tree_op
+0000d890: 6572 6174 696f 6e28 5f28 2241 7070 656e  eration(_("Appen
+0000d8a0: 6420 4861 7463 6822 292c 206e 6f64 655f  d Hatch"), node_
+0000d8b0: 7479 7065 3d22 6272 616e 6368 206f 7073  type="branch ops
+0000d8c0: 222c 2068 656c 703d 2222 290d 0a20 2020  ", help="")..   
+0000d8d0: 2064 6566 2061 7070 656e 645f 6f70 6572   def append_oper
+0000d8e0: 6174 696f 6e5f 6861 7463 6828 6e6f 6465  ation_hatch(node
+0000d8f0: 2c20 706f 733d 4e6f 6e65 2c20 2a2a 6b77  , pos=None, **kw
+0000d900: 6172 6773 293a 0d0a 2020 2020 2020 2020  args):..        
+0000d910: 7365 6c66 2e6f 705f 6272 616e 6368 2e61  self.op_branch.a
+0000d920: 6464 2822 6f70 2068 6174 6368 222c 2070  dd("op hatch", p
+0000d930: 6f73 3d70 6f73 290d 0a20 2020 2020 2020  os=pos)..       
+0000d940: 2073 656c 662e 7369 676e 616c 2822 7570   self.signal("up
+0000d950: 6461 7465 6f70 5f74 7265 6522 290d 0a0d  dateop_tree")...
+0000d960: 0a20 2020 2040 7472 6565 5f73 7562 6d65  .    @tree_subme
+0000d970: 6e75 285f 2822 4170 7065 6e64 206f 7065  nu(_("Append ope
+0000d980: 7261 7469 6f6e 2229 290d 0a20 2020 2040  ration"))..    @
+0000d990: 7472 6565 5f6f 7065 7261 7469 6f6e 285f  tree_operation(_
+0000d9a0: 2822 4170 7065 6e64 2044 6f74 7322 292c  ("Append Dots"),
+0000d9b0: 206e 6f64 655f 7479 7065 3d22 6272 616e   node_type="bran
+0000d9c0: 6368 206f 7073 222c 2068 656c 703d 2222  ch ops", help=""
+0000d9d0: 290d 0a20 2020 2064 6566 2061 7070 656e  )..    def appen
+0000d9e0: 645f 6f70 6572 6174 696f 6e5f 646f 7473  d_operation_dots
+0000d9f0: 286e 6f64 652c 2070 6f73 3d4e 6f6e 652c  (node, pos=None,
+0000da00: 202a 2a6b 7761 7267 7329 3a0d 0a20 2020   **kwargs):..   
+0000da10: 2020 2020 2073 656c 662e 6f70 5f62 7261       self.op_bra
+0000da20: 6e63 682e 6164 6428 226f 7020 646f 7473  nch.add("op dots
+0000da30: 222c 2070 6f73 3d70 6f73 290d 0a20 2020  ", pos=pos)..   
+0000da40: 2020 2020 2073 656c 662e 7369 676e 616c       self.signal
+0000da50: 2822 7570 6461 7465 6f70 5f74 7265 6522  ("updateop_tree"
+0000da60: 290d 0a0d 0a20 2020 2040 7472 6565 5f73  )....    @tree_s
+0000da70: 7562 6d65 6e75 285f 2822 4170 7065 6e64  ubmenu(_("Append
+0000da80: 2073 7065 6369 616c 206f 7065 7261 7469   special operati
+0000da90: 6f6e 2873 2922 2929 0d0a 2020 2020 4074  on(s)"))..    @t
+0000daa0: 7265 655f 6f70 6572 6174 696f 6e28 5f28  ree_operation(_(
+0000dab0: 2241 7070 656e 6420 486f 6d65 2229 2c20  "Append Home"), 
+0000dac0: 6e6f 6465 5f74 7970 653d 2262 7261 6e63  node_type="branc
+0000dad0: 6820 6f70 7322 2c20 6865 6c70 3d22 2229  h ops", help="")
+0000dae0: 0d0a 2020 2020 6465 6620 6170 7065 6e64  ..    def append
+0000daf0: 5f6f 7065 7261 7469 6f6e 5f68 6f6d 6528  _operation_home(
+0000db00: 6e6f 6465 2c20 706f 733d 4e6f 6e65 2c20  node, pos=None, 
+0000db10: 2a2a 6b77 6172 6773 293a 0d0a 2020 2020  **kwargs):..    
+0000db20: 2020 2020 7365 6c66 2e6f 705f 6272 616e      self.op_bran
+0000db30: 6368 2e61 6464 2874 7970 653d 2275 7469  ch.add(type="uti
+0000db40: 6c20 686f 6d65 222c 2070 6f73 3d70 6f73  l home", pos=pos
+0000db50: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+0000db60: 7369 676e 616c 2822 7570 6461 7465 6f70  signal("updateop
+0000db70: 5f74 7265 6522 290d 0a0d 0a20 2020 2040  _tree")....    @
+0000db80: 7472 6565 5f73 7562 6d65 6e75 285f 2822  tree_submenu(_("
+0000db90: 4170 7065 6e64 2073 7065 6369 616c 206f  Append special o
+0000dba0: 7065 7261 7469 6f6e 2873 2922 2929 0d0a  peration(s)"))..
+0000dbb0: 2020 2020 4074 7265 655f 6f70 6572 6174      @tree_operat
+0000dbc0: 696f 6e28 5f28 2241 7070 656e 6420 5265  ion(_("Append Re
+0000dbd0: 7475 726e 2074 6f20 4f72 6967 696e 2229  turn to Origin")
+0000dbe0: 2c20 6e6f 6465 5f74 7970 653d 2262 7261  , node_type="bra
+0000dbf0: 6e63 6820 6f70 7322 2c20 6865 6c70 3d22  nch ops", help="
+0000dc00: 2229 0d0a 2020 2020 6465 6620 6170 7065  ")..    def appe
+0000dc10: 6e64 5f6f 7065 7261 7469 6f6e 5f67 6f74  nd_operation_got
+0000dc20: 6f28 6e6f 6465 2c20 706f 733d 4e6f 6e65  o(node, pos=None
+0000dc30: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
+0000dc40: 2020 2020 2020 7365 6c66 2e6f 705f 6272        self.op_br
+0000dc50: 616e 6368 2e61 6464 2874 7970 653d 2275  anch.add(type="u
+0000dc60: 7469 6c20 676f 746f 222c 2070 6f73 3d70  til goto", pos=p
+0000dc70: 6f73 2c20 783d 302c 2079 3d30 290d 0a20  os, x=0, y=0).. 
+0000dc80: 2020 2020 2020 2073 656c 662e 7369 676e         self.sign
+0000dc90: 616c 2822 7570 6461 7465 6f70 5f74 7265  al("updateop_tre
+0000dca0: 6522 290d 0a0d 0a20 2020 2040 7472 6565  e")....    @tree
+0000dcb0: 5f73 7562 6d65 6e75 285f 2822 4170 7065  _submenu(_("Appe
+0000dcc0: 6e64 2073 7065 6369 616c 206f 7065 7261  nd special opera
+0000dcd0: 7469 6f6e 2873 2922 2929 0d0a 2020 2020  tion(s)"))..    
+0000dce0: 4074 7265 655f 6f70 6572 6174 696f 6e28  @tree_operation(
+0000dcf0: 0d0a 2020 2020 2020 2020 5f28 2241 7070  ..        _("App
+0000dd00: 656e 6420 5365 7420 4f72 6967 696e 2229  end Set Origin")
+0000dd10: 2c0d 0a20 2020 2020 2020 206e 6f64 655f  ,..        node_
+0000dd20: 7479 7065 3d22 6272 616e 6368 206f 7073  type="branch ops
+0000dd30: 222c 0d0a 2020 2020 2020 2020 6865 6c70  ",..        help
+0000dd40: 3d22 222c 0d0a 2020 2020 290d 0a20 2020  ="",..    )..   
+0000dd50: 2064 6566 2061 7070 656e 645f 6f70 6572   def append_oper
+0000dd60: 6174 696f 6e5f 7365 746f 7269 6769 6e28  ation_setorigin(
+0000dd70: 6e6f 6465 2c20 706f 733d 4e6f 6e65 2c20  node, pos=None, 
+0000dd80: 2a2a 6b77 6172 6773 293a 0d0a 2020 2020  **kwargs):..    
+0000dd90: 2020 2020 7365 6c66 2e6f 705f 6272 616e      self.op_bran
+0000dda0: 6368 2e61 6464 280d 0a20 2020 2020 2020  ch.add(..       
+0000ddb0: 2020 2020 2074 7970 653d 2275 7469 6c20       type="util 
+0000ddc0: 6f72 6967 696e 222c 0d0a 2020 2020 2020  origin",..      
+0000ddd0: 2020 2020 2020 706f 733d 706f 732c 0d0a        pos=pos,..
+0000dde0: 2020 2020 2020 2020 2020 2020 783d 4e6f              x=No
+0000ddf0: 6e65 2c0d 0a20 2020 2020 2020 2020 2020  ne,..           
+0000de00: 2079 3d4e 6f6e 652c 0d0a 2020 2020 2020   y=None,..      
+0000de10: 2020 290d 0a20 2020 2020 2020 2073 656c    )..        sel
+0000de20: 662e 7369 676e 616c 2822 7570 6461 7465  f.signal("update
+0000de30: 6f70 5f74 7265 6522 290d 0a0d 0a20 2020  op_tree")....   
+0000de40: 2040 7472 6565 5f73 7562 6d65 6e75 285f   @tree_submenu(_
+0000de50: 2822 4170 7065 6e64 2073 7065 6369 616c  ("Append special
+0000de60: 206f 7065 7261 7469 6f6e 2873 2922 2929   operation(s)"))
+0000de70: 0d0a 2020 2020 4074 7265 655f 6f70 6572  ..    @tree_oper
+0000de80: 6174 696f 6e28 5f28 2241 7070 656e 6420  ation(_("Append 
+0000de90: 4265 6570 2229 2c20 6e6f 6465 5f74 7970  Beep"), node_typ
+0000dea0: 653d 2262 7261 6e63 6820 6f70 7322 2c20  e="branch ops", 
+0000deb0: 6865 6c70 3d22 2229 0d0a 2020 2020 6465  help="")..    de
+0000dec0: 6620 6170 7065 6e64 5f6f 7065 7261 7469  f append_operati
+0000ded0: 6f6e 5f62 6565 7028 6e6f 6465 2c20 706f  on_beep(node, po
+0000dee0: 733d 4e6f 6e65 2c20 2a2a 6b77 6172 6773  s=None, **kwargs
+0000def0: 293a 0d0a 2020 2020 2020 2020 7365 6c66  ):..        self
+0000df00: 2e6f 705f 6272 616e 6368 2e61 6464 280d  .op_branch.add(.
+0000df10: 0a20 2020 2020 2020 2020 2020 2074 7970  .            typ
+0000df20: 653d 2275 7469 6c20 636f 6e73 6f6c 6522  e="util console"
+0000df30: 2c0d 0a20 2020 2020 2020 2020 2020 2070  ,..            p
+0000df40: 6f73 3d70 6f73 2c0d 0a20 2020 2020 2020  os=pos,..       
+0000df50: 2020 2020 2063 6f6d 6d61 6e64 3d22 6265       command="be
+0000df60: 6570 222c 0d0a 2020 2020 2020 2020 290d  ep",..        ).
+0000df70: 0a20 2020 2020 2020 2073 656c 662e 7369  .        self.si
+0000df80: 676e 616c 2822 7570 6461 7465 6f70 5f74  gnal("updateop_t
+0000df90: 7265 6522 290d 0a0d 0a20 2020 2040 7472  ree")....    @tr
+0000dfa0: 6565 5f73 7562 6d65 6e75 285f 2822 4170  ee_submenu(_("Ap
+0000dfb0: 7065 6e64 2073 7065 6369 616c 206f 7065  pend special ope
+0000dfc0: 7261 7469 6f6e 2873 2922 2929 0d0a 2020  ration(s)"))..  
+0000dfd0: 2020 4074 7265 655f 6f70 6572 6174 696f    @tree_operatio
+0000dfe0: 6e28 5f28 2241 7070 656e 6420 496e 7465  n(_("Append Inte
+0000dff0: 7272 7570 7422 292c 206e 6f64 655f 7479  rrupt"), node_ty
+0000e000: 7065 3d22 6272 616e 6368 206f 7073 222c  pe="branch ops",
+0000e010: 2068 656c 703d 2222 290d 0a20 2020 2064   help="")..    d
+0000e020: 6566 2061 7070 656e 645f 6f70 6572 6174  ef append_operat
+0000e030: 696f 6e5f 696e 7465 7272 7570 7428 6e6f  ion_interrupt(no
+0000e040: 6465 2c20 706f 733d 4e6f 6e65 2c20 2a2a  de, pos=None, **
+0000e050: 6b77 6172 6773 293a 0d0a 2020 2020 2020  kwargs):..      
+0000e060: 2020 7365 6c66 2e6f 705f 6272 616e 6368    self.op_branch
+0000e070: 2e61 6464 280d 0a20 2020 2020 2020 2020  .add(..         
+0000e080: 2020 2074 7970 653d 2275 7469 6c20 636f     type="util co
+0000e090: 6e73 6f6c 6522 2c0d 0a20 2020 2020 2020  nsole",..       
+0000e0a0: 2020 2020 2070 6f73 3d70 6f73 2c0d 0a20       pos=pos,.. 
+0000e0b0: 2020 2020 2020 2020 2020 2063 6f6d 6d61             comma
+0000e0c0: 6e64 3d27 696e 7465 7272 7570 7420 2253  nd='interrupt "S
+0000e0d0: 706f 6f6c 696e 6720 7761 7320 696e 7465  pooling was inte
+0000e0e0: 7272 7570 7465 6422 272c 0d0a 2020 2020  rrupted"',..    
+0000e0f0: 2020 2020 290d 0a20 2020 2020 2020 2073      )..        s
+0000e100: 656c 662e 7369 676e 616c 2822 7570 6461  elf.signal("upda
+0000e110: 7465 6f70 5f74 7265 6522 290d 0a0d 0a20  teop_tree").... 
+0000e120: 2020 2040 7472 6565 5f73 7562 6d65 6e75     @tree_submenu
+0000e130: 285f 2822 4170 7065 6e64 2073 7065 6369  (_("Append speci
+0000e140: 616c 206f 7065 7261 7469 6f6e 2873 2922  al operation(s)"
+0000e150: 2929 0d0a 2020 2020 4074 7265 655f 7072  ))..    @tree_pr
+0000e160: 6f6d 7074 2822 7761 6974 5f74 696d 6522  ompt("wait_time"
+0000e170: 2c20 5f28 2257 6169 7420 666f 7220 686f  , _("Wait for ho
+0000e180: 7720 6c6f 6e67 2028 696e 2073 6563 6f6e  w long (in secon
+0000e190: 6473 293f 2229 2c20 6461 7461 5f74 7970  ds)?"), data_typ
+0000e1a0: 653d 666c 6f61 7429 0d0a 2020 2020 4074  e=float)..    @t
+0000e1b0: 7265 655f 6f70 6572 6174 696f 6e28 5f28  ree_operation(_(
+0000e1c0: 2241 7070 656e 6420 5761 6974 2229 2c20  "Append Wait"), 
+0000e1d0: 6e6f 6465 5f74 7970 653d 2262 7261 6e63  node_type="branc
+0000e1e0: 6820 6f70 7322 2c20 6865 6c70 3d22 2229  h ops", help="")
+0000e1f0: 0d0a 2020 2020 6465 6620 6170 7065 6e64  ..    def append
+0000e200: 5f6f 7065 7261 7469 6f6e 5f77 6169 7428  _operation_wait(
+0000e210: 6e6f 6465 2c20 7761 6974 5f74 696d 652c  node, wait_time,
+0000e220: 2070 6f73 3d4e 6f6e 652c 202a 2a6b 7761   pos=None, **kwa
+0000e230: 7267 7329 3a0d 0a20 2020 2020 2020 2073  rgs):..        s
+0000e240: 656c 662e 6f70 5f62 7261 6e63 682e 6164  elf.op_branch.ad
+0000e250: 6428 0d0a 2020 2020 2020 2020 2020 2020  d(..            
+0000e260: 7479 7065 3d22 7574 696c 2077 6169 7422  type="util wait"
+0000e270: 2c0d 0a20 2020 2020 2020 2020 2020 2070  ,..            p
+0000e280: 6f73 3d70 6f73 2c0d 0a20 2020 2020 2020  os=pos,..       
+0000e290: 2020 2020 2077 6169 743d 7761 6974 5f74       wait=wait_t
+0000e2a0: 696d 652c 0d0a 2020 2020 2020 2020 290d  ime,..        ).
+0000e2b0: 0a20 2020 2020 2020 2073 656c 662e 7369  .        self.si
+0000e2c0: 676e 616c 2822 7570 6461 7465 6f70 5f74  gnal("updateop_t
+0000e2d0: 7265 6522 290d 0a0d 0a20 2020 2040 7472  ree")....    @tr
+0000e2e0: 6565 5f73 7562 6d65 6e75 285f 2822 4170  ee_submenu(_("Ap
+0000e2f0: 7065 6e64 2073 7065 6369 616c 206f 7065  pend special ope
+0000e300: 7261 7469 6f6e 2873 2922 2929 0d0a 2020  ration(s)"))..  
+0000e310: 2020 4074 7265 655f 6f70 6572 6174 696f    @tree_operatio
+0000e320: 6e28 5f28 2241 7070 656e 6420 4f75 7470  n(_("Append Outp
+0000e330: 7574 2229 2c20 6e6f 6465 5f74 7970 653d  ut"), node_type=
+0000e340: 2262 7261 6e63 6820 6f70 7322 2c20 6865  "branch ops", he
+0000e350: 6c70 3d22 2229 0d0a 2020 2020 6465 6620  lp="")..    def 
+0000e360: 6170 7065 6e64 5f6f 7065 7261 7469 6f6e  append_operation
+0000e370: 5f6f 7574 7075 7428 6e6f 6465 2c20 706f  _output(node, po
+0000e380: 733d 4e6f 6e65 2c20 2a2a 6b77 6172 6773  s=None, **kwargs
+0000e390: 293a 0d0a 2020 2020 2020 2020 7365 6c66  ):..        self
+0000e3a0: 2e6f 705f 6272 616e 6368 2e61 6464 280d  .op_branch.add(.
+0000e3b0: 0a20 2020 2020 2020 2020 2020 2074 7970  .            typ
+0000e3c0: 653d 2275 7469 6c20 6f75 7470 7574 222c  e="util output",
+0000e3d0: 0d0a 2020 2020 2020 2020 2020 2020 706f  ..            po
+0000e3e0: 733d 706f 732c 0d0a 2020 2020 2020 2020  s=pos,..        
+0000e3f0: 2020 2020 6f75 7470 7574 5f6d 6173 6b3d      output_mask=
+0000e400: 302c 0d0a 2020 2020 2020 2020 2020 2020  0,..            
+0000e410: 6f75 7470 7574 5f76 616c 7565 3d30 2c0d  output_value=0,.
+0000e420: 0a20 2020 2020 2020 2020 2020 206f 7574  .            out
+0000e430: 7075 745f 6d65 7373 6167 653d 4e6f 6e65  put_message=None
+0000e440: 2c0d 0a20 2020 2020 2020 2029 0d0a 2020  ,..        )..  
+0000e450: 2020 2020 2020 7365 6c66 2e73 6967 6e61        self.signa
+0000e460: 6c28 2275 7064 6174 656f 705f 7472 6565  l("updateop_tree
+0000e470: 2229 0d0a 0d0a 2020 2020 4074 7265 655f  ")....    @tree_
+0000e480: 7375 626d 656e 7528 5f28 2241 7070 656e  submenu(_("Appen
+0000e490: 6420 7370 6563 6961 6c20 6f70 6572 6174  d special operat
+0000e4a0: 696f 6e28 7329 2229 290d 0a20 2020 2040  ion(s)"))..    @
+0000e4b0: 7472 6565 5f6f 7065 7261 7469 6f6e 285f  tree_operation(_
+0000e4c0: 2822 4170 7065 6e64 2049 6e70 7574 2229  ("Append Input")
+0000e4d0: 2c20 6e6f 6465 5f74 7970 653d 2262 7261  , node_type="bra
+0000e4e0: 6e63 6820 6f70 7322 2c20 6865 6c70 3d22  nch ops", help="
+0000e4f0: 2229 0d0a 2020 2020 6465 6620 6170 7065  ")..    def appe
+0000e500: 6e64 5f6f 7065 7261 7469 6f6e 5f69 6e70  nd_operation_inp
+0000e510: 7574 286e 6f64 652c 2070 6f73 3d4e 6f6e  ut(node, pos=Non
+0000e520: 652c 202a 2a6b 7761 7267 7329 3a0d 0a20  e, **kwargs):.. 
+0000e530: 2020 2020 2020 2073 656c 662e 6f70 5f62         self.op_b
+0000e540: 7261 6e63 682e 6164 6428 0d0a 2020 2020  ranch.add(..    
+0000e550: 2020 2020 2020 2020 7479 7065 3d22 7574          type="ut
+0000e560: 696c 2069 6e70 7574 222c 0d0a 2020 2020  il input",..    
+0000e570: 2020 2020 2020 2020 706f 733d 706f 732c          pos=pos,
+0000e580: 0d0a 2020 2020 2020 2020 2020 2020 696e  ..            in
+0000e590: 7075 745f 6d61 736b 3d30 2c0d 0a20 2020  put_mask=0,..   
+0000e5a0: 2020 2020 2020 2020 2069 6e70 7574 5f76           input_v
+0000e5b0: 616c 7565 3d30 2c0d 0a20 2020 2020 2020  alue=0,..       
+0000e5c0: 2020 2020 2069 6e70 7574 5f6d 6573 7361       input_messa
+0000e5d0: 6765 3d4e 6f6e 652c 0d0a 2020 2020 2020  ge=None,..      
+0000e5e0: 2020 290d 0a20 2020 2020 2020 2073 656c    )..        sel
+0000e5f0: 662e 7369 676e 616c 2822 7570 6461 7465  f.signal("update
+0000e600: 6f70 5f74 7265 6522 290d 0a0d 0a20 2020  op_tree")....   
+0000e610: 2040 7472 6565 5f73 7562 6d65 6e75 285f   @tree_submenu(_
+0000e620: 2822 4170 7065 6e64 2073 7065 6369 616c  ("Append special
+0000e630: 206f 7065 7261 7469 6f6e 2873 2922 2929   operation(s)"))
+0000e640: 0d0a 2020 2020 4074 7265 655f 6f70 6572  ..    @tree_oper
+0000e650: 6174 696f 6e28 5f28 2241 7070 656e 6420  ation(_("Append 
+0000e660: 486f 6d65 2f42 6565 702f 496e 7465 7272  Home/Beep/Interr
+0000e670: 7570 7422 292c 206e 6f64 655f 7479 7065  upt"), node_type
+0000e680: 3d22 6272 616e 6368 206f 7073 222c 2068  ="branch ops", h
+0000e690: 656c 703d 2222 290d 0a20 2020 2064 6566  elp="")..    def
+0000e6a0: 2061 7070 656e 645f 6f70 6572 6174 696f   append_operatio
+0000e6b0: 6e5f 686f 6d65 5f62 6565 705f 696e 7465  n_home_beep_inte
+0000e6c0: 7272 7570 7428 6e6f 6465 2c20 2a2a 6b77  rrupt(node, **kw
+0000e6d0: 6172 6773 293a 0d0a 2020 2020 2020 2020  args):..        
+0000e6e0: 6170 7065 6e64 5f6f 7065 7261 7469 6f6e  append_operation
+0000e6f0: 5f68 6f6d 6528 6e6f 6465 2c20 2a2a 6b77  _home(node, **kw
+0000e700: 6172 6773 290d 0a20 2020 2020 2020 2061  args)..        a
+0000e710: 7070 656e 645f 6f70 6572 6174 696f 6e5f  ppend_operation_
+0000e720: 6265 6570 286e 6f64 652c 202a 2a6b 7761  beep(node, **kwa
+0000e730: 7267 7329 0d0a 2020 2020 2020 2020 6170  rgs)..        ap
+0000e740: 7065 6e64 5f6f 7065 7261 7469 6f6e 5f69  pend_operation_i
+0000e750: 6e74 6572 7275 7074 286e 6f64 652c 202a  nterrupt(node, *
+0000e760: 2a6b 7761 7267 7329 0d0a 2020 2020 2020  *kwargs)..      
+0000e770: 2020 7365 6c66 2e73 6967 6e61 6c28 2275    self.signal("u
+0000e780: 7064 6174 656f 705f 7472 6565 2229 0d0a  pdateop_tree")..
+0000e790: 0d0a 2020 2020 4074 7265 655f 7375 626d  ..    @tree_subm
+0000e7a0: 656e 7528 5f28 2241 7070 656e 6420 7370  enu(_("Append sp
+0000e7b0: 6563 6961 6c20 6f70 6572 6174 696f 6e28  ecial operation(
+0000e7c0: 7329 2229 290d 0a20 2020 2040 7472 6565  s)"))..    @tree
+0000e7d0: 5f6f 7065 7261 7469 6f6e 285f 2822 4170  _operation(_("Ap
+0000e7e0: 7065 6e64 204f 7269 6769 6e2f 4265 6570  pend Origin/Beep
+0000e7f0: 2f49 6e74 6572 7275 7074 2229 2c20 6e6f  /Interrupt"), no
+0000e800: 6465 5f74 7970 653d 2262 7261 6e63 6820  de_type="branch 
+0000e810: 6f70 7322 2c20 6865 6c70 3d22 2229 0d0a  ops", help="")..
+0000e820: 2020 2020 6465 6620 6170 7065 6e64 5f6f      def append_o
+0000e830: 7065 7261 7469 6f6e 5f6f 7269 6769 6e5f  peration_origin_
+0000e840: 6265 6570 5f69 6e74 6572 7275 7074 286e  beep_interrupt(n
+0000e850: 6f64 652c 202a 2a6b 7761 7267 7329 3a0d  ode, **kwargs):.
+0000e860: 0a20 2020 2020 2020 2061 7070 656e 645f  .        append_
+0000e870: 6f70 6572 6174 696f 6e5f 676f 746f 286e  operation_goto(n
+0000e880: 6f64 652c 202a 2a6b 7761 7267 7329 0d0a  ode, **kwargs)..
+0000e890: 2020 2020 2020 2020 6170 7065 6e64 5f6f          append_o
+0000e8a0: 7065 7261 7469 6f6e 5f62 6565 7028 6e6f  peration_beep(no
+0000e8b0: 6465 2c20 2a2a 6b77 6172 6773 290d 0a20  de, **kwargs).. 
+0000e8c0: 2020 2020 2020 2061 7070 656e 645f 6f70         append_op
+0000e8d0: 6572 6174 696f 6e5f 696e 7465 7272 7570  eration_interrup
+0000e8e0: 7428 6e6f 6465 2c20 2a2a 6b77 6172 6773  t(node, **kwargs
+0000e8f0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+0000e900: 7369 676e 616c 2822 7570 6461 7465 6f70  signal("updateop
+0000e910: 5f74 7265 6522 290d 0a0d 0a20 2020 2040  _tree")....    @
+0000e920: 7472 6565 5f73 7562 6d65 6e75 285f 2822  tree_submenu(_("
+0000e930: 4170 7065 6e64 2073 7065 6369 616c 206f  Append special o
+0000e940: 7065 7261 7469 6f6e 2873 2922 2929 0d0a  peration(s)"))..
+0000e950: 2020 2020 4074 7265 655f 6f70 6572 6174      @tree_operat
+0000e960: 696f 6e28 5f28 2241 7070 656e 6420 5368  ion(_("Append Sh
+0000e970: 7574 646f 776e 2229 2c20 6e6f 6465 5f74  utdown"), node_t
+0000e980: 7970 653d 2262 7261 6e63 6820 6f70 7322  ype="branch ops"
+0000e990: 2c20 6865 6c70 3d22 2229 0d0a 2020 2020  , help="")..    
+0000e9a0: 6465 6620 6170 7065 6e64 5f6f 7065 7261  def append_opera
+0000e9b0: 7469 6f6e 5f73 6875 7464 6f77 6e28 6e6f  tion_shutdown(no
+0000e9c0: 6465 2c20 706f 733d 4e6f 6e65 2c20 2a2a  de, pos=None, **
+0000e9d0: 6b77 6172 6773 293a 0d0a 2020 2020 2020  kwargs):..      
+0000e9e0: 2020 7365 6c66 2e6f 705f 6272 616e 6368    self.op_branch
+0000e9f0: 2e61 6464 280d 0a20 2020 2020 2020 2020  .add(..         
+0000ea00: 2020 2074 7970 653d 2275 7469 6c20 636f     type="util co
+0000ea10: 6e73 6f6c 6522 2c0d 0a20 2020 2020 2020  nsole",..       
+0000ea20: 2020 2020 2070 6f73 3d70 6f73 2c0d 0a20       pos=pos,.. 
+0000ea30: 2020 2020 2020 2020 2020 2063 6f6d 6d61             comma
+0000ea40: 6e64 3d22 7175 6974 222c 0d0a 2020 2020  nd="quit",..    
+0000ea50: 2020 2020 290d 0a20 2020 2020 2020 2073      )..        s
+0000ea60: 656c 662e 7369 676e 616c 2822 7570 6461  elf.signal("upda
+0000ea70: 7465 6f70 5f74 7265 6522 290d 0a0d 0a20  teop_tree").... 
+0000ea80: 2020 2040 7472 6565 5f73 7562 6d65 6e75     @tree_submenu
+0000ea90: 285f 2822 4170 7065 6e64 2073 7065 6369  (_("Append speci
+0000eaa0: 616c 206f 7065 7261 7469 6f6e 2873 2922  al operation(s)"
+0000eab0: 2929 0d0a 2020 2020 4074 7265 655f 7072  ))..    @tree_pr
+0000eac0: 6f6d 7074 2822 6f70 6e61 6d65 222c 205f  ompt("opname", _
+0000ead0: 2822 436f 6e73 6f6c 6520 636f 6d6d 616e  ("Console comman
+0000eae0: 6420 746f 2061 7070 656e 6420 746f 206f  d to append to o
+0000eaf0: 7065 7261 7469 6f6e 733f 2229 290d 0a20  perations?")).. 
+0000eb00: 2020 2040 7472 6565 5f6f 7065 7261 7469     @tree_operati
+0000eb10: 6f6e 285f 2822 4170 7065 6e64 2043 6f6e  on(_("Append Con
+0000eb20: 736f 6c65 2229 2c20 6e6f 6465 5f74 7970  sole"), node_typ
+0000eb30: 653d 2262 7261 6e63 6820 6f70 7322 2c20  e="branch ops", 
+0000eb40: 6865 6c70 3d22 2229 0d0a 2020 2020 6465  help="")..    de
+0000eb50: 6620 6170 7065 6e64 5f6f 7065 7261 7469  f append_operati
+0000eb60: 6f6e 5f63 7573 746f 6d28 6e6f 6465 2c20  on_custom(node, 
+0000eb70: 6f70 6e61 6d65 2c20 706f 733d 4e6f 6e65  opname, pos=None
+0000eb80: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
+0000eb90: 2020 2020 2020 7365 6c66 2e6f 705f 6272        self.op_br
+0000eba0: 616e 6368 2e61 6464 280d 0a20 2020 2020  anch.add(..     
+0000ebb0: 2020 2020 2020 2074 7970 653d 2275 7469         type="uti
+0000ebc0: 6c20 636f 6e73 6f6c 6522 2c0d 0a20 2020  l console",..   
+0000ebd0: 2020 2020 2020 2020 2070 6f73 3d70 6f73           pos=pos
+0000ebe0: 2c0d 0a20 2020 2020 2020 2020 2020 2063  ,..            c
+0000ebf0: 6f6d 6d61 6e64 3d6f 706e 616d 652c 0d0a  ommand=opname,..
+0000ec00: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
+0000ec10: 2020 2073 656c 662e 7369 676e 616c 2822     self.signal("
+0000ec20: 7570 6461 7465 6f70 5f74 7265 6522 290d  updateop_tree").
+0000ec30: 0a0d 0a20 2020 2040 7472 6565 5f73 7562  ...    @tree_sub
+0000ec40: 6d65 6e75 285f 2822 4170 7065 6e64 2073  menu(_("Append s
+0000ec50: 7065 6369 616c 206f 7065 7261 7469 6f6e  pecial operation
+0000ec60: 2873 2922 2929 0d0a 2020 2020 4074 7265  (s)"))..    @tre
+0000ec70: 655f 7072 6f6d 7074 2822 7922 2c20 5f28  e_prompt("y", _(
+0000ec80: 2259 2d43 6f6f 7264 696e 6174 6520 666f  "Y-Coordinate fo
+0000ec90: 7220 706c 6163 656d 656e 7420 746f 2061  r placement to a
+0000eca0: 7070 656e 643f 2229 290d 0a20 2020 2040  ppend?"))..    @
+0000ecb0: 7472 6565 5f70 726f 6d70 7428 2278 222c  tree_prompt("x",
+0000ecc0: 205f 2822 582d 436f 6f72 6469 6e61 7465   _("X-Coordinate
+0000ecd0: 2066 6f72 2070 6c61 6365 6d65 6e74 2074   for placement t
+0000ece0: 6f20 6170 7065 6e64 3f22 2929 0d0a 2020  o append?"))..  
+0000ecf0: 2020 4074 7265 655f 6f70 6572 6174 696f    @tree_operatio
+0000ed00: 6e28 5f28 2241 7070 656e 6420 506c 6163  n(_("Append Plac
+0000ed10: 656d 656e 7422 292c 206e 6f64 655f 7479  ement"), node_ty
+0000ed20: 7065 3d22 6272 616e 6368 206f 7073 222c  pe="branch ops",
+0000ed30: 2068 656c 703d 2222 290d 0a20 2020 2064   help="")..    d
+0000ed40: 6566 2061 7070 656e 645f 6f70 6572 6174  ef append_operat
+0000ed50: 696f 6e5f 706c 6163 656d 656e 7428 6e6f  ion_placement(no
+0000ed60: 6465 2c20 792c 2078 2c20 706f 733d 4e6f  de, y, x, pos=No
+0000ed70: 6e65 2c20 2a2a 6b77 6172 6773 293a 0d0a  ne, **kwargs):..
+0000ed80: 2020 2020 2020 2020 7365 6c66 2e6f 705f          self.op_
+0000ed90: 6272 616e 6368 2e61 6464 280d 0a20 2020  branch.add(..   
+0000eda0: 2020 2020 2020 2020 2074 7970 653d 2270           type="p
+0000edb0: 6c61 6365 2070 6f69 6e74 222c 0d0a 2020  lace point",..  
+0000edc0: 2020 2020 2020 2020 2020 706f 733d 706f            pos=po
+0000edd0: 732c 0d0a 2020 2020 2020 2020 2020 2020  s,..            
+0000ede0: 783d 782c 0d0a 2020 2020 2020 2020 2020  x=x,..          
+0000edf0: 2020 793d 792c 0d0a 2020 2020 2020 2020    y=y,..        
+0000ee00: 2020 2020 726f 7461 7469 6f6e 3d30 2c0d      rotation=0,.
+0000ee10: 0a20 2020 2020 2020 2020 2020 2063 6f72  .            cor
+0000ee20: 6e65 723d 302c 0d0a 2020 2020 2020 2020  ner=0,..        
+0000ee30: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+0000ee40: 7369 676e 616c 2822 7570 6461 7465 6f70  signal("updateop
+0000ee50: 5f74 7265 6522 290d 0a0d 0a20 2020 2040  _tree")....    @
+0000ee60: 7472 6565 5f6f 7065 7261 7469 6f6e 285f  tree_operation(_
+0000ee70: 2822 5265 636c 6173 7369 6679 206f 7065  ("Reclassify ope
+0000ee80: 7261 7469 6f6e 7322 292c 206e 6f64 655f  rations"), node_
+0000ee90: 7479 7065 3d22 6272 616e 6368 2065 6c65  type="branch ele
+0000eea0: 6d73 222c 2068 656c 703d 2222 290d 0a20  ms", help="").. 
+0000eeb0: 2020 2064 6566 2072 6563 6c61 7373 6966     def reclassif
+0000eec0: 795f 6f70 6572 6174 696f 6e73 286e 6f64  y_operations(nod
+0000eed0: 652c 202a 2a6b 7761 7267 7329 3a0d 0a20  e, **kwargs):.. 
+0000eee0: 2020 2020 2020 2065 6c65 6d73 203d 206c         elems = l
+0000eef0: 6973 7428 7365 6c66 2e65 6c65 6d73 2829  ist(self.elems()
+0000ef00: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+0000ef10: 7265 6d6f 7665 5f65 6c65 6d65 6e74 735f  remove_elements_
+0000ef20: 6672 6f6d 5f6f 7065 7261 7469 6f6e 7328  from_operations(
+0000ef30: 656c 656d 7329 0d0a 2020 2020 2020 2020  elems)..        
+0000ef40: 7365 6c66 2e63 6c61 7373 6966 7928 6c69  self.classify(li
+0000ef50: 7374 2873 656c 662e 656c 656d 7328 2929  st(self.elems())
+0000ef60: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+0000ef70: 7369 676e 616c 2822 7265 6672 6573 685f  signal("refresh_
+0000ef80: 7472 6565 2229 0d0a 0d0a 2020 2020 4074  tree")....    @t
+0000ef90: 7265 655f 6f70 6572 6174 696f 6e28 0d0a  ree_operation(..
+0000efa0: 2020 2020 2020 2020 5f28 2252 656d 6f76          _("Remov
+0000efb0: 6520 616c 6c20 6173 7369 676e 6d65 6e74  e all assignment
+0000efc0: 7320 6672 6f6d 206f 7065 7261 7469 6f6e  s from operation
+0000efd0: 7322 292c 0d0a 2020 2020 2020 2020 6e6f  s"),..        no
+0000efe0: 6465 5f74 7970 653d 2262 7261 6e63 6820  de_type="branch 
+0000eff0: 656c 656d 7322 2c0d 0a20 2020 2020 2020  elems",..       
+0000f000: 2068 656c 703d 5f28 2241 6e79 2065 7869   help=_("Any exi
+0000f010: 7374 696e 6720 6173 7369 676e 6d65 6e74  sting assignment
+0000f020: 206f 6620 656c 656d 656e 7473 2074 6f20   of elements to 
+0000f030: 6f70 6572 6174 696f 6e73 2077 696c 6c20  operations will 
+0000f040: 6265 2072 656d 6f76 6564 2229 2c0d 0a20  be removed"),.. 
+0000f050: 2020 2029 0d0a 2020 2020 6465 6620 7265     )..    def re
+0000f060: 6d6f 7665 5f61 6c6c 5f61 7373 6967 6e6d  move_all_assignm
+0000f070: 656e 7473 286e 6f64 652c 202a 2a6b 7761  ents(node, **kwa
+0000f080: 7267 7329 3a0d 0a20 2020 2020 2020 2077  rgs):..        w
+0000f090: 6974 6820 7365 6c66 2e73 7461 7469 6328  ith self.static(
+0000f0a0: 2272 656d 6f76 655f 616c 6c5f 6173 7369  "remove_all_assi
+0000f0b0: 676e 2229 3a0d 0a20 2020 2020 2020 2020  gn"):..         
+0000f0c0: 2020 2066 6f72 206e 6f64 6520 696e 2073     for node in s
+0000f0d0: 656c 662e 656c 656d 7328 293a 0d0a 2020  elf.elems():..  
+0000f0e0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+0000f0f0: 7220 7265 6620 696e 206c 6973 7428 6e6f  r ref in list(no
+0000f100: 6465 2e72 6566 6572 656e 6365 7329 3a0d  de.references):.
+0000f110: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f120: 2020 2020 2072 6566 2e72 656d 6f76 655f       ref.remove_
+0000f130: 6e6f 6465 2829 0d0a 2020 2020 2020 2020  node()..        
+0000f140: 7365 6c66 2e73 6967 6e61 6c28 2272 6566  self.signal("ref
+0000f150: 7265 7368 5f74 7265 6522 290d 0a0d 0a20  resh_tree").... 
+0000f160: 2020 2040 7472 6565 5f6f 7065 7261 7469     @tree_operati
+0000f170: 6f6e 280d 0a20 2020 2020 2020 205f 2822  on(..        _("
+0000f180: 4475 706c 6963 6174 6520 6f70 6572 6174  Duplicate operat
+0000f190: 696f 6e28 7329 2229 2c0d 0a20 2020 2020  ion(s)"),..     
+0000f1a0: 2020 206e 6f64 655f 7479 7065 3d6f 705f     node_type=op_
+0000f1b0: 6e6f 6465 732c 0d0a 2020 2020 2020 2020  nodes,..        
+0000f1c0: 6865 6c70 3d5f 2822 6475 706c 6963 6174  help=_("duplicat
+0000f1d0: 6520 6f70 6572 6174 696f 6e20 6e6f 6465  e operation node
+0000f1e0: 7322 292c 0d0a 2020 2020 290d 0a20 2020  s"),..    )..   
+0000f1f0: 2064 6566 2064 7570 6c69 6361 7465 5f6f   def duplicate_o
+0000f200: 7065 7261 7469 6f6e 286e 6f64 652c 202a  peration(node, *
+0000f210: 2a6b 7761 7267 7329 3a0d 0a20 2020 2020  *kwargs):..     
+0000f220: 2020 2077 6974 6820 7365 6c66 2e73 7461     with self.sta
+0000f230: 7469 6328 2264 7570 6c69 6361 7465 5f6f  tic("duplicate_o
+0000f240: 7065 7261 7469 6f6e 2229 3a0d 0a20 2020  peration"):..   
+0000f250: 2020 2020 2020 2020 206f 7065 7261 7469           operati
+0000f260: 6f6e 7320 3d20 7365 6c66 2e5f 7472 6565  ons = self._tree
+0000f270: 2e67 6574 2874 7970 653d 2262 7261 6e63  .get(type="branc
+0000f280: 6820 6f70 7322 292e 6368 696c 6472 656e  h ops").children
+0000f290: 0d0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
+0000f2a0: 7220 6f70 2069 6e20 7365 6c66 2e6f 7073  r op in self.ops
+0000f2b0: 2873 656c 6563 7465 643d 5472 7565 293a  (selected=True):
+0000f2c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000f2d0: 2020 7472 793a 0d0a 2020 2020 2020 2020    try:..        
+0000f2e0: 2020 2020 2020 2020 2020 2020 706f 7320              pos 
+0000f2f0: 3d20 6f70 6572 6174 696f 6e73 2e69 6e64  = operations.ind
+0000f300: 6578 286f 7029 202b 2031 0d0a 2020 2020  ex(op) + 1..    
+0000f310: 2020 2020 2020 2020 2020 2020 6578 6365              exce
+0000f320: 7074 2056 616c 7565 4572 726f 723a 0d0a  pt ValueError:..
+0000f330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f340: 2020 2020 706f 7320 3d20 4e6f 6e65 0d0a      pos = None..
+0000f350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f360: 636f 7079 5f6f 7020 3d20 636f 7079 286f  copy_op = copy(o
+0000f370: 7029 0d0a 2020 2020 2020 2020 2020 2020  p)..            
+0000f380: 2020 2020 7365 6c66 2e61 6464 5f6f 7028      self.add_op(
+0000f390: 636f 7079 5f6f 702c 2070 6f73 3d70 6f73  copy_op, pos=pos
+0000f3a0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+0000f3b0: 2020 2066 6f72 2063 6869 6c64 2069 6e20     for child in 
+0000f3c0: 6f70 2e63 6869 6c64 7265 6e3a 0d0a 2020  op.children:..  
+0000f3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f3e0: 2020 7472 793a 0d0a 2020 2020 2020 2020    try:..        
+0000f3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f400: 636f 7079 5f6f 702e 6164 645f 7265 6665  copy_op.add_refe
+0000f410: 7265 6e63 6528 6368 696c 642e 6e6f 6465  rence(child.node
+0000f420: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+0000f430: 2020 2020 2020 2065 7863 6570 7420 4174         except At
+0000f440: 7472 6962 7574 6545 7272 6f72 3a0d 0a20  tributeError:.. 
+0000f450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f460: 2020 2020 2020 2070 6173 730d 0a0d 0a20         pass.... 
+0000f470: 2020 2040 7472 6565 5f63 6f6e 6469 7469     @tree_conditi
+0000f480: 6f6e 616c 286c 616d 6264 6120 6e6f 6465  onal(lambda node
+0000f490: 3a20 6e6f 6465 2e63 6f75 6e74 5f63 6869  : node.count_chi
+0000f4a0: 6c64 7265 6e28 2920 3e20 3129 0d0a 2020  ldren() > 1)..  
+0000f4b0: 2020 4074 7265 655f 7375 626d 656e 7528    @tree_submenu(
+0000f4c0: 5f28 2250 6173 7365 7322 2929 0d0a 2020  _("Passes"))..  
+0000f4d0: 2020 4074 7265 655f 6f70 6572 6174 696f    @tree_operatio
+0000f4e0: 6e28 0d0a 2020 2020 2020 2020 5f28 2241  n(..        _("A
+0000f4f0: 6464 2031 2070 6173 7322 292c 0d0a 2020  dd 1 pass"),..  
+0000f500: 2020 2020 2020 6e6f 6465 5f74 7970 653d        node_type=
+0000f510: 2822 6f70 2069 6d61 6765 222c 2022 6f70  ("op image", "op
+0000f520: 2065 6e67 7261 7665 222c 2022 6f70 2063   engrave", "op c
+0000f530: 7574 222c 2022 6f70 2068 6174 6368 2229  ut", "op hatch")
+0000f540: 2c0d 0a20 2020 2020 2020 2068 656c 703d  ,..        help=
+0000f550: 2222 2c0d 0a20 2020 2029 0d0a 2020 2020  "",..    )..    
+0000f560: 6465 6620 6164 645f 315f 7061 7373 286e  def add_1_pass(n
+0000f570: 6f64 652c 202a 2a6b 7761 7267 7329 3a0d  ode, **kwargs):.
+0000f580: 0a20 2020 2020 2020 2061 6464 5f6e 5f70  .        add_n_p
+0000f590: 6173 7365 7328 6e6f 6465 2c20 636f 7069  asses(node, copi
+0000f5a0: 6573 3d31 2c20 2a2a 6b77 6172 6773 290d  es=1, **kwargs).
+0000f5b0: 0a0d 0a20 2020 2040 7472 6565 5f63 6f6e  ...    @tree_con
+0000f5c0: 6469 7469 6f6e 616c 286c 616d 6264 6120  ditional(lambda 
+0000f5d0: 6e6f 6465 3a20 6e6f 6465 2e63 6f75 6e74  node: node.count
+0000f5e0: 5f63 6869 6c64 7265 6e28 2920 3e20 3129  _children() > 1)
+0000f5f0: 0d0a 2020 2020 4074 7265 655f 7375 626d  ..    @tree_subm
+0000f600: 656e 7528 5f28 2250 6173 7365 7322 2929  enu(_("Passes"))
+0000f610: 0d0a 2020 2020 4074 7265 655f 6974 6572  ..    @tree_iter
+0000f620: 6174 6528 2263 6f70 6965 7322 2c20 322c  ate("copies", 2,
+0000f630: 2031 3029 0d0a 2020 2020 4074 7265 655f   10)..    @tree_
+0000f640: 6f70 6572 6174 696f 6e28 0d0a 2020 2020  operation(..    
+0000f650: 2020 2020 5f28 2241 6464 207b 636f 7069      _("Add {copi
+0000f660: 6573 7d20 7061 7373 6573 2229 2c0d 0a20  es} passes"),.. 
+0000f670: 2020 2020 2020 206e 6f64 655f 7479 7065         node_type
+0000f680: 3d28 226f 7020 696d 6167 6522 2c20 226f  =("op image", "o
+0000f690: 7020 656e 6772 6176 6522 2c20 226f 7020  p engrave", "op 
+0000f6a0: 6375 7422 2c20 226f 7020 6861 7463 6822  cut", "op hatch"
+0000f6b0: 292c 0d0a 2020 2020 2020 2020 6865 6c70  ),..        help
+0000f6c0: 3d22 222c 0d0a 2020 2020 290d 0a20 2020  ="",..    )..   
+0000f6d0: 2064 6566 2061 6464 5f6e 5f70 6173 7365   def add_n_passe
+0000f6e0: 7328 6e6f 6465 2c20 636f 7069 6573 3d31  s(node, copies=1
+0000f6f0: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
+0000f700: 2020 2020 2020 6164 645f 6e6f 6465 7320        add_nodes 
+0000f710: 3d20 6c69 7374 286e 6f64 652e 6368 696c  = list(node.chil
+0000f720: 6472 656e 290d 0a0d 0a20 2020 2020 2020  dren)....       
+0000f730: 2072 656d 6f76 6564 203d 2046 616c 7365   removed = False
+0000f740: 0d0a 2020 2020 2020 2020 666f 7220 6920  ..        for i 
+0000f750: 696e 2072 616e 6765 2830 2c20 6c65 6e28  in range(0, len(
+0000f760: 6164 645f 6e6f 6465 7329 293a 0d0a 2020  add_nodes)):..  
+0000f770: 2020 2020 2020 2020 2020 666f 7220 7120            for q 
+0000f780: 696e 2072 616e 6765 2830 2c20 6929 3a0d  in range(0, i):.
+0000f790: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f7a0: 2069 6620 6164 645f 6e6f 6465 735b 715d   if add_nodes[q]
+0000f7b0: 2069 7320 6164 645f 6e6f 6465 735b 695d   is add_nodes[i]
+0000f7c0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0000f7d0: 2020 2020 2020 2061 6464 5f6e 6f64 6573         add_nodes
+0000f7e0: 5b69 5d20 3d20 4e6f 6e65 0d0a 2020 2020  [i] = None..    
+0000f7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f800: 7265 6d6f 7665 6420 3d20 5472 7565 0d0a  removed = True..
+0000f810: 2020 2020 2020 2020 6966 2072 656d 6f76          if remov
+0000f820: 6564 3a0d 0a20 2020 2020 2020 2020 2020  ed:..           
+0000f830: 2061 6464 5f6e 6f64 6573 203d 205b 6320   add_nodes = [c 
+0000f840: 666f 7220 6320 696e 2061 6464 5f6e 6f64  for c in add_nod
+0000f850: 6573 2069 6620 6320 6973 206e 6f74 204e  es if c is not N
+0000f860: 6f6e 655d 0d0a 2020 2020 2020 2020 6164  one]..        ad
+0000f870: 645f 6e6f 6465 7320 2a3d 2063 6f70 6965  d_nodes *= copie
+0000f880: 730d 0a20 2020 2020 2020 2066 6f72 206e  s..        for n
+0000f890: 2069 6e20 6164 645f 6e6f 6465 733a 0d0a   in add_nodes:..
+0000f8a0: 2020 2020 2020 2020 2020 2020 6e6f 6465              node
+0000f8b0: 2e61 6464 5f72 6566 6572 656e 6365 286e  .add_reference(n
+0000f8c0: 2e6e 6f64 6529 0d0a 2020 2020 2020 2020  .node)..        
+0000f8d0: 7365 6c66 2e73 6967 6e61 6c28 2272 6562  self.signal("reb
+0000f8e0: 7569 6c64 5f74 7265 6522 290d 0a0d 0a20  uild_tree").... 
+0000f8f0: 2020 2040 7472 6565 5f63 6f6e 6469 7469     @tree_conditi
+0000f900: 6f6e 616c 286c 616d 6264 6120 6e6f 6465  onal(lambda node
+0000f910: 3a20 6e6f 6465 2e63 6f75 6e74 5f63 6869  : node.count_chi
+0000f920: 6c64 7265 6e28 2920 3e20 3129 0d0a 2020  ldren() > 1)..  
+0000f930: 2020 4074 7265 655f 7375 626d 656e 7528    @tree_submenu(
+0000f940: 5f28 2244 7570 6c69 6361 7465 2065 6c65  _("Duplicate ele
+0000f950: 6d65 6e74 2873 2922 2929 0d0a 2020 2020  ment(s)"))..    
+0000f960: 4074 7265 655f 6f70 6572 6174 696f 6e28  @tree_operation(
+0000f970: 0d0a 2020 2020 2020 2020 5f28 2244 7570  ..        _("Dup
+0000f980: 6c69 6361 7465 2065 6c65 6d65 6e74 7320  licate elements 
+0000f990: 3120 7469 6d65 2229 2c0d 0a20 2020 2020  1 time"),..     
+0000f9a0: 2020 206e 6f64 655f 7479 7065 3d28 226f     node_type=("o
+0000f9b0: 7020 696d 6167 6522 2c20 226f 7020 656e  p image", "op en
+0000f9c0: 6772 6176 6522 2c20 226f 7020 6375 7422  grave", "op cut"
+0000f9d0: 292c 0d0a 2020 2020 2020 2020 6865 6c70  ),..        help
+0000f9e0: 3d22 222c 0d0a 2020 2020 290d 0a20 2020  ="",..    )..   
+0000f9f0: 2064 6566 2064 7570 5f31 5f63 6f70 7928   def dup_1_copy(
+0000fa00: 6e6f 6465 2c20 2a2a 6b77 6172 6773 293a  node, **kwargs):
+0000fa10: 0d0a 2020 2020 2020 2020 6475 705f 6e5f  ..        dup_n_
+0000fa20: 636f 7069 6573 286e 6f64 652c 2063 6f70  copies(node, cop
+0000fa30: 6965 733d 312c 202a 2a6b 7761 7267 7329  ies=1, **kwargs)
+0000fa40: 0d0a 0d0a 2020 2020 4074 7265 655f 636f  ....    @tree_co
+0000fa50: 6e64 6974 696f 6e61 6c28 6c61 6d62 6461  nditional(lambda
+0000fa60: 206e 6f64 653a 206e 6f64 652e 636f 756e   node: node.coun
+0000fa70: 745f 6368 696c 6472 656e 2829 203e 2031  t_children() > 1
+0000fa80: 290d 0a20 2020 2040 7472 6565 5f73 7562  )..    @tree_sub
+0000fa90: 6d65 6e75 285f 2822 4475 706c 6963 6174  menu(_("Duplicat
+0000faa0: 6520 656c 656d 656e 7428 7329 2229 290d  e element(s)")).
+0000fab0: 0a20 2020 2040 7472 6565 5f69 7465 7261  .    @tree_itera
+0000fac0: 7465 2822 636f 7069 6573 222c 2032 2c20  te("copies", 2, 
+0000fad0: 3130 290d 0a20 2020 2040 7472 6565 5f6f  10)..    @tree_o
+0000fae0: 7065 7261 7469 6f6e 280d 0a20 2020 2020  peration(..     
+0000faf0: 2020 205f 2822 4475 706c 6963 6174 6520     _("Duplicate 
+0000fb00: 656c 656d 656e 7473 207b 636f 7069 6573  elements {copies
+0000fb10: 7d20 7469 6d65 7322 292c 0d0a 2020 2020  } times"),..    
+0000fb20: 2020 2020 6e6f 6465 5f74 7970 653d 2822      node_type=("
+0000fb30: 6f70 2069 6d61 6765 222c 2022 6f70 2065  op image", "op e
+0000fb40: 6e67 7261 7665 222c 2022 6f70 2063 7574  ngrave", "op cut
+0000fb50: 2229 2c0d 0a20 2020 2020 2020 2068 656c  "),..        hel
+0000fb60: 703d 2222 2c0d 0a20 2020 2029 0d0a 2020  p="",..    )..  
+0000fb70: 2020 6465 6620 6475 705f 6e5f 636f 7069    def dup_n_copi
+0000fb80: 6573 286e 6f64 652c 2063 6f70 6965 733d  es(node, copies=
+0000fb90: 312c 202a 2a6b 7761 7267 7329 3a0d 0a20  1, **kwargs):.. 
+0000fba0: 2020 2020 2020 2023 2043 6f64 6520 696e         # Code in
+0000fbb0: 2073 6572 6965 732e 0d0a 2020 2020 2020   series...      
+0000fbc0: 2020 2320 6164 645f 6e6f 6465 7320 3d20    # add_nodes = 
+0000fbd0: 6c69 7374 286e 6f64 652e 6368 696c 6472  list(node.childr
+0000fbe0: 656e 290d 0a20 2020 2020 2020 2023 2061  en)..        # a
+0000fbf0: 6464 5f6e 6f64 6573 202a 3d20 636f 7069  dd_nodes *= copi
+0000fc00: 6573 0d0a 2020 2020 2020 2020 2320 666f  es..        # fo
+0000fc10: 7220 6e20 696e 2061 6464 5f6e 6f64 6573  r n in add_nodes
+0000fc20: 3a0d 0a20 2020 2020 2020 2023 2020 2020  :..        #    
+0000fc30: 206e 6f64 652e 6164 645f 7265 6665 7265   node.add_refere
+0000fc40: 6e63 6528 6e2e 6e6f 6465 290d 0a0d 0a20  nce(n.node).... 
+0000fc50: 2020 2020 2020 2023 2043 6f64 6520 696e         # Code in
+0000fc60: 2070 6172 616c 6c65 6c2e 0d0a 2020 2020   parallel...    
+0000fc70: 2020 2020 6164 645f 6e6f 6465 7320 3d20      add_nodes = 
+0000fc80: 6c69 7374 286e 6f64 652e 6368 696c 6472  list(node.childr
+0000fc90: 656e 290d 0a20 2020 2020 2020 2066 6f72  en)..        for
+0000fca0: 2069 2069 6e20 7261 6e67 6528 6c65 6e28   i in range(len(
+0000fcb0: 6164 645f 6e6f 6465 7329 202d 2031 2c20  add_nodes) - 1, 
+0000fcc0: 2d31 2c20 2d31 293a 0d0a 2020 2020 2020  -1, -1):..      
+0000fcd0: 2020 2020 2020 6e20 3d20 6164 645f 6e6f        n = add_no
+0000fce0: 6465 735b 695d 0d0a 2020 2020 2020 2020  des[i]..        
+0000fcf0: 2020 2020 666f 7220 6b20 696e 2072 616e      for k in ran
+0000fd00: 6765 2863 6f70 6965 7329 3a0d 0a20 2020  ge(copies):..   
+0000fd10: 2020 2020 2020 2020 2020 2020 206e 6f64               nod
+0000fd20: 652e 6164 645f 7265 6665 7265 6e63 6528  e.add_reference(
+0000fd30: 6e2e 6e6f 6465 2c20 706f 733d 6929 0d0a  n.node, pos=i)..
+0000fd40: 0d0a 2020 2020 2020 2020 7365 6c66 2e73  ..        self.s
+0000fd50: 6967 6e61 6c28 2272 6566 7265 7368 5f74  ignal("refresh_t
+0000fd60: 7265 6522 290d 0a0d 0a20 2020 2040 7472  ree")....    @tr
+0000fd70: 6565 5f6f 7065 7261 7469 6f6e 280d 0a20  ee_operation(.. 
+0000fd80: 2020 2020 2020 205f 2822 4d61 6b65 2072         _("Make r
+0000fd90: 6173 7465 7220 696d 6167 6522 292c 0d0a  aster image"),..
+0000fda0: 2020 2020 2020 2020 6e6f 6465 5f74 7970          node_typ
+0000fdb0: 653d 2822 6f70 2069 6d61 6765 222c 2022  e=("op image", "
+0000fdc0: 6f70 2072 6173 7465 7222 292c 0d0a 2020  op raster"),..  
+0000fdd0: 2020 2020 2020 6865 6c70 3d5f 2822 4372        help=_("Cr
+0000fde0: 6561 7465 2061 6e20 696d 6167 6520 6672  eate an image fr
+0000fdf0: 6f6d 2074 6865 2061 7373 6967 6e65 6420  om the assigned 
+0000fe00: 656c 656d 656e 7473 2e22 292c 0d0a 2020  elements."),..  
+0000fe10: 2020 290d 0a20 2020 2064 6566 206d 616b    )..    def mak
+0000fe20: 655f 7261 7374 6572 5f69 6d61 6765 286e  e_raster_image(n
+0000fe30: 6f64 652c 202a 2a6b 7761 7267 7329 3a0d  ode, **kwargs):.
+0000fe40: 0a20 2020 2020 2020 2064 6174 6120 3d20  .        data = 
+0000fe50: 6c69 7374 286e 6f64 652e 666c 6174 2874  list(node.flat(t
+0000fe60: 7970 6573 3d65 6c65 6d5f 7265 665f 6e6f  ypes=elem_ref_no
+0000fe70: 6465 7329 290d 0a20 2020 2020 2020 2069  des))..        i
+0000fe80: 6620 6c65 6e28 6461 7461 2920 3d3d 2030  f len(data) == 0
+0000fe90: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
+0000fea0: 6574 7572 6e0d 0a20 2020 2020 2020 2074  eturn..        t
+0000feb0: 7279 3a0d 0a20 2020 2020 2020 2020 2020  ry:..           
+0000fec0: 2062 6f75 6e64 7320 3d20 4e6f 6465 2e75   bounds = Node.u
+0000fed0: 6e69 6f6e 5f62 6f75 6e64 7328 6461 7461  nion_bounds(data
+0000fee0: 2c20 6174 7472 3d22 7061 696e 745f 626f  , attr="paint_bo
+0000fef0: 756e 6473 2229 0d0a 2020 2020 2020 2020  unds")..        
+0000ff00: 2020 2020 7769 6474 6820 3d20 626f 756e      width = boun
+0000ff10: 6473 5b32 5d20 2d20 626f 756e 6473 5b30  ds[2] - bounds[0
+0000ff20: 5d0d 0a20 2020 2020 2020 2020 2020 2068  ]..            h
+0000ff30: 6569 6768 7420 3d20 626f 756e 6473 5b33  eight = bounds[3
+0000ff40: 5d20 2d20 626f 756e 6473 5b31 5d0d 0a20  ] - bounds[1].. 
+0000ff50: 2020 2020 2020 2065 7863 6570 7420 5479         except Ty
+0000ff60: 7065 4572 726f 723a 0d0a 2020 2020 2020  peError:..      
+0000ff70: 2020 2020 2020 7261 6973 6520 436f 6d6d        raise Comm
+0000ff80: 616e 6453 796e 7461 7845 7272 6f72 0d0a  andSyntaxError..
+0000ff90: 2020 2020 2020 2020 6d61 6b65 5f72 6173          make_ras
+0000ffa0: 7465 7220 3d20 7365 6c66 2e6c 6f6f 6b75  ter = self.looku
+0000ffb0: 7028 2272 656e 6465 722d 6f70 2f6d 616b  p("render-op/mak
+0000ffc0: 655f 7261 7374 6572 2229 0d0a 2020 2020  e_raster")..    
+0000ffd0: 2020 2020 6966 206e 6f74 206d 616b 655f      if not make_
+0000ffe0: 7261 7374 6572 3a0d 0a20 2020 2020 2020  raster:..       
+0000fff0: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+00010000: 4572 726f 7228 224e 6f20 7265 6e64 6572  Error("No render
+00010010: 6572 2069 7320 7265 6769 7374 6572 6564  er is registered
+00010020: 2074 6f20 7065 7266 6f72 6d20 7265 6e64   to perform rend
+00010030: 6572 2e22 290d 0a0d 0a20 2020 2020 2020  er.")....       
+00010040: 2064 6f74 735f 7065 725f 756e 6974 7320   dots_per_units 
+00010050: 3d20 6e6f 6465 2e64 7069 202f 2055 4e49  = node.dpi / UNI
+00010060: 5453 5f50 4552 5f49 4e43 480d 0a20 2020  TS_PER_INCH..   
+00010070: 2020 2020 206e 6577 5f77 6964 7468 203d       new_width =
+00010080: 2077 6964 7468 202a 2064 6f74 735f 7065   width * dots_pe
+00010090: 725f 756e 6974 730d 0a20 2020 2020 2020  r_units..       
+000100a0: 206e 6577 5f68 6569 6768 7420 3d20 6865   new_height = he
+000100b0: 6967 6874 202a 2064 6f74 735f 7065 725f  ight * dots_per_
+000100c0: 756e 6974 730d 0a0d 0a20 2020 2020 2020  units....       
+000100d0: 2069 6d61 6765 203d 206d 616b 655f 7261   image = make_ra
+000100e0: 7374 6572 280d 0a20 2020 2020 2020 2020  ster(..         
+000100f0: 2020 2064 6174 612c 0d0a 2020 2020 2020     data,..      
+00010100: 2020 2020 2020 626f 756e 6473 3d62 6f75        bounds=bou
+00010110: 6e64 732c 0d0a 2020 2020 2020 2020 2020  nds,..          
+00010120: 2020 7769 6474 683d 6e65 775f 7769 6474    width=new_widt
+00010130: 682c 0d0a 2020 2020 2020 2020 2020 2020  h,..            
+00010140: 6865 6967 6874 3d6e 6577 5f68 6569 6768  height=new_heigh
+00010150: 742c 0d0a 2020 2020 2020 2020 290d 0a20  t,..        ).. 
+00010160: 2020 2020 2020 206d 6174 7269 7820 3d20         matrix = 
+00010170: 4d61 7472 6978 2e73 6361 6c65 2877 6964  Matrix.scale(wid
+00010180: 7468 202f 206e 6577 5f77 6964 7468 2c20  th / new_width, 
+00010190: 6865 6967 6874 202f 206e 6577 5f68 6569  height / new_hei
+000101a0: 6768 7429 0d0a 2020 2020 2020 2020 6d61  ght)..        ma
+000101b0: 7472 6978 2e70 6f73 745f 7472 616e 736c  trix.post_transl
+000101c0: 6174 6528 626f 756e 6473 5b30 5d2c 2062  ate(bounds[0], b
+000101d0: 6f75 6e64 735b 315d 290d 0a0d 0a20 2020  ounds[1])....   
+000101e0: 2020 2020 2069 6d61 6765 5f6e 6f64 6520       image_node 
+000101f0: 3d20 496d 6167 654e 6f64 6528 696d 6167  = ImageNode(imag
+00010200: 653d 696d 6167 652c 206d 6174 7269 783d  e=image, matrix=
+00010210: 6d61 7472 6978 2c20 6470 693d 6e6f 6465  matrix, dpi=node
+00010220: 2e64 7069 290d 0a20 2020 2020 2020 2073  .dpi)..        s
+00010230: 656c 662e 656c 656d 5f62 7261 6e63 682e  elf.elem_branch.
+00010240: 6164 645f 6e6f 6465 2869 6d61 6765 5f6e  add_node(image_n
+00010250: 6f64 6529 0d0a 2020 2020 2020 2020 6e6f  ode)..        no
+00010260: 6465 2e61 6464 5f72 6566 6572 656e 6365  de.add_reference
+00010270: 2869 6d61 6765 5f6e 6f64 6529 0d0a 2020  (image_node)..  
+00010280: 2020 2020 2020 7365 6c66 2e73 6967 6e61        self.signa
+00010290: 6c28 2272 6566 7265 7368 5f73 6365 6e65  l("refresh_scene
+000102a0: 222c 2022 5363 656e 6522 290d 0a0d 0a20  ", "Scene").... 
+000102b0: 2020 2064 6566 2061 6464 5f61 6674 6572     def add_after
+000102c0: 5f69 6e64 6578 286e 6f64 653d 4e6f 6e65  _index(node=None
+000102d0: 293a 0d0a 2020 2020 2020 2020 7472 793a  ):..        try:
+000102e0: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+000102f0: 206e 6f64 6520 6973 204e 6f6e 653a 0d0a   node is None:..
+00010300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010310: 6e6f 6465 203d 206c 6973 7428 7365 6c66  node = list(self
+00010320: 2e6f 7073 2873 656c 6563 7465 643d 5472  .ops(selected=Tr
+00010330: 7565 2929 5b2d 315d 0d0a 2020 2020 2020  ue))[-1]..      
+00010340: 2020 2020 2020 6f70 6572 6174 696f 6e73        operations
+00010350: 203d 2073 656c 662e 5f74 7265 652e 6765   = self._tree.ge
+00010360: 7428 7479 7065 3d22 6272 616e 6368 206f  t(type="branch o
+00010370: 7073 2229 2e63 6869 6c64 7265 6e0d 0a20  ps").children.. 
+00010380: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00010390: 6e20 6f70 6572 6174 696f 6e73 2e69 6e64  n operations.ind
+000103a0: 6578 286e 6f64 6529 202b 2031 0d0a 2020  ex(node) + 1..  
+000103b0: 2020 2020 2020 6578 6365 7074 2028 5661        except (Va
+000103c0: 6c75 6545 7272 6f72 2c20 496e 6465 7845  lueError, IndexE
+000103d0: 7272 6f72 293a 0d0a 2020 2020 2020 2020  rror):..        
+000103e0: 2020 2020 7265 7475 726e 204e 6f6e 650d      return None.
+000103f0: 0a0d 0a20 2020 2040 7472 6565 5f73 6570  ...    @tree_sep
+00010400: 6172 6174 6f72 5f62 6566 6f72 6528 290d  arator_before().
+00010410: 0a20 2020 2040 7472 6565 5f73 7562 6d65  .    @tree_subme
+00010420: 6e75 285f 2822 496e 7365 7274 206f 7065  nu(_("Insert ope
+00010430: 7261 7469 6f6e 2229 290d 0a20 2020 2040  ration"))..    @
+00010440: 7472 6565 5f6f 7065 7261 7469 6f6e 285f  tree_operation(_
+00010450: 2822 4164 6420 496d 6167 6522 292c 206e  ("Add Image"), n
+00010460: 6f64 655f 7479 7065 3d6f 705f 6e6f 6465  ode_type=op_node
+00010470: 732c 2068 656c 703d 2222 290d 0a20 2020  s, help="")..   
+00010480: 2064 6566 2061 6464 5f6f 7065 7261 7469   def add_operati
+00010490: 6f6e 5f69 6d61 6765 286e 6f64 652c 202a  on_image(node, *
+000104a0: 2a6b 7761 7267 7329 3a0d 0a20 2020 2020  *kwargs):..     
+000104b0: 2020 2061 7070 656e 645f 6f70 6572 6174     append_operat
+000104c0: 696f 6e5f 696d 6167 6528 6e6f 6465 2c20  ion_image(node, 
+000104d0: 706f 733d 6164 645f 6166 7465 725f 696e  pos=add_after_in
+000104e0: 6465 7828 6e6f 6465 292c 202a 2a6b 7761  dex(node), **kwa
+000104f0: 7267 7329 0d0a 0d0a 2020 2020 4074 7265  rgs)....    @tre
+00010500: 655f 7375 626d 656e 7528 5f28 2249 6e73  e_submenu(_("Ins
+00010510: 6572 7420 6f70 6572 6174 696f 6e22 2929  ert operation"))
+00010520: 0d0a 2020 2020 4074 7265 655f 6f70 6572  ..    @tree_oper
+00010530: 6174 696f 6e28 5f28 2241 6464 2052 6173  ation(_("Add Ras
+00010540: 7465 7222 292c 206e 6f64 655f 7479 7065  ter"), node_type
+00010550: 3d6f 705f 6e6f 6465 732c 2068 656c 703d  =op_nodes, help=
+00010560: 2222 290d 0a20 2020 2064 6566 2061 6464  "")..    def add
+00010570: 5f6f 7065 7261 7469 6f6e 5f72 6173 7465  _operation_raste
+00010580: 7228 6e6f 6465 2c20 2a2a 6b77 6172 6773  r(node, **kwargs
+00010590: 293a 0d0a 2020 2020 2020 2020 6170 7065  ):..        appe
+000105a0: 6e64 5f6f 7065 7261 7469 6f6e 5f72 6173  nd_operation_ras
+000105b0: 7465 7228 6e6f 6465 2c20 706f 733d 6164  ter(node, pos=ad
+000105c0: 645f 6166 7465 725f 696e 6465 7828 6e6f  d_after_index(no
+000105d0: 6465 292c 202a 2a6b 7761 7267 7329 0d0a  de), **kwargs)..
+000105e0: 0d0a 2020 2020 4074 7265 655f 7375 626d  ..    @tree_subm
+000105f0: 656e 7528 5f28 2249 6e73 6572 7420 6f70  enu(_("Insert op
+00010600: 6572 6174 696f 6e22 2929 0d0a 2020 2020  eration"))..    
+00010610: 4074 7265 655f 6f70 6572 6174 696f 6e28  @tree_operation(
+00010620: 5f28 2241 6464 2045 6e67 7261 7665 2229  _("Add Engrave")
+00010630: 2c20 6e6f 6465 5f74 7970 653d 6f70 5f6e  , node_type=op_n
+00010640: 6f64 6573 2c20 6865 6c70 3d22 2229 0d0a  odes, help="")..
+00010650: 2020 2020 6465 6620 6164 645f 6f70 6572      def add_oper
+00010660: 6174 696f 6e5f 656e 6772 6176 6528 6e6f  ation_engrave(no
+00010670: 6465 2c20 2a2a 6b77 6172 6773 293a 0d0a  de, **kwargs):..
+00010680: 2020 2020 2020 2020 6170 7065 6e64 5f6f          append_o
+00010690: 7065 7261 7469 6f6e 5f65 6e67 7261 7665  peration_engrave
+000106a0: 286e 6f64 652c 2070 6f73 3d61 6464 5f61  (node, pos=add_a
+000106b0: 6674 6572 5f69 6e64 6578 286e 6f64 6529  fter_index(node)
+000106c0: 2c20 2a2a 6b77 6172 6773 290d 0a0d 0a20  , **kwargs).... 
+000106d0: 2020 2040 7472 6565 5f73 7562 6d65 6e75     @tree_submenu
+000106e0: 285f 2822 496e 7365 7274 206f 7065 7261  (_("Insert opera
+000106f0: 7469 6f6e 2229 290d 0a20 2020 2040 7472  tion"))..    @tr
+00010700: 6565 5f6f 7065 7261 7469 6f6e 285f 2822  ee_operation(_("
+00010710: 4164 6420 4375 7422 292c 206e 6f64 655f  Add Cut"), node_
+00010720: 7479 7065 3d6f 705f 6e6f 6465 732c 2068  type=op_nodes, h
+00010730: 656c 703d 2222 290d 0a20 2020 2064 6566  elp="")..    def
+00010740: 2061 6464 5f6f 7065 7261 7469 6f6e 5f63   add_operation_c
+00010750: 7574 286e 6f64 652c 202a 2a6b 7761 7267  ut(node, **kwarg
+00010760: 7329 3a0d 0a20 2020 2020 2020 2061 7070  s):..        app
+00010770: 656e 645f 6f70 6572 6174 696f 6e5f 6375  end_operation_cu
+00010780: 7428 6e6f 6465 2c20 706f 733d 6164 645f  t(node, pos=add_
+00010790: 6166 7465 725f 696e 6465 7828 6e6f 6465  after_index(node
+000107a0: 292c 202a 2a6b 7761 7267 7329 0d0a 0d0a  ), **kwargs)....
+000107b0: 2020 2020 4074 7265 655f 7375 626d 656e      @tree_submen
+000107c0: 7528 5f28 2249 6e73 6572 7420 6f70 6572  u(_("Insert oper
+000107d0: 6174 696f 6e22 2929 0d0a 2020 2020 4074  ation"))..    @t
+000107e0: 7265 655f 6f70 6572 6174 696f 6e28 5f28  ree_operation(_(
+000107f0: 2241 6464 2048 6174 6368 2229 2c20 6e6f  "Add Hatch"), no
+00010800: 6465 5f74 7970 653d 6f70 5f6e 6f64 6573  de_type=op_nodes
+00010810: 2c20 6865 6c70 3d22 2229 0d0a 2020 2020  , help="")..    
+00010820: 6465 6620 6164 645f 6f70 6572 6174 696f  def add_operatio
+00010830: 6e5f 6861 7463 6828 6e6f 6465 2c20 2a2a  n_hatch(node, **
+00010840: 6b77 6172 6773 293a 0d0a 2020 2020 2020  kwargs):..      
+00010850: 2020 6170 7065 6e64 5f6f 7065 7261 7469    append_operati
+00010860: 6f6e 5f68 6174 6368 286e 6f64 652c 2070  on_hatch(node, p
+00010870: 6f73 3d61 6464 5f61 6674 6572 5f69 6e64  os=add_after_ind
+00010880: 6578 286e 6f64 6529 2c20 2a2a 6b77 6172  ex(node), **kwar
+00010890: 6773 290d 0a0d 0a20 2020 2040 7472 6565  gs)....    @tree
+000108a0: 5f73 7562 6d65 6e75 285f 2822 496e 7365  _submenu(_("Inse
+000108b0: 7274 206f 7065 7261 7469 6f6e 2229 290d  rt operation")).
+000108c0: 0a20 2020 2040 7472 6565 5f6f 7065 7261  .    @tree_opera
+000108d0: 7469 6f6e 285f 2822 4164 6420 446f 7473  tion(_("Add Dots
+000108e0: 2229 2c20 6e6f 6465 5f74 7970 653d 6f70  "), node_type=op
+000108f0: 5f6e 6f64 6573 2c20 6865 6c70 3d22 2229  _nodes, help="")
+00010900: 0d0a 2020 2020 6465 6620 6164 645f 6f70  ..    def add_op
+00010910: 6572 6174 696f 6e5f 646f 7473 286e 6f64  eration_dots(nod
+00010920: 652c 202a 2a6b 7761 7267 7329 3a0d 0a20  e, **kwargs):.. 
+00010930: 2020 2020 2020 2061 7070 656e 645f 6f70         append_op
+00010940: 6572 6174 696f 6e5f 646f 7473 286e 6f64  eration_dots(nod
+00010950: 652c 2070 6f73 3d61 6464 5f61 6674 6572  e, pos=add_after
+00010960: 5f69 6e64 6578 286e 6f64 6529 2c20 2a2a  _index(node), **
+00010970: 6b77 6172 6773 290d 0a0d 0a20 2020 2040  kwargs)....    @
+00010980: 7472 6565 5f73 7562 6d65 6e75 285f 2822  tree_submenu(_("
+00010990: 496e 7365 7274 2073 7065 6369 616c 206f  Insert special o
+000109a0: 7065 7261 7469 6f6e 2873 2922 2929 0d0a  peration(s)"))..
+000109b0: 2020 2020 4074 7265 655f 6f70 6572 6174      @tree_operat
+000109c0: 696f 6e28 5f28 2241 6464 2048 6f6d 6522  ion(_("Add Home"
+000109d0: 292c 206e 6f64 655f 7479 7065 3d6f 705f  ), node_type=op_
+000109e0: 6e6f 6465 732c 2068 656c 703d 2222 290d  nodes, help="").
+000109f0: 0a20 2020 2064 6566 2061 6464 5f6f 7065  .    def add_ope
+00010a00: 7261 7469 6f6e 5f68 6f6d 6528 6e6f 6465  ration_home(node
+00010a10: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
+00010a20: 2020 2020 2020 6170 7065 6e64 5f6f 7065        append_ope
+00010a30: 7261 7469 6f6e 5f68 6f6d 6528 6e6f 6465  ration_home(node
+00010a40: 2c20 706f 733d 6164 645f 6166 7465 725f  , pos=add_after_
+00010a50: 696e 6465 7828 6e6f 6465 292c 202a 2a6b  index(node), **k
+00010a60: 7761 7267 7329 0d0a 0d0a 2020 2020 4074  wargs)....    @t
+00010a70: 7265 655f 7375 626d 656e 7528 5f28 2249  ree_submenu(_("I
+00010a80: 6e73 6572 7420 7370 6563 6961 6c20 6f70  nsert special op
+00010a90: 6572 6174 696f 6e28 7329 2229 290d 0a20  eration(s)")).. 
+00010aa0: 2020 2040 7472 6565 5f6f 7065 7261 7469     @tree_operati
+00010ab0: 6f6e 285f 2822 4164 6420 5265 7475 726e  on(_("Add Return
+00010ac0: 2074 6f20 4f72 6967 696e 2229 2c20 6e6f   to Origin"), no
+00010ad0: 6465 5f74 7970 653d 6f70 5f6e 6f64 6573  de_type=op_nodes
+00010ae0: 2c20 6865 6c70 3d22 2229 0d0a 2020 2020  , help="")..    
+00010af0: 6465 6620 6164 645f 6f70 6572 6174 696f  def add_operatio
+00010b00: 6e5f 6f72 6967 696e 286e 6f64 652c 202a  n_origin(node, *
+00010b10: 2a6b 7761 7267 7329 3a0d 0a20 2020 2020  *kwargs):..     
+00010b20: 2020 2061 7070 656e 645f 6f70 6572 6174     append_operat
+00010b30: 696f 6e5f 676f 746f 286e 6f64 652c 2070  ion_goto(node, p
+00010b40: 6f73 3d61 6464 5f61 6674 6572 5f69 6e64  os=add_after_ind
+00010b50: 6578 286e 6f64 6529 2c20 2a2a 6b77 6172  ex(node), **kwar
+00010b60: 6773 290d 0a0d 0a20 2020 2040 7472 6565  gs)....    @tree
+00010b70: 5f73 7562 6d65 6e75 285f 2822 496e 7365  _submenu(_("Inse
+00010b80: 7274 2073 7065 6369 616c 206f 7065 7261  rt special opera
+00010b90: 7469 6f6e 2873 2922 2929 0d0a 2020 2020  tion(s)"))..    
+00010ba0: 4074 7265 655f 6f70 6572 6174 696f 6e28  @tree_operation(
+00010bb0: 5f28 2241 6464 2042 6565 7022 292c 206e  _("Add Beep"), n
+00010bc0: 6f64 655f 7479 7065 3d6f 705f 6e6f 6465  ode_type=op_node
+00010bd0: 732c 2068 656c 703d 2222 290d 0a20 2020  s, help="")..   
+00010be0: 2064 6566 2061 6464 5f6f 7065 7261 7469   def add_operati
+00010bf0: 6f6e 5f62 6565 7028 6e6f 6465 2c20 2a2a  on_beep(node, **
+00010c00: 6b77 6172 6773 293a 0d0a 2020 2020 2020  kwargs):..      
+00010c10: 2020 6170 7065 6e64 5f6f 7065 7261 7469    append_operati
+00010c20: 6f6e 5f62 6565 7028 6e6f 6465 2c20 706f  on_beep(node, po
+00010c30: 733d 6164 645f 6166 7465 725f 696e 6465  s=add_after_inde
+00010c40: 7828 6e6f 6465 292c 202a 2a6b 7761 7267  x(node), **kwarg
+00010c50: 7329 0d0a 0d0a 2020 2020 4074 7265 655f  s)....    @tree_
+00010c60: 7375 626d 656e 7528 5f28 2249 6e73 6572  submenu(_("Inser
+00010c70: 7420 7370 6563 6961 6c20 6f70 6572 6174  t special operat
+00010c80: 696f 6e28 7329 2229 290d 0a20 2020 2040  ion(s)"))..    @
+00010c90: 7472 6565 5f6f 7065 7261 7469 6f6e 285f  tree_operation(_
+00010ca0: 2822 4164 6420 496e 7465 7272 7570 7422  ("Add Interrupt"
+00010cb0: 292c 206e 6f64 655f 7479 7065 3d6f 705f  ), node_type=op_
+00010cc0: 6e6f 6465 732c 2068 656c 703d 2222 290d  nodes, help="").
+00010cd0: 0a20 2020 2064 6566 2061 6464 5f6f 7065  .    def add_ope
+00010ce0: 7261 7469 6f6e 5f69 6e74 6572 7275 7074  ration_interrupt
+00010cf0: 286e 6f64 652c 202a 2a6b 7761 7267 7329  (node, **kwargs)
+00010d00: 3a0d 0a20 2020 2020 2020 2061 7070 656e  :..        appen
+00010d10: 645f 6f70 6572 6174 696f 6e5f 696e 7465  d_operation_inte
+00010d20: 7272 7570 7428 6e6f 6465 2c20 706f 733d  rrupt(node, pos=
+00010d30: 6164 645f 6166 7465 725f 696e 6465 7828  add_after_index(
+00010d40: 6e6f 6465 292c 202a 2a6b 7761 7267 7329  node), **kwargs)
+00010d50: 0d0a 0d0a 2020 2020 4074 7265 655f 7375  ....    @tree_su
+00010d60: 626d 656e 7528 5f28 2249 6e73 6572 7420  bmenu(_("Insert 
+00010d70: 7370 6563 6961 6c20 6f70 6572 6174 696f  special operatio
+00010d80: 6e28 7329 2229 290d 0a20 2020 2040 7472  n(s)"))..    @tr
+00010d90: 6565 5f70 726f 6d70 7428 2277 6169 745f  ee_prompt("wait_
+00010da0: 7469 6d65 222c 205f 2822 5761 6974 2066  time", _("Wait f
+00010db0: 6f72 2068 6f77 206c 6f6e 6720 2869 6e20  or how long (in 
+00010dc0: 7365 636f 6e64 7329 3f22 292c 2064 6174  seconds)?"), dat
+00010dd0: 615f 7479 7065 3d66 6c6f 6174 290d 0a20  a_type=float).. 
+00010de0: 2020 2040 7472 6565 5f6f 7065 7261 7469     @tree_operati
+00010df0: 6f6e 285f 2822 4164 6420 5761 6974 2229  on(_("Add Wait")
+00010e00: 2c20 6e6f 6465 5f74 7970 653d 6f70 5f6e  , node_type=op_n
+00010e10: 6f64 6573 2c20 6865 6c70 3d22 2229 0d0a  odes, help="")..
+00010e20: 2020 2020 6465 6620 6164 645f 6f70 6572      def add_oper
+00010e30: 6174 696f 6e5f 7761 6974 286e 6f64 652c  ation_wait(node,
+00010e40: 2077 6169 745f 7469 6d65 2c20 2a2a 6b77   wait_time, **kw
+00010e50: 6172 6773 293a 0d0a 2020 2020 2020 2020  args):..        
+00010e60: 6170 7065 6e64 5f6f 7065 7261 7469 6f6e  append_operation
+00010e70: 5f77 6169 7428 0d0a 2020 2020 2020 2020  _wait(..        
+00010e80: 2020 2020 6e6f 6465 2c20 7761 6974 5f74      node, wait_t
+00010e90: 696d 653d 7761 6974 5f74 696d 652c 2070  ime=wait_time, p
+00010ea0: 6f73 3d61 6464 5f61 6674 6572 5f69 6e64  os=add_after_ind
+00010eb0: 6578 286e 6f64 6529 2c20 2a2a 6b77 6172  ex(node), **kwar
+00010ec0: 6773 0d0a 2020 2020 2020 2020 290d 0a0d  gs..        )...
+00010ed0: 0a20 2020 2040 7472 6565 5f73 7562 6d65  .    @tree_subme
+00010ee0: 6e75 285f 2822 496e 7365 7274 2073 7065  nu(_("Insert spe
+00010ef0: 6369 616c 206f 7065 7261 7469 6f6e 2873  cial operation(s
+00010f00: 2922 2929 0d0a 2020 2020 4074 7265 655f  )"))..    @tree_
+00010f10: 6f70 6572 6174 696f 6e28 5f28 2241 6464  operation(_("Add
+00010f20: 204f 7574 7075 7422 292c 206e 6f64 655f   Output"), node_
+00010f30: 7479 7065 3d6f 705f 6e6f 6465 732c 2068  type=op_nodes, h
+00010f40: 656c 703d 2222 290d 0a20 2020 2064 6566  elp="")..    def
+00010f50: 2061 6464 5f6f 7065 7261 7469 6f6e 5f6f   add_operation_o
+00010f60: 7574 7075 7428 6e6f 6465 2c20 2a2a 6b77  utput(node, **kw
+00010f70: 6172 6773 293a 0d0a 2020 2020 2020 2020  args):..        
+00010f80: 6170 7065 6e64 5f6f 7065 7261 7469 6f6e  append_operation
+00010f90: 5f6f 7574 7075 7428 6e6f 6465 2c20 706f  _output(node, po
+00010fa0: 733d 6164 645f 6166 7465 725f 696e 6465  s=add_after_inde
+00010fb0: 7828 6e6f 6465 292c 202a 2a6b 7761 7267  x(node), **kwarg
+00010fc0: 7329 0d0a 0d0a 2020 2020 4074 7265 655f  s)....    @tree_
+00010fd0: 7375 626d 656e 7528 5f28 2249 6e73 6572  submenu(_("Inser
+00010fe0: 7420 7370 6563 6961 6c20 6f70 6572 6174  t special operat
+00010ff0: 696f 6e28 7329 2229 290d 0a20 2020 2040  ion(s)"))..    @
+00011000: 7472 6565 5f6f 7065 7261 7469 6f6e 285f  tree_operation(_
+00011010: 2822 4164 6420 496e 7075 7422 292c 206e  ("Add Input"), n
+00011020: 6f64 655f 7479 7065 3d6f 705f 6e6f 6465  ode_type=op_node
+00011030: 732c 2068 656c 703d 2222 290d 0a20 2020  s, help="")..   
+00011040: 2064 6566 2061 6464 5f6f 7065 7261 7469   def add_operati
+00011050: 6f6e 5f69 6e70 7574 286e 6f64 652c 202a  on_input(node, *
+00011060: 2a6b 7761 7267 7329 3a0d 0a20 2020 2020  *kwargs):..     
+00011070: 2020 2061 7070 656e 645f 6f70 6572 6174     append_operat
+00011080: 696f 6e5f 696e 7075 7428 6e6f 6465 2c20  ion_input(node, 
+00011090: 706f 733d 6164 645f 6166 7465 725f 696e  pos=add_after_in
+000110a0: 6465 7828 6e6f 6465 292c 202a 2a6b 7761  dex(node), **kwa
+000110b0: 7267 7329 0d0a 0d0a 2020 2020 4074 7265  rgs)....    @tre
+000110c0: 655f 7375 626d 656e 7528 5f28 2249 6e73  e_submenu(_("Ins
+000110d0: 6572 7420 7370 6563 6961 6c20 6f70 6572  ert special oper
+000110e0: 6174 696f 6e28 7329 2229 290d 0a20 2020  ation(s)"))..   
+000110f0: 2040 7472 6565 5f6f 7065 7261 7469 6f6e   @tree_operation
+00011100: 285f 2822 4164 6420 486f 6d65 2f42 6565  (_("Add Home/Bee
+00011110: 702f 496e 7465 7272 7570 7422 292c 206e  p/Interrupt"), n
+00011120: 6f64 655f 7479 7065 3d6f 705f 6e6f 6465  ode_type=op_node
+00011130: 732c 2068 656c 703d 2222 290d 0a20 2020  s, help="")..   
+00011140: 2064 6566 2061 6464 5f6f 7065 7261 7469   def add_operati
+00011150: 6f6e 5f68 6f6d 655f 6265 6570 5f69 6e74  on_home_beep_int
+00011160: 6572 7275 7074 286e 6f64 652c 202a 2a6b  errupt(node, **k
+00011170: 7761 7267 7329 3a0d 0a20 2020 2020 2020  wargs):..       
+00011180: 2070 6f73 203d 2061 6464 5f61 6674 6572   pos = add_after
+00011190: 5f69 6e64 6578 286e 6f64 6529 0d0a 2020  _index(node)..  
+000111a0: 2020 2020 2020 6170 7065 6e64 5f6f 7065        append_ope
+000111b0: 7261 7469 6f6e 5f68 6f6d 6528 6e6f 6465  ration_home(node
+000111c0: 2c20 706f 733d 706f 732c 202a 2a6b 7761  , pos=pos, **kwa
+000111d0: 7267 7329 0d0a 2020 2020 2020 2020 6966  rgs)..        if
+000111e0: 2070 6f73 3a0d 0a20 2020 2020 2020 2020   pos:..         
+000111f0: 2020 2070 6f73 202b 3d20 310d 0a20 2020     pos += 1..   
+00011200: 2020 2020 2061 7070 656e 645f 6f70 6572       append_oper
+00011210: 6174 696f 6e5f 6265 6570 286e 6f64 652c  ation_beep(node,
+00011220: 2070 6f73 3d70 6f73 2c20 2a2a 6b77 6172   pos=pos, **kwar
+00011230: 6773 290d 0a20 2020 2020 2020 2069 6620  gs)..        if 
+00011240: 706f 733a 0d0a 2020 2020 2020 2020 2020  pos:..          
+00011250: 2020 706f 7320 2b3d 2031 0d0a 2020 2020    pos += 1..    
+00011260: 2020 2020 6170 7065 6e64 5f6f 7065 7261      append_opera
+00011270: 7469 6f6e 5f69 6e74 6572 7275 7074 286e  tion_interrupt(n
+00011280: 6f64 652c 2070 6f73 3d70 6f73 2c20 2a2a  ode, pos=pos, **
+00011290: 6b77 6172 6773 290d 0a0d 0a20 2020 2040  kwargs)....    @
+000112a0: 7472 6565 5f73 7562 6d65 6e75 285f 2822  tree_submenu(_("
+000112b0: 496e 7365 7274 2073 7065 6369 616c 206f  Insert special o
+000112c0: 7065 7261 7469 6f6e 2873 2922 2929 0d0a  peration(s)"))..
+000112d0: 2020 2020 4074 7265 655f 6f70 6572 6174      @tree_operat
+000112e0: 696f 6e28 5f28 2241 6464 204f 7269 6769  ion(_("Add Origi
+000112f0: 6e2f 4265 6570 2f49 6e74 6572 7275 7074  n/Beep/Interrupt
+00011300: 2229 2c20 6e6f 6465 5f74 7970 653d 6f70  "), node_type=op
+00011310: 5f6e 6f64 6573 2c20 6865 6c70 3d22 2229  _nodes, help="")
+00011320: 0d0a 2020 2020 6465 6620 6164 645f 6f70  ..    def add_op
+00011330: 6572 6174 696f 6e5f 6f72 6967 696e 5f62  eration_origin_b
+00011340: 6565 705f 696e 7465 7272 7570 7428 6e6f  eep_interrupt(no
+00011350: 6465 2c20 2a2a 6b77 6172 6773 293a 0d0a  de, **kwargs):..
+00011360: 2020 2020 2020 2020 706f 7320 3d20 6164          pos = ad
+00011370: 645f 6166 7465 725f 696e 6465 7828 6e6f  d_after_index(no
+00011380: 6465 290d 0a20 2020 2020 2020 2061 7070  de)..        app
+00011390: 656e 645f 6f70 6572 6174 696f 6e5f 676f  end_operation_go
+000113a0: 746f 286e 6f64 652c 2070 6f73 3d70 6f73  to(node, pos=pos
+000113b0: 2c20 2a2a 6b77 6172 6773 290d 0a20 2020  , **kwargs)..   
+000113c0: 2020 2020 2069 6620 706f 733a 0d0a 2020       if pos:..  
+000113d0: 2020 2020 2020 2020 2020 706f 7320 2b3d            pos +=
+000113e0: 2031 0d0a 2020 2020 2020 2020 6170 7065   1..        appe
+000113f0: 6e64 5f6f 7065 7261 7469 6f6e 5f62 6565  nd_operation_bee
+00011400: 7028 6e6f 6465 2c20 706f 733d 706f 732c  p(node, pos=pos,
+00011410: 202a 2a6b 7761 7267 7329 0d0a 2020 2020   **kwargs)..    
+00011420: 2020 2020 6966 2070 6f73 3a0d 0a20 2020      if pos:..   
+00011430: 2020 2020 2020 2020 2070 6f73 202b 3d20           pos += 
+00011440: 310d 0a20 2020 2020 2020 2061 7070 656e  1..        appen
+00011450: 645f 6f70 6572 6174 696f 6e5f 696e 7465  d_operation_inte
+00011460: 7272 7570 7428 6e6f 6465 2c20 706f 733d  rrupt(node, pos=
+00011470: 706f 732c 202a 2a6b 7761 7267 7329 0d0a  pos, **kwargs)..
+00011480: 0d0a 2020 2020 4074 7265 655f 6f70 6572  ..    @tree_oper
+00011490: 6174 696f 6e28 5f28 2252 656c 6f61 6420  ation(_("Reload 
+000114a0: 277b 6e61 6d65 7d27 2229 2c20 6e6f 6465  '{name}'"), node
+000114b0: 5f74 7970 653d 2266 696c 6522 2c20 6865  _type="file", he
+000114c0: 6c70 3d22 2229 0d0a 2020 2020 6465 6620  lp="")..    def 
+000114d0: 7265 6c6f 6164 5f66 696c 6528 6e6f 6465  reload_file(node
+000114e0: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
+000114f0: 2020 2020 2020 6669 6c65 7061 7468 203d        filepath =
+00011500: 206e 6f64 652e 6669 6c65 7061 7468 0d0a   node.filepath..
+00011510: 2020 2020 2020 2020 6e6f 6465 2e72 656d          node.rem
+00011520: 6f76 655f 6e6f 6465 2829 0d0a 2020 2020  ove_node()..    
+00011530: 2020 2020 7365 6c66 2e6c 6f61 6428 6669      self.load(fi
+00011540: 6c65 7061 7468 290d 0a0d 0a20 2020 2040  lepath)....    @
+00011550: 7472 6565 5f6f 7065 7261 7469 6f6e 280d  tree_operation(.
+00011560: 0a20 2020 2020 2020 205f 2822 4f70 656e  .        _("Open
+00011570: 2069 6e20 5379 7374 656d 3a20 277b 6e61   in System: '{na
+00011580: 6d65 7d27 2229 2c0d 0a20 2020 2020 2020  me}'"),..       
+00011590: 206e 6f64 655f 7479 7065 3d22 6669 6c65   node_type="file
+000115a0: 222c 0d0a 2020 2020 2020 2020 6865 6c70  ",..        help
+000115b0: 3d5f 280d 0a20 2020 2020 2020 2020 2020  =_(..           
+000115c0: 2022 4f70 656e 2074 6869 7320 6669 6c65   "Open this file
+000115d0: 2069 6e20 7468 6520 7379 7374 656d 2061   in the system a
+000115e0: 7070 6c69 6361 7469 6f6e 2061 7373 6f63  pplication assoc
+000115f0: 6961 7465 6420 7769 7468 2074 6869 7320  iated with this 
+00011600: 7479 7065 206f 6620 6669 6c65 220d 0a20  type of file".. 
+00011610: 2020 2020 2020 2029 2c0d 0a20 2020 2029         ),..    )
+00011620: 0d0a 2020 2020 6465 6620 6f70 656e 5f73  ..    def open_s
+00011630: 7973 7465 6d5f 6669 6c65 286e 6f64 652c  ystem_file(node,
+00011640: 202a 2a6b 7761 7267 7329 3a0d 0a20 2020   **kwargs):..   
+00011650: 2020 2020 2066 696c 6570 6174 6820 3d20       filepath = 
+00011660: 6e6f 6465 2e66 696c 6570 6174 680d 0a20  node.filepath.. 
+00011670: 2020 2020 2020 206e 6f72 6d61 6c69 7a65         normalize
+00011680: 6420 3d20 6f73 2e70 6174 682e 7265 616c  d = os.path.real
+00011690: 7061 7468 2866 696c 6570 6174 6829 0d0a  path(filepath)..
+000116a0: 0d0a 2020 2020 2020 2020 696d 706f 7274  ..        import
+000116b0: 2070 6c61 7466 6f72 6d0d 0a0d 0a20 2020   platform....   
+000116c0: 2020 2020 2073 7973 7465 6d20 3d20 706c       system = pl
+000116d0: 6174 666f 726d 2e73 7973 7465 6d28 290d  atform.system().
+000116e0: 0a20 2020 2020 2020 2069 6620 7379 7374  .        if syst
+000116f0: 656d 203d 3d20 2244 6172 7769 6e22 3a0d  em == "Darwin":.
+00011700: 0a20 2020 2020 2020 2020 2020 2066 726f  .            fro
+00011710: 6d20 6f73 2069 6d70 6f72 7420 7379 7374  m os import syst
+00011720: 656d 2061 7320 6f70 656e 5f69 6e5f 7368  em as open_in_sh
+00011730: 656c 6c0d 0a0d 0a20 2020 2020 2020 2020  ell....         
+00011740: 2020 206f 7065 6e5f 696e 5f73 6865 6c6c     open_in_shell
+00011750: 2866 226f 7065 6e20 277b 6e6f 726d 616c  (f"open '{normal
+00011760: 697a 6564 7d27 2229 0d0a 2020 2020 2020  ized}'")..      
+00011770: 2020 656c 6966 2073 7973 7465 6d20 3d3d    elif system ==
+00011780: 2022 5769 6e64 6f77 7322 3a0d 0a20 2020   "Windows":..   
+00011790: 2020 2020 2020 2020 2066 726f 6d20 6f73           from os
+000117a0: 2069 6d70 6f72 7420 7374 6172 7466 696c   import startfil
+000117b0: 6520 6173 206f 7065 6e5f 696e 5f73 6865  e as open_in_she
+000117c0: 6c6c 0d0a 0d0a 2020 2020 2020 2020 2020  ll....          
+000117d0: 2020 6f70 656e 5f69 6e5f 7368 656c 6c28    open_in_shell(
+000117e0: 6627 227b 6e6f 726d 616c 697a 6564 7d22  f'"{normalized}"
+000117f0: 2729 0d0a 2020 2020 2020 2020 656c 7365  ')..        else
+00011800: 3a0d 0a20 2020 2020 2020 2020 2020 2066  :..            f
+00011810: 726f 6d20 6f73 2069 6d70 6f72 7420 7379  rom os import sy
+00011820: 7374 656d 2061 7320 6f70 656e 5f69 6e5f  stem as open_in_
+00011830: 7368 656c 6c0d 0a0d 0a20 2020 2020 2020  shell....       
+00011840: 2020 2020 206f 7065 6e5f 696e 5f73 6865       open_in_she
+00011850: 6c6c 2866 2278 6467 2d6f 7065 6e20 277b  ll(f"xdg-open '{
+00011860: 6e6f 726d 616c 697a 6564 7d27 2229 0d0a  normalized}'")..
+00011870: 0d0a 2020 2020 6465 6620 6765 745f 7661  ..    def get_va
+00011880: 6c75 6573 2829 3a0d 0a20 2020 2020 2020  lues():..       
+00011890: 2072 6574 7572 6e20 5b6f 2066 6f72 206f   return [o for o
+000118a0: 2069 6e20 7365 6c66 2e6f 7073 2829 2069   in self.ops() i
+000118b0: 6620 6f2e 7479 7065 2e73 7461 7274 7377  f o.type.startsw
+000118c0: 6974 6828 226f 7022 295d 0d0a 0d0a 2020  ith("op")]....  
+000118d0: 2020 4074 7265 655f 636f 6e64 6974 696f    @tree_conditio
+000118e0: 6e61 6c28 6c61 6d62 6461 206e 6f64 653a  nal(lambda node:
+000118f0: 206e 6f74 2069 735f 7265 676d 6172 6b28   not is_regmark(
+00011900: 6e6f 6465 2929 0d0a 2020 2020 4074 7265  node))..    @tre
+00011910: 655f 7375 626d 656e 7528 5f28 2241 7373  e_submenu(_("Ass
+00011920: 6967 6e20 4f70 6572 6174 696f 6e22 2929  ign Operation"))
+00011930: 0d0a 2020 2020 4074 7265 655f 7661 6c75  ..    @tree_valu
+00011940: 6573 2822 6f70 5f61 7373 6967 6e22 2c20  es("op_assign", 
+00011950: 7661 6c75 6573 3d67 6574 5f76 616c 7565  values=get_value
+00011960: 7329 0d0a 2020 2020 4074 7265 655f 6f70  s)..    @tree_op
+00011970: 6572 6174 696f 6e28 227b 6f70 5f61 7373  eration("{op_ass
+00011980: 6967 6e7d 222c 206e 6f64 655f 7479 7065  ign}", node_type
+00011990: 3d65 6c65 6d5f 6e6f 6465 732c 2068 656c  =elem_nodes, hel
+000119a0: 703d 2222 290d 0a20 2020 2064 6566 206d  p="")..    def m
+000119b0: 656e 755f 6173 7369 676e 5f6f 7065 7261  enu_assign_opera
+000119c0: 7469 6f6e 7328 6e6f 6465 2c20 6f70 5f61  tions(node, op_a
+000119d0: 7373 6967 6e2c 202a 2a6b 7761 7267 7329  ssign, **kwargs)
+000119e0: 3a0d 0a20 2020 2020 2020 2069 6620 7365  :..        if se
+000119f0: 6c66 2e63 6c61 7373 6966 795f 696e 6865  lf.classify_inhe
+00011a00: 7269 745f 7374 726f 6b65 3a0d 0a20 2020  rit_stroke:..   
+00011a10: 2020 2020 2020 2020 2069 6d70 6f73 6520           impose 
+00011a20: 3d20 2274 6f5f 6f70 220d 0a20 2020 2020  = "to_op"..     
+00011a30: 2020 2020 2020 2061 7474 7269 6220 3d20         attrib = 
+00011a40: 2273 7472 6f6b 6522 0d0a 2020 2020 2020  "stroke"..      
+00011a50: 2020 2020 2020 7369 6d69 6c61 7220 3d20        similar = 
+00011a60: 5472 7565 0d0a 2020 2020 2020 2020 656c  True..        el
+00011a70: 6966 2073 656c 662e 636c 6173 7369 6679  if self.classify
+00011a80: 5f69 6e68 6572 6974 5f66 696c 6c3a 0d0a  _inherit_fill:..
+00011a90: 2020 2020 2020 2020 2020 2020 696d 706f              impo
+00011aa0: 7365 203d 2022 746f 5f6f 7022 0d0a 2020  se = "to_op"..  
+00011ab0: 2020 2020 2020 2020 2020 6174 7472 6962            attrib
+00011ac0: 203d 2022 6669 6c6c 220d 0a20 2020 2020   = "fill"..     
+00011ad0: 2020 2020 2020 2073 696d 696c 6172 203d         similar =
+00011ae0: 2054 7275 650d 0a20 2020 2020 2020 2065   True..        e
+00011af0: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+00011b00: 2020 696d 706f 7365 203d 204e 6f6e 650d    impose = None.
+00011b10: 0a20 2020 2020 2020 2020 2020 2061 7474  .            att
+00011b20: 7269 6220 3d20 4e6f 6e65 0d0a 2020 2020  rib = None..    
+00011b30: 2020 2020 2020 2020 7369 6d69 6c61 7220          similar 
+00011b40: 3d20 4661 6c73 650d 0a20 2020 2020 2020  = False..       
+00011b50: 2065 7863 6c75 7369 7665 203d 2073 656c   exclusive = sel
+00011b60: 662e 636c 6173 7369 6679 5f69 6e68 6572  f.classify_inher
+00011b70: 6974 5f65 7863 6c75 7369 7665 0d0a 2020  it_exclusive..  
+00011b80: 2020 2020 2020 6461 7461 203d 206c 6973        data = lis
+00011b90: 7428 7365 6c66 2e65 6c65 6d73 2865 6d70  t(self.elems(emp
+00011ba0: 6861 7369 7a65 643d 5472 7565 2929 0d0a  hasized=True))..
+00011bb0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00011bc0: 6967 6e5f 6f70 6572 6174 696f 6e28 0d0a  ign_operation(..
+00011bd0: 2020 2020 2020 2020 2020 2020 6f70 5f61              op_a
+00011be0: 7373 6967 6e3d 6f70 5f61 7373 6967 6e2c  ssign=op_assign,
+00011bf0: 0d0a 2020 2020 2020 2020 2020 2020 6461  ..            da
+00011c00: 7461 3d64 6174 612c 0d0a 2020 2020 2020  ta=data,..      
+00011c10: 2020 2020 2020 696d 706f 7365 3d69 6d70        impose=imp
+00011c20: 6f73 652c 0d0a 2020 2020 2020 2020 2020  ose,..          
+00011c30: 2020 6174 7472 6962 3d61 7474 7269 622c    attrib=attrib,
+00011c40: 0d0a 2020 2020 2020 2020 2020 2020 7369  ..            si
+00011c50: 6d69 6c61 723d 7369 6d69 6c61 722c 0d0a  milar=similar,..
+00011c60: 2020 2020 2020 2020 2020 2020 6578 636c              excl
+00011c70: 7573 6976 653d 6578 636c 7573 6976 652c  usive=exclusive,
+00011c80: 0d0a 2020 2020 2020 2020 290d 0a0d 0a20  ..        ).... 
+00011c90: 2020 2064 6566 2065 7863 6c75 7369 7665     def exclusive
+00011ca0: 5f6d 6174 6368 286e 6f64 652c 202a 2a6b  _match(node, **k
+00011cb0: 7761 7267 7329 3a0d 0a20 2020 2020 2020  wargs):..       
+00011cc0: 2072 6574 7572 6e20 7365 6c66 2e63 6c61   return self.cla
+00011cd0: 7373 6966 795f 696e 6865 7269 745f 6578  ssify_inherit_ex
+00011ce0: 636c 7573 6976 650d 0a0d 0a20 2020 2040  clusive....    @
+00011cf0: 7472 6565 5f73 6570 6172 6174 6f72 5f62  tree_separator_b
+00011d00: 6566 6f72 6528 290d 0a20 2020 2040 7472  efore()..    @tr
+00011d10: 6565 5f73 7562 6d65 6e75 285f 2822 4173  ee_submenu(_("As
+00011d20: 7369 676e 204f 7065 7261 7469 6f6e 2229  sign Operation")
+00011d30: 290d 0a20 2020 2040 7472 6565 5f6f 7065  )..    @tree_ope
+00011d40: 7261 7469 6f6e 280d 0a20 2020 2020 2020  ration(..       
+00011d50: 205f 2822 5265 6d6f 7665 2061 6c6c 2061   _("Remove all a
+00011d60: 7373 6967 6e6d 656e 7473 2066 726f 6d20  ssignments from 
+00011d70: 6f70 6572 6174 696f 6e73 2229 2c0d 0a20  operations"),.. 
+00011d80: 2020 2020 2020 206e 6f64 655f 7479 7065         node_type
+00011d90: 3d65 6c65 6d5f 6772 6f75 705f 6e6f 6465  =elem_group_node
+00011da0: 732c 0d0a 2020 2020 2020 2020 6865 6c70  s,..        help
+00011db0: 3d5f 2822 416e 7920 6578 6973 7469 6e67  =_("Any existing
+00011dc0: 2061 7373 6967 6e6d 656e 7420 6f66 2074   assignment of t
+00011dd0: 6869 7320 656c 656d 656e 7420 746f 206f  his element to o
+00011de0: 7065 7261 7469 6f6e 7320 7769 6c6c 2062  perations will b
+00011df0: 6520 7265 6d6f 7665 6422 292c 0d0a 2020  e removed"),..  
+00011e00: 2020 290d 0a20 2020 2064 6566 2072 656d    )..    def rem
+00011e10: 6f76 655f 6173 7369 676e 6d65 6e74 7328  ove_assignments(
+00011e20: 7369 6e67 6c65 6e6f 6465 2c20 2a2a 6b77  singlenode, **kw
+00011e30: 6172 6773 293a 0d0a 2020 2020 2020 2020  args):..        
+00011e40: 6465 6620 7265 6d5f 6e6f 6465 2872 6e6f  def rem_node(rno
+00011e50: 6465 293a 0d0a 2020 2020 2020 2020 2020  de):..          
+00011e60: 2020 2320 7265 6375 7273 6976 656c 7920    # recursively 
+00011e70: 7265 6d6f 7665 2061 7373 6967 6e6d 656e  remove assignmen
+00011e80: 7473 2e2e 2e0d 0a20 2020 2020 2020 2020  ts.....         
+00011e90: 2020 2069 6620 726e 6f64 652e 7479 7065     if rnode.type
+00011ea0: 2069 6e20 2822 6669 6c65 222c 2022 6772   in ("file", "gr
+00011eb0: 6f75 7022 293a 0d0a 2020 2020 2020 2020  oup"):..        
+00011ec0: 2020 2020 2020 2020 666f 7220 636e 6f64          for cnod
+00011ed0: 6520 696e 206c 6973 7428 726e 6f64 652e  e in list(rnode.
+00011ee0: 5f63 6869 6c64 7265 6e29 3a0d 0a20 2020  _children):..   
+00011ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011f00: 2072 656d 5f6e 6f64 6528 636e 6f64 6529   rem_node(cnode)
+00011f10: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
+00011f20: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+00011f30: 2020 2020 2066 6f72 2072 6566 2069 6e20       for ref in 
+00011f40: 6c69 7374 2872 6e6f 6465 2e72 6566 6572  list(rnode.refer
+00011f50: 656e 6365 7329 3a0d 0a20 2020 2020 2020  ences):..       
+00011f60: 2020 2020 2020 2020 2020 2020 2072 6566               ref
+00011f70: 2e72 656d 6f76 655f 6e6f 6465 2829 0d0a  .remove_node()..
+00011f80: 0d0a 2020 2020 2020 2020 7769 7468 2073  ..        with s
+00011f90: 656c 662e 7374 6174 6963 2822 7265 6d6f  elf.static("remo
+00011fa0: 7665 5f61 7373 6967 6e22 293a 0d0a 2020  ve_assign"):..  
+00011fb0: 2020 2020 2020 2020 2020 666f 7220 6e6f            for no
+00011fc0: 6465 2069 6e20 6c69 7374 2873 656c 662e  de in list(self.
+00011fd0: 656c 656d 7328 656d 7068 6173 697a 6564  elems(emphasized
+00011fe0: 3d54 7275 6529 293a 0d0a 2020 2020 2020  =True)):..      
+00011ff0: 2020 2020 2020 2020 2020 7265 6d5f 6e6f            rem_no
+00012000: 6465 286e 6f64 6529 0d0a 2020 2020 2020  de(node)..      
+00012010: 2020 7365 6c66 2e73 6967 6e61 6c28 2272    self.signal("r
+00012020: 6566 7265 7368 5f74 7265 6522 290d 0a0d  efresh_tree")...
+00012030: 0a20 2020 2040 7472 6565 5f73 6570 6172  .    @tree_separ
+00012040: 6174 6f72 5f62 6566 6f72 6528 290d 0a20  ator_before().. 
+00012050: 2020 2040 7472 6565 5f73 7562 6d65 6e75     @tree_submenu
+00012060: 285f 2822 4173 7369 676e 204f 7065 7261  (_("Assign Opera
+00012070: 7469 6f6e 2229 290d 0a20 2020 2040 7472  tion"))..    @tr
+00012080: 6565 5f63 6865 636b 2865 7863 6c75 7369  ee_check(exclusi
+00012090: 7665 5f6d 6174 6368 290d 0a20 2020 2040  ve_match)..    @
+000120a0: 7472 6565 5f6f 7065 7261 7469 6f6e 280d  tree_operation(.
+000120b0: 0a20 2020 2020 2020 205f 2822 4578 636c  .        _("Excl
+000120c0: 7573 6976 6520 6173 7369 676e 6d65 6e74  usive assignment
+000120d0: 2229 2c0d 0a20 2020 2020 2020 206e 6f64  "),..        nod
+000120e0: 655f 7479 7065 3d65 6c65 6d5f 6e6f 6465  e_type=elem_node
+000120f0: 732c 0d0a 2020 2020 2020 2020 6865 6c70  s,..        help
+00012100: 3d5f 280d 0a20 2020 2020 2020 2020 2020  =_(..           
+00012110: 2022 416e 2061 7373 6967 6e6d 656e 7420   "An assignment 
+00012120: 7769 6c6c 2072 656d 6f76 6520 616c 6c20  will remove all 
+00012130: 6f74 6865 7220 636c 6173 7369 6669 6361  other classifica
+00012140: 7469 6f6e 7320 6f66 2074 6869 7320 656c  tions of this el
+00012150: 656d 656e 7420 6966 2063 6865 636b 6564  ement if checked
+00012160: 220d 0a20 2020 2020 2020 2029 2c0d 0a20  "..        ),.. 
+00012170: 2020 2029 0d0a 2020 2020 6465 6620 7365     )..    def se
+00012180: 745f 6173 7369 676e 5f6f 7074 696f 6e5f  t_assign_option_
+00012190: 6578 636c 7573 6976 6528 6e6f 6465 2c20  exclusive(node, 
+000121a0: 2a2a 6b77 6172 6773 293a 0d0a 2020 2020  **kwargs):..    
+000121b0: 2020 2020 7365 6c66 2e63 6c61 7373 6966      self.classif
+000121c0: 795f 696e 6865 7269 745f 6578 636c 7573  y_inherit_exclus
+000121d0: 6976 6520 3d20 6e6f 7420 7365 6c66 2e63  ive = not self.c
+000121e0: 6c61 7373 6966 795f 696e 6865 7269 745f  lassify_inherit_
+000121f0: 6578 636c 7573 6976 650d 0a0d 0a20 2020  exclusive....   
+00012200: 2064 6566 2073 7472 6f6b 655f 6d61 7463   def stroke_matc
+00012210: 6828 6e6f 6465 2c20 2a2a 6b77 6172 6773  h(node, **kwargs
+00012220: 293a 0d0a 2020 2020 2020 2020 7265 7475  ):..        retu
+00012230: 726e 2073 656c 662e 636c 6173 7369 6679  rn self.classify
+00012240: 5f69 6e68 6572 6974 5f73 7472 6f6b 650d  _inherit_stroke.
+00012250: 0a0d 0a20 2020 2040 7472 6565 5f73 6570  ...    @tree_sep
+00012260: 6172 6174 6f72 5f62 6566 6f72 6528 290d  arator_before().
+00012270: 0a20 2020 2040 7472 6565 5f73 7562 6d65  .    @tree_subme
+00012280: 6e75 285f 2822 4173 7369 676e 204f 7065  nu(_("Assign Ope
+00012290: 7261 7469 6f6e 2229 290d 0a20 2020 2040  ration"))..    @
+000122a0: 7472 6565 5f63 6865 636b 2873 7472 6f6b  tree_check(strok
+000122b0: 655f 6d61 7463 6829 0d0a 2020 2020 4074  e_match)..    @t
+000122c0: 7265 655f 6f70 6572 6174 696f 6e28 0d0a  ree_operation(..
+000122d0: 2020 2020 2020 2020 5f28 2249 6e68 6572          _("Inher
+000122e0: 6974 2073 7472 6f6b 6520 616e 6420 636c  it stroke and cl
+000122f0: 6173 7369 6679 2073 696d 696c 6172 2229  assify similar")
+00012300: 2c0d 0a20 2020 2020 2020 206e 6f64 655f  ,..        node_
+00012310: 7479 7065 3d65 6c65 6d5f 6e6f 6465 732c  type=elem_nodes,
+00012320: 0d0a 2020 2020 2020 2020 6865 6c70 3d5f  ..        help=_
+00012330: 2822 4f70 6572 6174 696f 6e20 7769 6c6c  ("Operation will
+00012340: 2069 6e68 6572 6974 2065 6c65 6d65 6e74   inherit element
+00012350: 2073 7472 6f6b 6520 636f 6c6f 7222 292c   stroke color"),
+00012360: 0d0a 2020 2020 290d 0a20 2020 2064 6566  ..    )..    def
+00012370: 2073 6574 5f61 7373 6967 6e5f 6f70 7469   set_assign_opti
+00012380: 6f6e 5f73 7472 6f6b 6528 6e6f 6465 2c20  on_stroke(node, 
+00012390: 2a2a 6b77 6172 6773 293a 0d0a 2020 2020  **kwargs):..    
+000123a0: 2020 2020 7365 6c66 2e63 6c61 7373 6966      self.classif
+000123b0: 795f 696e 6865 7269 745f 7374 726f 6b65  y_inherit_stroke
+000123c0: 203d 206e 6f74 2073 656c 662e 636c 6173   = not self.clas
+000123d0: 7369 6679 5f69 6e68 6572 6974 5f73 7472  sify_inherit_str
+000123e0: 6f6b 650d 0a20 2020 2020 2020 2023 2050  oke..        # P
+000123f0: 6f6f 7220 6d61 6e73 2072 6164 696f 0d0a  oor mans radio..
+00012400: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00012410: 636c 6173 7369 6679 5f69 6e68 6572 6974  classify_inherit
+00012420: 5f73 7472 6f6b 653a 0d0a 2020 2020 2020  _stroke:..      
+00012430: 2020 2020 2020 7365 6c66 2e63 6c61 7373        self.class
+00012440: 6966 795f 696e 6865 7269 745f 6669 6c6c  ify_inherit_fill
+00012450: 203d 2046 616c 7365 0d0a 0d0a 2020 2020   = False....    
+00012460: 6465 6620 6669 6c6c 5f6d 6174 6368 286e  def fill_match(n
+00012470: 6f64 652c 202a 2a6b 7761 7267 7329 3a0d  ode, **kwargs):.
+00012480: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00012490: 7365 6c66 2e63 6c61 7373 6966 795f 696e  self.classify_in
+000124a0: 6865 7269 745f 6669 6c6c 0d0a 0d0a 2020  herit_fill....  
+000124b0: 2020 4074 7265 655f 7375 626d 656e 7528    @tree_submenu(
+000124c0: 5f28 2241 7373 6967 6e20 4f70 6572 6174  _("Assign Operat
+000124d0: 696f 6e22 2929 0d0a 2020 2020 4074 7265  ion"))..    @tre
+000124e0: 655f 6368 6563 6b28 6669 6c6c 5f6d 6174  e_check(fill_mat
+000124f0: 6368 290d 0a20 2020 2040 7472 6565 5f6f  ch)..    @tree_o
+00012500: 7065 7261 7469 6f6e 280d 0a20 2020 2020  peration(..     
+00012510: 2020 205f 2822 496e 6865 7269 7420 6669     _("Inherit fi
+00012520: 6c6c 2061 6e64 2063 6c61 7373 6966 7920  ll and classify 
+00012530: 7369 6d69 6c61 7222 292c 0d0a 2020 2020  similar"),..    
+00012540: 2020 2020 6e6f 6465 5f74 7970 653d 656c      node_type=el
+00012550: 656d 5f6e 6f64 6573 2c0d 0a20 2020 2020  em_nodes,..     
+00012560: 2020 2068 656c 703d 5f28 224f 7065 7261     help=_("Opera
+00012570: 7469 6f6e 2077 696c 6c20 696e 6865 7269  tion will inheri
+00012580: 7420 656c 656d 656e 7420 6669 6c6c 2063  t element fill c
+00012590: 6f6c 6f72 2229 2c0d 0a20 2020 2029 0d0a  olor"),..    )..
+000125a0: 2020 2020 6465 6620 7365 745f 6173 7369      def set_assi
+000125b0: 676e 5f6f 7074 696f 6e5f 6669 6c6c 286e  gn_option_fill(n
+000125c0: 6f64 652c 202a 2a6b 7761 7267 7329 3a0d  ode, **kwargs):.
+000125d0: 0a20 2020 2020 2020 2073 656c 662e 636c  .        self.cl
+000125e0: 6173 7369 6679 5f69 6e68 6572 6974 5f66  assify_inherit_f
+000125f0: 696c 6c20 3d20 6e6f 7420 7365 6c66 2e63  ill = not self.c
+00012600: 6c61 7373 6966 795f 696e 6865 7269 745f  lassify_inherit_
+00012610: 6669 6c6c 0d0a 2020 2020 2020 2020 2320  fill..        # 
+00012620: 506f 6f72 206d 616e 7320 7261 6469 6f0d  Poor mans radio.
+00012630: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+00012640: 2e63 6c61 7373 6966 795f 696e 6865 7269  .classify_inheri
+00012650: 745f 6669 6c6c 3a0d 0a20 2020 2020 2020  t_fill:..       
+00012660: 2020 2020 2073 656c 662e 636c 6173 7369       self.classi
+00012670: 6679 5f69 6e68 6572 6974 5f73 7472 6f6b  fy_inherit_strok
+00012680: 6520 3d20 4661 6c73 650d 0a0d 0a20 2020  e = False....   
+00012690: 2040 7472 6565 5f63 6f6e 6469 7469 6f6e   @tree_condition
+000126a0: 616c 286c 616d 6264 6120 6e6f 6465 3a20  al(lambda node: 
+000126b0: 6e6f 7420 6973 5f72 6567 6d61 726b 286e  not is_regmark(n
+000126c0: 6f64 6529 290d 0a20 2020 2040 7472 6565  ode))..    @tree
+000126d0: 5f73 7562 6d65 6e75 285f 2822 4475 706c  _submenu(_("Dupl
+000126e0: 6963 6174 6520 656c 656d 656e 7428 7329  icate element(s)
+000126f0: 2229 290d 0a20 2020 2040 7472 6565 5f6f  "))..    @tree_o
+00012700: 7065 7261 7469 6f6e 285f 2822 4d61 6b65  peration(_("Make
+00012710: 2031 2063 6f70 7922 292c 206e 6f64 655f   1 copy"), node_
+00012720: 7479 7065 3d65 6c65 6d5f 6772 6f75 705f  type=elem_group_
+00012730: 6e6f 6465 732c 2068 656c 703d 2222 290d  nodes, help="").
+00012740: 0a20 2020 2064 6566 2064 7570 6c69 6361  .    def duplica
+00012750: 7465 5f65 6c65 6d65 6e74 5f31 286e 6f64  te_element_1(nod
+00012760: 652c 202a 2a6b 7761 7267 7329 3a0d 0a20  e, **kwargs):.. 
+00012770: 2020 2020 2020 2064 7570 6c69 6361 7465         duplicate
+00012780: 5f65 6c65 6d65 6e74 5f6e 286e 6f64 652c  _element_n(node,
+00012790: 2063 6f70 6965 733d 312c 202a 2a6b 7761   copies=1, **kwa
+000127a0: 7267 7329 0d0a 0d0a 2020 2020 4074 7265  rgs)....    @tre
+000127b0: 655f 636f 6e64 6974 696f 6e61 6c28 6c61  e_conditional(la
+000127c0: 6d62 6461 206e 6f64 653a 206e 6f74 2069  mbda node: not i
+000127d0: 735f 7265 676d 6172 6b28 6e6f 6465 2929  s_regmark(node))
+000127e0: 0d0a 2020 2020 4074 7265 655f 7375 626d  ..    @tree_subm
+000127f0: 656e 7528 5f28 2244 7570 6c69 6361 7465  enu(_("Duplicate
+00012800: 2065 6c65 6d65 6e74 2873 2922 2929 0d0a   element(s)"))..
+00012810: 2020 2020 4074 7265 655f 6974 6572 6174      @tree_iterat
+00012820: 6528 2263 6f70 6965 7322 2c20 322c 2031  e("copies", 2, 1
+00012830: 3029 0d0a 2020 2020 4074 7265 655f 6f70  0)..    @tree_op
+00012840: 6572 6174 696f 6e28 5f28 224d 616b 6520  eration(_("Make 
+00012850: 7b63 6f70 6965 737d 2063 6f70 6965 7322  {copies} copies"
+00012860: 292c 206e 6f64 655f 7479 7065 3d65 6c65  ), node_type=ele
+00012870: 6d5f 6772 6f75 705f 6e6f 6465 732c 2068  m_group_nodes, h
+00012880: 656c 703d 2222 290d 0a20 2020 2064 6566  elp="")..    def
+00012890: 2064 7570 6c69 6361 7465 5f65 6c65 6d65   duplicate_eleme
+000128a0: 6e74 5f6e 286e 6f64 652c 2063 6f70 6965  nt_n(node, copie
+000128b0: 732c 202a 2a6b 7761 7267 7329 3a0d 0a20  s, **kwargs):.. 
+000128c0: 2020 2020 2020 2064 6566 2063 6f70 795f         def copy_
+000128d0: 7369 6e67 6c65 5f6e 6f64 6528 6f72 676e  single_node(orgn
+000128e0: 6f64 652c 206f 7267 7061 7265 6e74 2c20  ode, orgparent, 
+000128f0: 7469 6d65 732c 2064 782c 2064 7929 3a0d  times, dx, dy):.
+00012900: 0a20 2020 2020 2020 2020 2020 2064 656c  .            del
+00012910: 7461 5f77 6f72 646c 6973 7420 3d20 300d  ta_wordlist = 0.
+00012920: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+00012930: 206e 2069 6e20 7261 6e67 6528 7469 6d65   n in range(time
+00012940: 7329 3a0d 0a20 2020 2020 2020 2020 2020  s):..           
+00012950: 2020 2020 2064 656c 7461 5f77 6f72 646c       delta_wordl
+00012960: 6973 7420 2b3d 2031 0d0a 0d0a 2020 2020  ist += 1....    
+00012970: 2020 2020 2020 2020 2020 2020 636f 7079              copy
+00012980: 5f6e 6f64 6520 3d20 636f 7079 286f 7267  _node = copy(org
+00012990: 6e6f 6465 290d 0a20 2020 2020 2020 2020  node)..         
+000129a0: 2020 2020 2020 2069 6620 6861 7361 7474         if hasatt
+000129b0: 7228 636f 7079 5f6e 6f64 652c 2022 6d61  r(copy_node, "ma
+000129c0: 7472 6978 2229 3a0d 0a20 2020 2020 2020  trix"):..       
+000129d0: 2020 2020 2020 2020 2020 2020 2063 6f70               cop
+000129e0: 795f 6e6f 6465 2e6d 6174 7269 7820 2a3d  y_node.matrix *=
+000129f0: 204d 6174 7269 782e 7472 616e 736c 6174   Matrix.translat
+00012a00: 6528 286e 202b 2031 2920 2a20 6478 2c20  e((n + 1) * dx, 
+00012a10: 286e 202b 2031 2920 2a20 6479 290d 0a20  (n + 1) * dy).. 
+00012a20: 2020 2020 2020 2020 2020 2020 2020 2068                 h
+00012a30: 6164 5f6f 7074 696f 6e61 6c20 3d20 4661  ad_optional = Fa
+00012a40: 6c73 650d 0a20 2020 2020 2020 2020 2020  lse..           
+00012a50: 2020 2020 2023 204e 6565 6420 746f 2061       # Need to a
+00012a60: 6464 2073 7472 6f6b 6520 616e 6420 6669  dd stroke and fi
+00012a70: 6c6c 2c20 6173 2063 6f70 7920 7769 6c6c  ll, as copy will
+00012a80: 2074 616b 6520 7468 650d 0a20 2020 2020   take the..     
+00012a90: 2020 2020 2020 2020 2020 2023 2064 6566             # def
+00012aa0: 6175 6c74 2076 616c 7565 7320 666f 7220  ault values for 
+00012ab0: 7468 6573 6520 6174 7472 6962 7574 6573  these attributes
+00012ac0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00012ad0: 2020 666f 7220 6f70 7469 6f6e 616c 2069    for optional i
+00012ae0: 6e20 2822 6669 6c6c 222c 2022 7374 726f  n ("fill", "stro
+00012af0: 6b65 2229 3a0d 0a20 2020 2020 2020 2020  ke"):..         
+00012b00: 2020 2020 2020 2020 2020 2069 6620 6861             if ha
+00012b10: 7361 7474 7228 6f72 676e 6f64 652c 206f  sattr(orgnode, o
+00012b20: 7074 696f 6e61 6c29 3a0d 0a20 2020 2020  ptional):..     
+00012b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012b40: 2020 2073 6574 6174 7472 2863 6f70 795f     setattr(copy_
+00012b50: 6e6f 6465 2c20 6f70 7469 6f6e 616c 2c20  node, optional, 
+00012b60: 6765 7461 7474 7228 6f72 676e 6f64 652c  getattr(orgnode,
+00012b70: 206f 7074 696f 6e61 6c29 290d 0a20 2020   optional))..   
+00012b80: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+00012b90: 206f 7074 696f 6e61 6c20 696e 2028 2277   optional in ("w
+00012ba0: 7866 6f6e 7422 2c20 226d 6b74 6578 7422  xfont", "mktext"
+00012bb0: 2c20 226d 6b66 6f6e 7422 2c20 226d 6b66  , "mkfont", "mkf
+00012bc0: 6f6e 7473 697a 6522 293a 0d0a 2020 2020  ontsize"):..    
+00012bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012be0: 6966 2068 6173 6174 7472 286f 7267 6e6f  if hasattr(orgno
+00012bf0: 6465 2c20 6f70 7469 6f6e 616c 293a 0d0a  de, optional):..
+00012c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012c10: 2020 2020 2020 2020 6861 645f 6f70 7469          had_opti
+00012c20: 6f6e 616c 203d 2054 7275 650d 0a20 2020  onal = True..   
+00012c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012c40: 2020 2020 2073 6574 6174 7472 2863 6f70       setattr(cop
+00012c50: 795f 6e6f 6465 2c20 6f70 7469 6f6e 616c  y_node, optional
+00012c60: 2c20 6765 7461 7474 7228 6f72 676e 6f64  , getattr(orgnod
+00012c70: 652c 206f 7074 696f 6e61 6c29 290d 0a20  e, optional)).. 
+00012c80: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00012c90: 6620 7365 6c66 2e63 6f70 795f 696e 6372  f self.copy_incr
+00012ca0: 6561 7365 735f 776f 7264 6c69 7374 5f72  eases_wordlist_r
+00012cb0: 6566 6572 656e 6365 7320 616e 6420 6861  eferences and ha
+00012cc0: 7361 7474 7228 6f72 676e 6f64 652c 2022  sattr(orgnode, "
+00012cd0: 7465 7874 2229 3a0d 0a20 2020 2020 2020  text"):..       
+00012ce0: 2020 2020 2020 2020 2020 2020 2063 6f70               cop
+00012cf0: 795f 6e6f 6465 2e74 6578 7420 3d20 7365  y_node.text = se
+00012d00: 6c66 2e77 6f72 646c 6973 745f 6465 6c74  lf.wordlist_delt
+00012d10: 6128 6f72 676e 6f64 652e 7465 7874 2c20  a(orgnode.text, 
+00012d20: 6465 6c74 615f 776f 7264 6c69 7374 290d  delta_wordlist).
+00012d30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012d40: 2065 6c69 6620 7365 6c66 2e63 6f70 795f   elif self.copy_
+00012d50: 696e 6372 6561 7365 735f 776f 7264 6c69  increases_wordli
+00012d60: 7374 5f72 6566 6572 656e 6365 7320 616e  st_references an
+00012d70: 6420 6861 7361 7474 7228 652c 2022 6d6b  d hasattr(e, "mk
+00012d80: 7465 7874 2229 3a0d 0a20 2020 2020 2020  text"):..       
+00012d90: 2020 2020 2020 2020 2020 2020 2063 6f70               cop
+00012da0: 795f 6e6f 6465 2e6d 6b74 6578 7420 3d20  y_node.mktext = 
+00012db0: 7365 6c66 2e77 6f72 646c 6973 745f 6465  self.wordlist_de
+00012dc0: 6c74 6128 652e 6d6b 7465 7874 2c20 6465  lta(e.mktext, de
+00012dd0: 6c74 615f 776f 7264 6c69 7374 290d 0a20  lta_wordlist).. 
+00012de0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+00012df0: 7267 7061 7265 6e74 2e61 6464 5f6e 6f64  rgparent.add_nod
+00012e00: 6528 636f 7079 5f6e 6f64 6529 0d0a 2020  e(copy_node)..  
+00012e10: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00012e20: 2068 6164 5f6f 7074 696f 6e61 6c3a 0d0a   had_optional:..
+00012e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012e40: 2020 2020 666f 7220 7072 6f70 6572 7479      for property
+00012e50: 5f6f 7020 696e 2073 656c 662e 6b65 726e  _op in self.kern
+00012e60: 656c 2e6c 6f6f 6b75 705f 616c 6c28 2270  el.lookup_all("p
+00012e70: 6174 685f 7570 6461 7465 722f 2e2a 2229  ath_updater/.*")
+00012e80: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00012e90: 2020 2020 2020 2020 2020 2070 726f 7065             prope
+00012ea0: 7274 795f 6f70 2873 656c 662e 6b65 726e  rty_op(self.kern
+00012eb0: 656c 2e72 6f6f 742c 2063 6f70 795f 6e6f  el.root, copy_no
+00012ec0: 6465 290d 0a0d 0a20 2020 2020 2020 2020  de)....         
+00012ed0: 2020 2020 2020 2063 6f70 795f 6e6f 6465         copy_node
+00012ee0: 732e 6170 7065 6e64 2863 6f70 795f 6e6f  s.append(copy_no
+00012ef0: 6465 290d 0a0d 0a20 2020 2020 2020 2020  de)....         
+00012f00: 2020 2020 2020 2069 6620 6f72 676e 6f64         if orgnod
+00012f10: 652e 7479 7065 2069 6e20 2822 6669 6c65  e.type in ("file
+00012f20: 222c 2022 6772 6f75 7022 293a 0d0a 2020  ", "group"):..  
+00012f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012f40: 2020 6e65 7770 6172 656e 7420 3d20 636f    newparent = co
+00012f50: 7079 5f6e 6f64 650d 0a20 2020 2020 2020  py_node..       
+00012f60: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+00012f70: 2063 6e6f 6465 2069 6e20 6f72 676e 6f64   cnode in orgnod
+00012f80: 652e 6368 696c 6472 656e 3a0d 0a20 2020  e.children:..   
+00012f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012fa0: 2020 2020 2063 6f70 795f 7369 6e67 6c65       copy_single
+00012fb0: 5f6e 6f64 6528 0d0a 2020 2020 2020 2020  _node(..        
+00012fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012fd0: 2020 2020 636e 6f64 652c 206e 6577 7061      cnode, newpa
+00012fe0: 7265 6e74 2c20 312c 2028 6e20 2b20 3129  rent, 1, (n + 1)
+00012ff0: 202a 2064 782c 2028 6e20 2b20 3129 202a   * dx, (n + 1) *
+00013000: 2064 790d 0a20 2020 2020 2020 2020 2020   dy..           
+00013010: 2020 2020 2020 2020 2020 2020 2029 0d0a               )..
+00013020: 0d0a 2020 2020 2020 2020 636f 7079 5f6e  ..        copy_n
+00013030: 6f64 6573 203d 206c 6973 7428 290d 0a20  odes = list().. 
+00013040: 2020 2020 2020 2064 7820 3d20 7365 6c66         dx = self
+00013050: 2e6c 656e 6774 685f 7828 2233 6d6d 2229  .length_x("3mm")
+00013060: 0d0a 2020 2020 2020 2020 6479 203d 2073  ..        dy = s
+00013070: 656c 662e 6c65 6e67 7468 5f79 2822 336d  elf.length_y("3m
+00013080: 6d22 290d 0a20 2020 2020 2020 2061 6c6c  m")..        all
+00013090: 6461 7461 203d 206c 6973 7428 7365 6c66  data = list(self
+000130a0: 2e65 6c65 6d73 2865 6d70 6861 7369 7a65  .elems(emphasize
+000130b0: 643d 5472 7565 2929 0d0a 2020 2020 2020  d=True))..      
+000130c0: 2020 6d69 6e69 6d61 6c64 6174 6120 3d20    minimaldata = 
+000130d0: 7365 6c66 2e63 6f6e 6465 6e73 655f 656c  self.condense_el
+000130e0: 656d 656e 7473 2861 6c6c 6461 7461 2c20  ements(alldata, 
+000130f0: 6578 7061 6e64 5f61 745f 656e 643d 4661  expand_at_end=Fa
+00013100: 6c73 6529 0d0a 2020 2020 2020 2020 666f  lse)..        fo
+00013110: 7220 6520 696e 206d 696e 696d 616c 6461  r e in minimalda
+00013120: 7461 3a0d 0a20 2020 2020 2020 2020 2020  ta:..           
+00013130: 2070 6172 656e 7420 3d20 652e 7061 7265   parent = e.pare
+00013140: 6e74 0d0a 2020 2020 2020 2020 2020 2020  nt..            
+00013150: 636f 7079 5f73 696e 676c 655f 6e6f 6465  copy_single_node
+00013160: 2865 2c20 7061 7265 6e74 2c20 636f 7069  (e, parent, copi
+00013170: 6573 2c20 6478 2c20 6479 290d 0a0d 0a20  es, dx, dy).... 
+00013180: 2020 2020 2020 2069 6620 7365 6c66 2e63         if self.c
+00013190: 6c61 7373 6966 795f 6e65 773a 0d0a 2020  lassify_new:..  
+000131a0: 2020 2020 2020 2020 2020 7365 6c66 2e63            self.c
+000131b0: 6c61 7373 6966 7928 636f 7079 5f6e 6f64  lassify(copy_nod
+000131c0: 6573 290d 0a0d 0a20 2020 2020 2020 2073  es)....        s
+000131d0: 656c 662e 7365 745f 656d 7068 6173 6973  elf.set_emphasis
+000131e0: 284e 6f6e 6529 0d0a 0d0a 2020 2020 6465  (None)....    de
+000131f0: 6620 6861 735f 776f 7264 6c69 7374 286e  f has_wordlist(n
+00013200: 6f64 6529 3a0d 0a20 2020 2020 2020 2072  ode):..        r
+00013210: 6573 756c 7420 3d20 4661 6c73 650d 0a20  esult = False.. 
+00013220: 2020 2020 2020 2074 7874 203d 2022 220d         txt = "".
+00013230: 0a20 2020 2020 2020 2069 6620 6861 7361  .        if hasa
+00013240: 7474 7228 6e6f 6465 2c20 2274 6578 7422  ttr(node, "text"
+00013250: 2920 616e 6420 6e6f 6465 2e74 6578 7420  ) and node.text 
+00013260: 6973 206e 6f74 204e 6f6e 653a 0d0a 2020  is not None:..  
+00013270: 2020 2020 2020 2020 2020 7478 7420 3d20            txt = 
+00013280: 7374 7228 6e6f 6465 2e74 6578 7429 0d0a  str(node.text)..
+00013290: 2020 2020 2020 2020 6966 2068 6173 6174          if hasat
+000132a0: 7472 286e 6f64 652c 2022 6d6b 7465 7874  tr(node, "mktext
+000132b0: 2229 2061 6e64 206e 6f64 652e 6d6b 7465  ") and node.mkte
+000132c0: 7874 2069 7320 6e6f 7420 4e6f 6e65 3a0d  xt is not None:.
+000132d0: 0a20 2020 2020 2020 2020 2020 2074 7874  .            txt
+000132e0: 203d 2073 7472 286e 6f64 652e 6d6b 7465   = str(node.mkte
+000132f0: 7874 290d 0a20 2020 2020 2020 2023 2056  xt)..        # V
+00013300: 6572 7920 7374 7570 6964 2c20 6275 7420  ery stupid, but 
+00013310: 676f 6f64 2065 6e6f 7567 680d 0a20 2020  good enough..   
+00013320: 2020 2020 2069 6620 227b 2220 696e 2074       if "{" in t
+00013330: 7874 2061 6e64 2022 7d22 2069 6e20 7478  xt and "}" in tx
+00013340: 743a 0d0a 2020 2020 2020 2020 2020 2020  t:..            
+00013350: 7265 7375 6c74 203d 2054 7275 650d 0a20  result = True.. 
+00013360: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
+00013370: 7375 6c74 0d0a 0d0a 2020 2020 4074 7265  sult....    @tre
+00013380: 655f 636f 6e64 6974 696f 6e61 6c28 6c61  e_conditional(la
+00013390: 6d62 6461 206e 6f64 653a 2068 6173 5f77  mbda node: has_w
+000133a0: 6f72 646c 6973 7428 6e6f 6465 2929 0d0a  ordlist(node))..
+000133b0: 2020 2020 4074 7265 655f 6f70 6572 6174      @tree_operat
+000133c0: 696f 6e28 0d0a 2020 2020 2020 2020 5f28  ion(..        _(
+000133d0: 2249 6e63 7265 6173 6520 576f 7264 6c69  "Increase Wordli
+000133e0: 7374 2d52 6566 6572 656e 6365 2229 2c0d  st-Reference"),.
+000133f0: 0a20 2020 2020 2020 206e 6f64 655f 7479  .        node_ty
+00013400: 7065 3d28 0d0a 2020 2020 2020 2020 2020  pe=(..          
+00013410: 2020 2265 6c65 6d20 7465 7874 222c 0d0a    "elem text",..
+00013420: 2020 2020 2020 2020 2020 2020 2265 6c65              "ele
+00013430: 6d20 7061 7468 222c 0d0a 2020 2020 2020  m path",..      
+00013440: 2020 292c 0d0a 2020 2020 2020 2020 6865    ),..        he
+00013450: 6c70 3d5f 2822 4164 6a75 7374 7320 7468  lp=_("Adjusts th
+00013460: 6520 7265 6665 7265 6e63 6520 7661 6c75  e reference valu
+00013470: 6520 666f 7220 6120 776f 7264 6c69 7374  e for a wordlist
+00013480: 2c20 6965 207b 6e61 6d65 7d20 746f 207b  , ie {name} to {
+00013490: 6e61 6d65 232b 317d 2229 2c0d 0a20 2020  name#+1}"),..   
+000134a0: 2029 0d0a 2020 2020 6465 6620 776c 6973   )..    def wlis
+000134b0: 745f 706c 7573 2873 696e 676c 656e 6f64  t_plus(singlenod
+000134c0: 652c 202a 2a6b 7761 7267 7329 3a0d 0a20  e, **kwargs):.. 
+000134d0: 2020 2020 2020 2064 6174 6120 3d20 6c69         data = li
+000134e0: 7374 2829 0d0a 2020 2020 2020 2020 666f  st()..        fo
+000134f0: 7220 6e6f 6465 2069 6e20 6c69 7374 2873  r node in list(s
+00013500: 656c 662e 656c 656d 7328 656d 7068 6173  elf.elems(emphas
+00013510: 697a 6564 3d54 7275 6529 293a 0d0a 2020  ized=True)):..  
+00013520: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+00013530: 2068 6173 5f77 6f72 646c 6973 7428 6e6f   has_wordlist(no
+00013540: 6465 293a 0d0a 2020 2020 2020 2020 2020  de):..          
+00013550: 2020 2020 2020 636f 6e74 696e 7565 0d0a        continue..
+00013560: 2020 2020 2020 2020 2020 2020 6465 6c74              delt
+00013570: 615f 776f 7264 6c69 7374 203d 2031 0d0a  a_wordlist = 1..
+00013580: 2020 2020 2020 2020 2020 2020 6966 2068              if h
+00013590: 6173 6174 7472 286e 6f64 652c 2022 7465  asattr(node, "te
+000135a0: 7874 2229 3a0d 0a20 2020 2020 2020 2020  xt"):..         
+000135b0: 2020 2020 2020 206e 6f64 652e 7465 7874         node.text
+000135c0: 203d 2073 656c 662e 776f 7264 6c69 7374   = self.wordlist
+000135d0: 5f64 656c 7461 286e 6f64 652e 7465 7874  _delta(node.text
+000135e0: 2c20 6465 6c74 615f 776f 7264 6c69 7374  , delta_wordlist
+000135f0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00013600: 2020 206e 6f64 652e 616c 7465 7265 6428     node.altered(
+00013610: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00013620: 2020 2064 6174 612e 6170 7065 6e64 286e     data.append(n
+00013630: 6f64 6529 0d0a 2020 2020 2020 2020 2020  ode)..          
+00013640: 2020 656c 6966 2068 6173 6174 7472 286e    elif hasattr(n
+00013650: 6f64 652c 2022 6d6b 7465 7874 2229 3a0d  ode, "mktext"):.
+00013660: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013670: 206e 6f64 652e 6d6b 7465 7874 203d 2073   node.mktext = s
+00013680: 656c 662e 776f 7264 6c69 7374 5f64 656c  elf.wordlist_del
+00013690: 7461 286e 6f64 652e 6d6b 7465 7874 2c20  ta(node.mktext, 
+000136a0: 6465 6c74 615f 776f 7264 6c69 7374 290d  delta_wordlist).
+000136b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000136c0: 2066 6f72 2070 726f 7065 7274 795f 6f70   for property_op
+000136d0: 2069 6e20 7365 6c66 2e6b 6572 6e65 6c2e   in self.kernel.
+000136e0: 6c6f 6f6b 7570 5f61 6c6c 2822 7061 7468  lookup_all("path
+000136f0: 5f75 7064 6174 6572 2f2e 2a22 293a 0d0a  _updater/.*"):..
+00013700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013710: 2020 2020 7072 6f70 6572 7479 5f6f 7028      property_op(
+00013720: 7365 6c66 2e6b 6572 6e65 6c2e 726f 6f74  self.kernel.root
+00013730: 2c20 6e6f 6465 290d 0a20 2020 2020 2020  , node)..       
+00013740: 2020 2020 2020 2020 2064 6174 612e 6170           data.ap
+00013750: 7065 6e64 286e 6f64 6529 0d0a 2020 2020  pend(node)..    
+00013760: 2020 2020 7365 6c66 2e73 6967 6e61 6c28      self.signal(
+00013770: 2265 6c65 6d65 6e74 5f70 726f 7065 7274  "element_propert
+00013780: 795f 7570 6461 7465 222c 2064 6174 6129  y_update", data)
+00013790: 0d0a 0d0a 2020 2020 4074 7265 655f 636f  ....    @tree_co
+000137a0: 6e64 6974 696f 6e61 6c28 6c61 6d62 6461  nditional(lambda
+000137b0: 206e 6f64 653a 2068 6173 5f77 6f72 646c   node: has_wordl
+000137c0: 6973 7428 6e6f 6465 2929 0d0a 2020 2020  ist(node))..    
+000137d0: 4074 7265 655f 6f70 6572 6174 696f 6e28  @tree_operation(
+000137e0: 0d0a 2020 2020 2020 2020 5f28 2244 6563  ..        _("Dec
+000137f0: 7265 6173 6520 576f 7264 6c69 7374 2d52  rease Wordlist-R
+00013800: 6566 6572 656e 6365 2229 2c0d 0a20 2020  eference"),..   
+00013810: 2020 2020 206e 6f64 655f 7479 7065 3d28       node_type=(
+00013820: 0d0a 2020 2020 2020 2020 2020 2020 2265  ..            "e
+00013830: 6c65 6d20 7465 7874 222c 0d0a 2020 2020  lem text",..    
+00013840: 2020 2020 2020 2020 2265 6c65 6d20 7061          "elem pa
+00013850: 7468 222c 0d0a 2020 2020 2020 2020 292c  th",..        ),
+00013860: 0d0a 2020 2020 2020 2020 6865 6c70 3d5f  ..        help=_
+00013870: 2822 4164 6a75 7374 7320 7468 6520 7265  ("Adjusts the re
+00013880: 6665 7265 6e63 6520 7661 6c75 6520 666f  ference value fo
+00013890: 7220 6120 776f 7264 6c69 7374 2c20 6965  r a wordlist, ie
+000138a0: 207b 6e61 6d65 232b 337d 2074 6f20 7b6e   {name#+3} to {n
+000138b0: 616d 6523 2b32 7d22 292c 0d0a 2020 2020  ame#+2}"),..    
+000138c0: 290d 0a20 2020 2064 6566 2077 6c69 7374  )..    def wlist
+000138d0: 5f6d 696e 7573 2873 696e 676c 656e 6f64  _minus(singlenod
+000138e0: 652c 202a 2a6b 7761 7267 7329 3a0d 0a20  e, **kwargs):.. 
+000138f0: 2020 2020 2020 2064 6174 6120 3d20 6c69         data = li
+00013900: 7374 2829 0d0a 2020 2020 2020 2020 666f  st()..        fo
+00013910: 7220 6e6f 6465 2069 6e20 6c69 7374 2873  r node in list(s
+00013920: 656c 662e 656c 656d 7328 656d 7068 6173  elf.elems(emphas
+00013930: 697a 6564 3d54 7275 6529 293a 0d0a 2020  ized=True)):..  
+00013940: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+00013950: 2068 6173 5f77 6f72 646c 6973 7428 6e6f   has_wordlist(no
+00013960: 6465 293a 0d0a 2020 2020 2020 2020 2020  de):..          
+00013970: 2020 2020 2020 636f 6e74 696e 7565 0d0a        continue..
+00013980: 2020 2020 2020 2020 2020 2020 6465 6c74              delt
+00013990: 615f 776f 7264 6c69 7374 203d 202d 310d  a_wordlist = -1.
+000139a0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000139b0: 6861 7361 7474 7228 6e6f 6465 2c20 2274  hasattr(node, "t
+000139c0: 6578 7422 293a 0d0a 2020 2020 2020 2020  ext"):..        
+000139d0: 2020 2020 2020 2020 6e6f 6465 2e74 6578          node.tex
+000139e0: 7420 3d20 7365 6c66 2e77 6f72 646c 6973  t = self.wordlis
+000139f0: 745f 6465 6c74 6128 6e6f 6465 2e74 6578  t_delta(node.tex
+00013a00: 742c 2064 656c 7461 5f77 6f72 646c 6973  t, delta_wordlis
+00013a10: 7429 0d0a 2020 2020 2020 2020 2020 2020  t)..            
+00013a20: 2020 2020 6e6f 6465 2e61 6c74 6572 6564      node.altered
+00013a30: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
+00013a40: 2020 2020 6461 7461 2e61 7070 656e 6428      data.append(
+00013a50: 6e6f 6465 290d 0a20 2020 2020 2020 2020  node)..         
+00013a60: 2020 2065 6c69 6620 6861 7361 7474 7228     elif hasattr(
+00013a70: 6e6f 6465 2c20 226d 6b74 6578 7422 293a  node, "mktext"):
+00013a80: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00013a90: 2020 6e6f 6465 2e6d 6b74 6578 7420 3d20    node.mktext = 
+00013aa0: 7365 6c66 2e77 6f72 646c 6973 745f 6465  self.wordlist_de
+00013ab0: 6c74 6128 6e6f 6465 2e6d 6b74 6578 742c  lta(node.mktext,
+00013ac0: 2064 656c 7461 5f77 6f72 646c 6973 7429   delta_wordlist)
+00013ad0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00013ae0: 2020 666f 7220 7072 6f70 6572 7479 5f6f    for property_o
+00013af0: 7020 696e 2073 656c 662e 6b65 726e 656c  p in self.kernel
+00013b00: 2e6c 6f6f 6b75 705f 616c 6c28 2270 6174  .lookup_all("pat
+00013b10: 685f 7570 6461 7465 722f 2e2a 2229 3a0d  h_updater/.*"):.
+00013b20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013b30: 2020 2020 2070 726f 7065 7274 795f 6f70       property_op
+00013b40: 2873 656c 662e 6b65 726e 656c 2e72 6f6f  (self.kernel.roo
+00013b50: 742c 206e 6f64 6529 0d0a 2020 2020 2020  t, node)..      
+00013b60: 2020 2020 2020 2020 2020 6461 7461 2e61            data.a
+00013b70: 7070 656e 6428 6e6f 6465 290d 0a20 2020  ppend(node)..   
+00013b80: 2020 2020 2073 656c 662e 7369 676e 616c       self.signal
+00013b90: 2822 656c 656d 656e 745f 7072 6f70 6572  ("element_proper
+00013ba0: 7479 5f75 7064 6174 6522 2c20 6461 7461  ty_update", data
+00013bb0: 290d 0a0d 0a20 2020 2040 7472 6565 5f63  )....    @tree_c
+00013bc0: 6f6e 6469 7469 6f6e 616c 286c 616d 6264  onditional(lambd
+00013bd0: 6120 6e6f 6465 3a20 6861 735f 7665 6374  a node: has_vect
+00013be0: 6f72 697a 6528 6e6f 6465 2929 0d0a 2020  orize(node))..  
+00013bf0: 2020 4074 7265 655f 7375 626d 656e 7528    @tree_submenu(
+00013c00: 5f28 224f 7574 6c69 6e65 2065 6c65 6d65  _("Outline eleme
+00013c10: 6e74 2873 292e 2e2e 2229 290d 0a20 2020  nt(s)..."))..   
+00013c20: 2040 7472 6565 5f69 7465 7261 7465 2822   @tree_iterate("
+00013c30: 6f66 6673 6574 222c 2031 2c20 3130 290d  offset", 1, 10).
+00013c40: 0a20 2020 2040 7472 6565 5f6f 7065 7261  .    @tree_opera
+00013c50: 7469 6f6e 280d 0a20 2020 2020 2020 205f  tion(..        _
+00013c60: 2822 2e2e 2e77 6974 6820 7b6f 6666 7365  ("...with {offse
+00013c70: 747d 6d6d 2064 6973 7461 6e63 6522 292c  t}mm distance"),
+00013c80: 0d0a 2020 2020 2020 2020 6e6f 6465 5f74  ..        node_t
+00013c90: 7970 653d 656c 656d 5f6e 6f64 6573 2c0d  ype=elem_nodes,.
+00013ca0: 0a20 2020 2020 2020 2068 656c 703d 2222  .        help=""
+00013cb0: 2c0d 0a20 2020 2029 0d0a 2020 2020 6465  ,..    )..    de
+00013cc0: 6620 6d61 6b65 5f6f 7574 6c69 6e65 7328  f make_outlines(
+00013cd0: 6e6f 6465 2c20 6f66 6673 6574 3d31 2c20  node, offset=1, 
+00013ce0: 2a2a 6b77 6172 6773 293a 0d0a 2020 2020  **kwargs):..    
+00013cf0: 2020 2020 7365 6c66 2866 226f 7574 6c69      self(f"outli
+00013d00: 6e65 207b 6f66 6673 6574 7d6d 6d5c 6e22  ne {offset}mm\n"
+00013d10: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00013d20: 7369 676e 616c 2822 7265 6672 6573 685f  signal("refresh_
+00013d30: 7472 6565 2229 0d0a 0d0a 2020 2020 6465  tree")....    de
+00013d40: 6620 6861 735f 7665 6374 6f72 697a 6528  f has_vectorize(
+00013d50: 6e6f 6465 293a 0d0a 2020 2020 2020 2020  node):..        
+00013d60: 7265 7375 6c74 203d 2046 616c 7365 0d0a  result = False..
+00013d70: 2020 2020 2020 2020 6d61 6b65 5f76 6563          make_vec
+00013d80: 746f 7220 3d20 7365 6c66 2e6c 6f6f 6b75  tor = self.looku
+00013d90: 7028 2272 656e 6465 722d 6f70 2f6d 616b  p("render-op/mak
+00013da0: 655f 7665 6374 6f72 2229 0d0a 2020 2020  e_vector")..    
+00013db0: 2020 2020 6966 206d 616b 655f 7665 6374      if make_vect
+00013dc0: 6f72 3a0d 0a20 2020 2020 2020 2020 2020  or:..           
+00013dd0: 2072 6573 756c 7420 3d20 5472 7565 0d0a   result = True..
+00013de0: 2020 2020 2020 2020 7265 7475 726e 2072          return r
+00013df0: 6573 756c 740d 0a0d 0a20 2020 2040 7472  esult....    @tr
+00013e00: 6565 5f63 6f6e 6469 7469 6f6e 616c 286c  ee_conditional(l
+00013e10: 616d 6264 6120 6e6f 6465 3a20 6861 735f  ambda node: has_
+00013e20: 7665 6374 6f72 697a 6528 6e6f 6465 2929  vectorize(node))
+00013e30: 0d0a 2020 2020 4074 7265 655f 6f70 6572  ..    @tree_oper
+00013e40: 6174 696f 6e28 0d0a 2020 2020 2020 2020  ation(..        
+00013e50: 5f28 2254 7261 6365 2062 6974 6d61 7022  _("Trace bitmap"
+00013e60: 292c 0d0a 2020 2020 2020 2020 6e6f 6465  ),..        node
+00013e70: 5f74 7970 653d 280d 0a20 2020 2020 2020  _type=(..       
+00013e80: 2020 2020 2022 656c 656d 2074 6578 7422       "elem text"
+00013e90: 2c0d 0a20 2020 2020 2020 2020 2020 2022  ,..            "
+00013ea0: 656c 656d 2069 6d61 6765 222c 0d0a 2020  elem image",..  
+00013eb0: 2020 2020 2020 292c 0d0a 2020 2020 2020        ),..      
+00013ec0: 2020 6865 6c70 3d5f 2822 5665 6374 6f72    help=_("Vector
+00013ed0: 697a 6520 7468 6520 6769 7665 6e20 656c  ize the given el
+00013ee0: 656d 656e 7422 292c 0d0a 2020 2020 290d  ement"),..    ).
+00013ef0: 0a20 2020 2064 6566 2074 7261 6365 5f62  .    def trace_b
+00013f00: 6974 6d61 7028 6e6f 6465 2c20 2a2a 6b77  itmap(node, **kw
+00013f10: 6172 6773 293a 0d0a 2020 2020 2020 2020  args):..        
+00013f20: 7365 6c66 2822 7665 6374 6f72 697a 655c  self("vectorize\
+00013f30: 6e22 290d 0a0d 0a20 2020 2040 7472 6565  n")....    @tree
+00013f40: 5f63 6f6e 6469 7469 6f6e 616c 286c 616d  _conditional(lam
+00013f50: 6264 6120 6e6f 6465 3a20 6e6f 7420 6973  bda node: not is
+00013f60: 5f72 6567 6d61 726b 286e 6f64 6529 290d  _regmark(node)).
+00013f70: 0a20 2020 2040 7472 6565 5f6f 7065 7261  .    @tree_opera
+00013f80: 7469 6f6e 280d 0a20 2020 2020 2020 205f  tion(..        _
+00013f90: 2822 436f 6e76 6572 7420 746f 2070 6174  ("Convert to pat
+00013fa0: 6822 292c 0d0a 2020 2020 2020 2020 6e6f  h"),..        no
+00013fb0: 6465 5f74 7970 653d 280d 0a20 2020 2020  de_type=(..     
+00013fc0: 2020 2020 2020 2022 656c 656d 2065 6c6c         "elem ell
+00013fd0: 6970 7365 222c 0d0a 2020 2020 2020 2020  ipse",..        
+00013fe0: 2020 2020 2265 6c65 6d20 7061 7468 222c      "elem path",
+00013ff0: 0d0a 2020 2020 2020 2020 2020 2020 2265  ..            "e
+00014000: 6c65 6d20 706f 6c79 6c69 6e65 222c 0d0a  lem polyline",..
+00014010: 2020 2020 2020 2020 2020 2020 2265 6c65              "ele
+00014020: 6d20 7265 6374 222c 0d0a 2020 2020 2020  m rect",..      
+00014030: 2020 2020 2020 2265 6c65 6d20 6c69 6e65        "elem line
+00014040: 222c 0d0a 2020 2020 2020 2020 292c 0d0a  ",..        ),..
+00014050: 2020 2020 2020 2020 6865 6c70 3d22 222c          help="",
+00014060: 0d0a 2020 2020 290d 0a20 2020 2064 6566  ..    )..    def
+00014070: 2063 6f6e 7665 7274 5f74 6f5f 7061 7468   convert_to_path
+00014080: 2873 696e 676c 656e 6f64 652c 202a 2a6b  (singlenode, **k
+00014090: 7761 7267 7329 3a0d 0a20 2020 2020 2020  wargs):..       
+000140a0: 2066 6f72 206e 6f64 6520 696e 206c 6973   for node in lis
+000140b0: 7428 7365 6c66 2e65 6c65 6d73 2865 6d70  t(self.elems(emp
+000140c0: 6861 7369 7a65 643d 5472 7565 2929 3a0d  hasized=True)):.
+000140d0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000140e0: 6e6f 7420 6e6f 6465 206e 6f74 2069 6e20  not node not in 
+000140f0: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
+00014100: 2020 2022 656c 656d 2065 6c6c 6970 7365     "elem ellipse
+00014110: 222c 0d0a 2020 2020 2020 2020 2020 2020  ",..            
+00014120: 2020 2020 2265 6c65 6d20 7061 7468 222c      "elem path",
+00014130: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00014140: 2020 2265 6c65 6d20 706f 6c79 6c69 6e65    "elem polyline
+00014150: 222c 0d0a 2020 2020 2020 2020 2020 2020  ",..            
+00014160: 2020 2020 2265 6c65 6d20 7265 6374 222c      "elem rect",
+00014170: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00014180: 2020 2265 6c65 6d20 6c69 6e65 222c 0d0a    "elem line",..
+00014190: 2020 2020 2020 2020 2020 2020 293a 0d0a              ):..
+000141a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000141b0: 636f 6e74 696e 7565 0d0a 2020 2020 2020  continue..      
+000141c0: 2020 2020 2020 6f6c 6473 7475 6666 203d        oldstuff =
+000141d0: 205b 5d0d 0a20 2020 2020 2020 2020 2020   []..           
+000141e0: 2066 6f72 2061 7474 7269 6220 696e 2028   for attrib in (
+000141f0: 2273 7472 6f6b 6522 2c20 2266 696c 6c22  "stroke", "fill"
+00014200: 2c20 2273 7472 6f6b 655f 7769 6474 6822  , "stroke_width"
+00014210: 2c20 2273 7472 6f6b 655f 7363 616c 6564  , "stroke_scaled
+00014220: 2229 3a0d 0a20 2020 2020 2020 2020 2020  "):..           
+00014230: 2020 2020 2069 6620 6861 7361 7474 7228       if hasattr(
+00014240: 6e6f 6465 2c20 6174 7472 6962 293a 0d0a  node, attrib):..
+00014250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014260: 2020 2020 6f6c 6476 616c 203d 2067 6574      oldval = get
+00014270: 6174 7472 286e 6f64 652c 2061 7474 7269  attr(node, attri
+00014280: 622c 204e 6f6e 6529 0d0a 2020 2020 2020  b, None)..      
+00014290: 2020 2020 2020 2020 2020 2020 2020 6f6c                ol
+000142a0: 6473 7475 6666 2e61 7070 656e 6428 5b61  dstuff.append([a
+000142b0: 7474 7269 622c 206f 6c64 7661 6c5d 290d  ttrib, oldval]).
+000142c0: 0a20 2020 2020 2020 2020 2020 2074 7279  .            try
+000142d0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+000142e0: 2020 2070 6174 6820 3d20 6e6f 6465 2e61     path = node.a
+000142f0: 735f 7061 7468 2829 0d0a 2020 2020 2020  s_path()..      
+00014300: 2020 2020 2020 2020 2020 2320 5468 6572            # Ther
+00014310: 6520 6172 6520 736f 6d65 2063 6861 6c6c  e are some chall
+00014320: 656e 6765 7320 6172 6f75 6e64 2074 6865  enges around the
+00014330: 2074 7265 6174 6d65 6e74 0d0a 2020 2020   treatment..    
+00014340: 2020 2020 2020 2020 2020 2020 2320 6f66              # of
+00014350: 2061 7263 7320 7769 7468 696e 2073 7667   arcs within svg
+00014360: 656c 656d 656e 7473 2c20 736f 206c 6574  elements, so let
+00014370: 2773 2063 6972 6375 6d76 656e 740d 0a20  's circumvent.. 
+00014380: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00014390: 2074 6865 6d20 666f 7220 7468 6520 7469   them for the ti
+000143a0: 6d65 2062 6569 6e67 2028 756e 7469 6c20  me being (until 
+000143b0: 7265 736f 6c76 6564 290d 0a20 2020 2020  resolved)..     
+000143c0: 2020 2020 2020 2020 2020 2023 2062 7920             # by 
+000143d0: 7265 706c 6163 696e 6720 6172 6320 7365  replacing arc se
+000143e0: 676d 656e 7473 2077 6974 6820 6375 6269  gments with cubi
+000143f0: 6320 6265 7a69 6572 730d 0a20 2020 2020  c beziers..     
+00014400: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+00014410: 6465 2e74 7970 6520 696e 2028 2265 6c65  de.type in ("ele
+00014420: 6d20 7061 7468 222c 2022 656c 656d 2065  m path", "elem e
+00014430: 6c6c 6970 7365 2229 3a0d 0a20 2020 2020  llipse"):..     
+00014440: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00014450: 6174 682e 6170 7072 6f78 696d 6174 655f  ath.approximate_
+00014460: 6172 6373 5f77 6974 685f 6375 6269 6373  arcs_with_cubics
+00014470: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
+00014480: 6578 6365 7074 2041 7474 7269 6275 7465  except Attribute
+00014490: 4572 726f 723a 0d0a 2020 2020 2020 2020  Error:..        
+000144a0: 2020 2020 2020 2020 7265 7475 726e 0d0a          return..
+000144b0: 2020 2020 2020 2020 2020 2020 6e65 776e              newn
+000144c0: 6f64 6520 3d20 6e6f 6465 2e72 6570 6c61  ode = node.repla
+000144d0: 6365 5f6e 6f64 6528 7061 7468 3d70 6174  ce_node(path=pat
+000144e0: 682c 2074 7970 653d 2265 6c65 6d20 7061  h, type="elem pa
+000144f0: 7468 2229 0d0a 2020 2020 2020 2020 2020  th")..          
+00014500: 2020 666f 7220 6974 656d 2069 6e20 6f6c    for item in ol
+00014510: 6473 7475 6666 3a0d 0a20 2020 2020 2020  dstuff:..       
+00014520: 2020 2020 2020 2020 2073 6574 6174 7472           setattr
+00014530: 286e 6577 6e6f 6465 2c20 6974 656d 5b30  (newnode, item[0
+00014540: 5d2c 2069 7465 6d5b 315d 290d 0a20 2020  ], item[1])..   
+00014550: 2020 2020 2020 2020 206e 6577 6e6f 6465           newnode
+00014560: 2e61 6c74 6572 6564 2829 0d0a 0d0a 2020  .altered()....  
+00014570: 2020 4074 7265 655f 7375 626d 656e 7528    @tree_submenu(
+00014580: 5f28 2246 6c69 7022 2929 0d0a 2020 2020  _("Flip"))..    
+00014590: 4074 7265 655f 7365 7061 7261 746f 725f  @tree_separator_
+000145a0: 6265 666f 7265 2829 0d0a 2020 2020 4074  before()..    @t
+000145b0: 7265 655f 636f 6e64 6974 696f 6e61 6c28  ree_conditional(
+000145c0: 6c61 6d62 6461 206e 6f64 653a 206e 6f74  lambda node: not
+000145d0: 2069 735f 7265 676d 6172 6b28 6e6f 6465   is_regmark(node
+000145e0: 2929 0d0a 2020 2020 4074 7265 655f 636f  ))..    @tree_co
+000145f0: 6e64 6974 696f 6e61 6c5f 7472 7928 6c61  nditional_try(la
+00014600: 6d62 6461 206e 6f64 653a 206e 6f64 652e  mbda node: node.
+00014610: 6361 6e5f 7363 616c 6529 0d0a 2020 2020  can_scale)..    
+00014620: 4074 7265 655f 6f70 6572 6174 696f 6e28  @tree_operation(
+00014630: 0d0a 2020 2020 2020 2020 5f28 2248 6f72  ..        _("Hor
+00014640: 697a 6f6e 7461 6c6c 7922 292c 0d0a 2020  izontally"),..  
+00014650: 2020 2020 2020 6e6f 6465 5f74 7970 653d        node_type=
+00014660: 656c 656d 5f67 726f 7570 5f6e 6f64 6573  elem_group_nodes
+00014670: 2c0d 0a20 2020 2020 2020 2068 656c 703d  ,..        help=
+00014680: 5f28 224d 6972 726f 7220 486f 7269 7a6f  _("Mirror Horizo
+00014690: 6e74 616c 6c79 2229 2c0d 0a20 2020 2029  ntally"),..    )
+000146a0: 0d0a 2020 2020 6465 6620 6d69 7272 6f72  ..    def mirror
+000146b0: 5f65 6c65 6d28 6e6f 6465 2c20 2a2a 6b77  _elem(node, **kw
+000146c0: 6172 6773 293a 0d0a 2020 2020 2020 2020  args):..        
+000146d0: 626f 756e 6473 203d 2073 656c 662e 5f65  bounds = self._e
+000146e0: 6d70 6861 7369 7a65 645f 626f 756e 6473  mphasized_bounds
+000146f0: 0d0a 2020 2020 2020 2020 6966 2062 6f75  ..        if bou
+00014700: 6e64 7320 6973 204e 6f6e 653a 0d0a 2020  nds is None:..  
+00014710: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00014720: 0d0a 2020 2020 2020 2020 6365 6e74 6572  ..        center
+00014730: 5f78 203d 2028 626f 756e 6473 5b32 5d20  _x = (bounds[2] 
+00014740: 2b20 626f 756e 6473 5b30 5d29 202f 2032  + bounds[0]) / 2
+00014750: 2e30 0d0a 2020 2020 2020 2020 6365 6e74  .0..        cent
+00014760: 6572 5f79 203d 2028 626f 756e 6473 5b33  er_y = (bounds[3
+00014770: 5d20 2b20 626f 756e 6473 5b31 5d29 202f  ] + bounds[1]) /
+00014780: 2032 2e30 0d0a 2020 2020 2020 2020 7365   2.0..        se
+00014790: 6c66 2866 2273 6361 6c65 202d 3120 3120  lf(f"scale -1 1 
+000147a0: 7b63 656e 7465 725f 787d 207b 6365 6e74  {center_x} {cent
+000147b0: 6572 5f79 7d5c 6e22 290d 0a0d 0a20 2020  er_y}\n")....   
+000147c0: 2040 7472 6565 5f63 6f6e 6469 7469 6f6e   @tree_condition
+000147d0: 616c 286c 616d 6264 6120 6e6f 6465 3a20  al(lambda node: 
+000147e0: 6e6f 7420 6973 5f72 6567 6d61 726b 286e  not is_regmark(n
+000147f0: 6f64 6529 290d 0a20 2020 2040 7472 6565  ode))..    @tree
+00014800: 5f73 7562 6d65 6e75 285f 2822 466c 6970  _submenu(_("Flip
+00014810: 2229 290d 0a20 2020 2040 7472 6565 5f63  "))..    @tree_c
+00014820: 6f6e 6469 7469 6f6e 616c 5f74 7279 286c  onditional_try(l
+00014830: 616d 6264 6120 6e6f 6465 3a20 6e6f 6465  ambda node: node
+00014840: 2e63 616e 5f73 6361 6c65 290d 0a20 2020  .can_scale)..   
+00014850: 2040 7472 6565 5f6f 7065 7261 7469 6f6e   @tree_operation
+00014860: 280d 0a20 2020 2020 2020 205f 2822 5665  (..        _("Ve
+00014870: 7274 6963 616c 6c79 2229 2c0d 0a20 2020  rtically"),..   
+00014880: 2020 2020 206e 6f64 655f 7479 7065 3d65       node_type=e
+00014890: 6c65 6d5f 6772 6f75 705f 6e6f 6465 732c  lem_group_nodes,
+000148a0: 0d0a 2020 2020 2020 2020 6865 6c70 3d5f  ..        help=_
+000148b0: 2822 466c 6970 2056 6572 7469 6361 6c6c  ("Flip Verticall
+000148c0: 7922 292c 0d0a 2020 2020 290d 0a20 2020  y"),..    )..   
+000148d0: 2064 6566 2066 6c69 705f 656c 656d 286e   def flip_elem(n
+000148e0: 6f64 652c 202a 2a6b 7761 7267 7329 3a0d  ode, **kwargs):.
+000148f0: 0a20 2020 2020 2020 2062 6f75 6e64 7320  .        bounds 
+00014900: 3d20 7365 6c66 2e5f 656d 7068 6173 697a  = self._emphasiz
+00014910: 6564 5f62 6f75 6e64 730d 0a20 2020 2020  ed_bounds..     
+00014920: 2020 2069 6620 626f 756e 6473 2069 7320     if bounds is 
+00014930: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
+00014940: 2020 2072 6574 7572 6e0d 0a20 2020 2020     return..     
+00014950: 2020 2063 656e 7465 725f 7820 3d20 2862     center_x = (b
+00014960: 6f75 6e64 735b 325d 202b 2062 6f75 6e64  ounds[2] + bound
+00014970: 735b 305d 2920 2f20 322e 300d 0a20 2020  s[0]) / 2.0..   
+00014980: 2020 2020 2063 656e 7465 725f 7920 3d20       center_y = 
+00014990: 2862 6f75 6e64 735b 335d 202b 2062 6f75  (bounds[3] + bou
+000149a0: 6e64 735b 315d 2920 2f20 322e 300d 0a20  nds[1]) / 2.0.. 
+000149b0: 2020 2020 2020 2073 656c 6628 6622 7363         self(f"sc
+000149c0: 616c 6520 3120 2d31 207b 6365 6e74 6572  ale 1 -1 {center
+000149d0: 5f78 7d20 7b63 656e 7465 725f 797d 5c6e  _x} {center_y}\n
+000149e0: 2229 0d0a 0d0a 2020 2020 4074 7265 655f  ")....    @tree_
+000149f0: 636f 6e64 6974 696f 6e61 6c28 6c61 6d62  conditional(lamb
+00014a00: 6461 206e 6f64 653a 206e 6f74 2069 735f  da node: not is_
+00014a10: 7265 676d 6172 6b28 6e6f 6465 2929 0d0a  regmark(node))..
+00014a20: 2020 2020 4074 7265 655f 636f 6e64 6974      @tree_condit
+00014a30: 696f 6e61 6c5f 7472 7928 6c61 6d62 6461  ional_try(lambda
+00014a40: 206e 6f64 653a 206e 6f64 652e 6361 6e5f   node: node.can_
+00014a50: 7363 616c 6529 0d0a 2020 2020 4074 7265  scale)..    @tre
+00014a60: 655f 7375 626d 656e 7528 5f28 2253 6361  e_submenu(_("Sca
+00014a70: 6c65 2229 290d 0a20 2020 2040 7472 6565  le"))..    @tree
+00014a80: 5f69 7465 7261 7465 2822 7363 616c 6522  _iterate("scale"
+00014a90: 2c20 3235 2c20 312c 202d 3129 0d0a 2020  , 25, 1, -1)..  
+00014aa0: 2020 4074 7265 655f 6361 6c63 2822 7363    @tree_calc("sc
+00014ab0: 616c 655f 7065 7263 656e 7422 2c20 6c61  ale_percent", la
+00014ac0: 6d62 6461 2069 3a20 6622 7b28 3630 302e  mbda i: f"{(600.
+00014ad0: 3020 2f20 666c 6f61 7428 6929 293a 2e32  0 / float(i)):.2
+00014ae0: 667d 2229 0d0a 2020 2020 4074 7265 655f  f}")..    @tree_
+00014af0: 6f70 6572 6174 696f 6e28 0d0a 2020 2020  operation(..    
+00014b00: 2020 2020 5f28 2253 6361 6c65 207b 7363      _("Scale {sc
+00014b10: 616c 655f 7065 7263 656e 747d 2522 292c  ale_percent}%"),
+00014b20: 0d0a 2020 2020 2020 2020 6e6f 6465 5f74  ..        node_t
+00014b30: 7970 653d 656c 656d 5f67 726f 7570 5f6e  ype=elem_group_n
+00014b40: 6f64 6573 2c0d 0a20 2020 2020 2020 2068  odes,..        h
+00014b50: 656c 703d 5f28 2253 6361 6c65 2045 6c65  elp=_("Scale Ele
+00014b60: 6d65 6e74 2229 2c0d 0a20 2020 2029 0d0a  ment"),..    )..
+00014b70: 2020 2020 6465 6620 7363 616c 655f 656c      def scale_el
+00014b80: 656d 5f61 6d6f 756e 7428 6e6f 6465 2c20  em_amount(node, 
+00014b90: 7363 616c 652c 202a 2a6b 7761 7267 7329  scale, **kwargs)
+00014ba0: 3a0d 0a20 2020 2020 2020 2073 6361 6c65  :..        scale
+00014bb0: 203d 2036 2e30 202f 2066 6c6f 6174 2873   = 6.0 / float(s
+00014bc0: 6361 6c65 290d 0a20 2020 2020 2020 2062  cale)..        b
+00014bd0: 6f75 6e64 7320 3d20 7365 6c66 2e5f 656d  ounds = self._em
+00014be0: 7068 6173 697a 6564 5f62 6f75 6e64 730d  phasized_bounds.
+00014bf0: 0a20 2020 2020 2020 2069 6620 626f 756e  .        if boun
+00014c00: 6473 2069 7320 4e6f 6e65 3a0d 0a20 2020  ds is None:..   
+00014c10: 2020 2020 2020 2020 2072 6574 7572 6e0d           return.
+00014c20: 0a20 2020 2020 2020 2063 656e 7465 725f  .        center_
+00014c30: 7820 3d20 2862 6f75 6e64 735b 325d 202b  x = (bounds[2] +
+00014c40: 2062 6f75 6e64 735b 305d 2920 2f20 322e   bounds[0]) / 2.
+00014c50: 300d 0a20 2020 2020 2020 2063 656e 7465  0..        cente
+00014c60: 725f 7920 3d20 2862 6f75 6e64 735b 335d  r_y = (bounds[3]
+00014c70: 202b 2062 6f75 6e64 735b 315d 2920 2f20   + bounds[1]) / 
+00014c80: 322e 300d 0a20 2020 2020 2020 2073 656c  2.0..        sel
+00014c90: 6628 6622 7363 616c 6520 7b73 6361 6c65  f(f"scale {scale
+00014ca0: 7d20 7b73 6361 6c65 7d20 7b63 656e 7465  } {scale} {cente
+00014cb0: 725f 787d 207b 6365 6e74 6572 5f79 7d5c  r_x} {center_y}\
+00014cc0: 6e22 290d 0a0d 0a20 2020 2023 2040 7472  n")....    # @tr
+00014cd0: 6565 5f63 6f6e 6469 7469 6f6e 616c 286c  ee_conditional(l
+00014ce0: 616d 6264 6120 6e6f 6465 3a20 6973 696e  ambda node: isin
+00014cf0: 7374 616e 6365 286e 6f64 652e 6f62 6a65  stance(node.obje
+00014d00: 6374 2c20 5356 4745 6c65 6d65 6e74 2929  ct, SVGElement))
+00014d10: 0d0a 2020 2020 4074 7265 655f 636f 6e64  ..    @tree_cond
+00014d20: 6974 696f 6e61 6c28 6c61 6d62 6461 206e  itional(lambda n
+00014d30: 6f64 653a 206e 6f74 2069 735f 7265 676d  ode: not is_regm
+00014d40: 6172 6b28 6e6f 6465 2929 0d0a 2020 2020  ark(node))..    
+00014d50: 4074 7265 655f 636f 6e64 6974 696f 6e61  @tree_conditiona
+00014d60: 6c5f 7472 7928 6c61 6d62 6461 206e 6f64  l_try(lambda nod
+00014d70: 653a 206e 6f64 652e 6361 6e5f 726f 7461  e: node.can_rota
+00014d80: 7465 290d 0a20 2020 2040 7472 6565 5f73  te)..    @tree_s
+00014d90: 7562 6d65 6e75 285f 2822 526f 7461 7465  ubmenu(_("Rotate
+00014da0: 2229 290d 0a20 2020 2040 7472 6565 5f76  "))..    @tree_v
+00014db0: 616c 7565 7328 0d0a 2020 2020 2020 2020  alues(..        
+00014dc0: 2261 6e67 6c65 222c 0d0a 2020 2020 2020  "angle",..      
+00014dd0: 2020 280d 0a20 2020 2020 2020 2020 2020    (..           
+00014de0: 2031 3830 2c0d 0a20 2020 2020 2020 2020   180,..         
+00014df0: 2020 2031 3530 2c0d 0a20 2020 2020 2020     150,..       
+00014e00: 2020 2020 2031 3335 2c0d 0a20 2020 2020       135,..     
+00014e10: 2020 2020 2020 2031 3230 2c0d 0a20 2020         120,..   
+00014e20: 2020 2020 2020 2020 2039 302c 0d0a 2020           90,..  
+00014e30: 2020 2020 2020 2020 2020 3630 2c0d 0a20            60,.. 
+00014e40: 2020 2020 2020 2020 2020 2034 352c 0d0a             45,..
+00014e50: 2020 2020 2020 2020 2020 2020 3330 2c0d              30,.
+00014e60: 0a20 2020 2020 2020 2020 2020 2032 302c  .            20,
+00014e70: 0d0a 2020 2020 2020 2020 2020 2020 3135  ..            15
+00014e80: 2c0d 0a20 2020 2020 2020 2020 2020 2031  ,..            1
+00014e90: 302c 0d0a 2020 2020 2020 2020 2020 2020  0,..            
+00014ea0: 352c 0d0a 2020 2020 2020 2020 2020 2020  5,..            
+00014eb0: 342c 0d0a 2020 2020 2020 2020 2020 2020  4,..            
+00014ec0: 332c 0d0a 2020 2020 2020 2020 2020 2020  3,..            
+00014ed0: 322c 0d0a 2020 2020 2020 2020 2020 2020  2,..            
+00014ee0: 312c 0d0a 2020 2020 2020 2020 2020 2020  1,..            
+00014ef0: 2d31 2c0d 0a20 2020 2020 2020 2020 2020  -1,..           
+00014f00: 202d 322c 0d0a 2020 2020 2020 2020 2020   -2,..          
+00014f10: 2020 2d33 2c0d 0a20 2020 2020 2020 2020    -3,..         
+00014f20: 2020 202d 342c 0d0a 2020 2020 2020 2020     -4,..        
+00014f30: 2020 2020 2d35 2c0d 0a20 2020 2020 2020      -5,..       
+00014f40: 2020 2020 202d 3130 2c0d 0a20 2020 2020       -10,..     
+00014f50: 2020 2020 2020 202d 3135 2c0d 0a20 2020         -15,..   
+00014f60: 2020 2020 2020 2020 202d 3230 2c0d 0a20           -20,.. 
+00014f70: 2020 2020 2020 2020 2020 202d 3330 2c0d             -30,.
+00014f80: 0a20 2020 2020 2020 2020 2020 202d 3435  .            -45
+00014f90: 2c0d 0a20 2020 2020 2020 2020 2020 202d  ,..            -
+00014fa0: 3630 2c0d 0a20 2020 2020 2020 2020 2020  60,..           
+00014fb0: 202d 3930 2c0d 0a20 2020 2020 2020 2029   -90,..        )
+00014fc0: 2c0d 0a20 2020 2029 0d0a 2020 2020 4074  ,..    )..    @t
+00014fd0: 7265 655f 6f70 6572 6174 696f 6e28 5f28  ree_operation(_(
+00014fe0: 2252 6f74 6174 6520 7b61 6e67 6c65 7dc2  "Rotate {angle}.
+00014ff0: b022 292c 206e 6f64 655f 7479 7065 3d65  ."), node_type=e
+00015000: 6c65 6d5f 6772 6f75 705f 6e6f 6465 732c  lem_group_nodes,
+00015010: 2068 656c 703d 2222 290d 0a20 2020 2064   help="")..    d
+00015020: 6566 2072 6f74 6174 655f 656c 656d 5f61  ef rotate_elem_a
+00015030: 6d6f 756e 7428 6e6f 6465 2c20 616e 676c  mount(node, angl
+00015040: 652c 202a 2a6b 7761 7267 7329 3a0d 0a20  e, **kwargs):.. 
+00015050: 2020 2020 2020 2074 7572 6e73 203d 2066         turns = f
+00015060: 6c6f 6174 2861 6e67 6c65 2920 2f20 3336  loat(angle) / 36
+00015070: 302e 300d 0a20 2020 2020 2020 2062 6f75  0.0..        bou
+00015080: 6e64 7320 3d20 7365 6c66 2e5f 656d 7068  nds = self._emph
+00015090: 6173 697a 6564 5f62 6f75 6e64 730d 0a20  asized_bounds.. 
+000150a0: 2020 2020 2020 2069 6620 626f 756e 6473         if bounds
+000150b0: 2069 7320 4e6f 6e65 3a0d 0a20 2020 2020   is None:..     
+000150c0: 2020 2020 2020 2072 6574 7572 6e0d 0a20         return.. 
+000150d0: 2020 2020 2020 2063 656e 7465 725f 7820         center_x 
+000150e0: 3d20 2862 6f75 6e64 735b 325d 202b 2062  = (bounds[2] + b
+000150f0: 6f75 6e64 735b 305d 2920 2f20 322e 300d  ounds[0]) / 2.0.
+00015100: 0a20 2020 2020 2020 2063 656e 7465 725f  .        center_
+00015110: 7920 3d20 2862 6f75 6e64 735b 335d 202b  y = (bounds[3] +
+00015120: 2062 6f75 6e64 735b 315d 2920 2f20 322e   bounds[1]) / 2.
+00015130: 300d 0a20 2020 2020 2020 2073 656c 6628  0..        self(
+00015140: 6622 726f 7461 7465 207b 7475 726e 737d  f"rotate {turns}
+00015150: 7475 726e 207b 6365 6e74 6572 5f78 7d20  turn {center_x} 
+00015160: 7b63 656e 7465 725f 797d 5c6e 2229 0d0a  {center_y}\n")..
+00015170: 2020 2020 2020 2020 7365 6c66 2e73 6967          self.sig
+00015180: 6e61 6c28 2265 7874 2d6d 6f64 6966 6965  nal("ext-modifie
+00015190: 6422 290d 0a0d 0a20 2020 2040 7472 6565  d")....    @tree
+000151a0: 5f63 6f6e 6469 7469 6f6e 616c 286c 616d  _conditional(lam
+000151b0: 6264 6120 6e6f 6465 3a20 6e6f 7420 6973  bda node: not is
+000151c0: 5f72 6567 6d61 726b 286e 6f64 6529 290d  _regmark(node)).
+000151d0: 0a20 2020 2040 7472 6565 5f63 6f6e 6469  .    @tree_condi
+000151e0: 7469 6f6e 616c 286c 616d 6264 6120 6e6f  tional(lambda no
+000151f0: 6465 3a20 6861 735f 6368 616e 6765 7328  de: has_changes(
+00015200: 6e6f 6465 2929 0d0a 2020 2020 4074 7265  node))..    @tre
+00015210: 655f 636f 6e64 6974 696f 6e61 6c5f 7472  e_conditional_tr
+00015220: 7928 6c61 6d62 6461 206e 6f64 653a 206e  y(lambda node: n
+00015230: 6f64 652e 6361 6e5f 6d6f 6469 6679 290d  ode.can_modify).
+00015240: 0a20 2020 2040 7472 6565 5f6f 7065 7261  .    @tree_opera
+00015250: 7469 6f6e 285f 2822 5265 6966 7920 5573  tion(_("Reify Us
+00015260: 6572 2043 6861 6e67 6573 2229 2c20 6e6f  er Changes"), no
+00015270: 6465 5f74 7970 653d 656c 656d 5f67 726f  de_type=elem_gro
+00015280: 7570 5f6e 6f64 6573 2c20 6865 6c70 3d22  up_nodes, help="
+00015290: 2229 0d0a 2020 2020 6465 6620 7265 6966  ")..    def reif
+000152a0: 795f 656c 656d 5f63 6861 6e67 6573 286e  y_elem_changes(n
+000152b0: 6f64 652c 202a 2a6b 7761 7267 7329 3a0d  ode, **kwargs):.
+000152c0: 0a20 2020 2020 2020 2073 656c 6628 2272  .        self("r
+000152d0: 6569 6679 5c6e 2229 0d0a 2020 2020 2020  eify\n")..      
+000152e0: 2020 7365 6c66 2e73 6967 6e61 6c28 2265    self.signal("e
+000152f0: 7874 2d6d 6f64 6966 6965 6422 290d 0a0d  xt-modified")...
+00015300: 0a20 2020 2040 7472 6565 5f63 6f6e 6469  .    @tree_condi
+00015310: 7469 6f6e 616c 286c 616d 6264 6120 6e6f  tional(lambda no
+00015320: 6465 3a20 6e6f 7420 6973 5f72 6567 6d61  de: not is_regma
+00015330: 726b 286e 6f64 6529 290d 0a20 2020 2040  rk(node))..    @
+00015340: 7472 6565 5f63 6f6e 6469 7469 6f6e 616c  tree_conditional
+00015350: 5f74 7279 286c 616d 6264 6120 6e6f 6465  _try(lambda node
+00015360: 3a20 6e6f 6465 2e63 616e 5f6d 6f64 6966  : node.can_modif
+00015370: 7929 0d0a 2020 2020 4074 7265 655f 6f70  y)..    @tree_op
+00015380: 6572 6174 696f 6e28 5f28 2242 7265 616b  eration(_("Break
+00015390: 2053 7562 7061 7468 7322 292c 206e 6f64   Subpaths"), nod
+000153a0: 655f 7479 7065 3d22 656c 656d 2070 6174  e_type="elem pat
+000153b0: 6822 2c20 6865 6c70 3d22 2229 0d0a 2020  h", help="")..  
+000153c0: 2020 6465 6620 6272 6561 6b5f 7375 6270    def break_subp
+000153d0: 6174 685f 656c 656d 286e 6f64 652c 202a  ath_elem(node, *
+000153e0: 2a6b 7761 7267 7329 3a0d 0a20 2020 2020  *kwargs):..     
+000153f0: 2020 2073 656c 6628 2265 6c65 6d65 6e74     self("element
+00015400: 2073 7562 7061 7468 5c6e 2229 0d0a 0d0a   subpath\n")....
+00015410: 2020 2020 4074 7265 655f 636f 6e64 6974      @tree_condit
+00015420: 696f 6e61 6c28 6c61 6d62 6461 206e 6f64  ional(lambda nod
+00015430: 653a 206e 6f74 2069 735f 7265 676d 6172  e: not is_regmar
+00015440: 6b28 6e6f 6465 2929 0d0a 2020 2020 4074  k(node))..    @t
+00015450: 7265 655f 636f 6e64 6974 696f 6e61 6c28  ree_conditional(
+00015460: 6c61 6d62 6461 206e 6f64 653a 2068 6173  lambda node: has
+00015470: 5f63 6861 6e67 6573 286e 6f64 6529 290d  _changes(node)).
+00015480: 0a20 2020 2040 7472 6565 5f63 6f6e 6469  .    @tree_condi
+00015490: 7469 6f6e 616c 5f74 7279 286c 616d 6264  tional_try(lambd
+000154a0: 6120 6e6f 6465 3a20 6e6f 6465 2e63 616e  a node: node.can
+000154b0: 5f6d 6f64 6966 7929 0d0a 2020 2020 4074  _modify)..    @t
+000154c0: 7265 655f 6f70 6572 6174 696f 6e28 5f28  ree_operation(_(
+000154d0: 2252 6573 6574 2075 7365 7220 6368 616e  "Reset user chan
+000154e0: 6765 7322 292c 206e 6f64 655f 7479 7065  ges"), node_type
+000154f0: 3d65 6c65 6d5f 6772 6f75 705f 6e6f 6465  =elem_group_node
+00015500: 732c 2068 656c 703d 2222 290d 0a20 2020  s, help="")..   
+00015510: 2064 6566 2072 6573 6574 5f75 7365 725f   def reset_user_
+00015520: 6368 616e 6765 7328 6e6f 6465 2c20 636f  changes(node, co
+00015530: 7069 6573 3d31 2c20 2a2a 6b77 6172 6773  pies=1, **kwargs
+00015540: 293a 0d0a 2020 2020 2020 2020 7365 6c66  ):..        self
+00015550: 2822 7265 7365 745c 6e22 290d 0a20 2020  ("reset\n")..   
+00015560: 2020 2020 2073 656c 662e 7369 676e 616c       self.signal
+00015570: 2822 6578 742d 6d6f 6469 6669 6564 2229  ("ext-modified")
+00015580: 0d0a 0d0a 2020 2020 4074 7265 655f 6f70  ....    @tree_op
+00015590: 6572 6174 696f 6e28 0d0a 2020 2020 2020  eration(..      
+000155a0: 2020 5f28 224d 6572 6765 2069 7465 6d73    _("Merge items
+000155b0: 2229 2c0d 0a20 2020 2020 2020 206e 6f64  "),..        nod
+000155c0: 655f 7479 7065 3d22 6772 6f75 7022 2c0d  e_type="group",.
+000155d0: 0a20 2020 2020 2020 2068 656c 703d 5f28  .        help=_(
+000155e0: 224d 6572 6765 2074 6869 7320 6e6f 6465  "Merge this node
+000155f0: 2773 2063 6869 6c64 7265 6e20 696e 746f  's children into
+00015600: 2031 2070 6174 682e 2229 2c0d 0a20 2020   1 path."),..   
+00015610: 2029 0d0a 2020 2020 6465 6620 6d65 7267   )..    def merg
+00015620: 655f 656c 656d 656e 7473 286e 6f64 652c  e_elements(node,
+00015630: 202a 2a6b 7761 7267 7329 3a0d 0a20 2020   **kwargs):..   
+00015640: 2020 2020 2073 656c 6628 2265 6c65 6d65       self("eleme
+00015650: 6e74 206d 6572 6765 5c6e 2229 0d0a 2020  nt merge\n")..  
+00015660: 2020 2020 2020 2320 4973 2074 6865 2067        # Is the g
+00015670: 726f 7570 206e 6f77 2065 6d70 7479 3f20  roup now empty? 
+00015680: 2d2d 3e20 6465 6c65 7465 0d0a 2020 2020  --> delete..    
+00015690: 2020 2020 6966 206c 656e 286e 6f64 652e      if len(node.
+000156a0: 6368 696c 6472 656e 2920 3d3d 2030 3a0d  children) == 0:.
+000156b0: 0a20 2020 2020 2020 2020 2020 206e 6f64  .            nod
+000156c0: 652e 7265 6d6f 7665 5f6e 6f64 6528 290d  e.remove_node().
+000156d0: 0a0d 0a20 2020 2040 7472 6565 5f63 6f6e  ...    @tree_con
+000156e0: 6469 7469 6f6e 616c 286c 616d 6264 6120  ditional(lambda 
+000156f0: 6e6f 6465 3a20 6e6f 6465 2e6c 6f63 6b29  node: node.lock)
+00015700: 0d0a 2020 2020 4074 7265 655f 7365 7061  ..    @tree_sepa
+00015710: 7261 746f 725f 6265 666f 7265 2829 0d0a  rator_before()..
+00015720: 2020 2020 4074 7265 655f 6f70 6572 6174      @tree_operat
+00015730: 696f 6e28 0d0a 2020 2020 2020 2020 5f28  ion(..        _(
+00015740: 2255 6e6c 6f63 6b20 656c 656d 656e 742c  "Unlock element,
+00015750: 2061 6c6c 6f77 7320 6d61 6e69 7075 6c61   allows manipula
+00015760: 7469 6f6e 2229 2c20 6e6f 6465 5f74 7970  tion"), node_typ
+00015770: 653d 656c 656d 5f6e 6f64 6573 2c20 6865  e=elem_nodes, he
+00015780: 6c70 3d22 220d 0a20 2020 2029 0d0a 2020  lp=""..    )..  
+00015790: 2020 6465 6620 656c 656d 656e 745f 756e    def element_un
+000157a0: 6c6f 636b 5f6d 616e 6970 756c 6174 696f  lock_manipulatio
+000157b0: 6e73 286e 6f64 652c 202a 2a6b 7761 7267  ns(node, **kwarg
+000157c0: 7329 3a0d 0a20 2020 2020 2020 2073 656c  s):..        sel
+000157d0: 6628 2265 6c65 6d65 6e74 2075 6e6c 6f63  f("element unloc
+000157e0: 6b5c 6e22 290d 0a0d 0a20 2020 2040 7472  k\n")....    @tr
+000157f0: 6565 5f63 6f6e 6469 7469 6f6e 616c 286c  ee_conditional(l
+00015800: 616d 6264 6120 6e6f 6465 3a20 6e6f 7420  ambda node: not 
+00015810: 6e6f 6465 2e6c 6f63 6b29 0d0a 2020 2020  node.lock)..    
+00015820: 4074 7265 655f 7365 7061 7261 746f 725f  @tree_separator_
+00015830: 6265 666f 7265 2829 0d0a 2020 2020 4074  before()..    @t
+00015840: 7265 655f 6f70 6572 6174 696f 6e28 0d0a  ree_operation(..
+00015850: 2020 2020 2020 2020 5f28 224c 6f63 6b20          _("Lock 
+00015860: 656c 656d 656e 7473 2c20 7072 6576 656e  elements, preven
+00015870: 7473 206d 616e 6970 756c 6174 696f 6e73  ts manipulations
+00015880: 2229 2c20 6e6f 6465 5f74 7970 653d 656c  "), node_type=el
+00015890: 656d 5f6e 6f64 6573 2c20 6865 6c70 3d22  em_nodes, help="
+000158a0: 220d 0a20 2020 2029 0d0a 2020 2020 6465  "..    )..    de
+000158b0: 6620 656c 656d 656e 745f 6c6f 636b 5f6d  f element_lock_m
+000158c0: 616e 6970 756c 6174 696f 6e73 286e 6f64  anipulations(nod
+000158d0: 652c 202a 2a6b 7761 7267 7329 3a0d 0a20  e, **kwargs):.. 
+000158e0: 2020 2020 2020 2073 656c 6628 2265 6c65         self("ele
+000158f0: 6d65 6e74 206c 6f63 6b5c 6e22 290d 0a0d  ment lock\n")...
+00015900: 0a20 2020 2040 7472 6565 5f63 6f6e 6469  .    @tree_condi
+00015910: 7469 6f6e 616c 286c 616d 6264 6120 6e6f  tional(lambda no
+00015920: 6465 3a20 6e6f 6465 2e74 7970 6520 3d3d  de: node.type ==
+00015930: 2022 6272 616e 6368 2072 6567 2229 0d0a   "branch reg")..
+00015940: 2020 2020 4074 7265 655f 7365 7061 7261      @tree_separa
+00015950: 746f 725f 6265 666f 7265 2829 0d0a 2020  tor_before()..  
+00015960: 2020 4074 7265 655f 6f70 6572 6174 696f    @tree_operatio
+00015970: 6e28 5f28 2254 6f67 676c 6520 7669 7369  n(_("Toggle visi
+00015980: 6269 6c69 7479 206f 6620 7265 676d 6172  bility of regmar
+00015990: 6b73 2229 2c20 6e6f 6465 5f74 7970 653d  ks"), node_type=
+000159a0: 2262 7261 6e63 6820 7265 6722 2c20 6865  "branch reg", he
+000159b0: 6c70 3d22 2229 0d0a 2020 2020 6465 6620  lp="")..    def 
+000159c0: 746f 6767 6c65 5f76 6973 6962 696c 6974  toggle_visibilit
+000159d0: 7928 6e6f 6465 2c20 2a2a 6b77 6172 6773  y(node, **kwargs
+000159e0: 293a 0d0a 2020 2020 2020 2020 7365 6c66  ):..        self
+000159f0: 2e73 6967 6e61 6c28 2274 6f67 676c 655f  .signal("toggle_
+00015a00: 7265 676d 6172 6b73 2229 0d0a 0d0a 2020  regmarks")....  
+00015a10: 2020 4074 7265 655f 636f 6e64 6974 696f    @tree_conditio
+00015a20: 6e61 6c28 6c61 6d62 6461 206e 6f64 653a  nal(lambda node:
+00015a30: 2069 735f 7265 676d 6172 6b28 6e6f 6465   is_regmark(node
+00015a40: 2929 0d0a 2020 2020 4074 7265 655f 7365  ))..    @tree_se
+00015a50: 7061 7261 746f 725f 6265 666f 7265 2829  parator_before()
+00015a60: 0d0a 2020 2020 4074 7265 655f 6f70 6572  ..    @tree_oper
+00015a70: 6174 696f 6e28 5f28 224d 6f76 6520 6261  ation(_("Move ba
+00015a80: 636b 2074 6f20 656c 656d 656e 7473 2229  ck to elements")
+00015a90: 2c20 6e6f 6465 5f74 7970 653d 656c 656d  , node_type=elem
+00015aa0: 5f67 726f 7570 5f6e 6f64 6573 2c20 6865  _group_nodes, he
+00015ab0: 6c70 3d22 2229 0d0a 2020 2020 6465 6620  lp="")..    def 
+00015ac0: 6d6f 7665 5f62 6163 6b28 6e6f 6465 2c20  move_back(node, 
+00015ad0: 2a2a 6b77 6172 6773 293a 0d0a 2020 2020  **kwargs):..    
+00015ae0: 2020 2020 2320 4472 6167 2061 6e64 2044      # Drag and D
+00015af0: 726f 700d 0a20 2020 2020 2020 2077 6974  rop..        wit
+00015b00: 6820 7365 6c66 2e73 7461 7469 6328 226d  h self.static("m
+00015b10: 6f76 655f 6261 636b 2229 3a0d 0a20 2020  ove_back"):..   
+00015b20: 2020 2020 2020 2020 2073 6967 6e61 6c5f           signal_
+00015b30: 6e65 6564 6564 203d 2046 616c 7365 0d0a  needed = False..
+00015b40: 2020 2020 2020 2020 2020 2020 6472 6f70              drop
+00015b50: 5f6e 6f64 6520 3d20 7365 6c66 2e65 6c65  _node = self.ele
+00015b60: 6d5f 6272 616e 6368 0d0a 2020 2020 2020  m_branch..      
+00015b70: 2020 2020 2020 6461 7461 203d 206c 6973        data = lis
+00015b80: 7428 290d 0a20 2020 2020 2020 2020 2020  t()..           
+00015b90: 2066 6f72 2069 7465 6d20 696e 206c 6973   for item in lis
+00015ba0: 7428 7365 6c66 2e72 6567 6d61 726b 7328  t(self.regmarks(
+00015bb0: 2929 3a0d 0a20 2020 2020 2020 2020 2020  )):..           
+00015bc0: 2020 2020 2069 6620 6974 656d 2e73 656c       if item.sel
+00015bd0: 6563 7465 643a 0d0a 2020 2020 2020 2020  ected:..        
+00015be0: 2020 2020 2020 2020 2020 2020 6461 7461              data
+00015bf0: 2e61 7070 656e 6428 6974 656d 290d 0a20  .append(item).. 
+00015c00: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
+00015c10: 7465 6d20 696e 2064 6174 613a 0d0a 2020  tem in data:..  
+00015c20: 2020 2020 2020 2020 2020 2020 2020 6472                dr
+00015c30: 6f70 5f6e 6f64 652e 6472 6f70 2869 7465  op_node.drop(ite
+00015c40: 6d29 0d0a 2020 2020 2020 2020 2020 2020  m)..            
+00015c50: 2020 2020 7369 676e 616c 5f6e 6565 6465      signal_neede
+00015c60: 6420 3d20 5472 7565 0d0a 0d0a 2020 2020  d = True....    
+00015c70: 4074 7265 655f 636f 6e64 6974 696f 6e61  @tree_conditiona
+00015c80: 6c28 6c61 6d62 6461 206e 6f64 653a 206e  l(lambda node: n
+00015c90: 6f74 2069 735f 7265 676d 6172 6b28 6e6f  ot is_regmark(no
+00015ca0: 6465 2929 0d0a 2020 2020 4074 7265 655f  de))..    @tree_
+00015cb0: 7365 7061 7261 746f 725f 6265 666f 7265  separator_before
+00015cc0: 2829 0d0a 2020 2020 4074 7265 655f 6f70  ()..    @tree_op
+00015cd0: 6572 6174 696f 6e28 5f28 224d 6f76 6520  eration(_("Move 
+00015ce0: 746f 2072 6567 6d61 726b 7322 292c 206e  to regmarks"), n
+00015cf0: 6f64 655f 7479 7065 3d65 6c65 6d5f 6772  ode_type=elem_gr
+00015d00: 6f75 705f 6e6f 6465 732c 2068 656c 703d  oup_nodes, help=
+00015d10: 2222 290d 0a20 2020 2064 6566 206d 6f76  "")..    def mov
+00015d20: 655f 746f 5f72 6567 6d61 726b 286e 6f64  e_to_regmark(nod
+00015d30: 652c 202a 2a6b 7761 7267 7329 3a0d 0a20  e, **kwargs):.. 
+00015d40: 2020 2020 2020 2023 2044 7261 6720 616e         # Drag an
+00015d50: 6420 4472 6f70 0d0a 2020 2020 2020 2020  d Drop..        
+00015d60: 7769 7468 2073 656c 662e 7374 6174 6963  with self.static
+00015d70: 2822 6d6f 7665 5f74 6f5f 7265 6722 293a  ("move_to_reg"):
+00015d80: 0d0a 2020 2020 2020 2020 2020 2020 6472  ..            dr
+00015d90: 6f70 5f6e 6f64 6520 3d20 7365 6c66 2e72  op_node = self.r
+00015da0: 6567 5f62 7261 6e63 680d 0a20 2020 2020  eg_branch..     
+00015db0: 2020 2020 2020 2064 6174 6120 3d20 6c69         data = li
+00015dc0: 7374 2829 0d0a 2020 2020 2020 2020 2020  st()..          
+00015dd0: 2020 666f 7220 6974 656d 2069 6e20 6c69    for item in li
+00015de0: 7374 2873 656c 662e 656c 656d 735f 6e6f  st(self.elems_no
+00015df0: 6465 7328 2929 3a0d 0a20 2020 2020 2020  des()):..       
+00015e00: 2020 2020 2020 2020 2069 6620 6974 656d           if item
+00015e10: 2e73 656c 6563 7465 643a 0d0a 2020 2020  .selected:..    
+00015e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015e30: 6461 7461 2e61 7070 656e 6428 6974 656d  data.append(item
+00015e40: 290d 0a20 2020 2020 2020 2020 2020 2066  )..            f
+00015e50: 6f72 2069 7465 6d20 696e 2064 6174 613a  or item in data:
+00015e60: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00015e70: 2020 2320 4e6f 2075 7365 6361 7365 2066    # No usecase f
+00015e80: 6f72 2068 6176 696e 6720 6120 6c6f 636b  or having a lock
+00015e90: 6564 2072 6567 6d61 726b 2065 6c65 6d65  ed regmark eleme
+00015ea0: 6e74 0d0a 2020 2020 2020 2020 2020 2020  nt..            
+00015eb0: 2020 2020 6966 2068 6173 6174 7472 2869      if hasattr(i
+00015ec0: 7465 6d2c 2022 6c6f 636b 2229 3a0d 0a20  tem, "lock"):.. 
+00015ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015ee0: 2020 2069 7465 6d2e 6c6f 636b 203d 2046     item.lock = F
+00015ef0: 616c 7365 0d0a 2020 2020 2020 2020 2020  alse..          
+00015f00: 2020 2020 2020 6472 6f70 5f6e 6f64 652e        drop_node.
+00015f10: 6472 6f70 2869 7465 6d29 0d0a 0d0a 2020  drop(item)....  
+00015f20: 2020 4074 7265 655f 636f 6e64 6974 696f    @tree_conditio
+00015f30: 6e61 6c28 6c61 6d62 6461 206e 6f64 653a  nal(lambda node:
+00015f40: 2069 735f 7265 676d 6172 6b28 6e6f 6465   is_regmark(node
+00015f50: 2929 0d0a 2020 2020 4074 7265 655f 7365  ))..    @tree_se
+00015f60: 7061 7261 746f 725f 6265 666f 7265 2829  parator_before()
+00015f70: 0d0a 2020 2020 4074 7265 655f 6f70 6572  ..    @tree_oper
+00015f80: 6174 696f 6e28 5f28 2243 7265 6174 6520  ation(_("Create 
+00015f90: 706c 6163 656d 656e 7422 292c 206e 6f64  placement"), nod
+00015fa0: 655f 7479 7065 3d65 6c65 6d5f 6e6f 6465  e_type=elem_node
+00015fb0: 732c 2068 656c 703d 2222 290d 0a20 2020  s, help="")..   
+00015fc0: 2064 6566 2072 6567 6d61 726b 5f61 735f   def regmark_as_
+00015fd0: 706c 6163 656d 656e 7428 6e6f 6465 2c20  placement(node, 
+00015fe0: 2a2a 6b77 6172 6773 293a 0d0a 2020 2020  **kwargs):..    
+00015ff0: 2020 2020 6966 206e 6f64 6520 6973 204e      if node is N
+00016000: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
+00016010: 2020 7265 7475 726e 0d0a 2020 2020 2020    return..      
+00016020: 2020 6966 2068 6173 6174 7472 286e 6f64    if hasattr(nod
+00016030: 652c 2022 7061 7468 2229 3a0d 0a20 2020  e, "path"):..   
+00016040: 2020 2020 2020 2020 2062 6220 3d20 6e6f           bb = no
+00016050: 6465 2e70 6174 682e 6262 6f78 2874 7261  de.path.bbox(tra
+00016060: 6e73 666f 726d 6564 3d46 616c 7365 290d  nsformed=False).
+00016070: 0a20 2020 2020 2020 2065 6c69 6620 6861  .        elif ha
+00016080: 7361 7474 7228 6e6f 6465 2c20 2273 6861  sattr(node, "sha
+00016090: 7065 2229 3a0d 0a20 2020 2020 2020 2020  pe"):..         
+000160a0: 2020 2062 6220 3d20 6e6f 6465 2e73 6861     bb = node.sha
+000160b0: 7065 2e62 626f 7828 7472 616e 7366 6f72  pe.bbox(transfor
+000160c0: 6d65 643d 4661 6c73 6529 0d0a 2020 2020  med=False)..    
+000160d0: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
+000160e0: 2020 2020 2020 2072 6574 7572 6e0d 0a20         return.. 
+000160f0: 2020 2020 2020 2069 6620 6262 2069 7320         if bb is 
+00016100: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
+00016110: 2020 2072 6574 7572 6e0d 0a20 2020 2020     return..     
+00016120: 2020 2078 203d 2062 625b 305d 0d0a 2020     x = bb[0]..  
+00016130: 2020 2020 2020 7920 3d20 6262 5b31 5d0d        y = bb[1].
+00016140: 0a20 2020 2020 2020 2063 6f72 6e65 7220  .        corner 
+00016150: 3d20 300d 0a20 2020 2020 2020 2074 7279  = 0..        try
+00016160: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
+00016170: 6f74 6174 696f 6e20 3d20 6e6f 6465 2e6d  otation = node.m
+00016180: 6174 7269 782e 726f 7461 7469 6f6e 2e61  atrix.rotation.a
+00016190: 735f 7261 6469 616e 730d 0a20 2020 2020  s_radians..     
+000161a0: 2020 2065 7863 6570 7420 4174 7472 6962     except Attrib
+000161b0: 7574 6545 7272 6f72 3a0d 0a20 2020 2020  uteError:..     
+000161c0: 2020 2020 2020 2072 6f74 6174 696f 6e20         rotation 
+000161d0: 3d20 300d 0a20 2020 2020 2020 2070 7420  = 0..        pt 
+000161e0: 3d20 6e6f 6465 2e6d 6174 7269 782e 706f  = node.matrix.po
+000161f0: 696e 745f 696e 5f6d 6174 7269 785f 7370  int_in_matrix_sp
+00016200: 6163 6528 506f 696e 7428 6262 5b30 5d2c  ace(Point(bb[0],
+00016210: 2062 625b 315d 2929 0d0a 2020 2020 2020   bb[1]))..      
+00016220: 2020 7820 3d20 7074 2e78 0d0a 2020 2020    x = pt.x..    
+00016230: 2020 2020 7920 3d20 7074 2e79 0d0a 2020      y = pt.y..  
+00016240: 2020 2020 2020 706c 6163 655f 6e6f 6465        place_node
+00016250: 203d 2073 656c 662e 6f70 5f62 7261 6e63   = self.op_branc
+00016260: 682e 6164 6428 0d0a 2020 2020 2020 2020  h.add(..        
+00016270: 2020 2020 7479 7065 3d22 706c 6163 6520      type="place 
+00016280: 706f 696e 7422 2c20 783d 782c 2079 3d79  point", x=x, y=y
+00016290: 2c20 636f 726e 6572 3d63 6f72 6e65 722c  , corner=corner,
+000162a0: 2072 6f74 6174 696f 6e3d 726f 7461 7469   rotation=rotati
+000162b0: 6f6e 0d0a 2020 2020 2020 2020 290d 0a20  on..        ).. 
+000162c0: 2020 2020 2020 2073 656c 662e 7369 676e         self.sign
+000162d0: 616c 2822 7265 6672 6573 685f 7363 656e  al("refresh_scen
+000162e0: 6522 2c20 2253 6365 6e65 2229 0d0a 0d0a  e", "Scene")....
+000162f0: 2020 2020 4074 7265 655f 636f 6e64 6974      @tree_condit
+00016300: 696f 6e61 6c28 6c61 6d62 6461 206e 6f64  ional(lambda nod
+00016310: 653a 2069 735f 7265 676d 6172 6b28 6e6f  e: is_regmark(no
+00016320: 6465 2929 0d0a 2020 2020 4074 7265 655f  de))..    @tree_
+00016330: 7375 626d 656e 7528 5f28 2254 6f67 676c  submenu(_("Toggl
+00016340: 6520 4d61 676e 6574 2d4c 696e 6573 2229  e Magnet-Lines")
+00016350: 290d 0a20 2020 2040 7472 6565 5f6f 7065  )..    @tree_ope
+00016360: 7261 7469 6f6e 285f 2822 4172 6f75 6e64  ration(_("Around
+00016370: 2062 6f72 6465 7222 292c 206e 6f64 655f   border"), node_
+00016380: 7479 7065 3d65 6c65 6d5f 6772 6f75 705f  type=elem_group_
+00016390: 6e6f 6465 732c 2068 656c 703d 2222 290d  nodes, help="").
+000163a0: 0a20 2020 2064 6566 2072 6567 6d61 726b  .    def regmark
+000163b0: 5f74 6f5f 6d61 676e 6574 5f31 286e 6f64  _to_magnet_1(nod
+000163c0: 652c 202a 2a6b 7761 7267 7329 3a0d 0a20  e, **kwargs):.. 
+000163d0: 2020 2020 2020 2069 6620 6e6f 6465 2069         if node i
+000163e0: 7320 4e6f 6e65 3a0d 0a20 2020 2020 2020  s None:..       
+000163f0: 2020 2020 2072 6574 7572 6e0d 0a20 2020       return..   
+00016400: 2020 2020 2069 6620 6e6f 7420 6861 7361       if not hasa
+00016410: 7474 7228 6e6f 6465 2c20 2262 6f75 6e64  ttr(node, "bound
+00016420: 7322 293a 0d0a 2020 2020 2020 2020 2020  s"):..          
+00016430: 2020 7265 7475 726e 0d0a 2020 2020 2020    return..      
+00016440: 2020 7365 6c66 2e73 6967 6e61 6c28 226d    self.signal("m
+00016450: 6167 6e65 745f 6765 6e22 2c20 2822 6f75  agnet_gen", ("ou
+00016460: 7465 7222 2c20 6e6f 6465 2929 0d0a 0d0a  ter", node))....
+00016470: 2020 2020 4074 7265 655f 636f 6e64 6974      @tree_condit
+00016480: 696f 6e61 6c28 6c61 6d62 6461 206e 6f64  ional(lambda nod
+00016490: 653a 2069 735f 7265 676d 6172 6b28 6e6f  e: is_regmark(no
+000164a0: 6465 2929 0d0a 2020 2020 4074 7265 655f  de))..    @tree_
+000164b0: 7375 626d 656e 7528 5f28 2254 6f67 676c  submenu(_("Toggl
+000164c0: 6520 4d61 676e 6574 2d4c 696e 6573 2229  e Magnet-Lines")
+000164d0: 290d 0a20 2020 2040 7472 6565 5f6f 7065  )..    @tree_ope
+000164e0: 7261 7469 6f6e 285f 2822 4174 2063 656e  ration(_("At cen
+000164f0: 7465 7222 292c 206e 6f64 655f 7479 7065  ter"), node_type
+00016500: 3d65 6c65 6d5f 6772 6f75 705f 6e6f 6465  =elem_group_node
+00016510: 732c 2068 656c 703d 2222 290d 0a20 2020  s, help="")..   
+00016520: 2064 6566 2072 6567 6d61 726b 5f74 6f5f   def regmark_to_
+00016530: 6d61 676e 6574 5f32 286e 6f64 652c 202a  magnet_2(node, *
+00016540: 2a6b 7761 7267 7329 3a0d 0a20 2020 2020  *kwargs):..     
+00016550: 2020 2069 6620 6e6f 6465 2069 7320 4e6f     if node is No
+00016560: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
+00016570: 2072 6574 7572 6e0d 0a20 2020 2020 2020   return..       
+00016580: 2069 6620 6e6f 7420 6861 7361 7474 7228   if not hasattr(
+00016590: 6e6f 6465 2c20 2262 6f75 6e64 7322 293a  node, "bounds"):
+000165a0: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+000165b0: 7475 726e 0d0a 2020 2020 2020 2020 7365  turn..        se
+000165c0: 6c66 2e73 6967 6e61 6c28 226d 6167 6e65  lf.signal("magne
+000165d0: 745f 6765 6e22 2c20 2822 6365 6e74 6572  t_gen", ("center
+000165e0: 222c 206e 6f64 6529 290d 0a0d 0a20 2020  ", node))....   
+000165f0: 2023 2040 7472 6565 5f63 6f6e 6469 7469   # @tree_conditi
+00016600: 6f6e 616c 286c 616d 6264 6120 6e6f 6465  onal(lambda node
+00016610: 3a20 6e6f 7420 6e6f 6465 2e6c 6f63 6b29  : not node.lock)
+00016620: 0d0a 2020 2020 2320 4074 7265 655f 636f  ..    # @tree_co
+00016630: 6e64 6974 696f 6e61 6c5f 7472 7928 6c61  nditional_try(la
+00016640: 6d62 6461 206e 6f64 653a 206e 6f74 206e  mbda node: not n
+00016650: 6f64 652e 6c6f 636b 290d 0a20 2020 2023  ode.lock)..    #
+00016660: 2040 7472 6565 5f6f 7065 7261 7469 6f6e   @tree_operation
+00016670: 285f 2822 4163 7475 616c 697a 6520 7069  (_("Actualize pi
+00016680: 7865 6c73 2229 2c20 6e6f 6465 5f74 7970  xels"), node_typ
+00016690: 653d 2265 6c65 6d20 696d 6167 6522 2c20  e="elem image", 
+000166a0: 6865 6c70 3d22 2229 0d0a 2020 2020 2320  help="")..    # 
+000166b0: 6465 6620 696d 6167 655f 6163 7475 616c  def image_actual
+000166c0: 697a 655f 7069 7865 6c73 286e 6f64 652c  ize_pixels(node,
+000166d0: 202a 2a6b 7761 7267 7329 3a0d 0a20 2020   **kwargs):..   
+000166e0: 2023 2020 2020 2073 656c 6628 2269 6d61   #     self("ima
+000166f0: 6765 2072 6573 616d 706c 655c 6e22 290d  ge resample\n").
+00016700: 0a0d 0a20 2020 2040 7472 6565 5f63 6f6e  ...    @tree_con
+00016710: 6469 7469 6f6e 616c 286c 616d 6264 6120  ditional(lambda 
+00016720: 6e6f 6465 3a20 6e6f 7420 6e6f 6465 2e6c  node: not node.l
+00016730: 6f63 6b29 0d0a 2020 2020 4074 7265 655f  ock)..    @tree_
+00016740: 7375 626d 656e 7528 5f28 225a 2d64 6570  submenu(_("Z-dep
+00016750: 7468 2064 6976 6964 6522 2929 0d0a 2020  th divide"))..  
+00016760: 2020 4074 7265 655f 6974 6572 6174 6528    @tree_iterate(
+00016770: 2264 6976 6964 6522 2c20 322c 2031 3029  "divide", 2, 10)
+00016780: 0d0a 2020 2020 4074 7265 655f 6f70 6572  ..    @tree_oper
+00016790: 6174 696f 6e28 5f28 2244 6976 6964 6520  ation(_("Divide 
+000167a0: 696e 746f 207b 6469 7669 6465 7d20 696d  into {divide} im
+000167b0: 6167 6573 2229 2c20 6e6f 6465 5f74 7970  ages"), node_typ
+000167c0: 653d 2265 6c65 6d20 696d 6167 6522 2c20  e="elem image", 
+000167d0: 6865 6c70 3d22 2229 0d0a 2020 2020 6465  help="")..    de
+000167e0: 6620 696d 6167 655f 7a64 6570 7468 286e  f image_zdepth(n
+000167f0: 6f64 652c 2064 6976 6964 653d 312c 202a  ode, divide=1, *
+00016800: 2a6b 7761 7267 7329 3a0d 0a20 2020 2020  *kwargs):..     
+00016810: 2020 2069 6620 6e6f 6465 2e69 6d61 6765     if node.image
+00016820: 2e6d 6f64 6520 213d 2022 5247 4241 223a  .mode != "RGBA":
+00016830: 0d0a 2020 2020 2020 2020 2020 2020 6e6f  ..            no
+00016840: 6465 2e69 6d61 6765 203d 206e 6f64 652e  de.image = node.
+00016850: 696d 6167 652e 636f 6e76 6572 7428 2252  image.convert("R
+00016860: 4742 4122 290d 0a20 2020 2020 2020 2062  GBA")..        b
+00016870: 616e 6420 3d20 3235 3520 2f20 6469 7669  and = 255 / divi
+00016880: 6465 0d0a 2020 2020 2020 2020 666f 7220  de..        for 
+00016890: 6920 696e 2072 616e 6765 2830 2c20 6469  i in range(0, di
+000168a0: 7669 6465 293a 0d0a 2020 2020 2020 2020  vide):..        
+000168b0: 2020 2020 7468 7265 7368 6f6c 645f 6d69      threshold_mi
+000168c0: 6e20 3d20 6920 2a20 6261 6e64 0d0a 2020  n = i * band..  
+000168d0: 2020 2020 2020 2020 2020 7468 7265 7368            thresh
+000168e0: 6f6c 645f 6d61 7820 3d20 7468 7265 7368  old_max = thresh
+000168f0: 6f6c 645f 6d69 6e20 2b20 6261 6e64 0d0a  old_min + band..
+00016900: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00016910: 2866 2269 6d61 6765 2074 6872 6573 686f  (f"image thresho
+00016920: 6c64 207b 7468 7265 7368 6f6c 645f 6d69  ld {threshold_mi
+00016930: 6e7d 207b 7468 7265 7368 6f6c 645f 6d61  n} {threshold_ma
+00016940: 787d 5c6e 2229 0d0a 0d0a 2020 2020 4074  x}\n")....    @t
+00016950: 7265 655f 636f 6e64 6974 696f 6e61 6c28  ree_conditional(
+00016960: 6c61 6d62 6461 206e 6f64 653a 206e 6f64  lambda node: nod
+00016970: 652e 6c6f 636b 290d 0a20 2020 2040 7472  e.lock)..    @tr
+00016980: 6565 5f73 7562 6d65 6e75 285f 2822 496d  ee_submenu(_("Im
+00016990: 6167 6522 2929 0d0a 2020 2020 4074 7265  age"))..    @tre
+000169a0: 655f 6f70 6572 6174 696f 6e28 5f28 2255  e_operation(_("U
+000169b0: 6e6c 6f63 6b20 6d61 6e69 7075 6c61 7469  nlock manipulati
+000169c0: 6f6e 7322 292c 206e 6f64 655f 7479 7065  ons"), node_type
+000169d0: 3d22 656c 656d 2069 6d61 6765 222c 2068  ="elem image", h
+000169e0: 656c 703d 2222 290d 0a20 2020 2064 6566  elp="")..    def
+000169f0: 2069 6d61 6765 5f75 6e6c 6f63 6b5f 6d61   image_unlock_ma
+00016a00: 6e69 7075 6c61 7469 6f6e 7328 6e6f 6465  nipulations(node
+00016a10: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
+00016a20: 2020 2020 2020 7365 6c66 2822 696d 6167        self("imag
+00016a30: 6520 756e 6c6f 636b 5c6e 2229 0d0a 0d0a  e unlock\n")....
+00016a40: 2020 2020 4074 7265 655f 636f 6e64 6974      @tree_condit
+00016a50: 696f 6e61 6c28 6c61 6d62 6461 206e 6f64  ional(lambda nod
+00016a60: 653a 206e 6f74 206e 6f64 652e 6c6f 636b  e: not node.lock
+00016a70: 290d 0a20 2020 2040 7472 6565 5f73 7562  )..    @tree_sub
+00016a80: 6d65 6e75 285f 2822 496d 6167 6522 2929  menu(_("Image"))
+00016a90: 0d0a 2020 2020 4074 7265 655f 6f70 6572  ..    @tree_oper
+00016aa0: 6174 696f 6e28 5f28 224c 6f63 6b20 6d61  ation(_("Lock ma
+00016ab0: 6e69 7075 6c61 7469 6f6e 7322 292c 206e  nipulations"), n
+00016ac0: 6f64 655f 7479 7065 3d22 656c 656d 2069  ode_type="elem i
+00016ad0: 6d61 6765 222c 2068 656c 703d 2222 290d  mage", help="").
+00016ae0: 0a20 2020 2064 6566 2069 6d61 6765 5f6c  .    def image_l
+00016af0: 6f63 6b5f 6d61 6e69 7075 6c61 7469 6f6e  ock_manipulation
+00016b00: 7328 6e6f 6465 2c20 2a2a 6b77 6172 6773  s(node, **kwargs
+00016b10: 293a 0d0a 2020 2020 2020 2020 7365 6c66  ):..        self
+00016b20: 2822 696d 6167 6520 6c6f 636b 5c6e 2229  ("image lock\n")
+00016b30: 0d0a 0d0a 2020 2020 4074 7265 655f 636f  ....    @tree_co
+00016b40: 6e64 6974 696f 6e61 6c28 6c61 6d62 6461  nditional(lambda
+00016b50: 206e 6f64 653a 206e 6f74 206e 6f64 652e   node: not node.
+00016b60: 6c6f 636b 290d 0a20 2020 2040 7472 6565  lock)..    @tree
+00016b70: 5f73 7562 6d65 6e75 285f 2822 496d 6167  _submenu(_("Imag
+00016b80: 6522 2929 0d0a 2020 2020 4074 7265 655f  e"))..    @tree_
+00016b90: 6f70 6572 6174 696f 6e28 5f28 2244 6974  operation(_("Dit
+00016ba0: 6865 7220 746f 2031 2062 6974 2229 2c20  her to 1 bit"), 
+00016bb0: 6e6f 6465 5f74 7970 653d 2265 6c65 6d20  node_type="elem 
+00016bc0: 696d 6167 6522 2c20 6865 6c70 3d22 2229  image", help="")
+00016bd0: 0d0a 2020 2020 6465 6620 696d 6167 655f  ..    def image_
+00016be0: 6469 7468 6572 286e 6f64 652c 202a 2a6b  dither(node, **k
+00016bf0: 7761 7267 7329 3a0d 0a20 2020 2020 2020  wargs):..       
+00016c00: 2073 656c 6628 2269 6d61 6765 2064 6974   self("image dit
+00016c10: 6865 725c 6e22 290d 0a0d 0a20 2020 2040  her\n")....    @
+00016c20: 7472 6565 5f63 6f6e 6469 7469 6f6e 616c  tree_conditional
+00016c30: 286c 616d 6264 6120 6e6f 6465 3a20 6e6f  (lambda node: no
+00016c40: 7420 6e6f 6465 2e6c 6f63 6b29 0d0a 2020  t node.lock)..  
+00016c50: 2020 4074 7265 655f 7375 626d 656e 7528    @tree_submenu(
+00016c60: 5f28 2249 6d61 6765 2229 290d 0a20 2020  _("Image"))..   
+00016c70: 2040 7472 6565 5f6f 7065 7261 7469 6f6e   @tree_operation
+00016c80: 285f 2822 496e 7665 7274 2069 6d61 6765  (_("Invert image
+00016c90: 2229 2c20 6e6f 6465 5f74 7970 653d 2265  "), node_type="e
+00016ca0: 6c65 6d20 696d 6167 6522 2c20 6865 6c70  lem image", help
+00016cb0: 3d22 2229 0d0a 2020 2020 6465 6620 696d  ="")..    def im
+00016cc0: 6167 655f 696e 7665 7274 286e 6f64 652c  age_invert(node,
+00016cd0: 202a 2a6b 7761 7267 7329 3a0d 0a20 2020   **kwargs):..   
+00016ce0: 2020 2020 2073 656c 6628 2269 6d61 6765       self("image
+00016cf0: 2069 6e76 6572 745c 6e22 290d 0a0d 0a20   invert\n").... 
+00016d00: 2020 2040 7472 6565 5f63 6f6e 6469 7469     @tree_conditi
+00016d10: 6f6e 616c 286c 616d 6264 6120 6e6f 6465  onal(lambda node
+00016d20: 3a20 6e6f 7420 6e6f 6465 2e6c 6f63 6b29  : not node.lock)
+00016d30: 0d0a 2020 2020 4074 7265 655f 7375 626d  ..    @tree_subm
+00016d40: 656e 7528 5f28 2249 6d61 6765 2229 290d  enu(_("Image")).
+00016d50: 0a20 2020 2040 7472 6565 5f6f 7065 7261  .    @tree_opera
+00016d60: 7469 6f6e 285f 2822 4d69 7272 6f72 2068  tion(_("Mirror h
+00016d70: 6f72 697a 6f6e 7461 6c22 292c 206e 6f64  orizontal"), nod
+00016d80: 655f 7479 7065 3d22 656c 656d 2069 6d61  e_type="elem ima
+00016d90: 6765 222c 2068 656c 703d 2222 290d 0a20  ge", help="").. 
+00016da0: 2020 2064 6566 2069 6d61 6765 5f6d 6972     def image_mir
+00016db0: 726f 7228 6e6f 6465 2c20 2a2a 6b77 6172  ror(node, **kwar
+00016dc0: 6773 293a 0d0a 2020 2020 2020 2020 7365  gs):..        se
+00016dd0: 6c66 2822 696d 6167 6520 6d69 7272 6f72  lf("image mirror
+00016de0: 5c6e 2229 0d0a 0d0a 2020 2020 4074 7265  \n")....    @tre
+00016df0: 655f 636f 6e64 6974 696f 6e61 6c28 6c61  e_conditional(la
+00016e00: 6d62 6461 206e 6f64 653a 206e 6f74 206e  mbda node: not n
+00016e10: 6f64 652e 6c6f 636b 290d 0a20 2020 2040  ode.lock)..    @
+00016e20: 7472 6565 5f73 7562 6d65 6e75 285f 2822  tree_submenu(_("
+00016e30: 496d 6167 6522 2929 0d0a 2020 2020 4074  Image"))..    @t
+00016e40: 7265 655f 6f70 6572 6174 696f 6e28 5f28  ree_operation(_(
+00016e50: 2246 6c69 7020 7665 7274 6963 616c 2229  "Flip vertical")
+00016e60: 2c20 6e6f 6465 5f74 7970 653d 2265 6c65  , node_type="ele
+00016e70: 6d20 696d 6167 6522 2c20 6865 6c70 3d22  m image", help="
+00016e80: 2229 0d0a 2020 2020 6465 6620 696d 6167  ")..    def imag
+00016e90: 655f 666c 6970 286e 6f64 652c 202a 2a6b  e_flip(node, **k
+00016ea0: 7761 7267 7329 3a0d 0a20 2020 2020 2020  wargs):..       
+00016eb0: 2073 656c 6628 2269 6d61 6765 2066 6c69   self("image fli
+00016ec0: 705c 6e22 290d 0a0d 0a20 2020 2040 7472  p\n")....    @tr
+00016ed0: 6565 5f63 6f6e 6469 7469 6f6e 616c 286c  ee_conditional(l
+00016ee0: 616d 6264 6120 6e6f 6465 3a20 6e6f 7420  ambda node: not 
+00016ef0: 6e6f 6465 2e6c 6f63 6b29 0d0a 2020 2020  node.lock)..    
+00016f00: 4074 7265 655f 7375 626d 656e 7528 5f28  @tree_submenu(_(
+00016f10: 2249 6d61 6765 2229 290d 0a20 2020 2040  "Image"))..    @
+00016f20: 7472 6565 5f6f 7065 7261 7469 6f6e 285f  tree_operation(_
+00016f30: 2822 526f 7461 7465 2039 30c2 b020 4357  ("Rotate 90.. CW
+00016f40: 2229 2c20 6e6f 6465 5f74 7970 653d 2265  "), node_type="e
+00016f50: 6c65 6d20 696d 6167 6522 2c20 6865 6c70  lem image", help
+00016f60: 3d22 2229 0d0a 2020 2020 6465 6620 696d  ="")..    def im
+00016f70: 6167 655f 6377 286e 6f64 652c 202a 2a6b  age_cw(node, **k
+00016f80: 7761 7267 7329 3a0d 0a20 2020 2020 2020  wargs):..       
+00016f90: 2073 656c 6628 2269 6d61 6765 2063 775c   self("image cw\
+00016fa0: 6e22 290d 0a0d 0a20 2020 2040 7472 6565  n")....    @tree
+00016fb0: 5f63 6f6e 6469 7469 6f6e 616c 286c 616d  _conditional(lam
+00016fc0: 6264 6120 6e6f 6465 3a20 6e6f 7420 6e6f  bda node: not no
+00016fd0: 6465 2e6c 6f63 6b29 0d0a 2020 2020 4074  de.lock)..    @t
+00016fe0: 7265 655f 7375 626d 656e 7528 5f28 2249  ree_submenu(_("I
+00016ff0: 6d61 6765 2229 290d 0a20 2020 2040 7472  mage"))..    @tr
+00017000: 6565 5f6f 7065 7261 7469 6f6e 285f 2822  ee_operation(_("
+00017010: 526f 7461 7465 2039 30c2 b020 4343 5722  Rotate 90.. CCW"
+00017020: 292c 206e 6f64 655f 7479 7065 3d22 656c  ), node_type="el
+00017030: 656d 2069 6d61 6765 222c 2068 656c 703d  em image", help=
+00017040: 2222 290d 0a20 2020 2064 6566 2069 6d61  "")..    def ima
+00017050: 6765 5f63 6377 286e 6f64 652c 202a 2a6b  ge_ccw(node, **k
+00017060: 7761 7267 7329 3a0d 0a20 2020 2020 2020  wargs):..       
+00017070: 2073 656c 6628 2269 6d61 6765 2063 6377   self("image ccw
+00017080: 5c6e 2229 0d0a 0d0a 2020 2020 4074 7265  \n")....    @tre
+00017090: 655f 7375 626d 656e 7528 5f28 2249 6d61  e_submenu(_("Ima
+000170a0: 6765 2229 290d 0a20 2020 2040 7472 6565  ge"))..    @tree
+000170b0: 5f6f 7065 7261 7469 6f6e 280d 0a20 2020  _operation(..   
+000170c0: 2020 2020 205f 2822 5361 7665 206f 7269       _("Save ori
+000170d0: 6769 6e61 6c20 696d 6167 6520 746f 206f  ginal image to o
+000170e0: 7574 7075 742e 706e 6722 292c 206e 6f64  utput.png"), nod
+000170f0: 655f 7479 7065 3d22 656c 656d 2069 6d61  e_type="elem ima
+00017100: 6765 222c 2068 656c 703d 2222 0d0a 2020  ge", help=""..  
+00017110: 2020 290d 0a20 2020 2064 6566 2069 6d61    )..    def ima
+00017120: 6765 5f73 6176 6528 6e6f 6465 2c20 2a2a  ge_save(node, **
+00017130: 6b77 6172 6773 293a 0d0a 2020 2020 2020  kwargs):..      
+00017140: 2020 7365 6c66 2822 696d 6167 6520 7361    self("image sa
+00017150: 7665 206f 7574 7075 742e 706e 675c 6e22  ve output.png\n"
+00017160: 290d 0a0d 0a20 2020 2040 7472 6565 5f73  )....    @tree_s
+00017170: 7562 6d65 6e75 285f 2822 496d 6167 6522  ubmenu(_("Image"
+00017180: 2929 0d0a 2020 2020 4074 7265 655f 6f70  ))..    @tree_op
+00017190: 6572 6174 696f 6e28 0d0a 2020 2020 2020  eration(..      
+000171a0: 2020 5f28 2253 6176 6520 7072 6f63 6573    _("Save proces
+000171b0: 7365 6420 696d 6167 6520 746f 206f 7574  sed image to out
+000171c0: 7075 742e 706e 6722 292c 206e 6f64 655f  put.png"), node_
+000171d0: 7479 7065 3d22 656c 656d 2069 6d61 6765  type="elem image
+000171e0: 222c 2068 656c 703d 2222 0d0a 2020 2020  ", help=""..    
+000171f0: 290d 0a20 2020 2064 6566 2069 6d61 6765  )..    def image
+00017200: 5f73 6176 655f 7072 6f63 6573 7365 6428  _save_processed(
+00017210: 6e6f 6465 2c20 2a2a 6b77 6172 6773 293a  node, **kwargs):
+00017220: 0d0a 2020 2020 2020 2020 7365 6c66 2822  ..        self("
+00017230: 696d 6167 6520 7361 7665 206f 7574 7075  image save outpu
+00017240: 742e 706e 6720 2d2d 7072 6f63 6573 7365  t.png --processe
+00017250: 645c 6e22 290d 0a0d 0a20 2020 2040 7472  d\n")....    @tr
+00017260: 6565 5f63 6f6e 6469 7469 6f6e 616c 286c  ee_conditional(l
+00017270: 616d 6264 6120 6e6f 6465 3a20 6c65 6e28  ambda node: len(
+00017280: 6e6f 6465 2e63 6869 6c64 7265 6e29 203e  node.children) >
+00017290: 2030 290d 0a20 2020 2040 7472 6565 5f73   0)..    @tree_s
+000172a0: 6570 6172 6174 6f72 5f62 6566 6f72 6528  eparator_before(
+000172b0: 290d 0a20 2020 2040 7472 6565 5f6f 7065  )..    @tree_ope
+000172c0: 7261 7469 6f6e 280d 0a20 2020 2020 2020  ration(..       
+000172d0: 205f 2822 4578 7061 6e64 2061 6c6c 2063   _("Expand all c
+000172e0: 6869 6c64 7265 6e22 292c 0d0a 2020 2020  hildren"),..    
+000172f0: 2020 2020 6e6f 6465 5f74 7970 653d 280d      node_type=(.
+00017300: 0a20 2020 2020 2020 2020 2020 2022 6f70  .            "op
+00017310: 2063 7574 222c 0d0a 2020 2020 2020 2020   cut",..        
+00017320: 2020 2020 226f 7020 7261 7374 6572 222c      "op raster",
+00017330: 0d0a 2020 2020 2020 2020 2020 2020 226f  ..            "o
+00017340: 7020 696d 6167 6522 2c0d 0a20 2020 2020  p image",..     
+00017350: 2020 2020 2020 2022 6f70 2065 6e67 7261         "op engra
+00017360: 7665 222c 0d0a 2020 2020 2020 2020 2020  ve",..          
+00017370: 2020 226f 7020 646f 7473 222c 0d0a 2020    "op dots",..  
+00017380: 2020 2020 2020 2020 2020 226f 7020 6861            "op ha
+00017390: 7463 6822 2c0d 0a20 2020 2020 2020 2020  tch",..         
+000173a0: 2020 2022 6272 616e 6368 2065 6c65 6d73     "branch elems
+000173b0: 222c 0d0a 2020 2020 2020 2020 2020 2020  ",..            
+000173c0: 2262 7261 6e63 6820 6f70 7322 2c0d 0a20  "branch ops",.. 
+000173d0: 2020 2020 2020 2020 2020 2022 6272 616e             "bran
+000173e0: 6368 2072 6567 222c 0d0a 2020 2020 2020  ch reg",..      
+000173f0: 2020 2020 2020 2267 726f 7570 222c 0d0a        "group",..
+00017400: 2020 2020 2020 2020 2020 2020 2266 696c              "fil
+00017410: 6522 2c0d 0a20 2020 2020 2020 2020 2020  e",..           
+00017420: 2022 726f 6f74 222c 0d0a 2020 2020 2020   "root",..      
+00017430: 2020 292c 0d0a 2020 2020 2020 2020 6865    ),..        he
+00017440: 6c70 3d5f 2822 4578 7061 6e64 2061 6c6c  lp=_("Expand all
+00017450: 2063 6869 6c64 7265 6e20 6f66 2074 6869   children of thi
+00017460: 7320 6769 7665 6e20 6e6f 6465 2e22 292c  s given node."),
+00017470: 0d0a 2020 2020 290d 0a20 2020 2064 6566  ..    )..    def
+00017480: 2065 7870 616e 645f 616c 6c5f 6368 696c   expand_all_chil
+00017490: 6472 656e 286e 6f64 652c 202a 2a6b 7761  dren(node, **kwa
+000174a0: 7267 7329 3a0d 0a20 2020 2020 2020 206e  rgs):..        n
+000174b0: 6f64 652e 6e6f 7469 6679 5f65 7870 616e  ode.notify_expan
+000174c0: 6428 290d 0a0d 0a20 2020 2040 7472 6565  d()....    @tree
+000174d0: 5f63 6f6e 6469 7469 6f6e 616c 286c 616d  _conditional(lam
+000174e0: 6264 6120 6e6f 6465 3a20 6c65 6e28 6e6f  bda node: len(no
+000174f0: 6465 2e63 6869 6c64 7265 6e29 203e 2030  de.children) > 0
+00017500: 290d 0a20 2020 2040 7472 6565 5f6f 7065  )..    @tree_ope
+00017510: 7261 7469 6f6e 280d 0a20 2020 2020 2020  ration(..       
+00017520: 205f 2822 436f 6c6c 6170 7365 2061 6c6c   _("Collapse all
+00017530: 2063 6869 6c64 7265 6e22 292c 0d0a 2020   children"),..  
+00017540: 2020 2020 2020 6e6f 6465 5f74 7970 653d        node_type=
+00017550: 280d 0a20 2020 2020 2020 2020 2020 2022  (..            "
+00017560: 6f70 2063 7574 222c 0d0a 2020 2020 2020  op cut",..      
+00017570: 2020 2020 2020 226f 7020 7261 7374 6572        "op raster
+00017580: 222c 0d0a 2020 2020 2020 2020 2020 2020  ",..            
+00017590: 226f 7020 696d 6167 6522 2c0d 0a20 2020  "op image",..   
+000175a0: 2020 2020 2020 2020 2022 6f70 2065 6e67           "op eng
+000175b0: 7261 7665 222c 0d0a 2020 2020 2020 2020  rave",..        
+000175c0: 2020 2020 226f 7020 646f 7473 222c 0d0a      "op dots",..
+000175d0: 2020 2020 2020 2020 2020 2020 226f 7020              "op 
+000175e0: 6861 7463 6822 2c0d 0a20 2020 2020 2020  hatch",..       
+000175f0: 2020 2020 2022 6272 616e 6368 2065 6c65       "branch ele
+00017600: 6d73 222c 0d0a 2020 2020 2020 2020 2020  ms",..          
+00017610: 2020 2262 7261 6e63 6820 6f70 7322 2c0d    "branch ops",.
+00017620: 0a20 2020 2020 2020 2020 2020 2022 6272  .            "br
+00017630: 616e 6368 2072 6567 222c 0d0a 2020 2020  anch reg",..    
+00017640: 2020 2020 2020 2020 2267 726f 7570 222c          "group",
+00017650: 0d0a 2020 2020 2020 2020 2020 2020 2266  ..            "f
+00017660: 696c 6522 2c0d 0a20 2020 2020 2020 2020  ile",..         
+00017670: 2020 2022 726f 6f74 222c 0d0a 2020 2020     "root",..    
+00017680: 2020 2020 292c 0d0a 2020 2020 2020 2020      ),..        
+00017690: 6865 6c70 3d5f 2822 436f 6c6c 6170 7365  help=_("Collapse
+000176a0: 2061 6c6c 2063 6869 6c64 7265 6e20 6f66   all children of
+000176b0: 2074 6869 7320 6769 7665 6e20 6e6f 6465   this given node
+000176c0: 2e22 292c 0d0a 2020 2020 290d 0a20 2020  ."),..    )..   
+000176d0: 2064 6566 2063 6f6c 6c61 7073 655f 616c   def collapse_al
+000176e0: 6c5f 6368 696c 6472 656e 286e 6f64 652c  l_children(node,
+000176f0: 202a 2a6b 7761 7267 7329 3a0d 0a20 2020   **kwargs):..   
+00017700: 2020 2020 206e 6f64 652e 6e6f 7469 6679       node.notify
+00017710: 5f63 6f6c 6c61 7073 6528 290d 0a         _collapse()..
```

### Comparing `meerk40t-0.8.3000/meerk40t/core/elements/element_types.py` & `meerk40t-0.8.4000/meerk40t/core/elements/element_types.py`

 * *Files 7% similar despite different names*

```diff
@@ -45,14 +45,16 @@
     "util console",
     "util wait",
     "util home",
     "util goto",
     "util origin",
     "util output",
     "util input",
+    "place point",
+    "place current",
     "reference",
     "lasercode",
     "cutcode",
     "blob",
     "elem ellipse",
     "elem image",
     "elem path",
@@ -82,14 +84,20 @@
     "util console",
     "util wait",
     "util home",
     "util goto",
     "util origin",
     "util output",
     "util input",
+    "place point",
+    "place current",
+)
+place_nodes = (
+    "place point",
+    "place current",
 )
 elem_nodes = (
     "elem ellipse",
     "elem image",
     "elem path",
     "elem geomstr",
     "elem point",
```

### Comparing `meerk40t-0.8.3000/meerk40t/core/elements/elements.py` & `meerk40t-0.8.4000/meerk40t/core/elements/elements.py`

 * *Files 1% similar despite different names*

```diff
@@ -32,14 +32,15 @@
             align,
             branches,
             clipboard,
             element_treeops,
             grid,
             materials,
             notes,
+            placements,
             render,
             shapes,
             trace,
             tree_commands,
             undo_redo,
             wordlist,
         )
@@ -54,14 +55,15 @@
             shapes.plugin,
             tree_commands.plugin,
             undo_redo.plugin,
             clipboard.plugin,
             grid.plugin,
             render.plugin,
             notes.plugin,
+            placements.plugin,
         ]
     elif lifecycle == "preregister":
         kernel.register(
             "format/op cut",
             "{danger}{defop}{enabled}{pass}{element_type} {speed}mm/s @{power} {colcode} {opstop}",
         )
         kernel.register(
@@ -110,14 +112,19 @@
         kernel.register("format/blob", "{element_type} {data_type}:{label} @{length}")
         kernel.register("format/file", "{element_type} {filename}")
         kernel.register("format/lasercode", "{element_type} {command_count}")
         kernel.register("format/cutcode", "{element_type}")
         kernel.register("format/branch ops", "{element_type} {loops}")
         kernel.register("format/branch elems", "{element_type}")
         kernel.register("format/branch reg", "{element_type}")
+        kernel.register("format/place current", "{enabled}{element_type}")
+        kernel.register(
+            "format/place point",
+            "{enabled}{loops}{element_type} {corner} {x} {y} {rotation}",
+        )
     elif lifecycle == "register":
         kernel.add_service("elements", Elemental(kernel))
         # kernel.add_service("elements", Elemental(kernel,1))
     elif lifecycle == "postboot":
         elements = kernel.elements
         choices = [
             {
@@ -590,14 +597,16 @@
         return self._first_emphasized
 
     @first_emphasized.setter
     def first_emphasized(self, node):
         self._first_emphasized = node
 
     def set_node_emphasis(self, node, flag):
+        if not node.can_emphasize:
+            return
         node.emphasized = flag
         if flag:
             if self._first_emphasized is None:
                 self._first_emphasized = node
         else:
             if self._first_emphasized is node:
                 self._first_emphasized = None
@@ -953,27 +962,26 @@
                 if node is not None and node.type in ("file", "group"):
                     data_to_align = [e for e in node.children]
                 else:
                     break
         return data_to_align
 
     def translate_node(self, node, dx, dy):
-        if hasattr(node, "lock") and node.lock and not self.lock_allows_move:
+        if not node.can_move(self.lock_allows_move):
             return
+        if node.type in ("group", "file"):
+            for c in node.children:
+                self.translate_node(c, dx, dy)
+            node.translated(dx, dy)
         else:
-            if node.type in ("group", "file"):
-                for c in node.children:
-                    self.translate_node(c, dx, dy)
+            try:
+                node.matrix.post_translate(dx, dy)
                 node.translated(dx, dy)
-            else:
-                try:
-                    node.matrix.post_translate(dx, dy)
-                    node.translated(dx, dy)
-                except AttributeError:
-                    pass
+            except AttributeError:
+                pass
 
     def align_elements(self, data, alignbounds, positionx, positiony, as_group):
         """
 
         @param data: elements to align
         @param alignbounds: boundary tuple (left, top, right, bottom)
                             to which data needs to be aligned to
@@ -1165,14 +1173,15 @@
             except (AttributeError, RuntimeError):
                 print(f"That should not happen, but ops contained: '{op_type}'")
                 continue
 
             op.load(settings, section)
         if len(list(self.elems())) > 0:
             self.classify(list(self.elems()))
+        self.signal("updateop_tree")
 
     def prepare_undo(self):
         if self.do_undo:
             self.schedule(self._save_restore_job)
 
     def emphasized(self, *args):
         self._emphasized_bounds_dirty = True
@@ -1312,14 +1321,18 @@
         elements = self._tree.get(type="branch reg")
         yield from elements.flat(types=elem_nodes, **kwargs)
 
     def regmarks_nodes(self, depth=None, **kwargs):
         elements = self._tree.get(type="branch reg")
         yield from elements.flat(types=elem_group_nodes, depth=depth, **kwargs)
 
+    def placement_nodes(self, depth=None, **kwargs):
+        elements = self.op_branch
+        yield from elements.flat(types=place_nodes, depth=depth, **kwargs)
+
     def top_element(self, **kwargs):
         """
         Returns the first matching node via a depth first search.
         """
         for e in self.elem_branch.flat(**kwargs):
             return e
         return None
@@ -1443,14 +1456,18 @@
         self.set_start_time("clear_all")
         with self.static("clear_all"):
             self.clear_elements(fast=fast)
             self.clear_operations(fast=fast)
             self.clear_files()
             self.clear_note()
             self.clear_regmarks(fast=fast)
+            # Do we have any other routine that wants
+            # to be called when we start from scratch?
+            for routine in self.kernel.lookup_all("reset_routines/.*"):
+                routine()
             self.validate_selected_area()
         if fast:
             self.signal("rebuild_tree")
         self.set_end_time("clear_all", display=True)
         self._filename = None
         self.signal("file;loaded")
 
@@ -1553,19 +1570,16 @@
                 continue
             if n.type in ("root", "branch elems", "branch reg", "branch ops"):
                 continue
             n.remove_node(children=False, references=False)
 
     def remove_elements(self, element_node_list):
         for elem in element_node_list:
-            try:
-                if hasattr(elem, "lock") and elem.lock:
-                    continue
-            except AttributeError:
-                pass
+            if hasattr(elem, "can_remove") and not elem.can_remove:
+                continue
             elem.remove_node(references=True)
         self.validate_selected_area()
 
     def remove_operations(self, operations_list):
         for op in operations_list:
             for i, o in enumerate(list(self.ops())):
                 if o is op:
@@ -1686,15 +1700,16 @@
         for s in self._tree.flat():
             if s.highlighted:
                 s.highlighted = False
             if s.targeted:
                 s.targeted = False
             if s.selected:
                 s.selected = False
-
+            if not s.can_emphasize:
+                continue
             in_list = emphasize is not None and s in emphasize
             if s.emphasized:
                 if not in_list:
                     s.emphasized = False
             else:
                 if in_list:
                     s.emphasized = True
@@ -1751,15 +1766,15 @@
         # We dont know it better...
         self._emphasized_bounds_painted = [b[0], b[1], b[2], b[3]]
         self._emphasized_bounds_dirty = False
         self.signal("selected_bounds", self._emphasized_bounds)
 
     def move_emphasized(self, dx, dy):
         for node in self.elems(emphasized=True):
-            if hasattr(node, "lock") and node.lock and not self.lock_allows_move:
+            if not node.can_move(self.lock_allows_move):
                 continue
             node.matrix.post_translate(dx, dy)
             # node.modified()
             node.translated(dx, dy)
 
     def set_emphasized_by_position(
         self,
@@ -3154,15 +3169,15 @@
                 else:
                     last = None
             return removed
 
         def combine_overlapping_chains(obj):
             def list_subpath_bounds(obj):
                 # Return a sorted list of subpaths in the given path (from left to right):
-                # tuples with first index, last index, x-coordinate of first segment
+                # tuples with first index, last index, x-coordinate of first segment, closed
                 result = []
                 start = -1
                 for current, seg in enumerate(obj._segments):
                     if isinstance(seg, Move):
                         if start >= 0:
                             result.append(
                                 (start, current - 1, obj._segments[start].start.x)
@@ -3179,15 +3194,18 @@
                             start = current
                 if start >= 0:
                     result.append((start, len(obj) - 1, obj._segments[start].start.x))
                 # Now let's sort the list according to the X-start position
                 result.sort(key=lambda a: a[2])
                 return result
 
+            #  This is not working properly yet, so we skip this for now
             joined = 0
+            iterations = 0
+            maxiterations = 20
             redo = True
             while redo:
                 # Dont do it again unless indicated...
                 redo = False
                 reason = ""
                 results = list_subpath_bounds(obj)
                 if len(results) <= 1:
@@ -3341,16 +3359,19 @@
                                 joined += 1
                                 reason = f"Added overlapping vertical segment {idx2} to {idx}"
                                 redo = True
                                 break
                     # end of inner loop
 
                     if redo:
-                        # print(f"Redo required inner loop: {reason}")
+                        iterations += 1
+                        # print(f"Redo required inner loop #{iterations}: {reason}")
                         changed = True
+                        if iterations > maxiterations:
+                            redo = False
                         break
                 # end of outer loop
             return joined
 
         def simplify_polyline(obj):
             removed = 0
             pt_older = None
@@ -3397,37 +3418,43 @@
             obj = node.path
             before = len(obj._segments)
 
             # Pass 1: Dropping zero length line segments
             eliminated = remove_zero_length_lines(obj)
             if eliminated > 0:
                 changed = True
+            # print (f"pass 1 for {node.type}-{node.label}: zero_length: {eliminated}")
 
             # Pass 2: look inside the nodes and bring small line segments back together...
             eliminated = remove_interim_points_on_line(obj)
             if eliminated > 0:
                 changed = True
+            # print (f"pass 2 for {node.type}-{node.label}: interim_pts: {eliminated}")
 
             # Pass 3: look at the subpaths....
-            eliminated = combine_overlapping_chains(obj)
-            if eliminated > 0:
-                changed = True
+            # Commented out as it is not working properly yet
+            # eliminated = combine_overlapping_chains(obj)
+            # if eliminated > 0:
+            #     changed = True
+            # print (f"pass 3 for {node.type}-{node.label}: overlapping: {eliminated}")
 
             # pass 4: remove superfluous moves
             eliminated = remove_superfluous_moves(obj)
             if eliminated > 0:
                 changed = True
+            # print (f"pass 4 for {node.type}-{node.label}: superfluous moves: {eliminated}")
 
             after = len(obj._segments)
         elif node.type == "elem polyline" and len(node.shape.points) > 2:
             obj = node.shape
             before = len(obj.points)
             eliminated = simplify_polyline(obj)
             if eliminated > 0:
                 changed = True
+            # print (f"pass 1 for {node.type}-{node.label}: simplify polyline: {eliminated}")
             after = len(obj.points)
 
         # print (f"Before: {before}, After: {after}")
         return changed, before, after
 
 
 def linearize_path(path, interp=50, point=False):
```

### Comparing `meerk40t-0.8.3000/meerk40t/core/elements/grid.py` & `meerk40t-0.8.4000/meerk40t/core/elements/grid.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/core/elements/materials.py` & `meerk40t-0.8.4000/meerk40t/core/elements/materials.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/core/elements/notes.py` & `meerk40t-0.8.4000/meerk40t/core/elements/notes.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/core/elements/penbox.py` & `meerk40t-0.8.4000/meerk40t/core/elements/penbox.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/core/elements/render.py` & `meerk40t-0.8.4000/meerk40t/core/elements/render.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/core/elements/shapes.py` & `meerk40t-0.8.4000/meerk40t/core/elements/shapes.py`

 * *Files 1% similar despite different names*

```diff
@@ -274,15 +274,15 @@
             )
         if data is None:
             data = list(self.elems(emphasized=True))
         if len(data) == 0:
             channel(_("No selected elements."))
             return
         for e in data:
-            if hasattr(e, "lock") and e.lock:
+            if hasattr(e, "can_modify") and not e.can_modify:
                 channel(_("Can't modify a locked element: {name}").format(name=str(e)))
                 continue
             if e.type == "elem text":
                 old_anchor = e.anchor
                 e.anchor = anchor
                 channel(f"Node {e} anchor changed from {old_anchor} to {anchor}")
 
@@ -303,15 +303,15 @@
     def element_text_edit(command, channel, _, data, new_text=None, **kwargs):
         if data is None:
             data = list(self.elems(emphasized=True))
         if len(data) == 0:
             channel(_("No selected elements."))
             return
         for e in data:
-            if hasattr(e, "lock") and e.lock:
+            if hasattr(e, "can_modify") and not e.can_modify:
                 channel(_("Can't modify a locked element: {name}").format(name=str(e)))
                 continue
             if e.type == "elem text":
                 old_text = e.text
                 e.text = new_text
             elif hasattr(e, "mktext"):
                 old_text = e.mktext
@@ -422,14 +422,19 @@
             for e in data:
                 if hasattr(e, "lock"):
                     e.lock = setval
                     changed.append(e)
         else:
             for e in data:
                 if prop in ("x", "y"):
+                    if hasattr(e, "can_move") and not e.can_move(self.lock_allows_move):
+                        channel(
+                            _("Element can not be moved: {name}").format(name=str(e))
+                        )
+                        continue
                     # We need to adjust the matrix
                     if hasattr(e, "matrix"):
                         dx = 0
                         dy = 0
                         otx = e.matrix.value_trans_x()
                         oty = e.matrix.value_trans_y()
                         if prop == "x":
@@ -444,14 +449,19 @@
                             )
                         )
                         continue
                 elif prop in ("width", "height"):
                     if new_value == 0:
                         channel(_("Can't set {field} to zero").format(field=prop))
                         continue
+                    if hasattr(e, "can_scale") and not e.can_scale:
+                        channel(
+                            _("Element can not be scaled: {name}").format(name=str(e))
+                        )
+                        continue
                     if hasattr(e, "matrix") and hasattr(e, "bounds"):
                         bb = e.bounds
                         sx = 1.0
                         sy = 1.0
                         wd = bb[2] - bb[0]
                         ht = bb[3] - bb[1]
                         if prop == "width":
@@ -463,15 +473,15 @@
                         channel(
                             _("Element has no matrix to modify: {name}").format(
                                 name=str(e)
                             )
                         )
                         continue
                 elif hasattr(e, prop):
-                    if hasattr(e, "lock") and e.lock:
+                    if hasattr(e, "can_modify") and not e.can_modify:
                         channel(
                             _("Can't modify a locked element: {name}").format(
                                 name=str(e)
                             )
                         )
                         continue
                     try:
@@ -1747,31 +1757,23 @@
         if ty is None:
             ty = 0
         changes = False
         matrix = Matrix.translate(tx, ty)
         try:
             if not absolute:
                 for node in data:
-                    if (
-                        hasattr(node, "lock")
-                        and node.lock
-                        and not self.lock_allows_move
-                    ):
+                    if not node.can_move(self.lock_allows_move):
                         continue
 
                     node.matrix *= matrix
                     node.translated(tx, ty)
                     changes = True
             else:
                 for node in data:
-                    if (
-                        hasattr(node, "lock")
-                        and node.lock
-                        and not self.lock_allows_move
-                    ):
+                    if not node.can_move(self.lock_allows_move):
                         continue
                     otx = node.matrix.value_trans_x()
                     oty = node.matrix.value_trans_y()
                     ntx = tx - otx
                     nty = ty - oty
                     matrix = Matrix.translate(ntx, nty)
                     node.matrix *= matrix
@@ -1801,15 +1803,15 @@
             return
         if tx is None or ty is None:
             channel(_("You need to provide a new position."))
             return
         changes = False
         dbounds = Node.union_bounds(data)
         for node in data:
-            if hasattr(node, "lock") and node.lock and not self.lock_allows_move:
+            if not node.can_move(self.lock_allows_move):
                 continue
             nbounds = node.bounds
             dx = tx - dbounds[0]
             dy = ty - dbounds[1]
             if dx != 0 or dy != 0:
                 node.matrix.post_translate(dx, dy)
                 # node.modified()
@@ -1835,15 +1837,15 @@
         try:
             bounds = Node.union_bounds(data)
             otx = bounds[0]
             oty = bounds[1]
             ntx = tx - otx
             nty = ty - oty
             for node in data:
-                if hasattr(node, "lock") and node.lock and not self.lock_allows_move:
+                if not node.can_move(self.lock_allows_move):
                     continue
                 node.matrix.post_translate(ntx, nty)
                 # node.modified()
                 node.translated(ntx, nty)
         except ValueError:
             raise CommandSyntaxError
         return "elements", data
```

### Comparing `meerk40t-0.8.3000/meerk40t/core/elements/trace.py` & `meerk40t-0.8.4000/meerk40t/core/elements/trace.py`

 * *Files 6% similar despite different names*

```diff
@@ -153,14 +153,15 @@
     n represents the number of points in P that are not yet processed.
 
     @param P:
     @param R:
     @param n:
     @return:
     """
+    # print (f"Welzl_helper. P={len(P)} pts, R={len(R)} pts, n={n}")
     # Base case when all points processed or |R| = 3
     if n <= 0 or len(R) == 3:
         center, radius = min_circle_trivial(R)
         return center, radius
 
     # Pick a random point randomly
     idx = randint(0, n - 1)
@@ -305,15 +306,15 @@
                 )
     hull = list(Point.convex_hull(pts))
     if len(hull) != 0:
         hull.append(hull[0])  # loop
     return hull
 
 
-def generate_hull_shape_circle(data):
+def generate_hull_shape_circle_data(data):
     pts = []
     for node in data:
         try:
             path = node.as_path()
         except AttributeError:
             path = None
         if path is not None:
@@ -327,16 +328,27 @@
             if bounds:
                 pts += [
                     (bounds[0], bounds[1]),
                     (bounds[0], bounds[3]),
                     (bounds[2], bounds[1]),
                     (bounds[2], bounds[3]),
                 ]
+    # We could directly call welzl, but for a significant
+    # amount of point this will cause a huge amount
+    # of recursive calls (which will fail)
+    # -> so we apply it to the hull points
+    hull = list(Point.convex_hull(pts))
+    mec_center, mec_radius = welzl(hull)
+
+    # So now we have a circle with (mec[0], mec[1]), and mec_radius
+    return mec_center, mec_radius
 
-    mec_center, mec_radius = welzl(pts)
+
+def generate_hull_shape_circle(data):
+    mec_center, mec_radius = generate_hull_shape_circle_data(data)
 
     # So now we have a circle with (mec[0], mec[1]), and mec_radius
     hull = []
     RES = 100
     for i in range(RES):
         hull += [
             (
@@ -502,39 +514,51 @@
                     "Invalid method, please use one of quick, hull, complex, segment, circle."
                 )
             )
             return
 
         if data is None:
             data = list(self.elems(emphasized=True))
+        if len(data) == 0:
+            channel(_("No elements bounds to trace"))
+            return
+        shape_type = "elem polyline"
         if method == "segment":
             hull = generate_hull_shape_segment(data)
         elif method == "quick":
             hull = generate_hull_shape_quick(data)
         elif method == "hull":
             hull = generate_hull_shape_hull(data)
         elif method == "complex":
             hull = generate_hull_shape_complex(data, resolution)
         elif method == "circle":
-            hull = generate_hull_shape_circle(data)
+            shape_type = "elem ellipse"
+            s_center, s_radius = generate_hull_shape_circle_data(data)
         else:
             raise ValueError
-        if len(hull) == 0:
-            channel(_("No elements bounds to trace."))
-            return
-        shape = Polyline(hull)
-        if shape.is_degenerate():
-            channel(_("Shape is degenerate."))
-            return "elements", data
-        node = self.elem_branch.add(shape=shape, type="elem polyline")
+        if shape_type == "elem polyline":
+
+            if len(hull) == 0:
+                channel(_("No elements bounds to trace."))
+                return
+            shape = Polyline(hull)
+            if shape.is_degenerate():
+                channel(_("Shape is degenerate."))
+                return "elements", data
+        elif shape_type == "elem ellipse":
+            shape = Circle(cx=s_center[0], cy=s_center[1], rx=s_radius, ry=s_radius)
+            if shape.is_degenerate():
+                channel(_("Shape is degenerate."))
+                return "elements", data
+        node = self.elem_branch.add(shape=shape, type=shape_type)
         node.stroke = self.default_stroke
         node.stroke_width = self.default_strokewidth
         node.fill = self.default_fill
         node.altered()
         self.set_emphasis([node])
         node.focus()
         data.append(node)
         # Newly created! Classification needed?
-        post.append(classify_new)
+        post.append(classify_new(data))
         return "elements", data
 
     # --------------------------- END COMMANDS ------------------------------
```

### Comparing `meerk40t-0.8.3000/meerk40t/core/elements/tree_commands.py` & `meerk40t-0.8.4000/meerk40t/core/elements/tree_commands.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/core/elements/undo_redo.py` & `meerk40t-0.8.4000/meerk40t/core/elements/undo_redo.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/core/elements/wordlist.py` & `meerk40t-0.8.4000/meerk40t/core/elements/wordlist.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/core/laserjob.py` & `meerk40t-0.8.4000/meerk40t/core/laserjob.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/core/logging.py` & `meerk40t-0.8.4000/meerk40t/core/logging.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/core/node/blobnode.py` & `meerk40t-0.8.4000/meerk40t/core/node/blobnode.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/core/node/bootstrap.py` & `meerk40t-0.8.4000/meerk40t/core/node/bootstrap.py`

 * *Files 2% similar despite different names*

```diff
@@ -18,14 +18,16 @@
 from meerk40t.core.node.layernode import LayerNode
 from meerk40t.core.node.op_cut import CutOpNode
 from meerk40t.core.node.op_dots import DotsOpNode
 from meerk40t.core.node.op_engrave import EngraveOpNode
 from meerk40t.core.node.op_hatch import HatchOpNode
 from meerk40t.core.node.op_image import ImageOpNode
 from meerk40t.core.node.op_raster import RasterOpNode
+from meerk40t.core.node.place_current import PlaceCurrentNode
+from meerk40t.core.node.place_point import PlacePointNode
 from meerk40t.core.node.refnode import ReferenceNode
 from meerk40t.core.node.rootnode import RootNode
 from meerk40t.core.node.util_console import ConsoleOperation
 from meerk40t.core.node.util_goto import GotoOperation
 from meerk40t.core.node.util_home import HomeOperation
 from meerk40t.core.node.util_input import InputOperation
 from meerk40t.core.node.util_origin import SetOriginOperation
@@ -79,14 +81,16 @@
     "util console": ConsoleOperation,
     "util wait": WaitOperation,
     "util origin": SetOriginOperation,
     "util home": HomeOperation,
     "util goto": GotoOperation,
     "util input": InputOperation,
     "util output": OutputOperation,
+    "place point": PlacePointNode,
+    "place current": PlaceCurrentNode,
     "lasercode": LaserCodeNode,
     "blob": BlobNode,
     "group": GroupNode,
     "layer": LayerNode,
     "elem ellipse": EllipseNode,
     "elem line": LineNode,
     "elem rect": RectNode,
```

### Comparing `meerk40t-0.8.3000/meerk40t/core/node/branch_elems.py` & `meerk40t-0.8.4000/meerk40t/core/node/branch_elems.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/core/node/branch_ops.py` & `meerk40t-0.8.4000/meerk40t/core/node/branch_ops.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/core/node/branch_regmark.py` & `meerk40t-0.8.4000/meerk40t/core/node/branch_regmark.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/core/node/cutnode.py` & `meerk40t-0.8.4000/meerk40t/core/node/cutnode.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/core/node/elem_ellipse.py` & `meerk40t-0.8.4000/meerk40t/core/node/elem_ellipse.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/core/node/elem_geomstr.py` & `meerk40t-0.8.4000/meerk40t/core/node/elem_geomstr.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/core/node/elem_image.py` & `meerk40t-0.8.4000/meerk40t/core/node/elem_image.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/core/node/elem_line.py` & `meerk40t-0.8.4000/meerk40t/core/node/elem_line.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/core/node/elem_path.py` & `meerk40t-0.8.4000/meerk40t/core/node/elem_path.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/core/node/elem_point.py` & `meerk40t-0.8.4000/meerk40t/core/node/elem_point.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/core/node/elem_polyline.py` & `meerk40t-0.8.4000/meerk40t/core/node/elem_polyline.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/core/node/elem_rect.py` & `meerk40t-0.8.4000/meerk40t/core/node/elem_rect.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/core/node/elem_text.py` & `meerk40t-0.8.4000/meerk40t/core/node/elem_text.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/core/node/filenode.py` & `meerk40t-0.8.4000/meerk40t/core/node/filenode.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/core/node/groupnode.py` & `meerk40t-0.8.4000/meerk40t/core/node/groupnode.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/core/node/lasercodenode.py` & `meerk40t-0.8.4000/meerk40t/core/node/lasercodenode.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/core/node/layernode.py` & `meerk40t-0.8.4000/meerk40t/core/node/layernode.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/core/node/mixins.py` & `meerk40t-0.8.4000/meerk40t/core/node/mixins.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/core/node/node.py` & `meerk40t-0.8.4000/meerk40t/core/node/node.py`

 * *Files 2% similar despite different names*

```diff
@@ -76,14 +76,25 @@
     """
 
     def __init__(self, *args, **kwargs):
         self.type = None
         self.id = None
         self.label = None
         self.lock = False
+        self._can_emphasize = True
+        self._can_highlight = True
+        self._can_target = True
+        self._can_move = True
+        self._can_scale = True
+        self._can_rotate = True
+        self._can_skew = True
+        self._can_modify = True
+        self._can_alter = True
+        self._can_update = True
+        self._can_remove = True
         self._is_visible = True
 
         for k, v in kwargs.items():
             if k.startswith("_"):
                 continue
             if isinstance(v, str):
                 try:
@@ -275,55 +286,56 @@
 
     @property
     def root(self):
         return self._root
 
     @property
     def can_emphasize(self):
-        return not self.lock
+        return self._can_emphasize
 
     @property
     def can_highlight(self):
-        return not self.lock
+        return self._can_highlight
 
     @property
     def can_target(self):
-        return not self.lock
+        return self._can_target
 
-    @property
-    def can_move(self):
-        return not self.lock
+    def can_move(self, optional_permission=False):
+        if optional_permission is None:
+            optional_permission = False
+        return (self._can_move and not self.lock) or optional_permission
 
     @property
     def can_scale(self):
-        return not self.lock
+        return self._can_scale and not self.lock
 
     @property
     def can_rotate(self):
-        return not self.lock
+        return self._can_rotate and not self.lock
 
     @property
     def can_skew(self):
-        return not self.lock
+        return self._can_skew and not self.lock
 
     @property
     def can_modify(self):
-        return not self.lock
+        return self._can_modify and not self.lock
 
     @property
     def can_alter(self):
-        return not self.lock
+        return self._can_alter and not self.lock
 
     @property
     def can_update(self):
-        return not self.lock
+        return self._can_update and not self.lock
 
     @property
     def can_remove(self):
-        return not self.lock
+        return self._can_remove and not self.lock
 
     @property
     def bounds(self):
         if not self._bounds_dirty:
             return self._bounds
 
         try:
```

### Comparing `meerk40t-0.8.3000/meerk40t/core/node/nutils.py` & `meerk40t-0.8.4000/meerk40t/core/node/nutils.py`

 * *Files 5% similar despite different names*

```diff
@@ -77,16 +77,18 @@
                         seg.end,
                         settings=settings,
                         passes=passes,
                         parent=group,
                         color=color,
                     )
                 )
-        if len(group) > 0:
-            group[0].first = True
+        if len(group) == 0:
+            # Singleton Move or something. No cutobjects in generated group.
+            continue
+        group[0].first = True
         for i, cut_obj in enumerate(group):
             cut_obj.closed = closed
             try:
                 cut_obj.next = group[i + 1]
             except IndexError:
                 cut_obj.last = True
                 cut_obj.next = group[0]
```

### Comparing `meerk40t-0.8.3000/meerk40t/core/node/op_cut.py` & `meerk40t-0.8.4000/meerk40t/core/node/op_cut.py`

 * *Files 2% similar despite different names*

```diff
@@ -264,14 +264,19 @@
         Preprocess hatch values
 
         @param context:
         @param matrix:
         @param commands:
         @return:
         """
+        if isinstance(self.speed, str):
+            try:
+                self.speed = float(self.speed)
+            except ValueError:
+                pass
         native_mm = abs(complex(*matrix.transform_vector([0, UNITS_PER_MM])))
         self.settings["native_mm"] = native_mm
         self.settings["native_speed"] = self.speed * native_mm
         self.settings["native_rapid_speed"] = self.rapid_speed * native_mm
 
     def as_cutobjects(self, closed_distance=15, passes=1):
         """Generator of cutobjects for a particular operation."""
```

### Comparing `meerk40t-0.8.3000/meerk40t/core/node/op_dots.py` & `meerk40t-0.8.4000/meerk40t/core/node/op_dots.py`

 * *Files 1% similar despite different names*

```diff
@@ -238,14 +238,19 @@
         Preprocess hatch values
 
         @param context:
         @param matrix:
         @param commands:
         @return:
         """
+        if isinstance(self.speed, str):
+            try:
+                self.speed = float(self.speed)
+            except ValueError:
+                pass
         native_mm = abs(complex(*matrix.transform_vector([0, UNITS_PER_MM])))
         self.settings["native_mm"] = native_mm
         self.settings["native_speed"] = self.speed * native_mm
         self.settings["native_rapid_speed"] = self.rapid_speed * native_mm
 
     def as_cutobjects(self, closed_distance=15, passes=1):
         """Generator of cutobjects for a particular operation."""
```

### Comparing `meerk40t-0.8.3000/meerk40t/core/node/op_engrave.py` & `meerk40t-0.8.4000/meerk40t/core/node/op_engrave.py`

 * *Files 2% similar despite different names*

```diff
@@ -262,14 +262,19 @@
         Preprocess hatch values
 
         @param context:
         @param matrix:
         @param commands:
         @return:
         """
+        if isinstance(self.speed, str):
+            try:
+                self.speed = float(self.speed)
+            except ValueError:
+                pass
         native_mm = abs(complex(*matrix.transform_vector([0, UNITS_PER_MM])))
         self.settings["native_mm"] = native_mm
         self.settings["native_speed"] = self.speed * native_mm
         self.settings["native_rapid_speed"] = self.rapid_speed * native_mm
 
     def as_cutobjects(self, closed_distance=15, passes=1):
         """Generator of cutobjects for a particular operation."""
```

### Comparing `meerk40t-0.8.3000/meerk40t/core/node/op_hatch.py` & `meerk40t-0.8.4000/meerk40t/core/node/op_hatch.py`

 * *Files 2% similar despite different names*

```diff
@@ -287,14 +287,19 @@
         Preprocess hatch values
 
         @param context:
         @param matrix:
         @param commands:
         @return:
         """
+        if isinstance(self.speed, str):
+            try:
+                self.speed = float(self.speed)
+            except ValueError:
+                pass
         native_mm = abs(complex(*matrix.transform_vector([0, UNITS_PER_MM])))
         self.settings["native_mm"] = native_mm
         self.settings["native_speed"] = self.speed * native_mm
         self.settings["native_rapid_speed"] = self.rapid_speed * native_mm
 
         def hatch():
             settings = self.settings
```

### Comparing `meerk40t-0.8.3000/meerk40t/core/node/op_image.py` & `meerk40t-0.8.4000/meerk40t/core/node/op_image.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/core/node/op_raster.py` & `meerk40t-0.8.4000/meerk40t/core/node/op_raster.py`

 * *Files 1% similar despite different names*

```diff
@@ -325,14 +325,19 @@
         the native matrix.
 
         @param context:
         @param matrix:
         @param plan:
         @return:
         """
+        if isinstance(self.speed, str):
+            try:
+                self.speed = float(self.speed)
+            except ValueError:
+                pass
         commands = plan.commands
         native_mm = abs(complex(*matrix.transform_vector([0, UNITS_PER_MM])))
         self.settings["native_mm"] = native_mm
         self.settings["native_speed"] = self.speed * native_mm
         self.settings["native_rapid_speed"] = self.rapid_speed * native_mm
 
         overscan = float(Length(self.settings.get("overscan", "1mm")))
```

### Comparing `meerk40t-0.8.3000/meerk40t/core/node/refnode.py` & `meerk40t-0.8.4000/meerk40t/core/node/refnode.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/core/node/rootnode.py` & `meerk40t-0.8.4000/meerk40t/core/node/rootnode.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/core/node/util_console.py` & `meerk40t-0.8.4000/meerk40t/core/node/util_console.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/core/node/util_goto.py` & `meerk40t-0.8.4000/meerk40t/core/node/util_goto.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/core/node/util_home.py` & `meerk40t-0.8.4000/meerk40t/core/node/util_home.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/core/node/util_input.py` & `meerk40t-0.8.4000/meerk40t/core/node/util_input.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/core/node/util_origin.py` & `meerk40t-0.8.4000/meerk40t/core/node/util_origin.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/core/node/util_output.py` & `meerk40t-0.8.4000/meerk40t/core/node/util_output.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/core/node/util_wait.py` & `meerk40t-0.8.4000/meerk40t/core/node/util_wait.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/core/parameters.py` & `meerk40t-0.8.4000/meerk40t/core/parameters.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/core/planner.py` & `meerk40t-0.8.4000/meerk40t/core/planner.py`

 * *Files 4% similar despite different names*

```diff
@@ -66,15 +66,15 @@
                 )
                 + "\n\n"
                 + _(
                     "When this option IS checked, Meerk40t will burn each subpath "
                     + "and then move to the nearest remaining subpath instead, "
                     + "reducing the time taken moving between burn items."
                 ),
-                "page": "Optimizations",
+                "page": "Optimisations",
                 "section": "_20_Reducing Movements",
             },
             {
                 "attr": "opt_complete_subpaths",
                 "object": context,
                 "default": True,
                 "type": bool,
@@ -91,15 +91,15 @@
                     + "from start to end rather than having burns start in the middle. "
                     + "Whilst this may create a longer travel move to the end of the subpath,"
                     + "it also avoids later travel moves to or from the intermediate point. "
                     + "The total travel time may therefore be shorter or longer. "
                     + "It may also avoid minor differences in total burn depth "
                     + "at the point the burns join. "
                 ),
-                "page": "Optimizations",
+                "page": "Optimisations",
                 "section": "_20_Reducing Movements",
                 "conditional": (context, "opt_reduce_travel"),
             },
             {
                 "attr": "opt_merge_passes",
                 "object": context,
                 "default": False,
@@ -120,15 +120,15 @@
                 + "\n\n"
                 + _(
                     "NOTE: Where you burn very short paths multiple times in quick succession, "
                     + "this does not allow time for the material to cool down between burns, "
                     + "and this can result in greater charring "
                     + "or even an increased risk of the material catching fire."
                 ),
-                "page": "Optimizations",
+                "page": "Optimisations",
                 "section": "_20_Reducing Movements",
                 "conditional": (context, "opt_reduce_travel"),
             },
             {
                 "attr": "opt_merge_ops",
                 "object": context,
                 "default": False,
@@ -145,15 +145,15 @@
                     + "If Merge Passes is also checked, then all burns will be optimised globally."
                 )
                 + "\n\n"
                 + _(
                     "If you have a complex design with many paths across multiple consecutive burn operations, "
                     + "using this option can significantly INCREASE the optimisation time. "
                 ),
-                "page": "Optimizations",
+                "page": "Optimisations",
                 "section": "_20_Reducing Movements",
                 "conditional": (context, "opt_reduce_travel"),
             },
             {
                 "attr": "opt_inner_first",
                 "object": context,
                 "default": True,
@@ -167,25 +167,25 @@
                 + _(
                     "If you find that using this option significantly increases the optimisation time, "
                     + "alternatives are: \n"
                     + "* Deselecting Cut Inner First if you are not cutting fully through your material \n"
                     + "* Putting the inner paths into a separate earlier operation(s) and not using Merge Operations or Cut Inner First \n"
                     + "* If you are using multiple passes, check Merge Passes"
                 ),
-                "page": "Optimizations",
+                "page": "Optimisations",
                 "section": "_10_Burn sequence",
             },
             {
                 "attr": "opt_inner_tolerance",
                 "object": context,
                 "default": "0",
                 "type": Length,
                 "label": _("Tolerance"),
                 "tip": _("Tolerance to decide if a shape is truly inside another one."),
-                "page": "Optimizations",
+                "page": "Optimisations",
                 "section": "_10_Burn sequence",
                 "conditional": (context, "opt_inner_first"),
             },
             {
                 "attr": "opt_inners_grouped",
                 "object": context,
                 "default": False,
@@ -206,28 +206,28 @@
                 )
                 + "\n\n"
                 + _(
                     "Because this optimisation is done once rasters have been turned into images, "
                     + "inner elements may span multiple design pieces, "
                     + "in which case they may be optimised together."
                 ),
-                "page": "Optimizations",
+                "page": "Optimisations",
                 "section": "_10_Burn sequence",
                 "conditional": (context, "opt_inner_first"),
             },
             {
                 "attr": "opt_closed_distance",
                 "object": context,
                 "default": 15,
                 "type": int,
                 "label": _("Closed Distance"),
                 "tip": _(
                     "How close in device specific natural units do endpoints need to be to count as closed?"
                 ),
-                "page": "Optimizations",
+                "page": "Optimisations",
                 "section": "_20_Reducing Movements",
                 "hidden": True,
             },
         ]
         kernel.register_choices("optimize", choices)
 
         context.setting(bool, "opt_2opt", False)
@@ -338,14 +338,20 @@
         @self.console_command(
             ("copy", "copy-selected"),
             help=_("plan(-selected)<?> copy"),
             input_type="plan",
             output_type="plan",
         )
         def plan_copy(command, channel, _, data_type=None, data=None, **kwgs):
+            # Update Info-panel if displayed
+            busy = self.kernel.busyinfo
+            if busy.shown:
+                busy.change(msg=_("Copy data"), keep=1)
+                busy.show()
+
             operations = data  # unused.
             if command == "copy-selected":
                 operations = list(self.elements.ops(emphasized=True))
             else:
                 operations = list(self.elements.ops())
 
             def init_settings():
@@ -564,25 +570,37 @@
         @self.console_command(
             "preprocess",
             help=_("plan<?> preprocess"),
             input_type="plan",
             output_type="plan",
         )
         def plan_preprocess(command, channel, _, data_type=None, data=None, **kwgs):
+            # Update Info-panel if displayed
+            busy = self.kernel.busyinfo
+            if busy.shown:
+                busy.change(msg=_("Preprocessing"), keep=1)
+                busy.show()
+
             data.preprocess()
             self.signal("plan", data.name, 2)
             return data_type, data
 
         @self.console_command(
             "validate",
             help=_("plan<?> validate"),
             input_type="plan",
             output_type="plan",
         )
         def plan_validate(command, channel, _, data_type=None, data=None, **kwgs):
+            # Update Info-panel if displayed
+            busy = self.kernel.busyinfo
+            if busy.shown:
+                busy.change(msg=_("Validating"), keep=1)
+                busy.show()
+
             try:
                 data.execute()
             except CutPlanningFailedError as e:
                 self.signal("cutplanning;failed", str(e))
                 data.clear()
                 return
             self.signal("plan", data.name, 3)
@@ -591,47 +609,71 @@
         @self.console_command(
             "blob",
             help=_("plan<?> blob"),
             input_type="plan",
             output_type="plan",
         )
         def plan_blob(data_type=None, data=None, **kwgs):
+            # Update Info-panel if displayed
+            busy = self.kernel.busyinfo
+            if busy.shown:
+                busy.change(msg=_("Generating lasercode"), keep=1)
+                busy.show()
+
             data.blob()
             self.signal("plan", data.name, 4)
             return data_type, data
 
         @self.console_command(
             "preopt",
             help=_("plan<?> preopt"),
             input_type="plan",
             output_type="plan",
         )
         def plan_preopt(data_type=None, data=None, **kwgs):
+            # Update Info-panel if displayed
+            busy = self.kernel.busyinfo
+            if busy.shown:
+                busy.change(msg=_("Preparing optimisation"), keep=1)
+                busy.show()
+
             data.preopt()
             self.signal("plan", data.name, 5)
             return data_type, data
 
         @self.console_command(
             "optimize",
             help=_("plan<?> optimize"),
             input_type="plan",
             output_type="plan",
         )
         def plan_optimize(data_type=None, data=None, **kwgs):
+            # Update Info-panel if displayed
+            busy = self.kernel.busyinfo
+            if busy.shown:
+                busy.change(msg=_("Optimising"), keep=1)
+                busy.show()
+
             data.execute()
             self.signal("plan", data.name, 6)
             return data_type, data
 
         @self.console_command(
             "clear",
             help=_("plan<?> clear"),
             input_type="plan",
             output_type="plan",
         )
         def plan_clear(data_type=None, data=None, **kwgs):
+            # Update Info-panel if displayed
+            busy = self.kernel.busyinfo
+            if busy.shown:
+                busy.change(msg=_("Clearing data"), keep=1)
+                busy.show()
+
             data.clear()
             self.signal("plan", data.name, 0)
             return data_type, data
 
         @self.console_command(
             "return",
             help=_("plan<?> return"),
```

### Comparing `meerk40t-0.8.3000/meerk40t/core/plotplanner.py` & `meerk40t-0.8.4000/meerk40t/core/plotplanner.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/core/spoolers.py` & `meerk40t-0.8.4000/meerk40t/core/spoolers.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/core/svg_io.py` & `meerk40t-0.8.4000/meerk40t/core/svg_io.py`

 * *Files 2% similar despite different names*

```diff
@@ -517,15 +517,15 @@
         Write the operations branch part of the tree to disk.
 
         @param xml_tree:
         @param elem_tree:
         @return:
         """
         for c in op_tree.children:
-            if c.type.startswith("util"):
+            if c.type.startswith("util") or c.type.startswith("place"):
                 subelement = SubElement(xml_tree, MEERK40T_XMLS_ID + ":operation")
                 SVGWriter._write_custom(subelement, c)
             else:
                 SVGWriter._write_operation(xml_tree, c)
 
     @staticmethod
     def _write_regmarks(xml_tree, reg_tree, version):
@@ -565,15 +565,15 @@
                 subelement.set(key, str(value))
         except AttributeError:
             pass
         contains = list()
         for c in node.children:
             if c.type == "reference":
                 c = c.node  # Contain direct reference not reference node reference.
-            contains.append(c.id)
+            contains.append(str(c.id))
         if contains:
             subelement.set("references", " ".join(contains))
         subelement.set(SVG_ATTR_ID, str(node.id))
 
     @staticmethod
     def _write_custom(subelement, node):
         subelement.set("type", node.type)
@@ -616,17 +616,18 @@
 class SVGProcessor:
     def __init__(self, elements):
         self.elements = elements
         self.element_list = list()
         self.regmark_list = list()
         self.reverse = False
         self.requires_classification = True
-        self.operations_cleared = False
+        self.operations_replaced = False
         self.pathname = None
         self.regmark = None
+        self.operation_list = list()
 
         # Setting this is bringing as much benefit as anticipated
         # Both the time to load the file (unexpectedly) as well as the time
         # for the first emphasis when all the nonpopulated bounding
         # boxes will be calculated are benefitting from this precalculation:
         # (All values as average over three consecutive loads)
         #                    |           Load             |       First Select
@@ -640,15 +641,19 @@
         self.pathname = pathname
         context_node = self.elements.get(type="branch elems")
         file_node = context_node.add(type="file", filepath=pathname)
         self.regmark = self.elements.reg_branch
         file_node.focus()
 
         self.parse(svg, file_node, self.element_list)
-        if self.operations_cleared:
+        if self.operations_replaced:
+            self.elements.undo.mark("op-replaced")
+            self.elements.clear_operations()
+            for node in self.operation_list:
+                op = self.elements.op_branch.add_node(node)
             for op in self.elements.ops():
                 if not hasattr(op, "settings"):
                     # Some special nodes might lack settings these can't have references.
                     continue
                 refs = op.settings.get("references")
                 if refs is None:
                     continue
@@ -1118,29 +1123,25 @@
             if "fill" in attrs:
                 attrs["fill"] = Color(attrs["fill"])
             if "stroke" in attrs:
                 attrs["stroke"] = Color(attrs["stroke"])
 
             if tag == "operation":
                 # Check if SVGElement: operation
-                if not self.operations_cleared:
-                    self.elements.clear_operations()
-                    self.operations_cleared = True
+                if not self.operations_replaced:
+                    self.operations_replaced = True
 
                 try:
-                    node = self.elements.op_branch.create(type=node_type, **attrs)
-                    node.validate()
-                    node.id = node_id
-                    op = self.elements.op_branch.add_node(node)
-                    overlooked_attributes = [
-                        "output",
-                    ]
-                    for overlooked in overlooked_attributes:
-                        if overlooked in element.values and hasattr(op, overlooked):
-                            setattr(op, overlooked, element.values.get(overlooked))
+                    op = self.elements.op_branch.create(type=node_type, **attrs)
+                    if op is None or not hasattr(op, "type") or op.type is None:
+                        return
+                    if hasattr(op, "validate"):
+                        op.validate()
+                    op.id = node_id
+                    self.operation_list.append(op)
                 except AttributeError:
                     # This operation is invalid.
                     return
             elif tag == "element":
                 # Check if SVGElement: element
                 if "settings" in attrs:
                     del attrs[
```

### Comparing `meerk40t-0.8.3000/meerk40t/core/treeop.py` & `meerk40t-0.8.4000/meerk40t/core/treeop.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/core/undos.py` & `meerk40t-0.8.4000/meerk40t/core/undos.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/core/units.py` & `meerk40t-0.8.4000/meerk40t/core/units.py`

 * *Files 6% similar despite different names*

```diff
@@ -71,16 +71,14 @@
     """
     The width and height are of the viewport are stored in MK native units (1/65535) in.
     Origin_x and origin_y are the location of the machine home position in factors of 1.
     This is to say 1,1 is the bottom left, and 0.5 0.5 is the middle of the bed.
     * user_scale is a scale factor for applied by the user rather than the driver.
     * native_scale is the scale factor of the driver units to MK native units
     * flip_x, flip_y, and swap_xy are used to apply whatever flips and swaps are needed.
-    * show_origin is the 0,0 point as seen, for example galvo lasers call 0,0 center of the screen, but the machine
-        units actually have 0,0 as the upper-left corner (depending on the flips and rotates)
     """
 
     def __init__(
         self,
         width,
         height,
         origin_x=0.0,
@@ -88,30 +86,22 @@
         user_scale_x=1.0,
         user_scale_y=1.0,
         native_scale_x=1.0,
         native_scale_y=1.0,
         flip_x=False,
         flip_y=False,
         swap_xy=False,
-        show_origin_x=None,
-        show_origin_y=None,
-        show_flip_x=None,
-        show_flip_y=None,
         rotary_active=False,
         rotary_scale_x=1.0,
         rotary_scale_y=1.0,
         rotary_flip_x=False,
         rotary_flip_y=False,
     ):
         self._device_to_scene_matrix = None
-        self._device_to_show_matrix = None
         self._scene_to_device_matrix = None
-        self._scene_to_show_matrix = None
-        self._show_to_device_matrix = None
-        self._show_to_scene_matrix = None
 
         self.width = width
         self.height = height
         self.origin_x = origin_x
         self.origin_y = origin_y
         self.user_scale_x = user_scale_x
         self.user_scale_y = user_scale_y
@@ -121,38 +111,22 @@
         self.flip_y = flip_y
         self.rotary_active = rotary_active
         self.rotary_flip_x = rotary_flip_x
         self.rotary_flip_y = rotary_flip_y
         self.rotary_scale_x = rotary_scale_x
         self.rotary_scale_y = rotary_scale_y
         self.swap_xy = swap_xy
-        if show_origin_x is None:
-            show_origin_x = origin_x
-        if show_origin_y is None:
-            show_origin_y = origin_y
-        if show_flip_x is None:
-            show_flip_x = flip_x
-        if show_flip_y is None:
-            show_flip_y = flip_y
-        self.show_origin_x = show_origin_x
-        self.show_origin_y = show_origin_y
-        self.show_flip_x = show_flip_x
-        self.show_flip_y = show_flip_y
 
         self._width = None
         self._height = None
         self.realize()
 
     def realize(self):
         self._device_to_scene_matrix = None
-        self._device_to_show_matrix = None
         self._scene_to_device_matrix = None
-        self._scene_to_show_matrix = None
-        self._show_to_device_matrix = None
-        self._show_to_scene_matrix = None
         self._width = self.unit_width
         self._height = self.unit_height
 
     def physical_to_device_position(self, x, y, unitless=1):
         """
         Converts a physical X,Y position into device units.
 
@@ -177,26 +151,14 @@
         """
         unit_x = Length(x, relative_length=self._width, unitless=unitless).units
         unit_y = Length(y, relative_length=self._height, unitless=unitless).units
         if self.swap_xy:
             return unit_y, unit_x
         return unit_x, unit_y
 
-    def physical_to_show_position(self, x, y, unitless=1):
-        """
-        Converts a physical X,Y position into show units.
-
-        @param x:
-        @param y:
-        @param unitless:
-        @return:
-        """
-        x, y = self.physical_to_scene_position(x, y, unitless)
-        return self.scene_to_show_position(x, y)
-
     def physical_to_device_length(self, x, y, unitless=1):
         """
         Converts a physical X,Y vector into device vector (dx, dy).
 
         This natively assumes device coordinate systems are affine. If we convert (0, 1in) as a vector into
         machine units we are converting the length of 1in into the equal length in machine units. Positionally this
         could be flipped or moved anywhere in the machine. But, the distance should be the same. However, in some cases
@@ -222,28 +184,14 @@
         if vector:
             point = self.device_to_scene_matrix().transform_vector((x, y))
             return point.x, point.y
         else:
             point = self.device_to_scene_matrix().point_in_matrix_space((x, y))
             return point.x, point.y
 
-    def device_to_show_position(self, x, y, vector=False):
-        """
-        @param x:
-        @param y:
-        @param vector:
-        @return:
-        """
-        if vector:
-            point = self.device_to_show_matrix().transform_vector((x, y))
-            return point.x, point.y
-        else:
-            point = self.device_to_show_matrix().point_in_matrix_space((x, y))
-            return point.x, point.y
-
     def scene_to_device_position(self, x, y, vector=False):
         """
         Converts scene to a device position (or vector). Converts x, y from scene units (1/65535) inches into
         device specific units. Optionally allows the calculation of a vector distance.
 
         @param x:
         @param y:
@@ -253,124 +201,42 @@
         if vector:
             point = self.scene_to_device_matrix().transform_vector([x, y])
             return point[0], point[1]
         else:
             point = self.scene_to_device_matrix().point_in_matrix_space((x, y))
             return point.x, point.y
 
-    def scene_to_show_position(self, x, y, vector=False):
-        """
-        @param x:
-        @param y:
-        @param vector:
-        @return:
-        """
-        if vector:
-            point = self.scene_to_show_matrix().transform_vector([x, y])
-            return point[0], point[1]
-        else:
-            point = self.scene_to_show_matrix().point_in_matrix_space((x, y))
-            return point.x, point.y
-
-    def show_to_device_position(self, x, y, vector=False):
-        """
-        @param x:
-        @param y:
-        @param vector:
-        @return:
-        """
-        if vector:
-            point = self.show_to_device_matrix().transform_vector((x, y))
-            return point.x, point.y
-        else:
-            point = self.show_to_device_matrix().point_in_matrix_space((x, y))
-            return point.x, point.y
-
-    def show_to_scene_position(self, x, y, vector=False):
-        """
-        @param x:
-        @param y:
-        @param vector:
-        @return:
-        """
-        if vector:
-            point = self.show_to_scene_matrix().transform_vector((x, y))
-            return point.x, point.y
-        else:
-            point = self.show_to_scene_matrix().point_in_matrix_space((x, y))
-            return point.x, point.y
-
     def device_position(self, x, y):
         m = self.scene_to_device_matrix()
         return m.point_in_matrix_space((x, y))
 
     def _calculate_matrices(self):
         """
         Calculate the matrices between the scene and device units.
         """
         self._scene_to_device_matrix = Matrix(self._scene_to_device_transform())
         self._device_to_scene_matrix = Matrix(self._scene_to_device_matrix)
         self._device_to_scene_matrix.inverse()
-        self._scene_to_show_matrix = Matrix(self._scene_to_show_transform())
-        self._show_to_scene_matrix = Matrix(self._scene_to_show_matrix)
-        self._show_to_scene_matrix.inverse()
-        self._show_to_device_matrix = (
-            self._show_to_scene_matrix * self._scene_to_device_matrix
-        )
-        self._device_to_show_matrix = Matrix(self._show_to_device_matrix)
-        self._device_to_show_matrix.inverse()
 
     def device_to_scene_matrix(self):
         """
         Returns the device-to-scene matrix.
         """
         if self._device_to_scene_matrix is None:
             self._calculate_matrices()
         return self._device_to_scene_matrix
 
-    def device_to_show_matrix(self):
-        """
-        Returns the device-to-scene matrix.
-        """
-        if self._device_to_show_matrix is None:
-            self._calculate_matrices()
-        return self._device_to_show_matrix
-
     def scene_to_device_matrix(self):
         """
         Returns the scene-to-device matrix.
         """
         if self._scene_to_device_matrix is None:
             self._calculate_matrices()
         return self._scene_to_device_matrix
 
-    def scene_to_show_matrix(self):
-        """
-        Returns the scene-to-device matrix.
-        """
-        if self._scene_to_show_matrix is None:
-            self._calculate_matrices()
-        return self._scene_to_show_matrix
-
-    def show_to_device_matrix(self):
-        """
-        Returns the scene-to-device matrix.
-        """
-        if self._show_to_device_matrix is None:
-            self._calculate_matrices()
-        return self._show_to_device_matrix
-
-    def show_to_scene_matrix(self):
-        """
-        Returns the device-to-scene matrix.
-        """
-        if self._show_to_scene_matrix is None:
-            self._calculate_matrices()
-        return self._show_to_scene_matrix
-
     def _scene_to_device_transform(self):
         """
         Transform for moving from scene units to device units. This takes into account the user and native scaling, the
         shift in origin point, flips to the y-axis, flips to the x-axis, and axis_swapping.
 
         @return:
         """
@@ -398,31 +264,14 @@
             ops.append("scale(-1.0, 1.0)")
         if dx != 0 or dy != 0:
             ops.append(f"translate({-dx:.13f}, {-dy:.13f})")
         if self.swap_xy:
             ops.append("scale(-1.0, 1.0) rotate(90deg)")
         return " ".join(ops)
 
-    def _scene_to_show_transform(self):
-        """
-        @return:
-        """
-        dx = self.unit_width * self.show_origin_x
-        dy = self.unit_height * self.show_origin_y
-        ops = []
-        if self.show_flip_x:
-            ops.append("scale(-1.0, 1.0)")
-        if self.show_flip_y:
-            ops.append("scale(1.0, -1.0)")
-        if dx != 0 or dy != 0:
-            ops.append(f"translate({-dx:.13f}, {-dy:.13f})")
-        if self.swap_xy:
-            ops.append("scale(-1.0, 1.0) rotate(90deg)")
-        return " ".join(ops)
-
     def native_mm(self):
         matrix = self.scene_to_device_matrix()
         return abs(complex(*matrix.transform_vector([0, UNITS_PER_MM])))
 
     def length(
         self,
         value,
```

### Comparing `meerk40t-0.8.3000/meerk40t/core/webhelp.py` & `meerk40t-0.8.4000/meerk40t/core/webhelp.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/core/wordlist.py` & `meerk40t-0.8.4000/meerk40t/core/wordlist.py`

 * *Files 3% similar despite different names*

```diff
@@ -42,14 +42,15 @@
             "time",
             "op_device",
             "op_speed",
             "op_power",
             "op_passes",
             "op_dpi",
         )
+        self._stack = list()
         self.transaction_open = False
         self.content_backup = {}
         if directory is None:
             directory = os.getcwd()
         self.default_filename = os.path.join(directory, "wordlist.json")
         self.load_data(self.default_filename)
 
@@ -189,15 +190,17 @@
         if skey is None:
             for skey in self.content:
                 self.content[skey][1] = 2
         else:
             self.content[skey][1] = 2
 
     def translate(self, pattern, increment=True):
-        result = pattern
+        if pattern is None:
+            return ""
+        result = str(pattern)
         brackets = re.compile(r"\{[^}]+\}")
         for bracketed_key in brackets.findall(result):
             #            print(f"Key found: {bracketed_key}")
             key = bracketed_key[1:-1].lower().strip()
             # Let's check whether we have a modifier at the end: #<num>
             # if key.endswith("++"):
             #     autoincrement = True
@@ -270,15 +273,15 @@
                         value = 0
                     value += relative
                     if autoincrement and increment:
                         # autoincrement of counter means value + 1
                         wordlist[2] = value + 1
                 else:
                     # This is a variable wordlist.
-                    current_index = wordlist[1] if not reset else 0
+                    current_index = wordlist[1] if not reset else 2  # 2 as 2 based
                     current_index += relative
                     value = self.fetch_value(key, current_index)
                     if autoincrement and increment:
                         # Index set to current index + 1
                         wordlist[1] = current_index + 1
 
             if value is not None:
@@ -478,7 +481,25 @@
         if increase >= 0:
             toreplace.sort(key=lambda n: n[0])
         else:
             toreplace.sort(reverse=True, key=lambda n: n[0])
         for item in toreplace:
             newtext = newtext.replace(item[1], item[2])
         return newtext
+
+    def push(self):
+        """Stores the current content on the stack"""
+        copied_content = {}
+        for key, entry in self.content.items():
+            copied_content[key] = copy(entry)
+        self._stack.append(copied_content)
+        # print (f"push was called, when name was: '{self.content['name']}'")
+
+    def pop(self):
+        """Restores the last added stack entry"""
+        if len(self._stack) > 0:
+            copied_content = self._stack[-1]
+            self._stack.pop(-1)
+            self.content = {}
+            for key, entry in copied_content.items():
+                self.content[key] = copy(entry)
+        # print (f"pop was called, name now '{self.content['name']}'")
```

### Comparing `meerk40t-0.8.3000/meerk40t/device/basedevice.py` & `meerk40t-0.8.4000/meerk40t/device/basedevice.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/device/ch341/ch341.py` & `meerk40t-0.8.4000/meerk40t/device/ch341/ch341.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/device/ch341/ch341libusbdriver.py` & `meerk40t-0.8.4000/meerk40t/device/ch341/ch341libusbdriver.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/device/ch341/libusb.py` & `meerk40t-0.8.4000/meerk40t/device/ch341/libusb.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/device/ch341/mock.py` & `meerk40t-0.8.4000/meerk40t/device/ch341/mock.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/device/ch341/windll.py` & `meerk40t-0.8.4000/meerk40t/device/ch341/windll.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/device/dummydevice.py` & `meerk40t-0.8.4000/meerk40t/device/dummydevice.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/device/gui/defaultactions.py` & `meerk40t-0.8.4000/meerk40t/device/gui/defaultactions.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/device/gui/formatterpanel.py` & `meerk40t-0.8.4000/meerk40t/device/gui/formatterpanel.py`

 * *Files 1% similar despite different names*

```diff
@@ -4,14 +4,15 @@
 from meerk40t.gui.choicepropertypanel import ChoicePropertyPanel
 from meerk40t.gui.icons import (
     icons8_diagonal_20,
     icons8_direction_20,
     icons8_file_20,
     icons8_group_objects_20,
     icons8_home_20,
+    icons8_home_location_20,
     icons8_image_20,
     icons8_image_50,
     icons8_input_20,
     icons8_laser_beam_20,
     icons8_output_20,
     icons8_oval_50,
     icons8_polyline_50,
@@ -62,14 +63,16 @@
             "elem image": icons8_image_50,
             "elem path": icons8_vector_50,
             "elem geomstr": icons8_vector_50,
             "elem polyline": icons8_polyline_50,
             "elem rect": icons8_rectangular_50,
             "elem line": icons8_polyline_50,
             "elem text": icons8_text_50,
+            "place current": icons8_home_location_20,
+            "place point": icons8_home_location_20,
         }
         omit = ("elem geomstr", "elem line")
         self.node_list = list(elem_group_nodes + op_nodes)
         for node in omit:
             try:
                 self.node_list.remove(node)
             except ValueError:
```

### Comparing `meerk40t-0.8.3000/meerk40t/device/gui/warningpanel.py` & `meerk40t-0.8.4000/meerk40t/device/gui/warningpanel.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/dxf/dxf_io.py` & `meerk40t-0.8.4000/meerk40t/dxf/dxf_io.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/dxf/plugin.py` & `meerk40t-0.8.4000/meerk40t/dxf/plugin.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/extra/cag.py` & `meerk40t-0.8.4000/meerk40t/extra/cag.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/extra/embroider.py` & `meerk40t-0.8.4000/meerk40t/extra/embroider.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/extra/hershey.py` & `meerk40t-0.8.4000/meerk40t/extra/hershey.py`

 * *Files 4% similar despite different names*

```diff
@@ -94,40 +94,51 @@
         and hasattr(node, "mkfont")
         and hasattr(node, "mkfontsize")
     ):
         update_linetext(context, node, node.mktext)
 
 
 def update_linetext(context, node, newtext):
+    # print ("Update Linetext")
     if node is None:
+        # print ("node is none, exit")
         return
     if not hasattr(node, "mkfont"):
+        # print ("no font attr, exit")
         return
     if not hasattr(node, "mkfontsize"):
+        # print ("no fontsize attr, exit")
         return
+    oldtext = getattr(node, "_translated_text", "")
     registered_fonts = fonts_registered()
     fontname = node.mkfont
     fontsize = node.mkfontsize
     # old_color = node.stroke
     # old_strokewidth = node.stroke_width
     # old_strokescaled = node._stroke_scaled
     font_dir = getattr(context, "font_directory", "")
     font_path = join(font_dir, fontname)
     if not exists(font_path):
-        return
+        # Fallback to meerk40t directory...
+        safe_dir = realpath(get_safe_path(context.kernel.name))
+        font_path = join(safe_dir, fontname)
+        if not exists(font_path):
+            return
     try:
         filename, file_extension = splitext(font_path)
         if len(file_extension) > 0:
             # Remove dot...
             file_extension = file_extension[1:].lower()
         item = registered_fonts[file_extension]
         fontclass = item[1]
     except (KeyError, IndexError):
         # channel(_("Unknown fonttype {ext}").format(ext=file_extension))
+        # print ("unknown fonttype, exit")
         return
+    # print("Nearly there, all fonts checked...")
     cfont = fontclass(font_path)
     path = FontPath()
     # print (f"Path={path}, text={remainder}, font-size={font_size}")
     horizontal = True
     mytext = context.elements.wordlist_translate(newtext)
     cfont.render(path, mytext, horizontal, float(fontsize))
     olda = node.path.transform.a
@@ -141,16 +152,17 @@
     node.path.transform.b = oldb
     node.path.transform.c = oldc
     node.path.transform.d = oldd
     node.path.transform.e = olde
     node.path.transform.f = oldf
     # print (f"x={node.mkcoordx}, y={node.mkcoordy}")
     # node.path.transform = Matrix.translate(node.mkcoordx, node.mkcoordy)
-
+    # print (f"Updated: from {oldtext} -> {mytext}")
     node.mktext = newtext
+    node._translated_text = mytext
     node.altered()
 
 
 def create_linetext_node(context, x, y, text, font=None, font_size=None):
     registered_fonts = fonts_registered()
 
     if font_size is None:
@@ -244,14 +256,15 @@
         path=path.path,
         stroke=Color("black"),
     )
     path_node.matrix.post_translate(x, y)
     path_node.mkfont = font
     path_node.mkfontsize = float(font_size)
     path_node.mktext = text
+    path_node._translated_text = mytext
     path_node.mkcoordx = x
     path_node.mkcoordy = y
     path_node.stroke_width = UNITS_PER_PIXEL
 
     return path_node
```

### Comparing `meerk40t-0.8.3000/meerk40t/extra/imageactions.py` & `meerk40t-0.8.4000/meerk40t/extra/imageactions.py`

 * *Files 4% similar despite different names*

```diff
@@ -35,14 +35,15 @@
             _,
             cols=None,
             rows=None,
             dpi=None,
             order=None,
             origin=None,
             data=None,
+            post=None,
             **kwargs,
         ):
             def prepare_data(data, dsort):
                 if dsort == "first":
                     data.sort(key=lambda n: n.emphasized_time)
                 elif dsort == "last":
                     data.sort(reverse=True, key=lambda n: n.emphasized_time)
@@ -124,14 +125,15 @@
                         startx = endx + 1
                         offset_x += deltax_bound
                     starty = endy + 1
                     offset_y += deltay_bound
                 return data_out
 
             elements = context.elements
+            classify_new = elements.post_classify
             if data is None:
                 data = list(elements.elems(emphasized=True))
             if cols is None:
                 cols = 1
             if rows is None:
                 rows = cols
             if order is None:
@@ -140,14 +142,19 @@
                 dpi = 500
             bb = prepare_data(data, order)
             image, matrix = create_image(data, bb, dpi)
             if image is None:
                 data_out = None
             else:
                 data_out = split_image(image, matrix, bb, dpi, cols, rows)
+            if data_out is not None:
+                # Newly created! Classification needed?
+                post.append(classify_new(data_out))
+                elements.signal("element_added", data_out)
+                elements.signal("refresh_scene", "Scene")
             return "elements", data_out
 
         @kernel.console_argument("dpi", type=int, help=_("Resolution of created image"))
         @kernel.console_option(
             "order", "o", help=_("ordering selection: none, first, last"), type=str
         )
         @kernel.console_option(
@@ -170,14 +177,15 @@
             _,
             dpi=None,
             order=None,
             invert=None,
             outline=None,
             origin=None,
             data=None,
+            post=None,
             **kwargs,
         ):
             def prepare_data(dsort):
                 # def debug_data(msg):
                 #     print (f"{msg}")
                 #     for idx, node in enumerate(data):
                 #         print (f"{idx} - {node.type}")
@@ -223,34 +231,40 @@
 
             def mask_image(elem_image, mask_image, matrix, bbounds, dpi):
                 offset_x = bbounds[0]
                 offset_y = bbounds[1]
                 data_out = None
                 # elem_image.convert("RGBA")
                 imagematrix0 = copy(matrix)
+                dx = offset_x - imagematrix0.value_trans_x()
+                dy = offset_y - imagematrix0.value_trans_y()
                 imagematrix0.post_translate(offset_x, offset_y)
                 imagematrix1 = copy(imagematrix0)
-                imagematrix2 = copy(imagematrix1)
 
                 mask_pattern = mask_image.convert("1")
                 elem_image.putalpha(mask_pattern)
 
-                image_node1 = ImageNode(image=elem_image, matrix=imagematrix1, dpi=dpi)
+                image_node1 = ImageNode(
+                    image=elem_image,
+                    matrix=imagematrix1,
+                    dpi=dpi,
+                    label="Keyholed Elements",
+                )
                 image_node1.set_dirty_bounds()
-                image_node1.label = "Keyholed Elements"
                 elements.elem_branch.add_node(image_node1)
 
                 # image_node2 = ImageNode(image=mask_image, matrix=imagematrix2, dpi=dpi)
                 # image_node2.set_dirty_bounds()
                 # image_node2.label = "Mask"
                 # elements.elem_branch.add_node(image_node2)
                 data_out = [image_node1]
                 return data_out
 
             elements = context.elements
+            classify_new = elements.post_classify
             if data is None:
                 data = list(elements.elems(emphasized=True))
             if order is None:
                 order = ""
             if dpi is None or dpi <= 0:
                 dpi = 500
             if invert is None or invert == 0:
@@ -299,8 +313,13 @@
             if maskimage is None or elemimage is None:
                 channel(_("Intermediary images were none"))
                 data_out = None
             else:
                 data_out = mask_image(
                     elemimage, maskimage, elemmatrix, total_bounds, dpi
                 )
+            if data_out is not None:
+                # Newly created! Classification needed?
+                post.append(classify_new(data_out))
+                elements.signal("element_added", data_out)
+                elements.signal("refresh_scene", "Scene")
             return "elements", data_out
```

### Comparing `meerk40t-0.8.3000/meerk40t/extra/inkscape.py` & `meerk40t-0.8.4000/meerk40t/extra/inkscape.py`

 * *Files 3% similar despite different names*

```diff
@@ -24,14 +24,15 @@
         ]
     elif system == "Windows":
         candidates = [
             "C:/Program Files (x86)/Inkscape/inkscape.exe",
             "C:/Program Files (x86)/Inkscape/bin/inkscape.exe",
             "C:/Program Files/Inkscape/inkscape.exe",
             "C:/Program Files/Inkscape/bin/inkscape.exe",
+            "C:/inkscape/bin/inkscape.exe",
         ]
     elif system == "Linux":
         candidates = [
             "/usr/local/bin/inkscape",
             "/usr/bin/inkscape",
         ]
     else:
@@ -73,17 +74,20 @@
         c = run(command_array, timeout=timeout_value, stdout=PIPE)
         end_time = time()
         if f:
             f.write(
                 f"Executed successfully, result: {c.returncode} (execution time: {end_time-start_time:.1f} sec)\n"
             )
             f.write("Output:\n")
-            f.write(c.stdout.decode("utf-8") + "\n")
+            try:
+                f.write(c.stdout.decode("utf-8", errors="surrogateescape"))
+            except UnicodeDecodeError:
+                pass
         result = True
-    except (FileNotFoundError, TimeoutExpired) as e:
+    except (FileNotFoundError, TimeoutExpired, UnicodeDecodeError) as e:
         if f:
             f.write(f"Execution failed: {str(e)}\n")
     if f:
         f.close()
     return result, c
 
 
@@ -143,16 +147,18 @@
         inkscape = get_inkscape(context_root)
         if not inkscape:
             raise BadFileError("Inkscape not found")
 
         result, c = run_command_and_log([inkscape, "-V"], logfile)
         if not result:
             return pathname
-
-        version = c.stdout.decode("utf-8")
+        try:
+            version = c.stdout.decode("utf-8", errors="surrogateescape")
+        except UnicodeDecodeError:
+            version = "inkscape 1.x"
 
         svg_temp_file = os.path.join(safe_dir, "inkscape.svg")
         logfile = os.path.join(safe_dir, "inkscape.log")
 
         # Check Version of Inkscape
         if "inkscape 1." in version.lower():
             cmd = [
@@ -323,17 +329,22 @@
         )
         def inkscape_version(channel, _, data, **kwargs):
             inkscape_path, filename = data
             if not os.path.exists(inkscape_path):
                 channel(_("Inkscape not found. Try 'inkscape locate'"))
                 return
             c = run([inkscape_path, "-V"], stdout=PIPE)
+            try:
+                version = c.stdout.decode("utf-8", errors="surrogateescape")
+            except UnicodeDecodeError:
+                version = "unknown"
+
             channel(
                 _('Inkscape executable at "{path}" is: {version}').format(
-                    path=inkscape_path, version=c.stdout.decode("utf-8")
+                    path=inkscape_path, version=version
                 )
             )
             return "inkscape", data
 
         @kernel.console_argument(
             "inkpath", type=str, help=_("Optional: location of inkscape executable")
         )
@@ -390,15 +401,15 @@
                 ],
                 "pattern": [False, ("<pattern",), METHOD_CONVERT_TO_PNG],
             }
             safe_dir = os.path.realpath(get_safe_path(kernel.name))
             svg_temp_file = os.path.join(safe_dir, "temp.svg")
             png_temp_file = os.path.join(safe_dir, "temp.png")
             needs_conversion = 0
-            with open(source, mode="r", encoding="utf8") as f:
+            with open(source, mode="r", encoding="utf8", errors="surrogateescape") as f:
                 while True:
                     line = f.readline().lower()
                     if not line:
                         break
                     for feat, entry in features.items():
                         for candidate in entry[1]:
                             if candidate in line:
@@ -463,16 +474,19 @@
             if wasbusy:
                 kernel.busyinfo.change(msg=_("Calling inkscape..."))
                 kernel.busyinfo.show()
             log_file = os.path.join(safe_dir, "inkscape.log")
             result, c = run_command_and_log([inkscape, "-V"], log_file)
             if not result:
                 return pathname
-
-            version = c.stdout.decode("utf-8")
+            version = None
+            try:
+                version = c.stdout.decode(encoding="utf-8", errors="surrogateescape")
+            except UnicodeDecodeError:
+                version = "inkscape 1.x"
 
             if needs_conversion == METHOD_CONVERT_TO_OBJECT:
                 # Ask inkscape to convert all text elements to paths
                 # slightly different invocation for different values
                 # Check Version of Inkscape
                 if "inkscape 1." in version.lower():
                     cmd = [
```

### Comparing `meerk40t-0.8.3000/meerk40t/extra/pathoptimize.py` & `meerk40t-0.8.4000/meerk40t/extra/pathoptimize.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/extra/potrace.py` & `meerk40t-0.8.4000/meerk40t/extra/potrace.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/extra/updater.py` & `meerk40t-0.8.4000/meerk40t/extra/updater.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/extra/vectrace.py` & `meerk40t-0.8.4000/meerk40t/extra/vectrace.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/extra/winsleep.py` & `meerk40t-0.8.4000/meerk40t/extra/winsleep.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/fill/fills.py` & `meerk40t-0.8.4000/meerk40t/fill/fills.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/fill/patternfill.py` & `meerk40t-0.8.4000/meerk40t/fill/patternfill.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/fill/patterns.py` & `meerk40t-0.8.4000/meerk40t/fill/patterns.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/grbl/control.py` & `meerk40t-0.8.4000/meerk40t/grbl/control.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,38 +1,39 @@
 """
 Grbl control. This code governs the interplay between the driver and the emulator.
 """
 import threading
 
 
 def greet():
-    yield "Grbl 1.1f ['$' for help]\r"
-    yield "[MSG:’$H’|’$X’ to unlock]"
+    yield "Grbl 1.1f ['$' for help]\r\n"
+    yield "[MSG:’$H’|’$X’ to unlock]\r\n"
 
 
 class GRBLControl:
     def __init__(self, root):
         self.root = root
         self.emulator = None
         self._thread = None
         self._lock = threading.Condition()
         self._shutdown = False
         self._queue = []
 
     def thread_execute(self):
         while not self._shutdown:
-            while self._queue:
+            if self._queue:
                 q = self._queue.pop(0)
                 self.emulator.write(q)
-            with self._lock:
-                self._lock.wait()
+            else:
+                with self._lock:
+                    self._lock.wait()
 
     def add_queue(self, data):
-        self._queue.append(data)
         with self._lock:
+            self._queue.append(data)
             self._lock.notify()
 
     def start(self, port=23, verbose=False):
         root = self.root
         self._thread = root.threaded(
             self.thread_execute,
             thread_name=f"grblcontrol-sender",
```

### Comparing `meerk40t-0.8.3000/meerk40t/grbl/controller.py` & `meerk40t-0.8.4000/meerk40t/grbl/controller.py`

 * *Files 6% similar despite different names*

```diff
@@ -3,46 +3,166 @@
 
 Tasked with sending data to the different connection.
 """
 
 import threading
 import time
 
-from .mock_connection import MockConnection
-from .serial_connection import SerialConnection
+from meerk40t.kernel import signal_listener
+
+
+def grbl_error_code(code):
+    long = ""
+    short = f"Error #{code}"
+    if code == 1:
+        long = "GCode Command letter was not found."
+    elif code == 2:
+        long = "GCode Command value invalid or missing."
+    elif code == 3:
+        long = "Grbl '$' not recognized or supported."
+    elif code == 4:
+        long = "Negative value for an expected positive value."
+    elif code == 5:
+        long = "Homing fail. Homing not enabled in settings."
+    elif code == 6:
+        long = "Min step pulse must be greater than 3usec."
+    elif code == 7:
+        long = "EEPROM read failed. Default values used."
+    elif code == 8:
+        long = "Grbl '$' command Only valid when Idle."
+    elif code == 9:
+        long = "GCode commands invalid in alarm or jog state."
+    elif code == 10:
+        long = "Soft limits require homing to be enabled."
+    elif code == 11:
+        long = "Max characters per line exceeded. Ignored."
+    elif code == 12:
+        long = "Grbl '$' setting exceeds the maximum step rate."
+    elif code == 13:
+        long = "Safety door opened and door state initiated."
+    elif code == 14:
+        long = "Build info or start-up line > EEPROM line length"
+    elif code == 15:
+        long = "Jog target exceeds machine travel, ignored."
+    elif code == 16:
+        long = "Jog Cmd missing '=' or has prohibited GCode."
+    elif code == 17:
+        long = "Laser mode requires PWM output."
+    elif code == 20:
+        long = "Unsupported or invalid GCode command."
+    elif code == 21:
+        long = "> 1 GCode command in a modal group in block."
+    elif code == 22:
+        long = "Feed rate has not yet been set or is undefined."
+    elif code == 23:
+        long = "GCode command requires an integer value."
+    elif code == 24:
+        long = "> 1 GCode command using axis words found."
+    elif code == 25:
+        long = "Repeated GCode word found in block."
+    elif code == 26:
+        long = "No axis words found in command block."
+    elif code == 27:
+        long = "Line number value is invalid."
+    elif code == 28:
+        long = "GCode Cmd missing a required value word."
+    elif code == 29:
+        long = "G59.x WCS are not supported."
+    elif code == 30:
+        long = "G53 only valid with G0 and G1 motion modes."
+    elif code == 31:
+        long = "Unneeded Axis words found in block."
+    elif code == 32:
+        long = "G2/G3 arcs need >= 1 in-plane axis word."
+    elif code == 33:
+        long = "Motion command target is invalid."
+    elif code == 34:
+        long = "Arc radius value is invalid."
+    elif code == 35:
+        long = "G2/G3 arcs need >= 1 in-plane offset word."
+    elif code == 36:
+        long = "Unused value words found in block."
+    elif code == 37:
+        long = "G43.1 offset not assigned to tool length axis."
+    elif code == 38:
+        long = "Tool number greater than max value."
+    else:
+        long = f"Unrecodgnised error code #{code}"
+    return short, long
+
+
+def grbl_alarm_message(code):
+    if code == 1:
+        short = "Hard limit"
+        long = (
+            "Hard limit has been triggered."
+            + " Machine position is likely lost due to sudden halt."
+            + " Re-homing is highly recommended."
+        )
+    elif code == 2:
+        short = "Soft limit"
+        long = (
+            "Soft limit alarm. G-code motion target exceeds machine travel."
+            + " Machine position retained. Alarm may be safely unlocked."
+        )
+    elif code == 3:
+        short = "Abort during cycle"
+        long = (
+            "Reset while in motion. Machine position is likely lost due to sudden halt."
+            + " Re-homing is highly recommended. May be due to issuing g-code"
+            + " commands that exceed the limit of the machine."
+        )
+    elif code == 4:
+        short = "Probe fail"
+        long = (
+            "Probe fail. Probe is not in the expected initial state before"
+            + " starting probe cycle when G38.2 and G38.3 is not triggered"
+            + " and G38.4 and G38.5 is triggered."
+        )
+    elif code == 5:
+        short = "Probe fail"
+        long = (
+            "Probe fail. Probe did not contact the workpiece within the programmed"
+            + " travel for G38.2 and G38.4."
+        )
+    elif code == 6:
+        short = "Homing fail"
+        long = "Homing fail. The active homing cycle was reset."
+    elif code == 7:
+        short = "Homing fail"
+        long = "Homing fail. Safety door was opened during homing cycle."
+    elif code == 8:
+        short = "Homing fail"
+        long = (
+            "Homing fail. Pull off travel failed to clear limit switch."
+            + " Try increasing pull-off setting or check wiring."
+        )
+    elif code == 9:
+        short = "Homing fail"
+        long = (
+            "Homing fail. Could not find limit switch within search distances."
+            + " Try increasing max travel, decreasing pull-off distance,"
+            + " or check wiring."
+        )
+    else:
+        short = f"Alarm #{code}"
+        long = "Unknow alarm status"
+    long += "\nTry to clear the alarm status."
+    return short, long
 
 
 class GrblController:
     def __init__(self, context):
         self.service = context
-        self.serial_port = self.service.serial_port
-        self.baud_rate = self.service.baud_rate
 
-        self.channel = self.service.channel("grbl_state", buffer_size=20)
-        self.send = self.service.channel(f"send-{self.serial_port.lower()}", pure=True)
-        self.recv = self.service.channel(f"recv-{self.serial_port.lower()}", pure=True)
-        if not self.service.mock:
-            self.connection = SerialConnection(self.service)
-        else:
-            self.connection = MockConnection(self.service)
-        self.driver = self.service.driver
-        self.sending_thread = None
+        self.connection = None
+        self._connection_validated = False
+        self.update_connection()
 
-        self._lock = threading.Condition()
-        self._sending_queue = []
-        self._realtime_queue = []
-        # buffer for feedback...
-        self._assembled_response = []
-
-        self.commands_in_device_buffer = []
-        self.buffered_characters = 0
-        self.device_buffer_size = self.service.planning_buffer_size
-        self.old_x = 0
-        self.old_y = 0
-        self._buffer_fail = 0
+        self.driver = self.service.driver
         self.grbl_settings = {
             0: 10,  # step pulse microseconds
             1: 25,  # step idle delay
             2: 0,  # step pulse invert
             3: 0,  # step direction invert
             4: 0,  # invert step enable pin, boolean
             5: 0,  # invert limit pins, boolean
@@ -72,423 +192,385 @@
             121: 10.000,  # Y-axis acceleration, mm/s^2
             122: 10.000,  # Z-axis acceleration, mm/s^2
             130: 200.000,  # X-axis max travel mm.
             131: 200.000,  # Y-axis max travel mm
             132: 200.000,  # Z-axis max travel mm.
         }
 
+        # Channels.
+        self.grbl_events = self.service.channel("grbl_state", buffer_size=20)
+        self.grbl_send = self.service.channel(
+            f"send-{self.service.location()}", pure=True
+        )
+        self.grbl_recv = self.service.channel(
+            f"recv-{self.service.location()}", pure=True
+        )
+
+        # Sending variables.
+        self._sending_thread = None
+        self._recving_thread = None
+
+        self._forward_lock = threading.Lock()
+        self._sending_lock = threading.Lock()
+        self._realtime_lock = threading.Lock()
+        self._loop_cond = threading.Condition()
+        self._sending_queue = []
+        self._realtime_queue = []
+        # buffer for feedback...
+        self._assembled_response = []
+        self._forward_buffer = bytearray()
+        self._device_buffer_size = self.service.planning_buffer_size
+        self._buffer_fail = 0
+
+        self._paused = False
+
+    def __repr__(self):
+        return f"GRBLController('{self.service.location()}')"
+
+    def __len__(self):
+        return len(self._sending_queue) + len(self._realtime_queue)
+
+    @property
+    def _length_of_next_line(self):
+        """
+        Lookahead and provide length of the next line.
+        @return:
+        """
+        if not self._sending_queue:
+            return 0
+        return len(self._sending_queue[0])
+
+    @property
+    def _index_of_forward_line(self):
+        try:
+            r = self._forward_buffer.index(b"\r")
+        except ValueError:
+            r = -1
+        try:
+            n = self._forward_buffer.index(b"\n")
+        except ValueError:
+            n = -1
+
+        if n != -1:
+            return min(n, r) if r != -1 else n
+        else:
+            return r
+
+    @signal_listener("update_interface")
+    def update_connection(self, origin=None, *args):
+        if self.service.permit_serial and self.service.interface == "serial":
+            try:
+                from .serial_connection import SerialConnection
+
+                self.connection = SerialConnection(self.service)
+            except ImportError:
+                pass
+        elif self.service.permit_tcp and self.service.interface == "tcp":
+            from meerk40t.grbl.tcp_connection import TCPOutput
+
+            self.connection = TCPOutput(self.service)
+        else:
+            # Mock
+            from .mock_connection import MockConnection
+
+            self.connection = MockConnection(self.service)
+
     def open(self):
         """
         Opens the connection calling connection.connect.
 
         Reads the first line this should be GRBL version and information.
         @return:
         """
         if self.connection.connected:
             return
         self.connection.connect()
         if not self.connection.connected:
-            self.channel("Could not connect.")
+            self.grbl_events("Could not connect.")
             return
-        self.channel("Connecting to GRBL...")
-        t = time.time()
-        while True:
-            response = self.connection.read()
-            if not response:
-                if (time.time() - t) > 5.0:
-                    # 5 second timeout.
-                    return
-                continue
-            self.channel(response)
-            self.recv(response)
-            if "grbl" in response.lower():
-                self.channel("GRBL Connection Established.")
-                return
-            if "marlin" in response.lower():
-                self.channel("Marlin Connection Established.")
-                return
+        self.grbl_events("Connecting to GRBL...")
 
     def close(self):
         """
         Close the GRBL connection.
 
         @return:
         """
-        if self.connection.connected:
-            self.connection.disconnect()
+        if not self.connection.connected:
+            return
+        self.connection.disconnect()
+        self._connection_validated = False
+        self.grbl_events("Disconnecting from GRBL...")
 
     def write(self, data):
         """
         Write data to the sending queue.
 
         @param data:
         @return:
         """
         self.start()
         self.service.signal("serial;write", data)
-        with self._lock:
+        with self._sending_lock:
             self._sending_queue.append(data)
-            self.service.signal(
-                "serial;buffer", len(self._sending_queue) + len(self._realtime_queue)
-            )
-            self._lock.notify()
+        self.service.signal(
+            "serial;buffer", len(self._sending_queue) + len(self._realtime_queue)
+        )
+        self._send_resume()
 
     def realtime(self, data):
         """
         Write data to the realtime queue.
 
         The realtime queue should preemt the regular dataqueue.
 
         @param data:
         @return:
         """
         self.start()
         self.service.signal("serial;write", data)
-        with self._lock:
+        with self._realtime_lock:
             self._realtime_queue.append(data)
-            if "\x18" in data:
+        if "\x18" in data:
+            with self._sending_lock:
                 self._sending_queue.clear()
-            self.service.signal(
-                "serial;buffer", len(self._sending_queue) + len(self._realtime_queue)
-            )
-            self._lock.notify()
+        self.service.signal(
+            "serial;buffer", len(self._sending_queue) + len(self._realtime_queue)
+        )
+        self._send_resume()
+
+    ####################
+    # Control GRBL Sender
+    ####################
 
     def start(self):
         """
         Starts the driver thread.
 
         @return:
         """
         self.open()
-        if self.sending_thread is None:
-            self.sending_thread = self.service.threaded(
+        if self._sending_thread is None:
+            self._sending_thread = self.service.threaded(
                 self._sending,
-                thread_name=f"sender-{self.serial_port.lower()}",
+                thread_name=f"sender-{self.service.location()}",
                 result=self.stop,
                 daemon=True,
             )
+        if self._recving_thread is None:
+            self._recving_thread = self.service.threaded(
+                self._recving,
+                thread_name=f"recver-{self.service.location()}",
+                result=self._rstop,
+                daemon=True,
+            )
+
+    def _rstop(self, *args):
+        self._recving_thread = None
 
     def stop(self, *args):
         """
         Processes the stopping of the sending queue.
 
         @param args:
         @return:
         """
-        self.sending_thread = None
+        self._sending_thread = None
         self.close()
+        self._send_resume()
 
-    def grbl_error_code(self, code):
-        long = ""
-        short = f"Error #{code}"
-        if code == 1:
-            long = "GCode Command letter was not found."
-        elif code == 2:
-            long = "GCode Command value invalid or missing."
-        elif code == 3:
-            long = "Grbl '$' not recognized or supported."
-        elif code == 4:
-            long = "Negative value for an expected positive value."
-        elif code == 5:
-            long = "Homing fail. Homing not enabled in settings."
-        elif code == 6:
-            long = "Min step pulse must be greater than 3usec."
-        elif code == 7:
-            long = "EEPROM read failed. Default values used."
-        elif code == 8:
-            long = "Grbl '$' command Only valid when Idle."
-        elif code == 9:
-            long = "GCode commands invalid in alarm or jog state."
-        elif code == 10:
-            long = "Soft limits require homing to be enabled."
-        elif code == 11:
-            long = "Max characters per line exceeded. Ignored."
-        elif code == 12:
-            long = "Grbl '$' setting exceeds the maximum step rate."
-        elif code == 13:
-            long = "Safety door opened and door state initiated."
-        elif code == 14:
-            long = "Build info or start-up line > EEPROM line length"
-        elif code == 15:
-            long = "Jog target exceeds machine travel, ignored."
-        elif code == 16:
-            long = "Jog Cmd missing '=' or has prohibited GCode."
-        elif code == 17:
-            long = "Laser mode requires PWM output."
-        elif code == 20:
-            long = "Unsupported or invalid GCode command."
-        elif code == 21:
-            long = "> 1 GCode command in a modal group in block."
-        elif code == 22:
-            long = "Feed rate has not yet been set or is undefined."
-        elif code == 23:
-            long = "GCode command requires an integer value."
-        elif code == 24:
-            long = "> 1 GCode command using axis words found."
-        elif code == 25:
-            long = "Repeated GCode word found in block."
-        elif code == 26:
-            long = "No axis words found in command block."
-        elif code == 27:
-            long = "Line number value is invalid."
-        elif code == 28:
-            long = "GCode Cmd missing a required value word."
-        elif code == 29:
-            long = "G59.x WCS are not supported."
-        elif code == 30:
-            long = "G53 only valid with G0 and G1 motion modes."
-        elif code == 31:
-            long = "Unneeded Axis words found in block."
-        elif code == 32:
-            long = "G2/G3 arcs need >= 1 in-plane axis word."
-        elif code == 33:
-            long = "Motion command target is invalid."
-        elif code == 34:
-            long = "Arc radius value is invalid."
-        elif code == 35:
-            long = "G2/G3 arcs need >= 1 in-plane offset word."
-        elif code == 36:
-            long = "Unused value words found in block."
-        elif code == 37:
-            long = "G43.1 offset not assigned to tool length axis."
-        elif code == 38:
-            long = "Tool number greater than max value."
-        else:
-            long = f"Unrecodgnised error code #{code}"
-        return short, long
-
-    def grbl_alarm_message(self, code):
-        if code == 1:
-            short = "Hard limit"
-            long = (
-                "Hard limit has been triggered."
-                + " Machine position is likely lost due to sudden halt."
-                + " Re-homing is highly recommended."
-            )
-        elif code == 2:
-            short = "Soft limit"
-            long = (
-                "Soft limit alarm. G-code motion target exceeds machine travel."
-                + " Machine position retained. Alarm may be safely unlocked."
-            )
-        elif code == 3:
-            short = "Abort during cycle"
-            long = (
-                "Reset while in motion. Machine position is likely lost due to sudden halt."
-                + " Re-homing is highly recommended. May be due to issuing g-code"
-                + " commands that exceed the limit of the machine."
-            )
-        elif code == 4:
-            short = "Probe fail"
-            long = (
-                "Probe fail. Probe is not in the expected initial state before"
-                + " starting probe cycle when G38.2 and G38.3 is not triggered"
-                + " and G38.4 and G38.5 is triggered."
-            )
-        elif code == 5:
-            short = "Probe fail"
-            long = (
-                "Probe fail. Probe did not contact the workpiece within the programmed"
-                + " travel for G38.2 and G38.4."
-            )
-        elif code == 6:
-            short = "Homing fail"
-            long = "Homing fail. The active homing cycle was reset."
-        elif code == 7:
-            short = "Homing fail"
-            long = "Homing fail. Safety door was opened during homing cycle."
-        elif code == 8:
-            short = "Homing fail"
-            long = (
-                "Homing fail. Pull off travel failed to clear limit switch."
-                + " Try increasing pull-off setting or check wiring."
-            )
-        elif code == 9:
-            short = "Homing fail"
-            long = (
-                "Homing fail. Could not find limit switch within search distances."
-                + " Try increasing max travel, decreasing pull-off distance,"
-                + " or check wiring."
-            )
-        else:
-            short = f"Alarm #{code}"
-            long = "Unknow alarm status"
-        long += "\nTry to clear the alarm status."
-        return short, long
+    ####################
+    # GRBL SEND ROUTINES
+    ####################
 
-    def _recv_response(self):
+    def _send(self, line):
         """
-        Read and process response from grbl.
+        Write the line to the connection, announce it to the send channel, and add it to the forward buffer.
 
+        @param line:
         @return:
         """
-        # reading responses.
-        response = None
-        while not response:
-            response = self.connection.read()
-        self.service.signal("serial;response", response)
-        # print(f"Response: '{response}'")
-        if response == "ok":
-            try:
-                cmd_issued = self.commands_in_device_buffer.pop(0)
-                self.buffered_characters -= len(cmd_issued)
-                if cmd_issued[-1] == "\r":
-                    cmd_issued = cmd_issued[:-1]
-            except IndexError:
-                self.channel(f"Response: {response}, but this was unexpected")
-                self._assembled_response = []
-                raise ConnectionAbortedError
-            self.channel(f"Response: {response}")
-            self.recv(
-                f"{response} / {self.buffered_characters} / {len(self.commands_in_device_buffer)} -- {cmd_issued}"
-            )
-            self.service.signal("grbl;response", cmd_issued, self._assembled_response)
-            self._assembled_response = []
-            return True
-        elif response.startswith("echo:"):
-            self.service.channel("console")(response[5:])
-        elif response.startswith("ALARM"):
-            try:
-                error_num = int(response[6:])
-            except ValueError:
-                error_num = -1
-            short, long = self.grbl_alarm_message(error_num)
-            self.service.signal(
-                "warning", f"GRBL: Alarm #{error_num} {short}\n{long}", response, 4
-            )
-            self.recv(f"Alarm #{error_num} {short}\n{long}")
-            self.channel(f"Alarm #{error_num} {short}\n{long}")
-            self._assembled_response = []
-        elif response.startswith("error"):
-            try:
-                error_num = int(response[6:])
-            except ValueError:
-                error_num = -1
-            short, long = self.grbl_error_code(error_num)
-            self.service.signal("grbl;error", f"GRBL: {short}\n{long}", response, 4)
-            self.recv(f"ERROR #{error_num} {short}\n{long}")
-            self.channel(f"ERROR #{error_num} {short}\n{long}")
-            self._assembled_response = []
-        else:
-            self.recv(f"{response}")
-            self.channel(f"Data: {response}")
-            self._assembled_response.append(response)
+        self.connection.write(line)
+        self.grbl_send(line)
+        with self._forward_lock:
+            self._forward_buffer += bytes(line, encoding="latin-1")
 
     def _sending_realtime(self):
         """
         Send one line of realtime queue.
 
         @return:
         """
-        line = None
-        with self._lock:
+        with self._realtime_lock:
             line = self._realtime_queue.pop(0)
+        if "!" in line:
+            self._paused = True
+        if "~" in line:
+            self._paused = False
+        if "\x18" in line:
+            with self._forward_lock:
+                self._forward_buffer.clear()
         if line is not None:
-            self.connection.write(line)
-            self.send(line)
-        # else:
-        #     print ("Was empty in sending_realtime")
+            self._send(line)
 
     def _sending_single_line(self):
         """
         Send one line of sending queue.
 
         @return:
         """
-        with self._lock:
+        with self._sending_lock:
             line = self._sending_queue.pop(0)
-            if line is not None:
-                self.commands_in_device_buffer.append(line)
-            #     print (f"Appended '{line[:10]}...', len={len(self.commands_in_device_buffer)}")
-            # else:
-            #     print ("Was empty in sending_single_line")
-
-        self.connection.write(line)
-        self.send(line)
-        self.buffered_characters += len(line)
+        if line:
+            self._send(line)
         self.service.signal("serial;buffer", len(self._sending_queue))
         return True
 
-    @property
-    def _length_of_next_line(self):
+    def _send_halt(self):
         """
-        Lookahead and provide length of the next line.
+        This is called internally in the _sending command.
         @return:
         """
-        if not self._sending_queue:
-            return 0
-        return len(self._sending_queue[0])
+        with self._loop_cond:
+            self.service.signal("pipe;running", False)
+            self._loop_cond.wait()
+            self.service.signal("pipe;running", True)
 
-    def _sending_buffered(self):
+    def _send_resume(self):
         """
-        Buffered connection sends as much data as fits in the planning buffer. Then it waits
-        and for each ok, it reduces the expected size of the plannning buffer and sends the next
-        line of data, only when there's enough room to hold that data.
+        Other threads are expected to call this routine to permit _sending to resume.
 
         @return:
         """
-        while self._realtime_queue:
-            self._sending_realtime()
-        # print (
-        #     f"Send Queue: {len(self._sending_queue)}\n" +
-        #     f"commands_in_device: {len(self.commands_in_device_buffer)}\n"
-        #     f"buffered={self.buffered_characters}\n" +
-        #     f"next: {self._length_of_next_line}"
-        # )
-        if self._sending_queue and self.device_buffer_size > (
-            self.buffered_characters + self._length_of_next_line
-        ):
-            # There is a line and there is enough buffer to send this line.
-            self._sending_single_line()
-            self._buffer_fail = 0
-        else:
-            if self.commands_in_device_buffer:
-                self._recv_response()
-            else:
-                self._buffer_fail += 1
-                if self._buffer_fail > 10:
-                    pass
-                    # we should do something like raising an error... for tat to decide
+        with self._loop_cond:
+            self._loop_cond.notify()
 
-    def _sending_sync(self):
+    def _sending(self):
         """
-        Synchronous mode sends 1 line and waits to receive 1 "ok" from the laser
+        Generic sender, delegate the function according to the desired mode.
 
+        This function is only run with the self.sending_thread
         @return:
-        """
-        while self._realtime_queue:
-            self._sending_realtime()
 
-        # Send 1, recv 1.
-        if self._sending_queue:
+        """
+        self.service.signal("pipe;running", True)
+        while self.connection.connected:
+            if self._realtime_queue:
+                # Send realtime data.
+                self._sending_realtime()
+                continue
+            if self._paused or not self._connection_validated:
+                # We are paused. We do not send anything other than realtime commands.
+                time.sleep(0.05)
+                continue
+            if not self._sending_queue:
+                # There is nothing to write/realtime
+                self._send_halt()
+                continue
+            buffer = len(self._forward_buffer)
+            if self.service.buffer_mode == "sync":
+                if buffer:
+                    # Any buffer is too much buffer. Halt.
+                    self._send_halt()
+                    continue
+            else:
+                # Buffered
+                if self._device_buffer_size <= buffer + self._length_of_next_line:
+                    # Stop sending when buffer is the size of permitted buffer size.
+                    self._send_halt()
+                    continue
+            # Go for send_line
             self._sending_single_line()
-            self._recv_response()
+        self.service.signal("pipe;running", False)
 
-    def _sending(self):
+    ####################
+    # GRBL RECV ROUTINES
+    ####################
+
+    def get_forward_command(self):
         """
-        Generic sender, delegate the function according to the desired mode.
+        Gets the forward command from the front of the forward buffer. This was the oldest command that the controller
+        has not processed.
+
+        @return:
+        """
+        q = self._index_of_forward_line
+        if q == -1:
+            raise ValueError("No forward command exists.")
+        with self._forward_lock:
+            cmd_issued = self._forward_buffer[: q + 1]
+            self._forward_buffer = self._forward_buffer[q + 1 :]
+        return cmd_issued
+
+    def _recving(self):
+        """
+        Generic recver, delegate the function according to the desired mode.
+
+        Read and process response from grbl.
+
+        This function is only run with the self.recver_thread
         @return:
         """
         while self.connection.connected:
-            self.service.signal("pipe;running", True)
-            if (
-                not self._sending_queue
-                and not self._realtime_queue
-                and not self.commands_in_device_buffer
-            ):
-                # There is nothing to write, or read
-                self.service.signal("pipe;running", False)
-                with self._lock:
-                    # We wait until new data is put in the buffer.
-                    self._lock.wait()
-                self.service.signal("pipe;running", True)
-            if self.service.buffer_mode == "sync":
-                self._sending_sync()
+            # reading responses.
+            response = None
+            while not response:
+                response = self.connection.read()
+                if not response:
+                    time.sleep(0.01)
+            self.service.signal("serial;response", response)
+            if response == "ok":
+                try:
+                    cmd_issued = self.get_forward_command()
+                    cmd_issued = cmd_issued.decode(encoding="latin-1")
+                except ValueError as e:
+                    # We got an ok. But, had not sent anything.
+                    self.grbl_events(f"Response: {response}, but this was unexpected")
+                    self._assembled_response = []
+                    self._forward_buffer.clear()
+                    continue
+                    # raise ConnectionAbortedError from e
+
+                self.grbl_events(f"Response: {response}")
+                self.grbl_recv(
+                    f"{response} / {len(self._forward_buffer)} -- {cmd_issued}"
+                )
+                self.service.signal(
+                    "grbl;response", cmd_issued, self._assembled_response
+                )
+                self._assembled_response = []
+                self._send_resume()
+                continue
+            elif response.startswith("echo:"):
+                # Echo asks that this information be displayed.
+                self.service.channel("console")(response[5:])
+            elif response.startswith("ALARM"):
+                try:
+                    error_num = int(response[6:])
+                except ValueError:
+                    error_num = -1
+                short, long = grbl_alarm_message(error_num)
+                self.service.signal(
+                    "warning", f"GRBL: Alarm #{error_num} {short}\n{long}", response, 4
+                )
+                self.grbl_recv(f"Alarm #{error_num} {short}\n{long}")
+                self.grbl_events(f"Alarm #{error_num} {short}\n{long}")
+                self._assembled_response = []
+            elif response.startswith("error"):
+                try:
+                    error_num = int(response[6:])
+                except ValueError:
+                    error_num = -1
+                short, long = grbl_error_code(error_num)
+                self.service.signal("grbl;error", f"GRBL: {short}\n{long}", response, 4)
+                self.grbl_recv(f"ERROR #{error_num} {short}\n{long}")
+                self.grbl_events(f"ERROR #{error_num} {short}\n{long}")
+                self._assembled_response = []
+                self._send_resume()
+            elif response.startswith("Grbl"):
+                self.grbl_events("Connection Confirmed.")
+                self._connection_validated = True
             else:
-                self._sending_buffered()
+                self.grbl_recv(f"{response}")
+                self.grbl_events(f"Data: {response}")
+                self._assembled_response.append(response)
         self.service.signal("pipe;running", False)
-
-    def __repr__(self):
-        return f"GRBLSerial('{self.service.serial_port}:{str(self.service.baud_rate)}')"
-
-    def __len__(self):
-        return len(self._sending_queue) + len(self._realtime_queue)
```

### Comparing `meerk40t-0.8.3000/meerk40t/grbl/device.py` & `meerk40t-0.8.4000/meerk40t/grbl/device.py`

 * *Files 3% similar despite different names*

```diff
@@ -2,16 +2,14 @@
 GRBL Device
 
 Defines the interactions between the device service and the meerk40t's viewport.
 Registers relevant commands and options.
 """
 from time import sleep
 
-import serial.tools.list_ports
-
 from meerk40t.kernel import CommandSyntaxError, Service
 
 from ..core.laserjob import LaserJob
 from ..core.spoolers import Spooler
 from ..core.units import UNITS_PER_MIL, Length, ViewPort
 from .controller import GrblController
 from .driver import GRBLDriver
@@ -19,14 +17,17 @@
 
 class GRBLDevice(Service, ViewPort):
     """
     GRBLDevice is driver for the Gcode Controllers
     """
 
     def __init__(self, kernel, path, *args, choices=None, **kwargs):
+        self.permit_tcp = True
+        self.permit_serial = True
+
         Service.__init__(self, kernel, path)
         self.name = "GRBLDevice"
         self.extension = "gcode"
         if choices is not None:
             for c in choices:
                 attr = c.get("attr")
                 default = c.get("default")
@@ -239,33 +240,29 @@
 
         def update(choice_dict):
             """
             Sets the choices and display of the serial_port values dynamically
             @param choice_dict:
             @return:
             """
-            ports = serial.tools.list_ports.comports()
-            serial_interface = [x.device for x in ports]
-            serial_interface_display = [str(x) for x in ports]
+            try:
+                import serial.tools.list_ports
 
-            choice_dict["choices"] = serial_interface
-            choice_dict["display"] = serial_interface_display
+                ports = serial.tools.list_ports.comports()
+                serial_interface = [x.device for x in ports]
+                serial_interface_display = [str(x) for x in ports]
+
+                choice_dict["choices"] = serial_interface
+                choice_dict["display"] = serial_interface_display
+            except ImportError:
+                choice_dict["choices"] = ["UNCONFIGURED"]
+                choice_dict["display"] = ["pyserial-not-installed"]
 
         choices = [
             {
-                "attr": "label",
-                "object": self,
-                "default": "grbl",
-                "type": str,
-                "label": _("Label"),
-                "tip": _("What is this device called."),
-                "width": 250,
-                "signals": "device;renamed",
-            },
-            {
                 "attr": "serial_port",
                 "object": self,
                 "default": "UNCONFIGURED",
                 "type": str,
                 "style": "option",
                 "label": "",
                 "tip": _("What serial interface does this device connect to?"),
@@ -279,14 +276,67 @@
                 "default": 115200,
                 "type": int,
                 "label": _("Baud Rate"),
                 "tip": _("Baud Rate of the device"),
                 "section": "_10_Serial Interface",
                 "subsection": "_00_",
             },
+        ]
+        if self.permit_serial:
+            self.register_choices("serial", choices)
+
+        choices = [
+            {
+                "attr": "address",
+                "object": self,
+                "default": "localhost",
+                "type": str,
+                # "style": "address",
+                "tip": _("What serial interface does this device connect to?"),
+            },
+            {
+                "attr": "port",
+                "object": self,
+                "default": 23,
+                "type": int,
+                "label": _("Port"),
+                "tip": _("TCP Port of the GRBL device"),
+            },
+        ]
+        if self.permit_tcp:
+            self.register_choices("tcp", choices)
+
+        choices = [
+            {
+                "attr": "interface",
+                "object": self,
+                "default": "serial",
+                "style": "combosmall",
+                "choices": ["serial", "tcp", "mock"],
+                "display": [_("Serial"), _("TCP-Network"), _("mock")],
+                "type": str,
+                "label": _("Interface Type"),
+                "tip": _("Select the interface type for the grbl device"),
+                "section": "_20_Protocol",
+                "signals": "update_interface",
+            },
+        ]
+        self.register_choices("interface", choices)
+
+        choices = [
+            {
+                "attr": "label",
+                "object": self,
+                "default": "grbl",
+                "type": str,
+                "label": _("Label"),
+                "tip": _("What is this device called."),
+                "width": 250,
+                "signals": "device;renamed",
+            },
             {
                 "attr": "buffer_mode",
                 "object": self,
                 "default": "buffered",
                 "type": str,
                 "style": "combo",
                 "choices": ["buffered", "sync"],
@@ -325,24 +375,37 @@
                 "label": _("Line Ending"),
                 "tip": _(
                     "CR for carriage return (\\r), LF for line feed(\\n), CRLF for both"
                 ),
                 "section": "_20_Protocol",
             },
             {
-                "attr": "mock",
+                "attr": "limit_buffer",
                 "object": self,
-                "default": False,
+                "default": True,
                 "type": bool,
-                "label": _("Run mock-usb backend"),
+                "label": _("Limit the controller buffer size"),
+                "tip": _("Enables the controller buffer limit."),
+                "section": "_30_Controller Buffer",
+            },
+            {
+                "attr": "max_buffer",
+                "object": self,
+                "default": 200,
+                "trailer": _("lines"),
+                "type": int,
+                "label": _("Controller Buffer"),
                 "tip": _(
-                    "This starts connects to fake software laser rather than real one for debugging."
+                    "This is the limit of the controller buffer size. Prevents full writing to the controller."
                 ),
+                "conditional": (self, "limit_buffer"),
+                "section": "_30_Controller Buffer",
             },
         ]
+
         self.register_choices("grbl-connection", choices)
 
         choices = [
             {
                 "attr": "use_m3",
                 "object": self,
                 "default": False,
@@ -389,62 +452,51 @@
                 ),
                 "conditional": (self, "use_red_dot"),
             },
         ]
         self.register_choices("grbl-global", choices)
 
         self.driver = GRBLDriver(self)
-
         self.controller = GrblController(self)
-        self.channel("grbl").watch(self.controller.write)
-        self.channel("grbl-realtime").watch(self.controller.realtime)
+        self.driver.out_pipe = self.controller.write
+        self.driver.out_real = self.controller.realtime
 
         self.spooler = Spooler(self, driver=self.driver)
+
+        self.add_service_delegate(self.controller)
         self.add_service_delegate(self.spooler)
         self.add_service_delegate(self.driver)
 
         self.viewbuffer = ""
 
         _ = self.kernel.translation
 
-        @self.console_argument("com")
-        @self.console_option("baud", "b")
-        @self.console_command(
-            "serial",
-            help=_("link the serial connection"),
-            input_type=None,
-        )
-        def serial_connection(
-            command,
-            channel,
-            _,
-            data=None,
-            com=None,
-            baud=115200,
-            remainder=None,
-            **kwgs,
-        ):
-            if com is None:
-                import serial.tools.list_ports
-
-                ports = serial.tools.list_ports.comports()
-
-                channel("Available COM ports")
-                for x in ports:
-                    channel(str(x))
+        if self.permit_serial:
+            self._register_console_serial()
 
         @self.console_command(
             "gcode",
             help=_("Send raw gcode to the device"),
             input_type=None,
         )
         def gcode(command, channel, _, data=None, remainder=None, **kwgs):
             if remainder is not None:
                 channel(remainder)
-                self.channel("grbl")(remainder + "\r")
+                self.driver(remainder + self.driver.line_end)  # , real=True)
+                # self.channel("grbl/send")(remainder + self.driver.line_end)
+
+        @self.console_command(
+            "gcode_realtime",
+            help=_("Send raw gcode to the device (via realtime channel)"),
+            input_type=None,
+        )
+        def gcode_realtime(command, channel, _, data=None, remainder=None, **kwgs):
+            if remainder is not None:
+                channel(remainder)
+                self.driver(remainder + self.driver.line_end, real=True)
 
         @self.console_command(
             "soft_reset",
             help=_("Send realtime soft reset gcode to the device"),
             input_type=None,
         )
         def soft_reset(command, channel, _, data=None, remainder=None, **kwgs):
@@ -493,17 +545,15 @@
         @self.console_command(
             "viewport_update",
             hidden=True,
             help=_("Update grbl codes for movement"),
         )
         def codes_update(**kwargs):
             self.origin_x = 1.0 if self.home_right else 0.0
-            self.show_origin_x = self.origin_x
             self.origin_y = 1.0 if self.home_bottom else 0.0
-            self.show_origin_y = self.origin_y
             self.realize()
 
         @self.console_option(
             "strength", "s", type=int, help="Set the dot laser strength."
         )
         @self.console_argument("off", type=str)
         @self.console_command(
@@ -595,15 +645,16 @@
             if filename is None:
                 raise CommandSyntaxError
             try:
                 with open(filename, "w") as f:
                     # f.write(b"(MeerK40t)\n")
                     driver = GRBLDriver(self)
                     job = LaserJob(filename, list(data.plan), driver=driver)
-                    driver.grbl = f.write
+                    driver.out_pipe = f.write
+                    driver.out_real = f.write
                     job.execute()
 
             except (PermissionError, OSError):
                 channel(_("Could not save: {filename}").format(filename=filename))
 
         @self.console_command(
             "grblinterpreter", help=_("activate the grbl interpreter.")
@@ -614,14 +665,54 @@
                 channel(
                     _("Grbl Interpreter attached to {device}").format(device=str(self))
                 )
             except KeyError:
                 channel(_("Interpreter cannot be attached to any device."))
             return
 
+    def _register_console_serial(self):
+        _ = self.kernel.translation
+
+        @self.console_argument("com")
+        @self.console_option("baud", "b")
+        @self.console_command(
+            "serial",
+            help=_("link the serial connection"),
+            input_type=None,
+        )
+        def serial_connection(
+            command,
+            channel,
+            _,
+            data=None,
+            com=None,
+            baud=115200,
+            remainder=None,
+            **kwgs,
+        ):
+            if com is None:
+                import serial.tools.list_ports
+
+                ports = serial.tools.list_ports.comports()
+
+                channel("Available COM ports")
+                for x in ports:
+                    channel(str(x))
+
+    def location(self):
+        if self.permit_tcp and self.interface == "tcp":
+            return f"{self.address}:{self.port}"
+        elif self.permit_serial and self.interface == "serial":
+            return f"{self.serial_port.lower()}:{self.baud_rate}"
+        else:
+            return "mock"
+
+    def service_attach(self, *args, **kwargs):
+        self.realize()
+
     @property
     def current(self):
         """
         @return: the location in scene units for the current known x value.
         """
         return self.device_to_scene_position(
             self.driver.native_x,
@@ -637,7 +728,8 @@
 
     def realize(self, origin=None):
         self.width = self.bedwidth
         self.height = self.bedheight
         self.origin_x = 1.0 if self.home_right else 0.0
         self.origin_y = 1.0 if self.home_bottom else 0.0
         super().realize()
+        self.space.update_bounds(0, 0, self.width, self.height)
```

### Comparing `meerk40t-0.8.3000/meerk40t/grbl/driver.py` & `meerk40t-0.8.4000/meerk40t/grbl/driver.py`

 * *Files 4% similar despite different names*

```diff
@@ -58,26 +58,32 @@
         self._g94_feedrate()  # G93 DEFAULT, mm mode
 
         self.unit_scale = None
         self.units = None
         self._g21_units_mm()
         self._g91_absolute()
 
-        self.grbl = self.service.channel("grbl", pure=True)
-        self.grbl_realtime = self.service.channel("grbl-realtime", pure=True)
+        self.out_pipe = None
+        self.out_real = None
 
         self.move_mode = 0
         self.reply = None
         self.elements = None
         self.power_scale = 1.0
         self.speed_scale = 1.0
 
     def __repr__(self):
         return f"GRBLDriver({self.name})"
 
+    def __call__(self, e, real=False):
+        if real:
+            self.out_real(e)
+        else:
+            self.out_pipe(e)
+
     @signal_listener("line_end")
     def _set_line_end(self, origin=None, *args):
         line_end = self.service.setting(str, "line_end", "CR")
         line_end = line_end.replace(" ", "")
         line_end = line_end.replace("CR", "\r")
         line_end = line_end.replace("LF", "\n")
         self.line_end = line_end
@@ -86,14 +92,23 @@
         """
         Required.
 
         Spooler check. to see if the work cycle should be held.
 
         @return: hold?
         """
+        if priority > 0:
+            # Don't hold realtime work.
+            return False
+
+        if (
+            self.service.limit_buffer
+            and len(self.service.controller) > self.service.max_buffer
+        ):
+            return True
         return priority <= 0 and (self.paused or self.hold)
 
     def get(self, key, default=None):
         """
         Required.
 
         @param key: Key to get.
@@ -121,15 +136,15 @@
 
     def status(self):
         """
         Wants a status report of what the driver is doing.
         @return:
         """
         # TODO: To calculate status correctly we need to actually have access to the response
-        self.grbl_realtime("?")
+        self.out_real("?")
         return (self.native_x, self.native_y), "idle", "unknown"
 
     def move_ori(self, x, y):
         """
         Requests laser move to origin offset position x,y in physical units
 
         @param x:
@@ -210,15 +225,15 @@
     def laser_off(self, *values):
         """
         Turn laser off in place.
 
         @param values:
         @return:
         """
-        self.grbl(f"M5{self.line_end}")
+        self(f"M5{self.line_end}")
 
     def laser_on(self, power=None, speed=None, *values):
         """
         Turn laser on in place.
 
         @param values:
         @return:
@@ -230,15 +245,15 @@
             # We already established power, so no need for power_dirty
             self.power = power
             self.power_dirty = False
         if speed is not None:
             sspeed = f"G1 F{speed}{self.line_end}"
             self.speed = speed
             self.speed_dirty = False
-        self.grbl(f"M3{spower}{self.line_end}{sspeed}")
+        self(f"M3{spower}{self.line_end}{sspeed}")
 
     def plot(self, plot):
         """
         Gives the driver a bit of cutcode that should be plotted.
         @param plot:
         @return:
         """
@@ -250,18 +265,20 @@
 
         @return:
         """
         self._g91_absolute()
         self._g94_feedrate()
         self._clean()
         if self.service.use_m3:
-            self.grbl(f"M3{self.line_end}")
+            self(f"M3{self.line_end}")
         else:
-            self.grbl(f"M4{self.line_end}")
+            self(f"M4{self.line_end}")
         for q in self.queue:
+            while self.hold_work(0):
+                time.sleep(0.05)
             x = self.native_x
             y = self.native_y
             start_x, start_y = q.start
             if x != start_x or y != start_y:
                 self.on_value = 0
                 self.power_dirty = True
                 self.move_mode = 0
@@ -317,15 +334,15 @@
             elif isinstance(q, (InputCut, OutputCut)):
                 # GRBL has no core GPIO functionality
                 pass
             else:
                 #  Rastercut, PlotCut
                 self.plot_planner.push(q)
                 for x, y, on in self.plot_planner.gen():
-                    while self.paused:
+                    while self.hold_work(0):
                         time.sleep(0.05)
                     if on > 1:
                         # Special Command.
                         if isinstance(on, float):
                             on = int(on)
                         if on & PLOT_FINISH:  # Plot planner is ending.
                             break
@@ -352,16 +369,16 @@
                         self.move_mode = 1
                     if self.on_value != on:
                         self.power_dirty = True
                     self.on_value = on
                     self._move(x, y)
         self.queue.clear()
 
-        self.grbl(f"G1 S0{self.line_end}")
-        self.grbl(f"M5{self.line_end}")
+        self(f"G1 S0{self.line_end}")
+        self(f"M5{self.line_end}")
         self.power_dirty = True
         self.speed_dirty = True
         self.absolute_dirty = True
         self.feedrate_dirty = True
         self.units_dirty = True
         return False
 
@@ -376,40 +393,46 @@
         if data_type != "grbl":
             return
         for line in data:
             grbl = bytes.decode(line, "utf-8")
             for split in grbl.split("\r"):
                 g = split.strip()
                 if g:
-                    self.grbl(f"{g}{self.line_end}")
+                    self(f"{g}{self.line_end}")
 
     def physical_home(self):
         """
         Home the laser physically (ie run into endstops).
 
         @return:
         """
+        old_current = self.service.current
         self.native_x = 0
         self.native_y = 0
         if self.service.has_endstops:
-            self.grbl(f"$H{self.line_end}")
+            self(f"$H{self.line_end}")
         else:
-            self.grbl(f"G28{self.line_end}")
+            self(f"G28{self.line_end}")
+        new_current = self.service.current
+        self.service.signal(
+            "driver;position",
+            (old_current[0], old_current[1], new_current[0], new_current[1]),
+        )
 
     def home(self):
         """
         Home the laser (ie goto defined origin)
 
         @return:
         """
         self.native_x = 0
         self.native_y = 0
         if self.service.rotary_active and self.service.rotary_supress_home:
             return
-        self.grbl(f"G28{self.line_end}")
+        self(f"G28{self.line_end}")
 
     def rapid_mode(self, *values):
         """
         Rapid mode sets the laser to rapid state. This is usually moving the laser around without it executing a large
         batch of commands.
 
         @param values:
@@ -419,23 +442,23 @@
     def finished_mode(self, *values):
         """
         Finished mode is after a large batch of jobs is done.
 
         @param values:
         @return:
         """
-        self.grbl(f"M5{self.line_end}")
+        self(f"M5{self.line_end}")
 
     def program_mode(self, *values):
         """
         Program mode is the state lasers often use to send a large batch of commands.
         @param values:
         @return:
         """
-        self.grbl(f"M3{self.line_end}")
+        self(f"M3{self.line_end}")
 
     def raster_mode(self, *values):
         """
         Raster mode is a special form of program mode that suggests the batch of commands will be a raster operation
         many lasers have specialty values
         @param values:
         @return:
@@ -458,15 +481,15 @@
         called first this will attempt to stall the machine while performing no work. If the driver in question permits
         waits to be placed within code this should insert waits into the current job. Returning instantly rather than
         holding the processes.
 
         @param time_in_ms:
         @return:
         """
-        self.grbl(f"G04 S{time_in_ms / 1000.0}{self.line_end}")
+        self(f"G04 S{time_in_ms / 1000.0}{self.line_end}")
 
     def wait_finish(self, *values):
         """
         Wait finish should hold the calling thread until the current work has completed. Or otherwise prevent any data
         from being sent with returning True for the until that criteria is met.
 
         @param values:
@@ -515,55 +538,57 @@
         """
         Asks that the laser be paused.
 
         @param args:
         @return:
         """
         self.paused = True
-        self.grbl_realtime("!")
+        self(f"!{self.line_end}", real=True)
 
     def resume(self, *args):
         """
         Asks that the laser be resumed.
 
         To work this command should usually be put into the realtime work queue for the laser.
 
         @param args:
         @return:
         """
         self.paused = False
-        self.grbl_realtime("~")
+        self(f"~{self.line_end}", real=True)
 
     def reset(self, *args):
         """
         This command asks that this device be emergency stopped and reset. Usually that queue data from the spooler be
         deleted.
         Asks that the device resets, and clears all current work.
 
         @param args:
         @return:
         """
         self.service.spooler.clear_queue()
+        self.queue.clear()
         self.plot_planner.clear()
-        self.grbl_realtime("\x18")
+        self(f"\x18{self.line_end}", real=True)
         self.paused = False
 
     def clear_alarm(self):
         """
         GRBL clear alarm signal.
 
         @return:
         """
-        self.grbl_realtime("$X\n")
+        self(f"$X{self.line_end}", real=True)
 
     ####################
     # PROTECTED DRIVER CODE
     ####################
 
     def _move(self, x, y, absolute=False):
+        old_current = self.service.current
         if self._absolute:
             self.native_x = x
             self.native_y = y
         else:
             self.native_x += x
             self.native_y += y
         line = []
@@ -578,36 +603,41 @@
         if self.power_dirty:
             if self.power is not None:
                 line.append(f"S{self.power * self.on_value:.1f}")
             self.power_dirty = False
         if self.speed_dirty:
             line.append(f"F{self.feed_convert(self.speed):.1f}")
             self.speed_dirty = False
-        self.grbl(" ".join(line) + self.line_end)
+        self(" ".join(line) + self.line_end)
+        new_current = self.service.current
+        self.service.signal(
+            "driver;position",
+            (old_current[0], old_current[1], new_current[0], new_current[1]),
+        )
 
     def _clean(self):
         if self.absolute_dirty:
             if self._absolute:
-                self.grbl(f"G90{self.line_end}")
+                self(f"G90{self.line_end}")
             else:
-                self.grbl(f"G91{self.line_end}")
+                self(f"G91{self.line_end}")
         self.absolute_dirty = False
 
         if self.feedrate_dirty:
             if self.feed_mode == 94:
-                self.grbl(f"G94{self.line_end}")
+                self(f"G94{self.line_end}")
             else:
-                self.grbl(f"G93{self.line_end}")
+                self(f"G93{self.line_end}")
         self.feedrate_dirty = False
 
         if self.units_dirty:
             if self.units == 20:
-                self.grbl(f"G20{self.line_end}")
+                self(f"G20{self.line_end}")
             else:
-                self.grbl(f"G21{self.line_end}")
+                self(f"G21{self.line_end}")
         self.units_dirty = False
 
     def _g90_relative(self):
         if not self._absolute:
             return
         self._absolute = False
         self.absolute_dirty = True
@@ -659,37 +689,37 @@
         if 0 < factor < 100:
             self.power_scale = factor
         else:
             self.power_scale = 1.0
         # Grbl can only deal with factors between 10% and 200%
         ifactor = int(self.power_scale * 10 + 10)
         ifactor = min(20, max(1, ifactor))
-        self.grbl_realtime("\x99")
+        self("\x99", real=True)
         if ifactor < 10:
             for idx in range(10 - ifactor):
-                self.grbl_realtime("\x9A")
+                self("\x9A", real=True)
         elif ifactor > 10:
             for idx in range(ifactor - 10):
-                self.grbl_realtime("\x9B")
+                self("\x9B", real=True)
 
     def set_speed_scale(self, factor):
         if 0 < factor < 100:
             self.speed_scale = factor
         else:
             self.speed_scale = 1.0
         # Grbl can only deal with factors between 10% and 200%
         ifactor = int(self.speed_scale * 10 + 10)
         ifactor = min(20, max(1, ifactor))
-        self.grbl_realtime("\x90")
+        self("\x90", real=True)
         if ifactor < 10:
             for idx in range(10 - ifactor):
-                self.grbl_realtime("\x92")
+                self("\x92", real=True)
         elif ifactor > 10:
             for idx in range(ifactor - 10):
-                self.grbl_realtime("\x91")
+                self("\x91", real=True)
 
     @staticmethod
     def has_adjustable_power():
         return True
 
     @staticmethod
     def has_adjustable_speed():
```

### Comparing `meerk40t-0.8.3000/meerk40t/grbl/emulator.py` & `meerk40t-0.8.4000/meerk40t/grbl/emulator.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/grbl/gcodejob.py` & `meerk40t-0.8.4000/meerk40t/grbl/gcodejob.py`

 * *Files 2% similar despite different names*

```diff
@@ -199,18 +199,22 @@
         Execute calls each item in the list of items in order. This is intended to be called by the spooler thread. And
         hold the spooler while these items are executing.
         @return:
         """
         self._stopped = False
         if self.time_started is None:
             self.time_started = time.time()
-        with self.lock:
-            line = self.buffer.pop(0)
-        cmd = self._process_gcode(line)
-        self.reply_code(cmd)
+        try:
+            with self.lock:
+                line = self.buffer.pop(0)
+            cmd = self._process_gcode(line)
+            self.reply_code(cmd)
+        except IndexError:
+            # Could not pop, list is empty. Job is done.
+            pass
         if not self.buffer:
             # Buffer is empty now. Job is complete
             self.runtime += time.time() - self.time_started
             self._stopped = True
             return True  # All steps were executed.
         return False
```

### Comparing `meerk40t-0.8.3000/meerk40t/grbl/gui/grblconfiguration.py` & `meerk40t-0.8.4000/meerk40t/gui/propertypanels/groupproperties.py`

 * *Files 22% similar despite different names*

```diff
@@ -1,173 +1,217 @@
-import re
+import os
+import time
 
 import wx
 
-from meerk40t.device.gui.defaultactions import DefaultActionPanel
-from meerk40t.device.gui.formatterpanel import FormatterPanel
-from meerk40t.device.gui.warningpanel import WarningPanel
-from meerk40t.gui.choicepropertypanel import ChoicePropertyPanel
-from meerk40t.gui.icons import icons8_administrative_tools_50
-from meerk40t.gui.mwindow import MWindow
-from meerk40t.kernel import signal_listener
+from meerk40t.gui.wxutils import ScrolledPanel
+
+# from ...svgelements import SVG_ATTR_ID
+from ..icons import icons8_group_objects_50
+from ..mwindow import MWindow
+from ..wxutils import StaticBoxSizer
+from .attributes import IdPanel
 
 _ = wx.GetTranslation
 
-DOLLAR_INFO = re.compile(r"\$([0-9]+)=(.*)")
 
+class ElemcountPanel(wx.Panel):
+    def __init__(
+        self, *args, context=None, node=None, showid=True, showlabel=True, **kwds
+    ):
+        # begin wxGlade: LayerSettingPanel.__init__
+        kwds["style"] = kwds.get("style", 0)
+        wx.Panel.__init__(self, *args, **kwds)
+        self.context = context
+        self.node = node
+        # Shall we display id / label?
+        self.text_elements = wx.TextCtrl(self, id=wx.ID_ANY, style=wx.TE_READONLY)
+
+        main_sizer = wx.BoxSizer(wx.VERTICAL)
+        self.sizer_id = StaticBoxSizer(self, wx.ID_ANY, _("Elements:"), wx.VERTICAL)
+        self.sizer_id.Add(self.text_elements, 1, wx.EXPAND, 0)
+        main_sizer.Add(self.sizer_id, 0, wx.EXPAND, 0)
 
-class GRBLConfiguration(MWindow):
-    def __init__(self, *args, **kwds):
-        super().__init__(345, 415, *args, **kwds)
-        self.context = self.context.device
-        _icon = wx.NullIcon
-        _icon.CopyFromBitmap(icons8_administrative_tools_50.GetBitmap())
-        self.SetIcon(_icon)
-        self.SetTitle(_("GRBL-Configuration"))
+        self.SetSizer(main_sizer)
+        self.Layout()
+        self.set_widgets(self.node)
 
-        self.notebook_main = wx.aui.AuiNotebook(
-            self,
-            -1,
-            style=wx.aui.AUI_NB_TAB_EXTERNAL_MOVE
-            | wx.aui.AUI_NB_SCROLL_BUTTONS
-            | wx.aui.AUI_NB_TAB_SPLIT
-            | wx.aui.AUI_NB_TAB_MOVE,
-        )
-        self.panels = []
-        self._requested_status = False
+    def pane_hide(self):
+        pass
 
-        inject_choices = [
-            {
-                "attr": "aquire_properties",
-                "object": self,
-                "default": False,
-                "type": bool,
-                "style": "button",
-                "label": _("Query properties"),
-                "tip": _("Connect to laser and try to establish some properties"),
-                "section": "_ZZ_Auto-Configuration",
-                "width": 250,
-                "weight": 0,
-            },
-        ]
-
-        panel_main = ChoicePropertyPanel(
-            self,
-            wx.ID_ANY,
-            context=self.context,
-            choices="grbl-connection",
-            injector=inject_choices,
-        )
-        panel_global = ChoicePropertyPanel(
-            self, wx.ID_ANY, context=self.context, choices="grbl-global"
-        )
-        panel_dim = ChoicePropertyPanel(
-            self, wx.ID_ANY, context=self.context, choices="bed_dim"
-        )
-        panel_rotary = ChoicePropertyPanel(
-            self, wx.ID_ANY, context=self.context, choices="rotary"
+    def pane_show(self):
+        pass
+
+    def set_widgets(self, node):
+        def elem_count(enode):
+            res = 0
+            for e in enode.children:
+                res += 1
+                if e.type in ("file", "group"):
+                    res += elem_count(e)
+            return res
+
+        self.node = node
+        count = elem_count(self.node)
+        self.text_elements.SetValue(_("{count} elements").format(count=count))
+
+
+class GroupPropertiesPanel(ScrolledPanel):
+    def __init__(self, *args, context=None, node=None, **kwds):
+        kwds["style"] = kwds.get("style", 0) | wx.TAB_TRAVERSAL
+        wx.Panel.__init__(self, *args, **kwds)
+        self.context = context
+
+        self.node = node
+        self.panel_id = IdPanel(self, id=wx.ID_ANY, context=self.context, node=node)
+        self.panel_ct = ElemcountPanel(
+            self, id=wx.ID_ANY, context=self.context, node=node
         )
-        panel_warn = WarningPanel(self, id=wx.ID_ANY, context=self.context)
-        panel_actions = DefaultActionPanel(self, id=wx.ID_ANY, context=self.context)
-        newpanel = FormatterPanel(self, id=wx.ID_ANY, context=self.context)
-        self.panels.append(panel_main)
-        self.panels.append(panel_global)
-        self.panels.append(panel_dim)
-        self.panels.append(panel_rotary)
-        self.panels.append(panel_warn)
-        self.panels.append(panel_actions)
-        self.panels.append(newpanel)
-
-        self.notebook_main.AddPage(panel_main, _("Connection"))
-        self.notebook_main.AddPage(panel_dim, _("Dimensions"))
-        self.notebook_main.AddPage(panel_global, _("Global Settings"))
-        self.notebook_main.AddPage(panel_rotary, _("Rotary"))
-        self.notebook_main.AddPage(panel_warn, _("Warning"))
-        self.notebook_main.AddPage(panel_actions, _("Default Actions"))
-        self.notebook_main.AddPage(newpanel, _("Display Options"))
+
+        self.__set_properties()
+        self.__do_layout()
+
+        # end wxGlade
+
+    def __set_properties(self):
+        pass
+
+    def __do_layout(self):
+        # begin wxGlade: GroupProperty.__do_layout
+        sizer_main = wx.BoxSizer(wx.VERTICAL)
+        sizer_main.Add(self.panel_id, 0, wx.EXPAND, 0)
+        sizer_main.Add(self.panel_ct, 0, wx.EXPAND, 0)
+        self.SetSizer(sizer_main)
         self.Layout()
-        for panel in self.panels:
-            self.add_module_delegate(panel)
+        self.Centre()
+        # end wxGlade
+
+    def set_widgets(self, node):
+        self.panel_id.set_widgets(node)
+        self.panel_ct.set_widgets(node)
+        self.node = node
+
+
+class GroupProperty(MWindow):
+    def __init__(self, *args, node=None, **kwds):
+        super().__init__(372, 141, *args, **kwds)
+
+        self.panel = GroupPropertiesPanel(
+            self, wx.ID_ANY, context=self.context, node=node
+        )
+        self.add_module_delegate(self.panel)
+        _icon = wx.NullIcon
+        _icon.CopyFromBitmap(icons8_group_objects_50.GetBitmap())
+        self.SetIcon(_icon)
+        self.SetTitle(_("Group Properties"))
 
-    def window_open(self):
-        for panel in self.panels:
-            panel.pane_show()
-
-    def window_close(self):
-        for panel in self.panels:
-            panel.pane_hide()
+    def restore(self, *args, node=None, **kwds):
+        self.panel.set_widgets(node)
 
     def window_preserve(self):
         return False
 
-    @staticmethod
-    def submenu():
-        return ("Device-Settings", "GRBL-Configuration")
-
-    @property
-    def aquire_properties(self):
-        # Not relevant
+    def window_menu(self):
         return False
 
-    @aquire_properties.setter
-    def aquire_properties(self, value):
-        if not value:
-            return
-        try:
-            self.context.driver.grbl("$$\r")
-            self._requested_status = True
-        except:
-            wx.MessageBox(
-                _("Could not query laser-data!"),
-                _("Connect failed"),
-                wx.OK | wx.ICON_ERROR,
-            )
-
-    @signal_listener("grbl;response")
-    def on_serial_status(self, origin, cmd_issued, responses):
-        if cmd_issued == "$$":
-            # Right command
-            if self._requested_status:
-                # coming from myself
-                if responses is not None:
-                    changes = False
-                    for resp in responses:
-                        index = -1
-                        value = None
-                        match = DOLLAR_INFO.match(resp)
-                        if match:
-                            # $xx=yy
-                            index = int(match.group(1))
-                            value = match.group(2)
-                        if index >= 0 and value is not None:
-                            self.context.controller.grbl_settings[index] = value
-                        if index == 21:
-                            flag = bool(int(value) == 1)
-                            self.context.has_endstops = flag
-                            self.context.signal("has_endstops", flag, self.context)
-                        elif index == 130:
-                            self.context.bedwidth = f"{value}mm"
-                            self.context.signal(
-                                "bedwidth", self.context.bedwidth, self.context
-                            )
-                            changes = True
-                        elif index == 131:
-                            self.context.bedheight = f"{value}mm"
-                            self.context.signal(
-                                "bedheight", self.context.bedheight, self.context
-                            )
-                            changes = True
-                    if changes:
-                        self.context("viewport_update\n")
-                        self.context.signal("guide")
-                        self.context.signal("grid")
-                        self.context.signal("refresh_scene", "Scene")
-                self._requested_status = False
-                wx.MessageBox(
-                    _("Successfully queried laser-data!"),
-                    _("Connect succeeded"),
-                    wx.OK | wx.ICON_INFORMATION,
-                )
 
+class FilePropertiesPanel(ScrolledPanel):
+    def __init__(self, *args, context=None, node=None, **kwds):
+        kwds["style"] = kwds.get("style", 0) | wx.TAB_TRAVERSAL
+        wx.Panel.__init__(self, *args, **kwds)
+        self.context = context
+
+        self.node = node
+        self.text_filename = wx.TextCtrl(self, id=wx.ID_ANY, style=wx.TE_READONLY)
+        self.text_path = wx.TextCtrl(self, id=wx.ID_ANY, style=wx.TE_READONLY)
+        self.text_datetime = wx.TextCtrl(self, id=wx.ID_ANY, style=wx.TE_READONLY)
+        self.text_size = wx.TextCtrl(self, id=wx.ID_ANY, style=wx.TE_READONLY)
+        self.panel_ct = ElemcountPanel(
+            self, id=wx.ID_ANY, context=self.context, node=node
+        )
+        self.__set_properties()
+        self.__do_layout()
+
+        # end wxGlade
+
+    def __set_properties(self):
+        pass
+
+    def __do_layout(self):
+        # begin wxGlade: GroupProperty.__do_layout
+        sizer_main = wx.BoxSizer(wx.VERTICAL)
+        sizer1 = StaticBoxSizer(self, wx.ID_ANY, _("Filename:"), wx.HORIZONTAL)
+        sizer1.Add(self.text_filename, 1, wx.EXPAND, 0)
+        sizer2 = StaticBoxSizer(self, wx.ID_ANY, _("Path:"), wx.HORIZONTAL)
+        sizer2.Add(self.text_path, 1, wx.EXPAND, 0)
+        sizer3 = StaticBoxSizer(self, wx.ID_ANY, _("Size:"), wx.HORIZONTAL)
+        sizer3.Add(self.text_size, 1, wx.EXPAND, 0)
+        sizer4 = StaticBoxSizer(self, wx.ID_ANY, _("Date:"), wx.HORIZONTAL)
+        sizer4.Add(self.text_datetime, 1, wx.EXPAND, 0)
+        sizer_main.Add(sizer1, 0, wx.EXPAND, 0)
+        sizer_main.Add(sizer2, 0, wx.EXPAND, 0)
+        sizer_main.Add(sizer3, 0, wx.EXPAND, 0)
+        sizer_main.Add(sizer4, 0, wx.EXPAND, 0)
+        sizer_main.Add(self.panel_ct, 0, wx.EXPAND, 0)
+        self.SetSizer(sizer_main)
+        self.Layout()
+        self.Centre()
+        # end wxGlade
+
+    def set_widgets(self, node):
+        self.node = node
+        self.panel_ct.set_widgets(node)
+        if self.node is None:
+            text1 = ""
+            text2 = ""
+            text3 = ""
+            text4 = ""
         else:
-            # Different command
-            pass
+            fname = self.node.filepath
+            if fname is not None:
+                try:
+                    text1 = os.path.basename(fname)
+                    text2 = os.path.dirname(fname)
+                except (PermissionError, OSError, FileNotFoundError):
+                    text1 = fname
+                    text2 = _("File not found")
+                    fname = None
+            if fname is not None:
+                try:
+                    fsize = os.path.getsize(fname)
+                    ftime = os.path.getctime(fname)
+                    mtime = os.path.getmtime(fname)
+                    c_ti = time.ctime(ftime)
+                    m_ti = time.ctime(mtime)
+                    text3 = f"{fsize:,} bytes"
+                    c1 = _("Created:")
+                    c2 = _("Modified:")
+                    text4 = f"{c1} {c_ti}, {c2} {m_ti}"
+                except (PermissionError, OSError, FileNotFoundError):
+                    pass
+        self.text_filename.SetValue(text1)
+        self.text_path.SetValue(text2)
+        self.text_size.SetValue(text3)
+        self.text_datetime.SetValue(text4)
+
+
+class FileProperty(MWindow):
+    def __init__(self, *args, node=None, **kwds):
+        super().__init__(372, 141, *args, **kwds)
+
+        self.panel = FilePropertiesPanel(
+            self, wx.ID_ANY, context=self.context, node=node
+        )
+        self.add_module_delegate(self.panel)
+        _icon = wx.NullIcon
+        _icon.CopyFromBitmap(icons8_group_objects_50.GetBitmap())
+        self.SetIcon(_icon)
+        self.SetTitle(_("File Properties"))
+
+    def restore(self, *args, node=None, **kwds):
+        self.panel.set_widgets(node)
+
+    def window_preserve(self):
+        return False
+
+    def window_menu(self):
+        return False
```

### Comparing `meerk40t-0.8.3000/meerk40t/grbl/gui/grblserialcontroller.py` & `meerk40t-0.8.4000/meerk40t/grbl/gui/grblserialcontroller.py`

 * *Files 2% similar despite different names*

```diff
@@ -46,14 +46,20 @@
         static_line_2.SetMinSize((483, 5))
         sizer_1.Add(static_line_2, 0, wx.EXPAND, 0)
 
         self.data_exchange = wx.TextCtrl(self, wx.ID_ANY, "", style=wx.TE_MULTILINE)
         sizer_1.Add(self.data_exchange, 1, wx.EXPAND, 0)
 
         sizer_2 = wx.BoxSizer(wx.HORIZONTAL)
+        self.realtime_commands = (
+            "!",  # pause
+            "~",  # resume
+            "?",  # status report
+            # "$X",
+        )
         self.gcode_commands = [
             ("$X", _("Reset"), _("Reset laser and clear alarm"), None),
             ("$#", _("Gcode Parameter"), _("Display active Gcode-parameters"), None),
             ("$$", _("GRBL Parameter"), _("Display active GRBL-parameters"), None),
             ("$I", _("Info"), _("Show Build-Info"), None),
             ("?", _("Status"), _("Query status"), None),
         ]
@@ -116,15 +122,19 @@
     def send_gcode(self, gcode_cmd):
         def handler(event):
             self.service(f"gcode {gcode_cmd}")
 
         return handler
 
     def on_gcode_enter(self, event):  # wxGlade: SerialControllerPanel.<event_handler>
-        self.service(f"gcode {self.gcode_text.GetValue()}")
+        cmd = self.gcode_text.GetValue()
+        if cmd in self.realtime_commands:
+            self.service(f"gcode_realtime {cmd}")
+        else:
+            self.service(f"gcode {cmd}")
         self.gcode_text.Clear()
 
     def update_sent(self, text):
         with self._buffer_lock:
             self._buffer += f"<--{text}\n"
         self.service.signal("grbl_controller_update", True)
 
@@ -196,15 +206,15 @@
         # end wxGlade
 
     @signal_listener("serial;status")
     def on_serial_status(self, origin, state):
         self.serial_panel.on_serial_status(origin, state)
 
     def window_open(self):
-        self._opened_port = self.service.serial_port.lower()
+        self._opened_port = self.service.location()
         self.context.channel(f"send-{self._opened_port}").watch(
             self.serial_panel.update_sent
         )
         self.context.channel(f"recv-{self._opened_port}").watch(
             self.serial_panel.update_recv
         )
         self.serial_panel.pane_show()
```

### Comparing `meerk40t-0.8.3000/meerk40t/grbl/gui/gui.py` & `meerk40t-0.8.4000/meerk40t/lihuiyu/gui/gui.py`

 * *Files 22% similar despite different names*

```diff
@@ -1,52 +1,81 @@
+from meerk40t.kernel import signal_listener
+
+
 def plugin(service, lifecycle):
     if lifecycle == "invalidate":
-        try:
-            import serial  # pylint: disable=unused-import
-        except ImportError:
-            return True
         return not service.has_feature("wx")
+
     if lifecycle == "service":
-        return "provider/device/grbl"
+        return "provider/device/lhystudios"
+
+    if lifecycle == "assigned":
+        service("window toggle Configuration\n")
+
     if lifecycle == "added":
-        from meerk40t.grbl.gui.grblconfiguration import GRBLConfiguration
-        from meerk40t.grbl.gui.grblserialcontroller import SerialController
         from meerk40t.gui.icons import (
             icons8_computer_support_50,
             icons8_connected_50,
             icons8_emergency_stop_button_50,
-            icons8_flash_off_50,
-            icons8_info_50,
             icons8_pause_50,
-            icons8_quick_mode_on_50,
         )
+        from meerk40t.lihuiyu.gui.lhyaccelgui import LihuiyuAccelerationChart
+        from meerk40t.lihuiyu.gui.lhycontrollergui import LihuiyuControllerGui
+        from meerk40t.lihuiyu.gui.lhydrivergui import LihuiyuDriverGui
+        from meerk40t.lihuiyu.gui.lhyoperationproperties import LhyAdvancedPanel
+        from meerk40t.lihuiyu.gui.tcpcontroller import TCPController
+
+        service.register("window/Controller", LihuiyuControllerGui)
+        service.register("window/Configuration", LihuiyuDriverGui)
+        service.register("window/Acceleration-Chart", LihuiyuAccelerationChart)
+        service.register("window/Network-Controller", TCPController)
 
-        service.register("window/Serial-Controller", SerialController)
-        service.register("window/Configuration", GRBLConfiguration)
-
-        service.register("winpath/Serial-Controller", service)
+        service.register("winpath/Controller", service)
         service.register("winpath/Configuration", service)
+        service.register("winpath/AccelerationChart", service)
+        service.register("winpath/Network-Controller", service)
 
-        _ = service._
+        service.register("property/RasterOpNode/Lihuiyu", LhyAdvancedPanel)
+        service.register("property/CutOpNode/Lihuiyu", LhyAdvancedPanel)
+        service.register("property/EngraveOpNode/Lihuiyu", LhyAdvancedPanel)
+        service.register("property/ImageOpNode/Lihuiyu", LhyAdvancedPanel)
+        service.register("property/DotsOpNode/Lihuiyu", LhyAdvancedPanel)
+        _ = service.kernel.translation
+
+        def controller_click(i=None):
+            if service.networked:
+                service("window toggle Network-Controller\n")
+            else:
+                service("window toggle Controller\n")
 
         service.register(
             "button/control/Controller",
             {
-                "label": _("Serial Controller"),
+                "label": _("Controller"),
                 "icon": icons8_connected_50,
-                "tip": _("Opens GRBL Serial Sender"),
-                "action": lambda e: service("window toggle Serial-Controller\n"),
+                "tip": _("Opens Controller Window"),
+                "action": controller_click,
+                "alt-action": (
+                    (
+                        _("Opens USB-Controller"),
+                        lambda e: service("window toggle Controller\n"),
+                    ),
+                    (
+                        _("Opens Network-Controller"),
+                        lambda e: service("window toggle Network-Controller\n"),
+                    ),
+                ),
             },
         )
         service.register(
             "button/device/Configuration",
             {
                 "label": _("Config"),
                 "icon": icons8_computer_support_50,
-                "tip": _("Opens device-specfic configuration window"),
+                "tip": _("Opens device-specific configuration window"),
                 "action": lambda v: service("window toggle Configuration\n"),
             },
         )
         service.register(
             "button/control/Pause",
             {
                 "label": _("Pause"),
@@ -61,49 +90,17 @@
             {
                 "label": _("Stop"),
                 "icon": icons8_emergency_stop_button_50,
                 "tip": _("Emergency stop the laser"),
                 "action": lambda v: service("estop\n"),
             },
         )
+        service.add_service_delegate(LihuiyuGui(service))
 
-        def has_red_dot_enabled():
-            # Does the current device have an active use_red_dot?
-            res = False
-            if hasattr(service, "use_red_dot"):
-                if service.use_red_dot:
-                    res = True
-            return res
-
-        service.register(
-            "button/control/Redlight",
-            {
-                "label": _("Red Dot On"),
-                "icon": icons8_quick_mode_on_50,
-                "tip": _("Turn Redlight On"),
-                "action": lambda v: service("red on\n"),
-                "toggle": {
-                    "label": _("Red Dot Off"),
-                    "action": lambda v: service("red off\n"),
-                    "icon": icons8_flash_off_50,
-                    "signal": "grbl_red_dot",
-                },
-                "rule_enabled": lambda v: has_red_dot_enabled(),
-            },
-        )
-
-        service.register(
-            "button/control/ClearAlarm",
-            {
-                "label": _("Clear Alarm"),
-                "icon": icons8_info_50,
-                "tip": _("Send a GRBL Clear Alarm command"),
-                "action": lambda v: service("clear_alarm\n"),
-            },
-        )
-        service.add_service_delegate(GRBLGui(service))
 
-
-class GRBLGui:
+class LihuiyuGui:
     def __init__(self, context):
         self.context = context
-        # This is a stub.
+
+    @signal_listener("controller")
+    def on_controller(self, origin, original_origin, *args):
+        self.context("window open Controller\n")
```

### Comparing `meerk40t-0.8.3000/meerk40t/grbl/gui/tcpcontroller.py` & `meerk40t-0.8.4000/meerk40t/lihuiyu/gui/tcpcontroller.py`

 * *Files 9% similar despite different names*

```diff
@@ -1,49 +1,52 @@
 import wx
 
 from meerk40t.gui.icons import icons8_connected_50, icons8_disconnected_50
 from meerk40t.gui.mwindow import MWindow
+from meerk40t.gui.wxutils import TextCtrl
 from meerk40t.kernel import signal_listener
 
 _ = wx.GetTranslation
 
 
 class TCPController(MWindow):
     def __init__(self, *args, **kwds):
         super().__init__(499, 170, *args, **kwds)
         self.button_device_connect = wx.Button(self, wx.ID_ANY, _("Connection"))
         self.service = self.context.device
-        self.text_status = wx.TextCtrl(self, wx.ID_ANY, "")
-        self.text_ip_host = wx.TextCtrl(self, wx.ID_ANY, "", style=wx.TE_PROCESS_ENTER)
-        self.text_port = wx.TextCtrl(self, wx.ID_ANY, "", style=wx.TE_PROCESS_ENTER)
+        self.text_status = wx.TextCtrl(self, wx.ID_ANY, "", style=wx.TE_PROCESS_ENTER)
+        self.text_ip_host = TextCtrl(
+            self, wx.ID_ANY, "", style=wx.TE_PROCESS_ENTER, check="empty"
+        )
+        self.text_port = TextCtrl(
+            self, wx.ID_ANY, "", check="float", style=wx.TE_PROCESS_ENTER
+        )
         self.gauge_buffer = wx.Gauge(self, wx.ID_ANY, 10)
         self.text_buffer_length = wx.TextCtrl(self, wx.ID_ANY, "")
         self.text_buffer_max = wx.TextCtrl(self, wx.ID_ANY, "")
 
         self.__set_properties()
         self.__do_layout()
 
         self.Bind(
             wx.EVT_BUTTON, self.on_button_start_connection, self.button_device_connect
         )
-        self.text_port.Bind(wx.EVT_TEXT_ENTER, self.on_port_change)
-        self.text_port.Bind(wx.EVT_KILL_FOCUS, self.on_port_change)
-        self.text_ip_host.Bind(wx.EVT_TEXT_ENTER, self.on_address_change)
-        self.text_ip_host.Bind(wx.EVT_KILL_FOCUS, self.on_address_change)
+        self.text_port.SetActionRoutine(self.on_port_change)
+        self.text_ip_host.SetActionRoutine(self.on_address_change)
         # end wxGlade
         self.max = 0
         self.state = None
 
-    def on_port_change(self, event):
+    def on_port_change(self):
         try:
             self.service.port = int(self.text_port.GetValue())
         except ValueError:
             pass
 
-    def on_address_change(self, event):
+    def on_address_change(self):
         self.service.address = str(self.text_ip_host.GetValue())
 
     def __set_properties(self):
         # begin wxGlade: Controller.__set_properties
         self.SetTitle(_("TCP-Controller"))
         _icon = wx.NullIcon
         _icon.CopyFromBitmap(icons8_connected_50.GetBitmap())
@@ -83,46 +86,57 @@
         # begin wxGlade: Controller.__do_layout
         sizer_1 = wx.BoxSizer(wx.VERTICAL)
         write_buffer = wx.BoxSizer(wx.HORIZONTAL)
         connection_controller = wx.BoxSizer(wx.VERTICAL)
         sizer_15 = wx.BoxSizer(wx.HORIZONTAL)
         connection_controller.Add(self.button_device_connect, 0, wx.EXPAND, 0)
         label_7 = wx.StaticText(self, wx.ID_ANY, _("Status"))
-        sizer_15.Add(label_7, 1, 0, 0)
-        sizer_15.Add(self.text_status, 11, 0, 0)
         label_8 = wx.StaticText(self, wx.ID_ANY, _("Address"))
-        sizer_15.Add(label_8, 1, 0, 0)
-        sizer_15.Add(self.text_ip_host, 11, 0, 0)
-        sizer_15.Add((20, 20), 0, 0, 0)
         label_9 = wx.StaticText(self, wx.ID_ANY, _("Port"))
-        sizer_15.Add(label_9, 1, 0, 0)
-        sizer_15.Add(self.text_port, 11, 0, 0)
+
+        sizer_15.Add(label_7, 1, wx.ALIGN_CENTER_VERTICAL, 0)
+        sizer_15.Add(self.text_status, 11, wx.ALIGN_CENTER_VERTICAL, 0)
+        sizer_15.Add(label_8, 1, wx.ALIGN_CENTER_VERTICAL, 0)
+        sizer_15.Add(self.text_ip_host, 11, wx.ALIGN_CENTER_VERTICAL, 0)
+        sizer_15.Add((20, 20), 0, 0, 0)
+        sizer_15.Add(label_9, 1, wx.ALIGN_CENTER_VERTICAL, 0)
+        sizer_15.Add(self.text_port, 11, wx.ALIGN_CENTER_VERTICAL, 0)
+
         connection_controller.Add(sizer_15, 0, 0, 0)
+
         sizer_1.Add(connection_controller, 0, wx.EXPAND, 0)
         static_line_2 = wx.StaticLine(self, wx.ID_ANY)
         static_line_2.SetMinSize((483, 5))
         sizer_1.Add(static_line_2, 0, wx.EXPAND, 0)
         sizer_1.Add(self.gauge_buffer, 0, wx.EXPAND, 0)
         label_12 = wx.StaticText(self, wx.ID_ANY, _("Buffer Size: "))
-        write_buffer.Add(label_12, 0, 0, 0)
-        write_buffer.Add(self.text_buffer_length, 10, 0, 0)
+        write_buffer.Add(label_12, 0, wx.ALIGN_CENTER_VERTICAL, 0)
+        write_buffer.Add(self.text_buffer_length, 10, wx.ALIGN_CENTER_VERTICAL, 0)
         write_buffer.Add((20, 20), 0, 0, 0)
         label_13 = wx.StaticText(self, wx.ID_ANY, _("Max Buffer Size:"))
-        write_buffer.Add(label_13, 0, 0, 0)
-        write_buffer.Add(self.text_buffer_max, 10, 0, 0)
+        write_buffer.Add(label_13, 0, wx.ALIGN_CENTER_VERTICAL, 0)
+        write_buffer.Add(self.text_buffer_max, 10, wx.ALIGN_CENTER_VERTICAL, 0)
         sizer_1.Add(write_buffer, 0, 0, 0)
         self.SetSizer(sizer_1)
         self.Layout()
         # end wxGlade
 
     def window_open(self):
         self.text_ip_host.SetValue(str(self.service.address))
         self.text_port.SetValue(str(self.service.port))
         self.text_buffer_max.SetValue("0")
         self.text_buffer_length.SetValue("0")
+        self.on_network_update()
+
+    @signal_listener("network_update")
+    def on_network_update(self, origin=None, *args):
+        if not self.service.networked:
+            self.button_device_connect.Enable(False)
+        else:
+            self.button_device_connect.Enable(True)
 
     @signal_listener("tcp;status")
     def on_tcp_status(self, origin, state):
         self.text_status.SetValue(str(state))
         self.state = state
         if state == "uninitialized" or state == "disconnected":
             self.button_device_connect.SetBackgroundColour("#ffff00")
@@ -148,15 +162,16 @@
             self.gauge_buffer.SetRange(self.max)
         self.gauge_buffer.SetValue(min(status, self.gauge_buffer.GetRange()))
 
     def on_tcp_write(self, origin, status):
         self.text_port.SetValue(str(status))
 
     def on_button_start_connection(self, event):  # wxGlade: Controller.<event_handler>
-        if self.state == "connected":
-            self.service.controller.disconnect()
-        else:
-            self.service.controller.connect()
+        if self.service.tcp is not None:
+            if self.state == "connected":
+                self.service.tcp.disconnect()
+            else:
+                self.service.tcp.connect()
 
     @staticmethod
     def submenu():
-        return ("Device-Control", "GRBL TCP Controller")
+        return ("Device-Control", "TCP Controller")
```

### Comparing `meerk40t-0.8.3000/meerk40t/grbl/interpreter.py` & `meerk40t-0.8.4000/meerk40t/grbl/interpreter.py`

 * *Files 8% similar despite different names*

```diff
@@ -8,15 +8,15 @@
 from meerk40t.grbl.emulator import GRBLEmulator
 from meerk40t.kernel import Module
 
 
 class GRBLInterpreter(Module):
     def __init__(self, service, path):
         Module.__init__(self, service, path)
-        self.emulator = GRBLEmulator(self, service.device.scene_to_show_matrix())
+        self.emulator = GRBLEmulator(self, service.space.display.matrix())
         self._attached_device = None
 
     def __repr__(self):
         return f"GcodeInterpreter({self.name})"
 
     def move_abs(self, x, y):
         self.context.signal("emulator;position", (x, y, x, y))
```

### Comparing `meerk40t-0.8.3000/meerk40t/grbl/loader.py` & `meerk40t-0.8.4000/meerk40t/grbl/loader.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/grbl/mock_connection.py` & `meerk40t-0.8.4000/meerk40t/grbl/mock_connection.py`

 * *Files 7% similar despite different names*

```diff
@@ -3,16 +3,14 @@
 
 
 The mock connection is used for debug and research purposes. And simply prints the data sent to it rather than engaging
 any hardware.
 """
 import time
 
-from serial import SerialException
-
 
 class MockConnection:
     def __init__(self, service):
         self.service = service
         self.channel = self.service.channel("grbl_state", buffer_size=20)
         self.laser = None
         self.read_buffer = bytearray()
@@ -22,15 +20,15 @@
     @property
     def connected(self):
         return self.laser is not None
 
     def read(self):
         if self.just_connected:
             self.just_connected = False
-            return "grbl version fake"
+            return "Grbl 1.1f ['$' for help]\r\n" "[MSG:’$H’|’$X’ to unlock]\r\n"
         if self.time_stamps:
             if self.time_stamps[0] < (time.time() - 0.3):
                 self.time_stamps.pop(0)
                 return "ok"
         return ""
 
     def write(self, line):
@@ -44,13 +42,12 @@
             self.channel("Attempting to Connect...")
             self.laser = True
             self.just_connected = True
             self.channel("Connected")
             self.service.signal("serial;status", "connected")
         except ConnectionError:
             self.channel("Connection Failed.")
-        except SerialException:
-            self.channel("Serial connection could not be established.")
 
     def disconnect(self):
+        self.laser = None
         self.channel("Disconnected")
         self.service.signal("serial;status", "disconnected")
```

#### encoding

```diff
@@ -1 +1 @@
-us-ascii
+utf-8
```

### Comparing `meerk40t-0.8.3000/meerk40t/grbl/plugin.py` & `meerk40t-0.8.4000/meerk40t/grbl/plugin.py`

 * *Files 26% similar despite different names*

```diff
@@ -1,13 +1,13 @@
 """
 GRBL Device Plugin
 
 Registers the required files to run the GRBL device.
 """
-from meerk40t.grbl.control import GRBLControl
+from meerk40t.grbl.control import GRBLControl, greet
 from meerk40t.grbl.device import GRBLDevice, GRBLDriver
 from meerk40t.grbl.emulator import GRBLEmulator
 from meerk40t.grbl.gcodejob import GcodeJob
 from meerk40t.grbl.interpreter import GRBLInterpreter
 from meerk40t.grbl.loader import GCodeLoader
 
 
@@ -155,11 +155,48 @@
                 grblcontrol = GRBLControl(root)
                 root.device.register("grblcontrol", grblcontrol)
                 grblcontrol.start(port, verbose)
             if quit:
                 grblcontrol.quit()
                 root.device.unregister("grblcontrol")
 
+        @kernel.console_option(
+            "port", "p", type=int, default=23, help=_("port to listen on.")
+        )
+        @kernel.console_command(
+            "grblmock", help=_("starts a grblmock server on port 23 (telnet)")
+        )
+        def server_console(command, channel, _, port=23, **kwargs):
+            root = kernel.root
+
+            try:
+                root.open_as("module/TCPServer", "grblmock", port=port)
+                tcp_recv_channel = root.channel("grblmock/recv", pure=True)
+                tcp_send_channel = root.channel("grblmock/send", pure=True)
+                tcp_send_channel.greet = greet
+
+                def everything_ok(line):
+                    for c in line:
+                        if c == ord("\n") or c == ord("\r"):
+                            tcp_send_channel("ok\r\n")
+                        if c == ord("?"):
+                            x = 0
+                            y = 0
+                            z = 0
+                            f = 0
+                            s = 0
+                            status = (
+                                f"<Idle|MPos:{x:.3f},{y:.3f},{z:.3f}|FS:{f},{s}>\r\n"
+                            )
+                            tcp_send_channel(status)
+
+                tcp_send_channel.watch(print)
+                tcp_recv_channel.watch(print)
+                tcp_recv_channel.watch(everything_ok)
+            except (OSError, ValueError):
+                channel(_("Server failed on port: {port}").format(port=port))
+            return
+
     elif lifecycle == "preboot":
         suffix = "grbl"
         for d in kernel.derivable(suffix):
             kernel.root(f"service device start -p {d} {suffix}\n")
```

### Comparing `meerk40t-0.8.3000/meerk40t/grbl/serial_connection.py` & `meerk40t-0.8.4000/meerk40t/grbl/serial_connection.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/grbl/tcp_connection.py` & `meerk40t-0.8.4000/meerk40t/lihuiyu/tcp_connection.py`

 * *Files 12% similar despite different names*

```diff
@@ -1,52 +1,69 @@
 """
-TCP Connection
+Lihuiyu TCP Connection
 
-Communicate with a TCP network destination with the GRBL driver.
+Governs the TCP out connections for the lihuiyu device. This allows the output controller to write to a particular
+network location.
 """
 
 import socket
 import threading
 import time
 
 
 class TCPOutput:
-    def __init__(self, context):
+    def __init__(self, context, name=None):
         super().__init__()
         self.service = context
         self._stream = None
+        self.name = name
 
         self.lock = threading.RLock()
         self.buffer = bytearray()
         self.thread = None
 
     def connect(self):
         try:
             self._stream = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
             self._stream.connect((self.service.address, self.service.port))
             self.service.signal("tcp;status", "connected")
-        except (ConnectionError, TimeoutError):
+        except TimeoutError:
             self.disconnect()
+            self.service.signal("tcp;status", "timeout connect")
+        except ConnectionError:
+            self.disconnect()
+            self.service.signal("tcp;status", "connection error")
+        except socket.gaierror as e:
+            self.disconnect()
+            self.service.signal("tcp;status", "address resolve error")
+        except socket.herror as e:
+            self.disconnect()
+            self.service.signal("tcp;status", f"herror: {str(e)}")
+        except OSError as e:
+            self.disconnect()
+            self.service.signal("tcp;status", f"Host down {str(e)}")
 
     def disconnect(self):
         self.service.signal("tcp;status", "disconnected")
         self._stream.close()
         self._stream = None
 
     def write(self, data):
         self.service.signal("tcp;write", data)
-        if isinstance(data, str):
-            data = bytes(data, "utf-8")
         with self.lock:
             self.buffer += data
             self.service.signal("tcp;buffer", len(self.buffer))
         self._start()
 
     realtime_write = write
 
+    @property
+    def viewbuffer(self):
+        return self.buffer.decode("utf8")
+
     def _start(self):
         if self.thread is None:
             self.thread = self.service.threaded(
                 self._sending,
                 thread_name=f"sender-{self.service.port}",
                 result=self._stop,
             )
@@ -77,11 +94,15 @@
                 time.sleep(0.05)
             if tries >= 20:
                 with self.lock:
                     if len(self.buffer) == 0:
                         break
 
     def __repr__(self):
+        if self.name is not None:
+            return (
+                f"TCPOutput('{self.service.address}:{self.service.port}','{self.name}')"
+            )
         return f"TCPOutput('{self.service.address}:{self.service.port}')"
 
     def __len__(self):
         return len(self.buffer)
```

### Comparing `meerk40t-0.8.3000/meerk40t/gui/about.py` & `meerk40t-0.8.4000/meerk40t/gui/about.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/alignment.py` & `meerk40t-0.8.4000/meerk40t/gui/alignment.py`

 * *Files 0% similar despite different names*

```diff
@@ -1007,19 +1007,15 @@
             elif ymode == "center":
                 dy -= (node.bounds[3] - node.bounds[1]) / 2
             elif ymode == "max":
                 dy -= node.bounds[3] - node.bounds[1]
 
             if dx == 0 and dy == 0 and ptangle == 0:
                 continue
-            if (
-                hasattr(node, "lock")
-                and node.lock
-                and not self.context.elements.lock_allows_move
-            ):
+            if not node.can_move(self.context.elements.lock_allows_move):
                 continue
             else:
                 try:
                     cx = (node.bounds[2] + node.bounds[0]) / 2 + dx
                     cy = (node.bounds[3] + node.bounds[1]) / 2 + dy
                     change = 0
                     if dx != 0 or dy != 0:
@@ -1449,19 +1445,15 @@
                 # s += f"{Length(amount=right_edge, unitless=1, digits=1).length_mm} - "
                 # s += f"{Length(amount=bottom_edge, unitless=1, digits=1).length_mm}"
                 # print (s)
                 # s = f"dx={Length(amount=dx, unitless=1, digits=1).length_mm}, "
                 # s += f"dx={Length(amount=dy, unitless=1, digits=1).length_mm}"
                 # print (s)
                 if dx != 0 or dy != 0:
-                    if (
-                        hasattr(node, "lock")
-                        and node.lock
-                        and not self.context.elements.lock_allows_move
-                    ):
+                    if not node.can_move(self.context.elements.lock_allows_move):
                         continue
                     else:
                         try:
                             node.matrix.post_translate(dx, dy)
                             # node.modified()
                             node.translated(dx, dy)
                         except AttributeError:
@@ -1555,16 +1547,16 @@
         self.txt_gap_y.Enable(has_emph)
         self.validate_data()
 
 
 class Alignment(MWindow):
     def __init__(self, *args, **kwds):
         super().__init__(
-            350,
-            350,
+            360,
+            485,
             *args,
             style=wx.CAPTION
             | wx.CLOSE_BOX
             | wx.FRAME_FLOAT_ON_PARENT
             | wx.TAB_TRAVERSAL
             | wx.RESIZE_BORDER,
             **kwds,
```

### Comparing `meerk40t-0.8.3000/meerk40t/gui/bufferview.py` & `meerk40t-0.8.4000/meerk40t/gui/bufferview.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/choicepropertypanel.py` & `meerk40t-0.8.4000/meerk40t/gui/choicepropertypanel.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/consolepanel.py` & `meerk40t-0.8.4000/meerk40t/gui/consolepanel.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/devicepanel.py` & `meerk40t-0.8.4000/meerk40t/gui/devicepanel.py`

 * *Files 1% similar despite different names*

```diff
@@ -327,14 +327,15 @@
             self.devices_list.SetItem(index, 1, type_info)
             self.devices_list.SetItem(index, 2, family_info)
             self.devices_list.SetItemData(index, dev_index)
             if self.context.device is device:
                 self.devices_list.SetItemTextColour(index, wx.RED)
 
         self.devices_list.SetFocus()
+        self.on_item_selected(None)
 
     def get_new_label_for_device(self, device_type):
         ct = 0
         maxid = 1
         label = ""
         device_type = device_type.lower()
         for i, device in enumerate(self.context.kernel.services("device")):
@@ -357,17 +358,20 @@
         if ct > 0:
             # There is already one...
             label += " #" + str(maxid + 1)
         # print ("Found: %d -> label=%s" % (ct, label))
         return label
 
     def on_item_selected(self, event):
-        self.current_item = event.Index
+        if event is None:
+            self.current_item = self.devices_list.GetFirstSelected()
+        else:
+            self.current_item = event.Index
+            event.Skip()
         self.enable_controls()
-        event.Skip()
 
     def on_item_deselected(self, event):
         self.current_item = -1
         self.enable_controls()
         event.Skip()
 
     def enable_controls(self):
```

### Comparing `meerk40t-0.8.3000/meerk40t/gui/dialogoptions.py` & `meerk40t-0.8.4000/meerk40t/gui/dialogoptions.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/executejob.py` & `meerk40t-0.8.4000/meerk40t/gui/executejob.py`

 * *Files 5% similar despite different names*

```diff
@@ -130,46 +130,57 @@
 
     def on_button_start(self, event=None):  # wxGlade: Preview.<event_handler>
         if self.busy:
             return
         self.busy = True
         self.button_start.Enable(False)
         if self.stage == 0:
-            with wx.BusyInfo(_("Preprocessing...")):
-                self.context(f"plan{self.plan_name} copy preprocess\n")
-                cutplan = self.context.planner.default_plan
-                if len(cutplan.commands) == 0:
-                    self.context(f"plan{self.plan_name} validate\n")
+            self.context.kernel.busyinfo.start(msg=_("Preprocessing..."))
+            self.context(f"plan{self.plan_name} copy preprocess\n")
+            cutplan = self.context.planner.default_plan
+            if len(cutplan.commands) == 0:
+                self.context(f"plan{self.plan_name} validate\n")
+            self.context.kernel.busyinfo.end()
         elif self.stage == 1:
-            with wx.BusyInfo(_("Determining validity of operations...")):
-                self.context(f"plan{self.plan_name} preprocess\n")
-                cutplan = self.context.planner.default_plan
-                if len(cutplan.commands) == 0:
-                    self.context(f"plan{self.plan_name} validate\n")
-        elif self.stage == 2:
-            with wx.BusyInfo(_("Validating operation data...")):
+            self.context.kernel.busyinfo.start(
+                msg=_("Determining validity of operations...")
+            )
+            self.context(f"plan{self.plan_name} preprocess\n")
+            cutplan = self.context.planner.default_plan
+            if len(cutplan.commands) == 0:
                 self.context(f"plan{self.plan_name} validate\n")
+            self.context.kernel.busyinfo.end()
+        elif self.stage == 2:
+            self.context.kernel.busyinfo.start(msg=_("Validating operation data..."))
+            self.context(f"plan{self.plan_name} validate\n")
+            self.context.kernel.busyinfo.end()
         elif self.stage == 3:
-            with wx.BusyInfo(_("Compiling cuts...")):
-                self.context(f"plan{self.plan_name} blob preopt\n")
+            self.context.kernel.busyinfo.start(msg=_("Compiling cuts..."))
+            self.context(f"plan{self.plan_name} blob preopt\n")
+            self.context.kernel.busyinfo.end()
         elif self.stage == 4:
-            with wx.BusyInfo(_("Determining optimizations to perform...")):
-                self.context(f"plan{self.plan_name} preopt\n")
+            self.context.kernel.busyinfo.start(
+                msg=_("Determining optimizations to perform...")
+            )
+            self.context(f"plan{self.plan_name} preopt\n")
+            self.context.kernel.busyinfo.end()
         elif self.stage == 5:
-            with wx.BusyInfo(_("Performing Optimizations...")):
-                self.context(f"plan{self.plan_name} optimize\n")
+            self.context.kernel.busyinfo.start(msg=_("Performing Optimizations..."))
+            self.context(f"plan{self.plan_name} optimize\n")
+            self.context.kernel.busyinfo.end()
         elif self.stage == 6:
-            with wx.BusyInfo(_("Sending data to laser...")):
-                self.context(f"plan{self.plan_name} spool\n")
-                if self.context.auto_spooler:
-                    self.context("window open JobSpooler\n")
-                try:
-                    self.GetParent().Close()
-                except (TypeError, AttributeError):
-                    pass
+            self.context.kernel.busyinfo.start(msg=_("Sending data to laser..."))
+            self.context(f"plan{self.plan_name} spool\n")
+            if self.context.auto_spooler:
+                self.context("window open JobSpooler\n")
+            try:
+                self.GetParent().Close()
+            except (TypeError, AttributeError):
+                pass
+            self.context.kernel.busyinfo.end()
         self.busy = False
         self.button_start.Enable(True)
         self.update_gui()
 
     def pane_show(self):
         # self.context.setting(bool, "opt_rasters_split", True)
         # TODO: OPT_RASTER_SPLIT
```

### Comparing `meerk40t-0.8.3000/meerk40t/gui/fonts.py` & `meerk40t-0.8.4000/meerk40t/gui/fonts.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/help_assets/help_assets.py` & `meerk40t-0.8.4000/meerk40t/gui/help_assets/help_assets.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/hersheymanager.py` & `meerk40t-0.8.4000/meerk40t/gui/hersheymanager.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/icons.py` & `meerk40t-0.8.4000/meerk40t/gui/icons.py`

 * *Files 1% similar despite different names*

```diff
@@ -3700,7 +3700,57 @@
     b"aJSqLF7POLGy2XuS7FAjWmI6vlYp0ATJzcv0PMxy1KRi4F6uyqcKPHwIQ61LcyNRonp3TLqS"
     b"noNV0um8LCcyxQ64zHiKxwTpYkH1hbiNt7mLF2OsRaHRufKtSQTUKaCZgO8LOsQe4A7Sv01z"
     b"LTdYNhnQ7jxXptENol3/k/aip80JHJ/TnrioPo2Vj8hK8FBnZrbp3q90ZJkQtfJOHc6cMr/S"
     b"sD3zkeNPp0TasrwMPePS563Vvqqe5kwtOMlYnCCzDCjMEkc7urQnY7vYNKvznqhCoECn6HWr"
     b"Ep8xUrSPngZ9s7J1wNfdfjBgF59L4wS7rAfUrOzyTsKfcOwTASzkJxzlfP5MHWd+pnz6V61U"
     b"p97PKj3dpP1V1AXrQ1Bt3AVSX1y/4Zx+TQAAAABJRU5ErkJggg=="
 )
+
+icons8_home_location_20 = PyEmbeddedImage(
+    b"iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwY"
+    b"AAABYElEQVR4nKXVsUtWYRTH8Y+aEURDKAitTvISQUaakkNDIJi7+Ac4ODY4hFA4uIUO0tSg"
+    b"III0pLQ2OEjkUkMQEoFjUIiVKAR55cIhHl7ufbv39QcHLuc59/uc53eey6W1buErltCR5K9r"
+    b"Q7fxA1nES3RiBn/QVwc2GLATTOB1QDewEM+NqrARHOEYDyJ3OYEe1QGO4VfE/aa1brxKLGhU"
+    b"gf2ODu6V1HRhLYBvcKUM9jD8OsTd/2ycQueLCsZxGkPIJ1tF+bRncbNo8Xvs9gHL0cGFtI6/"
+    b"idkDFd7pxwu8xw4eF/n5tOL0hvEzaSCLeIerdYG5HV+i7gxvsZ9AF+sCh5KX82PmuoTdyB2o"
+    b"CXyUANO7+jxy+dX7pyeRzD0qUyMBbqEXd/Atcp/S4tHwJSuIvaTuc0lNhmfNHUxiFZtNMZfU"
+    b"TJXADtHT4nQttV0AnG4XlutafFmF16Vd3cBHrKS/h3MOR3bOP+nOwAAAAABJRU5ErkJggg=="
+)
+
+icons8_user_location_50 = PyEmbeddedImage(
+    b"iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAIAAACRXR/mAAAABnRSTlMA/wD/AP83WBt9AAAA"
+    b"CXBIWXMAAA7EAAAOxAGVKw4bAAAHOElEQVRYhc1Zb0ySaxQ/3JS0SHHiIGmVjchWUxdry2pI"
+    b"5bS+uAwzxYbVCifJzNj60FYzbatWc/3b+tD8ogtdNvqfW25l2sDUNcEN5jCD1FLxPxCOgOd+"
+    b"eHbfywVe4MXu3T2fzjnP75zn9/I+z3nO80JDCMH/T2KWEzw2Nvb06dO+vj6DwbCwsLBixQou"
+    b"l7t9+/YDBw7k5+evXLky6sy0KH6t+fn5K1euNDY22my25OTkzMzMzZs3r1mzxuPxTExMmEym"
+    b"/v5+AMjKylIqlcePH4+GF6IidrtdLpcDwLp1627cuGG328mQer0eE1q9enVbWxulWRBCFGh9"
+    b"/foVP0lra2uEIVarVSaTAUBJSQklWpG+xLt371ZXV9fU1DQ0NPj65+bmdDrdyMiIw+GIiYlh"
+    b"sVh8Pj8zM9MXY7PZ2Gy2y+UaHR1du3ZtJNNFROv+/fsKhaKhoaGmpoZw6nS6a9eueb1egUDA"
+    b"4/EYDIbb7Z6amjIajb29vQUFBVKplMViYbDb7RYKhVqt1mazMRiM8LzC/p5v374FgObmZsIz"
+    b"OjpaUFAgl8u/f/9OFtXa2qpQKPyc2dnZTCbT5XKFnTQMreHhYQC4efMm4VGr1fn5+ZOTk2FT"
+    b"I4QWFxclEsn09DThYTKZ+/btWy4tgUCwceNGwmxubpZIJJEQIkSj0WRkZBDmwMAAALx+/Tp6"
+    b"Wo8fPwaA8fFxbHZ3d4vF4qDIrq6ulpaWtra2kZGRwNHp6em9e/cS766uri7s4gk1nJ6eLpVK"
+    b"sb64uCgSiQIxGo1mw4YNf+8gGu3IkSOBMIvF4vF4sO52u/0WKwVaFosFAGZmZrB5+fLlFy9e"
+    b"+GE6OjoAoKioiFhq7e3tKSkpSUlJgQmHhoaGh4exfv78+bS0tGhoyWSyrKwsrM/MzBw+fNgP"
+    b"4PF4AKC2tjYwNikp6cSJE37OgYGBiooKrJtMJlxiKNPatGnTpUuXsH7v3r1nz575ARobG8mW"
+    b"iFqtptPpgbu1oKDg74kBHj58SI2WxWKJj4/XaDTYPH36tNVq9cPs37+/vLycNC9AZ2cn2ShC"
+    b"SCwW5+bmko3+EbTGWq1Wp9OZnp6OTYfDwWQy/TCzs7OJiYkhCvXS0lKIUYFAoNPpyEaD05qf"
+    b"nweApKQkbDqdzpgY/84sJiYGLy8yWbVqVYjRLVu2WK1WarT8HhRvaV8xGo39/f3btm0jy5ua"
+    b"mlpVVRXoN5vNWAn9SwenFRcX52uigON8YmICACorK8ny1tbW6vX6QH9FRQVWFhYWKNPCK2lq"
+    b"aiooSwDYsWMHg8F48uQJWd7bt2+Xl5f7OS0WC4/Hw/rg4CCbzaZGa/369QwGo6enB5vx8fF2"
+    b"u90XkJiYWFRUdPToUa/XGxiuUqkMBgNuAH3l06dPO3fuxHp7e7tQKCSjRVq30tPT5XI51qur"
+    b"qw0GQ9Aq0NPTE+jPzc0tLi4O9BcXF8/PzxOxIbpcUlrXr1+Pi4vDeldX18WLFwMxUqmUzWYv"
+    b"LS35OnF/Njg46AdeXFwkTvqXL1/SaDSz2UyZFq4RQ0ND2MzLy/v586cfxuVyMRgMNps9OzuL"
+    b"Pbj0BzaACCGVStXQ0ID10tJS326HAi2E0O7du4mWTavVlpWVBYXR6XRiCAAqKysDMXNzc0QD"
+    b"4nA48NqKkhbeaEQLderUqXfv3hGj3759UygUKSkpAPDlyxfsVCgUAJCRkdHU1OT7csVisVar"
+    b"xXp9fX2INR2eFkIoNjZWJpMR5q5du/BBKZFIAIDH49XX1//48cM3pLOzkygN3d3dCKGqqqoH"
+    b"Dx7g0aWlJTqdXldXtyxajx49AgCn00kkLSkpOXToEJ1O7+/vDx179epVACgrK7t16xbhxK2p"
+    b"1+tdFi2v15ucnHz27Flfp1Qq5fP5oQMRQvgkfvXq1T/mI2nRqNFCCH348AEATCaTr9NoNIpE"
+    b"ojNnzqjVamJhIYTsdvvnz5/v3Llz8OBBoukjRC6XM5lMt9sddtKIrq98Pp/L5b5//97Pr9Pp"
+    b"uru79Xq92WzG+4vD4aSlpWVnZ+fk5BB3VyyTk5McDqelpaWkpCTsjBF9g8CH7vPnzyMBk4lI"
+    b"JOJyuRGCI/00gnd+tJSQSqUKWvrJJNKZXC4XjUZTKpXR0SIrs6T4yKH4Qvzx40eqnI4dO8Zm"
+    b"symFUHsveXl5qamplEJwd9Tb20spihoth8NBo9HOnTsXeUh8fHzQe3ZoobyKcZkgDrjQUlhY"
+    b"yOFwfv369a/TQgiVlpYymcywMPwAYc+ooBLlnk9ISBAKhSEAY2NjAEA0WFQlSlp9fX0A0NTU"
+    b"RAbYunUrj8eLLjmKmhb6qxH1PRAJUSqVAOD7EfC/o4UQKiwsZLFYQXv5KMrbb6OFEIqNjc3J"
+    b"ySHMmZkZAKiqqlpm2uXSGh8fBwDiXgQAe/bsWWZOtHxaCKE3b94AQEdHh1QqTUhImJub+1/Q"
+    b"QghduHABt0mBn8Gik99DCyF08uRJtVr9u7JF88fdfyB/AsROR8G6/EH9AAAAAElFTkSuQmCC"
+)
```

### Comparing `meerk40t-0.8.3000/meerk40t/gui/imagesplitter.py` & `meerk40t-0.8.4000/meerk40t/gui/imagesplitter.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/keymap.py` & `meerk40t-0.8.4000/meerk40t/gui/keymap.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/laserpanel.py` & `meerk40t-0.8.4000/meerk40t/gui/laserpanel.py`

 * *Files 8% similar despite different names*

```diff
@@ -18,24 +18,16 @@
 
 _ = wx.GetTranslation
 
 
 def register_panel_laser(window, context):
     laser_panel = LaserPanel(window, wx.ID_ANY, context=context)
     plan_panel = JobPanel(window, wx.ID_ANY, context=context)
-    from copy import copy
 
-    prechoices = context.lookup("choices/optimize")
-    choices = list(map(copy, prechoices))
-    # Clear the page-entry
-    for entry in choices:
-        entry["page"] = ""
-    optimize_panel = ChoicePropertyPanel(
-        window, wx.ID_ANY, context=context, choices=choices
-    )
+    optimize_panel = OptimizePanel(window, wx.ID_ANY, context=context)
     jog_drag = wx.Panel(window, wx.ID_ANY)
     jog_panel = Jog(jog_drag, wx.ID_ANY, context=context, icon_size=25)
     drag_panel = Drag(jog_drag, wx.ID_ANY, context=context, icon_size=25)
     main_sizer = wx.BoxSizer(wx.HORIZONTAL)
     main_sizer.AddStretchSpacer()
     main_sizer.Add(jog_panel, 0, wx.ALIGN_CENTER_VERTICAL, 0)
     main_sizer.AddSpacer(25)
@@ -53,23 +45,23 @@
         | wx.aui.AUI_NB_TAB_MOVE
         | wx.aui.AUI_NB_BOTTOM,
     )
     pane = (
         aui.AuiPaneInfo()
         .Left()
         .MinSize(200, 180)
-        .FloatingSize(230, 300)
-        .MaxSize(500, 300)
+        .BestSize(300, 270)
+        .FloatingSize(300, 270)
         .Caption(_("Laser-Control"))
         .CaptionVisible(not context.pane_lock)
         .Name("laser")
     )
     pane.submenu = "_10_" + _("Laser")
     pane.control = notebook
-    pane.dock_proportion = 150
+    pane.dock_proportion = 270
     notebook.AddPage(laser_panel, _("Laser"))
     notebook.AddPage(plan_panel, _("Plan"))
     notebook.AddPage(optimize_panel, _("Optimize"))
     notebook.AddPage(jog_drag, _("Jog"))
     notebook.AddPage(move_panel, _("Move"))
 
     window.on_pane_create(pane)
@@ -172,17 +164,19 @@
         sizer_control_misc.Add(self.button_simulate, 1, 0, 0)
 
         sizer_control_update = wx.BoxSizer(wx.HORIZONTAL)
         sizer_main.Add(sizer_control_update, 0, wx.EXPAND, 0)
 
         sizer_source = wx.BoxSizer(wx.HORIZONTAL)
         sizer_main.Add(sizer_source, 0, wx.EXPAND, 0)
+
+        self._optimize = True
         self.checkbox_optimize = wx.CheckBox(self, wx.ID_ANY, _("Optimize"))
         self.checkbox_optimize.SetToolTip(_("Enable/Disable Optimize"))
-        self.checkbox_optimize.SetValue(1)
+        self.checkbox_optimize.SetValue(self._optimize)
         self.checkbox_adjust = wx.CheckBox(self, wx.ID_ANY, _("Override"))
         self.checkbox_adjust.SetToolTip(
             _("Allow ad-hoc adjustment of speed and power.")
             + "\n"
             + _("This affects running jobs, so use with care!")
         )
 
@@ -235,14 +229,15 @@
         self.Bind(wx.EVT_BUTTON, self.on_button_outline, self.button_outline)
         self.button_outline.Bind(wx.EVT_RIGHT_DOWN, self.on_button_outline_right)
         self.Bind(wx.EVT_BUTTON, self.on_button_simulate, self.button_simulate)
         self.Bind(wx.EVT_COMBOBOX, self.on_combo_devices, self.combo_devices)
         self.Bind(wx.EVT_CHECKBOX, self.on_check_adjust, self.checkbox_adjust)
         self.Bind(wx.EVT_SLIDER, self.on_slider_speed, self.slider_speed)
         self.Bind(wx.EVT_SLIDER, self.on_slider_power, self.slider_power)
+        self.Bind(wx.EVT_CHECKBOX, self.on_optimize, self.checkbox_optimize)
         # end wxGlade
         if index == -1:
             disable_window(self)
         self.checkbox_adjust.SetValue(False)
         self.on_check_adjust(None)
         self.update_override_controls()
 
@@ -321,14 +316,30 @@
         newvalue = sliderval - half  # -> -9 to +10
         factor = 1 + newvalue / half
         if event is not None:
             self.context.device.driver.set_power_scale(factor)
         msg = f"{'+' if factor > 1 else ''}{100 * (factor - 1.0):.0f}%"
         self.label_power.SetLabel(msg)
 
+    def on_optimize(self, event):
+        newval = bool(self.checkbox_optimize.GetValue())
+        if newval != self._optimize:
+            self.context.signal("optimize", newval)
+
+    @signal_listener("optimize")
+    def optimize_update(self, origin, *message):
+        try:
+            newvalue = bool(message[0])
+        except ValueError:
+            # You never know
+            return
+        if self._optimize != newvalue:
+            self._optimize = newvalue
+            self.checkbox_optimize.SetValue(newvalue)
+
     @signal_listener("device;modified")
     @signal_listener("device;renamed")
     @lookup_listener("service/device/active")
     @lookup_listener("service/device/available")
     def spooler_lookup(self, *args):
         # Devices Initialize.
         self.available_devices = self.context.kernel.services("device")
@@ -403,54 +414,59 @@
                 self.on_menu_arm_disable,
                 menu.Append(wx.ID_ANY, _("Disable Arm Requirement"), _("Disable Arm")),
             )
         self.PopupMenu(menu)
         menu.Destroy()
 
     def on_button_start(self, event):  # wxGlade: LaserPanel.<event_handler>
+        busy = self.context.kernel.busyinfo
+        busy.start(msg=_("Preparing Laserjob..."))
         plan = self.context.planner.get_or_make_plan("z")
         if plan.plan and self.context.laserpane_hold:
             self.context("planz spool\n")
         else:
             if self.checkbox_optimize.GetValue():
                 self.context(
                     "planz clear copy preprocess validate blob preopt optimize spool\n"
                 )
             else:
                 self.context("planz clear copy preprocess validate blob spool\n")
         self.arm_toggle.SetValue(False)
         self.check_laser_arm()
         if self.context.auto_spooler:
             self.context("window open JobSpooler\n")
+        busy.end()
 
     def on_button_pause(self, event):  # wxGlade: LaserPanel.<event_handler>
         self.context("pause\n")
 
     def on_button_stop(self, event):  # wxGlade: LaserPanel.<event_handler>
         self.context("estop\n")
 
     def on_button_outline(self, event):  # wxGlade: LaserPanel.<event_handler>
         self.context("element* trace hull\n")
 
     def on_button_outline_right(self, event):  # wxGlade: LaserPanel.<event_handler>
         self.context("element* trace complex\n")
 
     def on_button_simulate(self, event):  # wxGlade: LaserPanel.<event_handler>
-        with wx.BusyInfo(_("Preparing simulation...")):
-            plan = self.context.planner.get_or_make_plan("z")
-            if not plan.plan or not self.context.laserpane_hold:
-                if self.checkbox_optimize.GetValue():
-                    self.context(
-                        "planz clear copy preprocess validate blob preopt optimize\n"
-                    )
-                    param = "1"
-                else:
-                    self.context("planz clear copy preprocess validate blob\n")
-                    param = "0"
-            self.context(f"window open Simulation z 0 {param}\n")
+        self.context.kernel.busyinfo.start(msg=_("Preparing simulation..."))
+
+        plan = self.context.planner.get_or_make_plan("z")
+        if not plan.plan or not self.context.laserpane_hold:
+            if self.checkbox_optimize.GetValue():
+                self.context(
+                    "planz clear copy preprocess validate blob preopt optimize\n"
+                )
+                param = "1"
+            else:
+                self.context("planz clear copy preprocess validate blob\n")
+                param = "0"
+        self.context(f"window open Simulation z 0 {param}\n")
+        self.context.kernel.busyinfo.end()
 
     def on_combo_devices(self, event):  # wxGlade: LaserPanel.<event_handler>
         index = self.combo_devices.GetSelection()
         self.selected_device = self.available_devices[index]
         self.selected_device.kernel.activate_service_path(
             "device", self.selected_device.path
         )
@@ -468,14 +484,15 @@
     def __init__(self, *args, context=None, **kwds):
         # begin wxGlade: MovePanel.__init__
         kwds["style"] = kwds.get("style", 0) | wx.TAB_TRAVERSAL
         wx.Panel.__init__(self, *args, **kwds)
         self.context = context
 
         sizer_main = wx.BoxSizer(wx.VERTICAL)
+        self._optimize = True
 
         sizer_control_update = wx.BoxSizer(wx.HORIZONTAL)
         sizer_main.Add(sizer_control_update, 0, wx.EXPAND, 0)
 
         self.button_clear = wx.Button(self, wx.ID_ANY, _("Clear"))
         self.button_clear.SetToolTip(_("Clear locally defined plan"))
         self.button_clear.SetBitmap(icons8_delete_50.GetBitmap(resize=25))
@@ -522,14 +539,23 @@
         if plan_name == "z":
             plan = self.context.planner.get_or_make_plan("z")
             if not len(plan.plan):
                 self.text_plan.SetValue(_("--- Empty ---"))
             else:
                 self.text_plan.SetValue(f"{str(stage)}: {str(plan)}")
 
+    @signal_listener("optimize")
+    def optimize_update(self, origin, *message):
+        try:
+            newvalue = bool(message[0])
+        except ValueError:
+            # You never know
+            return
+        self._optimize = newvalue
+
     def on_button_save(self, event):  # wxGlade: LaserPanel.<event_handler>
         gui = self.context.gui
         extension = "txt"
         if hasattr(self.context.device, "extension"):
             extension = self.context.device.extension
         filetype = f"*.{extension}"
         with wx.FileDialog(
@@ -551,23 +577,85 @@
     def on_button_load(self, event):  # wxGlade: LaserPanel.<event_handler>
         pass
 
     def on_button_clear(self, event):  # wxGlade: LaserPanel.<event_handler>
         self.context("planz clear\n")
 
     def on_button_update(self, event):  # wxGlade: LaserPanel.<event_handler>
-        with wx.BusyInfo(_("Updating Plan...")):
-            if self.checkbox_optimize.GetValue():
-                self.context(
-                    "planz clear copy preprocess validate blob preopt optimize\n"
-                )
-            else:
-                self.context("planz clear copy preprocess validate blob\n")
+        self.context.kernel.busyinfo.start(msg=_("Updating Plan..."))
+        if self._optimize:
+            self.context("planz clear copy preprocess validate blob preopt optimize\n")
+        else:
+            self.context("planz clear copy preprocess validate blob\n")
+        self.context.kernel.busyinfo.end()
 
     def on_check_hold(self, event):
         self.context.laserpane_hold = self.checkbox_hold.GetValue()
 
     def pane_show(self, *args):
         self.button_save_file.Enable(hasattr(self.context.device, "extension"))
 
     def pane_hide(self, *args):
         pass
+
+
+class OptimizePanel(wx.Panel):
+    """
+    Contains all elements to adjust optimisation
+    """
+
+    def __init__(self, *args, context=None, **kwds):
+        # begin wxGlade: MovePanel.__init__
+        from copy import copy
+
+        self.parent = args[0]
+
+        kwds["style"] = kwds.get("style", 0) | wx.TAB_TRAVERSAL
+        wx.Panel.__init__(self, *args, **kwds)
+        self.context = context
+
+        sizer_main = wx.BoxSizer(wx.VERTICAL)
+        self._optimize = True
+        self.checkbox_optimize = wx.CheckBox(self, wx.ID_ANY, _("Optimize"))
+        self.checkbox_optimize.SetToolTip(_("Enable/Disable Optimize"))
+        self.checkbox_optimize.SetValue(self._optimize)
+        prechoices = context.lookup("choices/optimize")
+        choices = list(map(copy, prechoices))
+        # Clear the page-entry
+        for entry in choices:
+            entry["page"] = ""
+        self.optimize_panel = ChoicePropertyPanel(
+            self, wx.ID_ANY, context=context, choices=choices
+        )
+
+        sizer_main.Add(self.checkbox_optimize, 0, 0, 0)
+        sizer_main.Add(self.optimize_panel, 1, wx.EXPAND, 0)
+        self.SetSizer(sizer_main)
+        self.Layout()
+
+        self.Bind(wx.EVT_CHECKBOX, self.on_optimize, self.checkbox_optimize)
+        self.parent.add_module_delegate(self.optimize_panel)
+
+    @signal_listener("optimize")
+    def optimize_update(self, origin, *message):
+        try:
+            newvalue = bool(message[0])
+        except ValueError:
+            # You never know
+            return
+        if self._optimize != newvalue:
+            self._optimize = newvalue
+            self.checkbox_optimize.SetValue(newvalue)
+            self.optimize_panel.Enable(newvalue)
+
+    def on_optimize(self, event):
+        newvalue = bool(self.checkbox_optimize.GetValue())
+        if newvalue != self._optimize:
+            self._optimize = newvalue
+            self.context.signal("optimize", newvalue)
+            self.optimize_panel.Enable(newvalue)
+
+    def pane_show(self, *args):
+        pass
+
+    def pane_hide(self, *args):
+        pass
```

### Comparing `meerk40t-0.8.3000/meerk40t/gui/laserrender.py` & `meerk40t-0.8.4000/meerk40t/gui/laserrender.py`

 * *Files 4% similar despite different names*

```diff
@@ -1,14 +1,14 @@
 from copy import copy
 from math import ceil, isnan, sqrt
 
 import wx
 from PIL import Image
 
-from meerk40t.core.elements.element_types import elem_nodes
+from meerk40t.core.elements.element_types import elem_nodes, place_nodes
 from meerk40t.core.node.node import Fillrule, Linecap, Linejoin, Node
 from meerk40t.svgelements import (
     Arc,
     Close,
     Color,
     CubicBezier,
     Line,
@@ -202,14 +202,15 @@
                 nodes = [e for e in nodes if e.type not in path_elements]
             if draw_mode & DRAW_MODE_IMAGE:  # Do not draw images.
                 nodes = [e for e in nodes if e.type != "elem image"]
             if draw_mode & DRAW_MODE_TEXT:  # Do not draw text.
                 nodes = [e for e in nodes if e.type != "elem text"]
             if draw_mode & DRAW_MODE_REGMARKS:  # Do not draw regmarked items.
                 nodes = [e for e in nodes if e._parent.type != "branch reg"]
+                nodes = [e for e in nodes if not e.type in place_nodes]
         _nodes = list(nodes)
         variable_translation = draw_mode & DRAW_MODE_VARIABLES
         nodecopy = [e for e in _nodes]
         self.validate_text_nodes(nodecopy, variable_translation)
 
         for node in _nodes:
             if node.type == "reference":
@@ -231,14 +232,16 @@
                     node.draw = self.draw_vector
                     node.make_cache = self.cache_path
                 elif node.type == "elem geomstr":
                     node.draw = self.draw_vector
                     node.make_cache = self.cache_geomstr
                 elif node.type == "elem point":
                     node.draw = self.draw_point_node
+                elif node.type in place_nodes:
+                    node.draw = self.draw_placement_node
                 elif node.type in (
                     "elem rect",
                     "elem line",
                     "elem polyline",
                     "elem ellipse",
                 ):
                     node.draw = self.draw_vector
@@ -589,14 +592,26 @@
     def draw_vector(self, node, gc, draw_mode, zoomscale=1.0, alpha=255):
         """
         Draw routine for vector objects.
 
         Vector objects are expected to have a make_cache routine which attaches a `_cache_matrix` and a `_cache`
         attribute to them which can be drawn as a GraphicsPath.
         """
+        if hasattr(node, "mktext"):
+            newtext = self.context.elements.wordlist_translate(
+                node.mktext, elemnode=node, increment=False
+            )
+            oldtext = getattr(node, "_translated_text", "")
+            if newtext != oldtext:
+                node._translated_text = newtext
+                kernel = self.context.elements.kernel
+                for property_op in kernel.lookup_all("path_updater/.*"):
+                    property_op(kernel.root, node)
+                if hasattr(node, "_cache"):
+                    node._cache = None
         matrix = node.matrix
         gc.PushState()
         try:
             cache = node._cache
         except AttributeError:
             cache = None
         if cache is None:
@@ -631,14 +646,112 @@
         self.set_brush(gc, node.fill, alpha=alpha)
         if draw_mode & DRAW_MODE_FILLS == 0 and node.fill is not None:
             gc.FillPath(node._cache, fillStyle=self._get_fillstyle(node))
         if draw_mode & DRAW_MODE_STROKES == 0 and node.stroke is not None:
             gc.StrokePath(node._cache)
         gc.PopState()
 
+    def draw_placement_node(self, node, gc, draw_mode, zoomscale=1.0, alpha=255):
+        """Default draw routine for the placement operation."""
+        if node.type == "place current":
+            # no idea how to draw yet...
+            return
+        gc.PushState()
+        matrix = Matrix()
+        if node.rotation is not None and node.rotation != 0:
+            matrix.post_rotate(node.rotation, node.x, node.y)
+            gc.ConcatTransform(wx.GraphicsContext.CreateMatrix(gc, ZMatrix(matrix)))
+        # First x
+        dif = 20 * zoomscale
+        x_from = node.x
+        y_from = node.y
+        if node.corner == 0:
+            # Top Left
+            x_to = x_from + dif
+            y_to = y_from + dif
+            x_sign = 1
+            y_sign = 1
+        elif node.corner == 1:
+            # Top Right
+            x_to = x_from - dif
+            y_to = y_from + dif
+            x_sign = -1
+            y_sign = 1
+        elif node.corner == 2:
+            # Bottom Right
+            x_to = x_from - dif
+            y_to = y_from - dif
+            x_sign = -1
+            y_sign = -1
+        elif node.corner == 3:
+            # Bottom Left
+            x_to = x_from + dif
+            y_to = y_from - dif
+            x_sign = 1
+            y_sign = -1
+        else:
+            # Center
+            x_from -= dif
+            y_from -= dif
+            x_to = x_from + 2 * dif
+            y_to = y_from + 2 * dif
+            x_sign = 1
+            y_sign = 1
+        rpen = wx.Pen(wx.Colour(red=255, green=0, blue=0, alpha=alpha))
+        gpen = wx.Pen(wx.Colour(red=0, green=255, blue=0, alpha=alpha))
+        gc.SetPen(rpen)
+        dif = 5 * zoomscale
+        gc.StrokeLine(x_from, node.y, x_to, node.y)
+        gc.StrokeLine(x_to - x_sign * dif, node.y - y_sign * dif, x_to, node.y)
+        gc.StrokeLine(x_to - x_sign * dif, node.y + y_sign * dif, x_to, node.y)
+        gc.SetPen(gpen)
+        gc.StrokeLine(node.x, y_from, node.x, y_to)
+        gc.StrokeLine(node.x - x_sign * dif, y_to - y_sign * dif, node.x, y_to)
+        gc.StrokeLine(node.x + x_sign * dif, y_to - y_sign * dif, node.x, y_to)
+
+        loops = 1
+        if hasattr(node, "loops") and node.loops is not None:
+            # No zero or negative values please
+            loops = max(1, node.loops)
+        if loops > 1:
+            symbol = f"{loops}x"
+            matrix = gc.GetTransform().Get()
+            try:
+                font_size = 10.0 / matrix[0]
+            except ZeroDivisionError:
+                font_size = 5000
+            # print (font_size)
+            if font_size < 1.0:
+                font_size = 1.0
+            try:
+                font = wx.Font(
+                    font_size,
+                    wx.FONTFAMILY_SWISS,
+                    wx.FONTSTYLE_NORMAL,
+                    wx.FONTWEIGHT_NORMAL,
+                )
+            except TypeError:
+                font = wx.Font(
+                    int(font_size),
+                    wx.FONTFAMILY_SWISS,
+                    wx.FONTSTYLE_NORMAL,
+                    wx.FONTWEIGHT_NORMAL,
+                )
+            gc.SetFont(font, wx.Colour(red=255, green=0, blue=0, alpha=alpha))
+            (t_width, t_height) = gc.GetTextExtent(symbol)
+            x = (x_from + x_to) / 2 - t_width / 2
+            y = (y_from + y_to) / 2 - t_height / 2
+            # is corner center then shift it a bit more
+            if node.corner == 4:
+                x += 0.25 * (x_to - x_from)
+                y += 0.25 * (y_to - y_from)
+            gc.DrawText(symbol, x, y)
+
+        gc.PopState()
+
     def draw_point_node(self, node, gc, draw_mode, zoomscale=1.0, alpha=255):
         """Default draw routine for the laser path element."""
         if draw_mode & DRAW_MODE_POINTS:
             return
         point = node.point
         if point is None:
             return
@@ -689,15 +802,17 @@
             fill_color = wx.BLACK
         else:
             fill_color = as_wx_color(node.fill)
         gc.SetFont(font, fill_color)
 
         if draw_mode & DRAW_MODE_VARIABLES:
             # Only if flag show the translated values
-            text = self.context.elements.wordlist_translate(text, elemnode=node)
+            text = self.context.elements.wordlist_translate(
+                text, elemnode=node, increment=False
+            )
         if node.texttransform is not None:
             ttf = node.texttransform.lower()
             if ttf == "capitalize":
                 text = text.capitalize()
             elif ttf == "uppercase":
                 text = text.upper()
             if ttf == "lowercase":
```

### Comparing `meerk40t-0.8.3000/meerk40t/gui/lasertoolpanel.py` & `meerk40t-0.8.4000/meerk40t/gui/lasertoolpanel.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/materialtest.py` & `meerk40t-0.8.4000/meerk40t/gui/materialtest.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/mkdebug.py` & `meerk40t-0.8.4000/meerk40t/gui/mkdebug.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/mwindow.py` & `meerk40t-0.8.4000/meerk40t/gui/mwindow.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/navigationpanels.py` & `meerk40t-0.8.4000/meerk40t/gui/navigationpanels.py`

 * *Files 2% similar despite different names*

```diff
@@ -39,14 +39,15 @@
     icons8_square_border_50,
     icons8_up_50,
     icons8_up_left_50,
     icons8_up_right_50,
     icons8up,
 )
 from meerk40t.gui.mwindow import MWindow
+from meerk40t.gui.position import PositionPanel
 from meerk40t.gui.wxutils import StaticBoxSizer, TextCtrl
 from meerk40t.kernel.kernel import signal_listener
 from meerk40t.svgelements import Angle
 
 _ = wx.GetTranslation
 
 
@@ -83,14 +84,15 @@
         .Right()
         .MinSize(3 * iconsize + dx, 3 * iconsize + dy)
         .BestSize(3 * iconsize + dx, 3 * iconsize + dy)
         .FloatingSize(3 * iconsize + dx, 3 * iconsize + dy)
         .MaxSize(300, 300)
         .Caption(_("Jog"))
         .Name("jog")
+        .Hide()
         .CaptionVisible(not context.pane_lock)
     )
     pane.dock_proportion = 3 * iconsize + dx
     pane.control = panel
     pane.submenu = "_20_" + _("Navigation")
 
     window.on_pane_create(pane)
@@ -103,14 +105,15 @@
         .MinSize(iconsize + 100, iconsize + 25)
         .BestSize(iconsize + 100, iconsize + 25)
         .FloatingSize(iconsize + 100, iconsize + 25)
         .MaxSize(200, 100)
         .Caption(_("Move"))
         .CaptionVisible(not context.pane_lock)
         .Name("move")
+        .Hide()
     )
     pane.dock_proportion = iconsize + 100
     pane.control = panel
     pane.submenu = "_20_" + _("Navigation")
 
     window.on_pane_create(pane)
     context.register("pane/move", pane)
@@ -129,31 +132,31 @@
     pane.dock_proportion = iconsize + 60
     pane.control = panel
     pane.submenu = "_20_" + _("Navigation")
 
     window.on_pane_create(pane)
     context.register("pane/pulse", pane)
 
-    panel = SizePanel(window, wx.ID_ANY, context=context)
-    pane = (
-        aui.AuiPaneInfo()
-        .Right()
-        .MinSize(75, 50)
-        .FloatingSize(150, 75)
-        .Hide()
-        .Caption(_("Element-Size"))
-        .CaptionVisible(not context.pane_lock)
-        .Name("objsizer")
-    )
-    pane.dock_proportion = 150
-    pane.control = panel
-    pane.submenu = "_40_" + _("Editing")
+    # panel = PositionPanel(window, wx.ID_ANY, context=context, small=False)
+    # pane = (
+    #     aui.AuiPaneInfo()
+    #     .Right()
+    #     .MinSize(75, 50)
+    #     .FloatingSize(150, 75)
+    #     .Hide()
+    #     .Caption(_("Element-Size"))
+    #     .CaptionVisible(not context.pane_lock)
+    #     .Name("objsizer")
+    # )
+    # pane.dock_proportion = 150
+    # pane.control = panel
+    # pane.submenu = "_40_" + _("Editing")
 
-    window.on_pane_create(pane)
-    context.register("pane/objsizer", pane)
+    # window.on_pane_create(pane)
+    # context.register("pane/objsizer", pane)
 
     if platform.system() == "Windows":
         dx = 24
         dy = 30
     else:
         dx = 12
         dy = 12
@@ -1240,258 +1243,258 @@
         value = self.spin_pulse_duration.GetValue()
         self.context(f"pulse {value}\n")
 
     def on_spin_pulse_duration(self, event=None):  # wxGlade: Navigation.<event_handler>
         self.context.navigate_pulse = float(self.spin_pulse_duration.GetValue())
 
 
-class SizePanel(wx.Panel):
-    object_ratio = None
-    object_x = None
-    object_y = None
-    object_width = None
-    object_height = None
-
-    def __init__(self, *args, context=None, **kwds):
-        # begin wxGlade: SizePanel.__init__
-        kwds["style"] = kwds.get("style", 0) | wx.TAB_TRAVERSAL
-        wx.Panel.__init__(self, *args, **kwds)
-        self.context = context
-
-        self.mainsizer = StaticBoxSizer(
-            self, wx.ID_ANY, _("Object Dimensions"), wx.HORIZONTAL
-        )
-        self.button_navigate_resize = wx.BitmapButton(
-            self, wx.ID_ANY, icons8_compress_50.GetBitmap(resize=32)
-        )
-        self.label_9 = wx.StaticText(self, wx.ID_ANY, _("Width:"))
-        self.label_10 = wx.StaticText(self, wx.ID_ANY, _("Height:"))
-
-        self.text_width = TextCtrl(
-            self,
-            wx.ID_ANY,
-            style=wx.TE_PROCESS_ENTER,
-            value="0",
-            check="length",
-            nonzero=True,
-        )
-        self.text_height = TextCtrl(
-            self,
-            wx.ID_ANY,
-            style=wx.TE_PROCESS_ENTER,
-            value="0",
-            check="length",
-            nonzero=True,
-        )
-        self.btn_lock_ratio = wx.ToggleButton(self, wx.ID_ANY, "")
-        self.bitmap_locked = icons8_lock_50.GetBitmap(resize=25, use_theme=False)
-        self.bitmap_unlocked = icons8_padlock_50.GetBitmap(resize=25, use_theme=False)
-
-        # No change of fields during input
-        # self.text_height.execute_action_on_change = False
-        # self.text_width.execute_action_on_change = False
-        self._updating = False
-        self.__set_properties()
-        self.__do_layout()
-
-        self.Bind(
-            wx.EVT_BUTTON, self.on_button_navigate_resize, self.button_navigate_resize
-        )
-        self.btn_lock_ratio.Bind(wx.EVT_TOGGLEBUTTON, self.on_toggle_ratio)
-        self.text_width.SetActionRoutine(self.on_textenter_width)
-        self.text_height.SetActionRoutine(self.on_textenter_height)
-
-    def __set_properties(self):
-        # begin wxGlade: SizePanel.__set_properties
-        self.button_navigate_resize.SetToolTip(_("Resize the object"))
-        self.button_navigate_resize.SetSize(self.button_navigate_resize.GetBestSize())
-        self.text_width.SetToolTip(_("Define width of selected object"))
-        self.text_height.SetToolTip(_("Define height of selected object"))
-        self.btn_lock_ratio.SetMinSize((32, 32))
-        self.btn_lock_ratio.SetToolTip(
-            _("Lock the ratio of width / height to the original values")
-        )
-        # Set toggle bitmap
-        self.on_toggle_ratio(None)
-        self.text_height.Enable(False)
-        self.text_width.Enable(False)
-        self.button_navigate_resize.Enable(False)
-
-        # end wxGlade
-
-    def __do_layout(self):
-        # begin wxGlade: SizePanel.__do_layout
-        self.mainsizer.Add(self.button_navigate_resize, 0, wx.ALIGN_CENTER_VERTICAL, 0)
-        sizer_label = wx.BoxSizer(wx.VERTICAL)
-        fieldsizer1 = wx.BoxSizer(wx.HORIZONTAL)
-        fieldsizer2 = wx.BoxSizer(wx.HORIZONTAL)
-        self.label_9.SetMinSize(wx.Size(45, -1))
-        self.label_10.SetMinSize(wx.Size(45, -1))
-        fieldsizer1.Add(self.label_9, 0, wx.ALIGN_CENTER_VERTICAL, 0)
-        fieldsizer1.Add(self.text_width, 1, wx.EXPAND, 0)
-
-        fieldsizer2.Add(self.label_10, 0, wx.ALIGN_CENTER_VERTICAL, 0)
-        fieldsizer2.Add(self.text_height, 1, wx.EXPAND, 0)
-
-        sizer_label.Add(fieldsizer1, 0, wx.EXPAND, 0)
-        sizer_label.Add(fieldsizer2, 0, wx.EXPAND, 0)
-
-        self.mainsizer.Add(sizer_label, 1, wx.ALIGN_CENTER_VERTICAL, 0)
-        self.mainsizer.Add(self.btn_lock_ratio, 0, wx.ALIGN_CENTER_VERTICAL, 0)
-
-        self.SetSizer(self.mainsizer)
-        self.mainsizer.Fit(self)
-
-        self.Layout()
-        # end wxGlade
-
-    def pane_show(self, *args):
-        self.context.listen("emphasized", self.on_emphasized_elements_changed)
-        self.context.listen("modified", self.on_modified_element)
-        self.update_sizes()
-
-    def pane_hide(self, *args):
-        self.context.unlisten("emphasized", self.on_emphasized_elements_changed)
-        self.context.unlisten("modified", self.on_modified_element)
-
-    def on_modified_element(self, origin, *args):
-        self.update_sizes()
-
-    def on_emphasized_elements_changed(self, origin, elements):
-        self.update_sizes()
-
-    def on_toggle_ratio(self, event):
-        if self.btn_lock_ratio.GetValue():
-            self.btn_lock_ratio.SetBitmap(self.bitmap_locked)
-        else:
-            self.btn_lock_ratio.SetBitmap(self.bitmap_unlocked)
-
-    def update_sizes(self):
-        self.object_x = None
-        self.object_y = None
-        self.object_width = None
-        self.object_height = None
-        self.object_ratio = None
-        bbox = self.context.elements.selected_area()
-        if bbox is not None:
-            p = self.context
-            units = p.units_name
-            try:
-                self.object_x = bbox[0]
-                self.object_y = bbox[1]
-                self.object_width = bbox[2] - bbox[0]
-                self.object_height = bbox[3] - bbox[1]
-                try:
-                    self.object_ratio = self.object_width / self.object_height
-                except ZeroDivisionError:
-                    self.object_ratio = 0
-            except (ValueError, AttributeError, TypeError):
-                pass
-
-        if self.object_width is not None:
-            self.text_width.SetValue(
-                Length(
-                    self.object_width, preferred_units=units, digits=3
-                ).preferred_length
-            )
-            self.text_width.Enable(True)
-        else:
-            self.text_width.SetValue("---")
-            self.text_width.Enable(False)
-        if self.object_height is not None:
-            self.text_height.SetValue(
-                Length(
-                    self.object_height, preferred_units=units, digits=3
-                ).preferred_length
-            )
-            self.text_height.Enable(True)
-
-        else:
-            self.text_height.SetValue("---")
-            self.text_height.Enable(False)
-        if self.object_ratio is not None:
-            self.button_navigate_resize.Enable(True)
-        else:
-            self.button_navigate_resize.Enable(False)
-
-    def on_button_navigate_resize(self, event):
-        new_width = Length(
-            self.text_width.GetValue(), relative_length=self.object_width
-        )
-        new_w = float(new_width)
-        new_height = Length(
-            self.text_height.GetValue(), relative_length=self.object_height
-        )
-        new_h = float(new_height)
-        if (
-            abs(new_h - self.object_height) < 1.0e-6
-            and abs(new_w - self.object_width) < 1.0e-6
-        ):
-            # No change
-            return
-        if new_w == 0 or new_h == 0:
-            return
-        self.context(f"resize {self.object_x} {self.object_y} {new_width} {new_height}")
-        self.update_sizes()
-
-    def on_textenter_width(self):
-        if self._updating:
-            return
-        needsupdate = False
-        try:
-            p = self.context
-            units = p.units_name
-            new_width = Length(
-                self.text_width.GetValue(),
-                relative_length=self.object_width,
-                preferred_units=units,
-                digits=3,
-            )
-            new_w = float(new_width)
-            if new_w != self.object_width:
-                needsupdate = True
-        except ValueError:
-            pass
-        if not needsupdate:
-            return
-        self._updating = True
-        if self.btn_lock_ratio.GetValue():
-            new_h = new_w * (1.0 / self.object_ratio)
-            new_height = Length(new_h, preferred_units=units, digits=3)
-            self.text_height.SetValue(new_height.preferred_length)
-        self._updating = False
-        self.on_button_navigate_resize(None)
-
-    def on_textenter_height(self):
-        if self._updating:
-            return
-        needsupdate = False
-        try:
-            p = self.context
-            units = p.units_name
-            new_height = Length(
-                self.text_height.GetValue(),
-                relative_length=self.object_height,
-                preferred_units=units,
-                digits=3,
-            )
-            new_h = float(new_height)
-            if new_h != self.object_height:
-                needsupdate = True
-        except ValueError:
-            pass
-        if not needsupdate:
-            return
-        self._updating = True
-        if self.btn_lock_ratio.GetValue():
-            new_w = new_h * (1.0 / self.object_ratio)
-            new_width = Length(new_w, preferred_units=units, digits=3)
-            self.text_width.SetValue(new_width.preferred_length)
-        self._updating = False
-        self.on_button_navigate_resize(None)
+# class SizePanel(wx.Panel):
+#     object_ratio = None
+#     object_x = None
+#     object_y = None
+#     object_width = None
+#     object_height = None
+
+#     def __init__(self, *args, context=None, **kwds):
+#         # begin wxGlade: SizePanel.__init__
+#         kwds["style"] = kwds.get("style", 0) | wx.TAB_TRAVERSAL
+#         wx.Panel.__init__(self, *args, **kwds)
+#         self.context = context
+
+#         self.mainsizer = StaticBoxSizer(
+#             self, wx.ID_ANY, _("Object Dimensions"), wx.HORIZONTAL
+#         )
+#         self.button_navigate_resize = wx.BitmapButton(
+#             self, wx.ID_ANY, icons8_compress_50.GetBitmap(resize=32)
+#         )
+#         self.label_9 = wx.StaticText(self, wx.ID_ANY, _("Width:"))
+#         self.label_10 = wx.StaticText(self, wx.ID_ANY, _("Height:"))
+
+#         self.text_width = TextCtrl(
+#             self,
+#             wx.ID_ANY,
+#             style=wx.TE_PROCESS_ENTER,
+#             value="0",
+#             check="length",
+#             nonzero=True,
+#         )
+#         self.text_height = TextCtrl(
+#             self,
+#             wx.ID_ANY,
+#             style=wx.TE_PROCESS_ENTER,
+#             value="0",
+#             check="length",
+#             nonzero=True,
+#         )
+#         self.btn_lock_ratio = wx.ToggleButton(self, wx.ID_ANY, "")
+#         self.bitmap_locked = icons8_lock_50.GetBitmap(resize=25, use_theme=False)
+#         self.bitmap_unlocked = icons8_padlock_50.GetBitmap(resize=25, use_theme=False)
+
+#         # No change of fields during input
+#         # self.text_height.execute_action_on_change = False
+#         # self.text_width.execute_action_on_change = False
+#         self._updating = False
+#         self.__set_properties()
+#         self.__do_layout()
+
+#         self.Bind(
+#             wx.EVT_BUTTON, self.on_button_navigate_resize, self.button_navigate_resize
+#         )
+#         self.btn_lock_ratio.Bind(wx.EVT_TOGGLEBUTTON, self.on_toggle_ratio)
+#         self.text_width.SetActionRoutine(self.on_textenter_width)
+#         self.text_height.SetActionRoutine(self.on_textenter_height)
+
+#     def __set_properties(self):
+#         # begin wxGlade: SizePanel.__set_properties
+#         self.button_navigate_resize.SetToolTip(_("Resize the object"))
+#         self.button_navigate_resize.SetSize(self.button_navigate_resize.GetBestSize())
+#         self.text_width.SetToolTip(_("Define width of selected object"))
+#         self.text_height.SetToolTip(_("Define height of selected object"))
+#         self.btn_lock_ratio.SetMinSize((32, 32))
+#         self.btn_lock_ratio.SetToolTip(
+#             _("Lock the ratio of width / height to the original values")
+#         )
+#         # Set toggle bitmap
+#         self.on_toggle_ratio(None)
+#         self.text_height.Enable(False)
+#         self.text_width.Enable(False)
+#         self.button_navigate_resize.Enable(False)
+
+#         # end wxGlade
+
+#     def __do_layout(self):
+#         # begin wxGlade: SizePanel.__do_layout
+#         self.mainsizer.Add(self.button_navigate_resize, 0, wx.ALIGN_CENTER_VERTICAL, 0)
+#         sizer_label = wx.BoxSizer(wx.VERTICAL)
+#         fieldsizer1 = wx.BoxSizer(wx.HORIZONTAL)
+#         fieldsizer2 = wx.BoxSizer(wx.HORIZONTAL)
+#         self.label_9.SetMinSize(wx.Size(45, -1))
+#         self.label_10.SetMinSize(wx.Size(45, -1))
+#         fieldsizer1.Add(self.label_9, 0, wx.ALIGN_CENTER_VERTICAL, 0)
+#         fieldsizer1.Add(self.text_width, 1, wx.EXPAND, 0)
+
+#         fieldsizer2.Add(self.label_10, 0, wx.ALIGN_CENTER_VERTICAL, 0)
+#         fieldsizer2.Add(self.text_height, 1, wx.EXPAND, 0)
+
+#         sizer_label.Add(fieldsizer1, 0, wx.EXPAND, 0)
+#         sizer_label.Add(fieldsizer2, 0, wx.EXPAND, 0)
+
+#         self.mainsizer.Add(sizer_label, 1, wx.ALIGN_CENTER_VERTICAL, 0)
+#         self.mainsizer.Add(self.btn_lock_ratio, 0, wx.ALIGN_CENTER_VERTICAL, 0)
+
+#         self.SetSizer(self.mainsizer)
+#         self.mainsizer.Fit(self)
+
+#         self.Layout()
+#         # end wxGlade
+
+#     def pane_show(self, *args):
+#         self.context.listen("emphasized", self.on_emphasized_elements_changed)
+#         self.context.listen("modified", self.on_modified_element)
+#         self.update_sizes()
+
+#     def pane_hide(self, *args):
+#         self.context.unlisten("emphasized", self.on_emphasized_elements_changed)
+#         self.context.unlisten("modified", self.on_modified_element)
+
+#     def on_modified_element(self, origin, *args):
+#         self.update_sizes()
+
+#     def on_emphasized_elements_changed(self, origin, elements):
+#         self.update_sizes()
+
+#     def on_toggle_ratio(self, event):
+#         if self.btn_lock_ratio.GetValue():
+#             self.btn_lock_ratio.SetBitmap(self.bitmap_locked)
+#         else:
+#             self.btn_lock_ratio.SetBitmap(self.bitmap_unlocked)
+
+#     def update_sizes(self):
+#         self.object_x = None
+#         self.object_y = None
+#         self.object_width = None
+#         self.object_height = None
+#         self.object_ratio = None
+#         bbox = self.context.elements.selected_area()
+#         if bbox is not None:
+#             p = self.context
+#             units = p.units_name
+#             try:
+#                 self.object_x = bbox[0]
+#                 self.object_y = bbox[1]
+#                 self.object_width = bbox[2] - bbox[0]
+#                 self.object_height = bbox[3] - bbox[1]
+#                 try:
+#                     self.object_ratio = self.object_width / self.object_height
+#                 except ZeroDivisionError:
+#                     self.object_ratio = 0
+#             except (ValueError, AttributeError, TypeError):
+#                 pass
+
+#         if self.object_width is not None:
+#             self.text_width.SetValue(
+#                 Length(
+#                     self.object_width, preferred_units=units, digits=3
+#                 ).preferred_length
+#             )
+#             self.text_width.Enable(True)
+#         else:
+#             self.text_width.SetValue("---")
+#             self.text_width.Enable(False)
+#         if self.object_height is not None:
+#             self.text_height.SetValue(
+#                 Length(
+#                     self.object_height, preferred_units=units, digits=3
+#                 ).preferred_length
+#             )
+#             self.text_height.Enable(True)
+
+#         else:
+#             self.text_height.SetValue("---")
+#             self.text_height.Enable(False)
+#         if self.object_ratio is not None:
+#             self.button_navigate_resize.Enable(True)
+#         else:
+#             self.button_navigate_resize.Enable(False)
+
+#     def on_button_navigate_resize(self, event):
+#         new_width = Length(
+#             self.text_width.GetValue(), relative_length=self.object_width
+#         )
+#         new_w = float(new_width)
+#         new_height = Length(
+#             self.text_height.GetValue(), relative_length=self.object_height
+#         )
+#         new_h = float(new_height)
+#         if (
+#             abs(new_h - self.object_height) < 1.0e-6
+#             and abs(new_w - self.object_width) < 1.0e-6
+#         ):
+#             # No change
+#             return
+#         if new_w == 0 or new_h == 0:
+#             return
+#         self.context(f"resize {self.object_x} {self.object_y} {new_width} {new_height}")
+#         self.update_sizes()
+
+#     def on_textenter_width(self):
+#         if self._updating:
+#             return
+#         needsupdate = False
+#         try:
+#             p = self.context
+#             units = p.units_name
+#             new_width = Length(
+#                 self.text_width.GetValue(),
+#                 relative_length=self.object_width,
+#                 preferred_units=units,
+#                 digits=3,
+#             )
+#             new_w = float(new_width)
+#             if new_w != self.object_width:
+#                 needsupdate = True
+#         except ValueError:
+#             pass
+#         if not needsupdate:
+#             return
+#         self._updating = True
+#         if self.btn_lock_ratio.GetValue():
+#             new_h = new_w * (1.0 / self.object_ratio)
+#             new_height = Length(new_h, preferred_units=units, digits=3)
+#             self.text_height.SetValue(new_height.preferred_length)
+#         self._updating = False
+#         self.on_button_navigate_resize(None)
+
+#     def on_textenter_height(self):
+#         if self._updating:
+#             return
+#         needsupdate = False
+#         try:
+#             p = self.context
+#             units = p.units_name
+#             new_height = Length(
+#                 self.text_height.GetValue(),
+#                 relative_length=self.object_height,
+#                 preferred_units=units,
+#                 digits=3,
+#             )
+#             new_h = float(new_height)
+#             if new_h != self.object_height:
+#                 needsupdate = True
+#         except ValueError:
+#             pass
+#         if not needsupdate:
+#             return
+#         self._updating = True
+#         if self.btn_lock_ratio.GetValue():
+#             new_w = new_h * (1.0 / self.object_ratio)
+#             new_width = Length(new_w, preferred_units=units, digits=3)
+#             self.text_width.SetValue(new_width.preferred_length)
+#         self._updating = False
+#         self.on_button_navigate_resize(None)
 
 
 class Transform(wx.Panel):
     def __init__(self, *args, context=None, **kwds):
         # begin wxGlade: Transform.__init__
         kwds["style"] = kwds.get("style", 0) | wx.TAB_TRAVERSAL
         wx.Panel.__init__(self, *args, **kwds)
@@ -2040,15 +2043,15 @@
 
         short_pulse = PulsePanel(self, wx.ID_ANY, context=self.context)
         pulse_and_move_sizer.Add(short_pulse, 1, wx.EXPAND, 0)
 
         move_panel = MovePanel(self, wx.ID_ANY, context=self.context)
         pulse_and_move_sizer.Add(move_panel, 1, wx.EXPAND, 0)
 
-        size_panel = SizePanel(self, wx.ID_ANY, context=self.context)
+        size_panel = PositionPanel(self, wx.ID_ANY, context=self.context, small=True)
         pulse_and_move_sizer.Add(size_panel, 1, wx.EXPAND, 0)
 
         main_sizer.Add(pulse_and_move_sizer, 0, wx.EXPAND, 0)
         self.SetSizer(main_sizer)
         self.Layout()
         self.panels = [
             jogdistancepanel,
```

### Comparing `meerk40t-0.8.3000/meerk40t/gui/notes.py` & `meerk40t-0.8.4000/meerk40t/gui/notes.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/opassignment.py` & `meerk40t-0.8.4000/meerk40t/gui/opassignment.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/operation_info.py` & `meerk40t-0.8.4000/meerk40t/gui/operation_info.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/plugin.py` & `meerk40t-0.8.4000/meerk40t/gui/plugin.py`

 * *Files 0% similar despite different names*

```diff
@@ -170,15 +170,15 @@
                 "section": "General",
             },
             {
                 "attr": "disable_tree_tool_tips",
                 "object": kernel.root,
                 "default": False,
                 "type": bool,
-                "label": _("Disable Element-ToolTips"),
+                "label": _("Disable tooltips over tree"),
                 "tip": _(
                     "You can suppress the tooltips over operations and elements in the tree"
                 ),
                 "page": "Gui",
                 "section": "General",
             },
         ]
```

### Comparing `meerk40t-0.8.3000/meerk40t/gui/position.py` & `meerk40t-0.8.4000/meerk40t/gui/position.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,13 +1,13 @@
 import wx
 from wx import aui
 
 from meerk40t.core.elements.element_types import elem_nodes
 from meerk40t.core.units import UNITS_PER_PIXEL, Length
-from meerk40t.gui.icons import icons8_up_left_50
+from meerk40t.gui.icons import icons8_compress_50
 from meerk40t.gui.wxutils import StaticBoxSizer, TextCtrl
 
 _ = wx.GetTranslation
 
 
 def register_panel_position(window, context):
     pane = (
@@ -24,19 +24,20 @@
     pane.control = PositionPanel(window, wx.ID_ANY, context=context)
     pane.submenu = "_40_" + _("Editing")
     window.on_pane_create(pane)
     context.register("pane/position", pane)
 
 
 class PositionPanel(wx.Panel):
-    def __init__(self, *args, context=None, **kwds):
+    def __init__(self, *args, context=None, small=False, **kwds):
         # begin wxGlade: PositionPanel.__init__
         kwds["style"] = kwds.get("style", 0) | wx.TAB_TRAVERSAL
         wx.Panel.__init__(self, *args, **kwds)
         self.context = context
+        self.small = small
         self.text_x = TextCtrl(
             self, wx.ID_ANY, "", check="float", style=wx.TE_PROCESS_ENTER
         )
         self.text_y = TextCtrl(
             self, wx.ID_ANY, "", check="float", style=wx.TE_PROCESS_ENTER
         )
         self.text_w = TextCtrl(
@@ -57,16 +58,21 @@
         )
         self.text_x.SetMinSize((70, 23))
         self.text_y.SetMinSize((70, 23))
         self.text_w.SetMinSize((70, 23))
         self.text_h.SetMinSize((70, 23))
         self.chk_indivdually = wx.CheckBox(self, wx.ID_ANY, _("Individ."))
         self.chk_lock = wx.CheckBox(self, wx.ID_ANY, _("Keep ratio"))
+        if self.small:
+            resize_param = 32
+        else:
+            resize_param = None
+
         self.button_execute = wx.BitmapButton(
-            self, wx.ID_ANY, icons8_up_left_50.GetBitmap()
+            self, wx.ID_ANY, icons8_compress_50.GetBitmap(resize=resize_param)
         )
         self.choices = ["mm", "cm", "inch", "mil", "%"]
         self.combo_box_units = wx.ComboBox(
             self,
             wx.ID_ANY,
             choices=self.choices,
             style=wx.CB_DROPDOWN | wx.CB_READONLY,
@@ -98,14 +104,15 @@
         self.position_w = 0.0
         self.org_x = None
         self.org_y = None
         self.org_w = None
         self.org_h = None
         self.context.setting(str, "units_name", "mm")
         self.position_units = self.context.units_name
+
         if self.position_units in ("in", "inches"):
             self.position_units = "inch"
         self._update_position()
 
     def pane_show(self, *args):
         self.context.listen("units", self.space_changed)
         self.context.listen("emphasized", self._update_position)
@@ -142,46 +149,64 @@
         self.button_execute.SetSize(self.button_execute.GetBestSize())
         self.combo_box_units.SetSelection(0)
         # end wxGlade
 
     def __do_layout(self):
         # begin wxGlade: PositionPanel.__do_layout
         sizer_main = wx.BoxSizer(wx.VERTICAL)
+        if self.small:
+            target = StaticBoxSizer(
+                self, wx.ID_ANY, _("Object Dimensions"), wx.VERTICAL
+            )
+            sizer_main.Add(target, 1, wx.EXPAND, 0)
+        else:
+            target = sizer_main
         sizer_h = StaticBoxSizer(self, wx.ID_ANY, _("Height:"), wx.HORIZONTAL)
         sizer_w = StaticBoxSizer(self, wx.ID_ANY, _("Width:"), wx.HORIZONTAL)
         sizer_y = StaticBoxSizer(self, wx.ID_ANY, "Y:", wx.HORIZONTAL)
         sizer_x = StaticBoxSizer(self, wx.ID_ANY, "X:", wx.HORIZONTAL)
 
         sizer_x.Add(self.text_x, 1, wx.EXPAND, 0)
         sizer_y.Add(self.text_y, 1, wx.EXPAND, 0)
         sizer_w.Add(self.text_w, 1, wx.EXPAND, 0)
         sizer_h.Add(self.text_h, 1, wx.EXPAND, 0)
 
-        sizer_h_xy = wx.BoxSizer(wx.HORIZONTAL)
-        sizer_h_xy.Add(sizer_x, 1, wx.EXPAND, 0)
-        sizer_h_xy.Add(sizer_y, 1, wx.EXPAND, 0)
-
-        sizer_h_wh = wx.BoxSizer(wx.HORIZONTAL)
-        sizer_h_wh.Add(sizer_w, 1, wx.EXPAND, 0)
-        sizer_h_wh.Add(sizer_h, 1, wx.EXPAND, 0)
+        self.sizer_h_xy = wx.BoxSizer(wx.HORIZONTAL)
+        self.sizer_h_xy.Add(sizer_x, 1, wx.EXPAND, 0)
+        self.sizer_h_xy.Add(sizer_y, 1, wx.EXPAND, 0)
+
+        self.sizer_h_wh = wx.BoxSizer(wx.HORIZONTAL)
+        self.sizer_h_wh.Add(sizer_w, 1, wx.EXPAND, 0)
+        self.sizer_h_wh.Add(sizer_h, 1, wx.EXPAND, 0)
 
         sizer_v_xywh = wx.BoxSizer(wx.VERTICAL)
-        sizer_v_xywh.Add(sizer_h_xy, 0, wx.EXPAND, 0)
-        sizer_v_xywh.Add(sizer_h_wh, 0, wx.EXPAND, 0)
+        sizer_v_xywh.Add(self.sizer_h_xy, 0, wx.EXPAND, 0)
+        sizer_v_xywh.Add(self.sizer_h_wh, 0, wx.EXPAND, 0)
 
         sizer_h_all = wx.BoxSizer(wx.HORIZONTAL)
         sizer_h_all.Add(self.button_execute, 0, 0, 0)
         sizer_h_all.Add(sizer_v_xywh, 1, wx.EXPAND, 0)
-        sizer_main.Add(sizer_h_all, 0, wx.EXPAND, 0)
+        target.Add(sizer_h_all, 0, wx.EXPAND, 0)
 
         sizer_h_options = wx.BoxSizer(wx.HORIZONTAL)
         sizer_h_options.Add(self.chk_indivdually, 1, wx.ALIGN_CENTER_VERTICAL, 0)
         sizer_h_options.Add(self.chk_lock, 1, wx.ALIGN_CENTER_VERTICAL, 0)
         sizer_h_options.Add(self.combo_box_units, 0, wx.ALIGN_CENTER_VERTICAL, 0)
-        sizer_main.Add(sizer_h_options, 0, wx.EXPAND, 0)
+        target.Add(sizer_h_options, 0, wx.EXPAND, 0)
+
+        # Only show x + y if required.
+        show_wh = True
+        show_xy = not self.small
+        show_indiv = not self.small
+
+        self.sizer_h_wh.Show(show_wh)
+        self.sizer_h_wh.ShowItems(show_wh)
+        self.sizer_h_xy.Show(show_xy)
+        self.sizer_h_xy.ShowItems(show_xy)
+        self.chk_indivdually.Show(show_indiv)
 
         self.SetSizer(sizer_main)
         sizer_main.Fit(self)
         self.Layout()
         # end wxGlade
 
     def _update_position(self, *args):
```

### Comparing `meerk40t-0.8.3000/meerk40t/gui/preferences.py` & `meerk40t-0.8.4000/meerk40t/gui/preferences.py`

 * *Files 2% similar despite different names*

```diff
@@ -524,14 +524,29 @@
         self.panel_color.SetupScrolling()
 
         self.notebook_main.AddPage(self.panel_main, _("General"))
         self.notebook_main.AddPage(self.panel_classification, _("Classification"))
         self.notebook_main.AddPage(self.panel_gui, _("GUI"))
         self.notebook_main.AddPage(self.panel_scene, _("Scene"))
         self.notebook_main.AddPage(self.panel_color, _("Colors"))
+
+        self.panels = [
+            self.panel_main,
+            self.panel_classification,
+            self.panel_gui,
+            self.panel_scene,
+            self.panel_color,
+        ]
+        self.context.setting(bool, "developer_mode", False)
+        if self.context.developer_mode:
+            panel_space = ChoicePropertyPanel(
+                self, wx.ID_ANY, context=self.context, choices="space"
+            )
+            self.notebook_main.AddPage(panel_space, _("Coordinate Space"))
+            self.panels.append(panel_space)
         self.Layout()
 
         _icon = wx.NullIcon
         _icon.CopyFromBitmap(icons8_administrative_tools_50.GetBitmap())
         self.SetIcon(_icon)
         self.SetTitle(_("Preferences"))
 
@@ -570,19 +585,20 @@
         if value:
             # We are setting presets for a couple of parameters
             for preset in self.presets:
                 setattr(preset[0], preset[1], preset[2])
                 self.context.signal(preset[1], preset[2], preset[0])
 
     def delegates(self):
-        yield self.panel_main
-        yield self.panel_classification
-        yield self.panel_gui
-        yield self.panel_scene
-        yield self.panel_color
+        yield from self.panels
+        # yield self.panel_main
+        # yield self.panel_classification
+        # yield self.panel_gui
+        # yield self.panel_scene
+        # yield self.panel_color
 
     @staticmethod
     def sub_register(kernel):
         import platform
 
         if platform.system() != "Darwin":
             kernel.register(
```

### Comparing `meerk40t-0.8.3000/meerk40t/gui/propertypanels/attributes.py` & `meerk40t-0.8.4000/meerk40t/gui/propertypanels/attributes.py`

 * *Files 1% similar despite different names*

```diff
@@ -285,25 +285,34 @@
                 res = str(value)
             return res
 
         self.node = node
         # print(f"set_widget for {self.attribute} to {str(node)}")
         vis1 = False
         vis2 = False
-        if hasattr(self.node, "id") and self.showid:
-            vis1 = True
-            self.text_id.SetValue(mklabel(node.id))
-        self.text_id.Show(vis1)
-        self.sizer_id.Show(vis1)
-
-        if hasattr(self.node, "label") and self.showlabel:
-            vis2 = True
-            self.text_label.SetValue(mklabel(node.label))
-        self.text_label.Show(vis2)
-        self.sizer_label.Show(vis2)
+        try:
+            if hasattr(self.node, "id") and self.showid:
+                vis1 = True
+                self.text_id.SetValue(mklabel(node.id))
+            self.text_id.Show(vis1)
+            self.sizer_id.Show(vis1)
+        except RuntimeWarning:
+            # Could happen if the propertypanel
+            # would have been destroyed already
+            pass
+        try:
+            if hasattr(self.node, "label") and self.showlabel:
+                vis2 = True
+                self.text_label.SetValue(mklabel(node.label))
+            self.text_label.Show(vis2)
+            self.sizer_label.Show(vis2)
+        except RuntimeWarning:
+            # Could happen if the propertypanel
+            # would have been destroyed already
+            pass
 
         if vis1 or vis2:
             self.Show()
         else:
             self.Hide()
 
 
@@ -722,19 +731,16 @@
             bb = None
 
         if bb is None:
             # Bounds was genuinely none, or node threw an error.
             self._set_widgets_hidden()
             return
 
-        en_xy = (
-            not getattr(self.node, "lock", False)
-            or self.context.elements.lock_allows_move
-        )
-        en_wh = not getattr(self.node, "lock", False)
+        en_xy = self.node.can_move(self.context.elements.lock_allows_move)
+        en_wh = self.node.can_scale
         x = bb[0]
         y = bb[1]
         w = bb[2] - bb[0]
         h = bb[3] - bb[1]
         units = self.context.units_name
         if units in ("inch", "inches"):
             units = "in"
@@ -755,18 +761,15 @@
         self.text_y.Enable(en_xy)
         self.text_w.Enable(en_wh)
         self.text_h.Enable(en_wh)
         self.show_hide_wh(node.type != "elem point")
         self.Show()
 
     def translate_it(self):
-        if (
-            getattr(self.node, "lock", False)
-            and not self.context.elements.lock_allows_move
-        ):
+        if not self.node.can_move(self.context.elements.lock_allows_move):
             return
         bb = self.node.bounds
         try:
             newx = float(Length(self.text_x.GetValue()))
             newy = float(Length(self.text_y.GetValue()))
         except (ValueError, AttributeError):
             return
@@ -775,15 +778,15 @@
         if dx != 0 or dy != 0:
             self.node.matrix.post_translate(dx, dy)
             # self.node.modified()
             self.node.translated(dx, dy)
             self.context.elements.signal("element_property_update", self.node)
 
     def scale_it(self, was_width):
-        if getattr(self.node, "lock", False):
+        if not self.node.can_scale:
             return
         bb = self.node.bounds
         keep_ratio = self.btn_lock_ratio.GetValue()
         try:
             neww = float(Length(self.text_w.GetValue()))
             newh = float(Length(self.text_h.GetValue()))
         except (ValueError, AttributeError):
```

### Comparing `meerk40t-0.8.3000/meerk40t/gui/propertypanels/blobproperty.py` & `meerk40t-0.8.4000/meerk40t/gui/propertypanels/blobproperty.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/propertypanels/consoleproperty.py` & `meerk40t-0.8.4000/meerk40t/gui/propertypanels/consoleproperty.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/propertypanels/groupproperties.py` & `meerk40t-0.8.4000/meerk40t/gui/toolwidgets/toolmeasure.py`

 * *Files 25% similar despite different names*

```diff
@@ -1,217 +1,208 @@
-import os
-import time
+from math import atan, cos, sin, sqrt, tau
 
 import wx
 
-from meerk40t.gui.wxutils import ScrolledPanel
-
-# from ...svgelements import SVG_ATTR_ID
-from ..icons import icons8_group_objects_50
-from ..mwindow import MWindow
-from ..wxutils import StaticBoxSizer
-from .attributes import IdPanel
+from meerk40t.core.units import Length
+from meerk40t.gui.scene.sceneconst import (
+    RESPONSE_ABORT,
+    RESPONSE_CHAIN,
+    RESPONSE_CONSUME,
+)
+from meerk40t.gui.toolwidgets.toolwidget import ToolWidget
 
 _ = wx.GetTranslation
 
 
-class ElemcountPanel(wx.Panel):
-    def __init__(
-        self, *args, context=None, node=None, showid=True, showlabel=True, **kwds
+class MeasureTool(ToolWidget):
+    """
+    Measuring Tool.
+
+    Works like polygon but displays lengths at each side
+    and after 3 points the covered area as well
+    """
+
+    def __init__(self, scene):
+        ToolWidget.__init__(self, scene)
+        self.start_position = None
+        self.point_series = []
+        self.length_series = []
+        self.mouse_position = None
+        self.scene = scene
+        self.line_pen = wx.Pen()
+        self.line_pen.SetColour(self.scene.colors.color_measure_line)
+        self.line_pen.SetStyle(wx.PENSTYLE_DOT)
+        self.line_pen.SetWidth(1000)
+
+    def process_draw(self, gc):
+        matrix = gc.GetTransform().Get()
+        if self.point_series:
+            try:
+                self.font_size = 10.0 / matrix[0]
+            except ZeroDivisionError:
+                self.font_size = 5000
+                return
+            # print ("Fontsize=%.3f, " % self.font_size)
+            if self.font_size < 1.0:
+                self.font_size = 1.0  # Mac does not allow values lower than 1.
+            try:
+                font = wx.Font(
+                    self.font_size,
+                    wx.FONTFAMILY_SWISS,
+                    wx.FONTSTYLE_NORMAL,
+                    wx.FONTWEIGHT_BOLD,
+                )
+            except TypeError:
+                font = wx.Font(
+                    int(self.font_size),
+                    wx.FONTFAMILY_SWISS,
+                    wx.FONTSTYLE_NORMAL,
+                    wx.FONTWEIGHT_BOLD,
+                )
+            gc.SetFont(font, self.scene.colors.color_measure_text)
+
+            gc.SetPen(self.line_pen)
+            gc.SetBrush(wx.TRANSPARENT_BRUSH)
+            points = list(self.point_series)
+            if self.mouse_position is not None:
+                points.append(self.mouse_position)
+            all_cx = 0
+            all_cy = 0
+            area_x_y = 0
+            area_y_x = 0
+            # https://www.wikihow.com/Calculate-the-Area-of-a-Polygon
+            idx = -1
+            last_x = 0
+            last_y = 0
+            for pt in points:
+                idx += 1
+                # print("%d, %.1f, %.1f" % (idx, pt[0],pt[1]))
+                all_cx += pt[0]
+                all_cy += pt[1]
+                if idx > 0:
+                    area_x_y += last_x * pt[1]
+                    area_y_x += last_y * pt[0]
+                last_x = pt[0]
+                last_y = pt[1]
+
+            # Complete calculation of area by closing the loop
+            area_x_y += last_x * points[0][1]
+            area_y_x += last_y * points[0][0]
+            area = 0.5 * abs(area_x_y - area_y_x)
+
+            points.append(points[0])
+            first_point = None
+
+            context = self.scene.context
+            units = context.units_name
+
+            pt_count = 0
+            perimeter = 0
+            for pt in points:
+                pt_count += 1
+                if first_point is not None:
+                    dx = pt[0] - first_point[0]
+                    dy = pt[1] - first_point[1]
+                    if dx == 0:
+                        slope = 0
+                        slope_angle = tau / 4
+                    else:
+                        slope = dy / dx
+                        slope_angle = -1 * atan(slope)
+                    dlen = sqrt(dx * dx + dy * dy)
+                    cx = (pt[0] + first_point[0]) / 2
+                    cy = (pt[1] + first_point[1]) / 2
+
+                    perimeter += dlen
+
+                    s_txt = str(Length(amount=dlen, digits=2, preferred_units=units))
+                    (t_width, t_height) = gc.GetTextExtent(s_txt)
+
+                    tcx = cx - cos(slope_angle) * t_width / 2
+                    tcy = cy + sin(slope_angle) * t_width / 2
+                    dx = tcx - cx
+                    dy = tcy - dy
+                    gc.DrawText(s_txt, tcx, tcy, slope_angle)
+                first_point = pt
+
+            if pt_count > 3:
+                # remove last point, as this one coincides with the first...
+                pt_count -= 1
+                all_cx = all_cx / pt_count
+                all_cy = all_cy / pt_count
+                # area is in base units^2, so back to units
+
+                base_square = float(Length(f"1{units}"))
+                base_square *= base_square
+                area = area / base_square
+                s_area = _("Area")
+                s_perim = _("Perimeter")
+                s_txt = (
+                    f"{s_area}={area:.1f}{units}²\n{s_perim}: "
+                    f"{str(Length(amount=perimeter, digits=1, preferred_units=units))}"
+                )
+                t_width, t_height = gc.GetTextExtent(s_txt)
+                gc.DrawText(
+                    s_txt,
+                    all_cx - 0.5 * t_width,
+                    all_cy - 0.5 * t_height,
+                )
+
+            # Draw lines at last to make them more visible
+            gc.DrawLines(points)
+
+    def event(
+        self,
+        window_pos=None,
+        space_pos=None,
+        event_type=None,
+        nearest_snap=None,
+        modifiers=None,
+        **kwargs,
     ):
-        # begin wxGlade: LayerSettingPanel.__init__
-        kwds["style"] = kwds.get("style", 0)
-        wx.Panel.__init__(self, *args, **kwds)
-        self.context = context
-        self.node = node
-        # Shall we display id / label?
-        self.text_elements = wx.TextCtrl(self, id=wx.ID_ANY, style=wx.TE_READONLY)
-
-        main_sizer = wx.BoxSizer(wx.VERTICAL)
-        self.sizer_id = StaticBoxSizer(self, wx.ID_ANY, _("Elements:"), wx.VERTICAL)
-        self.sizer_id.Add(self.text_elements, 1, wx.EXPAND, 0)
-        main_sizer.Add(self.sizer_id, 0, wx.EXPAND, 0)
-
-        self.SetSizer(main_sizer)
-        self.Layout()
-        self.set_widgets(self.node)
-
-    def pane_hide(self):
-        pass
-
-    def pane_show(self):
-        pass
-
-    def set_widgets(self, node):
-        def elem_count(enode):
-            res = 0
-            for e in enode.children:
-                res += 1
-                if e.type in ("file", "group"):
-                    res += elem_count(e)
-            return res
-
-        self.node = node
-        count = elem_count(self.node)
-        self.text_elements.SetValue(_("{count} elements").format(count=count))
-
-
-class GroupPropertiesPanel(ScrolledPanel):
-    def __init__(self, *args, context=None, node=None, **kwds):
-        kwds["style"] = kwds.get("style", 0) | wx.TAB_TRAVERSAL
-        wx.Panel.__init__(self, *args, **kwds)
-        self.context = context
-
-        self.node = node
-        self.panel_id = IdPanel(self, id=wx.ID_ANY, context=self.context, node=node)
-        self.panel_ct = ElemcountPanel(
-            self, id=wx.ID_ANY, context=self.context, node=node
-        )
-
-        self.__set_properties()
-        self.__do_layout()
-
-        # end wxGlade
-
-    def __set_properties(self):
-        pass
-
-    def __do_layout(self):
-        # begin wxGlade: GroupProperty.__do_layout
-        sizer_main = wx.BoxSizer(wx.VERTICAL)
-        sizer_main.Add(self.panel_id, 0, wx.EXPAND, 0)
-        sizer_main.Add(self.panel_ct, 0, wx.EXPAND, 0)
-        self.SetSizer(sizer_main)
-        self.Layout()
-        self.Centre()
-        # end wxGlade
-
-    def set_widgets(self, node):
-        self.panel_id.set_widgets(node)
-        self.panel_ct.set_widgets(node)
-        self.node = node
-
-
-class GroupProperty(MWindow):
-    def __init__(self, *args, node=None, **kwds):
-        super().__init__(372, 141, *args, **kwds)
-
-        self.panel = GroupPropertiesPanel(
-            self, wx.ID_ANY, context=self.context, node=node
-        )
-        self.add_module_delegate(self.panel)
-        _icon = wx.NullIcon
-        _icon.CopyFromBitmap(icons8_group_objects_50.GetBitmap())
-        self.SetIcon(_icon)
-        self.SetTitle(_("Group Properties"))
-
-    def restore(self, *args, node=None, **kwds):
-        self.panel.set_widgets(node)
-
-    def window_preserve(self):
-        return False
-
-    def window_menu(self):
-        return False
-
-
-class FilePropertiesPanel(ScrolledPanel):
-    def __init__(self, *args, context=None, node=None, **kwds):
-        kwds["style"] = kwds.get("style", 0) | wx.TAB_TRAVERSAL
-        wx.Panel.__init__(self, *args, **kwds)
-        self.context = context
-
-        self.node = node
-        self.text_filename = wx.TextCtrl(self, id=wx.ID_ANY, style=wx.TE_READONLY)
-        self.text_path = wx.TextCtrl(self, id=wx.ID_ANY, style=wx.TE_READONLY)
-        self.text_datetime = wx.TextCtrl(self, id=wx.ID_ANY, style=wx.TE_READONLY)
-        self.text_size = wx.TextCtrl(self, id=wx.ID_ANY, style=wx.TE_READONLY)
-        self.panel_ct = ElemcountPanel(
-            self, id=wx.ID_ANY, context=self.context, node=node
-        )
-        self.__set_properties()
-        self.__do_layout()
-
-        # end wxGlade
-
-    def __set_properties(self):
-        pass
-
-    def __do_layout(self):
-        # begin wxGlade: GroupProperty.__do_layout
-        sizer_main = wx.BoxSizer(wx.VERTICAL)
-        sizer1 = StaticBoxSizer(self, wx.ID_ANY, _("Filename:"), wx.HORIZONTAL)
-        sizer1.Add(self.text_filename, 1, wx.EXPAND, 0)
-        sizer2 = StaticBoxSizer(self, wx.ID_ANY, _("Path:"), wx.HORIZONTAL)
-        sizer2.Add(self.text_path, 1, wx.EXPAND, 0)
-        sizer3 = StaticBoxSizer(self, wx.ID_ANY, _("Size:"), wx.HORIZONTAL)
-        sizer3.Add(self.text_size, 1, wx.EXPAND, 0)
-        sizer4 = StaticBoxSizer(self, wx.ID_ANY, _("Date:"), wx.HORIZONTAL)
-        sizer4.Add(self.text_datetime, 1, wx.EXPAND, 0)
-        sizer_main.Add(sizer1, 0, wx.EXPAND, 0)
-        sizer_main.Add(sizer2, 0, wx.EXPAND, 0)
-        sizer_main.Add(sizer3, 0, wx.EXPAND, 0)
-        sizer_main.Add(sizer4, 0, wx.EXPAND, 0)
-        sizer_main.Add(self.panel_ct, 0, wx.EXPAND, 0)
-        self.SetSizer(sizer_main)
-        self.Layout()
-        self.Centre()
-        # end wxGlade
-
-    def set_widgets(self, node):
-        self.node = node
-        self.panel_ct.set_widgets(node)
-        if self.node is None:
-            text1 = ""
-            text2 = ""
-            text3 = ""
-            text4 = ""
-        else:
-            fname = self.node.filepath
-            if fname is not None:
-                try:
-                    text1 = os.path.basename(fname)
-                    text2 = os.path.dirname(fname)
-                except (PermissionError, OSError, FileNotFoundError):
-                    text1 = fname
-                    text2 = _("File not found")
-                    fname = None
-            if fname is not None:
-                try:
-                    fsize = os.path.getsize(fname)
-                    ftime = os.path.getctime(fname)
-                    mtime = os.path.getmtime(fname)
-                    c_ti = time.ctime(ftime)
-                    m_ti = time.ctime(mtime)
-                    text3 = f"{fsize:,} bytes"
-                    c1 = _("Created:")
-                    c2 = _("Modified:")
-                    text4 = f"{c1} {c_ti}, {c2} {m_ti}"
-                except (PermissionError, OSError, FileNotFoundError):
-                    pass
-        self.text_filename.SetValue(text1)
-        self.text_path.SetValue(text2)
-        self.text_size.SetValue(text3)
-        self.text_datetime.SetValue(text4)
-
-
-class FileProperty(MWindow):
-    def __init__(self, *args, node=None, **kwds):
-        super().__init__(372, 141, *args, **kwds)
-
-        self.panel = FilePropertiesPanel(
-            self, wx.ID_ANY, context=self.context, node=node
-        )
-        self.add_module_delegate(self.panel)
-        _icon = wx.NullIcon
-        _icon.CopyFromBitmap(icons8_group_objects_50.GetBitmap())
-        self.SetIcon(_icon)
-        self.SetTitle(_("File Properties"))
-
-    def restore(self, *args, node=None, **kwds):
-        self.panel.set_widgets(node)
-
-    def window_preserve(self):
-        return False
-
-    def window_menu(self):
-        return False
+        response = RESPONSE_CHAIN
+        if event_type == "leftclick":
+            if nearest_snap is None:
+                self.point_series.append((space_pos[0], space_pos[1]))
+            else:
+                self.point_series.append((nearest_snap[0], nearest_snap[1]))
+            self.scene.pane.tool_active = True
+            response = RESPONSE_CONSUME
+        elif event_type == "leftdown":
+            self.scene.pane.tool_active = True
+            if nearest_snap is None:
+                self.mouse_position = space_pos[0], space_pos[1]
+            else:
+                self.mouse_position = nearest_snap[0], nearest_snap[1]
+            if self.point_series:
+                self.scene.request_refresh()
+            response = RESPONSE_CONSUME
+        elif event_type in ("leftup", "move", "hover"):
+            if nearest_snap is None:
+                self.mouse_position = space_pos[0], space_pos[1]
+            else:
+                self.mouse_position = nearest_snap[0], nearest_snap[1]
+            if self.point_series:
+                self.scene.request_refresh()
+                response = RESPONSE_CONSUME
+        elif event_type == "rightdown":
+            self.scene.pane.tool_active = False
+            self.point_series = []
+            self.mouse_position = None
+            self.scene.request_refresh()
+            response = RESPONSE_ABORT
+        elif event_type == "doubleclick":
+            self.scene.pane.tool_active = False
+            self.point_series = []
+            self.mouse_position = None
+            self.scene.request_refresh()
+            response = RESPONSE_ABORT
+        elif event_type == "lost" or (event_type == "key_up" and modifiers == "escape"):
+            if self.scene.pane.tool_active:
+                self.scene.pane.tool_active = False
+                self.scene.request_refresh()
+                response = RESPONSE_CONSUME
+            else:
+                response = RESPONSE_CHAIN
+            self.point_series = []
+            self.mouse_position = None
+        return response
```

#### encoding

```diff
@@ -1 +1 @@
-us-ascii
+utf-8
```

### Comparing `meerk40t-0.8.3000/meerk40t/gui/propertypanels/imageproperty.py` & `meerk40t-0.8.4000/meerk40t/gui/propertypanels/imageproperty.py`

 * *Files 1% similar despite different names*

```diff
@@ -74,22 +74,24 @@
         self.Bind(wx.EVT_CHECKBOX, self.on_check_enable_crop, self.check_enable_crop)
         self.Bind(wx.EVT_SLIDER, self.on_slider_left, self.slider_left)
         self.Bind(wx.EVT_SLIDER, self.on_slider_right, self.slider_right)
         self.Bind(wx.EVT_SLIDER, self.on_slider_top, self.slider_top)
         self.Bind(wx.EVT_SLIDER, self.on_slider_bottom, self.slider_bottom)
 
         flag = False
+        self.activate_controls(flag)
+        self.set_widgets(node)
+
+    def activate_controls(self, flag):
         self.button_reset.Enable(flag)
         self.slider_left.Enable(flag)
         self.slider_right.Enable(flag)
         self.slider_top.Enable(flag)
         self.slider_bottom.Enable(flag)
 
-        self.set_widgets(node)
-
     def set_widgets(self, node):
         if self.node is None:
             self.label_info.SetLabel("")
             self.Hide()
             return
         else:
             self.Show()
@@ -111,14 +113,16 @@
             if self._bounds is None:
                 self._bounds = [0, 0, self._width, self._height]
                 self.op["bounds"] = self._bounds
 
         self.set_slider_limits("lrtb", False)
 
         self.check_enable_crop.SetValue(flag)
+        self.activate_controls(flag)
+
         self.cropleft = self._bounds[0]
         self.cropright = self._bounds[2]
         self.croptop = self._bounds[1]
         self.cropbottom = self._bounds[3]
         self._no_update = False
 
     def __set_properties(self):
@@ -210,24 +214,22 @@
                 last = self._no_update
                 self._no_update = True
                 self.cropleft = 0
                 self.cropright = w
                 self.croptop = 0
                 self.cropbottom = h
                 self._no_update = last
+            else:
+                self.op["enable"] = flag
         else:
             if self.op is not None:
                 self.op["enable"] = flag
         if self.op is not None and not self._no_update:
             self.node.update(self.context)
-        self.button_reset.Enable(flag)
-        self.slider_left.Enable(flag)
-        self.slider_right.Enable(flag)
-        self.slider_top.Enable(flag)
-        self.slider_bottom.Enable(flag)
+        self.activate_controls(flag)
 
     def on_slider_left(self, event=None):
         self.cropleft = self.slider_left.GetValue()
 
     def on_slider_right(self, event=None):
         self.cropright = self.slider_right.GetValue()
```

### Comparing `meerk40t-0.8.3000/meerk40t/gui/propertypanels/inputproperty.py` & `meerk40t-0.8.4000/meerk40t/gui/propertypanels/inputproperty.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/propertypanels/opbranchproperties.py` & `meerk40t-0.8.4000/meerk40t/gui/propertypanels/opbranchproperties.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/propertypanels/operationpropertymain.py` & `meerk40t-0.8.4000/meerk40t/gui/propertypanels/operationpropertymain.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/propertypanels/outputproperty.py` & `meerk40t-0.8.4000/meerk40t/gui/propertypanels/outputproperty.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/propertypanels/pathproperty.py` & `meerk40t-0.8.4000/meerk40t/gui/propertypanels/pathproperty.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/propertypanels/pointproperty.py` & `meerk40t-0.8.4000/meerk40t/gui/propertypanels/pointproperty.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/propertypanels/propertywindow.py` & `meerk40t-0.8.4000/meerk40t/gui/propertypanels/propertywindow.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/propertypanels/rasterwizardpanels.py` & `meerk40t-0.8.4000/meerk40t/gui/propertypanels/rasterwizardpanels.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/propertypanels/textproperty.py` & `meerk40t-0.8.4000/meerk40t/gui/propertypanels/textproperty.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/propertypanels/waitproperty.py` & `meerk40t-0.8.4000/meerk40t/gui/propertypanels/waitproperty.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/scene/guicolors.py` & `meerk40t-0.8.4000/meerk40t/gui/scene/guicolors.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/scene/scene.py` & `meerk40t-0.8.4000/meerk40t/gui/scene/scene.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/scene/sceneconst.py` & `meerk40t-0.8.4000/meerk40t/gui/scene/sceneconst.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/scene/scenepanel.py` & `meerk40t-0.8.4000/meerk40t/gui/scene/scenepanel.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/scene/scenespacewidget.py` & `meerk40t-0.8.4000/meerk40t/gui/scene/scenespacewidget.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/scene/widget.py` & `meerk40t-0.8.4000/meerk40t/gui/scene/widget.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/scenewidgets/attractionwidget.py` & `meerk40t-0.8.4000/meerk40t/gui/scenewidgets/attractionwidget.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/scenewidgets/bedwidget.py` & `meerk40t-0.8.4000/meerk40t/gui/scenewidgets/bedwidget.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/scenewidgets/elementswidget.py` & `meerk40t-0.8.4000/meerk40t/gui/scenewidgets/elementswidget.py`

 * *Files 8% similar despite different names*

```diff
@@ -32,21 +32,31 @@
         except ZeroDivisionError:
             matrix.reset()
             zoom_scale = 1
         if zoom_scale < 1:
             zoom_scale = 1
         draw_mode = self.renderer.context.draw_mode
         if (draw_mode & DRAW_MODE_REGMARKS) == 0:
+
+            # Very faint in the background as orientation - alpha 64
             self.renderer.render(
                 context.elements.regmarks_nodes(),
                 gc,
                 draw_mode,
                 zoomscale=zoom_scale,
                 alpha=64,
             )
+            # Slightly more prominent - alpha 96
+            self.renderer.render(
+                context.elements.placement_nodes(),
+                gc,
+                draw_mode,
+                zoomscale=zoom_scale,
+                alpha=96,
+            )
         self.renderer.render(
             context.elements.elems_nodes(),
             gc,
             draw_mode,
             zoomscale=zoom_scale,
         )
         # gc.PushState()
```

### Comparing `meerk40t-0.8.3000/meerk40t/gui/scenewidgets/gridwidget.py` & `meerk40t-0.8.4000/meerk40t/gui/scenewidgets/gridwidget.py`

 * *Files 2% similar despite different names*

```diff
@@ -185,17 +185,16 @@
             y += self.secondary_tick_length_y
         self.secondary_grid_lines = starts2, ends2
 
     def calculate_grid_lines(self):
         """
         Based on the current matrix calculate the grid within the bed-space.
         """
-        d = self.scene.context.device
-        self.zero_x = d.unit_width * d.show_origin_x
-        self.zero_y = d.unit_height * d.show_origin_y
+        d = self.scene.context
+        self.zero_x, self.zero_y = d.space.origin_zero()
         self._calc_primary_grid_lines()
         self._calc_secondary_grid_lines()
 
     ###########################
     # CALCULATE PROPERTIES
     ###########################
 
@@ -245,16 +244,15 @@
         # print("New Delta={delta}".format(delta=delta))
         # points = self.scaled_conversion * float("{:.1g}".format(points / self.scaled_conversion))
 
         self.tick_distance = delta1
 
     def calculate_center_start(self):
         p = self.scene.context
-        self.primary_start_x = p.device.unit_width * p.device.show_origin_x
-        self.primary_start_y = p.device.unit_height * p.device.show_origin_y
+        self.primary_start_x, self.primary_start_y = p.space.origin_zero()
 
         if self.grid_secondary_cx is None:
             self.secondary_start_x = self.primary_start_x
         else:
             self.secondary_start_x = self.grid_secondary_cx
 
         if self.grid_secondary_cy is None:
```

### Comparing `meerk40t-0.8.3000/meerk40t/gui/scenewidgets/guidewidget.py` & `meerk40t-0.8.4000/meerk40t/gui/scenewidgets/guidewidget.py`

 * *Files 2% similar despite different names*

```diff
@@ -140,14 +140,15 @@
                 self.scene.pane.toggle_x_magnet(x)
                 x += tlen
 
             y = 0
             while y <= p.device.unit_height:
                 self.scene.pane.toggle_y_magnet(y)
                 y += tlen
+            self.scene.pane.save_magnets()
         elif self.scene.pane.grid.draw_grid_secondary:
             # Placeholder for a use case, as you can define them manually...
             pass
 
     def _add_scale_options(self, menu):
         def on_user_option(event):
             dlg = wx.TextEntryDialog(
@@ -216,15 +217,17 @@
                 on_regular_option(option),
                 id=item.GetId(),
             )
 
         menu.AppendSeparator()
         item = menu.Append(
             wx.ID_ANY,
-            f"User defined value: {self.scene.pane.grid.tick_distance}{units}",
+            _("User defined value: {value}").format(
+                value=f"{self.scene.pane.grid.tick_distance}{units}"
+            ),
             "",
             wx.ITEM_NORMAL,
         )
         self.scene.context.gui.Bind(
             wx.EVT_MENU,
             on_user_option,
             id=item.GetId(),
@@ -434,23 +437,25 @@
             round(2.0 * mark_point_y / tick_distance_y) * 0.5 * tick_distance_y
         )
         if is_x and is_y:
             if self.scene.pane.has_magnets():
                 self.scene.pane.clear_magnets()
             else:
                 self.fill_magnets()
+            # No need to call save magnets here as both routines already do that
         elif is_x:
             # Get the X coordinate from space_pos [0]
             value = float(Length(f"{mark_point_x:.1f}{self.units}"))
             self.scene.pane.toggle_x_magnet(value)
+            self.scene.pane.save_magnets()
         elif is_y:
             # Get the Y coordinate from space_pos [1]
             value = float(Length(f"{mark_point_y:.1f}{self.units}"))
             self.scene.pane.toggle_y_magnet(value)
-
+            self.scene.pane.save_magnets()
         self.scene.request_refresh()
 
     def event(self, window_pos=None, space_pos=None, event_type=None, **kwargs):
         """
         Capture and deal with the double click event.
         Double-click in the grid loads a menu to remove the background.
         """
@@ -493,25 +498,23 @@
             return RESPONSE_CHAIN
 
     def _get_center_primary(self):
         """
         Calculate center position for primary grid
         """
         p = self.scene.context
-        x = p.device.unit_width * p.device.show_origin_x
-        y = p.device.unit_height * p.device.show_origin_y
+        x, y = p.space.origin_zero()
         return self.scene.convert_scene_to_window([x, y])
 
     def _get_center_secondary(self):
         """
         Calculate center position for secondary grid
         """
         p = self.scene.context
-        x = p.device.unit_width * p.device.show_origin_x
-        y = p.device.unit_height * p.device.show_origin_y
+        x, y = p.space.origin_zero()
         if self.scene.pane.grid.grid_secondary_cx is not None:
             x = self.scene.pane.grid.grid_secondary_cx
 
         if self.scene.pane.grid.grid_secondary_cy is not None:
             y = self.scene.pane.grid.grid_secondary_cy
 
         return self.scene.convert_scene_to_window([x, y])
@@ -539,15 +542,15 @@
         points_x_primary = self.scene.pane.grid.tick_distance * self.scaled_conversion_x
         offset_x_primary = float(sx_primary) % points_x_primary
         x = offset_x_primary
         last_text_pos = x - 30  # Arbitrary
         while x < w:
             if x >= 45:
                 mark_point = (x - sx_primary) / self.scaled_conversion_x
-                if p.device.show_flip_x:
+                if not p.space.right_positive:
                     mark_point *= -1
                 if round(float(mark_point) * 1000) == 0:
                     mark_point = 0.0  # prevents -0
                 starts.append((x, edge_gap))
                 ends.append((x, length + edge_gap))
 
                 starts.append((x, h - edge_gap))
@@ -572,15 +575,15 @@
         points_y_primary = self.scene.pane.grid.tick_distance * self.scaled_conversion_y
         offset_y_primary = float(sy_primary) % points_y_primary
         y = offset_y_primary
         last_text_pos = y - 30  # arbitrary
         while y < h:
             if y >= 20:
                 mark_point = (y - sy_primary) / self.scaled_conversion_y
-                if p.device.show_flip_y:
+                if not p.space.bottom_positive:
                     mark_point *= -1
                 if round(float(mark_point) * 1000) == 0:
                     mark_point = 0.0  # prevents -0
                 starts.append((edge_gap, y))
                 ends.append((length + edge_gap, y))
                 # if there is enough room for a mid-distance stroke...
                 if text_height < 0.5 * points_y_primary:
@@ -631,15 +634,15 @@
         ends = []
         offset_x = float(sx) % points_x
         x = offset_x
         last_text_pos = x - 30
         while x < w:
             if x >= 45:
                 mark_point = (x - sx) / (fx * self.scaled_conversion_x)
-                if p.device.show_flip_x:
+                if not p.space.right_positive:
                     mark_point *= -1
                 if round(float(mark_point) * 1000) == 0:
                     mark_point = 0.0  # prevents -0
                 starts.append((x, edge_gap))
                 ends.append((x, length + edge_gap))
 
                 starts.append((x, h - edge_gap))
@@ -662,15 +665,15 @@
 
         offset_y = float(sy) % points_y
         y = offset_y
         last_text_pos = y - 30
         while y < h:
             if y >= 20:
                 mark_point = (y - sy) / (fy * self.scaled_conversion_y)
-                if p.device.show_flip_y:
+                if not p.space.bottom_positive:
                     mark_point *= -1
                 if round(float(mark_point) * 1000) == 0:
                     mark_point = 0.0  # prevents -0
                 starts.append((w - edge_gap, y))
                 ends.append((w - length - edge_gap, y))
                 # if there is enough room for a mid-distance stroke...
                 if t_height < 0.5 * points_y:
```

### Comparing `meerk40t-0.8.3000/meerk40t/gui/scenewidgets/laserpathwidget.py` & `meerk40t-0.8.4000/meerk40t/gui/scenewidgets/laserpathwidget.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/scenewidgets/rectselectwidget.py` & `meerk40t-0.8.4000/meerk40t/gui/scenewidgets/rectselectwidget.py`

 * *Files 1% similar despite different names*

```diff
@@ -125,14 +125,16 @@
             for node in elements.elems():
                 try:
                     q = node.bounds
                 except AttributeError:
                     continue  # This element has no bounds.
                 if q is None:
                     continue
+                if hasattr(node, "can_emphasize") and not node.can_emphasize:
+                    continue
                 xmin = q[0]
                 ymin = q[1]
                 xmax = q[2]
                 ymax = q[3]
                 # no hit
                 cover = 0
                 # Check Hit
```

### Comparing `meerk40t-0.8.3000/meerk40t/gui/scenewidgets/relocatewidget.py` & `meerk40t-0.8.4000/meerk40t/gui/scenewidgets/relocatewidget.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/scenewidgets/reticlewidget.py` & `meerk40t-0.8.4000/meerk40t/gui/scenewidgets/reticlewidget.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/scenewidgets/selectionwidget.py` & `meerk40t-0.8.4000/meerk40t/gui/scenewidgets/selectionwidget.py`

 * *Files 2% similar despite different names*

```diff
@@ -1462,15 +1462,15 @@
             allowlockmove = elements.lock_allows_move
             dx, dy = self.scene.pane.revised_magnet_bound(b)
             self.total_dx += dx
             self.total_dy += dy
             if dx != 0 or dy != 0:
                 with elements.undofree():
                     for e in elements.flat(types=elem_nodes, emphasized=True):
-                        if hasattr(e, "lock") and e.lock and not allowlockmove:
+                        if not e.can_move(allowlockmove):
                             continue
                         e.matrix.post_translate(dx, dy)
                         # We would normally not adjust the node properties,
                         # but the pure adjustment of the bbox is hopefully not hurting
                         e.translated(dx, dy)
                     self.translate(dx, dy)
 
@@ -1491,15 +1491,15 @@
                 b = elements.selected_area()
                 if b is None:
                     # There is no emphasized bounds or selected area.
                     return
             allowlockmove = elements.lock_allows_move
             with elements.undofree():
                 for e in elements.flat(types=elem_nodes, emphasized=True):
-                    if hasattr(e, "lock") and e.lock and not allowlockmove:
+                    if not e.can_move(allowlockmove):
                         continue
                     e.matrix.post_translate(dx, dy)
                     # We would normally not adjust the node properties,
                     # but the pure adjustment of the bbox is hopefully not hurting
                     e.translated(dx, dy)
             self.translate(dx, dy)
             elements.update_bounds([b[0] + dx, b[1] + dy, b[2] + dx, b[3] + dy])
@@ -2626,19 +2626,27 @@
                 self.rotation_cx = cx
                 self.rotation_cy = cy
 
             # Code for reference object - single object? And identical to reference?
             self.is_ref = False
             self.single_element = True
             is_locked = True
+            no_scale = True
+            no_skew = True
+            no_move = True
+            no_rotate = True
             for idx, e in enumerate(elements.flat(types=elem_nodes, emphasized=True)):
                 if e is self.scene.pane.reference_object:
                     self.is_ref = True
                 # Is one of the elements locked?
                 is_locked = is_locked and e.lock
+                no_scale = no_scale and not e.can_scale
+                no_skew = no_skew and not e.can_skew
+                no_move = no_move and not e.can_move()
+                no_rotate = no_rotate and not e.can_rotate
                 if idx > 0:
                     self.single_element = False
 
             if not self.single_element:
                 self.is_ref = False
 
             # Add all subwidgets in Inverse Order
@@ -2673,29 +2681,29 @@
             if self.use_handle_move and maymove:
                 self.add_widget(
                     -1,
                     MoveWidget(
                         master=self, scene=self.scene, size=rotsize, drawsize=msize
                     ),
                 )
-            if show_skew_y and not is_locked:
+            if show_skew_y and not no_skew:
                 self.add_widget(
                     -1,
                     SkewWidget(
                         master=self, scene=self.scene, is_x=False, size=2 / 3 * msize
                     ),
                 )
-            if show_skew_x and not is_locked:
+            if show_skew_x and not no_skew:
                 self.add_widget(
                     -1,
                     SkewWidget(
                         master=self, scene=self.scene, is_x=True, size=2 / 3 * msize
                     ),
                 )
-            if self.use_handle_rotate and not is_locked:
+            if self.use_handle_rotate and not no_rotate:
                 for i in range(4):
                     self.add_widget(
                         -1,
                         RotationWidget(
                             master=self,
                             scene=self.scene,
                             index=i,
@@ -2703,15 +2711,15 @@
                             inner=msize,
                         ),
                     )
                 self.add_widget(
                     -1,
                     MoveRotationOriginWidget(master=self, scene=self.scene, size=msize),
                 )
-            if self.use_handle_size and not is_locked:
+            if self.use_handle_size and not no_scale:
                 for i in range(4):
                     self.add_widget(
                         -1,
                         CornerWidget(
                             master=self, scene=self.scene, index=i, size=msize
                         ),
                     )
```

### Comparing `meerk40t-0.8.3000/meerk40t/gui/simulation.py` & `meerk40t-0.8.4000/meerk40t/gui/simulation.py`

 * *Files 0% similar despite different names*

```diff
@@ -1628,23 +1628,26 @@
             pass
 
     def slide_out(self, event):
         self.slided_in = not self.slided_in
         event.Skip()
 
     def on_redo_it(self, event):
-        with wx.BusyInfo(_("Preparing simulation...")):
-            plan = self.plan_name
-            if self.checkbox_optimize.GetValue():
-                opt = " optimize"
-            else:
-                opt = ""
-            self.context(
-                f"plan{plan} clear\nplan{plan} copy preprocess validate blob preopt{opt}\n"
-            )
+        busy = self.context.kernel.busyinfo
+        busy.start(msg=_("Preparing simulation..."))
+
+        plan = self.plan_name
+        if self.checkbox_optimize.GetValue():
+            opt = " optimize"
+        else:
+            opt = ""
+        self.context(
+            f"plan{plan} clear\nplan{plan} copy preprocess validate blob preopt{opt}\n"
+        )
+        busy.end()
         self._refresh_simulated_plan()
 
     def pane_show(self):
         self.context.setting(str, "units_name", "mm")
 
         bbox = self.context.device.bbox()
         self.widget_scene.widget_root.focus_viewport_scene(
@@ -2135,18 +2138,22 @@
         _icon.CopyFromBitmap(icons8_laser_beam_hazard2_50.GetBitmap())
         self.SetIcon(_icon)
         self.SetTitle(_("Simulation"))
 
     @staticmethod
     def sub_register(kernel):
         def open_simulator(v=None):
-            with wx.BusyInfo(_("Preparing simulation...")):
-                kernel.console(
-                    "planz copy preprocess validate blob preopt optimize\nwindow toggle Simulation z\n"
-                ),
+            busy = kernel.busyinfo
+            busy.change(msg=_("Preparing simulation..."))
+            busy.start()
+
+            kernel.console(
+                "planz copy preprocess validate blob preopt optimize\nwindow toggle Simulation z\n"
+            )
+            busy.end()
 
         kernel.register(
             "button/jobstart/Simulation",
             {
                 "label": _("Simulate"),
                 "icon": icons8_laser_beam_hazard2_50,
                 "tip": _("Simulate the current laser job"),
```

### Comparing `meerk40t-0.8.3000/meerk40t/gui/snapoptions.py` & `meerk40t-0.8.4000/meerk40t/gui/snapoptions.py`

 * *Files 20% similar despite different names*

```diff
@@ -7,16 +7,16 @@
 
 
 def register_panel_snapoptions(window, context):
     panel = SnapOptionPanel(window, wx.ID_ANY, context=context)
     pane = (
         aui.AuiPaneInfo()
         .Right()
-        .MinSize(80, 165)
-        .FloatingSize(120, 195)
+        .MinSize(80, 125)
+        .FloatingSize(120, 145)
         .Hide()
         .Caption(_("Snap-Options"))
         .CaptionVisible(not context.pane_lock)
         .Name("snapoptions")
     )
     pane.dock_proportion = 150
     pane.control = panel
@@ -33,39 +33,39 @@
         wx.Panel.__init__(self, *args, **kwds)
         self.context = context
         # Main Sizer
         sizer_snap = wx.BoxSizer(wx.VERTICAL)
         maxpoints = 75
 
         self.slider_visibility = wx.Slider(
-            self, wx.ID_ANY, 1, 1, maxpoints, style=wx.SL_HORIZONTAL | wx.SL_VALUE_LABEL
+            self, wx.ID_ANY, 1, 1, maxpoints, style=wx.SL_HORIZONTAL
         )
         self.slider_visibility.SetToolTip(
             _("Defines until which distance snap points will be highlighted")
         )
 
         self.check_snap_points = wx.CheckBox(self, wx.ID_ANY, _("Snap to element"))
         self.check_snap_points.SetToolTip(
             _("Shall the cursor snap to the next element point?")
         )
         self.slider_distance_points = wx.Slider(
-            self, wx.ID_ANY, 1, 1, maxpoints, style=wx.SL_HORIZONTAL | wx.SL_VALUE_LABEL
+            self, wx.ID_ANY, 1, 1, maxpoints, style=wx.SL_HORIZONTAL
         )
         self.slider_distance_points.SetToolTip(
             _(
                 "Set the distance inside which the cursor will snap to the next element point"
             )
         )
 
         self.check_snap_grid = wx.CheckBox(self, wx.ID_ANY, _("Snap to Grid"))
         self.check_snap_grid.SetToolTip(
             _("Shall the cursor snap to the next grid intersection?")
         )
         self.slider_distance_grid = wx.Slider(
-            self, wx.ID_ANY, 1, 1, maxpoints, style=wx.SL_HORIZONTAL | wx.SL_VALUE_LABEL
+            self, wx.ID_ANY, 1, 1, maxpoints, style=wx.SL_HORIZONTAL
         )
         self.slider_distance_grid.SetToolTip(
             _(
                 "Set the distance inside which the cursor will snap to the next grid intersection"
             )
         )
 
@@ -127,46 +127,68 @@
         self.Bind(wx.EVT_SLIDER, self.on_slider_points, self.slider_distance_points)
         self.Bind(wx.EVT_SLIDER, self.on_slider_visibility, self.slider_visibility)
 
     def on_checkbox_grid(self, event):
         state = self.check_snap_grid.GetValue()
         self.context.snap_grid = state
         self.context.signal("snap_grid", state)
+        self.slider_distance_grid.Enable(state)
 
     def on_checkbox_points(self, event):
         state = self.check_snap_points.GetValue()
         self.context.snap_points = state
         self.context.signal("snap_points", state)
+        self.slider_distance_points.Enable(state)
+
+    def update_slider_tooltip(self, control):
+        state = control.GetValue()
+        ttip = control.GetToolTipText()
+        lines = ttip.split("\n")
+        if len(lines) > 1:
+            lines = lines[:-1]
+        lines.append(_("Current Value: {value} pixel").format(value=state))
+        ttip = "\n".join(lines)
+        control.SetToolTip(ttip)
 
     def on_slider_visibility(self, event):
         state = self.slider_visibility.GetValue()
         self.context.show_attract_len = state
         self.context.signal("show_attract_len", state)
+        self.slider_visibility.Enable(state)
+        self.update_slider_tooltip(self.slider_visibility)
 
     def on_slider_grid(self, event):
         state = self.slider_distance_grid.GetValue()
         self.context.grid_attract_len = state
         self.context.signal("grid_attract_len", state)
+        self.update_slider_tooltip(self.slider_distance_grid)
 
     def on_slider_points(self, event):
         state = self.slider_distance_points.GetValue()
         self.context.action_attract_len = state
         self.context.signal("action_attract_len", state)
+        self.update_slider_tooltip(self.slider_distance_points)
 
     def update_values(self):
         if self.check_snap_grid.GetValue != self.context.snap_grid:
             self.check_snap_grid.SetValue(self.context.snap_grid)
         if self.check_snap_points.GetValue() != self.context.snap_points:
             self.check_snap_points.SetValue(self.context.snap_points)
         if self.slider_distance_grid.GetValue() != self.context.grid_attract_len:
             self.slider_distance_grid.SetValue(self.context.grid_attract_len)
         if self.slider_distance_points.GetValue() != self.context.action_attract_len:
             self.slider_distance_points.SetValue(self.context.action_attract_len)
         if self.slider_visibility.GetValue() != self.context.show_attract_len:
             self.slider_visibility.SetValue(self.context.show_attract_len)
+        self.update_slider_tooltip(self.slider_distance_grid)
+        self.update_slider_tooltip(self.slider_distance_points)
+        self.update_slider_tooltip(self.slider_visibility)
+        self.slider_visibility.Enable(self.context.show_attract_len)
+        self.slider_distance_points.Enable(self.context.snap_points)
+        self.slider_distance_grid.Enable(self.context.snap_grid)
 
     @signal_listener("snap_points")
     @signal_listener("snap_grid")
     @signal_listener("grid_attract_len")
     @signal_listener("action_attract_len")
     @signal_listener("show_attract_len")
     def value_update(self, origin, *args):
```

### Comparing `meerk40t-0.8.3000/meerk40t/gui/spoolerpanel.py` & `meerk40t-0.8.4000/meerk40t/gui/spoolerpanel.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/statusbarwidgets/infowidget.py` & `meerk40t-0.8.4000/meerk40t/gui/statusbarwidgets/infowidget.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/statusbarwidgets/opassignwidget.py` & `meerk40t-0.8.4000/meerk40t/gui/statusbarwidgets/opassignwidget.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/statusbarwidgets/selectionwidget.py` & `meerk40t-0.8.4000/meerk40t/gui/statusbarwidgets/selectionwidget.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/statusbarwidgets/shapepropwidget.py` & `meerk40t-0.8.4000/meerk40t/gui/statusbarwidgets/shapepropwidget.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/statusbarwidgets/statusbar.py` & `meerk40t-0.8.4000/meerk40t/gui/statusbarwidgets/statusbar.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/statusbarwidgets/statusbarwidget.py` & `meerk40t-0.8.4000/meerk40t/gui/statusbarwidgets/statusbarwidget.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/statusbarwidgets/strokewidget.py` & `meerk40t-0.8.4000/meerk40t/gui/statusbarwidgets/strokewidget.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/toolwidgets/circlebrush.py` & `meerk40t-0.8.4000/meerk40t/gui/toolwidgets/circlebrush.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/toolwidgets/toolcircle.py` & `meerk40t-0.8.4000/meerk40t/gui/toolwidgets/toolcircle.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/toolwidgets/toolcontainer.py` & `meerk40t-0.8.4000/meerk40t/gui/toolwidgets/toolcontainer.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/toolwidgets/tooldraw.py` & `meerk40t-0.8.4000/meerk40t/gui/toolwidgets/tooldraw.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/toolwidgets/toolellipse.py` & `meerk40t-0.8.4000/meerk40t/gui/toolwidgets/toolellipse.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/toolwidgets/toollinetext.py` & `meerk40t-0.8.4000/meerk40t/gui/toolwidgets/toollinetext.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/toolwidgets/toolmeasure.py` & `meerk40t-0.8.4000/meerk40t/gui/toolwidgets/toolpolyline.py`

 * *Files 21% similar despite different names*

```diff
@@ -1,175 +1,147 @@
-from math import atan, cos, sin, sqrt, tau
+from math import sqrt, tau
 
 import wx
 
 from meerk40t.core.units import Length
+from meerk40t.gui.laserrender import swizzlecolor
 from meerk40t.gui.scene.sceneconst import (
     RESPONSE_ABORT,
     RESPONSE_CHAIN,
     RESPONSE_CONSUME,
 )
 from meerk40t.gui.toolwidgets.toolwidget import ToolWidget
+from meerk40t.svgelements import Point, Polyline
 
-_ = wx.GetTranslation
 
-
-class MeasureTool(ToolWidget):
+class PolylineTool(ToolWidget):
     """
-    Measuring Tool.
+    Polyline Drawing Tool.
 
-    Works like polygon but displays lengths at each side
-    and after 3 points the covered area as well
+    Adds polylines with clicks.
     """
 
     def __init__(self, scene):
         ToolWidget.__init__(self, scene)
         self.start_position = None
         self.point_series = []
-        self.length_series = []
         self.mouse_position = None
-        self.scene = scene
-        self.line_pen = wx.Pen()
-        self.line_pen.SetColour(self.scene.colors.color_measure_line)
-        self.line_pen.SetStyle(wx.PENSTYLE_DOT)
-        self.line_pen.SetWidth(1000)
+        # angle_snap indicates whether a line should be angle snapping
+        # False anything goes, True snaps to next 45° angle
+        self.angle_snap = False
+
+    def angled(self, pos):
+        points = list(self.point_series)
+        if self.angle_snap and len(points):
+            # What is the angle between mouse_pos and the last_position?
+            p1 = Point(points[-1][0], points[-1][1])
+            p2 = Point(pos[0], pos[1])
+            oldangle = p1.angle_to(p2)
+            dist = p1.distance_to(p2)
+            newangle = round(oldangle / tau * 8, 0) / 8 * tau
+            p3 = p1.polar(p1, newangle, dist)
+            pos = [p3.x, p3.y]
+        return pos
 
-    def process_draw(self, gc):
-        matrix = gc.GetTransform().Get()
+    def process_draw(self, gc: wx.GraphicsContext):
         if self.point_series:
-            try:
-                self.font_size = 10.0 / matrix[0]
-            except ZeroDivisionError:
-                self.font_size = 5000
-                return
-            # print ("Fontsize=%.3f, " % self.font_size)
-            if self.font_size < 1.0:
-                self.font_size = 1.0  # Mac does not allow values lower than 1.
-            try:
-                font = wx.Font(
-                    self.font_size,
-                    wx.FONTFAMILY_SWISS,
-                    wx.FONTSTYLE_NORMAL,
-                    wx.FONTWEIGHT_BOLD,
-                )
-            except TypeError:
-                font = wx.Font(
-                    int(self.font_size),
-                    wx.FONTFAMILY_SWISS,
-                    wx.FONTSTYLE_NORMAL,
-                    wx.FONTWEIGHT_BOLD,
+            elements = self.scene.context.elements
+            if elements.default_stroke is None:
+                self.pen.SetColour(wx.BLUE)
+            else:
+                self.pen.SetColour(wx.Colour(swizzlecolor(elements.default_stroke)))
+            gc.SetPen(self.pen)
+            if elements.default_fill is None:
+                gc.SetBrush(wx.TRANSPARENT_BRUSH)
+            else:
+                gc.SetBrush(
+                    wx.Brush(
+                        wx.Colour(swizzlecolor(elements.default_fill)),
+                        wx.BRUSHSTYLE_SOLID,
+                    )
                 )
-            gc.SetFont(font, self.scene.colors.color_measure_text)
-
-            gc.SetPen(self.line_pen)
-            gc.SetBrush(wx.TRANSPARENT_BRUSH)
             points = list(self.point_series)
             if self.mouse_position is not None:
-                points.append(self.mouse_position)
-            all_cx = 0
-            all_cy = 0
-            area_x_y = 0
-            area_y_x = 0
-            # https://www.wikihow.com/Calculate-the-Area-of-a-Polygon
-            idx = -1
-            last_x = 0
-            last_y = 0
-            for pt in points:
-                idx += 1
-                # print("%d, %.1f, %.1f" % (idx, pt[0],pt[1]))
-                all_cx += pt[0]
-                all_cy += pt[1]
-                if idx > 0:
-                    area_x_y += last_x * pt[1]
-                    area_y_x += last_y * pt[0]
-                last_x = pt[0]
-                last_y = pt[1]
-
-            # Complete calculation of area by closing the loop
-            area_x_y += last_x * points[0][1]
-            area_y_x += last_y * points[0][0]
-            area = 0.5 * abs(area_x_y - area_y_x)
-
-            points.append(points[0])
-            first_point = None
-
-            context = self.scene.context
-            units = context.units_name
-
-            pt_count = 0
-            perimeter = 0
-            for pt in points:
-                pt_count += 1
-                if first_point is not None:
-                    dx = pt[0] - first_point[0]
-                    dy = pt[1] - first_point[1]
-                    if dx == 0:
-                        slope = 0
-                        slope_angle = tau / 4
-                    else:
-                        slope = dy / dx
-                        slope_angle = -1 * atan(slope)
-                    dlen = sqrt(dx * dx + dy * dy)
-                    cx = (pt[0] + first_point[0]) / 2
-                    cy = (pt[1] + first_point[1]) / 2
-
-                    perimeter += dlen
-
-                    s_txt = str(Length(amount=dlen, digits=2, preferred_units=units))
-                    (t_width, t_height) = gc.GetTextExtent(s_txt)
-
-                    tcx = cx - cos(slope_angle) * t_width / 2
-                    tcy = cy + sin(slope_angle) * t_width / 2
-                    dx = tcx - cx
-                    dy = tcy - dy
-                    gc.DrawText(s_txt, tcx, tcy, slope_angle)
-                first_point = pt
-
-            if pt_count > 3:
-                # remove last point, as this one coincides with the first...
-                pt_count -= 1
-                all_cx = all_cx / pt_count
-                all_cy = all_cy / pt_count
-                # area is in base units^2, so back to units
-
-                base_square = float(Length(f"1{units}"))
-                base_square *= base_square
-                area = area / base_square
-                s_area = _("Area")
-                s_perim = _("Perimeter")
-                s_txt = (
-                    f"{s_area}={area:.1f}{units}²\n{s_perim}: "
-                    f"{str(Length(amount=perimeter, digits=1, preferred_units=units))}"
-                )
-                t_width, t_height = gc.GetTextExtent(s_txt)
-                gc.DrawText(
-                    s_txt,
-                    all_cx - 0.5 * t_width,
-                    all_cy - 0.5 * t_height,
-                )
-
-            # Draw lines at last to make them more visible
-            gc.DrawLines(points)
+                pos = self.angled(self.mouse_position)
+                points.append(pos)
+            gc.StrokeLines(points)
+            x0 = points[-2][0]
+            y0 = points[-2][1]
+            x1 = points[-1][0]
+            y1 = points[-1][1]
+            units = self.scene.context.units_name
+            s = "Pts: {pts}, to last point: O=({cx}, {cy}), d={a}".format(
+                pts=len(points),
+                cx=Length(amount=x0, digits=2, preferred_units=units),
+                cy=Length(amount=y0, digits=2, preferred_units=units),
+                a=Length(
+                    amount=sqrt((x1 - x0) * (x1 - x0) + (y1 - y0) * (y1 - y0)),
+                    digits=2,
+                    preferred_units=units,
+                ),
+            )
+            self.scene.context.signal("statusmsg", s)
 
     def event(
         self,
         window_pos=None,
         space_pos=None,
         event_type=None,
         nearest_snap=None,
         modifiers=None,
         **kwargs,
     ):
         response = RESPONSE_CHAIN
+        update_required = False
+        if (
+            modifiers is None
+            or (event_type == "key_up" and "alt" in modifiers)
+            or ("alt" not in modifiers)
+        ):
+            if self.angle_snap:
+                self.angle_snap = False
+                update_required = True
+        else:
+            if not self.angle_snap:
+                self.angle_snap = True
+                update_required = True
+
         if event_type == "leftclick":
+            self.scene.pane.tool_active = True
             if nearest_snap is None:
-                self.point_series.append((space_pos[0], space_pos[1]))
+                pos = [space_pos[0], space_pos[1]]
             else:
-                self.point_series.append((nearest_snap[0], nearest_snap[1]))
-            self.scene.pane.tool_active = True
+                pos = [nearest_snap[0], nearest_snap[1]]
+            pos = self.angled(pos)
+            self.point_series.append((pos[0], pos[1]))
+            self.scene.context.signal("statusmsg", "")
+            response = RESPONSE_CONSUME
+            if (
+                len(self.point_series) > 2
+                and abs(
+                    complex(*self.point_series[0]) - complex(*self.point_series[-1])
+                )
+                < 5000
+            ):
+                self.end_tool()
+                response = RESPONSE_ABORT
+            if (
+                len(self.point_series) > 2
+                and abs(
+                    complex(*self.point_series[-2]) - complex(*self.point_series[-1])
+                )
+                < 5000
+            ):
+                self.end_tool()
+                response = RESPONSE_ABORT
+        elif event_type == "rightdown":
+            was_already_empty = len(self.point_series) == 0
+            self.end_tool()
+            if was_already_empty:
+                self.scene.context("tool none\n")
             response = RESPONSE_CONSUME
         elif event_type == "leftdown":
             self.scene.pane.tool_active = True
             if nearest_snap is None:
                 self.mouse_position = space_pos[0], space_pos[1]
             else:
                 self.mouse_position = nearest_snap[0], nearest_snap[1]
@@ -180,29 +152,42 @@
             if nearest_snap is None:
                 self.mouse_position = space_pos[0], space_pos[1]
             else:
                 self.mouse_position = nearest_snap[0], nearest_snap[1]
             if self.point_series:
                 self.scene.request_refresh()
                 response = RESPONSE_CONSUME
-        elif event_type == "rightdown":
-            self.scene.pane.tool_active = False
-            self.point_series = []
-            self.mouse_position = None
-            self.scene.request_refresh()
-            response = RESPONSE_ABORT
         elif event_type == "doubleclick":
-            self.scene.pane.tool_active = False
-            self.point_series = []
-            self.mouse_position = None
-            self.scene.request_refresh()
+            self.end_tool()
             response = RESPONSE_ABORT
         elif event_type == "lost" or (event_type == "key_up" and modifiers == "escape"):
             if self.scene.pane.tool_active:
                 self.scene.pane.tool_active = False
                 self.scene.request_refresh()
                 response = RESPONSE_CONSUME
             else:
                 response = RESPONSE_CHAIN
             self.point_series = []
             self.mouse_position = None
+            self.scene.context.signal("statusmsg", "")
+        elif update_required:
+            self.scene.request_refresh()
+            response = RESPONSE_CONSUME
         return response
+
+    def end_tool(self):
+        if len(self.point_series) > 1:
+            polyline = Polyline(*self.point_series)
+            elements = self.scene.context.elements
+            node = elements.elem_branch.add(
+                shape=polyline,
+                type="elem polyline",
+                stroke_width=elements.default_strokewidth,
+                stroke=elements.default_stroke,
+                fill=elements.default_fill,
+            )
+            if elements.classify_new:
+                elements.classify([node])
+            self.notify_created(node)
+        self.scene.pane.tool_active = False
+        self.point_series = []
+        self.mouse_position = None
```

### Comparing `meerk40t-0.8.3000/meerk40t/gui/toolwidgets/toolnodeedit.py` & `meerk40t-0.8.4000/meerk40t/gui/toolwidgets/toolnodeedit.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/toolwidgets/toolpoint.py` & `meerk40t-0.8.4000/meerk40t/gui/toolwidgets/toolpoint.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/toolwidgets/toolpolygon.py` & `meerk40t-0.8.4000/meerk40t/gui/toolwidgets/toolpolygon.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/toolwidgets/toolpolyline.py` & `meerk40t-0.8.4000/meerk40t/gui/toolwidgets/toolvector.py`

 * *Files 23% similar despite different names*

```diff
@@ -1,89 +1,74 @@
-from math import sqrt, tau
+from math import tau
 
 import wx
 
-from meerk40t.core.units import Length
-from meerk40t.gui.laserrender import swizzlecolor
-from meerk40t.gui.scene.sceneconst import (
-    RESPONSE_ABORT,
-    RESPONSE_CHAIN,
-    RESPONSE_CONSUME,
-)
+from meerk40t.gui.scene.sceneconst import RESPONSE_CHAIN, RESPONSE_CONSUME
 from meerk40t.gui.toolwidgets.toolwidget import ToolWidget
-from meerk40t.svgelements import Point, Polyline
+from meerk40t.svgelements import Path, Point
 
+from ..laserrender import LaserRender, swizzlecolor
 
-class PolylineTool(ToolWidget):
+
+class VectorTool(ToolWidget):
     """
-    Polyline Drawing Tool.
+    Path Drawing Tool.
 
-    Adds polylines with clicks.
+    Adds Path with click and drag.
     """
 
     def __init__(self, scene):
         ToolWidget.__init__(self, scene)
         self.start_position = None
-        self.point_series = []
+        self.path = None
         self.mouse_position = None
+        self.render = LaserRender(scene.context)
+        self.c0 = None
         # angle_snap indicates whether a line should be angle snapping
         # False anything goes, True snaps to next 45° angle
         self.angle_snap = False
 
     def angled(self, pos):
-        points = list(self.point_series)
-        if self.angle_snap and len(points):
+        if self.angle_snap and self.path:
             # What is the angle between mouse_pos and the last_position?
-            p1 = Point(points[-1][0], points[-1][1])
+            p1 = self.path.z_point
             p2 = Point(pos[0], pos[1])
             oldangle = p1.angle_to(p2)
             dist = p1.distance_to(p2)
             newangle = round(oldangle / tau * 8, 0) / 8 * tau
             p3 = p1.polar(p1, newangle, dist)
             pos = [p3.x, p3.y]
         return pos
 
     def process_draw(self, gc: wx.GraphicsContext):
-        if self.point_series:
-            elements = self.scene.context.elements
-            if elements.default_stroke is None:
-                self.pen.SetColour(wx.BLUE)
-            else:
-                self.pen.SetColour(wx.Colour(swizzlecolor(elements.default_stroke)))
+        if self.path:
             gc.SetPen(self.pen)
-            if elements.default_fill is None:
-                gc.SetBrush(wx.TRANSPARENT_BRUSH)
-            else:
-                gc.SetBrush(
-                    wx.Brush(
-                        wx.Colour(swizzlecolor(elements.default_fill)),
-                        wx.BRUSHSTYLE_SOLID,
-                    )
-                )
-            points = list(self.point_series)
+            gc.SetBrush(wx.TRANSPARENT_BRUSH)
+            path = Path(self.path)
             if self.mouse_position is not None:
-                pos = self.angled(self.mouse_position)
-                points.append(pos)
-            gc.StrokeLines(points)
-            x0 = points[-2][0]
-            y0 = points[-2][1]
-            x1 = points[-1][0]
-            y1 = points[-1][1]
-            units = self.scene.context.units_name
-            s = "Pts: {pts}, to last point: O=({cx}, {cy}), d={a}".format(
-                pts=len(points),
-                cx=Length(amount=x0, digits=2, preferred_units=units),
-                cy=Length(amount=y0, digits=2, preferred_units=units),
-                a=Length(
-                    amount=sqrt((x1 - x0) * (x1 - x0) + (y1 - y0) * (y1 - y0)),
-                    digits=2,
-                    preferred_units=units,
-                ),
-            )
-            self.scene.context.signal("statusmsg", s)
+                if self.c0:
+                    pos = self.mouse_position
+                    path.smooth_cubic(self.c0, pos)
+                else:
+                    pos = self.angled(self.mouse_position)
+                    path.line(pos)
+            gpath = self.render.make_path(gc, path)
+            gc.DrawPath(gpath)
+            del gpath
+            # x0 = points[-2][0]
+            # y0 = points[-2][1]
+            # x1 = points[-1][0]
+            # y1 = points[-1][1]
+            # s = "Pts: {pts}, to last point: O=({cx}, {cy}), d={a}".format(
+            #     pts = len(points),
+            #     cx = Length(amount=x0, digits=2).length_mm,
+            #     cy = Length(amount=y0, digits=2).length_mm,
+            #     a = Length(amount=sqrt((x1-x0)*(x1-x0) + (y1-y0)*(y1-y0)), digits=2).length_mm,
+            # )
+            # self.scene.context.signal("statusmsg", s)
 
     def event(
         self,
         window_pos=None,
         space_pos=None,
         event_type=None,
         nearest_snap=None,
@@ -103,91 +88,111 @@
         else:
             if not self.angle_snap:
                 self.angle_snap = True
                 update_required = True
 
         if event_type == "leftclick":
             self.scene.pane.tool_active = True
-            if nearest_snap is None:
-                pos = [space_pos[0], space_pos[1]]
-            else:
-                pos = [nearest_snap[0], nearest_snap[1]]
-            pos = self.angled(pos)
-            self.point_series.append((pos[0], pos[1]))
-            self.scene.context.signal("statusmsg", "")
+            elements = self.scene.context.elements
+            if self.path is None:
+                self.pen = wx.Pen()
+                self.pen.SetColour(wx.Colour(swizzlecolor(elements.default_stroke)))
+                try:
+                    self.pen.SetWidth(elements.default_strokewidth)
+                except TypeError:
+                    self.pen.SetWidth(int(elements.default_strokewidth))
+                self.path = Path()
+                if nearest_snap is None:
+                    self.path.move((space_pos[0], space_pos[1]))
+                else:
+                    self.path.move((nearest_snap[0], nearest_snap[1]))
+            else:
+                if nearest_snap is None:
+                    pos = [space_pos[0], space_pos[1]]
+                else:
+                    pos = [nearest_snap[0], nearest_snap[1]]
+                pos = self.angled(pos)
+                self.path.line((pos[0], pos[1]))
+            self.c0 = None
             response = RESPONSE_CONSUME
-            if (
-                len(self.point_series) > 2
-                and abs(
-                    complex(*self.point_series[0]) - complex(*self.point_series[-1])
-                )
-                < 5000
-            ):
-                self.end_tool()
-                response = RESPONSE_ABORT
-            if (
-                len(self.point_series) > 2
-                and abs(
-                    complex(*self.point_series[-2]) - complex(*self.point_series[-1])
-                )
-                < 5000
-            ):
-                self.end_tool()
-                response = RESPONSE_ABORT
         elif event_type == "rightdown":
-            was_already_empty = len(self.point_series) == 0
+            if self.path is None or len(self.path) == 0:
+                was_already_empty = True
+            else:
+                was_already_empty = False
             self.end_tool()
             if was_already_empty:
                 self.scene.context("tool none\n")
             response = RESPONSE_CONSUME
         elif event_type == "leftdown":
             self.scene.pane.tool_active = True
             if nearest_snap is None:
-                self.mouse_position = space_pos[0], space_pos[1]
+                pos = (space_pos[0], space_pos[1])
             else:
-                self.mouse_position = nearest_snap[0], nearest_snap[1]
-            if self.point_series:
+                pos = (nearest_snap[0], nearest_snap[1])
+            pos = self.angled(pos)
+            self.c0 = (pos[0], pos[1])
+            response = RESPONSE_CONSUME
+        elif event_type == "move":
+            if nearest_snap is None:
+                pos = (space_pos[0], space_pos[1])
+            else:
+                pos = (nearest_snap[0], nearest_snap[1])
+            pos = self.angled(pos)
+            self.c0 = (pos[0], pos[1])
+            if self.path:
+                self.scene.request_refresh()
+                response = RESPONSE_CONSUME
+        elif event_type == "leftup":
+            self.scene.pane.tool_active = False
+            if self.c0 is not None and self.path:
+                self.scene.pane.tool_active = True
+                pos = self.mouse_position
+                self.path.smooth_cubic(self.c0, pos)
                 self.scene.request_refresh()
+            self.c0 = None
+            self.mouse_position = None
+            self.scene.request_refresh()
             response = RESPONSE_CONSUME
-        elif event_type in ("leftup", "move", "hover"):
+        elif event_type == "hover":
             if nearest_snap is None:
                 self.mouse_position = space_pos[0], space_pos[1]
             else:
                 self.mouse_position = nearest_snap[0], nearest_snap[1]
-            if self.point_series:
+            if self.path:
                 self.scene.request_refresh()
-                response = RESPONSE_CONSUME
         elif event_type == "doubleclick":
             self.end_tool()
-            response = RESPONSE_ABORT
+            response = RESPONSE_CONSUME
         elif event_type == "lost" or (event_type == "key_up" and modifiers == "escape"):
             if self.scene.pane.tool_active:
                 self.scene.pane.tool_active = False
                 self.scene.request_refresh()
                 response = RESPONSE_CONSUME
             else:
                 response = RESPONSE_CHAIN
-            self.point_series = []
-            self.mouse_position = None
             self.scene.context.signal("statusmsg", "")
+            self.path = None
         elif update_required:
             self.scene.request_refresh()
             response = RESPONSE_CONSUME
         return response
 
     def end_tool(self):
-        if len(self.point_series) > 1:
-            polyline = Polyline(*self.point_series)
+        self.scene.pane.tool_active = False
+        t = self.path
+        if t is not None and len(t) > 1:
             elements = self.scene.context.elements
             node = elements.elem_branch.add(
-                shape=polyline,
-                type="elem polyline",
+                path=t,
+                type="elem path",
                 stroke_width=elements.default_strokewidth,
                 stroke=elements.default_stroke,
                 fill=elements.default_fill,
             )
             if elements.classify_new:
                 elements.classify([node])
             self.notify_created(node)
-        self.scene.pane.tool_active = False
-        self.point_series = []
+        self.path = None
+        self.scene.context.signal("statusmsg", "")
         self.mouse_position = None
+        self.scene.request_refresh()
```

### Comparing `meerk40t-0.8.3000/meerk40t/gui/toolwidgets/toolrect.py` & `meerk40t-0.8.4000/meerk40t/gui/toolwidgets/toolrect.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/toolwidgets/toolrelocate.py` & `meerk40t-0.8.4000/meerk40t/gui/toolwidgets/toolrelocate.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/toolwidgets/toolribbon.py` & `meerk40t-0.8.4000/meerk40t/gui/toolwidgets/toolribbon.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/toolwidgets/tooltext.py` & `meerk40t-0.8.4000/meerk40t/gui/toolwidgets/tooltext.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/toolwidgets/toolwidget.py` & `meerk40t-0.8.4000/meerk40t/gui/toolwidgets/toolwidget.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/usbconnect.py` & `meerk40t-0.8.4000/meerk40t/gui/usbconnect.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/utilitywidgets/buttonwidget.py` & `meerk40t-0.8.4000/meerk40t/gui/utilitywidgets/buttonwidget.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/utilitywidgets/checkboxwidget.py` & `meerk40t-0.8.4000/meerk40t/gui/utilitywidgets/checkboxwidget.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/utilitywidgets/cyclocycloidwidget.py` & `meerk40t-0.8.4000/meerk40t/gui/utilitywidgets/cyclocycloidwidget.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/utilitywidgets/handlewidget.py` & `meerk40t-0.8.4000/meerk40t/gui/utilitywidgets/handlewidget.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/utilitywidgets/harmonograph.py` & `meerk40t-0.8.4000/meerk40t/gui/utilitywidgets/harmonograph.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/utilitywidgets/openclosewidget.py` & `meerk40t-0.8.4000/meerk40t/gui/utilitywidgets/openclosewidget.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/utilitywidgets/rotationwidget.py` & `meerk40t-0.8.4000/meerk40t/gui/utilitywidgets/rotationwidget.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/utilitywidgets/scalewidget.py` & `meerk40t-0.8.4000/meerk40t/gui/utilitywidgets/scalewidget.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/utilitywidgets/seekbarwidget.py` & `meerk40t-0.8.4000/meerk40t/gui/utilitywidgets/seekbarwidget.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/utilitywidgets/togglewidget.py` & `meerk40t-0.8.4000/meerk40t/gui/utilitywidgets/togglewidget.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/wordlisteditor.py` & `meerk40t-0.8.4000/meerk40t/gui/wordlisteditor.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/wxmeerk40t.py` & `meerk40t-0.8.4000/meerk40t/gui/wxmeerk40t.py`

 * *Files 1% similar despite different names*

```diff
@@ -57,14 +57,15 @@
 from .propertypanels.imageproperty import (
     ImageModificationPanel,
     ImagePropertyPanel,
     ImageVectorisationPanel,
 )
 from .propertypanels.operationpropertymain import ParameterPanel
 from .propertypanels.pathproperty import PathPropertyPanel
+from .propertypanels.placementproperty import PlacementParameterPanel
 from .propertypanels.pointproperty import PointPropertyPanel
 from .propertypanels.propertywindow import PropertyWindow
 from .propertypanels.rasterwizardpanels import (
     AutoContrastPanel,
     ContrastPanel,
     EdgePanel,
     GammaPanel,
@@ -94,18 +95,19 @@
 
 
 def register_panel_go(window, context):
     # Define Go
     go = wx.BitmapButton(window, wx.ID_ANY, icons8_gas_industry_50.GetBitmap())
 
     def busy_go_plan(*args):
-        with wx.BusyInfo(_("Processing and sending...")):
-            context(
-                "plan clear copy preprocess validate blob preopt optimize spool\nplan clear\n"
-            )
+        context.kernel.busyinfo.start(msg=_("Processing and sending..."))
+        context(
+            "plan clear copy preprocess validate blob preopt optimize spool\nplan clear\n"
+        )
+        context.kernel.busyinfo.end()
 
     window.Bind(
         wx.EVT_BUTTON,
         busy_go_plan,
         go,
     )
     go.SetBackgroundColour(wx.Colour(0, 127, 0))
@@ -621,14 +623,16 @@
         kernel.register("window/Properties", PropertyWindow)
         kernel.register("property/RasterOpNode/OpMain", ParameterPanel)
         kernel.register("property/CutOpNode/OpMain", ParameterPanel)
         kernel.register("property/EngraveOpNode/OpMain", ParameterPanel)
         kernel.register("property/ImageOpNode/OpMain", ParameterPanel)
         kernel.register("property/DotsOpNode/OpMain", ParameterPanel)
         kernel.register("property/HatchOpNode/OpMain", ParameterPanel)
+        kernel.register("property/PlaceCurrentNode/OpMain", PlacementParameterPanel)
+        kernel.register("property/PlacePointNode/OpMain", PlacementParameterPanel)
 
         kernel.register("property/ConsoleOperation/Property", ConsolePropertiesPanel)
         kernel.register("property/FileNode/Property", FilePropertiesPanel)
         kernel.register("property/GroupNode/Property", GroupPropertiesPanel)
         kernel.register("property/EllipseNode/PathProperty", PathPropertyPanel)
         kernel.register("property/PathNode/PathProperty", PathPropertyPanel)
         kernel.register("property/LineNode/PathProperty", PathPropertyPanel)
```

### Comparing `meerk40t-0.8.3000/meerk40t/gui/wxmmain.py` & `meerk40t-0.8.4000/meerk40t/gui/wxmmain.py`

 * *Files 1% similar despite different names*

```diff
@@ -66,14 +66,15 @@
     icons8_rotate_left_50,
     icons8_rotate_right_50,
     icons8_save_50,
     icons8_scissors_50,
     icons8_type_50,
     icons8_undo_50,
     icons8_ungroup_objects_50,
+    icons8_user_location_50,
     icons8_vector_50,
     icons_evenspace_horiz,
     icons_evenspace_vert,
     set_icon_appearance,
 )
 from .laserrender import (
     DRAW_MODE_ALPHABLACK,
@@ -316,15 +317,14 @@
         self.main_statusbar.activate_panel("linecap", value)
         self.main_statusbar.Reposition()
 
     # ------------ Setup
     def register_options_and_choices(self, context):
         _ = context._
         context.setting(bool, "disable_tool_tips", False)
-        context.setting(bool, "maintain_zoom_resize", True)
         context.setting(bool, "enable_sel_move", True)
         context.setting(bool, "enable_sel_size", True)
         context.setting(bool, "enable_sel_rotate", True)
         context.setting(bool, "enable_sel_skew", False)
         context.setting(int, "zoom_margin", 4)  # 4%
         # Standard-Icon-Sizes
         # default, factor 1 - leave as is
@@ -438,19 +438,19 @@
                 "page": "Gui",
                 "section": "Zoom",
             },
         ]
         context.kernel.register_choices("preferences", choices)
         choices = [
             {
-                "attr": "maintain_zoom_resize",
+                "attr": "autofocus_resize",
                 "object": self.context.root,
-                "default": True,
+                "default": False,
                 "type": bool,
-                "label": _("Maintain zoom on resize"),
+                "label": _("Autofocus bed on resize"),
                 "tip": _("Autofocus bed when resizing the main window"),
                 "page": "Gui",
                 "section": "Zoom",
             },
         ]
         context.kernel.register_choices("preferences", choices)
 
@@ -582,14 +582,27 @@
                 "tip": _(
                     "Set the distance inside which the cursor will snap to the next grid intersection"
                 ),
                 "page": "Scene",
                 "section": "Snap-Options",
                 "subsection": "Grid",
             },
+            {
+                "attr": "clear_magnets",
+                "object": context.root,
+                "default": True,
+                "type": bool,
+                "label": _("Clear magnets on File - New"),
+                "tip": _(
+                    "File - New can remove all defined magnetlines (active)\nor leave them in place (inactive)"
+                ),
+                "page": "Scene",
+                "section": "Snap-Options",
+                "subsection": "Magnetlines",
+            },
         ]
         context.kernel.register_choices("preferences", choices)
         choices = [
             {
                 "attr": "use_toolmenu",
                 "object": context.root,
                 "default": True,
@@ -703,14 +716,27 @@
                 "group": "tool",
                 "size": bsize_normal,
                 "identifier": "relocate",
             },
         )
 
         kernel.register(
+            "button/tools/Placement",
+            {
+                "label": _("Job Start"),
+                "icon": icons8_user_location_50,
+                "tip": _("Add a job starting point to the scene"),
+                "action": lambda v: kernel.elements("tool placement\n"),
+                "group": "tool",
+                "size": bsize_normal,
+                "identifier": "placement",
+            },
+        )
+
+        kernel.register(
             "button/tools/Draw",
             {
                 "label": _("Draw"),
                 "icon": icons8_pencil_drawing_50,
                 "tip": _("Add a free-drawing element"),
                 "action": lambda v: kernel.elements("tool draw\n"),
                 "group": "tool",
@@ -1206,31 +1232,37 @@
                 "identifier": "prep_wordlist",
                 "priority": 99,
                 "default": "prep_wordlist_edit",
                 "multi": [
                     {
                         "identifier": "prep_wordlist_edit",
                         "icon": icons8_curly_brackets_50,
-                        "tip": _("Manages Wordlist-Entries"),
+                        "tip": _("Manages Wordlist-Entries")
+                        + _(" (right go to next entry)"),
                         "label": _("Wordlist"),
                         "action": lambda v: kernel.console("window toggle Wordlist\n"),
+                        "action_right": lambda v: kernel.elements.wordlist_advance(1),
                     },
                     {
                         "identifier": "prep_wordlist_plus_1",
                         "icon": icons8_circled_right_50,
-                        "tip": _("Wordlist: go to next entry"),
+                        "tip": _("Wordlist: go to next entry")
+                        + _(" (right go to prev entry)"),
                         "label": _("Next"),
                         "action": lambda v: kernel.elements.wordlist_advance(1),
+                        "action_right": lambda v: kernel.elements.wordlist_advance(-1),
                     },
                     {
                         "identifier": "prep_wordlist_minus_1",
                         "label": _("Prev"),
                         "icon": icons8_circled_left_50,
-                        "tip": _("Wordlist: go to prev entry"),
+                        "tip": _("Wordlist: go to prev entry")
+                        + _(" (right go to next entry)"),
                         "action": lambda v: kernel.elements.wordlist_advance(-1),
+                        "action_right": lambda v: kernel.elements.wordlist_advance(1),
                     },
                 ],
             },
         )
 
         # Default Size for small buttons
         buttonsize = STD_ICON_SIZE / 2
@@ -1956,14 +1988,16 @@
         context.setting(str, "file14", None)
         context.setting(str, "file15", None)
         context.setting(str, "file16", None)
         context.setting(str, "file17", None)
         context.setting(str, "file18", None)
         context.setting(str, "file19", None)
         self.populate_recent_menu()
+        if hasattr(context.kernel.busyinfo, "reparent"):
+            context.kernel.busyinfo.reparent(self)
 
     @lookup_listener("pane")
     def dynamic_fill_pane_menu(self, new=None, old=None):
         def toggle_pane(pane_toggle):
             def toggle(event=None):
                 pane_obj = self._mgr.GetPane(pane_toggle)
                 if pane_obj.IsShown():
@@ -2422,15 +2456,16 @@
             elements = self.context.elements
             for node in elements.elems():
                 flag = False
                 if hasattr(node, "references"):
                     flag = True
                     if len(node.references) > 0:
                         flag = False
-                node.emphasized = flag
+                if node.can_emphasize:
+                    node.emphasized = flag
             elements.validate_selected_area()
             self.context.signal("refresh_scene", "Scene")
 
         def on_click_properties():
             self.context("window open Properties\n")
 
         def on_click_device_manager():
@@ -3587,15 +3622,15 @@
             dlg.ShowModal()
             dlg.Destroy()
 
     def on_size(self, event):
         if self.context is None:
             return
         self.Layout()
-        if self.context.maintain_zoom_resize:
+        if self.context.autofocus_resize:
             zl = self.context.zoom_margin
             self.context(f"scene focus -{zl}% -{zl}% {100 + zl}% {100 + zl}%\n")
 
     def on_focus_lost(self, event):
         self.context("-laser\nend\n")
         # event.Skip()
```

### Comparing `meerk40t-0.8.3000/meerk40t/gui/wxmribbon.py` & `meerk40t-0.8.4000/meerk40t/gui/wxmribbon.py`

 * *Files 1% similar despite different names*

```diff
@@ -516,15 +516,19 @@
         try:
             alt = base_button.alternatives[key]
         except KeyError:
             return
         base_button.action = alt.get("action", base_button.action)
         base_button.action_right = alt.get("action_right", base_button.action_right)
         base_button.label = alt.get("label", base_button.label)
-        base_button.help_string = alt.get("help_string", base_button.help_string)
+
+        helps = alt.get("help_string", "")
+        if helps == "":
+            helps = alt.get("tip", base_button.help_string)
+        base_button.help_string = helps
         base_button.bitmap_large = alt.get("bitmap_large", base_button.bitmap_large)
         base_button.bitmap_large_disabled = alt.get(
             "bitmap_large_disabled", base_button.bitmap_large_disabled
         )
         base_button.bitmap_small = alt.get("bitmap_small", base_button.bitmap_small)
         base_button.bitmap_small_disabled = alt.get(
             "bitmap_small_disabled", base_button.bitmap_small_disabled
@@ -614,22 +618,28 @@
                 id=new_id,
             )
         else:
             if "group" in button or "toggle" in button:
                 bkind = RB.RIBBON_BUTTON_TOGGLE
             else:
                 bkind = RB.RIBBON_BUTTON_NORMAL
+            helps = ""
+            if show_tip:
+                if helps == "" and "help_string" in button:
+                    helps = button["help_string"]
+                if helps == "" and "tip" in button:
+                    helps = button["tip"]
             b = button_bar.AddButton(
                 button_id=new_id,
                 label=button["label"],
                 bitmap=button["icon"].GetBitmap(resize=resize_param),
                 bitmap_disabled=button["icon"].GetBitmap(
                     resize=resize_param, color=Color("grey")
                 ),
-                help_string=button["tip"] if show_tip else "",
+                help_string=helps,
                 kind=bkind,
             )
 
         button_bar.Bind(RB.EVT_RIBBONBUTTONBAR_CLICKED, self.button_click, id=new_id)
         button_bar.Bind(wx.EVT_RIGHT_UP, self.button_click_right)
         return b
```

### Comparing `meerk40t-0.8.3000/meerk40t/gui/wxmscene.py` & `meerk40t-0.8.4000/meerk40t/gui/wxmscene.py`

 * *Files 3% similar despite different names*

```diff
@@ -30,14 +30,15 @@
 from meerk40t.gui.toolwidgets.toolcircle import CircleTool
 from meerk40t.gui.toolwidgets.toolcontainer import ToolContainer
 from meerk40t.gui.toolwidgets.tooldraw import DrawTool
 from meerk40t.gui.toolwidgets.toolellipse import EllipseTool
 from meerk40t.gui.toolwidgets.toollinetext import LineTextTool
 from meerk40t.gui.toolwidgets.toolmeasure import MeasureTool
 from meerk40t.gui.toolwidgets.toolnodeedit import EditTool
+from meerk40t.gui.toolwidgets.toolplacement import PlacementTool
 from meerk40t.gui.toolwidgets.toolpoint import PointTool
 from meerk40t.gui.toolwidgets.toolpolygon import PolygonTool
 from meerk40t.gui.toolwidgets.toolpolyline import PolylineTool
 from meerk40t.gui.toolwidgets.toolrect import RectTool
 from meerk40t.gui.toolwidgets.toolrelocate import RelocateTool
 from meerk40t.gui.toolwidgets.toolribbon import RibbonTool
 from meerk40t.gui.toolwidgets.tooltext import TextTool
@@ -96,20 +97,36 @@
         self.tool_active = False
         self.modif_active = False
         self._reference = None  # Reference Object
 
         # Stuff for magnet-lines
         self.magnet_x = []
         self.magnet_y = []
-        self.magnet_attraction = 2
+        self._magnet_attraction = 2
         # 0 off, `1..x` increasing strength (quadratic behaviour)
         self.magnet_attract_x = True  # Shall the X-Axis be affected
         self.magnet_attract_y = True  # Shall the Y-Axis be affected
         self.magnet_attract_c = True  # Shall the center be affected
 
+        self.context.setting(bool, "clear_magnets", True)
+
+        # Save / Load the content of magnets
+        from os.path import join, realpath
+
+        from meerk40t.kernel.functions import get_safe_path
+
+        self._magnet_file = join(
+            realpath(get_safe_path(self.context.kernel.name)), "magnets.cfg"
+        )
+        self.load_magnets()
+        # Add a plugin routine to be called at the time of a full new start
+        context.kernel.register(
+            "reset_routines/magnets", self.clear_magnets_conditionally
+        )
+
         self.active_tool = "none"
 
         self._last_snap_position = None
         self._last_snap_ts = 0
 
         context = self.context
         self.widget_scene.add_scenewidget(AttractionWidget(self.widget_scene))
@@ -174,14 +191,15 @@
         context.register("tool/relocate", RelocateTool)
         context.register("tool/text", TextTool)
         context.register("tool/vector", VectorTool)
         context.register("tool/measure", MeasureTool)
         context.register("tool/ribbon", RibbonTool)
         context.register("tool/linetext", LineTextTool)
         context.register("tool/edit", EditTool)
+        context.register("tool/placement", PlacementTool)
 
         buttonsize = int(STD_ICON_SIZE / 2)
 
         def proxy_linetext():
             from meerk40t.extra.hershey import have_hershey_fonts
 
             if have_hershey_fonts(context):
@@ -708,56 +726,103 @@
     def reference_object(self):
         return self._reference
 
     @reference_object.setter
     def reference_object(self, ref_object):
         prev = self._reference
         self._reference = ref_object
+        self.scene.reference_object = self._reference
         dlist = []
         if prev is not None:
             dlist.append(prev)
         if self._reference is not None:
             dlist.append(self._reference)
         if len(dlist) > 0:
             self.context.signal("element_property_update", dlist)
 
     ##########
     # MAGNETS
     ##########
 
+    @property
+    def magnet_attraction(self):
+        return self._magnet_attraction
+
+    @magnet_attraction.setter
+    def magnet_attraction(self, value):
+        if 0 <= value <= 5:
+            self._magnet_attraction = value
+            self.save_magnets()
+
+    def save_magnets(self):
+        try:
+            with open(self._magnet_file, "w") as f:
+                f.write(f"a={self.magnet_attraction}\n")
+                for x in self.magnet_x:
+                    f.write(f"x={Length(x, preferred_units='mm').preferred_length}\n")
+                for y in self.magnet_y:
+                    f.write(f"y={Length(y, preferred_units='mm').preferred_length}\n")
+        except ValueError:  # ( PermissionError, OSError, FileNotFoundError ):
+            return
+
+    def load_magnets(self):
+        self.magnet_x = []
+        self.magnet_y = []
+        try:
+            with open(self._magnet_file, "r") as f:
+                for line in f:
+                    cline = line.strip()
+                    if cline != "":
+                        subs = cline.split("=")
+                        if len(subs) > 1:
+                            try:
+                                if subs[0] in ("a", "A"):
+                                    # Attraction strength
+                                    value = int(subs[1])
+                                    if value < 0:
+                                        value = 0
+                                    if value > 5:
+                                        value = 5
+                                    self._magnet_attraction = value
+                                elif subs[0] in ("x", "X"):
+                                    dimens = Length(subs[1])
+                                    value = float(dimens)
+                                    if value not in self.magnet_x:
+                                        self.magnet_x.append(value)
+                                elif subs[0] in ("y", "Y"):
+                                    dimens = Length(subs[1])
+                                    value = float(dimens)
+                                    if value not in self.magnet_y:
+                                        self.magnet_y.append(value)
+                            except ValueError:
+                                pass
+        except (PermissionError, OSError, FileNotFoundError):
+            return
+
     def clear_magnets(self):
         self.magnet_x = []
         self.magnet_y = []
-        self.context.signal("magnets", False)
+        self.save_magnets()
+
+    def clear_magnets_conditionally(self):
+        # Depending on setting
+        if self.context.clear_magnets:
+            self.clear_magnets()
 
     def toggle_x_magnet(self, x_value):
-        prev = self.has_magnets()
         if x_value in self.magnet_x:
             self.magnet_x.remove(x_value)
-            # print("Remove x magnet for %.1f" % x_value)
-            now = self.has_magnets()
         else:
             self.magnet_x += [x_value]
-            # print("Add x magnet for %.1f" % x_value)
-            now = True
-        if prev != now:
-            self.context.signal("magnets", now)
 
     def toggle_y_magnet(self, y_value):
-        prev = self.has_magnets()
         if y_value in self.magnet_y:
             self.magnet_y.remove(y_value)
-            # print("Remove y magnet for %.1f" % y_value)
-            now = self.has_magnets()
         else:
             self.magnet_y += [y_value]
-            now = True
-            # print("Add y magnet for %.1f" % y_value)
-        if prev != now:
-            self.context.signal("magnets", now)
 
     def magnet_attracted_x(self, x_value, useit):
         delta = float("inf")
         x_val = None
         if useit:
             for mag_x in self.magnet_x:
                 if abs(x_value - mag_x) < delta:
@@ -775,23 +840,23 @@
                     y_val = mag_y
         return delta, y_val
 
     def revised_magnet_bound(self, bounds=None):
 
         dx = 0
         dy = 0
-        if self.has_magnets() and self.magnet_attraction > 0:
-            if self.tick_distance > 0:
-                s = f"{self.tick_distance}{self.context.units_name}"
+        if self.has_magnets() and self._magnet_attraction > 0:
+            if self.grid.tick_distance > 0:
+                s = f"{self.grid.tick_distance}{self.context.units_name}"
                 len_tick = float(Length(s))
                 # Attraction length is 1/3, 4/3, 9/3 of a grid-unit
                 # fmt: off
-                attraction_len = 1 / 3 * self.magnet_attraction * self.magnet_attraction * len_tick
+                attraction_len = 1 / 3 * self._magnet_attraction * self._magnet_attraction * len_tick
 
-                # print("Attraction len=%s, attract=%d, alen=%.1f, tlen=%.1f, factor=%.1f" % (s, self.magnet_attraction, attraction_len, len_tick, attraction_len / len_tick ))
+                # print("Attraction len=%s, attract=%d, alen=%.1f, tlen=%.1f, factor=%.1f" % (s, self._magnet_attraction, attraction_len, len_tick, attraction_len / len_tick ))
                 # fmt: on
             else:
                 attraction_len = float(Length("1mm"))
 
             delta_x1, x1 = self.magnet_attracted_x(bounds[0], self.magnet_attract_x)
             delta_x2, x2 = self.magnet_attracted_x(bounds[2], self.magnet_attract_x)
             delta_x3, x3 = self.magnet_attracted_x(
@@ -854,14 +919,20 @@
     def last_snap(self, value):
         self._last_snap_position = value
         if value is None:
             self._last_snap_ts = 0
         else:
             self._last_snap_ts = time.time()
 
+    @signal_listener("make_reference")
+    def listen_make_ref(self, origin, *args):
+        node = args[0]
+        self.reference_object = node
+        self.context.signal("reference")
+
     @signal_listener("draw_mode")
     def on_draw_mode(self, origin, *args):
         if self._tool_widget is not None:
             orgx = 5
             orgy = 5
             # Are guides drawn?
             if self.context.draw_mode & DRAW_MODE_GUIDES == 0:
@@ -1045,14 +1116,35 @@
     @signal_listener("magnet-attraction")
     def on_magnet(self, origin, strength, *args):
         strength = int(strength)
         if strength < 0:
             strength = 0
         self.magnet_attraction = strength
 
+    @signal_listener("magnet_gen")
+    def on_magnet(self, origin, *args):
+        candidate = args[0]
+        if candidate is None:
+            return
+        if not isinstance(candidate, (tuple, list)) or len(candidate) < 2:
+            return
+        method = candidate[0]
+        node = candidate[1]
+        bb = node.bounds
+        if method == "outer":
+            self.toggle_x_magnet(bb[0])
+            self.toggle_x_magnet(bb[2])
+            self.toggle_y_magnet(bb[1])
+            self.toggle_y_magnet(bb[3])
+        elif method == "center":
+            self.toggle_x_magnet((bb[0] + bb[2]) / 2)
+            self.toggle_y_magnet((bb[1] + bb[3]) / 2)
+        self.save_magnets()
+        self.request_refresh()
+
     def pane_show(self, *args):
         zl = self.context.zoom_margin
         self.context(f"scene focus -{zl}% -{zl}% {100 + zl}% {100 + zl}%\n")
 
     def pane_hide(self, *args):
         pass
 
@@ -1065,14 +1157,17 @@
         if self.context is None:
             return
         self.Layout()
         # Refresh not needed as scenepanel already does it...
         # self.scene.signal("guide")
         # self.request_refresh()
 
+    def on_close(self, event):
+        self.save_magnets()
+
     @signal_listener("driver;mode")
     def on_driver_mode(self, origin, state):
         if state == 0:
             self.widget_scene.overrule_background = None
         else:
             self.widget_scene.overrule_background = wx.RED
         self.widget_scene.request_refresh_for_animation()
```

### Comparing `meerk40t-0.8.3000/meerk40t/gui/wxmtree.py` & `meerk40t-0.8.4000/meerk40t/gui/wxmtree.py`

 * *Files 0% similar despite different names*

```diff
@@ -14,14 +14,15 @@
     icons8_close_window_20,
     icons8_diagonal_20,
     icons8_direction_20,
     icons8_file_20,
     icons8_ghost_20,
     icons8_group_objects_20,
     icons8_home_20,
+    icons8_home_location_20,
     icons8_image_20,
     icons8_input_20,
     icons8_journey_20,
     icons8_laser_beam_20,
     icons8_line_20,
     icons8_lock_50,
     icons8_output_20,
@@ -52,22 +53,23 @@
     wxtree = TreePanel(window, wx.ID_ANY, context=context)
     minwd = 75
     pane = (
         aui.AuiPaneInfo()
         .Name("tree")
         .Left()
         .MinSize(minwd, -1)
+        .BestSize(300, 500)
         .LeftDockable()
         .RightDockable()
         .BottomDockable(False)
         .Caption(_("Tree"))
         .CaptionVisible(not context.pane_lock)
         .TopDockable(False)
     )
-    pane.dock_proportion = minwd
+    pane.dock_proportion = 500
     pane.control = wxtree
     window.on_pane_create(pane)
     context.register("pane/tree", pane)
 
 
 class TreePanel(wx.Panel):
     def __init__(self, *args, context=None, **kwds):
@@ -377,14 +379,16 @@
             "util console": icons8_system_task_20,
             "op engrave": icons8_small_beam_20,
             "op cut": icons8_laser_beam_20,
             "op image": icons8_image_20,
             "op raster": icons8_direction_20,
             "op hatch": icons8_diagonal_20,
             "op dots": icons8_scatter_plot_20,
+            "place current": icons8_home_location_20,
+            "place point": icons8_home_location_20,
             "elem point": icons8_scatter_plot_20,
             "file": icons8_file_20,
             "group": icons8_group_objects_20,
             "elem rect": icons8_rectangular_20,
             "elem ellipse": icons8_oval_20,
             "elem image": icons8_image_20,
             "elem path": icons8_journey_20,
@@ -1315,15 +1319,18 @@
 
         @param node:
         @return:
         """
 
         def my_create_label(node, text=None):
             if text is None:
-                text = "{element_type}:{id}"
+                try:
+                    text = node._formatter
+                except AttributeError:
+                    text = "{element_type}:{id}"
             # Just for the optical impression (who understands what a "Rect: None" means),
             # lets replace some of the more obvious ones...
             mymap = node.default_map()
             for key in mymap:
                 if hasattr(node, key) and key in mymap and mymap[key] == "None":
                     if getattr(node, key) is None:
                         mymap[key] = "-"
@@ -1717,14 +1724,23 @@
                     elif node.type == "elem text":
                         bb = node.bounds
                         if bb is not None:
                             ww = Length(amount=bb[2] - bb[0], digits=1)
                             hh = Length(amount=bb[3] - bb[1], digits=1)
                             ttip = f"{ww.length_mm} x {hh.length_mm}"
                             # ttip += f"\n{node.font}"
+                    elif node.type == "place current":
+                        ttip = _(
+                            "This is a placeholder for the 'place current' operation"
+                        )
+                    elif node.type == "place point":
+                        ttip = _(
+                            "This will define an origin from where all the elements in this scene\n"
+                            + "will be plotted. You can have multiple such job start points"
+                        )
         self._last_hover_item = item
         if ttip != self.wxtree.GetToolTipText():
             self.wxtree.SetToolTip(ttip)
 
     def on_item_right_click(self, event):
         """
         Right click of element in tree.
```

### Comparing `meerk40t-0.8.3000/meerk40t/gui/wxutils.py` & `meerk40t-0.8.4000/meerk40t/gui/wxutils.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/gui/zmatrix.py` & `meerk40t-0.8.4000/meerk40t/gui/zmatrix.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/image/imagetools.py` & `meerk40t-0.8.4000/meerk40t/image/imagetools.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/kernel/channel.py` & `meerk40t-0.8.4000/meerk40t/kernel/channel.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/kernel/context.py` & `meerk40t-0.8.4000/meerk40t/kernel/context.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,12 +1,11 @@
 from typing import Any, Callable, Dict, Generator, Optional, Tuple, Union
 
 from .jobs import ConsoleFunction
 from .lifecycles import *
-from .states import *
 
 
 class Context:
     """
     Contexts serve as path-relevant snapshots of the kernel. These are the primary interaction between the modules
     and the kernel. They permit getting other contexts of the kernel. This should serve as the primary interface
     code between the kernel and the modules.
@@ -17,15 +16,15 @@
     reloaded when .setting() is called for the given attribute. This should be called by code that intends access
     an attribute even if it was already called.
     """
 
     def __init__(self, kernel: "Kernel", path: str):
         self._kernel = kernel
         self._path = path
-        self._state = STATE_UNKNOWN
+        self._state = "unknown"
         self.opened = {}
 
     def __repr__(self):
         return f"Context('{self._path}')"
 
     def __call__(self, data: str, **kwargs):
         if len(data) and data[-1] != "\n":
```

### Comparing `meerk40t-0.8.3000/meerk40t/kernel/exceptions.py` & `meerk40t-0.8.4000/meerk40t/kernel/exceptions.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/kernel/functions.py` & `meerk40t-0.8.4000/meerk40t/kernel/functions.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/kernel/jobs.py` & `meerk40t-0.8.4000/meerk40t/kernel/jobs.py`

 * *Files 8% similar despite different names*

```diff
@@ -1,12 +1,10 @@
 import time
 from typing import Callable, Optional, Tuple
 
-from .states import *
-
 
 class Job:
     """
     Generic job for the scheduler.
 
     Jobs that can be scheduled in the scheduler-kernel to run at a particular time and a given number of times.
     This is done calling schedule() and unschedule() and setting the parameters for process, args, interval,
@@ -20,15 +18,15 @@
         interval: float = 1.0,
         times: Optional[int] = None,
         job_name: Optional[str] = None,
         run_main: bool = False,
         conditional: Callable = None,
     ):
         self.job_name = job_name
-        self.state = STATE_INITIALIZE
+        self.state = "init"
         self.run_main = run_main
         self.conditional = conditional
 
         self.process = process
         self.args = args
         self.interval = interval
         self.times = times
```

### Comparing `meerk40t-0.8.3000/meerk40t/kernel/kernel.py` & `meerk40t-0.8.4000/meerk40t/kernel/kernel.py`

 * *Files 1% similar despite different names*

```diff
@@ -20,15 +20,14 @@
     get_safe_path,
 )
 from .jobs import ConsoleFunction, Job
 from .lifecycles import *
 from .module import Module
 from .service import Service
 from .settings import Settings
-from .states import *
 
 KERNEL_VERSION = "0.0.10"
 
 RE_ACTIVE = re.compile("service/(.*)/active")
 RE_AVAILABLE = re.compile("service/(.*)/available")
 
 
@@ -129,15 +128,15 @@
         # The translation object to be overridden by any valid translation functions
         self.translation = lambda e: e
 
         # The function used to process the signals. This is useful if signals should be kept to a single thread.
         self.scheduler_handles_main_thread_jobs = True
         self.scheduler_handles_default_thread_jobs = True
 
-        self.state = STATE_INITIALIZE
+        self.state = "init"
 
         # Scheduler
         self.jobs = {}
         self.scheduler_thread = None
 
         # Signal Listener
         self.signal_job = None
@@ -1221,15 +1220,15 @@
         All threads are stopped.
 
         Any residual attached listeners are made warnings.
 
         @return:
         """
         channel = self.channel("shutdown")
-        self.state = STATE_END  # Terminates the Scheduler.
+        self.state = "end"  # Terminates the Scheduler.
 
         _ = self.translation
 
         try:
             self.process_queue()  # Notify listeners of state.
         except RuntimeError:
             pass  # Runtime error for gui objects in the process of being killed.
@@ -1364,15 +1363,15 @@
         self.listeners = {}
         if (
             self.scheduler_thread != threading.current_thread()
         ):  # Join if not this thread.
             self.scheduler_thread.join()
         if channel:
             channel(_("Shutdown."))
-        self._state = STATE_TERMINATE
+        self._state = "terminate"
 
     # ==========
     # REGISTRATION
     # ==========
 
     def find(self, *args):
         """
@@ -1727,31 +1726,31 @@
         thread.daemon = daemon
         thread.start()
         self.thread_lock.release()
         return thread
 
     def get_text_thread_state(self, state: int) -> str:
         _ = self.translation
-        if state == STATE_INITIALIZE:
+        if state == "init":
             return _("Unstarted")
-        elif state == STATE_TERMINATE:
+        elif state == "terminate":
             return _("Abort")
-        elif state == STATE_END:
+        elif state == "end":
             return _("Finished")
-        elif state == STATE_PAUSE:
+        elif state == "pause":
             return _("Pause")
-        elif state == STATE_BUSY:
+        elif state == "busy":
             return _("Busy")
-        elif state == STATE_WAIT:
+        elif state == "wait":
             return _("Waiting")
-        elif state == STATE_ACTIVE:
+        elif state == "active":
             return _("Active")
-        elif state == STATE_IDLE:
+        elif state == "idle":
             return _("Idle")
-        elif state == STATE_UNKNOWN:
+        elif state == "unknown":
             return _("Unknown")
 
     # ==========
     # SCHEDULER
     # ==========
 
     def scheduler_main(self, *args):
@@ -1805,27 +1804,27 @@
         """
         Scheduler main loop.
 
         Check the Scheduler thread state, and whether it should abort or pause.
         Check each job, and if that job is scheduled to run. Executes that job.
         @return:
         """
-        self.state = STATE_ACTIVE
-        while self.state != STATE_END:
+        self.state = "active"
+        while self.state != "end":
             time.sleep(0.005)  # 200 ticks a second.
-            while self.state == STATE_PAUSE:
+            while self.state == "pause":
                 # The scheduler is paused.
                 time.sleep(0.1)
-            if self.state == STATE_TERMINATE:
+            if self.state == "terminate":
                 break
             self.schedule_run(
                 self.scheduler_handles_default_thread_jobs,
                 self.scheduler_handles_main_thread_jobs,
             )
-        self.state = STATE_END
+        self.state = "end"
 
     def schedule(self, job: "Job") -> "Job":
         try:
             job.reset()
             # Could be recurring job. Reset on reschedule.
         except AttributeError:
             pass
```

### Comparing `meerk40t-0.8.3000/meerk40t/kernel/lifecycles.py` & `meerk40t-0.8.4000/meerk40t/kernel/lifecycles.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/kernel/module.py` & `meerk40t-0.8.4000/meerk40t/kernel/module.py`

 * *Files 3% similar despite different names*

```diff
@@ -1,10 +1,7 @@
-from .states import *
-
-
 class Module:
     """
     Modules are a generic lifecycle object. These are registered in the kernel as modules and when open() is called for
     a context. When close() is called on the context, it will close and delete references to the opened module and call
     module_close().
 
     If an opened module tries to open() a second time in a context with the same name, and was not closed, the
@@ -21,15 +18,15 @@
         registered_path: str = None,
         *args,
         **kwargs,
     ):
         self.context = context
         self.name = name
         self.registered_path = registered_path
-        self.state = STATE_INITIALIZE
+        self.state = "init"
 
     def __repr__(self):
         return f'{self.__class__.__name__}({repr(self.context)}, name="{self.name}")'
 
     def restore(self, *args, **kwargs):
         """Called with the same values of __init()__ on an attempt to reopen of a module with the same name at the
         same context."""
```

### Comparing `meerk40t-0.8.3000/meerk40t/kernel/service.py` & `meerk40t-0.8.4000/meerk40t/kernel/service.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/kernel/settings.py` & `meerk40t-0.8.4000/meerk40t/kernel/settings.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/lihuiyu/controller.py` & `meerk40t-0.8.4000/meerk40t/lihuiyu/controller.py`

 * *Files 4% similar despite different names*

```diff
@@ -14,26 +14,14 @@
 
 """
 
 import threading
 import time
 
 from meerk40t.ch341 import get_ch341_interface
-from meerk40t.kernel import (
-    STATE_ACTIVE,
-    STATE_BUSY,
-    STATE_END,
-    STATE_IDLE,
-    STATE_INITIALIZE,
-    STATE_PAUSE,
-    STATE_SUSPEND,
-    STATE_TERMINATE,
-    STATE_UNKNOWN,
-    STATE_WAIT,
-)
 
 STATUS_BAD_STATE = 204
 STATUS_SERIAL_CORRECT_M3_FINISH = 204
 # 0xCC, 11001100
 STATUS_OK = 206
 # 0xCE, 11001110
 STATUS_ERROR = 207
@@ -151,15 +139,15 @@
     Opening and closing of the pipe are dealt with internally. There are three primary monitor data channels.
     'send', 'recv' and 'usb'. They display the reading and writing of information to/from the USB and the USB connection
     log, providing information about the connecting and error status of the USB device.
     """
 
     def __init__(self, context, *args, **kwargs):
         self.context = context
-        self.state = STATE_UNKNOWN
+        self.state = "unknown"
         self.is_shutdown = False
         self.serial_confirmed = None
 
         self._thread = None
         self._buffer = (
             bytearray()
         )  # Threadsafe buffered commands to be sent to controller.
@@ -170,23 +158,23 @@
         self._preempt = (
             bytearray()
         )  # Thread-unsafe preempt commands to prepend to the buffer.
         self.context._buffer_size = 0
         self._queue_lock = threading.Lock()
         self._preempt_lock = threading.Lock()
         self._main_lock = threading.Lock()
+        self._loop_cond = threading.Condition()
 
         self._status = [0] * 6
         self._usb_state = -1
 
         self.connection = None
         self.max_attempts = 5
         self.refuse_counts = 0
         self.connection_errors = 0
-        self.count = 0
         self.aborted_retries = False
         self.pre_ok = False
         self.realtime = False
 
         self.abort_waiting = False
 
         name = self.context.label
@@ -333,17 +321,16 @@
             return self
         if self.realtime:
             # We are in a realtime exception that has not been terminated.
             self.realtime_write(bytes_to_write)
             return self
 
         self.pipe_channel(f"write({str(bytes_to_write)})")
-        self._queue_lock.acquire(True)
-        self._queue += bytes_to_write
-        self._queue_lock.release()
+        with self._queue_lock:
+            self._queue += bytes_to_write
         self.start()
         self.update_buffer()
         return self
 
     def realtime_write(self, bytes_to_write):
         """
         Writes data to the preempting commands, this will be moved to the front of the buffer by the thread
@@ -364,103 +351,107 @@
 
             # All data after ~ is sent back to normal write.
             queue_bytes = bytes_to_write[f + 1 :]
             if queue_bytes:
                 self.write(queue_bytes)
             return self
         self.pipe_channel(f"realtime_write({str(bytes_to_write)})")
-        self._preempt_lock.acquire(True)
-        self._preempt = bytearray(bytes_to_write) + self._preempt
-        self._preempt_lock.release()
+        with self._preempt_lock:
+            self._preempt = bytearray(bytes_to_write) + self._preempt
         self.start()
         self.update_buffer()
         return self
 
     def start(self):
         """
         Controller state change to `Started`.
         @return:
         """
-
+        with self._loop_cond:
+            self._loop_cond.notify()
         if not self.is_shutdown and (
             self._thread is None or not self._thread.is_alive()
         ):
+            self.update_state("init")
             self._thread = self.context.threaded(
                 self._thread_data_send,
                 thread_name=f"LhyPipe({self.context.path})",
                 result=self.stop,
             )
             self._thread.stop = self.stop
-            self.update_state(STATE_INITIALIZE)
 
     def _pause_busy(self):
         """
         BUSY can be called in a paused state to packet halt the controller.
 
         This can only be done from PAUSE.
         """
-        if self.state != STATE_PAUSE:
+        if self.state != "pause":
             self.pause()
-        if self.state == STATE_PAUSE:
-            self.update_state(STATE_BUSY)
+        if self.state == "pause":
+            self.update_state("busy")
 
     def _resume_busy(self):
         """
         Resumes from a BUSY to restore the controller. This will return to a paused state.
 
         This can only be done from BUSY.
         """
-        if self.state == STATE_BUSY:
-            self.update_state(STATE_PAUSE)
+        if self.state == "busy":
+            self.update_state("pause")
             self.resume()
 
     def pause(self):
         """
         Pause simply holds the controller from sending any additional packets.
 
         If this state change is done from INITIALIZE it will start the processing.
         Otherwise, it must be done from ACTIVE or IDLE.
         """
-        if self.state == STATE_INITIALIZE:
+        if self.state == "init":
             self.start()
-            self.update_state(STATE_PAUSE)
-        if self.state == STATE_ACTIVE or self.state == STATE_IDLE:
-            self.update_state(STATE_PAUSE)
+            self.update_state("pause")
+        if self.state in ("active", "idle"):
+            self.update_state("pause")
 
     def resume(self):
         """
         Resume can only be called from PAUSE.
         """
-        if self.state == STATE_PAUSE:
-            self.update_state(STATE_ACTIVE)
+        if self.state == "pause":
+            self.update_state("active")
 
     def abort(self):
         self._buffer = bytearray()
         self._queue = bytearray()
         self._realtime_buffer = bytearray()
         self.context.signal("pipe;buffer", 0)
-        self.update_state(STATE_TERMINATE)
+        self.update_state("terminate")
 
     def reset(self):
-        self.update_state(STATE_INITIALIZE)
+        self.update_state("init")
 
     def stop(self, *args):
         self.abort()
         try:
             if self._thread is not None:
                 self._thread.join()  # Wait until stop completes before continuing.
             self._thread = None
         except RuntimeError:
             pass  # Stop called by current thread.
 
     def abort_retry(self):
+        with self._loop_cond:
+            self._loop_cond.notify()
         self.aborted_retries = True
         self.context.signal("pipe;state", "STATE_FAILED_SUSPENDED")
 
     def continue_retry(self):
+        with self._loop_cond:
+            self._loop_cond.notify()
         self.aborted_retries = False
         self.context.signal("pipe;state", "STATE_FAILED_RETRYING")
 
     def usb_release(self):
         if self.connection:
             self.connection.release()
         else:
@@ -486,14 +477,16 @@
         try:
             self._confirm_serial()
         except ConnectionError:
             # If we could not access the status, then we did not confirm the serial number.
             pass
 
     def update_state(self, state):
+        with self._loop_cond:
+            self._loop_cond.notify()
         if state == self.state:
             return
         self.state = state
         if self.context is not None:
             self.context.signal("pipe;thread", self.state)
 
     def update_buffer(self):
@@ -505,96 +498,117 @@
 
     def update_packet(self, packet):
         self.context.signal("pipe;packet", convert_to_list_bytes(packet))
         self.context.signal("pipe;packet_text", packet)
         if self.usb_send_channel:
             self.usb_send_channel(packet)
 
-    def _thread_data_send(self):
-        """
-        Main threaded function to send data. While the controller is working the thread
-        will be doing work in this function.
-        """
-        self._main_lock.acquire(True)
-        self.count = 0
-        self.pre_ok = False
-        self.is_shutdown = False
-        while self.state != STATE_END and self.state != STATE_TERMINATE:
-            if self.state == STATE_INITIALIZE:
+    def _thread_loop(self):
+        while self.state not in ("end", "terminate"):
+            if self.state == "init":
                 # If we are initialized. Change that to active since we're running.
-                self.update_state(STATE_ACTIVE)
-            if self.state in (STATE_PAUSE, STATE_BUSY, STATE_SUSPEND):
+                self.update_state("active")
+            if self.state in ("pause", "busy", "suspend"):
                 # If we are paused just keep sleeping until the state changes.
                 if len(self._realtime_buffer) == 0 and len(self._preempt) == 0:
                     # Only pause if there are no realtime commands to queue.
                     self.context.signal("pipe;running", False)
-                    time.sleep(0.25)
+                    with self._loop_cond:
+                        self._loop_cond.wait()
                     continue
             if self.aborted_retries:
+                # We are not trying reconnection anymore.
+                self.context.signal("pipe;running", False)
+                with self._loop_cond:
+                    self._loop_cond.wait()
+                continue
+
+            self._check_transfer_buffer()
+            if len(self._realtime_buffer) <= 0 and len(self._buffer) <= 0:
+                # The buffer and realtime buffers are empty. No packet creation possible.
                 self.context.signal("pipe;running", False)
-                time.sleep(0.25)
+                with self._loop_cond:
+                    self._loop_cond.wait()
                 continue
+
             try:
                 # We try to process the queue.
                 queue_processed = self.process_queue()
                 if self.refuse_counts:
                     self.context.signal("pipe;failing", 0)
                 self.refuse_counts = 0
                 if self.is_shutdown:
-                    break  # Sometimes it could reset this and escape.
+                    return  # Sometimes it could reset this and escape.
             except ConnectionRefusedError:
                 # The attempt refused the connection.
                 self.refuse_counts += 1
                 self.pre_ok = False
                 if self.refuse_counts >= 5:
                     self.context.signal("pipe;state", "STATE_FAILED_RETRYING")
                 self.context.signal("pipe;failing", self.refuse_counts)
                 self.context.signal("pipe;running", False)
                 if self.is_shutdown:
-                    break  # Sometimes it could reset this and escape.
+                    return  # Sometimes it could reset this and escape.
                 time.sleep(3)  # 3-second sleep on failed connection attempt.
                 continue
             except ConnectionError:
                 # There was an error with the connection, close it and try again.
                 self.connection_errors += 1
                 self.pre_ok = False
 
                 self.context.signal("pipe;running", False)
                 time.sleep(0.5)
                 self.close()
                 continue
+
+            self.context.signal("pipe;running", queue_processed)
             if queue_processed:
                 # Packet was sent.
                 if self.state not in (
-                    STATE_PAUSE,
-                    STATE_BUSY,
-                    STATE_ACTIVE,
-                    STATE_TERMINATE,
-                ):
-                    self.update_state(STATE_ACTIVE)
-                self.count = 0
-            else:
-                # No packet could be sent.
-                if self.state not in (
-                    STATE_PAUSE,
-                    STATE_BUSY,
-                    STATE_TERMINATE,
+                    "pause",
+                    "busy",
+                    "active",
+                    "terminate",
                 ):
-                    self.update_state(STATE_IDLE)
-                if self.count > 50:
-                    self.count = 50
-                time.sleep(0.02 * self.count)
-                # will tick up to 1 second waits if there's never a queue.
-                self.count += 1
-            self.context.signal("pipe;running", queue_processed)
-        self._thread = None
-        self.update_state(STATE_END)
-        self.pre_ok = False
-        self.context.signal("pipe;running", False)
-        self._main_lock.release()
+                    self.update_state("active")
+                continue
+            # No packet could be sent.
+            if self.state not in (
+                "pause",
+                "busy",
+                "terminate",
+            ):
+                self.update_state("idle")
+
+    def _thread_data_send(self):
+        """
+        Main threaded function to send data. While the controller is working the thread
+        will be doing work in this function.
+        """
+        with self._main_lock:
+            self.pre_ok = False
+            self.is_shutdown = False
+            self._thread_loop()
+            self._thread = None
+            self.update_state("end")
+            self.pre_ok = False
+            self.context.signal("pipe;running", False)
+
+    def _check_transfer_buffer(self):
+        if len(self._queue):  # check for and append queue
+            with self._queue_lock:
+                self._buffer += self._queue
+                self._queue.clear()
+            self.update_buffer()
+
+        if len(self._preempt):  # check for and prepend preempt
+            with self._preempt_lock:
+                self._realtime_buffer += self._preempt
+                self._preempt.clear()
+            self.update_buffer()
 
     def process_queue(self):
         """
         Attempts to process the buffer/queue
         Will fail on ConnectionRefusedError at open, 'process_queue_pause = True' (anytime before packet sent),
         self._buffer is empty, or a failure to produce packet.
 
@@ -608,38 +622,22 @@
         % : fail checksum, do not resend
         ~ : begin/end realtime exception (Note, these characters would be consumed during
                 the write process and should not exist in the queue)
         \x18 : quit.
 
         @return: queue process success.
         """
-        if len(self._queue):  # check for and append queue
-            self._queue_lock.acquire(True)
-            self._buffer += self._queue
-            self._queue = bytearray()
-            self._queue_lock.release()
-            self.update_buffer()
-
-        if len(self._preempt):  # check for and prepend preempt
-            self._preempt_lock.acquire(True)
-            self._realtime_buffer += self._preempt
-            self._preempt = bytearray()
-            self._preempt_lock.release()
-            self.update_buffer()
-
         if len(self._realtime_buffer) > 0:
             buffer = self._realtime_buffer
             realtime = True
+        elif len(self._buffer) > 0:
+            buffer = self._buffer
+            realtime = False
         else:
-            if len(self._buffer) > 0:
-                buffer = self._buffer
-                realtime = False
-            else:
-                # The buffer and realtime buffers are empty. No packet creation possible.
-                return False
+            return False
 
         # Find buffer of 30 or containing '\n'.
         find = buffer.find(b"\n", 0, 30)
         if find == -1:  # No end found.
             length = min(30, len(buffer))
         else:  # Line end found.
             length = min(30, len(buffer), find + 1)
@@ -667,15 +665,15 @@
             elif packet.endswith(b"!"):  # pause
                 self._pause_busy()
                 packet = packet[:-1]
             elif packet.endswith(b"%"):  # alt-checksum
                 default_checksum = False
                 packet = packet[:-1]
             elif packet.endswith(b"\x18"):
-                self.state = STATE_TERMINATE
+                self.update_state("terminate")
                 self.is_shutdown = True
                 packet = packet[:-1]
             if packet.startswith(b"A"):
                 # This is a challenge code. A is only used for serial challenges.
                 post_send_command = self._confirm_serial
             if len(packet) != 0:
                 if packet.endswith(b"#"):
@@ -683,15 +681,15 @@
                     try:
                         c = packet[-1]
                     except IndexError:
                         c = b"F"  # Packet was simply #. We can do nothing.
                     packet += bytes([c]) * (30 - len(packet))  # Padding. '\n'
                 else:
                     packet += b"F" * (30 - len(packet))  # Padding. '\n'
-        if not realtime and self.state in (STATE_PAUSE, STATE_BUSY):
+        if not realtime and self.state in ("pause", "busy"):
             return False  # Processing normal queue, PAUSE and BUSY apply.
 
         # Packet is prepared and ready to send. Open Channel.
         self.open()
 
         if len(packet) == 30:
             # We have a sendable packet.
@@ -703,16 +701,16 @@
                 packet = b"\x00" + packet + bytes([onewire_crc_lookup(packet) ^ 0xFF])
             self.connection.write(packet)
             self.pre_ok = False
 
             # Packet is sent, trying to confirm.
             status = 0
             flawless = True
-            for attempts in range(300):
-                # We'll try to confirm this at 300 times.
+            for attempts in range(500):
+                # We'll try to confirm this at 500 times.
                 try:
                     self.update_status()
                     status = self._status[1]
                 except ConnectionError:
                     # Errors are ignored, must confirm packet.
                     flawless = False
                     continue
@@ -721,14 +719,16 @@
                     continue
                 elif status == STATUS_OK:
                     # Packet was fine.
                     self.pre_ok = True
                     break
                 elif status == STATUS_BUSY:
                     # Busy. We still do not have our confirmation. BUSY comes before ERROR or OK.
+                    if attempts > 10:
+                        time.sleep(0.05)
                     continue
                 elif status == STATUS_ERROR:
                     if not default_checksum:
                         break
                     self.context.rejected_count += 1
                     if flawless:  # Packet was rejected. The CRC failed.
                         return False
@@ -797,15 +797,15 @@
             except IndexError:
                 pass
             if self.recv_channel:
                 self.recv_channel(str(self._status))
 
     def wait_until_accepting_packets(self):
         i = 0
-        while self.state != STATE_TERMINATE:
+        while self.state != "terminate":
             self.update_status()
             status = self._status[1]
             if status == 0:
                 raise ConnectionError
             if status == STATUS_OK:
                 self.pre_ok = False
                 break
@@ -818,43 +818,43 @@
             if self.abort_waiting:
                 self.abort_waiting = False
                 return  # Wait abort was requested.
 
     def wait_finished(self):
         i = 0
         original_state = self.state
-        if self.state != STATE_PAUSE:
+        if self.state != "pause":
             self.pause()
 
         while True:
-            if self.state != STATE_WAIT:
-                if self.state == STATE_TERMINATE:
+            if self.state != "wait":
+                if self.state == "terminate":
                     return  # Abort all the processes was requested. This state change would be after clearing.
-                self.update_state(STATE_WAIT)
+                self.update_state("wait")
             self.update_status()
             status = self._status[1]
             if status == 0:
                 raise ConnectionError
             if status == STATUS_ERROR:
                 self.context.rejected_count += 1
             if status & 0x02 == 0:
                 # StateBitPEMP = 0x00000200, Finished = 0xEC, 11101100
                 break
             if self.context is not None:
                 self.context.signal("pipe;wait", status, i)
             i += 1
             if self.abort_waiting:
                 self.abort_waiting = False
-                return  # Wait abort was requested.
+                break  # Wait abort was requested.
         self.update_state(original_state)
 
     def _confirm_serial(self):
         t = time.time()
         while time.time() - t < 0.5:  # We spend up to half a second to confirm.
-            if self.state == STATE_TERMINATE:
+            if self.state == "terminate":
                 # We are not confirmed.
                 return  # Abort all the processes was requested. This state change would be after clearing.
             self.update_status()
             status = self._status[1]
             if status == STATUS_SERIAL_CORRECT_M3_FINISH:
                 self.serial_confirmed = True
                 return  # We're done.
```

### Comparing `meerk40t-0.8.3000/meerk40t/lihuiyu/device.py` & `meerk40t-0.8.4000/meerk40t/lihuiyu/device.py`

 * *Files 2% similar despite different names*

```diff
@@ -5,21 +5,15 @@
 the given device type.
 """
 
 from hashlib import md5
 
 from meerk40t.core.laserjob import LaserJob
 from meerk40t.core.spoolers import Spooler
-from meerk40t.kernel import (
-    STATE_ACTIVE,
-    STATE_PAUSE,
-    CommandSyntaxError,
-    Service,
-    signal_listener,
-)
+from meerk40t.kernel import CommandSyntaxError, Service, signal_listener
 
 from ..core.units import UNITS_PER_MIL, Length, ViewPort
 from .controller import LihuiyuController
 from .driver import LihuiyuDriver
 from .tcp_connection import TCPOutput
 
 
@@ -420,16 +414,14 @@
             native_scale_x=UNITS_PER_MIL,
             native_scale_y=UNITS_PER_MIL,
             origin_x=1.0 if self.home_right else 0.0,
             origin_y=1.0 if self.home_bottom else 0.0,
             flip_x=self.flip_x,
             flip_y=self.flip_y,
             swap_xy=self.swap_xy,
-            show_flip_x=self.home_right,
-            show_flip_y=self.home_bottom,
         )
         self.setting(int, "buffer_max", 900)
         self.setting(bool, "buffer_limit", True)
 
         self.setting(bool, "fix_speeds", False)
 
         self.setting(int, "usb_index", -1)
@@ -824,27 +816,27 @@
                     md5(bytes(remainder.upper(), "utf8")).hexdigest()
                 )
                 code = b"A%s\n" % challenge
                 self.output.write(code)
 
         @self.console_command("start", help=_("Start Pipe to Controller"))
         def pipe_start(command, channel, _, **kwargs):
-            self.controller.update_state(STATE_ACTIVE)
+            self.controller.update_state("active")
             self.controller.start()
             channel(_("Lihuiyu Channel Started."))
 
         @self.console_command("hold", help=_("Hold Controller"))
         def pipe_pause(command, channel, _, **kwargs):
-            self.controller.update_state(STATE_PAUSE)
+            self.controller.update_state("pause")
             self.controller.pause()
             channel("Lihuiyu Channel Paused.")
 
         @self.console_command("resume", help=_("Resume Controller"))
         def pipe_resume(command, channel, _, **kwargs):
-            self.controller.update_state(STATE_ACTIVE)
+            self.controller.update_state("active")
             self.controller.start()
             channel(_("Lihuiyu Channel Resumed."))
 
         @self.console_command("usb_connect", help=_("Connects USB"))
         def usb_connect(command, channel, _, **kwargs):
             try:
                 self.controller.open()
@@ -950,24 +942,28 @@
                             device=str(self)
                         )
                     )
                 except KeyError:
                     channel(_("Intepreter cannot be attached to any device."))
                 return
 
+    def service_attach(self, *args, **kwargs):
+        self.realize()
+
     @signal_listener("user_scale_x")
     @signal_listener("user_scale_y")
     @signal_listener("bedsize")
     @signal_listener("flip_x")
     @signal_listener("flip_y")
     @signal_listener("swap_xy")
     def realize(self, origin=None, *args):
         self.width = self.bedwidth
         self.height = self.bedheight
         super().realize()
+        self.space.update_bounds(0, 0, self.width, self.height)
 
     def outline_move_relative(self, dx, dy):
         x, y = self.native
         new_x = x + dx
         new_y = y + dy
         min_x = min(x, new_x)
         min_y = min(y, new_y)
```

### Comparing `meerk40t-0.8.3000/meerk40t/lihuiyu/driver.py` & `meerk40t-0.8.4000/meerk40t/lihuiyu/driver.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/lihuiyu/gui/gui.py` & `meerk40t-0.8.4000/meerk40t/grbl/gui/gui.py`

 * *Files 24% similar despite different names*

```diff
@@ -1,81 +1,79 @@
-from meerk40t.kernel import signal_listener
-
-
 def plugin(service, lifecycle):
     if lifecycle == "invalidate":
+        try:
+            import serial  # pylint: disable=unused-import
+        except ImportError:
+            return True
         return not service.has_feature("wx")
-
     if lifecycle == "service":
-        return "provider/device/lhystudios"
+        return "provider/device/grbl"
 
     if lifecycle == "assigned":
         service("window toggle Configuration\n")
 
     if lifecycle == "added":
+        from meerk40t.grbl.gui.grblconfiguration import GRBLConfiguration
+        from meerk40t.grbl.gui.grblserialcontroller import SerialController
+        from meerk40t.grbl.gui.tcpcontroller import TCPController
         from meerk40t.gui.icons import (
             icons8_computer_support_50,
             icons8_connected_50,
             icons8_emergency_stop_button_50,
+            icons8_flash_off_50,
+            icons8_info_50,
             icons8_pause_50,
+            icons8_quick_mode_on_50,
         )
-        from meerk40t.lihuiyu.gui.lhyaccelgui import LihuiyuAccelerationChart
-        from meerk40t.lihuiyu.gui.lhycontrollergui import LihuiyuControllerGui
-        from meerk40t.lihuiyu.gui.lhydrivergui import LihuiyuDriverGui
-        from meerk40t.lihuiyu.gui.lhyoperationproperties import LhyAdvancedPanel
-        from meerk40t.lihuiyu.gui.tcpcontroller import TCPController
-
-        service.register("window/Controller", LihuiyuControllerGui)
-        service.register("window/Configuration", LihuiyuDriverGui)
-        service.register("window/Acceleration-Chart", LihuiyuAccelerationChart)
-        service.register("window/Network-Controller", TCPController)
 
-        service.register("winpath/Controller", service)
+        service.register("window/Serial-Controller", SerialController)
+        service.register("winpath/Serial-Controller", service)
+
+        if service.permit_tcp:
+            service.register("window/TCP-Controller", TCPController)
+            service.register("winpath/TCP-Controller", service)
+
+        service.register("window/Configuration", GRBLConfiguration)
         service.register("winpath/Configuration", service)
-        service.register("winpath/AccelerationChart", service)
-        service.register("winpath/Network-Controller", service)
 
-        service.register("property/RasterOpNode/Lihuiyu", LhyAdvancedPanel)
-        service.register("property/CutOpNode/Lihuiyu", LhyAdvancedPanel)
-        service.register("property/EngraveOpNode/Lihuiyu", LhyAdvancedPanel)
-        service.register("property/ImageOpNode/Lihuiyu", LhyAdvancedPanel)
-        service.register("property/DotsOpNode/Lihuiyu", LhyAdvancedPanel)
-        _ = service.kernel.translation
+        _ = service._
 
         def controller_click(i=None):
-            if service.networked:
-                service("window toggle Network-Controller\n")
+            if service.permit_tcp and service.interface == "tcp":
+                service("window toggle TCP-Controller\n")
+            elif service.permit_serial and service.interface == "serial":
+                service("window toggle Serial-Controller\n")
             else:
-                service("window toggle Controller\n")
+                service("window toggle Serial-Controller\n")
 
         service.register(
             "button/control/Controller",
             {
                 "label": _("Controller"),
                 "icon": icons8_connected_50,
                 "tip": _("Opens Controller Window"),
                 "action": controller_click,
                 "alt-action": (
                     (
-                        _("Opens USB-Controller"),
-                        lambda e: service("window toggle Controller\n"),
+                        _("Opens Serial-Controller"),
+                        lambda e: service("window toggle Serial-Controller\n"),
                     ),
                     (
-                        _("Opens Network-Controller"),
-                        lambda e: service("window toggle Network-Controller\n"),
+                        _("Opens TCP-Controller"),
+                        lambda e: service("window toggle TCP-Controller\n"),
                     ),
                 ),
             },
         )
         service.register(
             "button/device/Configuration",
             {
                 "label": _("Config"),
                 "icon": icons8_computer_support_50,
-                "tip": _("Opens device-specific configuration window"),
+                "tip": _("Opens device-specfic configuration window"),
                 "action": lambda v: service("window toggle Configuration\n"),
             },
         )
         service.register(
             "button/control/Pause",
             {
                 "label": _("Pause"),
@@ -90,17 +88,49 @@
             {
                 "label": _("Stop"),
                 "icon": icons8_emergency_stop_button_50,
                 "tip": _("Emergency stop the laser"),
                 "action": lambda v: service("estop\n"),
             },
         )
-        service.add_service_delegate(LihuiyuGui(service))
 
+        def has_red_dot_enabled():
+            # Does the current device have an active use_red_dot?
+            res = False
+            if hasattr(service, "use_red_dot"):
+                if service.use_red_dot:
+                    res = True
+            return res
 
-class LihuiyuGui:
+        service.register(
+            "button/control/Redlight",
+            {
+                "label": _("Red Dot On"),
+                "icon": icons8_quick_mode_on_50,
+                "tip": _("Turn Redlight On"),
+                "action": lambda v: service("red on\n"),
+                "toggle": {
+                    "label": _("Red Dot Off"),
+                    "action": lambda v: service("red off\n"),
+                    "icon": icons8_flash_off_50,
+                    "signal": "grbl_red_dot",
+                },
+                "rule_enabled": lambda v: has_red_dot_enabled(),
+            },
+        )
+
+        service.register(
+            "button/control/ClearAlarm",
+            {
+                "label": _("Clear Alarm"),
+                "icon": icons8_info_50,
+                "tip": _("Send a GRBL Clear Alarm command"),
+                "action": lambda v: service("clear_alarm\n"),
+            },
+        )
+        service.add_service_delegate(GRBLGui(service))
+
+
+class GRBLGui:
     def __init__(self, context):
         self.context = context
-
-    @signal_listener("controller")
-    def on_controller(self, origin, original_origin, *args):
-        self.context("window open Controller\n")
+        # This is a stub.
```

### Comparing `meerk40t-0.8.3000/meerk40t/lihuiyu/gui/lhyaccelgui.py` & `meerk40t-0.8.4000/meerk40t/lihuiyu/gui/lhyaccelgui.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/lihuiyu/gui/lhycontrollergui.py` & `meerk40t-0.8.4000/meerk40t/lihuiyu/gui/lhycontrollergui.py`

 * *Files 2% similar despite different names*

```diff
@@ -11,25 +11,15 @@
     icons8_emergency_stop_button_50,
     icons8_laser_beam_hazard_50,
     icons8_pause_50,
     icons8_play_50,
 )
 from meerk40t.gui.mwindow import MWindow
 from meerk40t.gui.wxutils import ScrolledPanel, StaticBoxSizer
-from meerk40t.kernel import (
-    STATE_ACTIVE,
-    STATE_BUSY,
-    STATE_END,
-    STATE_IDLE,
-    STATE_INITIALIZE,
-    STATE_PAUSE,
-    STATE_TERMINATE,
-    STATE_WAIT,
-    signal_listener,
-)
+from meerk40t.kernel import signal_listener
 
 _ = wx.GetTranslation
 
 _simple_width = 500
 _advanced_width = 952
 _default_height = 584
 
@@ -440,61 +430,61 @@
             return
         self.last_control_state = state
         button = self.button_controller_control
         if self.text_controller_status is None:
             return
         value = self.context.kernel.get_text_thread_state(state)
         self.text_controller_status.SetValue(str(value))
-        if state == STATE_INITIALIZE or state == STATE_END or state == STATE_IDLE:
+        if state in ("init", "end", "idle"):
 
             def f(event=None):
                 self.context("start\n")
                 self.context("hold\n")
 
             button.function = f
             button.SetBackgroundColour("#009900")
             button.SetLabel(_("Hold Controller"))
             button.SetBitmap(icons8_play_50.GetBitmap(use_theme=False))
             button.Enable(True)
-        elif state == STATE_BUSY:
+        elif state == "busy":
             button.SetBackgroundColour("#00dd00")
             button.SetLabel(_("LOCKED"))
             button.SetBitmap(icons8_play_50.GetBitmap(use_theme=False))
             button.Enable(False)
-        elif state == STATE_WAIT:
+        elif state == "wait":
 
             def f(event=None):
                 self.context("continue\n")
 
             button.function = f
             button.SetBackgroundColour("#dddd00")
             button.SetLabel(_("Force Continue"))
             button.SetBitmap(icons8_laser_beam_hazard_50.GetBitmap(use_theme=False))
             button.Enable(True)
-        elif state == STATE_PAUSE:
+        elif state == "pause":
 
             def f(event=None):
                 self.context("resume\n")
 
             button.function = f
             button.SetBackgroundColour("#00dd00")
             button.SetLabel(_("Resume Controller"))
             button.SetBitmap(icons8_play_50.GetBitmap(use_theme=False))
             button.Enable(True)
-        elif state == STATE_ACTIVE:
+        elif state == "active":
 
             def f(event=None):
                 self.context("hold\n")
 
             button.function = f
             button.SetBackgroundColour("#00ff00")
             button.SetLabel(_("Pause Controller"))
             button.SetBitmap(icons8_pause_50.GetBitmap(use_theme=False))
             button.Enable(True)
-        elif state == STATE_TERMINATE:
+        elif state == "terminate":
 
             def f(event=None):
                 self.context("abort\n")
 
             button.function = f
             button.SetBackgroundColour("#00ffff")
             button.SetLabel(_("Manual Reset"))
```

### Comparing `meerk40t-0.8.3000/meerk40t/lihuiyu/gui/lhydrivergui.py` & `meerk40t-0.8.4000/meerk40t/lihuiyu/gui/lhydrivergui.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/lihuiyu/gui/lhyoperationproperties.py` & `meerk40t-0.8.4000/meerk40t/lihuiyu/gui/lhyoperationproperties.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/lihuiyu/gui/tcpcontroller.py` & `meerk40t-0.8.4000/meerk40t/grbl/gui/tcpcontroller.py`

 * *Files 4% similar despite different names*

```diff
@@ -123,20 +123,17 @@
     def window_open(self):
         self.text_ip_host.SetValue(str(self.service.address))
         self.text_port.SetValue(str(self.service.port))
         self.text_buffer_max.SetValue("0")
         self.text_buffer_length.SetValue("0")
         self.on_network_update()
 
-    @signal_listener("network_update")
+    @signal_listener("interface_update")
     def on_network_update(self, origin=None, *args):
-        if not self.service.networked:
-            self.button_device_connect.Enable(False)
-        else:
-            self.button_device_connect.Enable(True)
+        self.button_device_connect.Enable(self.service.interface == "tcp")
 
     @signal_listener("tcp;status")
     def on_tcp_status(self, origin, state):
         self.text_status.SetValue(str(state))
         self.state = state
         if state == "uninitialized" or state == "disconnected":
             self.button_device_connect.SetBackgroundColour("#ffff00")
@@ -162,16 +159,19 @@
             self.gauge_buffer.SetRange(self.max)
         self.gauge_buffer.SetValue(min(status, self.gauge_buffer.GetRange()))
 
     def on_tcp_write(self, origin, status):
         self.text_port.SetValue(str(status))
 
     def on_button_start_connection(self, event):  # wxGlade: Controller.<event_handler>
-        if self.service.tcp is not None:
-            if self.state == "connected":
-                self.service.tcp.disconnect()
-            else:
-                self.service.tcp.connect()
+        connection = self.service.controller.connection
+        if connection is None:
+            # No connection cannot do anything.
+            return
+        if self.state == "connected":
+            connection.disconnect()
+        else:
+            connection.connect()
 
     @staticmethod
     def submenu():
-        return ("Device-Control", "TCP Controller")
+        return ("Device-Control", "GRBL TCP Controller")
```

### Comparing `meerk40t-0.8.3000/meerk40t/lihuiyu/interpreter.py` & `meerk40t-0.8.4000/meerk40t/lihuiyu/interpreter.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/lihuiyu/laserspeed.py` & `meerk40t-0.8.4000/meerk40t/lihuiyu/laserspeed.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/lihuiyu/loader.py` & `meerk40t-0.8.4000/meerk40t/lihuiyu/loader.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/lihuiyu/parser.py` & `meerk40t-0.8.4000/meerk40t/lihuiyu/parser.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/lihuiyu/plugin.py` & `meerk40t-0.8.4000/meerk40t/lihuiyu/plugin.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/lihuiyu/tcp_connection.py` & `meerk40t-0.8.4000/meerk40t/grbl/tcp_connection.py`

 * *Files 18% similar despite different names*

```diff
@@ -1,108 +1,79 @@
 """
-Lihuiyu TCP Connection
+TCP Connection
 
-Governs the TCP out connections for the lihuiyu device. This allows the output controller to write to a particular
-network location.
+Communicate with a TCP network destination with the GRBL driver.
 """
 
 import socket
 import threading
 import time
 
 
 class TCPOutput:
     def __init__(self, context, name=None):
         super().__init__()
         self.service = context
         self._stream = None
+        self._read_buffer_size = 1024
+        self.read_buffer = bytearray()
         self.name = name
 
-        self.lock = threading.RLock()
-        self.buffer = bytearray()
-        self.thread = None
+    @property
+    def connected(self):
+        return self._stream is not None
 
     def connect(self):
         try:
             self._stream = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
             self._stream.connect((self.service.address, self.service.port))
             self.service.signal("tcp;status", "connected")
         except TimeoutError:
             self.disconnect()
             self.service.signal("tcp;status", "timeout connect")
         except ConnectionError:
             self.disconnect()
             self.service.signal("tcp;status", "connection error")
-        except OSError as e:
-            self.disconnect()
-            self.service.signal("tcp;status", f"Host down {str(e)}")
         except socket.gaierror as e:
             self.disconnect()
             self.service.signal("tcp;status", "address resolve error")
         except socket.herror as e:
             self.disconnect()
             self.service.signal("tcp;status", f"herror: {str(e)}")
+        except OSError as e:
+            self.disconnect()
+            self.service.signal("tcp;status", f"Host down {str(e)}")
 
     def disconnect(self):
         self.service.signal("tcp;status", "disconnected")
         self._stream.close()
         self._stream = None
 
     def write(self, data):
         self.service.signal("tcp;write", data)
-        with self.lock:
-            self.buffer += data
-            self.service.signal("tcp;buffer", len(self.buffer))
-        self._start()
+        if isinstance(data, str):
+            data = bytes(data, "utf-8")
+        while data:
+            sent = self._stream.send(data)
+            if sent == len(data):
+                return
+            data = data[sent:]
 
     realtime_write = write
 
-    @property
-    def viewbuffer(self):
-        return self.buffer.decode("utf8")
-
-    def _start(self):
-        if self.thread is None:
-            self.thread = self.service.threaded(
-                self._sending,
-                thread_name=f"sender-{self.service.port}",
-                result=self._stop,
-            )
-
-    def _stop(self, *args):
-        self.thread = None
-
-    def _sending(self):
-        tries = 0
-        while True:
-            try:
-                if len(self.buffer):
-                    if self._stream is None:
-                        self.connect()
-                        if self._stream is None:
-                            return
-                    with self.lock:
-                        sent = self._stream.send(self.buffer)
-                        del self.buffer[:sent]
-                        self.service.signal("tcp;buffer", len(self.buffer))
-                    tries = 0
-                else:
-                    tries += 1
-                    time.sleep(0.1)
-            except (ConnectionError, OSError):
-                tries += 1
-                self.disconnect()
-                time.sleep(0.05)
-            if tries >= 20:
-                with self.lock:
-                    if len(self.buffer) == 0:
-                        break
+    def read(self):
+        f = self.read_buffer.find(b"\n")
+        if f == -1:
+            self.read_buffer += self._stream.recv(self._read_buffer_size)
+            f = self.read_buffer.find(b"\n")
+            if f == -1:
+                return
+        response = self.read_buffer[:f]
+        self.read_buffer = self.read_buffer[f + 1 :]
+        str_response = str(response, "latin-1")
+        str_response = str_response.strip()
+        return str_response
 
     def __repr__(self):
         if self.name is not None:
-            return (
-                f"TCPOutput('{self.service.address}:{self.service.port}','{self.name}')"
-            )
-        return f"TCPOutput('{self.service.address}:{self.service.port}')"
-
-    def __len__(self):
-        return len(self.buffer)
+            return f"TCPOutput('{self.service.location()}','{self.name}')"
+        return f"TCPOutput('{self.service.location()}')"
```

### Comparing `meerk40t-0.8.3000/meerk40t/moshi/builder.py` & `meerk40t-0.8.4000/meerk40t/moshi/builder.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/moshi/controller.py` & `meerk40t-0.8.4000/meerk40t/moshi/controller.py`

 * *Files 14% similar despite different names*

```diff
@@ -3,26 +3,14 @@
 
 Tasked with sending data to usb connection.
 """
 
 import threading
 import time
 
-from meerk40t.kernel import (
-    STATE_ACTIVE,
-    STATE_BUSY,
-    STATE_END,
-    STATE_IDLE,
-    STATE_INITIALIZE,
-    STATE_PAUSE,
-    STATE_TERMINATE,
-    STATE_UNKNOWN,
-    STATE_WAIT,
-)
-
 from .builder import (
     MOSHI_EPILOGUE,
     MOSHI_ESTOP,
     MOSHI_FREEMOTOR,
     MOSHI_LASER,
     MOSHI_PROLOGUE,
     MOSHI_READ,
@@ -75,15 +63,15 @@
     Send Epilogue
 
     Checks done before the Epilogue will have 205 state.
     """
 
     def __init__(self, context, channel=None, *args, **kwargs):
         self.context = context
-        self.state = STATE_UNKNOWN
+        self.state = "unknown"
         self.is_shutdown = False
 
         self._thread = None
         self._buffer = (
             bytearray()
         )  # Threadsafe buffered commands to be sent to controller.
 
@@ -248,45 +236,45 @@
         """
         if self._thread is None or not self._thread.is_alive():
             self._thread = self.context.threaded(
                 self._thread_data_send,
                 thread_name=f"MoshiPipe({self.context.path})",
                 result=self.stop,
             )
-            self.update_state(STATE_INITIALIZE)
+            self.update_state("init")
 
     def pause(self):
         """
         Pause simply holds the controller from sending any additional packets.
 
         If this state change is done from INITIALIZE it will start the processing.
         Otherwise, it must be done from ACTIVE or IDLE.
         """
-        if self.state == STATE_INITIALIZE:
+        if self.state == "init":
             self.start()
-            self.update_state(STATE_PAUSE)
-        if self.state == STATE_ACTIVE or self.state == STATE_IDLE:
-            self.update_state(STATE_PAUSE)
+            self.update_state("pause")
+        if self.state in ("active", "idle"):
+            self.update_state("pause")
 
     def resume(self):
         """
         Resume can only be called from PAUSE.
         """
-        if self.state == STATE_PAUSE:
-            self.update_state(STATE_ACTIVE)
+        if self.state == "pause":
+            self.update_state("active")
 
     def estop(self):
         """
         Abort the current buffer and data queue.
         """
         self._buffer = bytearray()
         self._programs.clear()
         self.context.signal("pipe;buffer", 0)
         self.realtime_stop()
-        self.update_state(STATE_TERMINATE)
+        self.update_state("terminate")
         self.pipe_channel("Control Request: Stop")
 
     def stop(self, *args):
         """
         Start the shutdown of the local send thread.
         """
         if self._thread is not None:
@@ -330,29 +318,29 @@
         while len(self._buffer) != 0:
             queue_processed = self.process_buffer()
             self.refuse_counts = 0
 
             if queue_processed:
                 # Packet was sent.
                 if self.state not in (
-                    STATE_PAUSE,
-                    STATE_BUSY,
-                    STATE_ACTIVE,
-                    STATE_TERMINATE,
+                    "pause",
+                    "busy",
+                    "active",
+                    "terminate",
                 ):
-                    self.update_state(STATE_ACTIVE)
+                    self.update_state("active")
                 self.count = 0
             else:
                 # No packet could be sent.
                 if self.state not in (
-                    STATE_PAUSE,
-                    STATE_BUSY,
-                    STATE_TERMINATE,
+                    "pause",
+                    "busy",
+                    "terminate",
                 ):
-                    self.update_state(STATE_IDLE)
+                    self.update_state("idle")
                 if self.count > 50:
                     self.count = 50
                 time.sleep(0.02 * self.count)
                 # will tick up to 1 second waits if there's never a queue.
                 self.count += 1
 
     def _thread_data_send(self):
@@ -364,17 +352,17 @@
         self._main_lock.acquire(True)
         self.count = 0
         self.is_shutdown = False
 
         while True:
             self.pipe_channel("While Loop")
             try:
-                if self.state == STATE_INITIALIZE:
+                if self.state == "init":
                     # If we are initialized. Change that to active since we're running.
-                    self.update_state(STATE_ACTIVE)
+                    self.update_state("active")
                 if self.is_shutdown:
                     break
                 if len(self._buffer) == 0 and len(self._programs) == 0:
                     self.pipe_channel("Nothing to process")
                     break  # There is nothing to run.
                 if self._connection is None:
                     self.open()
@@ -424,15 +412,15 @@
                     self.close()
                 except ConnectionError:
                     pass
                 continue
         self.context.signal("pipe;running", False)
         self._thread = None
         self.is_shutdown = False
-        self.update_state(STATE_END)
+        self.update_state("end")
         self._main_lock.release()
         self.pipe_channel("Send Thread Finished...")
 
     def process_buffer(self):
         """
         Attempts to process the program send from the buffer.
 
@@ -484,15 +472,15 @@
             self.recv_channel(str(self._status))
 
     def wait_until_accepting_packets(self):
         """
         Wait until the device can accept packets.
         """
         i = 0
-        while self.state != STATE_TERMINATE:
+        while self.state != "terminate":
             self.update_status()
             status = self._status[1]
             if status == 0:
                 raise ConnectionError
             if status == STATUS_ERROR:
                 raise ConnectionRefusedError
             if status == STATUS_OK:
@@ -506,22 +494,22 @@
     def wait_finished(self):
         """
         Wait until the device has finished the current sending buffer.
         """
         self.pipe_channel("Wait Finished")
         i = 0
         original_state = self.state
-        if self.state != STATE_PAUSE:
+        if self.state != "pause":
             self.pause()
 
         while True:
-            if self.state != STATE_WAIT:
-                if self.state == STATE_TERMINATE:
+            if self.state != "wait":
+                if self.state == "terminate":
                     return  # Abort all the processes was requested. This state change would be after clearing.
-                self.update_state(STATE_WAIT)
+                self.update_state("wait")
             self.update_status()
             status = self._status[1]
             if status == 0:
                 self.close()
                 self.open()
                 continue
             if status == STATUS_OK:
```

### Comparing `meerk40t-0.8.3000/meerk40t/moshi/device.py` & `meerk40t-0.8.4000/meerk40t/moshi/device.py`

 * *Files 3% similar despite different names*

```diff
@@ -2,15 +2,15 @@
 Moshiboard Device
 
 
 Defines the interactions between the device service and the meerk40t's viewport.
 Registers relevant commands and options.
 """
 
-from meerk40t.kernel import STATE_ACTIVE, STATE_PAUSE, Service
+from meerk40t.kernel import Service
 
 from ..core.spoolers import Spooler
 from ..core.units import UNITS_PER_MIL, Length, ViewPort
 from .controller import MoshiController
 from .driver import MoshiDriver
 
 
@@ -319,34 +319,34 @@
                 channel("Usb is not connected.")
 
         @self.console_command("start", help=_("Start Pipe to Controller"))
         def pipe_start(command, channel, _, data=None, **kwargs):
             """
             Start output sending.
             """
-            self.controller.update_state(STATE_ACTIVE)
+            self.controller.update_state("active")
             self.controller.start()
             channel("Moshi Channel Started.")
 
         @self.console_command("hold", input_type="moshi", help=_("Hold Controller"))
         def pipe_pause(command, channel, _, **kwargs):
             """
             Pause output sending.
             """
-            self.controller.update_state(STATE_PAUSE)
+            self.controller.update_state("pause")
             self.controller.pause()
             channel(_("Moshi Channel Paused."))
             self.signal("pause")
 
         @self.console_command("resume", input_type="moshi", help=_("Resume Controller"))
         def pipe_resume(command, channel, _, **kwargs):
             """
             Resume output sending.
             """
-            self.controller.update_state(STATE_ACTIVE)
+            self.controller.update_state("active")
             self.controller.start()
             channel(_("Moshi Channel Resumed."))
             self.signal("pause")
 
         @self.console_command(("estop", "abort"), help=_("Abort Job"))
         def pipe_abort(command, channel, _, **kwargs):
             """
@@ -385,21 +385,20 @@
         @self.console_command(
             "viewport_update",
             hidden=True,
             help=_("Update moshi dimension parameters"),
         )
         def codes_update(**kwargs):
             self.origin_x = 1.0 if self.home_right else 0.0
-            self.show_flip_x = self.home_right
-            self.show_origin_x = self.origin_x
             self.origin_y = 1.0 if self.home_bottom else 0.0
-            self.show_origin_y = self.origin_y
-            self.show_flip_y = self.home_bottom
             self.realize()
 
+    def service_attach(self, *args, **kwargs):
+        self.realize()
+
     @property
     def viewbuffer(self):
         return self.controller.viewbuffer()
 
     @property
     def current(self):
         """
@@ -416,7 +415,8 @@
 
     def realize(self, origin=None):
         self.width = self.bedwidth
         self.height = self.bedheight
         self.origin_x = 1.0 if self.home_right else 0.0
         self.origin_y = 1.0 if self.home_bottom else 0.0
         super().realize()
+        self.space.update_bounds(0, 0, self.width, self.height)
```

### Comparing `meerk40t-0.8.3000/meerk40t/moshi/driver.py` & `meerk40t-0.8.4000/meerk40t/moshi/driver.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/moshi/gui/gui.py` & `meerk40t-0.8.4000/meerk40t/moshi/gui/gui.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/moshi/gui/moshicontrollergui.py` & `meerk40t-0.8.4000/meerk40t/moshi/gui/moshicontrollergui.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/moshi/gui/moshidrivergui.py` & `meerk40t-0.8.4000/meerk40t/moshi/gui/moshidrivergui.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/moshi/plugin.py` & `meerk40t-0.8.4000/meerk40t/moshi/plugin.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/network/console_server.py` & `meerk40t-0.8.4000/meerk40t/network/console_server.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/network/tcp_server.py` & `meerk40t-0.8.4000/meerk40t/network/tcp_server.py`

 * *Files 12% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 import socket
 
-from meerk40t.kernel import STATE_TERMINATE, Module
+from meerk40t.kernel import Module
 
 
 def plugin(kernel, lifecycle=None):
     if lifecycle == "register":
         _ = kernel.translation
         kernel.register("module/TCPServer", TCPServer)
 
@@ -29,40 +29,39 @@
         self.events_channel = self.context.channel(f"server-tcp-{port}")
         self.data_channel = self.context.channel(f"data-tcp-{port}")
         self.context.threaded(
             self.run_tcp_delegater, thread_name=f"tcp-{port}", daemon=True
         )
 
     def stop(self):
-        self.state = STATE_TERMINATE
+        self.state = "terminate"
 
     def module_close(self, *args, **kwargs):
         _ = self.context._
         self.events_channel(_("Shutting down server."))
-        self.state = STATE_TERMINATE
+        self.state = "terminate"
         if self.socket is not None:
             self.socket.close()
             self.socket = None
 
     def run_tcp_delegater(self):
         """
         TCP Run is a connection thread delegate. Any connections are given a different threaded
         handle to interact with that connection. This thread here waits for sockets and delegates.
         """
         _ = self.context._
         self.socket = socket.socket()
-        # self.socket.settimeout(0)
         try:
             self.socket.bind(("", self.port))
             self.socket.listen(1)
         except OSError:
             self.events_channel(_("Could not start listening."))
             return
         handle = 1
-        while self.state != STATE_TERMINATE:
+        while self.state != "terminate":
             self.events_channel(
                 _("Listening {name} on port {port}...").format(
                     name=self.name, port=self.port
                 )
             )
             connection = None
             address = None
@@ -107,15 +106,15 @@
                         self.data_channel(f"<-- {str(e)}")
                     except (ConnectionAbortedError, ConnectionResetError):
                         connection.close()
 
             recv = self.context.channel(f"{self.name}/recv", pure=True)
             send_channel_name = f"{self.name}/send"
             self.context.channel(send_channel_name, pure=True).watch(send)
-            while self.state != STATE_TERMINATE:
+            while self.state != "terminate":
                 try:
                     data_from_socket = connection.recv(1024)
                     if len(data_from_socket):
                         self.data_channel(f"--> {str(data_from_socket)}")
                     else:
                         break
                     recv(data_from_socket)
```

### Comparing `meerk40t-0.8.3000/meerk40t/network/udp_server.py` & `meerk40t-0.8.4000/meerk40t/network/udp_server.py`

 * *Files 10% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 import socket
 
-from meerk40t.kernel import STATE_END, STATE_TERMINATE, Module
+from meerk40t.kernel import Module
 
 
 def plugin(kernel, lifecycle=None):
     if lifecycle == "register":
         _ = kernel.translation
         kernel.register("module/UDPServer", UDPServer)
 
@@ -42,15 +42,15 @@
         _ = self.context._
         self.context.channel(f"{self.name}/send").unwatch(self.send)
         # We stop watching the `send channel`
         self.events_channel(_("Shutting down server."))
         if self.socket is not None:
             self.socket.close()
             self.socket = None
-        self.state = STATE_TERMINATE
+        self.state = "terminate"
 
     def send(self, message):
         _ = self.context._
         if self.udp_address is None:
             self.events_channel(
                 _(
                     "No UDP packet can be sent as reply to a host that has never made contact."
@@ -61,15 +61,15 @@
 
     def run_udp_listener(self):
         _ = self.context._
         try:
             self.events_channel(
                 _("UDP Socket({port}) Listening.").format(port=self.port)
             )
-            while self.state != STATE_END and self.state != STATE_TERMINATE:
+            while self.state not in ("end", "terminate"):
                 try:
                     message, address = self.socket.recvfrom(1024)
                 except (socket.timeout, AttributeError):
                     continue
                 if address is not None:
                     self.udp_address = address
                 self.recv(message)
```

### Comparing `meerk40t-0.8.3000/meerk40t/newly/controller.py` & `meerk40t-0.8.4000/meerk40t/newly/controller.py`

 * *Files 0% similar despite different names*

```diff
@@ -447,14 +447,21 @@
         elif right:
             self._last_x += count
         elif top:
             self._last_y -= count
         elif bottom:
             self._last_y += count
 
+    def _raster_jog(self, x, y, raster_cut):
+        self.goto(x, y)
+        self._set_raster_mode()
+        self.set_settings(raster_cut.settings)
+        self._set_mode = "raster"
+        self._commit_settings()
+
     def raster(self, raster_cut: RasterCut):
         """
         Run a raster cut with scanlines and default actions.
 
         @param raster_cut:
         @return:
         """
@@ -483,37 +490,34 @@
                         scanline.clear()
 
         self("IN")
         self._clear_settings()
 
         previous_x, previous_y = raster_cut.plot.initial_position_in_scene()
 
-        self.goto(previous_x, previous_y)
-
-        self._set_raster_mode()
-        self.set_settings(raster_cut.settings)
-        self._set_mode = "raster"
-
-        self._commit_settings()
+        self._raster_jog(previous_x, previous_y, raster_cut)
 
         if raster_cut.horizontal:
             self.mode = "raster_horizontal"
             for x, y, on in raster_cut.plot.plot():
                 dx = x - previous_x
                 dy = y - previous_y
                 if dx < 0 and increasing or dx > 0 and not increasing:
                     # X direction has switched.
                     commit_scanline()
                     increasing = not increasing
                 if dy != 0:
                     # We are moving in the Y direction.
                     commit_scanline()
-                    self._relative = True
-                    self("PR")
-                    self._goto(x, y)  # remain standard rastermode
+                    if abs(dy) > self.service.max_raster_jog:
+                        self._raster_jog(x, y, raster_cut)
+                    else:
+                        self._relative = True
+                        self("PR")
+                        self._goto(x, y)  # remain standard rastermode
                 if dx != 0:
                     # Normal move, extend bytes.
                     scanline.extend([int(on)] * abs(dx))
                 previous_x, previous_y = x, y
         else:
             self.mode = "raster_vertical"
             for x, y, on in raster_cut.plot.plot():
@@ -522,17 +526,20 @@
                 if dy < 0 and increasing or dy > 0 and not increasing:
                     # Y direction has switched.
                     commit_scanline()
                     increasing = not increasing
                 if dx != 0:
                     # We are moving in the X direction.
                     commit_scanline()
-                    self._relative = True
-                    self("PR")
-                    self._goto(x, y)  # remain standard rastermode
+                    if abs(dx) > self.service.max_raster_jog:
+                        self._raster_jog(x, y, raster_cut)
+                    else:
+                        self._relative = True
+                        self("PR")
+                        self._goto(x, y)  # remain standard rastermode
                 if dy != 0:
                     # Normal move, extend bytes
                     scanline.extend([int(on)] * abs(dy))
                 previous_x, previous_y = x, y
         commit_scanline()
 
     #######################
@@ -544,15 +551,14 @@
         Sets the primary settings. Rapid, frequency, speed, and timings.
 
         @param settings: The current settings dictionary
         @return:
         """
         if "speed" in settings:
             self._set_speed = settings.get("speed")
-            self._set_mode = "vector"
         if "power" in settings:
             self._set_power = settings.get("power")
         if "pwm_frequency" in settings:
             self._set_pwm_freq = settings.get("pwm_frequency")
 
     #######################
     # PLOTLIKE SHORTCUTS
@@ -563,16 +569,29 @@
         self.connect_if_needed()
         self.connection.write(index=self._machine_index, data=data)
 
     def frame(self, x, y):
         self._set_frame_mode()
         self._mark(x, y)
 
-    def mark(self, x, y):
+    def mark(self, x, y, settings=None, power=None, speed=None):
+        """
+        Mark either sets default vector settings or sets the settings based on the settings object provided.
+        @param x:
+        @param y:
+        @param settings:
+        @return:
+        """
         self._set_vector_mode()
+        if settings is not None:
+            self.set_settings(settings)
+        if power is not None:
+            self._set_power = power
+        if speed is not None:
+            self._set_speed = speed
         self._mark(x, y)
 
     def _mark(self, x, y):
         dx = int(round(x - self._last_x))
         dy = int(round(y - self._last_y))
         if dx == 0 and dy == 0:
             return
@@ -809,14 +828,17 @@
         self._set_mode = None
         if new_mode != self._mode:
             self._mode = new_mode
 
             # Old speed and power are void on mode change.
             self._speed = None
             self._power = None
+            self._corner_speed = None
+            self._acceleration_length = None
+            self._backlash = None
 
     #######################
     # Commit DC Info
     #######################
 
     def _commit_cut_dc(self):
         if self._set_cut_dc is None and self._cut_dc is not None:
```

### Comparing `meerk40t-0.8.3000/meerk40t/newly/device.py` & `meerk40t-0.8.4000/meerk40t/newly/device.py`

 * *Files 0% similar despite different names*

```diff
@@ -343,14 +343,26 @@
                 "default": 100,
                 "type": int,
                 "label": _("Move DC"),
                 "tip": _("Set the current for the regular movements."),
                 "section": "_10_Parameters",
                 "subsection": "_40_Current",
             },
+            {
+                "attr": "max_raster_jog",
+                "object": self,
+                "default": 15,
+                "type": int,
+                "label": _("Maximum Raster Jog"),
+                "tip": _(
+                    "Maximum distance allowed to be done during a raster step/jog"
+                ),
+                "section": "_10_Parameters",
+                "subsection": "_50_Raster",
+            },
         ]
         self.register_choices("newly-specific", choices)
 
         choices = [
             {
                 "attr": "default_cut_speed",
                 "object": self,
@@ -647,25 +659,29 @@
             "viewport_update",
             hidden=True,
             help=_("Update newly flips for movement"),
         )
         def codes_update(**kwargs):
             self.realize()
 
+    def service_attach(self, *args, **kwargs):
+        self.realize()
+
     @signal_listener("flip_x")
     @signal_listener("flip_y")
     @signal_listener("swap_xy")
     @signal_listener("v_dpi")
     @signal_listener("h_dpi")
     def realize(self, origin=None, *args):
         self.width = self.bedwidth
         self.height = self.bedheight
         self.native_scale_x = UNITS_PER_INCH / self.h_dpi
         self.native_scale_y = UNITS_PER_INCH / self.v_dpi
         super().realize()
+        self.space.update_bounds(0, 0, self.width, self.height)
 
     @property
     def current(self):
         """
         @return: the location in nm for the current known x value.
         """
         return self.device_to_scene_position(
```

### Comparing `meerk40t-0.8.3000/meerk40t/newly/driver.py` & `meerk40t-0.8.4000/meerk40t/newly/driver.py`

 * *Files 2% similar despite different names*

```diff
@@ -134,29 +134,27 @@
         @return:
         """
         last_on = None
         con = self.connection
         queue = self.queue
         self.queue = list()
         for q in queue:
-            settings = q.settings
             con.program_mode()
-            con.set_settings(settings)
             # LOOP CHECKS
             if self._aborting:
                 con.abort()
                 self._aborting = False
                 return
             if isinstance(q, LineCut):
                 con.sync()
                 last_x, last_y = con.get_last_xy()
                 x, y = q.start
                 if last_x != x or last_y != y:
                     con.goto(x, y)
-                con.mark(*q.end)
+                con.mark(*q.end, settings=q.settings)
                 con.update()
             elif isinstance(q, (QuadCut, CubicCut)):
                 con.sync()
                 last_x, last_y = con.get_last_xy()
                 x, y = q.start
                 if last_x != x or last_y != y:
                     con.goto(x, y)
@@ -169,43 +167,39 @@
                         con.abort()
                         self._aborting = False
                         return
                     while self.paused:
                         time.sleep(0.05)
 
                     p = q.point(t)
-                    con.mark(*p)
+                    con.mark(*p, settings=q.settings)
                     t += step_size
                 con.update()
             elif isinstance(q, PlotCut):
                 con.sync()
                 last_x, last_y = con.get_last_xy()
                 x, y = q.start
                 if last_x != x or last_y != y:
                     con.goto(x, y)
+
+                max_power = float(q.settings.get("power", self.service.default_power))
+                percent_power = max_power / 10.0
+
                 for ox, oy, on, x, y in q.plot:
                     # LOOP CHECKS
                     if self._aborting:
                         con.abort()
                         self._aborting = False
                         return
                     while self.paused:
                         time.sleep(0.05)
 
                     # q.plot can have different on values, these are parsed
-                    if last_on is None or on != last_on:
-                        # No power change.
-                        last_on = on
-                        max_power = float(
-                            q.settings.get("power", self.service.default_power)
-                        )
-                        percent_power = max_power / 10.0
-                        # Max power is the percent max power, scaled by the pixel power.
-                        con.power(percent_power * on)
-                    con.mark(x, y)
+                    # Max power is the percent max power, scaled by the pixel power.
+                    con.mark(x, y, settings=q.settings, power=percent_power * on)
                     con.update()
             elif isinstance(q, DwellCut):
                 con.dwell(q.dwell_time)
             elif isinstance(q, WaitCut):
                 con.wait(q.dwell_time)
             elif isinstance(q, HomeCut):
                 con.goto(0, 0)
```

### Comparing `meerk40t-0.8.3000/meerk40t/newly/gui/gui.py` & `meerk40t-0.8.4000/meerk40t/newly/gui/gui.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/newly/gui/newlyconfig.py` & `meerk40t-0.8.4000/meerk40t/newly/gui/newlyconfig.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/newly/gui/newlycontroller.py` & `meerk40t-0.8.4000/meerk40t/newly/gui/newlycontroller.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/newly/gui/operationproperties.py` & `meerk40t-0.8.4000/meerk40t/newly/gui/operationproperties.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/newly/mock_connection.py` & `meerk40t-0.8.4000/meerk40t/newly/mock_connection.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/newly/newly_params.py` & `meerk40t-0.8.4000/meerk40t/newly/newly_params.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/newly/plugin.py` & `meerk40t-0.8.4000/meerk40t/newly/plugin.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/newly/usb_connection.py` & `meerk40t-0.8.4000/meerk40t/newly/usb_connection.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/rotary/gui/gui.py` & `meerk40t-0.8.4000/meerk40t/rotary/gui/gui.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/rotary/gui/rotarysettings.py` & `meerk40t-0.8.4000/meerk40t/rotary/gui/rotarysettings.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/rotary/rotary.py` & `meerk40t-0.8.4000/meerk40t/rotary/rotary.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/ruida/control.py` & `meerk40t-0.8.4000/meerk40t/ruida/control.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/ruida/controller.py` & `meerk40t-0.8.4000/meerk40t/ruida/controller.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/ruida/device.py` & `meerk40t-0.8.4000/meerk40t/ruida/device.py`

 * *Files 6% similar despite different names*

```diff
@@ -168,18 +168,22 @@
         )
         self.state = 0
 
         self.viewbuffer = ""
 
         _ = self.kernel.translation
 
+    def service_attach(self, *args, **kwargs):
+        self.realize()
+
     def realize(self, origin=None):
         self.width = self.bedwidth
         self.height = self.bedheight
         super().realize()
+        self.space.update_bounds(0, 0, self.width, self.height)
 
     @property
     def current(self):
         """
         @return: the location in scene units for the current known x value.
         """
         return 0, 0
```

### Comparing `meerk40t-0.8.3000/meerk40t/ruida/driver.py` & `meerk40t-0.8.4000/meerk40t/ruida/driver.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/ruida/emulator.py` & `meerk40t-0.8.4000/meerk40t/ruida/emulator.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/ruida/gui/gui.py` & `meerk40t-0.8.4000/meerk40t/ruida/gui/gui.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/ruida/gui/ruidaconfig.py` & `meerk40t-0.8.4000/meerk40t/ruida/gui/ruidaconfig.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/ruida/gui/ruidacontroller.py` & `meerk40t-0.8.4000/meerk40t/ruida/gui/ruidacontroller.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/ruida/gui/ruidaoperationproperties.py` & `meerk40t-0.8.4000/meerk40t/ruida/gui/ruidaoperationproperties.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/ruida/loader.py` & `meerk40t-0.8.4000/meerk40t/ruida/loader.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/ruida/mock_connection.py` & `meerk40t-0.8.4000/meerk40t/ruida/mock_connection.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/ruida/plugin.py` & `meerk40t-0.8.4000/meerk40t/ruida/plugin.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/ruida/rdjob.py` & `meerk40t-0.8.4000/meerk40t/ruida/rdjob.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/svgelements.py` & `meerk40t-0.8.4000/meerk40t/svgelements.py`

 * *Files 0% similar despite different names*

```diff
@@ -70,15 +70,15 @@
 00000450: 6f77 2061 7320 616e 2069 6d70 6f72 740d  ow as an import.
 00000460: 0a61 6e64 2074 6865 2041 7263 2063 616e  .and the Arc can
 00000470: 2064 6f20 6578 6163 7420 6172 6320 6361   do exact arc ca
 00000480: 6c63 756c 6174 696f 6e73 2069 6620 7363  lculations if sc
 00000490: 6970 7920 6973 2069 6e73 7461 6c6c 6564  ipy is installed
 000004a0: 2e0d 0a22 2222 0d0a 0d0a 5356 4745 4c45  ..."""....SVGELE
 000004b0: 4d45 4e54 535f 5645 5253 494f 4e20 3d20  MENTS_VERSION = 
-000004c0: 2231 2e39 2e31 220d 0a0d 0a4d 494e 5f44  "1.9.1"....MIN_D
+000004c0: 2231 2e39 2e33 220d 0a0d 0a4d 494e 5f44  "1.9.3"....MIN_D
 000004d0: 4550 5448 203d 2035 0d0a 4552 524f 5220  EPTH = 5..ERROR 
 000004e0: 3d20 3165 2d31 320d 0a0d 0a6d 6178 5f64  = 1e-12....max_d
 000004f0: 6570 7468 203d 2030 0d0a 0d0a 2320 5356  epth = 0....# SV
 00000500: 4720 5354 4154 4943 2056 414c 5545 530d  G STATIC VALUES.
 00000510: 0a44 4546 4155 4c54 5f50 5049 203d 2039  .DEFAULT_PPI = 9
 00000520: 362e 300d 0a53 5647 5f4e 414d 455f 5441  6.0..SVG_NAME_TA
 00000530: 4720 3d20 2273 7667 220d 0a53 5647 5f41  G = "svg"..SVG_A
@@ -9396,15 +9396,15 @@
 00024b30: 2020 2020 2020 7265 7475 726e 2022 6c20        return "l 
 00024b40: 2573 2220 2520 2873 656c 662e 656e 6420  %s" % (self.end 
 00024b50: 2d20 6375 7272 656e 745f 706f 696e 7429  - current_point)
 00024b60: 0d0a 0d0a 0d0a 636c 6173 7320 5175 6164  ......class Quad
 00024b70: 7261 7469 6342 657a 6965 7228 4375 7276  raticBezier(Curv
 00024b80: 6529 3a0d 0a20 2020 2022 2222 5265 7072  e):..    """Repr
 00024b90: 6573 656e 7473 2051 7561 6472 6174 6963  esents Quadratic
-00024ba0: 2042 657a 6965 7220 636f 6d6d 616e 6473   Bezier commands
+00024ba0: 2042 e97a 6965 7220 636f 6d6d 616e 6473   B.zier commands
 00024bb0: 2e22 2222 0d0a 0d0a 2020 2020 6465 6620  ."""....    def 
 00024bc0: 5f5f 696e 6974 5f5f 2873 656c 662c 2073  __init__(self, s
 00024bd0: 7461 7274 2c20 636f 6e74 726f 6c2c 2065  tart, control, e
 00024be0: 6e64 2c20 2a2a 6b77 6172 6773 293a 0d0a  nd, **kwargs):..
 00024bf0: 2020 2020 2020 2020 4375 7276 652e 5f5f          Curve.__
 00024c00: 696e 6974 5f5f 2873 656c 662c 2073 7461  init__(self, sta
 00024c10: 7274 2c20 656e 642c 202a 2a6b 7761 7267  rt, end, **kwarg
@@ -9780,15 +9780,15 @@
 00026330: 6e74 2c0d 0a20 2020 2020 2020 2020 2020  nt,..           
 00026340: 2020 2020 2020 2020 2073 656c 662e 656e           self.en
 00026350: 6420 2d20 6375 7272 656e 745f 706f 696e  d - current_poin
 00026360: 742c 0d0a 2020 2020 2020 2020 2020 2020  t,..            
 00026370: 2020 2020 290d 0a0d 0a0d 0a63 6c61 7373      )......class
 00026380: 2043 7562 6963 4265 7a69 6572 2843 7572   CubicBezier(Cur
 00026390: 7665 293a 0d0a 2020 2020 2222 2252 6570  ve):..    """Rep
-000263a0: 7265 7365 6e74 7320 4375 6269 6320 4265  resents Cubic Be
+000263a0: 7265 7365 6e74 7320 4375 6269 6320 42e9  resents Cubic B.
 000263b0: 7a69 6572 2063 6f6d 6d61 6e64 732e 2222  zier commands.""
 000263c0: 220d 0a0d 0a20 2020 2064 6566 205f 5f69  "....    def __i
 000263d0: 6e69 745f 5f28 7365 6c66 2c20 7374 6172  nit__(self, star
 000263e0: 742c 2063 6f6e 7472 6f6c 312c 2063 6f6e  t, control1, con
 000263f0: 7472 6f6c 322c 2065 6e64 2c20 2a2a 6b77  trol2, end, **kw
 00026400: 6172 6773 293a 0d0a 2020 2020 2020 2020  args):..        
 00026410: 4375 7276 652e 5f5f 696e 6974 5f5f 2873  Curve.__init__(s
@@ -10030,330 +10030,330 @@
 000272d0: 6572 7320 3d20 5b30 2c20 315d 0d0a 2020  ers = [0, 1]..  
 000272e0: 2020 2020 2020 6120 3d20 5b63 5b76 5d20        a = [c[v] 
 000272f0: 666f 7220 6320 696e 2073 656c 665d 0d0a  for c in self]..
 00027300: 2020 2020 2020 2020 6465 6e6f 6d20 3d20          denom = 
 00027310: 615b 305d 202d 2033 202a 2061 5b31 5d20  a[0] - 3 * a[1] 
 00027320: 2b20 3320 2a20 615b 325d 202d 2061 5b33  + 3 * a[2] - a[3
 00027330: 5d0d 0a20 2020 2020 2020 2069 6620 6162  ]..        if ab
-00027340: 7328 6465 6e6f 6d29 203e 3d20 3165 2d31  s(denom) >= 1e-1
-00027350: 323a 0d0a 2020 2020 2020 2020 2020 2020  2:..            
-00027360: 6465 6c74 6120 3d20 280d 0a20 2020 2020  delta = (..     
-00027370: 2020 2020 2020 2020 2020 2061 5b31 5d20             a[1] 
-00027380: 2a20 615b 315d 202d 2028 615b 305d 202b  * a[1] - (a[0] +
-00027390: 2061 5b31 5d29 202a 2061 5b32 5d20 2b20   a[1]) * a[2] + 
-000273a0: 615b 325d 202a 2061 5b32 5d20 2b20 2861  a[2] * a[2] + (a
-000273b0: 5b30 5d20 2d20 615b 315d 2920 2a20 615b  [0] - a[1]) * a[
-000273c0: 335d 0d0a 2020 2020 2020 2020 2020 2020  3]..            
-000273d0: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
-000273e0: 6620 6465 6c74 6120 3e3d 2030 3a20 2023  f delta >= 0:  #
-000273f0: 206f 7468 6572 7769 7365 206e 6f20 6c6f   otherwise no lo
-00027400: 6361 6c20 6578 7472 656d 610d 0a20 2020  cal extrema..   
-00027410: 2020 2020 2020 2020 2020 2020 2073 7164               sqd
-00027420: 656c 7461 203d 2073 7172 7428 6465 6c74  elta = sqrt(delt
-00027430: 6129 0d0a 2020 2020 2020 2020 2020 2020  a)..            
-00027440: 2020 2020 7461 7520 3d20 615b 305d 202d      tau = a[0] -
-00027450: 2032 202a 2061 5b31 5d20 2b20 615b 325d   2 * a[1] + a[2]
-00027460: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00027470: 2020 7231 203d 2028 7461 7520 2b20 7371    r1 = (tau + sq
-00027480: 6465 6c74 6129 202f 2064 656e 6f6d 0d0a  delta) / denom..
-00027490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000274a0: 7232 203d 2028 7461 7520 2d20 7371 6465  r2 = (tau - sqde
-000274b0: 6c74 6129 202f 2064 656e 6f6d 0d0a 2020  lta) / denom..  
-000274c0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-000274d0: 2030 203c 2072 3120 3c20 313a 0d0a 2020   0 < r1 < 1:..  
+00027340: 7328 6465 6e6f 6d29 203e 3d20 3165 2d38  s(denom) >= 1e-8
+00027350: 3a0d 0a20 2020 2020 2020 2020 2020 2064  :..            d
+00027360: 656c 7461 203d 2028 0d0a 2020 2020 2020  elta = (..      
+00027370: 2020 2020 2020 2020 2020 615b 315d 202a            a[1] *
+00027380: 2061 5b31 5d20 2d20 2861 5b30 5d20 2b20   a[1] - (a[0] + 
+00027390: 615b 315d 2920 2a20 615b 325d 202b 2061  a[1]) * a[2] + a
+000273a0: 5b32 5d20 2a20 615b 325d 202b 2028 615b  [2] * a[2] + (a[
+000273b0: 305d 202d 2061 5b31 5d29 202a 2061 5b33  0] - a[1]) * a[3
+000273c0: 5d0d 0a20 2020 2020 2020 2020 2020 2029  ]..            )
+000273d0: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+000273e0: 2064 656c 7461 203e 3d20 303a 2020 2320   delta >= 0:  # 
+000273f0: 6f74 6865 7277 6973 6520 6e6f 206c 6f63  otherwise no loc
+00027400: 616c 2065 7874 7265 6d61 0d0a 2020 2020  al extrema..    
+00027410: 2020 2020 2020 2020 2020 2020 7371 6465              sqde
+00027420: 6c74 6120 3d20 7371 7274 2864 656c 7461  lta = sqrt(delta
+00027430: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00027440: 2020 2074 6175 203d 2061 5b30 5d20 2d20     tau = a[0] - 
+00027450: 3220 2a20 615b 315d 202b 2061 5b32 5d0d  2 * a[1] + a[2].
+00027460: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00027470: 2072 3120 3d20 2874 6175 202b 2073 7164   r1 = (tau + sqd
+00027480: 656c 7461 2920 2f20 6465 6e6f 6d0d 0a20  elta) / denom.. 
+00027490: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+000274a0: 3220 3d20 2874 6175 202d 2073 7164 656c  2 = (tau - sqdel
+000274b0: 7461 2920 2f20 6465 6e6f 6d0d 0a20 2020  ta) / denom..   
+000274c0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+000274d0: 3020 3c20 7231 203c 2031 3a0d 0a20 2020  0 < r1 < 1:..   
 000274e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000274f0: 2020 6c6f 6361 6c5f 6578 7472 656d 697a    local_extremiz
-00027500: 6572 732e 6170 7065 6e64 2872 3129 0d0a  ers.append(r1)..
-00027510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027520: 6966 2030 203c 2072 3220 3c20 313a 0d0a  if 0 < r2 < 1:..
+000274f0: 206c 6f63 616c 5f65 7874 7265 6d69 7a65   local_extremize
+00027500: 7273 2e61 7070 656e 6428 7231 290d 0a20  rs.append(r1).. 
+00027510: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00027520: 6620 3020 3c20 7232 203c 2031 3a0d 0a20  f 0 < r2 < 1:.. 
 00027530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027540: 2020 2020 6c6f 6361 6c5f 6578 7472 656d      local_extrem
-00027550: 697a 6572 732e 6170 7065 6e64 2872 3229  izers.append(r2)
-00027560: 0d0a 2020 2020 2020 2020 656c 7365 3a0d  ..        else:.
-00027570: 0a20 2020 2020 2020 2020 2020 2063 203d  .            c =
-00027580: 2061 5b31 5d20 2d20 615b 305d 0d0a 2020   a[1] - a[0]..  
-00027590: 2020 2020 2020 2020 2020 6220 3d20 3220            b = 2 
-000275a0: 2a20 2861 5b30 5d20 2d20 3220 2a20 615b  * (a[0] - 2 * a[
-000275b0: 315d 202b 2061 5b32 5d29 0d0a 2020 2020  1] + a[2])..    
-000275c0: 2020 2020 2020 2020 6966 2062 2021 3d20          if b != 
-000275d0: 303a 0d0a 2020 2020 2020 2020 2020 2020  0:..            
-000275e0: 2020 2020 7230 203d 202d 6320 2f20 620d      r0 = -c / b.
-000275f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00027600: 2069 6620 3020 3c20 7230 203c 2031 3a0d   if 0 < r0 < 1:.
-00027610: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00027620: 2020 2020 206c 6f63 616c 5f65 7874 7265       local_extre
-00027630: 6d69 7a65 7273 2e61 7070 656e 6428 7230  mizers.append(r0
-00027640: 290d 0a20 2020 2020 2020 206c 6f63 616c  )..        local
-00027650: 5f65 7874 7265 6d61 203d 205b 7365 6c66  _extrema = [self
-00027660: 2e70 6f69 6e74 2874 295b 765d 2066 6f72  .point(t)[v] for
-00027670: 2074 2069 6e20 6c6f 6361 6c5f 6578 7472   t in local_extr
-00027680: 656d 697a 6572 735d 0d0a 2020 2020 2020  emizers]..      
-00027690: 2020 7265 7475 726e 206d 696e 286c 6f63    return min(loc
-000276a0: 616c 5f65 7874 7265 6d61 292c 206d 6178  al_extrema), max
-000276b0: 286c 6f63 616c 5f65 7874 7265 6d61 290d  (local_extrema).
-000276c0: 0a0d 0a20 2020 2064 6566 205f 6c65 6e67  ...    def _leng
-000276d0: 7468 5f73 6369 7079 2873 656c 662c 2065  th_scipy(self, e
-000276e0: 7272 6f72 3d45 5252 4f52 293a 0d0a 2020  rror=ERROR):..  
-000276f0: 2020 2020 2020 6672 6f6d 2073 6369 7079        from scipy
-00027700: 2e69 6e74 6567 7261 7465 2069 6d70 6f72  .integrate impor
-00027710: 7420 7175 6164 0d0a 0d0a 2020 2020 2020  t quad....      
-00027720: 2020 7030 203d 2063 6f6d 706c 6578 282a    p0 = complex(*
-00027730: 7365 6c66 2e73 7461 7274 290d 0a20 2020  self.start)..   
-00027740: 2020 2020 2070 3120 3d20 636f 6d70 6c65       p1 = comple
-00027750: 7828 2a73 656c 662e 636f 6e74 726f 6c31  x(*self.control1
-00027760: 290d 0a20 2020 2020 2020 2070 3220 3d20  )..        p2 = 
-00027770: 636f 6d70 6c65 7828 2a73 656c 662e 636f  complex(*self.co
-00027780: 6e74 726f 6c32 290d 0a20 2020 2020 2020  ntrol2)..       
-00027790: 2070 3320 3d20 636f 6d70 6c65 7828 2a73   p3 = complex(*s
-000277a0: 656c 662e 656e 6429 0d0a 0d0a 2020 2020  elf.end)....    
-000277b0: 2020 2020 6465 6620 5f61 6273 5f64 6572      def _abs_der
-000277c0: 6976 6174 6976 6528 7429 3a0d 0a20 2020  ivative(t):..   
-000277d0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-000277e0: 6162 7328 0d0a 2020 2020 2020 2020 2020  abs(..          
-000277f0: 2020 2020 2020 3320 2a20 2870 3120 2d20        3 * (p1 - 
-00027800: 7030 2920 2a20 2831 202d 2074 2920 2a2a  p0) * (1 - t) **
-00027810: 2032 0d0a 2020 2020 2020 2020 2020 2020   2..            
-00027820: 2020 2020 2b20 3620 2a20 2870 3220 2d20      + 6 * (p2 - 
-00027830: 7031 2920 2a20 2831 202d 2074 2920 2a20  p1) * (1 - t) * 
-00027840: 740d 0a20 2020 2020 2020 2020 2020 2020  t..             
-00027850: 2020 202b 2033 202a 2028 7033 202d 2070     + 3 * (p3 - p
-00027860: 3229 202a 2074 2a2a 320d 0a20 2020 2020  2) * t**2..     
-00027870: 2020 2020 2020 2029 0d0a 0d0a 2020 2020         )....    
-00027880: 2020 2020 7265 7475 726e 2071 7561 6428      return quad(
-00027890: 5f61 6273 5f64 6572 6976 6174 6976 652c  _abs_derivative,
-000278a0: 2030 2e30 2c20 312e 302c 2065 7073 6162   0.0, 1.0, epsab
-000278b0: 733d 6572 726f 722c 206c 696d 6974 3d31  s=error, limit=1
-000278c0: 3030 3029 5b30 5d0d 0a0d 0a20 2020 2064  000)[0]....    d
-000278d0: 6566 205f 6c65 6e67 7468 5f64 6566 6175  ef _length_defau
-000278e0: 6c74 2873 656c 662c 2065 7272 6f72 3d45  lt(self, error=E
-000278f0: 5252 4f52 2c20 6d69 6e5f 6465 7074 683d  RROR, min_depth=
-00027900: 4d49 4e5f 4445 5054 4829 3a0d 0a20 2020  MIN_DEPTH):..   
-00027910: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00027920: 2e5f 6c69 6e65 5f6c 656e 6774 6828 302c  ._line_length(0,
-00027930: 2031 2c20 6572 726f 722c 206d 696e 5f64   1, error, min_d
-00027940: 6570 7468 290d 0a0d 0a20 2020 2064 6566  epth)....    def
-00027950: 206c 656e 6774 6828 7365 6c66 2c20 6572   length(self, er
-00027960: 726f 723d 4552 524f 522c 206d 696e 5f64  ror=ERROR, min_d
-00027970: 6570 7468 3d4d 494e 5f44 4550 5448 293a  epth=MIN_DEPTH):
-00027980: 0d0a 2020 2020 2020 2020 2222 2243 616c  ..        """Cal
-00027990: 6375 6c61 7465 2074 6865 206c 656e 6774  culate the lengt
-000279a0: 6820 6f66 2074 6865 2070 6174 6820 7570  h of the path up
-000279b0: 2074 6f20 6120 6365 7274 6169 6e20 706f   to a certain po
-000279c0: 7369 7469 6f6e 2222 220d 0a20 2020 2020  sition"""..     
-000279d0: 2020 2074 7279 3a0d 0a20 2020 2020 2020     try:..       
-000279e0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-000279f0: 2e5f 6c65 6e67 7468 5f73 6369 7079 2865  ._length_scipy(e
-00027a00: 7272 6f72 290d 0a20 2020 2020 2020 2065  rror)..        e
-00027a10: 7863 6570 743a 2020 2320 4661 6c6c 6261  xcept:  # Fallba
-00027a20: 636b 206f 6e20 616e 7920 6661 696c 7572  ck on any failur
-00027a30: 650d 0a20 2020 2020 2020 2020 2020 2072  e..            r
-00027a40: 6574 7572 6e20 7365 6c66 2e5f 6c65 6e67  eturn self._leng
-00027a50: 7468 5f64 6566 6175 6c74 2865 7272 6f72  th_default(error
-00027a60: 2c20 6d69 6e5f 6465 7074 6829 0d0a 0d0a  , min_depth)....
-00027a70: 2020 2020 6465 6620 6973 5f73 6d6f 6f74      def is_smoot
-00027a80: 685f 6672 6f6d 2873 656c 662c 2070 7265  h_from(self, pre
-00027a90: 7669 6f75 7329 3a0d 0a20 2020 2020 2020  vious):..       
-00027aa0: 2022 2222 4368 6563 6b73 2069 6620 7468   """Checks if th
-00027ab0: 6973 2073 6567 6d65 6e74 2077 6f75 6c64  is segment would
-00027ac0: 2062 6520 6120 736d 6f6f 7468 2073 6567   be a smooth seg
-00027ad0: 6d65 6e74 2066 6f6c 6c6f 7769 6e67 2074  ment following t
-00027ae0: 6865 2070 7265 7669 6f75 7322 2222 0d0a  he previous"""..
-00027af0: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-00027b00: 7461 6e63 6528 7072 6576 696f 7573 2c20  tance(previous, 
-00027b10: 4375 6269 6342 657a 6965 7229 3a0d 0a20  CubicBezier):.. 
-00027b20: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00027b30: 6e20 7365 6c66 2e73 7461 7274 203d 3d20  n self.start == 
-00027b40: 7072 6576 696f 7573 2e65 6e64 2061 6e64  previous.end and
-00027b50: 2028 7365 6c66 2e63 6f6e 7472 6f6c 3120   (self.control1 
-00027b60: 2d20 7365 6c66 2e73 7461 7274 2920 3d3d  - self.start) ==
-00027b70: 2028 0d0a 2020 2020 2020 2020 2020 2020   (..            
-00027b80: 2020 2020 7072 6576 696f 7573 2e65 6e64      previous.end
-00027b90: 202d 2070 7265 7669 6f75 732e 636f 6e74   - previous.cont
-00027ba0: 726f 6c32 0d0a 2020 2020 2020 2020 2020  rol2..          
-00027bb0: 2020 290d 0a20 2020 2020 2020 2065 6c73    )..        els
-00027bc0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00027bd0: 7265 7475 726e 2073 656c 662e 636f 6e74  return self.cont
-00027be0: 726f 6c31 203d 3d20 7365 6c66 2e73 7461  rol1 == self.sta
-00027bf0: 7274 0d0a 0d0a 2020 2020 6465 6620 6428  rt....    def d(
-00027c00: 7365 6c66 2c20 6375 7272 656e 745f 706f  self, current_po
-00027c10: 696e 743d 4e6f 6e65 2c20 7265 6c61 7469  int=None, relati
-00027c20: 7665 3d4e 6f6e 652c 2073 6d6f 6f74 683d  ve=None, smooth=
-00027c30: 4e6f 6e65 293a 0d0a 2020 2020 2020 2020  None):..        
-00027c40: 6966 2028 736d 6f6f 7468 2069 7320 4e6f  if (smooth is No
-00027c50: 6e65 2061 6e64 2073 656c 662e 736d 6f6f  ne and self.smoo
-00027c60: 7468 2920 6f72 2028 736d 6f6f 7468 2069  th) or (smooth i
-00027c70: 7320 6e6f 7420 4e6f 6e65 2061 6e64 2073  s not None and s
-00027c80: 6d6f 6f74 6829 3a0d 0a20 2020 2020 2020  mooth):..       
-00027c90: 2020 2020 2069 6620 280d 0a20 2020 2020       if (..     
-00027ca0: 2020 2020 2020 2020 2020 2063 7572 7265             curre
-00027cb0: 6e74 5f70 6f69 6e74 2069 7320 4e6f 6e65  nt_point is None
-00027cc0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00027cd0: 2020 6f72 2028 7265 6c61 7469 7665 2069    or (relative i
-00027ce0: 7320 4e6f 6e65 2061 6e64 2073 656c 662e  s None and self.
-00027cf0: 7265 6c61 7469 7665 290d 0a20 2020 2020  relative)..     
-00027d00: 2020 2020 2020 2020 2020 206f 7220 2872             or (r
-00027d10: 656c 6174 6976 6520 6973 206e 6f74 204e  elative is not N
-00027d20: 6f6e 6520 616e 6420 6e6f 7420 7265 6c61  one and not rela
-00027d30: 7469 7665 290d 0a20 2020 2020 2020 2020  tive)..         
-00027d40: 2020 2029 3a0d 0a20 2020 2020 2020 2020     ):..         
-00027d50: 2020 2020 2020 2072 6574 7572 6e20 2253         return "S
-00027d60: 2025 7320 2573 2220 2520 2873 656c 662e   %s %s" % (self.
-00027d70: 636f 6e74 726f 6c32 2c20 7365 6c66 2e65  control2, self.e
-00027d80: 6e64 290d 0a20 2020 2020 2020 2020 2020  nd)..           
-00027d90: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-00027da0: 2020 2020 2020 2020 7265 7475 726e 2022          return "
-00027db0: 7320 2573 2025 7322 2025 2028 0d0a 2020  s %s %s" % (..  
+00027540: 2020 206c 6f63 616c 5f65 7874 7265 6d69     local_extremi
+00027550: 7a65 7273 2e61 7070 656e 6428 7232 290d  zers.append(r2).
+00027560: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
+00027570: 2020 2020 2020 2020 2020 2020 6320 3d20              c = 
+00027580: 615b 315d 202d 2061 5b30 5d0d 0a20 2020  a[1] - a[0]..   
+00027590: 2020 2020 2020 2020 2062 203d 2032 202a           b = 2 *
+000275a0: 2028 615b 305d 202d 2032 202a 2061 5b31   (a[0] - 2 * a[1
+000275b0: 5d20 2b20 615b 325d 290d 0a20 2020 2020  ] + a[2])..     
+000275c0: 2020 2020 2020 2069 6620 6220 213d 2030         if b != 0
+000275d0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+000275e0: 2020 2072 3020 3d20 2d63 202f 2062 0d0a     r0 = -c / b..
+000275f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027600: 6966 2030 203c 2072 3020 3c20 313a 0d0a  if 0 < r0 < 1:..
+00027610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027620: 2020 2020 6c6f 6361 6c5f 6578 7472 656d      local_extrem
+00027630: 697a 6572 732e 6170 7065 6e64 2872 3029  izers.append(r0)
+00027640: 0d0a 2020 2020 2020 2020 6c6f 6361 6c5f  ..        local_
+00027650: 6578 7472 656d 6120 3d20 5b73 656c 662e  extrema = [self.
+00027660: 706f 696e 7428 7429 5b76 5d20 666f 7220  point(t)[v] for 
+00027670: 7420 696e 206c 6f63 616c 5f65 7874 7265  t in local_extre
+00027680: 6d69 7a65 7273 5d0d 0a20 2020 2020 2020  mizers]..       
+00027690: 2072 6574 7572 6e20 6d69 6e28 6c6f 6361   return min(loca
+000276a0: 6c5f 6578 7472 656d 6129 2c20 6d61 7828  l_extrema), max(
+000276b0: 6c6f 6361 6c5f 6578 7472 656d 6129 0d0a  local_extrema)..
+000276c0: 0d0a 2020 2020 6465 6620 5f6c 656e 6774  ..    def _lengt
+000276d0: 685f 7363 6970 7928 7365 6c66 2c20 6572  h_scipy(self, er
+000276e0: 726f 723d 4552 524f 5229 3a0d 0a20 2020  ror=ERROR):..   
+000276f0: 2020 2020 2066 726f 6d20 7363 6970 792e       from scipy.
+00027700: 696e 7465 6772 6174 6520 696d 706f 7274  integrate import
+00027710: 2071 7561 640d 0a0d 0a20 2020 2020 2020   quad....       
+00027720: 2070 3020 3d20 636f 6d70 6c65 7828 2a73   p0 = complex(*s
+00027730: 656c 662e 7374 6172 7429 0d0a 2020 2020  elf.start)..    
+00027740: 2020 2020 7031 203d 2063 6f6d 706c 6578      p1 = complex
+00027750: 282a 7365 6c66 2e63 6f6e 7472 6f6c 3129  (*self.control1)
+00027760: 0d0a 2020 2020 2020 2020 7032 203d 2063  ..        p2 = c
+00027770: 6f6d 706c 6578 282a 7365 6c66 2e63 6f6e  omplex(*self.con
+00027780: 7472 6f6c 3229 0d0a 2020 2020 2020 2020  trol2)..        
+00027790: 7033 203d 2063 6f6d 706c 6578 282a 7365  p3 = complex(*se
+000277a0: 6c66 2e65 6e64 290d 0a0d 0a20 2020 2020  lf.end)....     
+000277b0: 2020 2064 6566 205f 6162 735f 6465 7269     def _abs_deri
+000277c0: 7661 7469 7665 2874 293a 0d0a 2020 2020  vative(t):..    
+000277d0: 2020 2020 2020 2020 7265 7475 726e 2061          return a
+000277e0: 6273 280d 0a20 2020 2020 2020 2020 2020  bs(..           
+000277f0: 2020 2020 2033 202a 2028 7031 202d 2070       3 * (p1 - p
+00027800: 3029 202a 2028 3120 2d20 7429 202a 2a20  0) * (1 - t) ** 
+00027810: 320d 0a20 2020 2020 2020 2020 2020 2020  2..             
+00027820: 2020 202b 2036 202a 2028 7032 202d 2070     + 6 * (p2 - p
+00027830: 3129 202a 2028 3120 2d20 7429 202a 2074  1) * (1 - t) * t
+00027840: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00027850: 2020 2b20 3320 2a20 2870 3320 2d20 7032    + 3 * (p3 - p2
+00027860: 2920 2a20 742a 2a32 0d0a 2020 2020 2020  ) * t**2..      
+00027870: 2020 2020 2020 290d 0a0d 0a20 2020 2020        )....     
+00027880: 2020 2072 6574 7572 6e20 7175 6164 285f     return quad(_
+00027890: 6162 735f 6465 7269 7661 7469 7665 2c20  abs_derivative, 
+000278a0: 302e 302c 2031 2e30 2c20 6570 7361 6273  0.0, 1.0, epsabs
+000278b0: 3d65 7272 6f72 2c20 6c69 6d69 743d 3130  =error, limit=10
+000278c0: 3030 295b 305d 0d0a 0d0a 2020 2020 6465  00)[0]....    de
+000278d0: 6620 5f6c 656e 6774 685f 6465 6661 756c  f _length_defaul
+000278e0: 7428 7365 6c66 2c20 6572 726f 723d 4552  t(self, error=ER
+000278f0: 524f 522c 206d 696e 5f64 6570 7468 3d4d  ROR, min_depth=M
+00027900: 494e 5f44 4550 5448 293a 0d0a 2020 2020  IN_DEPTH):..    
+00027910: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+00027920: 5f6c 696e 655f 6c65 6e67 7468 2830 2c20  _line_length(0, 
+00027930: 312c 2065 7272 6f72 2c20 6d69 6e5f 6465  1, error, min_de
+00027940: 7074 6829 0d0a 0d0a 2020 2020 6465 6620  pth)....    def 
+00027950: 6c65 6e67 7468 2873 656c 662c 2065 7272  length(self, err
+00027960: 6f72 3d45 5252 4f52 2c20 6d69 6e5f 6465  or=ERROR, min_de
+00027970: 7074 683d 4d49 4e5f 4445 5054 4829 3a0d  pth=MIN_DEPTH):.
+00027980: 0a20 2020 2020 2020 2022 2222 4361 6c63  .        """Calc
+00027990: 756c 6174 6520 7468 6520 6c65 6e67 7468  ulate the length
+000279a0: 206f 6620 7468 6520 7061 7468 2075 7020   of the path up 
+000279b0: 746f 2061 2063 6572 7461 696e 2070 6f73  to a certain pos
+000279c0: 6974 696f 6e22 2222 0d0a 2020 2020 2020  ition"""..      
+000279d0: 2020 7472 793a 0d0a 2020 2020 2020 2020    try:..        
+000279e0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+000279f0: 5f6c 656e 6774 685f 7363 6970 7928 6572  _length_scipy(er
+00027a00: 726f 7229 0d0a 2020 2020 2020 2020 6578  ror)..        ex
+00027a10: 6365 7074 3a20 2023 2046 616c 6c62 6163  cept:  # Fallbac
+00027a20: 6b20 6f6e 2061 6e79 2066 6169 6c75 7265  k on any failure
+00027a30: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+00027a40: 7475 726e 2073 656c 662e 5f6c 656e 6774  turn self._lengt
+00027a50: 685f 6465 6661 756c 7428 6572 726f 722c  h_default(error,
+00027a60: 206d 696e 5f64 6570 7468 290d 0a0d 0a20   min_depth).... 
+00027a70: 2020 2064 6566 2069 735f 736d 6f6f 7468     def is_smooth
+00027a80: 5f66 726f 6d28 7365 6c66 2c20 7072 6576  _from(self, prev
+00027a90: 696f 7573 293a 0d0a 2020 2020 2020 2020  ious):..        
+00027aa0: 2222 2243 6865 636b 7320 6966 2074 6869  """Checks if thi
+00027ab0: 7320 7365 676d 656e 7420 776f 756c 6420  s segment would 
+00027ac0: 6265 2061 2073 6d6f 6f74 6820 7365 676d  be a smooth segm
+00027ad0: 656e 7420 666f 6c6c 6f77 696e 6720 7468  ent following th
+00027ae0: 6520 7072 6576 696f 7573 2222 220d 0a20  e previous""".. 
+00027af0: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
+00027b00: 616e 6365 2870 7265 7669 6f75 732c 2043  ance(previous, C
+00027b10: 7562 6963 4265 7a69 6572 293a 0d0a 2020  ubicBezier):..  
+00027b20: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00027b30: 2073 656c 662e 7374 6172 7420 3d3d 2070   self.start == p
+00027b40: 7265 7669 6f75 732e 656e 6420 616e 6420  revious.end and 
+00027b50: 2873 656c 662e 636f 6e74 726f 6c31 202d  (self.control1 -
+00027b60: 2073 656c 662e 7374 6172 7429 203d 3d20   self.start) == 
+00027b70: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
+00027b80: 2020 2070 7265 7669 6f75 732e 656e 6420     previous.end 
+00027b90: 2d20 7072 6576 696f 7573 2e63 6f6e 7472  - previous.contr
+00027ba0: 6f6c 320d 0a20 2020 2020 2020 2020 2020  ol2..           
+00027bb0: 2029 0d0a 2020 2020 2020 2020 656c 7365   )..        else
+00027bc0: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
+00027bd0: 6574 7572 6e20 7365 6c66 2e63 6f6e 7472  eturn self.contr
+00027be0: 6f6c 3120 3d3d 2073 656c 662e 7374 6172  ol1 == self.star
+00027bf0: 740d 0a0d 0a20 2020 2064 6566 2064 2873  t....    def d(s
+00027c00: 656c 662c 2063 7572 7265 6e74 5f70 6f69  elf, current_poi
+00027c10: 6e74 3d4e 6f6e 652c 2072 656c 6174 6976  nt=None, relativ
+00027c20: 653d 4e6f 6e65 2c20 736d 6f6f 7468 3d4e  e=None, smooth=N
+00027c30: 6f6e 6529 3a0d 0a20 2020 2020 2020 2069  one):..        i
+00027c40: 6620 2873 6d6f 6f74 6820 6973 204e 6f6e  f (smooth is Non
+00027c50: 6520 616e 6420 7365 6c66 2e73 6d6f 6f74  e and self.smoot
+00027c60: 6829 206f 7220 2873 6d6f 6f74 6820 6973  h) or (smooth is
+00027c70: 206e 6f74 204e 6f6e 6520 616e 6420 736d   not None and sm
+00027c80: 6f6f 7468 293a 0d0a 2020 2020 2020 2020  ooth):..        
+00027c90: 2020 2020 6966 2028 0d0a 2020 2020 2020      if (..      
+00027ca0: 2020 2020 2020 2020 2020 6375 7272 656e            curren
+00027cb0: 745f 706f 696e 7420 6973 204e 6f6e 650d  t_point is None.
+00027cc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00027cd0: 206f 7220 2872 656c 6174 6976 6520 6973   or (relative is
+00027ce0: 204e 6f6e 6520 616e 6420 7365 6c66 2e72   None and self.r
+00027cf0: 656c 6174 6976 6529 0d0a 2020 2020 2020  elative)..      
+00027d00: 2020 2020 2020 2020 2020 6f72 2028 7265            or (re
+00027d10: 6c61 7469 7665 2069 7320 6e6f 7420 4e6f  lative is not No
+00027d20: 6e65 2061 6e64 206e 6f74 2072 656c 6174  ne and not relat
+00027d30: 6976 6529 0d0a 2020 2020 2020 2020 2020  ive)..          
+00027d40: 2020 293a 0d0a 2020 2020 2020 2020 2020    ):..          
+00027d50: 2020 2020 2020 7265 7475 726e 2022 5320        return "S 
+00027d60: 2573 2025 7322 2025 2028 7365 6c66 2e63  %s %s" % (self.c
+00027d70: 6f6e 7472 6f6c 322c 2073 656c 662e 656e  ontrol2, self.en
+00027d80: 6429 0d0a 2020 2020 2020 2020 2020 2020  d)..            
+00027d90: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+00027da0: 2020 2020 2020 2072 6574 7572 6e20 2273         return "s
+00027db0: 2025 7320 2573 2220 2520 280d 0a20 2020   %s %s" % (..   
 00027dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027dd0: 2020 7365 6c66 2e63 6f6e 7472 6f6c 3220    self.control2 
-00027de0: 2d20 6375 7272 656e 745f 706f 696e 742c  - current_point,
-00027df0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00027e00: 2020 2020 2020 7365 6c66 2e65 6e64 202d        self.end -
-00027e10: 2063 7572 7265 6e74 5f70 6f69 6e74 2c0d   current_point,.
-00027e20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00027e30: 2029 0d0a 2020 2020 2020 2020 656c 7365   )..        else
-00027e40: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
-00027e50: 6620 280d 0a20 2020 2020 2020 2020 2020  f (..           
-00027e60: 2020 2020 2063 7572 7265 6e74 5f70 6f69       current_poi
-00027e70: 6e74 2069 7320 4e6f 6e65 0d0a 2020 2020  nt is None..    
-00027e80: 2020 2020 2020 2020 2020 2020 6f72 2028              or (
-00027e90: 7265 6c61 7469 7665 2069 7320 4e6f 6e65  relative is None
-00027ea0: 2061 6e64 2073 656c 662e 7265 6c61 7469   and self.relati
-00027eb0: 7665 290d 0a20 2020 2020 2020 2020 2020  ve)..           
-00027ec0: 2020 2020 206f 7220 2872 656c 6174 6976       or (relativ
-00027ed0: 6520 6973 206e 6f74 204e 6f6e 6520 616e  e is not None an
-00027ee0: 6420 6e6f 7420 7265 6c61 7469 7665 290d  d not relative).
-00027ef0: 0a20 2020 2020 2020 2020 2020 2029 3a0d  .            ):.
-00027f00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00027f10: 2072 6574 7572 6e20 2243 2025 7320 2573   return "C %s %s
-00027f20: 2025 7322 2025 2028 7365 6c66 2e63 6f6e   %s" % (self.con
-00027f30: 7472 6f6c 312c 2073 656c 662e 636f 6e74  trol1, self.cont
-00027f40: 726f 6c32 2c20 7365 6c66 2e65 6e64 290d  rol2, self.end).
-00027f50: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-00027f60: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00027f70: 2020 2020 7265 7475 726e 2022 6320 2573      return "c %s
-00027f80: 2025 7320 2573 2220 2520 280d 0a20 2020   %s %s" % (..   
+00027dd0: 2073 656c 662e 636f 6e74 726f 6c32 202d   self.control2 -
+00027de0: 2063 7572 7265 6e74 5f70 6f69 6e74 2c0d   current_point,.
+00027df0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00027e00: 2020 2020 2073 656c 662e 656e 6420 2d20       self.end - 
+00027e10: 6375 7272 656e 745f 706f 696e 742c 0d0a  current_point,..
+00027e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027e30: 290d 0a20 2020 2020 2020 2065 6c73 653a  )..        else:
+00027e40: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00027e50: 2028 0d0a 2020 2020 2020 2020 2020 2020   (..            
+00027e60: 2020 2020 6375 7272 656e 745f 706f 696e      current_poin
+00027e70: 7420 6973 204e 6f6e 650d 0a20 2020 2020  t is None..     
+00027e80: 2020 2020 2020 2020 2020 206f 7220 2872             or (r
+00027e90: 656c 6174 6976 6520 6973 204e 6f6e 6520  elative is None 
+00027ea0: 616e 6420 7365 6c66 2e72 656c 6174 6976  and self.relativ
+00027eb0: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
+00027ec0: 2020 2020 6f72 2028 7265 6c61 7469 7665      or (relative
+00027ed0: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
+00027ee0: 206e 6f74 2072 656c 6174 6976 6529 0d0a   not relative)..
+00027ef0: 2020 2020 2020 2020 2020 2020 293a 0d0a              ):..
+00027f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027f10: 7265 7475 726e 2022 4320 2573 2025 7320  return "C %s %s 
+00027f20: 2573 2220 2520 2873 656c 662e 636f 6e74  %s" % (self.cont
+00027f30: 726f 6c31 2c20 7365 6c66 2e63 6f6e 7472  rol1, self.contr
+00027f40: 6f6c 322c 2073 656c 662e 656e 6429 0d0a  ol2, self.end)..
+00027f50: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00027f60: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00027f70: 2020 2072 6574 7572 6e20 2263 2025 7320     return "c %s 
+00027f80: 2573 2025 7322 2025 2028 0d0a 2020 2020  %s %s" % (..    
 00027f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027fa0: 2073 656c 662e 636f 6e74 726f 6c31 202d   self.control1 -
-00027fb0: 2063 7572 7265 6e74 5f70 6f69 6e74 2c0d   current_point,.
-00027fc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00027fd0: 2020 2020 2073 656c 662e 636f 6e74 726f       self.contro
-00027fe0: 6c32 202d 2063 7572 7265 6e74 5f70 6f69  l2 - current_poi
-00027ff0: 6e74 2c0d 0a20 2020 2020 2020 2020 2020  nt,..           
-00028000: 2020 2020 2020 2020 2073 656c 662e 656e           self.en
-00028010: 6420 2d20 6375 7272 656e 745f 706f 696e  d - current_poin
-00028020: 742c 0d0a 2020 2020 2020 2020 2020 2020  t,..            
-00028030: 2020 2020 290d 0a0d 0a0d 0a63 6c61 7373      )......class
-00028040: 2041 7263 2843 7572 7665 293a 0d0a 2020   Arc(Curve):..  
-00028050: 2020 6465 6620 5f5f 696e 6974 5f5f 2873    def __init__(s
-00028060: 656c 662c 202a 6172 6773 2c20 2a2a 6b77  elf, *args, **kw
-00028070: 6172 6773 293a 0d0a 2020 2020 2020 2020  args):..        
-00028080: 2222 220d 0a20 2020 2020 2020 2052 6570  """..        Rep
-00028090: 7265 7365 6e74 7320 4172 6320 636f 6d6d  resents Arc comm
-000280a0: 616e 6473 2e0d 0a0d 0a20 2020 2020 2020  ands.....       
-000280b0: 2041 7263 206f 626a 6563 7473 2063 616e   Arc objects can
-000280c0: 2074 616b 6520 6469 6666 6572 656e 7420   take different 
-000280d0: 7061 7261 6d65 7465 7273 2074 6f20 6372  parameters to cr
-000280e0: 6561 7465 2061 7263 732e 0d0a 2020 2020  eate arcs...    
-000280f0: 2020 2020 5369 6e63 6520 7765 2065 7870      Since we exp
-00028100: 6563 7420 7461 6b69 6e67 2069 6e20 5356  ect taking in SV
-00028110: 4720 7061 7261 6d65 7465 7273 2e20 5765  G parameters. We
-00028120: 2061 6363 6570 7420 5356 4720 7061 7261   accept SVG para
-00028130: 6d65 7465 7269 7a61 7469 6f6e 2077 6869  meterization whi
-00028140: 6368 2069 733a 0d0a 2020 2020 2020 2020  ch is:..        
-00028150: 7374 6172 742c 2072 782c 2072 792c 2072  start, rx, ry, r
-00028160: 6f74 6174 696f 6e2c 2061 7263 5f66 6c61  otation, arc_fla
-00028170: 672c 2073 7765 6570 5f66 6c61 672c 2065  g, sweep_flag, e
-00028180: 6e64 2e0d 0a0d 0a20 2020 2020 2020 2054  nd.....        T
-00028190: 6f20 646f 206d 6174 7269 7820 7472 616e  o do matrix tran
-000281a0: 7369 7469 6f6e 732c 2074 6865 206e 6174  sitions, the nat
-000281b0: 6976 6520 7061 7261 6d65 7465 7269 7a61  ive parameteriza
-000281c0: 7469 6f6e 2069 7320 7374 6172 742c 2065  tion is start, e
-000281d0: 6e64 2c20 6365 6e74 6572 2c20 7072 782c  nd, center, prx,
-000281e0: 2070 7279 2c20 7377 6565 700d 0a0d 0a20   pry, sweep.... 
-000281f0: 2020 2020 2020 2027 7374 6172 742c 2065         'start, e
-00028200: 6e64 2c20 6365 6e74 6572 2c20 7072 782c  nd, center, prx,
-00028210: 2070 7279 2720 6172 6520 706f 696e 7473   pry' are points
-00028220: 2061 6e64 2073 7765 6570 2061 6d6f 756e   and sweep amoun
-00028230: 7420 6973 2061 2074 2076 616c 7565 2069  t is a t value i
-00028240: 6e20 7461 7520 7261 6469 616e 732e 0d0a  n tau radians...
-00028250: 2020 2020 2020 2020 4966 2070 6f69 6e74          If point
-00028260: 7320 6172 6520 6d6f 6469 6669 6564 2062  s are modified b
-00028270: 7920 616e 2061 6666 696e 6520 7472 616e  y an affine tran
-00028280: 7366 6f72 6d61 7469 6f6e 2c20 7468 6520  sformation, the 
-00028290: 6172 6320 6973 2074 7261 6e73 666f 726d  arc is transform
-000282a0: 6564 2e0d 0a20 2020 2020 2020 2054 6865  ed...        The
-000282b0: 7265 2069 7320 6120 7370 6563 6961 6c20  re is a special 
-000282c0: 6361 7365 2066 6f72 2077 6865 6e20 7468  case for when th
-000282d0: 6520 7363 616c 6520 6661 6374 6f72 2069  e scale factor i
-000282e0: 6e76 6572 7473 2c20 6974 2069 6e76 6572  nverts, it inver
-000282f0: 7473 2074 6865 2073 7765 6570 2e0d 0a0d  ts the sweep....
-00028300: 0a20 2020 2020 2020 204e 6f74 653a 2074  .        Note: t
-00028310: 2d76 616c 7565 7320 6172 6520 6e6f 7420  -values are not 
-00028320: 616e 676c 6573 2066 726f 6d20 6365 6e74  angles from cent
-00028330: 6572 2069 6e20 656c 6c69 7074 6963 616c  er in elliptical
-00028340: 2061 7263 732e 2054 6865 7365 2061 7265   arcs. These are
-00028350: 2074 6865 2073 616d 6520 7468 696e 6720   the same thing 
-00028360: 696e 0d0a 2020 2020 2020 2020 6369 7263  in..        circ
-00028370: 756c 6172 2061 7263 732e 2042 7574 2c20  ular arcs. But, 
-00028380: 6865 7265 2074 2069 7320 6120 7061 7261  here t is a para
-00028390: 6d65 7465 7269 7a61 7469 6f6e 2061 726f  meterization aro
-000283a0: 756e 6420 7468 6520 656c 6c69 7073 652c  und the ellipse,
-000283b0: 2061 7320 6966 2069 7420 7765 7265 2061   as if it were a
-000283c0: 2063 6972 636c 652e 0d0a 2020 2020 2020   circle...      
-000283d0: 2020 5468 6520 706f 7369 7469 6f6e 206f    The position o
-000283e0: 6e20 7468 6520 6172 6320 6973 2028 6120  n the arc is (a 
-000283f0: 2a20 636f 7328 7429 2c20 6220 2a20 7369  * cos(t), b * si
-00028400: 6e28 7429 292e 2049 6620 722d 6d61 6a6f  n(t)). If r-majo
-00028410: 7220 7761 7320 3020 666f 7220 6578 616d  r was 0 for exam
-00028420: 706c 652e 2054 6865 0d0a 2020 2020 2020  ple. The..      
-00028430: 2020 706f 7369 7469 6f6e 7320 776f 756c    positions woul
-00028440: 6420 616c 6c20 6661 6c6c 206f 6e20 7468  d all fall on th
-00028450: 6520 782d 6178 6973 2e20 416e 6420 7468  e x-axis. And th
-00028460: 6520 616e 676c 6520 6672 6f6d 2063 656e  e angle from cen
-00028470: 7465 7220 776f 756c 6420 616c 6c20 6265  ter would all be
-00028480: 2065 6974 6865 7220 3020 6f72 0d0a 2020   either 0 or..  
-00028490: 2020 2020 2020 7461 752f 322e 2048 6f77        tau/2. How
-000284a0: 6576 6572 2c20 7369 6e63 6520 7420 6973  ever, since t is
-000284b0: 2074 6865 2070 6172 616d 6574 6572 697a   the parameteriz
-000284c0: 6174 696f 6e20 7765 2063 616e 2063 6f6e  ation we can con
-000284d0: 6365 7074 7561 6c69 7a65 2069 7420 6173  ceptualize it as
-000284e0: 2061 2070 6f73 6974 696f 6e20 6f6e 2061   a position on a
-000284f0: 0d0a 2020 2020 2020 2020 6369 7263 6c65  ..        circle
-00028500: 2077 6869 6368 2069 7320 7468 656e 2073   which is then s
-00028510: 6361 6c65 6420 616e 6420 726f 7461 7465  caled and rotate
-00028520: 6420 6279 2061 206d 6174 7269 782e 0d0a  d by a matrix...
-00028530: 0d0a 2020 2020 2020 2020 7072 7820 6973  ..        prx is
-00028540: 2074 6865 2070 6f69 6e74 2061 7420 7420   the point at t 
-00028550: 3020 696e 2074 6865 2065 6c6c 6970 7365  0 in the ellipse
-00028560: 2e0d 0a20 2020 2020 2020 2070 7279 2069  ...        pry i
-00028570: 7320 7468 6520 706f 696e 7420 6174 2074  s the point at t
-00028580: 2074 6175 2f34 2069 6e20 7468 6520 656c   tau/4 in the el
-00028590: 6c69 7073 652e 0d0a 2020 2020 2020 2020  lipse...        
-000285a0: 7072 7820 2d3e 2063 656e 7465 7220 2d3e  prx -> center ->
-000285b0: 2070 7279 2073 686f 756c 6420 666f 726d   pry should form
-000285c0: 2061 2072 6967 6874 2074 7269 616e 676c   a right triangl
-000285d0: 652e 0d0a 0d0a 2020 2020 2020 2020 5468  e.....        Th
-000285e0: 6520 726f 7461 7469 6f6e 2063 616e 2062  e rotation can b
-000285f0: 6520 6465 6669 6e65 6420 6173 2074 6865  e defined as the
-00028600: 2061 6e67 6c65 2066 726f 6d20 6365 6e74   angle from cent
-00028610: 6572 2074 6f20 7072 782e 2053 696e 6365  er to prx. Since
-00028620: 2070 7278 2069 7320 6c6f 6361 7465 6420   prx is located 
-00028630: 6174 0d0a 2020 2020 2020 2020 7428 3029  at..        t(0)
-00028640: 2069 7473 2064 6576 6961 7469 6f6e 2063   its deviation c
-00028650: 616e 206f 6e6c 7920 6265 2074 6865 2072  an only be the r
-00028660: 6573 756c 7420 6f66 2061 2072 6f74 6174  esult of a rotat
-00028670: 696f 6e2e 0d0a 0d0a 2020 2020 2020 2020  ion.....        
-00028680: 5377 6565 7020 6973 2061 2076 616c 7565  Sweep is a value
-00028690: 2069 6e20 742e 0d0a 2020 2020 2020 2020   in t...        
-000286a0: 5468 6520 7377 6565 7020 616e 676c 6520  The sweep angle 
-000286b0: 6361 6e20 6265 2061 2076 616c 7565 2067  can be a value g
-000286c0: 7265 6174 6572 2074 6861 6e20 7461 7520  reater than tau 
-000286d0: 616e 6420 6c65 7373 2074 6861 6e20 2d74  and less than -t
-000286e0: 6175 2e0d 0a20 2020 2020 2020 2048 6f77  au...        How
-000286f0: 6576 6572 2069 6620 7468 6973 2069 7320  ever if this is 
+00027fa0: 7365 6c66 2e63 6f6e 7472 6f6c 3120 2d20  self.control1 - 
+00027fb0: 6375 7272 656e 745f 706f 696e 742c 0d0a  current_point,..
+00027fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027fd0: 2020 2020 7365 6c66 2e63 6f6e 7472 6f6c      self.control
+00027fe0: 3220 2d20 6375 7272 656e 745f 706f 696e  2 - current_poin
+00027ff0: 742c 0d0a 2020 2020 2020 2020 2020 2020  t,..            
+00028000: 2020 2020 2020 2020 7365 6c66 2e65 6e64          self.end
+00028010: 202d 2063 7572 7265 6e74 5f70 6f69 6e74   - current_point
+00028020: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00028030: 2020 2029 0d0a 0d0a 0d0a 636c 6173 7320     )......class 
+00028040: 4172 6328 4375 7276 6529 3a0d 0a20 2020  Arc(Curve):..   
+00028050: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
+00028060: 6c66 2c20 2a61 7267 732c 202a 2a6b 7761  lf, *args, **kwa
+00028070: 7267 7329 3a0d 0a20 2020 2020 2020 2022  rgs):..        "
+00028080: 2222 0d0a 2020 2020 2020 2020 5265 7072  ""..        Repr
+00028090: 6573 656e 7473 2041 7263 2063 6f6d 6d61  esents Arc comma
+000280a0: 6e64 732e 0d0a 0d0a 2020 2020 2020 2020  nds.....        
+000280b0: 4172 6320 6f62 6a65 6374 7320 6361 6e20  Arc objects can 
+000280c0: 7461 6b65 2064 6966 6665 7265 6e74 2070  take different p
+000280d0: 6172 616d 6574 6572 7320 746f 2063 7265  arameters to cre
+000280e0: 6174 6520 6172 6373 2e0d 0a20 2020 2020  ate arcs...     
+000280f0: 2020 2053 696e 6365 2077 6520 6578 7065     Since we expe
+00028100: 6374 2074 616b 696e 6720 696e 2053 5647  ct taking in SVG
+00028110: 2070 6172 616d 6574 6572 732e 2057 6520   parameters. We 
+00028120: 6163 6365 7074 2053 5647 2070 6172 616d  accept SVG param
+00028130: 6574 6572 697a 6174 696f 6e20 7768 6963  eterization whic
+00028140: 6820 6973 3a0d 0a20 2020 2020 2020 2073  h is:..        s
+00028150: 7461 7274 2c20 7278 2c20 7279 2c20 726f  tart, rx, ry, ro
+00028160: 7461 7469 6f6e 2c20 6172 635f 666c 6167  tation, arc_flag
+00028170: 2c20 7377 6565 705f 666c 6167 2c20 656e  , sweep_flag, en
+00028180: 642e 0d0a 0d0a 2020 2020 2020 2020 546f  d.....        To
+00028190: 2064 6f20 6d61 7472 6978 2074 7261 6e73   do matrix trans
+000281a0: 6974 696f 6e73 2c20 7468 6520 6e61 7469  itions, the nati
+000281b0: 7665 2070 6172 616d 6574 6572 697a 6174  ve parameterizat
+000281c0: 696f 6e20 6973 2073 7461 7274 2c20 656e  ion is start, en
+000281d0: 642c 2063 656e 7465 722c 2070 7278 2c20  d, center, prx, 
+000281e0: 7072 792c 2073 7765 6570 0d0a 0d0a 2020  pry, sweep....  
+000281f0: 2020 2020 2020 2773 7461 7274 2c20 656e        'start, en
+00028200: 642c 2063 656e 7465 722c 2070 7278 2c20  d, center, prx, 
+00028210: 7072 7927 2061 7265 2070 6f69 6e74 7320  pry' are points 
+00028220: 616e 6420 7377 6565 7020 616d 6f75 6e74  and sweep amount
+00028230: 2069 7320 6120 7420 7661 6c75 6520 696e   is a t value in
+00028240: 2074 6175 2072 6164 6961 6e73 2e0d 0a20   tau radians... 
+00028250: 2020 2020 2020 2049 6620 706f 696e 7473         If points
+00028260: 2061 7265 206d 6f64 6966 6965 6420 6279   are modified by
+00028270: 2061 6e20 6166 6669 6e65 2074 7261 6e73   an affine trans
+00028280: 666f 726d 6174 696f 6e2c 2074 6865 2061  formation, the a
+00028290: 7263 2069 7320 7472 616e 7366 6f72 6d65  rc is transforme
+000282a0: 642e 0d0a 2020 2020 2020 2020 5468 6572  d...        Ther
+000282b0: 6520 6973 2061 2073 7065 6369 616c 2063  e is a special c
+000282c0: 6173 6520 666f 7220 7768 656e 2074 6865  ase for when the
+000282d0: 2073 6361 6c65 2066 6163 746f 7220 696e   scale factor in
+000282e0: 7665 7274 732c 2069 7420 696e 7665 7274  verts, it invert
+000282f0: 7320 7468 6520 7377 6565 702e 0d0a 0d0a  s the sweep.....
+00028300: 2020 2020 2020 2020 4e6f 7465 3a20 742d          Note: t-
+00028310: 7661 6c75 6573 2061 7265 206e 6f74 2061  values are not a
+00028320: 6e67 6c65 7320 6672 6f6d 2063 656e 7465  ngles from cente
+00028330: 7220 696e 2065 6c6c 6970 7469 6361 6c20  r in elliptical 
+00028340: 6172 6373 2e20 5468 6573 6520 6172 6520  arcs. These are 
+00028350: 7468 6520 7361 6d65 2074 6869 6e67 2069  the same thing i
+00028360: 6e0d 0a20 2020 2020 2020 2063 6972 6375  n..        circu
+00028370: 6c61 7220 6172 6373 2e20 4275 742c 2068  lar arcs. But, h
+00028380: 6572 6520 7420 6973 2061 2070 6172 616d  ere t is a param
+00028390: 6574 6572 697a 6174 696f 6e20 6172 6f75  eterization arou
+000283a0: 6e64 2074 6865 2065 6c6c 6970 7365 2c20  nd the ellipse, 
+000283b0: 6173 2069 6620 6974 2077 6572 6520 6120  as if it were a 
+000283c0: 6369 7263 6c65 2e0d 0a20 2020 2020 2020  circle...       
+000283d0: 2054 6865 2070 6f73 6974 696f 6e20 6f6e   The position on
+000283e0: 2074 6865 2061 7263 2069 7320 2861 202a   the arc is (a *
+000283f0: 2063 6f73 2874 292c 2062 202a 2073 696e   cos(t), b * sin
+00028400: 2874 2929 2e20 4966 2072 2d6d 616a 6f72  (t)). If r-major
+00028410: 2077 6173 2030 2066 6f72 2065 7861 6d70   was 0 for examp
+00028420: 6c65 2e20 5468 650d 0a20 2020 2020 2020  le. The..       
+00028430: 2070 6f73 6974 696f 6e73 2077 6f75 6c64   positions would
+00028440: 2061 6c6c 2066 616c 6c20 6f6e 2074 6865   all fall on the
+00028450: 2078 2d61 7869 732e 2041 6e64 2074 6865   x-axis. And the
+00028460: 2061 6e67 6c65 2066 726f 6d20 6365 6e74   angle from cent
+00028470: 6572 2077 6f75 6c64 2061 6c6c 2062 6520  er would all be 
+00028480: 6569 7468 6572 2030 206f 720d 0a20 2020  either 0 or..   
+00028490: 2020 2020 2074 6175 2f32 2e20 486f 7765       tau/2. Howe
+000284a0: 7665 722c 2073 696e 6365 2074 2069 7320  ver, since t is 
+000284b0: 7468 6520 7061 7261 6d65 7465 7269 7a61  the parameteriza
+000284c0: 7469 6f6e 2077 6520 6361 6e20 636f 6e63  tion we can conc
+000284d0: 6570 7475 616c 697a 6520 6974 2061 7320  eptualize it as 
+000284e0: 6120 706f 7369 7469 6f6e 206f 6e20 610d  a position on a.
+000284f0: 0a20 2020 2020 2020 2063 6972 636c 6520  .        circle 
+00028500: 7768 6963 6820 6973 2074 6865 6e20 7363  which is then sc
+00028510: 616c 6564 2061 6e64 2072 6f74 6174 6564  aled and rotated
+00028520: 2062 7920 6120 6d61 7472 6978 2e0d 0a0d   by a matrix....
+00028530: 0a20 2020 2020 2020 2070 7278 2069 7320  .        prx is 
+00028540: 7468 6520 706f 696e 7420 6174 2074 2030  the point at t 0
+00028550: 2069 6e20 7468 6520 656c 6c69 7073 652e   in the ellipse.
+00028560: 0d0a 2020 2020 2020 2020 7072 7920 6973  ..        pry is
+00028570: 2074 6865 2070 6f69 6e74 2061 7420 7420   the point at t 
+00028580: 7461 752f 3420 696e 2074 6865 2065 6c6c  tau/4 in the ell
+00028590: 6970 7365 2e0d 0a20 2020 2020 2020 2070  ipse...        p
+000285a0: 7278 202d 3e20 6365 6e74 6572 202d 3e20  rx -> center -> 
+000285b0: 7072 7920 7368 6f75 6c64 2066 6f72 6d20  pry should form 
+000285c0: 6120 7269 6768 7420 7472 6961 6e67 6c65  a right triangle
+000285d0: 2e0d 0a0d 0a20 2020 2020 2020 2054 6865  .....        The
+000285e0: 2072 6f74 6174 696f 6e20 6361 6e20 6265   rotation can be
+000285f0: 2064 6566 696e 6564 2061 7320 7468 6520   defined as the 
+00028600: 616e 676c 6520 6672 6f6d 2063 656e 7465  angle from cente
+00028610: 7220 746f 2070 7278 2e20 5369 6e63 6520  r to prx. Since 
+00028620: 7072 7820 6973 206c 6f63 6174 6564 2061  prx is located a
+00028630: 740d 0a20 2020 2020 2020 2074 2830 2920  t..        t(0) 
+00028640: 6974 7320 6465 7669 6174 696f 6e20 6361  its deviation ca
+00028650: 6e20 6f6e 6c79 2062 6520 7468 6520 7265  n only be the re
+00028660: 7375 6c74 206f 6620 6120 726f 7461 7469  sult of a rotati
+00028670: 6f6e 2e0d 0a0d 0a20 2020 2020 2020 2053  on.....        S
+00028680: 7765 6570 2069 7320 6120 7661 6c75 6520  weep is a value 
+00028690: 696e 2074 2e0d 0a20 2020 2020 2020 2054  in t...        T
+000286a0: 6865 2073 7765 6570 2061 6e67 6c65 2063  he sweep angle c
+000286b0: 616e 2062 6520 6120 7661 6c75 6520 6772  an be a value gr
+000286c0: 6561 7465 7220 7468 616e 2074 6175 2061  eater than tau a
+000286d0: 6e64 206c 6573 7320 7468 616e 202d 7461  nd less than -ta
+000286e0: 752e 0d0a 2020 2020 2020 2020 486f 7765  u...        Howe
+000286f0: 7665 722c 2069 6620 7468 6973 2069 7320  ver, if this is 
 00028700: 7468 6520 6361 7365 2c20 636f 6e76 6572  the case, conver
 00028710: 7369 6f6e 2062 6163 6b20 746f 2050 6174  sion back to Pat
 00028720: 682e 6428 2920 6973 2065 7870 6563 7465  h.d() is expecte
 00028730: 6420 746f 2066 6169 6c2e 0d0a 2020 2020  d to fail...    
 00028740: 2020 2020 5765 2063 616e 2064 656e 6f74      We can denot
 00028750: 6520 7468 6573 6520 6172 6320 6576 656e  e these arc even
 00028760: 7473 2062 7574 206e 6f74 2061 7320 6120  ts but not as a 
@@ -11307,9860 +11307,10009 @@
 0002c2a0: 6629 3a0d 0a20 2020 2020 2020 2022 2222  f):..        """
 0002c2b0: 7363 6970 7920 6973 206e 6f74 2061 2064  scipy is not a d
 0002c2c0: 6570 656e 6465 6e63 792e 2048 6f77 6576  ependency. Howev
 0002c2d0: 6572 2c20 6966 2073 6369 7079 2065 7869  er, if scipy exi
 0002c2e0: 7374 7320 7468 6973 2066 756e 6374 696f  sts this functio
 0002c2f0: 6e20 7769 6c6c 2066 696e 6420 7468 650d  n will find the.
 0002c300: 0a20 2020 2020 2020 2065 7861 6374 2061  .        exact a
-0002c310: 7263 206c 656e 6774 682e 2042 7920 6465  rc length. By de
-0002c320: 6661 756c 7420 2e6c 656e 6774 6828 2920  fault .length() 
-0002c330: 6465 6c65 6761 7465 7320 746f 2068 6572  delegates to her
-0002c340: 6520 616e 6420 6f6e 2066 6169 6c75 7265  e and on failure
-0002c350: 2075 7365 7320 7468 650d 0a20 2020 2020   uses the..     
-0002c360: 2020 2066 616c 6c62 6163 6b20 6d65 7468     fallback meth
-0002c370: 6f64 2e22 2222 0d0a 2020 2020 2020 2020  od."""..        
-0002c380: 6672 6f6d 2073 6369 7079 2e73 7065 6369  from scipy.speci
-0002c390: 616c 2069 6d70 6f72 7420 656c 6c69 7065  al import ellipe
-0002c3a0: 696e 630d 0a0d 0a20 2020 2020 2020 2061  inc....        a
-0002c3b0: 203d 2073 656c 662e 7278 0d0a 2020 2020   = self.rx..    
-0002c3c0: 2020 2020 6220 3d20 7365 6c66 2e72 790d      b = self.ry.
-0002c3d0: 0a20 2020 2020 2020 2061 6462 203d 2061  .        adb = a
-0002c3e0: 202f 2062 0d0a 2020 2020 2020 2020 6d20   / b..        m 
-0002c3f0: 3d20 3120 2d20 6164 6220 2a20 6164 620d  = 1 - adb * adb.
-0002c400: 0a20 2020 2020 2020 2070 6869 203d 2073  .        phi = s
-0002c410: 656c 662e 6765 745f 7374 6172 745f 7428  elf.get_start_t(
-0002c420: 290d 0a20 2020 2020 2020 2064 3120 3d20  )..        d1 = 
-0002c430: 656c 6c69 7065 696e 6328 7068 692c 206d  ellipeinc(phi, m
-0002c440: 290d 0a20 2020 2020 2020 2070 6869 203d  )..        phi =
-0002c450: 2070 6869 202b 2073 656c 662e 7377 6565   phi + self.swee
-0002c460: 700d 0a20 2020 2020 2020 2064 3220 3d20  p..        d2 = 
-0002c470: 656c 6c69 7065 696e 6328 7068 692c 206d  ellipeinc(phi, m
-0002c480: 290d 0a20 2020 2020 2020 2072 6574 7572  )..        retur
-0002c490: 6e20 6220 2a20 6162 7328 6432 202d 2064  n b * abs(d2 - d
-0002c4a0: 3129 0d0a 0d0a 2020 2020 6465 6620 6c65  1)....    def le
-0002c4b0: 6e67 7468 2873 656c 662c 2065 7272 6f72  ngth(self, error
-0002c4c0: 3d45 5252 4f52 2c20 6d69 6e5f 6465 7074  =ERROR, min_dept
-0002c4d0: 683d 4d49 4e5f 4445 5054 4829 3a0d 0a20  h=MIN_DEPTH):.. 
-0002c4e0: 2020 2020 2020 2022 2222 5468 6520 6c65         """The le
-0002c4f0: 6e67 7468 206f 6620 616e 2065 6c6c 6970  ngth of an ellip
-0002c500: 7469 6361 6c20 6172 6320 7365 676d 656e  tical arc segmen
-0002c510: 7420 7265 7175 6972 6573 206e 756d 6572  t requires numer
-0002c520: 6963 616c 0d0a 2020 2020 2020 2020 696e  ical..        in
-0002c530: 7465 6772 6174 696f 6e2c 2061 6e64 2069  tegration, and i
-0002c540: 6e20 7468 6174 2063 6173 6520 6974 2773  n that case it's
-0002c550: 2073 696d 706c 6572 2074 6f20 6a75 7374   simpler to just
-0002c560: 2064 6f20 6120 6765 6f6d 6574 7269 630d   do a geometric.
-0002c570: 0a20 2020 2020 2020 2061 7070 726f 7869  .        approxi
-0002c580: 6d61 7469 6f6e 2c20 6173 2066 6f72 2063  mation, as for c
-0002c590: 7562 6963 2062 657a 6965 7220 6375 7276  ubic bezier curv
-0002c5a0: 6573 2e0d 0a20 2020 2020 2020 2022 2222  es...        """
-0002c5b0: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
-0002c5c0: 662e 7377 6565 7020 3d3d 2030 3a0d 0a20  f.sweep == 0:.. 
-0002c5d0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0002c5e0: 6e20 300d 0a20 2020 2020 2020 2069 6620  n 0..        if 
-0002c5f0: 7365 6c66 2e73 7461 7274 203d 3d20 7365  self.start == se
-0002c600: 6c66 2e65 6e64 2061 6e64 2073 656c 662e  lf.end and self.
-0002c610: 7377 6565 7020 3d3d 2030 3a0d 0a20 2020  sweep == 0:..   
-0002c620: 2020 2020 2020 2020 2023 2054 6869 7320           # This 
-0002c630: 6973 2065 7175 6976 616c 656e 7420 6f66  is equivalent of
-0002c640: 206f 6d69 7474 696e 6720 7468 6520 7365   omitting the se
-0002c650: 676d 656e 740d 0a20 2020 2020 2020 2020  gment..         
-0002c660: 2020 2072 6574 7572 6e20 300d 0a20 2020     return 0..   
-0002c670: 2020 2020 2061 203d 2073 656c 662e 7278       a = self.rx
-0002c680: 0d0a 2020 2020 2020 2020 6220 3d20 7365  ..        b = se
-0002c690: 6c66 2e72 790d 0a20 2020 2020 2020 2064  lf.ry..        d
-0002c6a0: 203d 2061 6273 2861 202d 2062 290d 0a0d   = abs(a - b)...
-0002c6b0: 0a20 2020 2020 2020 2069 6620 6420 3c20  .        if d < 
-0002c6c0: 4552 524f 523a 2020 2320 5468 6973 2069  ERROR:  # This i
-0002c6d0: 7320 6120 6369 7263 6c65 2e0d 0a20 2020  s a circle...   
-0002c6e0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0002c6f0: 6162 7328 7365 6c66 2e72 7820 2a20 7365  abs(self.rx * se
-0002c700: 6c66 2e73 7765 6570 290d 0a20 2020 2020  lf.sweep)..     
-0002c710: 2020 2074 7279 3a0d 0a20 2020 2020 2020     try:..       
-0002c720: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-0002c730: 2e5f 6578 6163 745f 6c65 6e67 7468 2829  ._exact_length()
-0002c740: 0d0a 2020 2020 2020 2020 6578 6365 7074  ..        except
-0002c750: 3a20 2023 2046 616c 6c62 6163 6b20 6f6e  :  # Fallback on
-0002c760: 2061 6e79 2066 6169 6c75 7265 0d0a 2020   any failure..  
-0002c770: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0002c780: 2073 656c 662e 5f6c 696e 655f 6c65 6e67   self._line_leng
-0002c790: 7468 2865 7272 6f72 3d65 7272 6f72 2c20  th(error=error, 
-0002c7a0: 6d69 6e5f 6465 7074 683d 6d69 6e5f 6465  min_depth=min_de
-0002c7b0: 7074 6829 0d0a 0d0a 2020 2020 6465 6620  pth)....    def 
-0002c7c0: 5f73 7667 5f63 6f6d 706c 6578 5f70 6172  _svg_complex_par
-0002c7d0: 616d 6574 6572 697a 6528 0d0a 2020 2020  ameterize(..    
-0002c7e0: 2020 2020 7365 6c66 2c20 7374 6172 742c      self, start,
-0002c7f0: 2072 6164 6975 732c 2072 6f74 6174 696f   radius, rotatio
-0002c800: 6e2c 2061 7263 5f66 6c61 672c 2073 7765  n, arc_flag, swe
-0002c810: 6570 5f66 6c61 672c 2065 6e64 0d0a 2020  ep_flag, end..  
-0002c820: 2020 293a 0d0a 2020 2020 2020 2020 2222    ):..        ""
-0002c830: 2250 6172 616d 6574 6572 697a 6174 696f  "Parameterizatio
-0002c840: 6e20 7769 7468 2063 6f6d 706c 6578 2072  n with complex r
-0002c850: 6164 6975 7320 616e 6420 6861 7669 6e67  adius and having
-0002c860: 2072 6f74 6174 696f 6e20 6661 6374 6f72   rotation factor
-0002c870: 732e 2222 220d 0a20 2020 2020 2020 2073  s."""..        s
-0002c880: 656c 662e 5f73 7667 5f70 6172 616d 6574  elf._svg_paramet
-0002c890: 6572 697a 6528 0d0a 2020 2020 2020 2020  erize(..        
-0002c8a0: 2020 2020 506f 696e 7428 7374 6172 7429      Point(start)
-0002c8b0: 2c0d 0a20 2020 2020 2020 2020 2020 2072  ,..            r
-0002c8c0: 6164 6975 732e 7265 616c 2c0d 0a20 2020  adius.real,..   
-0002c8d0: 2020 2020 2020 2020 2072 6164 6975 732e           radius.
-0002c8e0: 696d 6167 2c0d 0a20 2020 2020 2020 2020  imag,..         
-0002c8f0: 2020 2072 6f74 6174 696f 6e2c 0d0a 2020     rotation,..  
-0002c900: 2020 2020 2020 2020 2020 6172 635f 666c            arc_fl
-0002c910: 6167 2c0d 0a20 2020 2020 2020 2020 2020  ag,..           
-0002c920: 2073 7765 6570 5f66 6c61 672c 0d0a 2020   sweep_flag,..  
-0002c930: 2020 2020 2020 2020 2020 506f 696e 7428            Point(
-0002c940: 656e 6429 2c0d 0a20 2020 2020 2020 2029  end),..        )
-0002c950: 0d0a 0d0a 2020 2020 6465 6620 5f73 7667  ....    def _svg
-0002c960: 5f70 6172 616d 6574 6572 697a 6528 0d0a  _parameterize(..
-0002c970: 2020 2020 2020 2020 7365 6c66 2c20 7374          self, st
-0002c980: 6172 742c 2072 782c 2072 792c 2072 6f74  art, rx, ry, rot
-0002c990: 6174 696f 6e2c 206c 6172 6765 5f61 7263  ation, large_arc
-0002c9a0: 5f66 6c61 672c 2073 7765 6570 5f66 6c61  _flag, sweep_fla
-0002c9b0: 672c 2065 6e64 0d0a 2020 2020 293a 0d0a  g, end..    ):..
-0002c9c0: 2020 2020 2020 2020 2222 2243 6f6e 7665          """Conve
-0002c9d0: 7273 696f 6e20 6672 6f6d 2073 7667 2070  rsion from svg p
-0002c9e0: 6172 616d 6574 6572 697a 6174 696f 6e2c  arameterization,
-0002c9f0: 206f 7572 2063 686f 7365 6e20 6e61 7469   our chosen nati
-0002ca00: 7665 206e 6174 6976 6520 666f 726d 2e0d  ve native form..
-0002ca10: 0a20 2020 2020 2020 2068 7474 703a 2f2f  .        http://
-0002ca20: 7777 772e 7733 2e6f 7267 2f54 522f 5356  www.w3.org/TR/SV
-0002ca30: 472f 696d 706c 6e6f 7465 2e68 746d 6c23  G/implnote.html#
-0002ca40: 4172 6349 6d70 6c65 6d65 6e74 6174 696f  ArcImplementatio
-0002ca50: 6e4e 6f74 6573 2222 220d 0a0d 0a20 2020  nNotes"""....   
-0002ca60: 2020 2020 206c 6172 6765 5f61 7263 5f66       large_arc_f
-0002ca70: 6c61 6720 3d20 626f 6f6c 286c 6172 6765  lag = bool(large
-0002ca80: 5f61 7263 5f66 6c61 6729 0d0a 2020 2020  _arc_flag)..    
-0002ca90: 2020 2020 7377 6565 705f 666c 6167 203d      sweep_flag =
-0002caa0: 2062 6f6f 6c28 7377 6565 705f 666c 6167   bool(sweep_flag
-0002cab0: 290d 0a20 2020 2020 2020 2073 7461 7274  )..        start
-0002cac0: 203d 2050 6f69 6e74 2873 7461 7274 290d   = Point(start).
-0002cad0: 0a20 2020 2020 2020 2073 656c 662e 7374  .        self.st
-0002cae0: 6172 7420 3d20 7374 6172 740d 0a20 2020  art = start..   
-0002caf0: 2020 2020 2065 6e64 203d 2050 6f69 6e74       end = Point
-0002cb00: 2865 6e64 290d 0a20 2020 2020 2020 2073  (end)..        s
-0002cb10: 656c 662e 656e 6420 3d20 656e 640d 0a20  elf.end = end.. 
-0002cb20: 2020 2020 2020 2069 6620 7374 6172 7420         if start 
-0002cb30: 3d3d 2065 6e64 206f 7220 7278 203d 3d20  == end or rx == 
-0002cb40: 3020 6f72 2072 7920 3d3d 2030 3a0d 0a20  0 or ry == 0:.. 
-0002cb50: 2020 2020 2020 2020 2020 2023 2049 6620             # If 
-0002cb60: 7374 6172 7420 6973 2065 7175 616c 2074  start is equal t
-0002cb70: 6f20 656e 642c 2074 6865 7265 2061 7265  o end, there are
-0002cb80: 2069 6e66 696e 6974 6520 6e75 6d62 6572   infinite number
-0002cb90: 206f 6620 6369 7263 6c65 7320 736f 2074   of circles so t
-0002cba0: 6865 7365 2076 6f69 6420 6f75 742e 0d0a  hese void out...
-0002cbb0: 2020 2020 2020 2020 2020 2020 2320 5765              # We
-0002cbc0: 2073 7469 6c6c 2070 6572 6d69 7420 7468   still permit th
-0002cbd0: 6973 206b 696e 6420 6f66 2061 7263 2c20  is kind of arc, 
-0002cbe0: 6275 7420 5356 4720 7061 7261 6d65 7465  but SVG paramete
-0002cbf0: 7269 7a61 7469 6f6e 2063 616e 6e6f 7420  rization cannot 
-0002cc00: 6265 2075 7365 6420 746f 2061 6368 6965  be used to achie
-0002cc10: 7665 2069 742e 0d0a 2020 2020 2020 2020  ve it...        
-0002cc20: 2020 2020 7365 6c66 2e73 7765 6570 203d      self.sweep =
-0002cc30: 2030 0d0a 2020 2020 2020 2020 2020 2020   0..            
-0002cc40: 7365 6c66 2e70 7278 203d 2050 6f69 6e74  self.prx = Point
-0002cc50: 2873 7461 7274 290d 0a20 2020 2020 2020  (start)..       
-0002cc60: 2020 2020 2073 656c 662e 7072 7920 3d20       self.pry = 
-0002cc70: 506f 696e 7428 7374 6172 7429 0d0a 2020  Point(start)..  
-0002cc80: 2020 2020 2020 2020 2020 7365 6c66 2e63            self.c
-0002cc90: 656e 7465 7220 3d20 506f 696e 7428 7374  enter = Point(st
-0002cca0: 6172 7429 0d0a 2020 2020 2020 2020 2020  art)..          
-0002ccb0: 2020 7265 7475 726e 0d0a 2020 2020 2020    return..      
-0002ccc0: 2020 636f 7372 203d 2063 6f73 2872 6164    cosr = cos(rad
-0002ccd0: 6961 6e73 2872 6f74 6174 696f 6e29 290d  ians(rotation)).
-0002cce0: 0a20 2020 2020 2020 2073 696e 7220 3d20  .        sinr = 
-0002ccf0: 7369 6e28 7261 6469 616e 7328 726f 7461  sin(radians(rota
-0002cd00: 7469 6f6e 2929 0d0a 2020 2020 2020 2020  tion))..        
-0002cd10: 6478 203d 2028 7374 6172 742e 7265 616c  dx = (start.real
-0002cd20: 202d 2065 6e64 2e72 6561 6c29 202f 2032   - end.real) / 2
-0002cd30: 0d0a 2020 2020 2020 2020 6479 203d 2028  ..        dy = (
-0002cd40: 7374 6172 742e 696d 6167 202d 2065 6e64  start.imag - end
-0002cd50: 2e69 6d61 6729 202f 2032 0d0a 2020 2020  .imag) / 2..    
-0002cd60: 2020 2020 7831 7072 696d 203d 2063 6f73      x1prim = cos
-0002cd70: 7220 2a20 6478 202b 2073 696e 7220 2a20  r * dx + sinr * 
-0002cd80: 6479 0d0a 2020 2020 2020 2020 7831 7072  dy..        x1pr
-0002cd90: 696d 5f73 7120 3d20 7831 7072 696d 202a  im_sq = x1prim *
-0002cda0: 2078 3170 7269 6d0d 0a20 2020 2020 2020   x1prim..       
-0002cdb0: 2079 3170 7269 6d20 3d20 2d73 696e 7220   y1prim = -sinr 
-0002cdc0: 2a20 6478 202b 2063 6f73 7220 2a20 6479  * dx + cosr * dy
-0002cdd0: 0d0a 2020 2020 2020 2020 7931 7072 696d  ..        y1prim
-0002cde0: 5f73 7120 3d20 7931 7072 696d 202a 2079  _sq = y1prim * y
-0002cdf0: 3170 7269 6d0d 0a0d 0a20 2020 2020 2020  1prim....       
-0002ce00: 2072 785f 7371 203d 2072 7820 2a20 7278   rx_sq = rx * rx
-0002ce10: 0d0a 2020 2020 2020 2020 7279 5f73 7120  ..        ry_sq 
-0002ce20: 3d20 7279 202a 2072 790d 0a0d 0a20 2020  = ry * ry....   
-0002ce30: 2020 2020 2023 2043 6f72 7265 6374 206f       # Correct o
-0002ce40: 7574 206f 6620 7261 6e67 6520 7261 6469  ut of range radi
-0002ce50: 690d 0a20 2020 2020 2020 2072 6164 6975  i..        radiu
-0002ce60: 735f 6368 6563 6b20 3d20 2878 3170 7269  s_check = (x1pri
-0002ce70: 6d5f 7371 202f 2072 785f 7371 2920 2b20  m_sq / rx_sq) + 
-0002ce80: 2879 3170 7269 6d5f 7371 202f 2072 795f  (y1prim_sq / ry_
-0002ce90: 7371 290d 0a20 2020 2020 2020 2069 6620  sq)..        if 
-0002cea0: 7261 6469 7573 5f63 6865 636b 203e 2031  radius_check > 1
-0002ceb0: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
-0002cec0: 7820 2a3d 2073 7172 7428 7261 6469 7573  x *= sqrt(radius
-0002ced0: 5f63 6865 636b 290d 0a20 2020 2020 2020  _check)..       
-0002cee0: 2020 2020 2072 7920 2a3d 2073 7172 7428       ry *= sqrt(
-0002cef0: 7261 6469 7573 5f63 6865 636b 290d 0a20  radius_check).. 
-0002cf00: 2020 2020 2020 2020 2020 2072 785f 7371             rx_sq
-0002cf10: 203d 2072 7820 2a20 7278 0d0a 2020 2020   = rx * rx..    
-0002cf20: 2020 2020 2020 2020 7279 5f73 7120 3d20          ry_sq = 
-0002cf30: 7279 202a 2072 790d 0a0d 0a20 2020 2020  ry * ry....     
-0002cf40: 2020 2074 3120 3d20 7278 5f73 7120 2a20     t1 = rx_sq * 
-0002cf50: 7931 7072 696d 5f73 710d 0a20 2020 2020  y1prim_sq..     
-0002cf60: 2020 2074 3220 3d20 7279 5f73 7120 2a20     t2 = ry_sq * 
-0002cf70: 7831 7072 696d 5f73 710d 0a20 2020 2020  x1prim_sq..     
-0002cf80: 2020 2063 203d 2073 7172 7428 6162 7328     c = sqrt(abs(
-0002cf90: 2872 785f 7371 202a 2072 795f 7371 202d  (rx_sq * ry_sq -
-0002cfa0: 2074 3120 2d20 7432 2920 2f20 2874 3120   t1 - t2) / (t1 
-0002cfb0: 2b20 7432 2929 290d 0a0d 0a20 2020 2020  + t2)))....     
-0002cfc0: 2020 2069 6620 6c61 7267 655f 6172 635f     if large_arc_
-0002cfd0: 666c 6167 203d 3d20 7377 6565 705f 666c  flag == sweep_fl
-0002cfe0: 6167 3a0d 0a20 2020 2020 2020 2020 2020  ag:..           
-0002cff0: 2063 203d 202d 630d 0a20 2020 2020 2020   c = -c..       
-0002d000: 2063 7870 7269 6d20 3d20 6320 2a20 7278   cxprim = c * rx
-0002d010: 202a 2079 3170 7269 6d20 2f20 7279 0d0a   * y1prim / ry..
-0002d020: 2020 2020 2020 2020 6379 7072 696d 203d          cyprim =
-0002d030: 202d 6320 2a20 7279 202a 2078 3170 7269   -c * ry * x1pri
-0002d040: 6d20 2f20 7278 0d0a 0d0a 2020 2020 2020  m / rx....      
-0002d050: 2020 6365 6e74 6572 203d 2050 6f69 6e74    center = Point
-0002d060: 280d 0a20 2020 2020 2020 2020 2020 2028  (..            (
-0002d070: 636f 7372 202a 2063 7870 7269 6d20 2d20  cosr * cxprim - 
-0002d080: 7369 6e72 202a 2063 7970 7269 6d29 202b  sinr * cyprim) +
-0002d090: 2028 2873 7461 7274 2e72 6561 6c20 2b20   ((start.real + 
-0002d0a0: 656e 642e 7265 616c 2920 2f20 3229 2c0d  end.real) / 2),.
-0002d0b0: 0a20 2020 2020 2020 2020 2020 2028 7369  .            (si
-0002d0c0: 6e72 202a 2063 7870 7269 6d20 2b20 636f  nr * cxprim + co
-0002d0d0: 7372 202a 2063 7970 7269 6d29 202b 2028  sr * cyprim) + (
-0002d0e0: 2873 7461 7274 2e69 6d61 6720 2b20 656e  (start.imag + en
-0002d0f0: 642e 696d 6167 2920 2f20 3229 2c0d 0a20  d.imag) / 2),.. 
-0002d100: 2020 2020 2020 2029 0d0a 0d0a 2020 2020         )....    
-0002d110: 2020 2020 7578 203d 2028 7831 7072 696d      ux = (x1prim
-0002d120: 202d 2063 7870 7269 6d29 202f 2072 780d   - cxprim) / rx.
-0002d130: 0a20 2020 2020 2020 2075 7920 3d20 2879  .        uy = (y
-0002d140: 3170 7269 6d20 2d20 6379 7072 696d 2920  1prim - cyprim) 
-0002d150: 2f20 7279 0d0a 2020 2020 2020 2020 7678  / ry..        vx
-0002d160: 203d 2028 2d78 3170 7269 6d20 2d20 6378   = (-x1prim - cx
-0002d170: 7072 696d 2920 2f20 7278 0d0a 2020 2020  prim) / rx..    
-0002d180: 2020 2020 7679 203d 2028 2d79 3170 7269      vy = (-y1pri
-0002d190: 6d20 2d20 6379 7072 696d 2920 2f20 7279  m - cyprim) / ry
-0002d1a0: 0d0a 2020 2020 2020 2020 6e20 3d20 7371  ..        n = sq
-0002d1b0: 7274 2875 7820 2a20 7578 202b 2075 7920  rt(ux * ux + uy 
-0002d1c0: 2a20 7579 290d 0a20 2020 2020 2020 2070  * uy)..        p
-0002d1d0: 203d 2075 780d 0a20 2020 2020 2020 2023   = ux..        #
-0002d1e0: 2074 6865 7461 203d 2064 6567 7265 6573   theta = degrees
-0002d1f0: 2861 636f 7328 7020 2f20 6e29 290d 0a20  (acos(p / n)).. 
-0002d200: 2020 2020 2020 2023 2069 6620 7579 203c         # if uy <
-0002d210: 2030 3a0d 0a20 2020 2020 2020 2023 2020   0:..        #  
-0002d220: 2020 2074 6865 7461 203d 202d 7468 6574     theta = -thet
-0002d230: 610d 0a20 2020 2020 2020 2023 2074 6865  a..        # the
-0002d240: 7461 203d 2074 6865 7461 2025 2033 3630  ta = theta % 360
-0002d250: 0d0a 0d0a 2020 2020 2020 2020 6e20 3d20  ....        n = 
-0002d260: 7371 7274 2828 7578 202a 2075 7820 2b20  sqrt((ux * ux + 
-0002d270: 7579 202a 2075 7929 202a 2028 7678 202a  uy * uy) * (vx *
-0002d280: 2076 7820 2b20 7679 202a 2076 7929 290d   vx + vy * vy)).
-0002d290: 0a20 2020 2020 2020 2070 203d 2075 7820  .        p = ux 
-0002d2a0: 2a20 7678 202b 2075 7920 2a20 7679 0d0a  * vx + uy * vy..
-0002d2b0: 2020 2020 2020 2020 6420 3d20 7020 2f20          d = p / 
-0002d2c0: 6e0d 0a20 2020 2020 2020 2023 2049 6e20  n..        # In 
-0002d2d0: 6365 7274 6169 6e20 6361 7365 7320 7468  certain cases th
-0002d2e0: 6520 6162 6f76 6520 6361 6c63 756c 6174  e above calculat
-0002d2f0: 696f 6e20 6361 6e20 7468 726f 7567 6820  ion can through 
-0002d300: 696e 6163 6375 7261 6369 6573 0d0a 2020  inaccuracies..  
-0002d310: 2020 2020 2020 2320 6265 636f 6d65 206a        # become j
-0002d320: 7573 7420 736c 6967 6874 6c79 206f 7574  ust slightly out
-0002d330: 206f 6620 7261 6e67 652c 2066 2065 7820   of range, f ex 
-0002d340: 2d31 2e30 3030 3030 3030 3030 3030 3030  -1.0000000000000
-0002d350: 3030 322e 0d0a 2020 2020 2020 2020 6966  002...        if
-0002d360: 2064 203e 2031 2e30 3a0d 0a20 2020 2020   d > 1.0:..     
-0002d370: 2020 2020 2020 2064 203d 2031 2e30 0d0a         d = 1.0..
-0002d380: 2020 2020 2020 2020 656c 6966 2064 203c          elif d <
-0002d390: 202d 312e 303a 0d0a 2020 2020 2020 2020   -1.0:..        
-0002d3a0: 2020 2020 6420 3d20 2d31 2e30 0d0a 2020      d = -1.0..  
-0002d3b0: 2020 2020 2020 6465 6c74 6120 3d20 6465        delta = de
-0002d3c0: 6772 6565 7328 6163 6f73 2864 2929 0d0a  grees(acos(d))..
-0002d3d0: 2020 2020 2020 2020 6966 2028 7578 202a          if (ux *
-0002d3e0: 2076 7920 2d20 7579 202a 2076 7829 203c   vy - uy * vx) <
-0002d3f0: 2030 3a0d 0a20 2020 2020 2020 2020 2020   0:..           
-0002d400: 2064 656c 7461 203d 202d 6465 6c74 610d   delta = -delta.
-0002d410: 0a20 2020 2020 2020 2064 656c 7461 203d  .        delta =
-0002d420: 2064 656c 7461 2025 2033 3630 0d0a 2020   delta % 360..  
-0002d430: 2020 2020 2020 6966 206e 6f74 2073 7765        if not swe
-0002d440: 6570 5f66 6c61 673a 0d0a 2020 2020 2020  ep_flag:..      
-0002d450: 2020 2020 2020 6465 6c74 6120 2d3d 2033        delta -= 3
-0002d460: 3630 0d0a 2020 2020 2020 2020 2320 6275  60..        # bu
-0002d470: 696c 7420 7061 7261 6d65 7465 7273 2c20  ilt parameters, 
-0002d480: 6465 6c74 612c 2074 6865 7461 2c20 6365  delta, theta, ce
-0002d490: 6e74 6572 0d0a 0d0a 2020 2020 2020 2020  nter....        
-0002d4a0: 726f 7461 7465 5f6d 6174 7269 7820 3d20  rotate_matrix = 
-0002d4b0: 4d61 7472 6978 2829 0d0a 2020 2020 2020  Matrix()..      
-0002d4c0: 2020 726f 7461 7465 5f6d 6174 7269 782e    rotate_matrix.
-0002d4d0: 706f 7374 5f72 6f74 6174 6528 0d0a 2020  post_rotate(..  
-0002d4e0: 2020 2020 2020 2020 2020 416e 676c 652e            Angle.
-0002d4f0: 6465 6772 6565 7328 726f 7461 7469 6f6e  degrees(rotation
-0002d500: 292e 6173 5f72 6164 6961 6e73 2c20 6365  ).as_radians, ce
-0002d510: 6e74 6572 2e78 2c20 6365 6e74 6572 2e79  nter.x, center.y
-0002d520: 0d0a 2020 2020 2020 2020 290d 0a0d 0a20  ..        ).... 
-0002d530: 2020 2020 2020 2073 656c 662e 6365 6e74         self.cent
-0002d540: 6572 203d 2063 656e 7465 720d 0a20 2020  er = center..   
-0002d550: 2020 2020 2073 656c 662e 7072 7820 3d20       self.prx = 
-0002d560: 506f 696e 7428 6365 6e74 6572 2e78 202b  Point(center.x +
-0002d570: 2072 782c 2063 656e 7465 722e 7929 0d0a   rx, center.y)..
-0002d580: 2020 2020 2020 2020 7365 6c66 2e70 7279          self.pry
-0002d590: 203d 2050 6f69 6e74 2863 656e 7465 722e   = Point(center.
-0002d5a0: 782c 2063 656e 7465 722e 7920 2b20 7279  x, center.y + ry
-0002d5b0: 290d 0a0d 0a20 2020 2020 2020 2073 656c  )....        sel
-0002d5c0: 662e 7072 782e 6d61 7472 6978 5f74 7261  f.prx.matrix_tra
-0002d5d0: 6e73 666f 726d 2872 6f74 6174 655f 6d61  nsform(rotate_ma
-0002d5e0: 7472 6978 290d 0a20 2020 2020 2020 2073  trix)..        s
-0002d5f0: 656c 662e 7072 792e 6d61 7472 6978 5f74  elf.pry.matrix_t
-0002d600: 7261 6e73 666f 726d 2872 6f74 6174 655f  ransform(rotate_
-0002d610: 6d61 7472 6978 290d 0a20 2020 2020 2020  matrix)..       
-0002d620: 2073 656c 662e 7377 6565 7020 3d20 416e   self.sweep = An
-0002d630: 676c 652e 6465 6772 6565 7328 6465 6c74  gle.degrees(delt
-0002d640: 6129 2e61 735f 7261 6469 616e 730d 0a0d  a).as_radians...
-0002d650: 0a20 2020 2064 6566 2061 735f 7175 6164  .    def as_quad
-0002d660: 5f63 7572 7665 7328 7365 6c66 2c20 6172  _curves(self, ar
-0002d670: 635f 7265 7175 6972 6564 3d4e 6f6e 6529  c_required=None)
-0002d680: 3a0d 0a20 2020 2020 2020 2069 6620 6172  :..        if ar
-0002d690: 635f 7265 7175 6972 6564 2069 7320 4e6f  c_required is No
-0002d6a0: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
-0002d6b0: 2073 7765 6570 5f6c 696d 6974 203d 2074   sweep_limit = t
-0002d6c0: 6175 202f 2031 322e 300d 0a20 2020 2020  au / 12.0..     
-0002d6d0: 2020 2020 2020 2061 7263 5f72 6571 7569         arc_requi
-0002d6e0: 7265 6420 3d20 696e 7428 6365 696c 2861  red = int(ceil(a
-0002d6f0: 6273 2873 656c 662e 7377 6565 7029 202f  bs(self.sweep) /
-0002d700: 2073 7765 6570 5f6c 696d 6974 2929 0d0a   sweep_limit))..
-0002d710: 2020 2020 2020 2020 6966 2061 7263 5f72          if arc_r
-0002d720: 6571 7569 7265 6420 3d3d 2030 3a0d 0a20  equired == 0:.. 
-0002d730: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0002d740: 6e0d 0a20 2020 2020 2020 2074 5f73 6c69  n..        t_sli
-0002d750: 6365 203d 2073 656c 662e 7377 6565 7020  ce = self.sweep 
-0002d760: 2f20 666c 6f61 7428 6172 635f 7265 7175  / float(arc_requ
-0002d770: 6972 6564 290d 0a0d 0a20 2020 2020 2020  ired)....       
-0002d780: 2063 7572 7265 6e74 5f74 203d 2073 656c   current_t = sel
-0002d790: 662e 6765 745f 7374 6172 745f 7428 290d  f.get_start_t().
-0002d7a0: 0a20 2020 2020 2020 2070 5f73 7461 7274  .        p_start
-0002d7b0: 203d 2073 656c 662e 7374 6172 740d 0a0d   = self.start...
-0002d7c0: 0a20 2020 2020 2020 2074 6865 7461 203d  .        theta =
-0002d7d0: 2073 656c 662e 6765 745f 726f 7461 7469   self.get_rotati
-0002d7e0: 6f6e 2829 0d0a 2020 2020 2020 2020 636f  on()..        co
-0002d7f0: 735f 7468 6574 6120 3d20 636f 7328 7468  s_theta = cos(th
-0002d800: 6574 6129 0d0a 2020 2020 2020 2020 7369  eta)..        si
-0002d810: 6e5f 7468 6574 6120 3d20 7369 6e28 7468  n_theta = sin(th
-0002d820: 6574 6129 0d0a 0d0a 2020 2020 2020 2020  eta)....        
-0002d830: 6120 3d20 7365 6c66 2e72 780d 0a20 2020  a = self.rx..   
-0002d840: 2020 2020 2062 203d 2073 656c 662e 7279       b = self.ry
-0002d850: 0d0a 2020 2020 2020 2020 6378 203d 2073  ..        cx = s
-0002d860: 656c 662e 6365 6e74 6572 2e78 0d0a 2020  elf.center.x..  
-0002d870: 2020 2020 2020 6379 203d 2073 656c 662e        cy = self.
-0002d880: 6365 6e74 6572 2e79 0d0a 0d0a 2020 2020  center.y....    
-0002d890: 2020 2020 666f 7220 6920 696e 2072 616e      for i in ran
-0002d8a0: 6765 2830 2c20 6172 635f 7265 7175 6972  ge(0, arc_requir
-0002d8b0: 6564 293a 0d0a 2020 2020 2020 2020 2020  ed):..          
-0002d8c0: 2020 6e65 7874 5f74 203d 2063 7572 7265    next_t = curre
-0002d8d0: 6e74 5f74 202b 2074 5f73 6c69 6365 0d0a  nt_t + t_slice..
-0002d8e0: 2020 2020 2020 2020 2020 2020 6d69 645f              mid_
-0002d8f0: 7420 3d20 286e 6578 745f 7420 2b20 6375  t = (next_t + cu
-0002d900: 7272 656e 745f 7429 202f 2032 0d0a 2020  rrent_t) / 2..  
-0002d910: 2020 2020 2020 2020 2020 705f 656e 6420            p_end 
-0002d920: 3d20 7365 6c66 2e70 6f69 6e74 5f61 745f  = self.point_at_
-0002d930: 7428 6e65 7874 5f74 290d 0a20 2020 2020  t(next_t)..     
-0002d940: 2020 2020 2020 2069 6620 6920 3d3d 2061         if i == a
-0002d950: 7263 5f72 6571 7569 7265 6420 2d20 313a  rc_required - 1:
-0002d960: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0002d970: 2020 705f 656e 6420 3d20 7365 6c66 2e65    p_end = self.e
-0002d980: 6e64 0d0a 2020 2020 2020 2020 2020 2020  nd..            
-0002d990: 636f 735f 6d69 645f 7420 3d20 636f 7328  cos_mid_t = cos(
-0002d9a0: 6d69 645f 7429 0d0a 2020 2020 2020 2020  mid_t)..        
-0002d9b0: 2020 2020 7369 6e5f 6d69 645f 7420 3d20      sin_mid_t = 
-0002d9c0: 7369 6e28 6d69 645f 7429 0d0a 2020 2020  sin(mid_t)..    
-0002d9d0: 2020 2020 2020 2020 616c 7068 6120 3d20          alpha = 
-0002d9e0: 2834 2e30 202d 2063 6f73 2874 5f73 6c69  (4.0 - cos(t_sli
-0002d9f0: 6365 2929 202f 2033 2e30 0d0a 2020 2020  ce)) / 3.0..    
-0002da00: 2020 2020 2020 2020 7078 203d 2063 7820          px = cx 
-0002da10: 2b20 616c 7068 6120 2a20 2861 202a 2063  + alpha * (a * c
-0002da20: 6f73 5f6d 6964 5f74 202a 2063 6f73 5f74  os_mid_t * cos_t
-0002da30: 6865 7461 202d 2062 202a 2073 696e 5f6d  heta - b * sin_m
-0002da40: 6964 5f74 202a 2073 696e 5f74 6865 7461  id_t * sin_theta
-0002da50: 290d 0a20 2020 2020 2020 2020 2020 2070  )..            p
-0002da60: 7920 3d20 6379 202b 2061 6c70 6861 202a  y = cy + alpha *
-0002da70: 2028 6120 2a20 636f 735f 6d69 645f 7420   (a * cos_mid_t 
-0002da80: 2a20 7369 6e5f 7468 6574 6120 2b20 6220  * sin_theta + b 
-0002da90: 2a20 7369 6e5f 6d69 645f 7420 2a20 636f  * sin_mid_t * co
-0002daa0: 735f 7468 6574 6129 0d0a 2020 2020 2020  s_theta)..      
-0002dab0: 2020 2020 2020 7969 656c 6420 5175 6164        yield Quad
-0002dac0: 7261 7469 6342 657a 6965 7228 705f 7374  raticBezier(p_st
-0002dad0: 6172 742c 2028 7078 2c20 7079 292c 2070  art, (px, py), p
-0002dae0: 5f65 6e64 290d 0a20 2020 2020 2020 2020  _end)..         
-0002daf0: 2020 2070 5f73 7461 7274 203d 2070 5f65     p_start = p_e
-0002db00: 6e64 0d0a 2020 2020 2020 2020 2020 2020  nd..            
-0002db10: 6375 7272 656e 745f 7420 3d20 6e65 7874  current_t = next
-0002db20: 5f74 0d0a 0d0a 2020 2020 6465 6620 6173  _t....    def as
-0002db30: 5f63 7562 6963 5f63 7572 7665 7328 7365  _cubic_curves(se
-0002db40: 6c66 2c20 6172 635f 7265 7175 6972 6564  lf, arc_required
-0002db50: 3d4e 6f6e 6529 3a0d 0a20 2020 2020 2020  =None):..       
-0002db60: 2069 6620 6172 635f 7265 7175 6972 6564   if arc_required
-0002db70: 2069 7320 4e6f 6e65 3a0d 0a20 2020 2020   is None:..     
-0002db80: 2020 2020 2020 2073 7765 6570 5f6c 696d         sweep_lim
-0002db90: 6974 203d 2074 6175 202f 2031 322e 300d  it = tau / 12.0.
-0002dba0: 0a20 2020 2020 2020 2020 2020 2061 7263  .            arc
-0002dbb0: 5f72 6571 7569 7265 6420 3d20 696e 7428  _required = int(
-0002dbc0: 6365 696c 2861 6273 2873 656c 662e 7377  ceil(abs(self.sw
-0002dbd0: 6565 7029 202f 2073 7765 6570 5f6c 696d  eep) / sweep_lim
-0002dbe0: 6974 2929 0d0a 2020 2020 2020 2020 6966  it))..        if
-0002dbf0: 2061 7263 5f72 6571 7569 7265 6420 3d3d   arc_required ==
-0002dc00: 2030 3a0d 0a20 2020 2020 2020 2020 2020   0:..           
-0002dc10: 2072 6574 7572 6e0d 0a20 2020 2020 2020   return..       
-0002dc20: 2074 5f73 6c69 6365 203d 2073 656c 662e   t_slice = self.
-0002dc30: 7377 6565 7020 2f20 666c 6f61 7428 6172  sweep / float(ar
-0002dc40: 635f 7265 7175 6972 6564 290d 0a0d 0a20  c_required).... 
-0002dc50: 2020 2020 2020 2074 6865 7461 203d 2073         theta = s
-0002dc60: 656c 662e 6765 745f 726f 7461 7469 6f6e  elf.get_rotation
-0002dc70: 2829 0d0a 2020 2020 2020 2020 7278 203d  ()..        rx =
-0002dc80: 2073 656c 662e 7278 0d0a 2020 2020 2020   self.rx..      
-0002dc90: 2020 7279 203d 2073 656c 662e 7279 0d0a    ry = self.ry..
-0002dca0: 2020 2020 2020 2020 705f 7374 6172 7420          p_start 
-0002dcb0: 3d20 7365 6c66 2e73 7461 7274 0d0a 2020  = self.start..  
-0002dcc0: 2020 2020 2020 6375 7272 656e 745f 7420        current_t 
-0002dcd0: 3d20 7365 6c66 2e67 6574 5f73 7461 7274  = self.get_start
-0002dce0: 5f74 2829 0d0a 2020 2020 2020 2020 7830  _t()..        x0
-0002dcf0: 203d 2073 656c 662e 6365 6e74 6572 2e78   = self.center.x
-0002dd00: 0d0a 2020 2020 2020 2020 7930 203d 2073  ..        y0 = s
-0002dd10: 656c 662e 6365 6e74 6572 2e79 0d0a 2020  elf.center.y..  
-0002dd20: 2020 2020 2020 636f 735f 7468 6574 6120        cos_theta 
-0002dd30: 3d20 636f 7328 7468 6574 6129 0d0a 2020  = cos(theta)..  
-0002dd40: 2020 2020 2020 7369 6e5f 7468 6574 6120        sin_theta 
-0002dd50: 3d20 7369 6e28 7468 6574 6129 0d0a 0d0a  = sin(theta)....
-0002dd60: 2020 2020 2020 2020 666f 7220 6920 696e          for i in
-0002dd70: 2072 616e 6765 2830 2c20 6172 635f 7265   range(0, arc_re
-0002dd80: 7175 6972 6564 293a 0d0a 2020 2020 2020  quired):..      
-0002dd90: 2020 2020 2020 6e65 7874 5f74 203d 2063        next_t = c
-0002dda0: 7572 7265 6e74 5f74 202b 2074 5f73 6c69  urrent_t + t_sli
-0002ddb0: 6365 0d0a 0d0a 2020 2020 2020 2020 2020  ce....          
-0002ddc0: 2020 616c 7068 6120 3d20 7369 6e28 745f    alpha = sin(t_
-0002ddd0: 736c 6963 6529 202a 2028 7371 7274 2834  slice) * (sqrt(4
-0002dde0: 202b 2033 202a 2070 6f77 2874 616e 2874   + 3 * pow(tan(t
-0002ddf0: 5f73 6c69 6365 202f 2032 2e30 292c 2032  _slice / 2.0), 2
-0002de00: 2929 202d 2031 2920 2f20 332e 300d 0a0d  )) - 1) / 3.0...
-0002de10: 0a20 2020 2020 2020 2020 2020 2063 6f73  .            cos
-0002de20: 5f73 7461 7274 5f74 203d 2063 6f73 2863  _start_t = cos(c
-0002de30: 7572 7265 6e74 5f74 290d 0a20 2020 2020  urrent_t)..     
-0002de40: 2020 2020 2020 2073 696e 5f73 7461 7274         sin_start
-0002de50: 5f74 203d 2073 696e 2863 7572 7265 6e74  _t = sin(current
-0002de60: 5f74 290d 0a0d 0a20 2020 2020 2020 2020  _t)....         
-0002de70: 2020 2065 5072 696d 656e 3178 203d 202d     ePrimen1x = -
-0002de80: 7278 202a 2063 6f73 5f74 6865 7461 202a  rx * cos_theta *
-0002de90: 2073 696e 5f73 7461 7274 5f74 202d 2072   sin_start_t - r
-0002dea0: 7920 2a20 7369 6e5f 7468 6574 6120 2a20  y * sin_theta * 
-0002deb0: 636f 735f 7374 6172 745f 740d 0a20 2020  cos_start_t..   
-0002dec0: 2020 2020 2020 2020 2065 5072 696d 656e           ePrimen
-0002ded0: 3179 203d 202d 7278 202a 2073 696e 5f74  1y = -rx * sin_t
-0002dee0: 6865 7461 202a 2073 696e 5f73 7461 7274  heta * sin_start
-0002def0: 5f74 202b 2072 7920 2a20 636f 735f 7468  _t + ry * cos_th
-0002df00: 6574 6120 2a20 636f 735f 7374 6172 745f  eta * cos_start_
-0002df10: 740d 0a0d 0a20 2020 2020 2020 2020 2020  t....           
-0002df20: 2063 6f73 5f65 6e64 5f74 203d 2063 6f73   cos_end_t = cos
-0002df30: 286e 6578 745f 7429 0d0a 2020 2020 2020  (next_t)..      
-0002df40: 2020 2020 2020 7369 6e5f 656e 645f 7420        sin_end_t 
-0002df50: 3d20 7369 6e28 6e65 7874 5f74 290d 0a0d  = sin(next_t)...
-0002df60: 0a20 2020 2020 2020 2020 2020 2070 3245  .            p2E
-0002df70: 6e32 7820 3d20 7830 202b 2072 7820 2a20  n2x = x0 + rx * 
-0002df80: 636f 735f 656e 645f 7420 2a20 636f 735f  cos_end_t * cos_
-0002df90: 7468 6574 6120 2d20 7279 202a 2073 696e  theta - ry * sin
-0002dfa0: 5f65 6e64 5f74 202a 2073 696e 5f74 6865  _end_t * sin_the
-0002dfb0: 7461 0d0a 2020 2020 2020 2020 2020 2020  ta..            
-0002dfc0: 7032 456e 3279 203d 2079 3020 2b20 7278  p2En2y = y0 + rx
-0002dfd0: 202a 2063 6f73 5f65 6e64 5f74 202a 2073   * cos_end_t * s
-0002dfe0: 696e 5f74 6865 7461 202b 2072 7920 2a20  in_theta + ry * 
-0002dff0: 7369 6e5f 656e 645f 7420 2a20 636f 735f  sin_end_t * cos_
-0002e000: 7468 6574 610d 0a20 2020 2020 2020 2020  theta..         
-0002e010: 2020 2070 5f65 6e64 203d 2028 7032 456e     p_end = (p2En
-0002e020: 3278 2c20 7032 456e 3279 290d 0a20 2020  2x, p2En2y)..   
-0002e030: 2020 2020 2020 2020 2069 6620 6920 3d3d           if i ==
-0002e040: 2061 7263 5f72 6571 7569 7265 6420 2d20   arc_required - 
-0002e050: 313a 0d0a 2020 2020 2020 2020 2020 2020  1:..            
-0002e060: 2020 2020 705f 656e 6420 3d20 7365 6c66      p_end = self
-0002e070: 2e65 6e64 0d0a 0d0a 2020 2020 2020 2020  .end....        
-0002e080: 2020 2020 6550 7269 6d65 6e32 7820 3d20      ePrimen2x = 
-0002e090: 2d72 7820 2a20 636f 735f 7468 6574 6120  -rx * cos_theta 
-0002e0a0: 2a20 7369 6e5f 656e 645f 7420 2d20 7279  * sin_end_t - ry
-0002e0b0: 202a 2073 696e 5f74 6865 7461 202a 2063   * sin_theta * c
-0002e0c0: 6f73 5f65 6e64 5f74 0d0a 2020 2020 2020  os_end_t..      
-0002e0d0: 2020 2020 2020 6550 7269 6d65 6e32 7920        ePrimen2y 
-0002e0e0: 3d20 2d72 7820 2a20 7369 6e5f 7468 6574  = -rx * sin_thet
-0002e0f0: 6120 2a20 7369 6e5f 656e 645f 7420 2b20  a * sin_end_t + 
-0002e100: 7279 202a 2063 6f73 5f74 6865 7461 202a  ry * cos_theta *
-0002e110: 2063 6f73 5f65 6e64 5f74 0d0a 0d0a 2020   cos_end_t....  
-0002e120: 2020 2020 2020 2020 2020 705f 6331 203d            p_c1 =
-0002e130: 2028 705f 7374 6172 745b 305d 202b 2061   (p_start[0] + a
-0002e140: 6c70 6861 202a 2065 5072 696d 656e 3178  lpha * ePrimen1x
-0002e150: 2c20 705f 7374 6172 745b 315d 202b 2061  , p_start[1] + a
-0002e160: 6c70 6861 202a 2065 5072 696d 656e 3179  lpha * ePrimen1y
-0002e170: 290d 0a20 2020 2020 2020 2020 2020 2070  )..            p
-0002e180: 5f63 3220 3d20 2870 5f65 6e64 5b30 5d20  _c2 = (p_end[0] 
-0002e190: 2d20 616c 7068 6120 2a20 6550 7269 6d65  - alpha * ePrime
-0002e1a0: 6e32 782c 2070 5f65 6e64 5b31 5d20 2d20  n2x, p_end[1] - 
-0002e1b0: 616c 7068 6120 2a20 6550 7269 6d65 6e32  alpha * ePrimen2
-0002e1c0: 7929 0d0a 0d0a 2020 2020 2020 2020 2020  y)....          
-0002e1d0: 2020 7969 656c 6420 4375 6269 6342 657a    yield CubicBez
-0002e1e0: 6965 7228 705f 7374 6172 742c 2070 5f63  ier(p_start, p_c
-0002e1f0: 312c 2070 5f63 322c 2070 5f65 6e64 290d  1, p_c2, p_end).
-0002e200: 0a20 2020 2020 2020 2020 2020 2070 5f73  .            p_s
-0002e210: 7461 7274 203d 2050 6f69 6e74 2870 5f65  tart = Point(p_e
-0002e220: 6e64 290d 0a20 2020 2020 2020 2020 2020  nd)..           
-0002e230: 2063 7572 7265 6e74 5f74 203d 206e 6578   current_t = nex
-0002e240: 745f 740d 0a0d 0a20 2020 2064 6566 2069  t_t....    def i
-0002e250: 735f 6369 7263 756c 6172 2873 656c 6629  s_circular(self)
-0002e260: 3a0d 0a20 2020 2020 2020 2061 203d 2073  :..        a = s
-0002e270: 656c 662e 7278 0d0a 2020 2020 2020 2020  elf.rx..        
-0002e280: 6220 3d20 7365 6c66 2e72 790d 0a20 2020  b = self.ry..   
-0002e290: 2020 2020 2072 6574 7572 6e20 6120 3d3d       return a ==
-0002e2a0: 2062 0d0a 0d0a 2020 2020 4070 726f 7065   b....    @prope
-0002e2b0: 7274 790d 0a20 2020 2064 6566 2072 6164  rty..    def rad
-0002e2c0: 6975 7328 7365 6c66 293a 0d0a 2020 2020  ius(self):..    
-0002e2d0: 2020 2020 2222 224c 6567 6163 7920 636f      """Legacy co
-0002e2e0: 6d70 6c65 7820 7261 6469 7573 2070 726f  mplex radius pro
-0002e2f0: 7065 7274 790d 0a0d 0a20 2020 2020 2020  perty....       
-0002e300: 2050 6f69 6e74 2077 696c 6c20 776f 726b   Point will work
-0002e310: 206c 696b 6520 6120 636f 6d70 6c65 7820   like a complex 
-0002e320: 666f 7220 6c65 6761 6379 2072 6561 736f  for legacy reaso
-0002e330: 6e73 2e0d 0a20 2020 2020 2020 2022 2222  ns...        """
-0002e340: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-0002e350: 2050 6f69 6e74 2873 656c 662e 7278 2c20   Point(self.rx, 
-0002e360: 7365 6c66 2e72 7929 0d0a 0d0a 2020 2020  self.ry)....    
-0002e370: 4070 726f 7065 7274 790d 0a20 2020 2064  @property..    d
-0002e380: 6566 2072 7828 7365 6c66 293a 0d0a 2020  ef rx(self):..  
-0002e390: 2020 2020 2020 7265 7475 726e 2050 6f69        return Poi
-0002e3a0: 6e74 2e64 6973 7461 6e63 6528 7365 6c66  nt.distance(self
-0002e3b0: 2e63 656e 7465 722c 2073 656c 662e 7072  .center, self.pr
-0002e3c0: 7829 0d0a 0d0a 2020 2020 4070 726f 7065  x)....    @prope
-0002e3d0: 7274 790d 0a20 2020 2064 6566 2072 7928  rty..    def ry(
-0002e3e0: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
-0002e3f0: 7265 7475 726e 2050 6f69 6e74 2e64 6973  return Point.dis
-0002e400: 7461 6e63 6528 7365 6c66 2e63 656e 7465  tance(self.cente
-0002e410: 722c 2073 656c 662e 7072 7929 0d0a 0d0a  r, self.pry)....
-0002e420: 2020 2020 6465 6620 6765 745f 726f 7461      def get_rota
-0002e430: 7469 6f6e 2873 656c 6629 3a0d 0a20 2020  tion(self):..   
-0002e440: 2020 2020 2072 6574 7572 6e20 506f 696e       return Poin
-0002e450: 742e 616e 676c 6528 7365 6c66 2e63 656e  t.angle(self.cen
-0002e460: 7465 722c 2073 656c 662e 7072 7829 0d0a  ter, self.prx)..
-0002e470: 0d0a 2020 2020 6465 6620 6765 745f 7374  ..    def get_st
-0002e480: 6172 745f 616e 676c 6528 7365 6c66 293a  art_angle(self):
-0002e490: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
-0002e4a0: 2020 2020 2020 203a 7265 7475 726e 3a20         :return: 
-0002e4b0: 416e 676c 6520 6672 6f6d 2074 6865 2063  Angle from the c
-0002e4c0: 656e 7465 7220 706f 696e 7420 746f 2073  enter point to s
-0002e4d0: 7461 7274 2070 6f69 6e74 2e0d 0a20 2020  tart point...   
-0002e4e0: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
-0002e4f0: 2020 7265 7475 726e 2073 656c 662e 616e    return self.an
-0002e500: 676c 655f 6174 5f70 6f69 6e74 2873 656c  gle_at_point(sel
-0002e510: 662e 7374 6172 7429 0d0a 0d0a 2020 2020  f.start)....    
-0002e520: 6465 6620 6765 745f 656e 645f 616e 676c  def get_end_angl
-0002e530: 6528 7365 6c66 293a 0d0a 2020 2020 2020  e(self):..      
-0002e540: 2020 2222 220d 0a20 2020 2020 2020 203a    """..        :
-0002e550: 7265 7475 726e 3a20 416e 676c 6520 6672  return: Angle fr
-0002e560: 6f6d 2074 6865 2063 656e 7465 7220 706f  om the center po
-0002e570: 696e 7420 746f 2065 6e64 2070 6f69 6e74  int to end point
-0002e580: 2e0d 0a20 2020 2020 2020 2022 2222 0d0a  ...        """..
-0002e590: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-0002e5a0: 656c 662e 616e 676c 655f 6174 5f70 6f69  elf.angle_at_poi
-0002e5b0: 6e74 2873 656c 662e 656e 6429 0d0a 0d0a  nt(self.end)....
-0002e5c0: 2020 2020 6465 6620 6765 745f 7374 6172      def get_star
-0002e5d0: 745f 7428 7365 6c66 293a 0d0a 2020 2020  t_t(self):..    
-0002e5e0: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
-0002e5f0: 2073 7461 7274 2074 2076 616c 7565 2069   start t value i
-0002e600: 6e20 7468 6520 656c 6c69 7073 652e 0d0a  n the ellipse...
-0002e610: 0d0a 2020 2020 2020 2020 3a72 6574 7572  ..        :retur
-0002e620: 6e3a 2074 2070 6172 616d 6574 6572 206f  n: t parameter o
-0002e630: 6620 7374 6172 7420 706f 696e 742e 0d0a  f start point...
-0002e640: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
-0002e650: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-0002e660: 2e74 5f61 745f 706f 696e 7428 7365 6c66  .t_at_point(self
-0002e670: 2e70 6f69 6e74 5f61 745f 616e 676c 6528  .point_at_angle(
-0002e680: 7365 6c66 2e67 6574 5f73 7461 7274 5f61  self.get_start_a
-0002e690: 6e67 6c65 2829 2929 0d0a 0d0a 2020 2020  ngle()))....    
-0002e6a0: 6465 6620 6765 745f 656e 645f 7428 7365  def get_end_t(se
-0002e6b0: 6c66 293a 0d0a 2020 2020 2020 2020 2222  lf):..        ""
-0002e6c0: 220d 0a20 2020 2020 2020 2065 6e64 2074  "..        end t
-0002e6d0: 2076 616c 7565 2069 6e20 7468 6520 656c   value in the el
-0002e6e0: 6c69 7073 652e 0d0a 0d0a 2020 2020 2020  lipse.....      
-0002e6f0: 2020 3a72 6574 7572 6e3a 2074 2070 6172    :return: t par
-0002e700: 616d 6574 6572 206f 6620 7374 6172 7420  ameter of start 
-0002e710: 706f 696e 742e 0d0a 2020 2020 2020 2020  point...        
-0002e720: 2222 220d 0a20 2020 2020 2020 2072 6574  """..        ret
-0002e730: 7572 6e20 7365 6c66 2e74 5f61 745f 706f  urn self.t_at_po
-0002e740: 696e 7428 7365 6c66 2e70 6f69 6e74 5f61  int(self.point_a
-0002e750: 745f 616e 676c 6528 7365 6c66 2e67 6574  t_angle(self.get
-0002e760: 5f65 6e64 5f61 6e67 6c65 2829 2929 0d0a  _end_angle()))..
-0002e770: 0d0a 2020 2020 6465 6620 706f 696e 745f  ..    def point_
-0002e780: 6174 5f61 6e67 6c65 2873 656c 662c 2061  at_angle(self, a
-0002e790: 6e67 6c65 293a 0d0a 2020 2020 2020 2020  ngle):..        
-0002e7a0: 2222 220d 0a20 2020 2020 2020 2066 696e  """..        fin
-0002e7b0: 6420 7468 6520 706f 696e 7420 6f6e 2074  d the point on t
-0002e7c0: 6865 2065 6c6c 6970 7365 2066 726f 6d20  he ellipse from 
-0002e7d0: 7468 6520 6365 6e74 6572 2061 7420 7468  the center at th
-0002e7e0: 6520 6769 7665 6e20 616e 676c 652e 0d0a  e given angle...
-0002e7f0: 2020 2020 2020 2020 4e6f 7465 3a20 466f          Note: Fo
-0002e800: 7220 6e6f 6e2d 6369 7263 756c 6172 2061  r non-circular a
-0002e810: 7263 7320 7468 6973 2069 7320 6469 6666  rcs this is diff
-0002e820: 6572 656e 7420 7468 616e 2070 6f69 6e74  erent than point
-0002e830: 2874 292e 0d0a 0d0a 2020 2020 2020 2020  (t).....        
-0002e840: 3a70 6172 616d 2061 6e67 6c65 3a20 616e  :param angle: an
-0002e850: 676c 6520 6672 6f6d 2063 656e 7465 7220  gle from center 
-0002e860: 746f 2066 696e 6420 706f 696e 740d 0a20  to find point.. 
-0002e870: 2020 2020 2020 203a 7265 7475 726e 3a20         :return: 
-0002e880: 706f 696e 7420 666f 756e 640d 0a20 2020  point found..   
-0002e890: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
-0002e8a0: 2020 616e 676c 6520 2d3d 2073 656c 662e    angle -= self.
-0002e8b0: 6765 745f 726f 7461 7469 6f6e 2829 0d0a  get_rotation()..
-0002e8c0: 2020 2020 2020 2020 6120 3d20 7365 6c66          a = self
-0002e8d0: 2e72 780d 0a20 2020 2020 2020 2062 203d  .rx..        b =
-0002e8e0: 2073 656c 662e 7279 0d0a 2020 2020 2020   self.ry..      
-0002e8f0: 2020 6966 2061 203d 3d20 623a 0d0a 2020    if a == b:..  
-0002e900: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0002e910: 2073 656c 662e 706f 696e 745f 6174 5f74   self.point_at_t
-0002e920: 2861 6e67 6c65 290d 0a20 2020 2020 2020  (angle)..       
-0002e930: 2074 203d 2061 7461 6e32 2861 202a 2074   t = atan2(a * t
-0002e940: 616e 2861 6e67 6c65 292c 2062 290d 0a20  an(angle), b).. 
-0002e950: 2020 2020 2020 2074 6175 5f31 5f34 203d         tau_1_4 =
-0002e960: 2074 6175 202f 2034 2e30 0d0a 2020 2020   tau / 4.0..    
-0002e970: 2020 2020 7461 755f 335f 3420 3d20 3320      tau_3_4 = 3 
-0002e980: 2a20 7461 755f 315f 340d 0a20 2020 2020  * tau_1_4..     
-0002e990: 2020 2069 6620 7461 755f 335f 3420 3e3d     if tau_3_4 >=
-0002e9a0: 2061 6273 2861 6e67 6c65 2920 2520 7461   abs(angle) % ta
-0002e9b0: 7520 3e20 7461 755f 315f 343a 0d0a 2020  u > tau_1_4:..  
-0002e9c0: 2020 2020 2020 2020 2020 7420 2b3d 2074            t += t
-0002e9d0: 6175 202f 2032 2e30 0d0a 2020 2020 2020  au / 2.0..      
-0002e9e0: 2020 7265 7475 726e 2073 656c 662e 706f    return self.po
-0002e9f0: 696e 745f 6174 5f74 2874 290d 0a0d 0a20  int_at_t(t).... 
-0002ea00: 2020 2064 6566 2061 6e67 6c65 5f61 745f     def angle_at_
-0002ea10: 706f 696e 7428 7365 6c66 2c20 7029 3a0d  point(self, p):.
-0002ea20: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
-0002ea30: 2020 2020 2020 6669 6e64 2074 6865 2061        find the a
-0002ea40: 6e67 6c65 2074 6f20 7468 6520 706f 696e  ngle to the poin
-0002ea50: 742e 0d0a 0d0a 2020 2020 2020 2020 3a70  t.....        :p
-0002ea60: 6172 616d 2070 3a20 706f 696e 740d 0a20  aram p: point.. 
-0002ea70: 2020 2020 2020 203a 7265 7475 726e 3a20         :return: 
-0002ea80: 616e 676c 6520 746f 2067 6976 656e 2070  angle to given p
-0002ea90: 6f69 6e74 2e0d 0a20 2020 2020 2020 2022  oint...        "
-0002eaa0: 2222 0d0a 2020 2020 2020 2020 7265 7475  ""..        retu
-0002eab0: 726e 2073 656c 662e 6365 6e74 6572 2e61  rn self.center.a
-0002eac0: 6e67 6c65 5f74 6f28 7029 0d0a 0d0a 2020  ngle_to(p)....  
-0002ead0: 2020 6465 6620 745f 6174 5f70 6f69 6e74    def t_at_point
-0002eae0: 2873 656c 662c 2070 293a 0d0a 2020 2020  (self, p):..    
-0002eaf0: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
-0002eb00: 2066 696e 6420 7468 6520 7420 7061 7261   find the t para
-0002eb10: 6d65 7465 7220 746f 2061 7420 7468 6520  meter to at the 
-0002eb20: 706f 696e 742e 0d0a 0d0a 2020 2020 2020  point.....      
-0002eb30: 2020 3a70 6172 616d 2070 3a20 706f 696e    :param p: poin
-0002eb40: 740d 0a20 2020 2020 2020 203a 7265 7475  t..        :retu
-0002eb50: 726e 3a20 7420 7061 7261 6d65 7465 7220  rn: t parameter 
-0002eb60: 746f 2074 6865 2067 6976 656e 2070 6f69  to the given poi
-0002eb70: 6e74 2e0d 0a20 2020 2020 2020 2022 2222  nt...        """
-0002eb80: 0d0a 2020 2020 2020 2020 616e 676c 6520  ..        angle 
-0002eb90: 3d20 7365 6c66 2e61 6e67 6c65 5f61 745f  = self.angle_at_
-0002eba0: 706f 696e 7428 7029 0d0a 2020 2020 2020  point(p)..      
-0002ebb0: 2020 616e 676c 6520 2d3d 2073 656c 662e    angle -= self.
-0002ebc0: 6765 745f 726f 7461 7469 6f6e 2829 0d0a  get_rotation()..
-0002ebd0: 2020 2020 2020 2020 6120 3d20 7365 6c66          a = self
-0002ebe0: 2e72 780d 0a20 2020 2020 2020 2062 203d  .rx..        b =
-0002ebf0: 2073 656c 662e 7279 0d0a 2020 2020 2020   self.ry..      
-0002ec00: 2020 7420 3d20 6174 616e 3228 6120 2a20    t = atan2(a * 
-0002ec10: 7461 6e28 616e 676c 6529 2c20 6229 0d0a  tan(angle), b)..
-0002ec20: 2020 2020 2020 2020 7461 755f 315f 3420          tau_1_4 
-0002ec30: 3d20 7461 7520 2f20 342e 300d 0a20 2020  = tau / 4.0..   
-0002ec40: 2020 2020 2074 6175 5f33 5f34 203d 2033       tau_3_4 = 3
-0002ec50: 202a 2074 6175 5f31 5f34 0d0a 2020 2020   * tau_1_4..    
-0002ec60: 2020 2020 6966 2074 6175 5f33 5f34 203e      if tau_3_4 >
-0002ec70: 3d20 6162 7328 616e 676c 6529 2025 2074  = abs(angle) % t
-0002ec80: 6175 203e 2074 6175 5f31 5f34 3a0d 0a20  au > tau_1_4:.. 
-0002ec90: 2020 2020 2020 2020 2020 2074 202b 3d20             t += 
-0002eca0: 7461 7520 2f20 322e 300d 0a20 2020 2020  tau / 2.0..     
-0002ecb0: 2020 2072 6574 7572 6e20 740d 0a0d 0a20     return t.... 
-0002ecc0: 2020 2064 6566 2070 6f69 6e74 5f61 745f     def point_at_
-0002ecd0: 7428 7365 6c66 2c20 7429 3a0d 0a20 2020  t(self, t):..   
-0002ece0: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
-0002ecf0: 2020 6669 6e64 2074 6865 2070 6f69 6e74    find the point
-0002ed00: 2074 6861 7420 636f 7272 6573 706f 6e64   that correspond
-0002ed10: 7320 746f 2067 6976 656e 2076 616c 7565  s to given value
-0002ed20: 2074 2e0d 0a20 2020 2020 2020 2057 6865   t...        Whe
-0002ed30: 7265 2074 3d30 2069 7320 7468 6520 6669  re t=0 is the fi
-0002ed40: 7273 7420 706f 696e 7420 616e 6420 743d  rst point and t=
-0002ed50: 7461 7520 6973 2074 6865 2066 696e 616c  tau is the final
-0002ed60: 2070 6f69 6e74 2e0d 0a0d 0a20 2020 2020   point.....     
-0002ed70: 2020 2049 6e20 7468 6520 6361 7365 206f     In the case o
-0002ed80: 6620 6120 6369 7263 6c65 3a20 7420 3d20  f a circle: t = 
-0002ed90: 616e 676c 652e 0d0a 0d0a 2020 2020 2020  angle.....      
-0002eda0: 2020 3a70 6172 616d 2074 3a0d 0a20 2020    :param t:..   
-0002edb0: 2020 2020 203a 7265 7475 726e 3a0d 0a20       :return:.. 
-0002edc0: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
-0002edd0: 2020 2020 726f 7461 7469 6f6e 203d 2073      rotation = s
-0002ede0: 656c 662e 6765 745f 726f 7461 7469 6f6e  elf.get_rotation
-0002edf0: 2829 0d0a 2020 2020 2020 2020 6120 3d20  ()..        a = 
-0002ee00: 7365 6c66 2e72 780d 0a20 2020 2020 2020  self.rx..       
-0002ee10: 2062 203d 2073 656c 662e 7279 0d0a 2020   b = self.ry..  
-0002ee20: 2020 2020 2020 6378 203d 2073 656c 662e        cx = self.
-0002ee30: 6365 6e74 6572 2e78 0d0a 2020 2020 2020  center.x..      
-0002ee40: 2020 6379 203d 2073 656c 662e 6365 6e74    cy = self.cent
-0002ee50: 6572 2e79 0d0a 2020 2020 2020 2020 636f  er.y..        co
-0002ee60: 735f 726f 7420 3d20 636f 7328 726f 7461  s_rot = cos(rota
-0002ee70: 7469 6f6e 290d 0a20 2020 2020 2020 2073  tion)..        s
-0002ee80: 696e 5f72 6f74 203d 2073 696e 2872 6f74  in_rot = sin(rot
-0002ee90: 6174 696f 6e29 0d0a 2020 2020 2020 2020  ation)..        
-0002eea0: 636f 735f 7420 3d20 636f 7328 7429 0d0a  cos_t = cos(t)..
-0002eeb0: 2020 2020 2020 2020 7369 6e5f 7420 3d20          sin_t = 
-0002eec0: 7369 6e28 7429 0d0a 2020 2020 2020 2020  sin(t)..        
-0002eed0: 7078 203d 2063 7820 2b20 6120 2a20 636f  px = cx + a * co
-0002eee0: 735f 7420 2a20 636f 735f 726f 7420 2d20  s_t * cos_rot - 
-0002eef0: 6220 2a20 7369 6e5f 7420 2a20 7369 6e5f  b * sin_t * sin_
-0002ef00: 726f 740d 0a20 2020 2020 2020 2070 7920  rot..        py 
-0002ef10: 3d20 6379 202b 2061 202a 2063 6f73 5f74  = cy + a * cos_t
-0002ef20: 202a 2073 696e 5f72 6f74 202b 2062 202a   * sin_rot + b *
-0002ef30: 2073 696e 5f74 202a 2063 6f73 5f72 6f74   sin_t * cos_rot
-0002ef40: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-0002ef50: 2050 6f69 6e74 2870 782c 2070 7929 0d0a   Point(px, py)..
-0002ef60: 0d0a 2020 2020 6465 6620 6765 745f 656c  ..    def get_el
-0002ef70: 6c69 7073 6528 7365 6c66 293a 0d0a 2020  lipse(self):..  
-0002ef80: 2020 2020 2020 7265 7475 726e 2045 6c6c        return Ell
-0002ef90: 6970 7365 2873 656c 662e 6365 6e74 6572  ipse(self.center
-0002efa0: 2c20 7365 6c66 2e72 782c 2073 656c 662e  , self.rx, self.
-0002efb0: 7279 2c20 7365 6c66 2e67 6574 5f72 6f74  ry, self.get_rot
-0002efc0: 6174 696f 6e28 2929 0d0a 0d0a 2020 2020  ation())....    
-0002efd0: 6465 6620 6262 6f78 2873 656c 6629 3a0d  def bbox(self):.
-0002efe0: 0a20 2020 2020 2020 2022 2222 4669 6e64  .        """Find
-0002eff0: 2074 6865 2062 6f75 6e64 696e 6720 626f   the bounding bo
-0002f000: 7820 6f66 2061 2061 7263 2e0d 0a20 2020  x of a arc...   
-0002f010: 2020 2020 2043 6f64 6520 6672 6f6d 3a20       Code from: 
-0002f020: 6874 7470 733a 2f2f 6769 7468 7562 2e63  https://github.c
-0002f030: 6f6d 2f6d 6174 6861 6e64 792f 7376 6770  om/mathandy/svgp
-0002f040: 6174 6874 6f6f 6c73 0d0a 2020 2020 2020  athtools..      
-0002f050: 2020 2222 220d 0a20 2020 2020 2020 2069    """..        i
-0002f060: 6620 7365 6c66 2e73 7765 6570 203d 3d20  f self.sweep == 
-0002f070: 303a 0d0a 2020 2020 2020 2020 2020 2020  0:..            
-0002f080: 7265 7475 726e 2073 656c 662e 7374 6172  return self.star
-0002f090: 742e 782c 2073 656c 662e 7374 6172 742e  t.x, self.start.
-0002f0a0: 792c 2073 656c 662e 656e 642e 782c 2073  y, self.end.x, s
-0002f0b0: 656c 662e 656e 642e 790d 0a20 2020 2020  elf.end.y..     
-0002f0c0: 2020 2070 6869 203d 2073 656c 662e 6765     phi = self.ge
-0002f0d0: 745f 726f 7461 7469 6f6e 2829 2e61 735f  t_rotation().as_
-0002f0e0: 7261 6469 616e 730d 0a20 2020 2020 2020  radians..       
-0002f0f0: 2069 6620 636f 7328 7068 6929 203d 3d20   if cos(phi) == 
-0002f100: 303a 0d0a 2020 2020 2020 2020 2020 2020  0:..            
-0002f110: 6174 616e 5f78 203d 2074 6175 202f 2034  atan_x = tau / 4
-0002f120: 2e30 0d0a 2020 2020 2020 2020 2020 2020  .0..            
-0002f130: 6174 616e 5f79 203d 2030 0d0a 2020 2020  atan_y = 0..    
-0002f140: 2020 2020 656c 6966 2073 696e 2870 6869      elif sin(phi
-0002f150: 2920 3d3d 2030 3a0d 0a20 2020 2020 2020  ) == 0:..       
-0002f160: 2020 2020 2061 7461 6e5f 7820 3d20 300d       atan_x = 0.
-0002f170: 0a20 2020 2020 2020 2020 2020 2061 7461  .            ata
-0002f180: 6e5f 7920 3d20 7461 7520 2f20 342e 300d  n_y = tau / 4.0.
-0002f190: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
-0002f1a0: 2020 2020 2020 2020 2020 2020 7278 2c20              rx, 
-0002f1b0: 7279 203d 2073 656c 662e 7278 2c20 7365  ry = self.rx, se
-0002f1c0: 6c66 2e72 790d 0a20 2020 2020 2020 2020  lf.ry..         
-0002f1d0: 2020 2061 7461 6e5f 7820 3d20 6174 616e     atan_x = atan
-0002f1e0: 282d 2872 7920 2f20 7278 2920 2a20 7461  (-(ry / rx) * ta
-0002f1f0: 6e28 7068 6929 290d 0a20 2020 2020 2020  n(phi))..       
-0002f200: 2020 2020 2061 7461 6e5f 7920 3d20 6174       atan_y = at
-0002f210: 616e 2828 7279 202f 2072 7829 202f 2074  an((ry / rx) / t
-0002f220: 616e 2870 6869 2929 0d0a 0d0a 2020 2020  an(phi))....    
-0002f230: 2020 2020 6465 6620 616e 676c 655f 696e      def angle_in
-0002f240: 7628 616e 672c 206b 293a 2020 2320 696e  v(ang, k):  # in
-0002f250: 7665 7273 6520 6f66 2061 6e67 6c65 2066  verse of angle f
-0002f260: 726f 6d20 4172 632e 6465 7269 7661 7469  rom Arc.derivati
-0002f270: 7665 2829 0d0a 2020 2020 2020 2020 2020  ve()..          
-0002f280: 2020 7265 7475 726e 2028 2861 6e67 202b    return ((ang +
-0002f290: 2028 7461 7520 2f20 322e 3029 202a 206b   (tau / 2.0) * k
-0002f2a0: 2920 2a20 2833 3630 202f 2074 6175 2920  ) * (360 / tau) 
-0002f2b0: 2d20 7365 6c66 2e74 6865 7461 2920 2f20  - self.theta) / 
-0002f2c0: 7365 6c66 2e64 656c 7461 0d0a 0d0a 2020  self.delta....  
-0002f2d0: 2020 2020 2020 7874 7265 6d61 203d 205b        xtrema = [
-0002f2e0: 7365 6c66 2e73 7461 7274 2e78 2c20 7365  self.start.x, se
-0002f2f0: 6c66 2e65 6e64 2e78 5d0d 0a20 2020 2020  lf.end.x]..     
-0002f300: 2020 2079 7472 656d 6120 3d20 5b73 656c     ytrema = [sel
-0002f310: 662e 7374 6172 742e 792c 2073 656c 662e  f.start.y, self.
-0002f320: 656e 642e 795d 0d0a 0d0a 2020 2020 2020  end.y]....      
-0002f330: 2020 666f 7220 6b20 696e 2072 616e 6765    for k in range
-0002f340: 282d 342c 2035 293a 0d0a 2020 2020 2020  (-4, 5):..      
-0002f350: 2020 2020 2020 7478 203d 2061 6e67 6c65        tx = angle
-0002f360: 5f69 6e76 2861 7461 6e5f 782c 206b 290d  _inv(atan_x, k).
-0002f370: 0a20 2020 2020 2020 2020 2020 2074 7920  .            ty 
-0002f380: 3d20 616e 676c 655f 696e 7628 6174 616e  = angle_inv(atan
-0002f390: 5f79 2c20 6b29 0d0a 2020 2020 2020 2020  _y, k)..        
-0002f3a0: 2020 2020 6966 2030 203c 3d20 7478 203c      if 0 <= tx <
-0002f3b0: 3d20 313a 0d0a 2020 2020 2020 2020 2020  = 1:..          
-0002f3c0: 2020 2020 2020 7874 7265 6d61 2e61 7070        xtrema.app
-0002f3d0: 656e 6428 7365 6c66 2e70 6f69 6e74 2874  end(self.point(t
-0002f3e0: 7829 2e78 290d 0a20 2020 2020 2020 2020  x).x)..         
-0002f3f0: 2020 2069 6620 3020 3c3d 2074 7920 3c3d     if 0 <= ty <=
-0002f400: 2031 3a0d 0a20 2020 2020 2020 2020 2020   1:..           
-0002f410: 2020 2020 2079 7472 656d 612e 6170 7065       ytrema.appe
-0002f420: 6e64 2873 656c 662e 706f 696e 7428 7479  nd(self.point(ty
-0002f430: 292e 7929 0d0a 0d0a 2020 2020 2020 2020  ).y)....        
-0002f440: 7265 7475 726e 206d 696e 2878 7472 656d  return min(xtrem
-0002f450: 6129 2c20 6d69 6e28 7974 7265 6d61 292c  a), min(ytrema),
-0002f460: 206d 6178 2878 7472 656d 6129 2c20 6d61   max(xtrema), ma
-0002f470: 7828 7974 7265 6d61 290d 0a0d 0a20 2020  x(ytrema)....   
-0002f480: 2064 6566 2064 2873 656c 662c 2063 7572   def d(self, cur
-0002f490: 7265 6e74 5f70 6f69 6e74 3d4e 6f6e 652c  rent_point=None,
-0002f4a0: 2072 656c 6174 6976 653d 4e6f 6e65 2c20   relative=None, 
-0002f4b0: 736d 6f6f 7468 3d4e 6f6e 6529 3a0d 0a20  smooth=None):.. 
-0002f4c0: 2020 2020 2020 2069 6620 280d 0a20 2020         if (..   
-0002f4d0: 2020 2020 2020 2020 2063 7572 7265 6e74           current
-0002f4e0: 5f70 6f69 6e74 2069 7320 4e6f 6e65 0d0a  _point is None..
-0002f4f0: 2020 2020 2020 2020 2020 2020 6f72 2028              or (
-0002f500: 7265 6c61 7469 7665 2069 7320 4e6f 6e65  relative is None
-0002f510: 2061 6e64 2073 656c 662e 7265 6c61 7469   and self.relati
-0002f520: 7665 290d 0a20 2020 2020 2020 2020 2020  ve)..           
-0002f530: 206f 7220 2872 656c 6174 6976 6520 6973   or (relative is
-0002f540: 206e 6f74 204e 6f6e 6520 616e 6420 6e6f   not None and no
-0002f550: 7420 7265 6c61 7469 7665 290d 0a20 2020  t relative)..   
-0002f560: 2020 2020 2029 3a0d 0a20 2020 2020 2020       ):..       
-0002f570: 2020 2020 2072 6574 7572 6e20 2241 2025       return "A %
-0002f580: 472c 2547 2025 4720 2564 2c25 6420 2573  G,%G %G %d,%d %s
-0002f590: 2220 2520 280d 0a20 2020 2020 2020 2020  " % (..         
-0002f5a0: 2020 2020 2020 2073 656c 662e 7278 2c0d         self.rx,.
-0002f5b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002f5c0: 2073 656c 662e 7279 2c0d 0a20 2020 2020   self.ry,..     
-0002f5d0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0002f5e0: 6765 745f 726f 7461 7469 6f6e 2829 2e61  get_rotation().a
-0002f5f0: 735f 6465 6772 6565 732c 0d0a 2020 2020  s_degrees,..    
-0002f600: 2020 2020 2020 2020 2020 2020 696e 7428              int(
-0002f610: 6162 7328 7365 6c66 2e73 7765 6570 2920  abs(self.sweep) 
-0002f620: 3e20 2874 6175 202f 2032 2e30 2929 2c0d  > (tau / 2.0)),.
-0002f630: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002f640: 2069 6e74 2873 656c 662e 7377 6565 7020   int(self.sweep 
-0002f650: 3e3d 2030 292c 0d0a 2020 2020 2020 2020  >= 0),..        
-0002f660: 2020 2020 2020 2020 7365 6c66 2e65 6e64          self.end
-0002f670: 2c0d 0a20 2020 2020 2020 2020 2020 2029  ,..            )
-0002f680: 0d0a 2020 2020 2020 2020 656c 7365 3a0d  ..        else:.
-0002f690: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0002f6a0: 7572 6e20 2261 2025 472c 2547 2025 4720  urn "a %G,%G %G 
-0002f6b0: 2564 2c25 6420 2573 2220 2520 280d 0a20  %d,%d %s" % (.. 
-0002f6c0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0002f6d0: 656c 662e 7278 2c0d 0a20 2020 2020 2020  elf.rx,..       
-0002f6e0: 2020 2020 2020 2020 2073 656c 662e 7279           self.ry
-0002f6f0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0002f700: 2020 2073 656c 662e 6765 745f 726f 7461     self.get_rota
-0002f710: 7469 6f6e 2829 2e61 735f 6465 6772 6565  tion().as_degree
-0002f720: 732c 0d0a 2020 2020 2020 2020 2020 2020  s,..            
-0002f730: 2020 2020 696e 7428 6162 7328 7365 6c66      int(abs(self
-0002f740: 2e73 7765 6570 2920 3e20 2874 6175 202f  .sweep) > (tau /
-0002f750: 2032 2e30 2929 2c0d 0a20 2020 2020 2020   2.0)),..       
-0002f760: 2020 2020 2020 2020 2069 6e74 2873 656c           int(sel
-0002f770: 662e 7377 6565 7020 3e3d 2030 292c 0d0a  f.sweep >= 0),..
-0002f780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f790: 7365 6c66 2e65 6e64 202d 2063 7572 7265  self.end - curre
-0002f7a0: 6e74 5f70 6f69 6e74 2c0d 0a20 2020 2020  nt_point,..     
-0002f7b0: 2020 2020 2020 2029 0d0a 0d0a 0d0a 636c         )......cl
-0002f7c0: 6173 7320 5061 7468 2853 6861 7065 2c20  ass Path(Shape, 
-0002f7d0: 4d75 7461 626c 6553 6571 7565 6e63 6529  MutableSequence)
-0002f7e0: 3a0d 0a20 2020 2022 2222 0d0a 2020 2020  :..    """..    
-0002f7f0: 4120 5061 7468 2069 7320 6120 4d75 7461  A Path is a Muta
-0002f800: 626c 6520 7365 7175 656e 6365 206f 6620  ble sequence of 
-0002f810: 7061 7468 2073 6567 6d65 6e74 730d 0a0d  path segments...
-0002f820: 0a20 2020 2049 7420 6973 2061 2067 656e  .    It is a gen
-0002f830: 6572 616c 697a 6564 2073 6861 7065 2077  eralized shape w
-0002f840: 6869 6368 2063 616e 206d 6170 206f 7574  hich can map out
-0002f850: 2061 6c6c 2074 6865 206f 7468 6572 2073   all the other s
-0002f860: 6861 7065 732e 0d0a 0d0a 2020 2020 4561  hapes.....    Ea
-0002f870: 6368 2050 6174 6853 6567 6d65 6e74 206f  ch PathSegment o
-0002f880: 626a 6563 7420 6d61 7073 2061 2070 6172  bject maps a par
-0002f890: 7469 6375 6c61 7220 636f 6d6d 616e 642e  ticular command.
-0002f8a0: 2045 6163 6820 6f6e 6520 6578 6973 7473   Each one exists
-0002f8b0: 206f 6e6c 7920 6f6e 6365 2069 6e20 6561   only once in ea
-0002f8c0: 6368 2070 6174 6820 616e 6420 6576 6572  ch path and ever
-0002f8d0: 7920 706f 696e 7420 636f 6e74 6169 6e65  y point containe
-0002f8e0: 640d 0a20 2020 2077 6974 6869 6e20 7468  d..    within th
-0002f8f0: 6520 6f62 6a65 6374 2069 7320 616c 736f  e object is also
-0002f900: 2075 6e69 7175 652e 2057 6520 6174 7465   unique. We atte
-0002f910: 6d70 7420 746f 2069 6e74 6572 6e61 6c6c  mpt to internall
-0002f920: 7920 6d61 696e 7461 696e 2073 6f6d 6520  y maintain some 
-0002f930: 7661 6c69 6469 7479 2e20 4561 6368 2065  validity. Each e
-0002f940: 6e64 2070 6f69 6e74 2073 686f 756c 6420  nd point should 
-0002f950: 6c69 6e6b 0d0a 2020 2020 746f 2074 6865  link..    to the
-0002f960: 2066 6f6c 6c6f 7769 6e67 2073 6567 6d65   following segme
-0002f970: 6e74 7320 7374 6172 7420 706f 696e 742e  nts start point.
-0002f980: 2041 6e64 2065 6163 6820 636c 6f73 6520   And each close 
-0002f990: 706f 696e 7420 7368 6f75 6c64 2063 6f6e  point should con
-0002f9a0: 6e65 6374 2066 726f 6d20 7468 6520 7072  nect from the pr
-0002f9b0: 6563 6564 696e 6720 7365 676d 656e 7473  eceding segments
-0002f9c0: 2065 6e64 706f 696e 7420 746f 0d0a 2020   endpoint to..  
-0002f9d0: 2020 7468 6520 6c61 7374 204d 6f76 6520    the last Move 
-0002f9e0: 636f 6d6d 616e 642e 0d0a 0d0a 2020 2020  command.....    
-0002f9f0: 5468 6573 6520 6172 6520 736f 6674 2063  These are soft c
-0002fa00: 6865 636b 7320 6d61 6465 206f 6e6c 7920  hecks made only 
-0002fa10: 6174 2074 6865 2074 696d 6520 6f66 2061  at the time of a
-0002fa20: 6464 6974 696f 6e20 616e 6420 736f 6d65  ddition and some
-0002fa30: 206d 616e 6970 756c 6174 696f 6e73 2e20   manipulations. 
-0002fa40: 4d6f 6469 6679 696e 6720 7468 6520 706f  Modifying the po
-0002fa50: 696e 7473 206f 6620 7468 6520 7365 676d  ints of the segm
-0002fa60: 656e 7473 0d0a 2020 2020 6361 6e20 616e  ents..    can an
-0002fa70: 6420 7769 6c6c 2063 6175 7365 2070 6174  d will cause pat
-0002fa80: 6820 696e 7661 6c69 6469 7479 2e20 536f  h invalidity. So
-0002fa90: 6d65 2053 5647 2069 6e76 616c 6964 206f  me SVG invalid o
-0002faa0: 7065 7261 7469 6f6e 7320 6172 6520 7065  perations are pe
-0002fab0: 726d 6974 7465 6420 7375 6368 2061 7320  rmitted such as 
-0002fac0: 6172 6373 206c 6f6e 6765 7220 7468 616e  arcs longer than
-0002fad0: 2074 6175 2072 6164 6961 6e73 0d0a 2020   tau radians..  
-0002fae0: 2020 6f72 2062 6567 696e 6e69 6e67 2073    or beginning s
-0002faf0: 6571 7565 6e63 6573 2077 6974 686f 7574  equences without
-0002fb00: 2061 206d 6f76 652e 2054 6865 2065 7870   a move. The exp
-0002fb10: 6563 7461 7469 6f6e 2069 7320 7468 6174  ectation is that
-0002fb20: 2074 6865 7365 2077 696c 6c20 6576 656e   these will even
-0002fb30: 7475 616c 6c79 2062 6520 7573 6564 2061  tually be used a
-0002fb40: 7320 7061 7274 206f 6620 6120 7661 6c69  s part of a vali
-0002fb50: 6420 7061 7468 0d0a 2020 2020 736f 2074  d path..    so t
-0002fb60: 6865 7365 2066 7261 676d 656e 7420 7061  hese fragment pa
-0002fb70: 7468 7320 6172 6520 7065 726d 6974 7465  ths are permitte
-0002fb80: 642e 2049 6e20 736f 6d65 2063 6173 6573  d. In some cases
-0002fb90: 2074 6865 7365 2069 6e76 616c 6964 2070   these invalid p
-0002fba0: 6174 6873 2077 696c 6c20 7374 696c 6c20  aths will still 
-0002fbb0: 6861 7665 2063 6f6e 7369 7374 656e 7420  have consistent 
-0002fbc0: 7061 7468 5f64 2076 616c 7565 732c 0d0a  path_d values,..
-0002fbd0: 2020 2020 696e 206f 7468 6572 2063 6173      in other cas
-0002fbe0: 6573 2c20 7468 6572 6520 7769 6c6c 2062  es, there will b
-0002fbf0: 6520 6e6f 2076 616c 6964 206d 6574 686f  e no valid metho
-0002fc00: 6473 2074 6f20 7265 7072 6f64 7563 6520  ds to reproduce 
-0002fc10: 7468 6573 652e 0d0a 0d0a 2020 2020 496e  these.....    In
-0002fc20: 7374 616e 7469 6174 696f 6e20 666f 726d  stantiation form
-0002fc30: 6174 733a 0d0a 0d0a 2020 2020 5061 7468  ats:....    Path
-0002fc40: 2822 642d 7374 7269 6e67 222c 206b 6579  ("d-string", key
-0002fc50: 776f 7264 7329 0d0a 2020 2020 5061 7468  words)..    Path
-0002fc60: 2870 6174 6873 6567 6d65 6e74 312c 2e2e  (pathsegment1,..
-0002fc70: 2e29 0d0a 2020 2020 5061 7468 2864 3d22  .)..    Path(d="
-0002fc80: 642d 7374 7269 6e67 222c 206f 7468 6572  d-string", other
-0002fc90: 206b 6579 776f 7264 7329 0d0a 2020 2020   keywords)..    
-0002fca0: 2222 220d 0a0d 0a20 2020 2064 6566 205f  """....    def _
-0002fcb0: 5f69 6e69 745f 5f28 7365 6c66 2c20 2a61  _init__(self, *a
-0002fcc0: 7267 732c 202a 2a6b 7761 7267 7329 3a0d  rgs, **kwargs):.
-0002fcd0: 0a20 2020 2020 2020 2053 6861 7065 2e5f  .        Shape._
-0002fce0: 5f69 6e69 745f 5f28 7365 6c66 2c20 2a61  _init__(self, *a
-0002fcf0: 7267 732c 202a 2a6b 7761 7267 7329 0d0a  rgs, **kwargs)..
-0002fd00: 2020 2020 2020 2020 7365 6c66 2e5f 6c65          self._le
-0002fd10: 6e67 7468 203d 204e 6f6e 650d 0a20 2020  ngth = None..   
-0002fd20: 2020 2020 2073 656c 662e 5f6c 656e 6774       self._lengt
-0002fd30: 6873 203d 204e 6f6e 650d 0a20 2020 2020  hs = None..     
-0002fd40: 2020 2073 656c 662e 5f73 6567 6d65 6e74     self._segment
-0002fd50: 7320 3d20 6c69 7374 2829 0d0a 2020 2020  s = list()..    
-0002fd60: 2020 2020 6966 206c 656e 2861 7267 7329      if len(args)
-0002fd70: 2021 3d20 313a 0d0a 2020 2020 2020 2020   != 1:..        
-0002fd80: 2020 2020 666f 7220 7365 676d 656e 7420      for segment 
-0002fd90: 696e 2061 7267 733a 0d0a 2020 2020 2020  in args:..      
-0002fda0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-0002fdb0: 2069 7369 6e73 7461 6e63 6528 7365 676d   isinstance(segm
-0002fdc0: 656e 742c 2050 6174 6853 6567 6d65 6e74  ent, PathSegment
-0002fdd0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-0002fde0: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-0002fdf0: 6c75 6545 7272 6f72 280d 0a20 2020 2020  lueError(..     
-0002fe00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002fe10: 2020 2022 4f62 6a65 6374 206e 6f74 2050     "Object not P
-0002fe20: 6174 6853 6567 6d65 6e74 2077 6865 6e20  athSegment when 
-0002fe30: 696e 7374 616e 7469 6174 696e 6720 6120  instantiating a 
-0002fe40: 5061 7468 3a20 2573 220d 0a20 2020 2020  Path: %s"..     
-0002fe50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002fe60: 2020 2025 2073 6567 6d65 6e74 2e5f 5f63     % segment.__c
-0002fe70: 6c61 7373 5f5f 2e5f 5f6e 616d 655f 5f0d  lass__.__name__.
-0002fe80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002fe90: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
-0002fea0: 2020 2020 7365 6c66 2e5f 7365 676d 656e      self._segmen
-0002feb0: 7473 2e65 7874 656e 6428 6172 6773 290d  ts.extend(args).
-0002fec0: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
-0002fed0: 2020 2020 2020 2020 2020 2020 7320 3d20              s = 
-0002fee0: 6172 6773 5b30 5d0d 0a20 2020 2020 2020  args[0]..       
-0002fef0: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
-0002ff00: 6365 2873 2c20 5375 6270 6174 6829 3a0d  ce(s, Subpath):.
-0002ff10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002ff20: 2073 656c 662e 5f73 6567 6d65 6e74 732e   self._segments.
-0002ff30: 6578 7465 6e64 2873 2e73 6567 6d65 6e74  extend(s.segment
-0002ff40: 7328 7472 616e 7366 6f72 6d65 643d 4661  s(transformed=Fa
-0002ff50: 6c73 6529 290d 0a20 2020 2020 2020 2020  lse))..         
-0002ff60: 2020 2020 2020 2053 6861 7065 2e5f 5f69         Shape.__i
-0002ff70: 6e69 745f 5f28 7365 6c66 2c20 732e 5f70  nit__(self, s._p
-0002ff80: 6174 6829 0d0a 2020 2020 2020 2020 2020  ath)..          
-0002ff90: 2020 656c 6966 2069 7369 6e73 7461 6e63    elif isinstanc
-0002ffa0: 6528 732c 2053 6861 7065 293a 0d0a 2020  e(s, Shape):..  
-0002ffb0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0002ffc0: 6c66 2e5f 7365 676d 656e 7473 2e65 7874  lf._segments.ext
-0002ffd0: 656e 6428 732e 7365 676d 656e 7473 2874  end(s.segments(t
-0002ffe0: 7261 6e73 666f 726d 6564 3d46 616c 7365  ransformed=False
-0002fff0: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
-00030000: 656c 6966 2069 7369 6e73 7461 6e63 6528  elif isinstance(
-00030010: 732c 2073 7472 293a 0d0a 2020 2020 2020  s, str):..      
-00030020: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-00030030: 7365 676d 656e 7473 203d 206c 6973 7428  segments = list(
-00030040: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00030050: 2020 2073 656c 662e 7061 7273 6528 7329     self.parse(s)
-00030060: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
-00030070: 6966 2069 7369 6e73 7461 6e63 6528 732c  if isinstance(s,
-00030080: 2074 7570 6c65 293a 0d0a 2020 2020 2020   tuple):..      
-00030090: 2020 2020 2020 2020 2020 2320 5765 2068            # We h
-000300a0: 6176 6520 6e6f 2067 7561 7261 6e74 6565  ave no guarantee
-000300b0: 206f 6620 7468 6520 7661 6c69 6469 7479   of the validity
-000300c0: 206f 6620 7468 6520 736f 7572 6365 2064   of the source d
-000300d0: 6174 610d 0a20 2020 2020 2020 2020 2020  ata..           
-000300e0: 2020 2020 2073 656c 662e 5f73 6567 6d65       self._segme
-000300f0: 6e74 732e 6578 7465 6e64 2873 290d 0a20  nts.extend(s).. 
-00030100: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00030110: 656c 662e 7661 6c69 6461 7465 5f63 6f6e  elf.validate_con
-00030120: 6e65 6374 696f 6e73 2829 0d0a 2020 2020  nections()..    
-00030130: 2020 2020 2020 2020 656c 6966 2069 7369          elif isi
-00030140: 6e73 7461 6e63 6528 732c 206c 6973 7429  nstance(s, list)
-00030150: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00030160: 2020 2023 2057 6520 6861 7665 206e 6f20     # We have no 
-00030170: 6775 6172 616e 7465 6520 6f66 2074 6865  guarantee of the
-00030180: 2076 616c 6964 6974 7920 6f66 2074 6865   validity of the
-00030190: 2073 6f75 7263 6520 6461 7461 0d0a 2020   source data..  
-000301a0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-000301b0: 6c66 2e5f 7365 676d 656e 7473 2e65 7874  lf._segments.ext
-000301c0: 656e 6428 7329 0d0a 2020 2020 2020 2020  end(s)..        
-000301d0: 2020 2020 2020 2020 7365 6c66 2e76 616c          self.val
-000301e0: 6964 6174 655f 636f 6e6e 6563 7469 6f6e  idate_connection
-000301f0: 7328 290d 0a20 2020 2020 2020 2020 2020  s()..           
-00030200: 2065 6c69 6620 6973 696e 7374 616e 6365   elif isinstance
-00030210: 2873 2c20 5061 7468 5365 676d 656e 7429  (s, PathSegment)
-00030220: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00030230: 2020 2073 656c 662e 5f73 6567 6d65 6e74     self._segment
-00030240: 732e 6170 7065 6e64 2873 290d 0a20 2020  s.append(s)..   
-00030250: 2020 2020 2069 6620 5356 475f 4154 5452       if SVG_ATTR
-00030260: 5f44 4154 4120 696e 2073 656c 662e 7661  _DATA in self.va
-00030270: 6c75 6573 3a0d 0a20 2020 2020 2020 2020  lues:..         
-00030280: 2020 2023 204e 6f74 2073 7572 6520 7768     # Not sure wh
-00030290: 6174 2074 6865 2070 7572 706f 7365 206f  at the purpose o
-000302a0: 6620 7061 7468 645f 6c6f 6164 6564 2069  f pathd_loaded i
-000302b0: 732e 0d0a 2020 2020 2020 2020 2020 2020  s...            
-000302c0: 2320 4974 2069 7320 6f6e 6c79 2073 6574  # It is only set
-000302d0: 2061 6e64 2063 6865 636b 6564 2068 6572   and checked her
-000302e0: 6520 616e 6420 796f 7520 6361 6e6e 6f74  e and you cannot
-000302f0: 2068 6176 6520 2264 2220 6174 7472 6962   have "d" attrib
-00030300: 7574 6520 6d6f 7265 2074 6861 6e20 6f6e  ute more than on
-00030310: 6365 2061 6e79 7761 790d 0a20 2020 2020  ce anyway..     
-00030320: 2020 2020 2020 2069 6620 6e6f 7420 7365         if not se
-00030330: 6c66 2e76 616c 7565 732e 6765 7428 2270  lf.values.get("p
-00030340: 6174 6864 5f6c 6f61 6465 6422 2c20 4661  athd_loaded", Fa
-00030350: 6c73 6529 3a0d 0a20 2020 2020 2020 2020  lse):..         
-00030360: 2020 2020 2020 2073 656c 662e 7061 7273         self.pars
-00030370: 6528 7365 6c66 2e76 616c 7565 735b 5356  e(self.values[SV
-00030380: 475f 4154 5452 5f44 4154 415d 290d 0a20  G_ATTR_DATA]).. 
-00030390: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000303a0: 656c 662e 7661 6c75 6573 5b22 7061 7468  elf.values["path
-000303b0: 645f 6c6f 6164 6564 225d 203d 2054 7275  d_loaded"] = Tru
-000303c0: 650d 0a0d 0a20 2020 2064 6566 205f 5f63  e....    def __c
-000303d0: 6f70 795f 5f28 7365 6c66 293a 0d0a 2020  opy__(self):..  
-000303e0: 2020 2020 2020 7061 7468 203d 2050 6174        path = Pat
-000303f0: 6828 7365 6c66 290d 0a20 2020 2020 2020  h(self)..       
-00030400: 2073 6567 7320 3d20 7061 7468 2e5f 7365   segs = path._se
-00030410: 676d 656e 7473 0d0a 2020 2020 2020 2020  gments..        
-00030420: 666f 7220 6920 696e 2072 616e 6765 2830  for i in range(0
-00030430: 2c20 6c65 6e28 7365 6773 2929 3a0d 0a20  , len(segs)):.. 
-00030440: 2020 2020 2020 2020 2020 2073 6567 735b             segs[
-00030450: 695d 203d 2063 6f70 7928 7365 6773 5b69  i] = copy(segs[i
-00030460: 5d29 0d0a 2020 2020 2020 2020 7265 7475  ])..        retu
-00030470: 726e 2070 6174 680d 0a0d 0a20 2020 2064  rn path....    d
-00030480: 6566 205f 5f67 6574 6974 656d 5f5f 2873  ef __getitem__(s
-00030490: 656c 662c 2069 6e64 6578 293a 0d0a 2020  elf, index):..  
-000304a0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-000304b0: 662e 5f73 6567 6d65 6e74 735b 696e 6465  f._segments[inde
-000304c0: 785d 0d0a 0d0a 2020 2020 6465 6620 5f76  x]....    def _v
-000304d0: 616c 6964 6174 655f 7375 6270 6174 6828  alidate_subpath(
-000304e0: 7365 6c66 2c20 696e 6465 7829 3a0d 0a20  self, index):.. 
-000304f0: 2020 2020 2020 2022 2222 656e 7375 7265         """ensure
-00030500: 2074 6865 2073 7562 7061 7468 2063 6f6e   the subpath con
-00030510: 7461 696e 696e 6720 7468 6973 2069 6e64  taining this ind
-00030520: 6578 2069 7320 7661 6c69 642e 2222 220d  ex is valid.""".
-00030530: 0a20 2020 2020 2020 2069 6620 696e 6465  .        if inde
-00030540: 7820 3c20 3020 6f72 2069 6e64 6578 202b  x < 0 or index +
-00030550: 2031 203e 3d20 6c65 6e28 7365 6c66 2e5f   1 >= len(self._
-00030560: 7365 676d 656e 7473 293a 0d0a 2020 2020  segments):..    
-00030570: 2020 2020 2020 2020 7265 7475 726e 2020          return  
-00030580: 2320 5468 6973 2063 6f6e 6e65 6374 696f  # This connectio
-00030590: 6e20 646f 6573 6e27 7420 6578 6973 742e  n doesn't exist.
-000305a0: 0d0a 2020 2020 2020 2020 666f 7220 6a20  ..        for j 
-000305b0: 696e 2072 616e 6765 2869 6e64 6578 2c20  in range(index, 
-000305c0: 6c65 6e28 7365 6c66 2e5f 7365 676d 656e  len(self._segmen
-000305d0: 7473 2929 3a0d 0a20 2020 2020 2020 2020  ts)):..         
-000305e0: 2020 2063 6c6f 7365 5f73 6561 7263 6820     close_search 
-000305f0: 3d20 7365 6c66 2e5f 7365 676d 656e 7473  = self._segments
-00030600: 5b6a 5d0d 0a20 2020 2020 2020 2020 2020  [j]..           
-00030610: 2069 6620 6973 696e 7374 616e 6365 2863   if isinstance(c
-00030620: 6c6f 7365 5f73 6561 7263 682c 204d 6f76  lose_search, Mov
-00030630: 6529 3a0d 0a20 2020 2020 2020 2020 2020  e):..           
-00030640: 2020 2020 2072 6574 7572 6e20 2023 204e       return  # N
-00030650: 6f74 2061 2063 6c6f 7365 6420 7061 7468  ot a closed path
-00030660: 2c20 7375 6270 6174 6820 6973 2076 616c  , subpath is val
-00030670: 6964 2e0d 0a20 2020 2020 2020 2020 2020  id...           
-00030680: 2069 6620 6973 696e 7374 616e 6365 2863   if isinstance(c
-00030690: 6c6f 7365 5f73 6561 7263 682c 2043 6c6f  lose_search, Clo
-000306a0: 7365 293a 0d0a 2020 2020 2020 2020 2020  se):..          
-000306b0: 2020 2020 2020 666f 7220 6b20 696e 2072        for k in r
-000306c0: 616e 6765 2869 6e64 6578 2c20 2d31 2c20  ange(index, -1, 
-000306d0: 2d31 293a 0d0a 2020 2020 2020 2020 2020  -1):..          
-000306e0: 2020 2020 2020 2020 2020 6d6f 7665 5f73            move_s
-000306f0: 6561 7263 6820 3d20 7365 6c66 2e5f 7365  earch = self._se
-00030700: 676d 656e 7473 5b6b 5d0d 0a20 2020 2020  gments[k]..     
-00030710: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00030720: 6620 6973 696e 7374 616e 6365 286d 6f76  f isinstance(mov
-00030730: 655f 7365 6172 6368 2c20 4d6f 7665 293a  e_search, Move):
-00030740: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00030750: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-00030760: 7365 676d 656e 7473 5b6a 5d2e 656e 6420  segments[j].end 
-00030770: 3d20 506f 696e 7428 6d6f 7665 5f73 6561  = Point(move_sea
-00030780: 7263 682e 656e 6429 0d0a 2020 2020 2020  rch.end)..      
-00030790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000307a0: 2020 7265 7475 726e 0d0a 2020 2020 2020    return..      
-000307b0: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-000307c0: 7365 676d 656e 7473 5b6a 5d2e 656e 6420  segments[j].end 
-000307d0: 3d20 506f 696e 7428 7365 6c66 2e5f 7365  = Point(self._se
-000307e0: 676d 656e 7473 5b30 5d2e 656e 6429 0d0a  gments[0].end)..
-000307f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030800: 7265 7475 726e 0d0a 0d0a 2020 2020 6465  return....    de
-00030810: 6620 5f76 616c 6964 6174 655f 6d6f 7665  f _validate_move
-00030820: 2873 656c 662c 2069 6e64 6578 293a 0d0a  (self, index):..
-00030830: 2020 2020 2020 2020 2222 2265 6e73 7572          """ensur
-00030840: 6520 7468 6520 6e65 7874 2063 6c6f 7365  e the next close
-00030850: 6420 706f 696e 7420 6672 6f6d 2074 6869  d point from thi
-00030860: 7320 696e 6465 7820 706f 696e 7473 2074  s index points t
-00030870: 6f20 6120 7661 6c69 6420 6c6f 6361 7469  o a valid locati
-00030880: 6f6e 2e22 2222 0d0a 2020 2020 2020 2020  on."""..        
-00030890: 666f 7220 6920 696e 2072 616e 6765 2869  for i in range(i
-000308a0: 6e64 6578 202b 2031 2c20 6c65 6e28 7365  ndex + 1, len(se
-000308b0: 6c66 2e5f 7365 676d 656e 7473 2929 3a0d  lf._segments)):.
-000308c0: 0a20 2020 2020 2020 2020 2020 2073 6567  .            seg
-000308d0: 6d65 6e74 203d 2073 656c 662e 5f73 6567  ment = self._seg
-000308e0: 6d65 6e74 735b 695d 0d0a 2020 2020 2020  ments[i]..      
-000308f0: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-00030900: 6e63 6528 7365 676d 656e 742c 204d 6f76  nce(segment, Mov
-00030910: 6529 3a0d 0a20 2020 2020 2020 2020 2020  e):..           
-00030920: 2020 2020 2072 6574 7572 6e20 2023 204e       return  # N
-00030930: 6f74 2061 2063 6c6f 7365 6420 7061 7468  ot a closed path
-00030940: 2c20 7468 6520 6d6f 7665 2069 7320 7661  , the move is va
-00030950: 6c69 642e 0d0a 2020 2020 2020 2020 2020  lid...          
-00030960: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-00030970: 7365 676d 656e 742c 2043 6c6f 7365 293a  segment, Close):
-00030980: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00030990: 2020 7365 676d 656e 742e 656e 6420 3d20    segment.end = 
-000309a0: 506f 696e 7428 7365 6c66 2e5f 7365 676d  Point(self._segm
-000309b0: 656e 7473 5b69 6e64 6578 5d2e 656e 6429  ents[index].end)
-000309c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000309d0: 2020 7265 7475 726e 0d0a 0d0a 2020 2020    return....    
-000309e0: 6465 6620 5f76 616c 6964 6174 655f 636c  def _validate_cl
-000309f0: 6f73 6528 7365 6c66 2c20 696e 6465 7829  ose(self, index)
-00030a00: 3a0d 0a20 2020 2020 2020 2022 2222 656e  :..        """en
-00030a10: 7375 7265 2074 6865 2063 6c6f 7365 2065  sure the close e
-00030a20: 6c65 6d65 6e74 2061 7420 7468 6973 2070  lement at this p
-00030a30: 6f73 6974 696f 6e20 636f 7272 6563 746c  osition correctl
-00030a40: 7920 6c69 6e6b 7320 746f 2074 6865 2070  y links to the p
-00030a50: 7265 7669 6f75 7320 6d6f 7665 2222 220d  revious move""".
-00030a60: 0a20 2020 2020 2020 2066 6f72 2069 2069  .        for i i
-00030a70: 6e20 7261 6e67 6528 696e 6465 782c 202d  n range(index, -
-00030a80: 312c 202d 3129 3a0d 0a20 2020 2020 2020  1, -1):..       
-00030a90: 2020 2020 2073 6567 6d65 6e74 203d 2073       segment = s
-00030aa0: 656c 662e 5f73 6567 6d65 6e74 735b 695d  elf._segments[i]
-00030ab0: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00030ac0: 2069 7369 6e73 7461 6e63 6528 7365 676d   isinstance(segm
-00030ad0: 656e 742c 204d 6f76 6529 3a0d 0a20 2020  ent, Move):..   
-00030ae0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00030af0: 662e 5f73 6567 6d65 6e74 735b 696e 6465  f._segments[inde
-00030b00: 785d 2e65 6e64 203d 2050 6f69 6e74 2873  x].end = Point(s
-00030b10: 6567 6d65 6e74 2e65 6e64 290d 0a20 2020  egment.end)..   
-00030b20: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-00030b30: 7572 6e0d 0a20 2020 2020 2020 2073 656c  urn..        sel
-00030b40: 662e 5f73 6567 6d65 6e74 735b 696e 6465  f._segments[inde
-00030b50: 785d 2e65 6e64 203d 2028 0d0a 2020 2020  x].end = (..    
-00030b60: 2020 2020 2020 2020 506f 696e 7428 7365          Point(se
-00030b70: 6c66 2e5f 7365 676d 656e 7473 5b30 5d2e  lf._segments[0].
-00030b80: 656e 6429 2069 6620 7365 6c66 2e5f 7365  end) if self._se
-00030b90: 676d 656e 7473 5b30 5d2e 656e 6420 6973  gments[0].end is
-00030ba0: 206e 6f74 204e 6f6e 6520 656c 7365 204e   not None else N
-00030bb0: 6f6e 650d 0a20 2020 2020 2020 2029 0d0a  one..        )..
-00030bc0: 2020 2020 2020 2020 2320 4966 206d 6f76          # If mov
-00030bd0: 6520 6973 206e 6576 6572 2066 6f75 6e64  e is never found
-00030be0: 2c20 6a75 7374 2074 6865 2065 6e64 2070  , just the end p
-00030bf0: 6f69 6e74 206f 6620 7468 6520 6669 7273  oint of the firs
-00030c00: 7420 656c 656d 656e 742e 2055 6e6c 6573  t element. Unles
-00030c10: 7320 7468 6174 2773 206e 6f74 2061 2074  s that's not a t
-00030c20: 6869 6e67 2e0d 0a0d 0a20 2020 2064 6566  hing.....    def
-00030c30: 205f 7661 6c69 6461 7465 5f63 6f6e 6e65   _validate_conne
-00030c40: 6374 696f 6e28 7365 6c66 2c20 696e 6465  ction(self, inde
-00030c50: 782c 2070 7265 6665 725f 7365 636f 6e64  x, prefer_second
-00030c60: 3d46 616c 7365 293a 0d0a 2020 2020 2020  =False):..      
-00030c70: 2020 2222 220d 0a20 2020 2020 2020 2056    """..        V
-00030c80: 616c 6964 6174 6573 2074 6865 2063 6f6e  alidates the con
-00030c90: 6e65 6374 696f 6e20 6174 2074 6865 2069  nection at the i
-00030ca0: 6e64 6578 2e0d 0a20 2020 2020 2020 2043  ndex...        C
-00030cb0: 6f6e 6e65 6374 696f 6e20 3020 6973 2074  onnection 0 is t
-00030cc0: 6865 2063 6f6e 6e65 6374 696f 6e20 6265  he connection be
-00030cd0: 7477 6565 6e20 6765 7469 7465 6d28 3029  tween getitem(0)
-00030ce0: 2061 6e64 2067 6574 6974 656d 2831 290d   and getitem(1).
-00030cf0: 0a0d 0a20 2020 2020 2020 2070 7265 6665  ...        prefe
-00030d00: 725f 7365 636f 6e64 2069 7320 666f 7220  r_second is for 
-00030d10: 7468 6f73 6520 6361 7365 7320 7768 6572  those cases wher
-00030d20: 6520 6661 696c 696e 6720 7468 6520 636f  e failing the co
-00030d30: 6e6e 6563 7469 6f6e 2072 6571 7569 7265  nnection require
-00030d40: 7320 7265 706c 6163 696e 670d 0a20 2020  s replacing..   
-00030d50: 2020 2020 2061 2065 7869 7374 696e 6720       a existing 
-00030d60: 7661 6c75 652e 2049 7420 7769 6c6c 2070  value. It will p
-00030d70: 7265 6665 7220 7468 6520 6175 7468 6f72  refer the author
-00030d80: 6974 7920 6f66 2072 6967 6874 2073 6964  ity of right sid
-00030d90: 652c 2073 6563 6f6e 6420 7661 6c75 652e  e, second value.
-00030da0: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
-00030db0: 2020 2020 2020 2069 6620 696e 6465 7820         if index 
-00030dc0: 3c20 3020 6f72 2069 6e64 6578 202b 2031  < 0 or index + 1
-00030dd0: 203e 3d20 6c65 6e28 7365 6c66 2e5f 7365   >= len(self._se
-00030de0: 676d 656e 7473 293a 0d0a 2020 2020 2020  gments):..      
-00030df0: 2020 2020 2020 7265 7475 726e 2020 2320        return  # 
-00030e00: 5468 6973 2063 6f6e 6e65 6374 696f 6e20  This connection 
-00030e10: 646f 6573 6e27 7420 6578 6973 742e 0d0a  doesn't exist...
-00030e20: 2020 2020 2020 2020 6669 7273 7420 3d20          first = 
-00030e30: 7365 6c66 2e5f 7365 676d 656e 7473 5b69  self._segments[i
-00030e40: 6e64 6578 5d0d 0a20 2020 2020 2020 2073  ndex]..        s
-00030e50: 6563 6f6e 6420 3d20 7365 6c66 2e5f 7365  econd = self._se
-00030e60: 676d 656e 7473 5b69 6e64 6578 202b 2031  gments[index + 1
-00030e70: 5d0d 0a20 2020 2020 2020 2069 6620 6669  ]..        if fi
-00030e80: 7273 742e 656e 6420 6973 206e 6f74 204e  rst.end is not N
-00030e90: 6f6e 6520 616e 6420 7365 636f 6e64 2e73  one and second.s
-00030ea0: 7461 7274 2069 7320 4e6f 6e65 3a0d 0a20  tart is None:.. 
-00030eb0: 2020 2020 2020 2020 2020 2073 6563 6f6e             secon
-00030ec0: 642e 7374 6172 7420 3d20 506f 696e 7428  d.start = Point(
-00030ed0: 6669 7273 742e 656e 6429 0d0a 2020 2020  first.end)..    
-00030ee0: 2020 2020 656c 6966 2066 6972 7374 2e65      elif first.e
-00030ef0: 6e64 2069 7320 4e6f 6e65 2061 6e64 2073  nd is None and s
-00030f00: 6563 6f6e 642e 7374 6172 7420 6973 206e  econd.start is n
-00030f10: 6f74 204e 6f6e 653a 0d0a 2020 2020 2020  ot None:..      
-00030f20: 2020 2020 2020 6669 7273 742e 656e 6420        first.end 
-00030f30: 3d20 506f 696e 7428 7365 636f 6e64 2e73  = Point(second.s
-00030f40: 7461 7274 290d 0a20 2020 2020 2020 2065  tart)..        e
-00030f50: 6c69 6620 6669 7273 742e 656e 6420 213d  lif first.end !=
-00030f60: 2073 6563 6f6e 642e 7374 6172 743a 0d0a   second.start:..
-00030f70: 2020 2020 2020 2020 2020 2020 2320 5468              # Th
-00030f80: 6520 7477 6f20 7661 6c75 6573 2065 7869  e two values exi
-00030f90: 7374 2062 7574 2061 7265 206e 6f74 2065  st but are not e
-00030fa0: 7175 616c 2e20 4f6e 6520 6d75 7374 2072  qual. One must r
-00030fb0: 6570 6c61 6365 2074 6865 206f 7468 6572  eplace the other
-00030fc0: 2e0d 0a20 2020 2020 2020 2020 2020 2069  ...            i
-00030fd0: 6620 7072 6566 6572 5f73 6563 6f6e 643a  f prefer_second:
-00030fe0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00030ff0: 2020 6669 7273 742e 656e 6420 3d20 506f    first.end = Po
-00031000: 696e 7428 7365 636f 6e64 2e73 7461 7274  int(second.start
-00031010: 290d 0a20 2020 2020 2020 2020 2020 2065  )..            e
-00031020: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-00031030: 2020 2020 2020 7365 636f 6e64 2e73 7461        second.sta
-00031040: 7274 203d 2050 6f69 6e74 2866 6972 7374  rt = Point(first
-00031050: 2e65 6e64 290d 0a0d 0a20 2020 2064 6566  .end)....    def
-00031060: 205f 5f73 6574 6974 656d 5f5f 2873 656c   __setitem__(sel
-00031070: 662c 2069 6e64 6578 2c20 6e65 775f 656c  f, index, new_el
-00031080: 656d 656e 7429 3a0d 0a20 2020 2020 2020  ement):..       
-00031090: 2069 6620 6973 696e 7374 616e 6365 286e   if isinstance(n
-000310a0: 6577 5f65 6c65 6d65 6e74 2c20 7374 7229  ew_element, str)
-000310b0: 3a0d 0a20 2020 2020 2020 2020 2020 206e  :..            n
-000310c0: 6577 5f65 6c65 6d65 6e74 203d 2050 6174  ew_element = Pat
-000310d0: 6828 6e65 775f 656c 656d 656e 7429 0d0a  h(new_element)..
-000310e0: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-000310f0: 656e 286e 6577 5f65 6c65 6d65 6e74 2920  en(new_element) 
-00031100: 3d3d 2030 3a0d 0a20 2020 2020 2020 2020  == 0:..         
-00031110: 2020 2020 2020 2072 6574 7572 6e0d 0a20         return.. 
-00031120: 2020 2020 2020 2020 2020 206e 6577 5f65             new_e
-00031130: 6c65 6d65 6e74 203d 206e 6577 5f65 6c65  lement = new_ele
-00031140: 6d65 6e74 2e73 6567 6d65 6e74 7328 290d  ment.segments().
-00031150: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00031160: 6973 696e 7374 616e 6365 2869 6e64 6578  isinstance(index
-00031170: 2c20 696e 7429 3a0d 0a20 2020 2020 2020  , int):..       
-00031180: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
-00031190: 6e65 775f 656c 656d 656e 7429 203e 2031  new_element) > 1
-000311a0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-000311b0: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
-000311c0: 7565 4572 726f 7220 2023 2043 616e 6e6f  ueError  # Canno
-000311d0: 7420 696e 7365 7274 206d 756c 7469 706c  t insert multipl
-000311e0: 6520 6974 656d 7320 696e 746f 2061 2073  e items into a s
-000311f0: 696e 676c 6520 7370 6163 652e 2052 6571  ingle space. Req
-00031200: 7569 7265 7320 736c 6963 652e 0d0a 2020  uires slice...  
-00031210: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
-00031220: 775f 656c 656d 656e 7420 3d20 6e65 775f  w_element = new_
-00031230: 656c 656d 656e 745b 305d 0d0a 2020 2020  element[0]..    
-00031240: 2020 2020 7365 6c66 2e5f 7365 676d 656e      self._segmen
-00031250: 7473 5b69 6e64 6578 5d20 3d20 6e65 775f  ts[index] = new_
-00031260: 656c 656d 656e 740d 0a20 2020 2020 2020  element..       
-00031270: 2073 656c 662e 5f6c 656e 6774 6820 3d20   self._length = 
-00031280: 4e6f 6e65 0d0a 2020 2020 2020 2020 7365  None..        se
-00031290: 6c66 2e5f 6c65 6e67 7468 7320 3d20 4e6f  lf._lengths = No
-000312a0: 6e65 0d0a 2020 2020 2020 2020 6966 2069  ne..        if i
-000312b0: 7369 6e73 7461 6e63 6528 696e 6465 782c  sinstance(index,
-000312c0: 2073 6c69 6365 293a 0d0a 2020 2020 2020   slice):..      
-000312d0: 2020 2020 2020 7365 6c66 2e76 616c 6964        self.valid
-000312e0: 6174 655f 636f 6e6e 6563 7469 6f6e 7328  ate_connections(
-000312f0: 290d 0a20 2020 2020 2020 2065 6c73 653a  )..        else:
-00031300: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00031310: 6c66 2e5f 7661 6c69 6461 7465 5f63 6f6e  lf._validate_con
-00031320: 6e65 6374 696f 6e28 696e 6465 7820 2d20  nection(index - 
-00031330: 3129 0d0a 2020 2020 2020 2020 2020 2020  1)..            
-00031340: 7365 6c66 2e5f 7661 6c69 6461 7465 5f63  self._validate_c
-00031350: 6f6e 6e65 6374 696f 6e28 696e 6465 7829  onnection(index)
-00031360: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00031370: 2069 7369 6e73 7461 6e63 6528 6e65 775f   isinstance(new_
-00031380: 656c 656d 656e 742c 204d 6f76 6529 3a0d  element, Move):.
-00031390: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000313a0: 2073 656c 662e 5f76 616c 6964 6174 655f   self._validate_
-000313b0: 6d6f 7665 2869 6e64 6578 290d 0a20 2020  move(index)..   
-000313c0: 2020 2020 2020 2020 2069 6620 6973 696e           if isin
-000313d0: 7374 616e 6365 286e 6577 5f65 6c65 6d65  stance(new_eleme
-000313e0: 6e74 2c20 436c 6f73 6529 3a0d 0a20 2020  nt, Close):..   
-000313f0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00031400: 662e 5f76 616c 6964 6174 655f 636c 6f73  f._validate_clos
-00031410: 6528 696e 6465 7829 0d0a 0d0a 2020 2020  e(index)....    
-00031420: 6465 6620 5f5f 6465 6c69 7465 6d5f 5f28  def __delitem__(
-00031430: 7365 6c66 2c20 696e 6465 7829 3a0d 0a20  self, index):.. 
-00031440: 2020 2020 2020 206f 7269 6769 6e61 6c5f         original_
-00031450: 656c 656d 656e 7420 3d20 7365 6c66 2e5f  element = self._
-00031460: 7365 676d 656e 7473 5b69 6e64 6578 5d0d  segments[index].
-00031470: 0a20 2020 2020 2020 2064 656c 2073 656c  .        del sel
-00031480: 662e 5f73 6567 6d65 6e74 735b 696e 6465  f._segments[inde
-00031490: 785d 0d0a 2020 2020 2020 2020 7365 6c66  x]..        self
-000314a0: 2e5f 6c65 6e67 7468 203d 204e 6f6e 650d  ._length = None.
-000314b0: 0a20 2020 2020 2020 2069 6620 6973 696e  .        if isin
-000314c0: 7374 616e 6365 2869 6e64 6578 2c20 736c  stance(index, sl
-000314d0: 6963 6529 3a0d 0a20 2020 2020 2020 2020  ice):..         
-000314e0: 2020 2073 656c 662e 7661 6c69 6461 7465     self.validate
-000314f0: 5f63 6f6e 6e65 6374 696f 6e73 2829 0d0a  _connections()..
-00031500: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-00031510: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00031520: 5f76 616c 6964 6174 655f 636f 6e6e 6563  _validate_connec
-00031530: 7469 6f6e 2869 6e64 6578 202d 2031 290d  tion(index - 1).
-00031540: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00031550: 6973 696e 7374 616e 6365 286f 7269 6769  isinstance(origi
-00031560: 6e61 6c5f 656c 656d 656e 742c 2028 436c  nal_element, (Cl
-00031570: 6f73 652c 204d 6f76 6529 293a 0d0a 2020  ose, Move)):..  
-00031580: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00031590: 6c66 2e5f 7661 6c69 6461 7465 5f73 7562  lf._validate_sub
-000315a0: 7061 7468 2869 6e64 6578 290d 0a0d 0a20  path(index).... 
-000315b0: 2020 2064 6566 205f 5f69 6164 645f 5f28     def __iadd__(
-000315c0: 7365 6c66 2c20 6f74 6865 7229 3a0d 0a20  self, other):.. 
-000315d0: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-000315e0: 616e 6365 286f 7468 6572 2c20 7374 7229  ance(other, str)
-000315f0: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
-00031600: 656c 662e 7061 7273 6528 6f74 6865 7229  elf.parse(other)
-00031610: 0d0a 2020 2020 2020 2020 656c 6966 2069  ..        elif i
-00031620: 7369 6e73 7461 6e63 6528 6f74 6865 722c  sinstance(other,
-00031630: 2028 5061 7468 2c20 5375 6270 6174 6829   (Path, Subpath)
-00031640: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00031650: 7365 6c66 2e65 7874 656e 6428 6d61 7028  self.extend(map(
-00031660: 636f 7079 2c20 6c69 7374 286f 7468 6572  copy, list(other
-00031670: 2929 290d 0a20 2020 2020 2020 2065 6c69  )))..        eli
-00031680: 6620 6973 696e 7374 616e 6365 286f 7468  f isinstance(oth
-00031690: 6572 2c20 5368 6170 6529 3a0d 0a20 2020  er, Shape):..   
-000316a0: 2020 2020 2020 2020 2073 656c 662e 7061           self.pa
-000316b0: 7273 6528 6f74 6865 722e 6428 2929 0d0a  rse(other.d())..
-000316c0: 2020 2020 2020 2020 656c 6966 2069 7369          elif isi
-000316d0: 6e73 7461 6e63 6528 6f74 6865 722c 2050  nstance(other, P
-000316e0: 6174 6853 6567 6d65 6e74 293a 0d0a 2020  athSegment):..  
-000316f0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-00031700: 7070 656e 6428 6f74 6865 7229 0d0a 2020  ppend(other)..  
-00031710: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-00031720: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00031730: 4e6f 7449 6d70 6c65 6d65 6e74 6564 0d0a  NotImplemented..
-00031740: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00031750: 656c 660d 0a0d 0a20 2020 2064 6566 205f  elf....    def _
-00031760: 5f61 6464 5f5f 2873 656c 662c 206f 7468  _add__(self, oth
-00031770: 6572 293a 0d0a 2020 2020 2020 2020 6966  er):..        if
-00031780: 2069 7369 6e73 7461 6e63 6528 6f74 6865   isinstance(othe
-00031790: 722c 2028 7374 722c 2050 6174 682c 2053  r, (str, Path, S
-000317a0: 7562 7061 7468 2c20 5368 6170 652c 2050  ubpath, Shape, P
-000317b0: 6174 6853 6567 6d65 6e74 2929 3a0d 0a20  athSegment)):.. 
-000317c0: 2020 2020 2020 2020 2020 206e 203d 2063             n = c
-000317d0: 6f70 7928 7365 6c66 290d 0a20 2020 2020  opy(self)..     
-000317e0: 2020 2020 2020 206e 202b 3d20 6f74 6865         n += othe
-000317f0: 720d 0a20 2020 2020 2020 2020 2020 2072  r..            r
-00031800: 6574 7572 6e20 6e0d 0a20 2020 2020 2020  eturn n..       
-00031810: 2072 6574 7572 6e20 4e6f 7449 6d70 6c65   return NotImple
-00031820: 6d65 6e74 6564 0d0a 0d0a 2020 2020 6465  mented....    de
-00031830: 6620 5f5f 7261 6464 5f5f 2873 656c 662c  f __radd__(self,
-00031840: 206f 7468 6572 293a 0d0a 2020 2020 2020   other):..      
-00031850: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-00031860: 6f74 6865 722c 2073 7472 293a 0d0a 2020  other, str):..  
-00031870: 2020 2020 2020 2020 2020 7061 7468 203d            path =
-00031880: 2050 6174 6828 6f74 6865 7229 0d0a 2020   Path(other)..  
-00031890: 2020 2020 2020 2020 2020 7061 7468 2e65            path.e
-000318a0: 7874 656e 6428 6d61 7028 636f 7079 2c20  xtend(map(copy, 
-000318b0: 7365 6c66 2e5f 7365 676d 656e 7473 2929  self._segments))
-000318c0: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
-000318d0: 7475 726e 2070 6174 680d 0a20 2020 2020  turn path..     
-000318e0: 2020 2065 6c69 6620 6973 696e 7374 616e     elif isinstan
-000318f0: 6365 286f 7468 6572 2c20 5061 7468 5365  ce(other, PathSe
-00031900: 676d 656e 7429 3a0d 0a20 2020 2020 2020  gment):..       
-00031910: 2020 2020 2070 6174 6820 3d20 636f 7079       path = copy
-00031920: 2873 656c 6629 0d0a 2020 2020 2020 2020  (self)..        
-00031930: 2020 2020 7061 7468 2e69 6e73 6572 7428      path.insert(
-00031940: 302c 206f 7468 6572 290d 0a20 2020 2020  0, other)..     
-00031950: 2020 2020 2020 2072 6574 7572 6e20 7061         return pa
-00031960: 7468 0d0a 2020 2020 2020 2020 656c 7365  th..        else
-00031970: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
-00031980: 6574 7572 6e20 4e6f 7449 6d70 6c65 6d65  eturn NotImpleme
-00031990: 6e74 6564 0d0a 0d0a 2020 2020 6465 6620  nted....    def 
-000319a0: 5f5f 6c65 6e5f 5f28 7365 6c66 293a 0d0a  __len__(self):..
-000319b0: 2020 2020 2020 2020 7265 7475 726e 206c          return l
-000319c0: 656e 2873 656c 662e 5f73 6567 6d65 6e74  en(self._segment
-000319d0: 7329 0d0a 0d0a 2020 2020 6465 6620 5f5f  s)....    def __
-000319e0: 7374 725f 5f28 7365 6c66 293a 0d0a 2020  str__(self):..  
-000319f0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-00031a00: 662e 6428 290d 0a0d 0a20 2020 2064 6566  f.d()....    def
-00031a10: 205f 5f72 6570 725f 5f28 7365 6c66 293a   __repr__(self):
-00031a20: 0d0a 2020 2020 2020 2020 7661 6c75 6573  ..        values
-00031a30: 203d 205b 5d0d 0a20 2020 2020 2020 2069   = []..        i
-00031a40: 6620 6c65 6e28 7365 6c66 2920 3e20 303a  f len(self) > 0:
-00031a50: 0d0a 2020 2020 2020 2020 2020 2020 7661  ..            va
-00031a60: 6c75 6573 2e61 7070 656e 6428 222c 2022  lues.append(", "
-00031a70: 2e6a 6f69 6e28 7265 7072 2878 2920 666f  .join(repr(x) fo
-00031a80: 7220 7820 696e 2073 656c 662e 5f73 6567  r x in self._seg
-00031a90: 6d65 6e74 7329 290d 0a20 2020 2020 2020  ments))..       
-00031aa0: 2073 656c 662e 5f72 6570 725f 7368 6170   self._repr_shap
-00031ab0: 6528 7661 6c75 6573 290d 0a20 2020 2020  e(values)..     
-00031ac0: 2020 2070 6172 616d 7320 3d20 222c 2022     params = ", "
-00031ad0: 2e6a 6f69 6e28 7661 6c75 6573 290d 0a20  .join(values).. 
-00031ae0: 2020 2020 2020 2072 6574 7572 6e20 2225         return "%
-00031af0: 7328 2573 2922 2025 2028 7365 6c66 2e5f  s(%s)" % (self._
-00031b00: 5f63 6c61 7373 5f5f 2e5f 5f6e 616d 655f  _class__.__name_
-00031b10: 5f2c 2070 6172 616d 7329 0d0a 0d0a 2020  _, params)....  
-00031b20: 2020 6465 6620 5f5f 6571 5f5f 2873 656c    def __eq__(sel
-00031b30: 662c 206f 7468 6572 293a 0d0a 2020 2020  f, other):..    
-00031b40: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-00031b50: 6528 6f74 6865 722c 2073 7472 293a 0d0a  e(other, str):..
-00031b60: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00031b70: 726e 2073 656c 662e 5f5f 6571 5f5f 2850  rn self.__eq__(P
-00031b80: 6174 6828 6f74 6865 7229 290d 0a20 2020  ath(other))..   
-00031b90: 2020 2020 2069 6620 6e6f 7420 6973 696e       if not isin
-00031ba0: 7374 616e 6365 286f 7468 6572 2c20 5061  stance(other, Pa
-00031bb0: 7468 293a 0d0a 2020 2020 2020 2020 2020  th):..          
-00031bc0: 2020 7265 7475 726e 204e 6f74 496d 706c    return NotImpl
-00031bd0: 656d 656e 7465 640d 0a20 2020 2020 2020  emented..       
-00031be0: 2069 6620 6c65 6e28 7365 6c66 2920 213d   if len(self) !=
-00031bf0: 206c 656e 286f 7468 6572 293a 0d0a 2020   len(other):..  
-00031c00: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00031c10: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
-00031c20: 7020 3d20 6162 7328 7365 6c66 290d 0a20  p = abs(self).. 
-00031c30: 2020 2020 2020 2071 203d 2061 6273 286f         q = abs(o
-00031c40: 7468 6572 290d 0a20 2020 2020 2020 2066  ther)..        f
-00031c50: 6f72 2073 2c20 6f20 696e 207a 6970 2871  or s, o in zip(q
-00031c60: 2e5f 7365 676d 656e 7473 2c20 702e 5f73  ._segments, p._s
-00031c70: 6567 6d65 6e74 7329 3a0d 0a20 2020 2020  egments):..     
-00031c80: 2020 2020 2020 2069 6620 6e6f 7420 7320         if not s 
-00031c90: 3d3d 206f 3a0d 0a20 2020 2020 2020 2020  == o:..         
-00031ca0: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
-00031cb0: 6c73 650d 0a20 2020 2020 2020 2069 6620  lse..        if 
-00031cc0: 702e 7374 726f 6b65 5f77 6964 7468 2021  p.stroke_width !
-00031cd0: 3d20 712e 7374 726f 6b65 5f77 6964 7468  = q.stroke_width
-00031ce0: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
-00031cf0: 6574 7572 6e20 4661 6c73 650d 0a20 2020  eturn False..   
-00031d00: 2020 2020 2072 6574 7572 6e20 5472 7565       return True
-00031d10: 0d0a 0d0a 2020 2020 6465 6620 5f5f 6e65  ....    def __ne
-00031d20: 5f5f 2873 656c 662c 206f 7468 6572 293a  __(self, other):
-00031d30: 0d0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
-00031d40: 2069 7369 6e73 7461 6e63 6528 6f74 6865   isinstance(othe
-00031d50: 722c 2028 5061 7468 2c20 7374 7229 293a  r, (Path, str)):
-00031d60: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
-00031d70: 7475 726e 204e 6f74 496d 706c 656d 656e  turn NotImplemen
-00031d80: 7465 640d 0a20 2020 2020 2020 2072 6574  ted..        ret
-00031d90: 7572 6e20 6e6f 7420 7365 6c66 203d 3d20  urn not self == 
-00031da0: 6f74 6865 720d 0a0d 0a20 2020 2064 6566  other....    def
-00031db0: 2070 6172 7365 2873 656c 662c 2070 6174   parse(self, pat
-00031dc0: 6864 6566 293a 0d0a 2020 2020 2020 2020  hdef):..        
-00031dd0: 2222 2250 6172 7365 7320 7468 6520 5356  """Parses the SV
-00031de0: 4720 7061 7468 2e22 2222 0d0a 2020 2020  G path."""..    
-00031df0: 2020 2020 746f 6b65 6e73 203d 2053 5647      tokens = SVG
-00031e00: 4c65 7869 6361 6c50 6172 7365 7228 290d  LexicalParser().
-00031e10: 0a20 2020 2020 2020 2074 6f6b 656e 732e  .        tokens.
-00031e20: 7061 7273 6528 7365 6c66 2c20 7061 7468  parse(self, path
-00031e30: 6465 6629 0d0a 0d0a 2020 2020 6465 6620  def)....    def 
-00031e40: 7661 6c69 6461 7465 5f63 6f6e 6e65 6374  validate_connect
-00031e50: 696f 6e73 2873 656c 6629 3a0d 0a20 2020  ions(self):..   
-00031e60: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
-00031e70: 2020 466f 7263 6520 7661 6c69 6461 7465    Force validate
-00031e80: 2061 6c6c 2063 6f6e 6e65 6374 696f 6e73   all connections
-00031e90: 2e0d 0a0d 0a20 2020 2020 2020 2054 6869  .....        Thi
-00031ea0: 7320 7769 6c6c 2073 6361 6e20 7061 7468  s will scan path
-00031eb0: 2063 6f6e 6e65 6374 696f 6e73 2061 6e64   connections and
-00031ec0: 206c 696e 6b20 616e 7920 6164 6a61 6365   link any adjace
-00031ed0: 6e74 2065 6c65 6d65 6e74 7320 746f 6765  nt elements toge
-00031ee0: 7468 6572 2062 7920 7265 706c 6163 696e  ther by replacin
-00031ef0: 6720 616e 7920 4e6f 6e65 2070 6f69 6e74  g any None point
-00031f00: 7320 6f72 2063 6175 7369 6e67 0d0a 2020  s or causing..  
-00031f10: 2020 2020 2020 7468 6520 7374 6172 7420        the start 
-00031f20: 706f 7369 7469 6f6e 206f 6620 7468 6520  position of the 
-00031f30: 6e65 7874 2065 6c65 6d65 6e74 2074 6f20  next element to 
-00031f40: 6571 7561 6c20 7468 6520 656e 6420 706f  equal the end po
-00031f50: 7369 7469 6f6e 206f 6620 7468 6520 7072  sition of the pr
-00031f60: 6576 696f 7573 2e20 5468 6973 2073 686f  evious. This sho
-00031f70: 756c 6420 6f6e 6c79 2062 6520 6e65 6564  uld only be need
-00031f80: 6564 0d0a 2020 2020 2020 2020 7768 656e  ed..        when
-00031f90: 2063 6f6d 6269 6e69 6e67 2070 6174 6873   combining paths
-00031fa0: 2061 6e64 2065 6c65 6d65 6e74 7320 746f   and elements to
-00031fb0: 6765 7468 6572 2e20 436c 6f73 6520 656c  gether. Close el
-00031fc0: 656d 656e 7473 2061 7265 2061 6c77 6179  ements are alway
-00031fd0: 7320 636f 6e6e 6563 7465 6420 746f 2074  s connected to t
-00031fe0: 6865 206c 6173 7420 4d6f 7665 2065 6c65  he last Move ele
-00031ff0: 6d65 6e74 206f 7220 746f 0d0a 2020 2020  ment or to..    
-00032000: 2020 2020 7468 6520 656e 6420 706f 7369      the end posi
-00032010: 7469 6f6e 206f 6620 7468 6520 6669 7273  tion of the firs
-00032020: 7420 656c 656d 656e 7420 696e 2074 6865  t element in the
-00032030: 206c 6973 742e 2054 6865 2073 7461 7274   list. The start
-00032040: 2065 6c65 6d65 6e74 206f 6620 7468 6520   element of the 
-00032050: 6669 7273 7420 7365 676d 656e 7420 6d61  first segment ma
-00032060: 7920 6f72 206d 6179 206e 6f74 2062 650d  y or may not be.
-00032070: 0a20 2020 2020 2020 204e 6f6e 652e 0d0a  .        None...
-00032080: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
-00032090: 2020 2020 207a 706f 696e 7420 3d20 4e6f       zpoint = No
-000320a0: 6e65 0d0a 2020 2020 2020 2020 6c61 7374  ne..        last
-000320b0: 5f73 6567 6d65 6e74 203d 204e 6f6e 650d  _segment = None.
-000320c0: 0a20 2020 2020 2020 2066 6f72 2073 6567  .        for seg
-000320d0: 6d65 6e74 2069 6e20 7365 6c66 2e5f 7365  ment in self._se
-000320e0: 676d 656e 7473 3a0d 0a20 2020 2020 2020  gments:..       
-000320f0: 2020 2020 2069 6620 7a70 6f69 6e74 2069       if zpoint i
-00032100: 7320 4e6f 6e65 206f 7220 6973 696e 7374  s None or isinst
-00032110: 616e 6365 2873 6567 6d65 6e74 2c20 4d6f  ance(segment, Mo
-00032120: 7665 293a 0d0a 2020 2020 2020 2020 2020  ve):..          
-00032130: 2020 2020 2020 7a70 6f69 6e74 203d 2073        zpoint = s
-00032140: 6567 6d65 6e74 2e65 6e64 0d0a 2020 2020  egment.end..    
-00032150: 2020 2020 2020 2020 6966 206c 6173 745f          if last_
-00032160: 7365 676d 656e 7420 6973 206e 6f74 204e  segment is not N
-00032170: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
-00032180: 2020 2020 2020 6966 2073 6567 6d65 6e74        if segment
-00032190: 2e73 7461 7274 2069 7320 4e6f 6e65 2061  .start is None a
-000321a0: 6e64 206c 6173 745f 7365 676d 656e 742e  nd last_segment.
-000321b0: 656e 6420 6973 206e 6f74 204e 6f6e 653a  end is not None:
-000321c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000321d0: 2020 2020 2020 7365 676d 656e 742e 7374        segment.st
-000321e0: 6172 7420 3d20 506f 696e 7428 6c61 7374  art = Point(last
-000321f0: 5f73 6567 6d65 6e74 2e65 6e64 290d 0a20  _segment.end).. 
-00032200: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00032210: 6c69 6620 6c61 7374 5f73 6567 6d65 6e74  lif last_segment
-00032220: 2e65 6e64 2069 7320 4e6f 6e65 2061 6e64  .end is None and
-00032230: 2073 6567 6d65 6e74 2e73 7461 7274 2069   segment.start i
-00032240: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
-00032250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032260: 206c 6173 745f 7365 676d 656e 742e 656e   last_segment.en
-00032270: 6420 3d20 506f 696e 7428 7365 676d 656e  d = Point(segmen
-00032280: 742e 7374 6172 7429 0d0a 2020 2020 2020  t.start)..      
-00032290: 2020 2020 2020 2020 2020 656c 6966 206c            elif l
-000322a0: 6173 745f 7365 676d 656e 742e 656e 6420  ast_segment.end 
-000322b0: 213d 2073 6567 6d65 6e74 2e73 7461 7274  != segment.start
-000322c0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-000322d0: 2020 2020 2020 2073 6567 6d65 6e74 2e73         segment.s
-000322e0: 7461 7274 203d 2050 6f69 6e74 286c 6173  tart = Point(las
-000322f0: 745f 7365 676d 656e 742e 656e 6429 0d0a  t_segment.end)..
-00032300: 2020 2020 2020 2020 2020 2020 6966 2028              if (
-00032310: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00032320: 2020 6973 696e 7374 616e 6365 2873 6567    isinstance(seg
-00032330: 6d65 6e74 2c20 436c 6f73 6529 0d0a 2020  ment, Close)..  
-00032340: 2020 2020 2020 2020 2020 2020 2020 616e                an
-00032350: 6420 7a70 6f69 6e74 2069 7320 6e6f 7420  d zpoint is not 
-00032360: 4e6f 6e65 0d0a 2020 2020 2020 2020 2020  None..          
-00032370: 2020 2020 2020 616e 6420 7365 676d 656e        and segmen
-00032380: 742e 656e 6420 213d 207a 706f 696e 740d  t.end != zpoint.
-00032390: 0a20 2020 2020 2020 2020 2020 2029 3a0d  .            ):.
-000323a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000323b0: 2073 6567 6d65 6e74 2e65 6e64 203d 2050   segment.end = P
-000323c0: 6f69 6e74 287a 706f 696e 7429 0d0a 2020  oint(zpoint)..  
-000323d0: 2020 2020 2020 2020 2020 6c61 7374 5f73            last_s
-000323e0: 6567 6d65 6e74 203d 2073 6567 6d65 6e74  egment = segment
-000323f0: 0d0a 0d0a 2020 2020 6465 6620 5f69 735f  ....    def _is_
-00032400: 7661 6c69 6428 7365 6c66 293a 0d0a 2020  valid(self):..  
-00032410: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
-00032420: 2020 2043 6865 636b 7320 7661 6c69 6461     Checks valida
-00032430: 7469 6f6e 206f 6620 616c 6c20 636f 6e6e  tion of all conn
-00032440: 6563 7469 6f6e 732e 0d0a 0d0a 2020 2020  ections.....    
-00032450: 2020 2020 5061 7468 7320 6172 6520 7661      Paths are va
-00032460: 6c69 6420 6966 2061 6c6c 2065 6e64 2070  lid if all end p
-00032470: 6f69 6e74 7320 6d61 7463 6820 7468 6520  oints match the 
-00032480: 7374 6172 7420 6f66 2074 6865 206e 6578  start of the nex
-00032490: 7420 706f 696e 7420 616e 6420 616c 6c20  t point and all 
-000324a0: 636c 6f73 650d 0a20 2020 2020 2020 2063  close..        c
-000324b0: 6f6d 6d61 6e64 7320 7265 7475 726e 2074  ommands return t
-000324c0: 6f20 7468 6520 6c61 7374 2076 616c 6964  o the last valid
-000324d0: 206d 6f76 6520 636f 6d6d 616e 642e 0d0a   move command...
-000324e0: 0d0a 2020 2020 2020 2020 5468 6973 2064  ..        This d
-000324f0: 6f65 7320 6e6f 7420 6368 6563 6b20 666f  oes not check fo
-00032500: 7220 696e 636f 6e67 7275 656e 7420 7061  r incongruent pa
-00032510: 7468 2076 616c 6964 6974 792e 2050 6174  th validity. Pat
-00032520: 6820 6672 6167 6d65 6e74 7320 7769 7468  h fragments with
-00032530: 6f75 7420 696e 6974 6961 6c20 6d6f 7665  out initial move
-00032540: 730d 0a20 2020 2020 2020 2064 6f75 626c  s..        doubl
-00032550: 6520 636c 6f73 6564 2070 6174 6873 2c20  e closed paths, 
-00032560: 6d61 7920 616c 6c20 7061 7373 2074 6869  may all pass thi
-00032570: 7320 6368 6563 6b2e 0d0a 2020 2020 2020  s check...      
-00032580: 2020 2222 220d 0a20 2020 2020 2020 207a    """..        z
-00032590: 706f 696e 7420 3d20 4e6f 6e65 0d0a 2020  point = None..  
-000325a0: 2020 2020 2020 6c61 7374 5f73 6567 6d65        last_segme
-000325b0: 6e74 203d 204e 6f6e 650d 0a20 2020 2020  nt = None..     
-000325c0: 2020 2066 6f72 2073 6567 6d65 6e74 2069     for segment i
-000325d0: 6e20 7365 6c66 2e5f 7365 676d 656e 7473  n self._segments
-000325e0: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
-000325f0: 6620 7a70 6f69 6e74 2069 7320 4e6f 6e65  f zpoint is None
-00032600: 206f 7220 6973 696e 7374 616e 6365 2873   or isinstance(s
-00032610: 6567 6d65 6e74 2c20 4d6f 7665 293a 0d0a  egment, Move):..
-00032620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032630: 7a70 6f69 6e74 203d 2073 6567 6d65 6e74  zpoint = segment
-00032640: 2e65 6e64 0d0a 2020 2020 2020 2020 2020  .end..          
-00032650: 2020 6966 206c 6173 745f 7365 676d 656e    if last_segmen
-00032660: 7420 6973 206e 6f74 204e 6f6e 653a 0d0a  t is not None:..
-00032670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032680: 6966 2073 6567 6d65 6e74 2e73 7461 7274  if segment.start
-00032690: 2069 7320 4e6f 6e65 3a0d 0a20 2020 2020   is None:..     
-000326a0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-000326b0: 6574 7572 6e20 4661 6c73 650d 0a20 2020  eturn False..   
-000326c0: 2020 2020 2020 2020 2020 2020 2065 6c69               eli
-000326d0: 6620 6c61 7374 5f73 6567 6d65 6e74 2e65  f last_segment.e
-000326e0: 6e64 2069 7320 4e6f 6e65 3a0d 0a20 2020  nd is None:..   
-000326f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032700: 2072 6574 7572 6e20 4661 6c73 650d 0a20   return False.. 
-00032710: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00032720: 6c69 6620 6c61 7374 5f73 6567 6d65 6e74  lif last_segment
-00032730: 2e65 6e64 2021 3d20 7365 676d 656e 742e  .end != segment.
-00032740: 7374 6172 743a 0d0a 2020 2020 2020 2020  start:..        
-00032750: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00032760: 726e 2046 616c 7365 0d0a 2020 2020 2020  rn False..      
-00032770: 2020 2020 2020 6966 2028 0d0a 2020 2020        if (..    
-00032780: 2020 2020 2020 2020 2020 2020 6973 696e              isin
-00032790: 7374 616e 6365 2873 6567 6d65 6e74 2c20  stance(segment, 
-000327a0: 436c 6f73 6529 0d0a 2020 2020 2020 2020  Close)..        
-000327b0: 2020 2020 2020 2020 616e 6420 7a70 6f69          and zpoi
-000327c0: 6e74 2069 7320 6e6f 7420 4e6f 6e65 0d0a  nt is not None..
-000327d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000327e0: 616e 6420 7365 676d 656e 742e 656e 6420  and segment.end 
-000327f0: 213d 207a 706f 696e 740d 0a20 2020 2020  != zpoint..     
-00032800: 2020 2020 2020 2029 3a0d 0a20 2020 2020         ):..     
-00032810: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00032820: 6e20 4661 6c73 650d 0a20 2020 2020 2020  n False..       
-00032830: 2020 2020 206c 6173 745f 7365 676d 656e       last_segmen
-00032840: 7420 3d20 7365 676d 656e 740d 0a20 2020  t = segment..   
-00032850: 2020 2020 2072 6574 7572 6e20 5472 7565       return True
-00032860: 0d0a 0d0a 2020 2020 4070 726f 7065 7274  ....    @propert
-00032870: 790d 0a20 2020 2064 6566 2066 6972 7374  y..    def first
-00032880: 5f70 6f69 6e74 2873 656c 6629 3a0d 0a20  _point(self):.. 
-00032890: 2020 2020 2020 2022 2222 4669 7273 7420         """First 
-000328a0: 706f 696e 7420 616c 6f6e 6720 7468 6520  point along the 
-000328b0: 5061 7468 2e20 5468 6973 2069 7320 7468  Path. This is th
-000328c0: 6520 7374 6172 7420 706f 696e 7420 6f66  e start point of
-000328d0: 2074 6865 2066 6972 7374 2073 6567 6d65   the first segme
-000328e0: 6e74 2075 6e6c 6573 7320 6974 2073 7461  nt unless it sta
-000328f0: 7274 730d 0a20 2020 2020 2020 2077 6974  rts..        wit
-00032900: 6820 6120 4d6f 7665 2063 6f6d 6d61 6e64  h a Move command
-00032910: 2077 6974 6820 6120 4e6f 6e65 2073 7461   with a None sta
-00032920: 7274 2069 6e20 7768 6963 6820 6361 7365  rt in which case
-00032930: 2066 6972 7374 2070 6f69 6e74 2069 7320   first point is 
-00032940: 7468 6174 204d 6f76 6527 7320 6465 7374  that Move's dest
-00032950: 696e 6174 696f 6e2e 2222 220d 0a20 2020  ination."""..   
-00032960: 2020 2020 2069 6620 6c65 6e28 7365 6c66       if len(self
-00032970: 2e5f 7365 676d 656e 7473 2920 3d3d 2030  ._segments) == 0
-00032980: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
-00032990: 6574 7572 6e20 4e6f 6e65 0d0a 2020 2020  eturn None..    
-000329a0: 2020 2020 6966 2073 656c 662e 5f73 6567      if self._seg
-000329b0: 6d65 6e74 735b 305d 2e73 7461 7274 2069  ments[0].start i
-000329c0: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
-000329d0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-000329e0: 506f 696e 7428 7365 6c66 2e5f 7365 676d  Point(self._segm
-000329f0: 656e 7473 5b30 5d2e 7374 6172 7429 0d0a  ents[0].start)..
-00032a00: 2020 2020 2020 2020 7265 7475 726e 2028          return (
-00032a10: 0d0a 2020 2020 2020 2020 2020 2020 506f  ..            Po
-00032a20: 696e 7428 7365 6c66 2e5f 7365 676d 656e  int(self._segmen
-00032a30: 7473 5b30 5d2e 656e 6429 2069 6620 7365  ts[0].end) if se
-00032a40: 6c66 2e5f 7365 676d 656e 7473 5b30 5d2e  lf._segments[0].
-00032a50: 656e 6420 6973 206e 6f74 204e 6f6e 6520  end is not None 
-00032a60: 656c 7365 204e 6f6e 650d 0a20 2020 2020  else None..     
-00032a70: 2020 2029 0d0a 0d0a 2020 2020 4070 726f     )....    @pro
-00032a80: 7065 7274 790d 0a20 2020 2064 6566 2063  perty..    def c
-00032a90: 7572 7265 6e74 5f70 6f69 6e74 2873 656c  urrent_point(sel
-00032aa0: 6629 3a0d 0a20 2020 2020 2020 2069 6620  f):..        if 
-00032ab0: 6c65 6e28 7365 6c66 2e5f 7365 676d 656e  len(self._segmen
-00032ac0: 7473 2920 3d3d 2030 3a0d 0a20 2020 2020  ts) == 0:..     
-00032ad0: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
-00032ae0: 6e65 0d0a 2020 2020 2020 2020 7265 7475  ne..        retu
-00032af0: 726e 2028 0d0a 2020 2020 2020 2020 2020  rn (..          
-00032b00: 2020 506f 696e 7428 7365 6c66 2e5f 7365    Point(self._se
-00032b10: 676d 656e 7473 5b2d 315d 2e65 6e64 290d  gments[-1].end).
-00032b20: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00032b30: 7365 6c66 2e5f 7365 676d 656e 7473 5b2d  self._segments[-
-00032b40: 315d 2e65 6e64 2069 7320 6e6f 7420 4e6f  1].end is not No
-00032b50: 6e65 0d0a 2020 2020 2020 2020 2020 2020  ne..            
-00032b60: 656c 7365 204e 6f6e 650d 0a20 2020 2020  else None..     
-00032b70: 2020 2029 0d0a 0d0a 2020 2020 4070 726f     )....    @pro
-00032b80: 7065 7274 790d 0a20 2020 2064 6566 207a  perty..    def z
-00032b90: 5f70 6f69 6e74 2873 656c 6629 3a0d 0a20  _point(self):.. 
-00032ba0: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
-00032bb0: 2020 2020 5a20 6973 2074 6865 2064 6573      Z is the des
-00032bc0: 7469 6e61 7469 6f6e 206f 6620 7468 6520  tination of the 
-00032bd0: 6c61 7374 204d 6f76 652e 2049 7420 6361  last Move. It ca
-00032be0: 6e20 6d65 616e 2c20 6275 7420 646f 6573  n mean, but does
-00032bf0: 6e27 7420 6e65 6365 7373 6172 696c 7920  n't necessarily 
-00032c00: 6d65 616e 2074 6865 2066 6972 7374 5f70  mean the first_p
-00032c10: 6f69 6e74 2069 6e20 7468 6520 7061 7468  oint in the path
-00032c20: 2e0d 0a20 2020 2020 2020 2054 6869 7320  ...        This 
-00032c30: 6265 6861 7669 6f72 206f 6620 5a20 6973  behavior of Z is
-00032c40: 2064 6566 696e 6564 2069 6e20 7376 6720   defined in svg 
-00032c50: 7370 6563 3a0d 0a20 2020 2020 2020 2068  spec:..        h
-00032c60: 7474 703a 2f2f 7777 772e 7733 2e6f 7267  ttp://www.w3.org
-00032c70: 2f54 522f 5356 472f 7061 7468 732e 6874  /TR/SVG/paths.ht
-00032c80: 6d6c 2350 6174 6844 6174 6143 6c6f 7365  ml#PathDataClose
-00032c90: 5061 7468 436f 6d6d 616e 640d 0a20 2020  PathCommand..   
-00032ca0: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
-00032cb0: 2020 656e 645f 706f 7320 3d20 4e6f 6e65    end_pos = None
-00032cc0: 0d0a 2020 2020 2020 2020 666f 7220 7365  ..        for se
-00032cd0: 676d 656e 7420 696e 2072 6576 6572 7365  gment in reverse
-00032ce0: 6428 7365 6c66 2e5f 7365 676d 656e 7473  d(self._segments
-00032cf0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00032d00: 6966 2069 7369 6e73 7461 6e63 6528 7365  if isinstance(se
-00032d10: 676d 656e 742c 204d 6f76 6529 3a0d 0a20  gment, Move):.. 
-00032d20: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00032d30: 6e64 5f70 6f73 203d 2073 6567 6d65 6e74  nd_pos = segment
-00032d40: 2e65 6e64 0d0a 2020 2020 2020 2020 2020  .end..          
-00032d50: 2020 2020 2020 6272 6561 6b0d 0a20 2020        break..   
-00032d60: 2020 2020 2069 6620 656e 645f 706f 7320       if end_pos 
-00032d70: 6973 204e 6f6e 653a 0d0a 2020 2020 2020  is None:..      
-00032d80: 2020 2020 2020 7472 793a 0d0a 2020 2020        try:..    
-00032d90: 2020 2020 2020 2020 2020 2020 656e 645f              end_
-00032da0: 706f 7320 3d20 7365 6c66 2e5f 7365 676d  pos = self._segm
-00032db0: 656e 7473 5b30 5d2e 656e 640d 0a20 2020  ents[0].end..   
-00032dc0: 2020 2020 2020 2020 2065 7863 6570 7420           except 
-00032dd0: 496e 6465 7845 7272 6f72 3a0d 0a20 2020  IndexError:..   
-00032de0: 2020 2020 2020 2020 2020 2020 2070 6173               pas
-00032df0: 7320 2023 2065 6e74 6972 6520 7061 7468  s  # entire path
-00032e00: 2069 7320 227a 222e 0d0a 2020 2020 2020   is "z"...      
-00032e10: 2020 7265 7475 726e 2065 6e64 5f70 6f73    return end_pos
-00032e20: 0d0a 0d0a 2020 2020 4070 726f 7065 7274  ....    @propert
-00032e30: 790d 0a20 2020 2064 6566 2073 6d6f 6f74  y..    def smoot
-00032e40: 685f 706f 696e 7428 7365 6c66 293a 0d0a  h_point(self):..
-00032e50: 2020 2020 2020 2020 2222 2252 6574 7572          """Retur
-00032e60: 6e73 2074 6865 2073 6d6f 6f74 6869 6e67  ns the smoothing
-00032e70: 2063 6f6e 7472 6f6c 2070 6f69 6e74 2066   control point f
-00032e80: 6f72 2074 6865 2073 6d6f 6f74 6820 636f  or the smooth co
-00032e90: 6d6d 616e 6473 2e0d 0a20 2020 2020 2020  mmands...       
-00032ea0: 2057 6974 6820 7265 6761 7264 7320 746f   With regards to
-00032eb0: 2074 6865 2053 5647 2073 7461 6e64 6172   the SVG standar
-00032ec0: 6420 6966 2074 6865 206c 6173 7420 636f  d if the last co
-00032ed0: 6d6d 616e 6420 7761 7320 6120 6375 7276  mmand was a curv
-00032ee0: 6520 7468 6520 736d 6f6f 7468 0d0a 2020  e the smooth..  
-00032ef0: 2020 2020 2020 636f 6e74 726f 6c20 706f        control po
-00032f00: 696e 7420 6973 2074 6865 2072 6566 6c65  int is the refle
-00032f10: 6374 696f 6e20 6f66 2074 6865 2070 7265  ction of the pre
-00032f20: 7669 6f75 7320 636f 6e74 726f 6c20 706f  vious control po
-00032f30: 696e 742e 0d0a 0d0a 2020 2020 2020 2020  int.....        
-00032f40: 4966 2074 6865 206c 6173 7420 636f 6d6d  If the last comm
-00032f50: 616e 6420 7761 7320 6e6f 7420 6120 6375  and was not a cu
-00032f60: 7276 652c 2074 6865 2073 6d6f 6f74 685f  rve, the smooth_
-00032f70: 706f 696e 7420 6973 2063 6f69 6e63 6964  point is coincid
-00032f80: 656e 7420 7769 7468 2074 6865 2063 7572  ent with the cur
-00032f90: 7265 6e74 2e0d 0a20 2020 2020 2020 2068  rent...        h
-00032fa0: 7474 7073 3a2f 2f77 7777 2e77 332e 6f72  ttps://www.w3.or
-00032fb0: 672f 5452 2f53 5647 2f70 6174 6873 2e68  g/TR/SVG/paths.h
-00032fc0: 746d 6c23 5061 7468 4461 7461 4375 6269  tml#PathDataCubi
-00032fd0: 6342 657a 6965 7243 6f6d 6d61 6e64 730d  cBezierCommands.
-00032fe0: 0a20 2020 2020 2020 2022 2222 0d0a 0d0a  .        """....
-00032ff0: 2020 2020 2020 2020 6966 206c 656e 2873          if len(s
-00033000: 656c 662e 5f73 6567 6d65 6e74 7329 203d  elf._segments) =
-00033010: 3d20 303a 0d0a 2020 2020 2020 2020 2020  = 0:..          
-00033020: 2020 7265 7475 726e 204e 6f6e 650d 0a20    return None.. 
-00033030: 2020 2020 2020 2073 7461 7274 5f70 6f73         start_pos
-00033040: 203d 2073 656c 662e 6375 7272 656e 745f   = self.current_
-00033050: 706f 696e 740d 0a20 2020 2020 2020 206c  point..        l
-00033060: 6173 745f 7365 676d 656e 7420 3d20 7365  ast_segment = se
-00033070: 6c66 2e5f 7365 676d 656e 7473 5b2d 315d  lf._segments[-1]
-00033080: 0d0a 2020 2020 2020 2020 6966 2069 7369  ..        if isi
-00033090: 6e73 7461 6e63 6528 6c61 7374 5f73 6567  nstance(last_seg
-000330a0: 6d65 6e74 2c20 5175 6164 7261 7469 6342  ment, QuadraticB
-000330b0: 657a 6965 7229 3a0d 0a20 2020 2020 2020  ezier):..       
-000330c0: 2020 2020 2070 7265 7669 6f75 735f 636f       previous_co
-000330d0: 6e74 726f 6c20 3d20 6c61 7374 5f73 6567  ntrol = last_seg
-000330e0: 6d65 6e74 2e63 6f6e 7472 6f6c 0d0a 2020  ment.control..  
-000330f0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00033100: 2070 7265 7669 6f75 735f 636f 6e74 726f   previous_contro
-00033110: 6c2e 7265 666c 6563 7465 645f 6163 726f  l.reflected_acro
-00033120: 7373 2873 7461 7274 5f70 6f73 290d 0a20  ss(start_pos).. 
-00033130: 2020 2020 2020 2065 6c69 6620 6973 696e         elif isin
-00033140: 7374 616e 6365 286c 6173 745f 7365 676d  stance(last_segm
-00033150: 656e 742c 2043 7562 6963 4265 7a69 6572  ent, CubicBezier
-00033160: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00033170: 7072 6576 696f 7573 5f63 6f6e 7472 6f6c  previous_control
-00033180: 203d 206c 6173 745f 7365 676d 656e 742e   = last_segment.
-00033190: 636f 6e74 726f 6c32 0d0a 2020 2020 2020  control2..      
-000331a0: 2020 2020 2020 7265 7475 726e 2070 7265        return pre
-000331b0: 7669 6f75 735f 636f 6e74 726f 6c2e 7265  vious_control.re
-000331c0: 666c 6563 7465 645f 6163 726f 7373 2873  flected_across(s
-000331d0: 7461 7274 5f70 6f73 290d 0a20 2020 2020  tart_pos)..     
-000331e0: 2020 2072 6574 7572 6e20 7374 6172 745f     return start_
-000331f0: 706f 730d 0a0d 0a20 2020 2064 6566 2073  pos....    def s
-00033200: 7461 7274 2873 656c 6629 3a0d 0a20 2020  tart(self):..   
-00033210: 2020 2020 2070 6173 730d 0a0d 0a20 2020       pass....   
-00033220: 2064 6566 2065 6e64 2873 656c 6629 3a0d   def end(self):.
-00033230: 0a20 2020 2020 2020 2070 6173 730d 0a0d  .        pass...
-00033240: 0a20 2020 2064 6566 206d 6f76 6528 7365  .    def move(se
-00033250: 6c66 2c20 2a70 6f69 6e74 732c 202a 2a6b  lf, *points, **k
-00033260: 7761 7267 7329 3a0d 0a20 2020 2020 2020  wargs):..       
-00033270: 2072 656c 6174 6976 6520 3d20 6b77 6172   relative = kwar
-00033280: 6773 5b22 7265 6c61 7469 7665 225d 2069  gs["relative"] i
-00033290: 6620 2272 656c 6174 6976 6522 2069 6e20  f "relative" in 
-000332a0: 6b77 6172 6773 2065 6c73 6520 4661 6c73  kwargs else Fals
-000332b0: 650d 0a20 2020 2020 2020 2073 7461 7274  e..        start
-000332c0: 5f70 6f73 203d 2073 656c 662e 6375 7272  _pos = self.curr
-000332d0: 656e 745f 706f 696e 740d 0a20 2020 2020  ent_point..     
-000332e0: 2020 2065 6e64 5f70 6f73 203d 2070 6f69     end_pos = poi
-000332f0: 6e74 735b 305d 0d0a 2020 2020 2020 2020  nts[0]..        
-00033300: 6966 2065 6e64 5f70 6f73 2069 6e20 2822  if end_pos in ("
-00033310: 7a22 2c20 225a 2229 3a0d 0a20 2020 2020  z", "Z"):..     
-00033320: 2020 2020 2020 2065 6e64 5f70 6f73 203d         end_pos =
-00033330: 2073 656c 662e 7a5f 706f 696e 740d 0a20   self.z_point.. 
-00033340: 2020 2020 2020 2073 6567 6d65 6e74 203d         segment =
-00033350: 204d 6f76 6528 7374 6172 745f 706f 732c   Move(start_pos,
-00033360: 2065 6e64 5f70 6f73 290d 0a20 2020 2020   end_pos)..     
-00033370: 2020 2073 6567 6d65 6e74 2e72 656c 6174     segment.relat
-00033380: 6976 6520 3d20 7265 6c61 7469 7665 0d0a  ive = relative..
-00033390: 2020 2020 2020 2020 7365 6c66 2e61 7070          self.app
-000333a0: 656e 6428 7365 676d 656e 7429 0d0a 2020  end(segment)..  
-000333b0: 2020 2020 2020 6966 206c 656e 2870 6f69        if len(poi
-000333c0: 6e74 7329 203e 2031 3a0d 0a20 2020 2020  nts) > 1:..     
-000333d0: 2020 2020 2020 2073 656c 662e 6c69 6e65         self.line
-000333e0: 282a 706f 696e 7473 5b31 3a5d 2c20 7265  (*points[1:], re
-000333f0: 6c61 7469 7665 3d72 656c 6174 6976 6529  lative=relative)
-00033400: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00033410: 2073 656c 660d 0a0d 0a20 2020 2064 6566   self....    def
-00033420: 206c 696e 6528 7365 6c66 2c20 2a70 6f69   line(self, *poi
-00033430: 6e74 732c 202a 2a6b 7761 7267 7329 3a0d  nts, **kwargs):.
-00033440: 0a20 2020 2020 2020 2072 656c 6174 6976  .        relativ
-00033450: 6520 3d20 6b77 6172 6773 5b22 7265 6c61  e = kwargs["rela
-00033460: 7469 7665 225d 2069 6620 2272 656c 6174  tive"] if "relat
-00033470: 6976 6522 2069 6e20 6b77 6172 6773 2065  ive" in kwargs e
-00033480: 6c73 6520 4661 6c73 650d 0a20 2020 2020  lse False..     
-00033490: 2020 2073 7461 7274 5f70 6f73 203d 2073     start_pos = s
-000334a0: 656c 662e 6375 7272 656e 745f 706f 696e  elf.current_poin
-000334b0: 740d 0a20 2020 2020 2020 2065 6e64 5f70  t..        end_p
-000334c0: 6f73 203d 2070 6f69 6e74 735b 305d 0d0a  os = points[0]..
-000334d0: 2020 2020 2020 2020 6966 2065 6e64 5f70          if end_p
-000334e0: 6f73 2069 6e20 2822 7a22 2c20 225a 2229  os in ("z", "Z")
-000334f0: 3a0d 0a20 2020 2020 2020 2020 2020 2065  :..            e
-00033500: 6e64 5f70 6f73 203d 2073 656c 662e 7a5f  nd_pos = self.z_
-00033510: 706f 696e 740d 0a20 2020 2020 2020 2073  point..        s
-00033520: 6567 6d65 6e74 203d 204c 696e 6528 7374  egment = Line(st
-00033530: 6172 745f 706f 732c 2065 6e64 5f70 6f73  art_pos, end_pos
-00033540: 290d 0a20 2020 2020 2020 2073 6567 6d65  )..        segme
-00033550: 6e74 2e72 656c 6174 6976 6520 3d20 7265  nt.relative = re
-00033560: 6c61 7469 7665 0d0a 2020 2020 2020 2020  lative..        
-00033570: 7365 6c66 2e61 7070 656e 6428 7365 676d  self.append(segm
-00033580: 656e 7429 0d0a 2020 2020 2020 2020 6966  ent)..        if
-00033590: 206c 656e 2870 6f69 6e74 7329 203e 2031   len(points) > 1
-000335a0: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
-000335b0: 656c 662e 6c69 6e65 282a 706f 696e 7473  elf.line(*points
-000335c0: 5b31 3a5d 290d 0a20 2020 2020 2020 2072  [1:])..        r
-000335d0: 6574 7572 6e20 7365 6c66 0d0a 0d0a 2020  eturn self....  
-000335e0: 2020 6465 6620 7665 7274 6963 616c 2873    def vertical(s
-000335f0: 656c 662c 202a 795f 706f 696e 7473 2c20  elf, *y_points, 
-00033600: 2a2a 6b77 6172 6773 293a 0d0a 2020 2020  **kwargs):..    
-00033610: 2020 2020 7265 6c61 7469 7665 203d 206b      relative = k
-00033620: 7761 7267 735b 2272 656c 6174 6976 6522  wargs["relative"
-00033630: 5d20 6966 2022 7265 6c61 7469 7665 2220  ] if "relative" 
-00033640: 696e 206b 7761 7267 7320 656c 7365 2046  in kwargs else F
-00033650: 616c 7365 0d0a 2020 2020 2020 2020 7374  alse..        st
-00033660: 6172 745f 706f 7320 3d20 7365 6c66 2e63  art_pos = self.c
-00033670: 7572 7265 6e74 5f70 6f69 6e74 0d0a 2020  urrent_point..  
-00033680: 2020 2020 2020 6966 2072 656c 6174 6976        if relativ
-00033690: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-000336a0: 7365 676d 656e 7420 3d20 4c69 6e65 2873  segment = Line(s
-000336b0: 7461 7274 5f70 6f73 2c20 506f 696e 7428  tart_pos, Point(
-000336c0: 7374 6172 745f 706f 732e 782c 2073 7461  start_pos.x, sta
-000336d0: 7274 5f70 6f73 2e79 202b 2079 5f70 6f69  rt_pos.y + y_poi
-000336e0: 6e74 735b 305d 2929 0d0a 2020 2020 2020  nts[0]))..      
-000336f0: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-00033700: 2020 2020 2073 6567 6d65 6e74 203d 204c       segment = L
-00033710: 696e 6528 7374 6172 745f 706f 732c 2050  ine(start_pos, P
-00033720: 6f69 6e74 2873 7461 7274 5f70 6f73 2e78  oint(start_pos.x
-00033730: 2c20 795f 706f 696e 7473 5b30 5d29 290d  , y_points[0])).
-00033740: 0a20 2020 2020 2020 2073 6567 6d65 6e74  .        segment
-00033750: 2e72 656c 6174 6976 6520 3d20 7265 6c61  .relative = rela
-00033760: 7469 7665 0d0a 2020 2020 2020 2020 7365  tive..        se
-00033770: 6c66 2e61 7070 656e 6428 7365 676d 656e  lf.append(segmen
-00033780: 7429 0d0a 2020 2020 2020 2020 6966 206c  t)..        if l
-00033790: 656e 2879 5f70 6f69 6e74 7329 203e 2031  en(y_points) > 1
-000337a0: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
-000337b0: 656c 662e 7665 7274 6963 616c 282a 795f  elf.vertical(*y_
-000337c0: 706f 696e 7473 5b31 3a5d 2c20 7265 6c61  points[1:], rela
-000337d0: 7469 7665 3d72 656c 6174 6976 6529 0d0a  tive=relative)..
-000337e0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-000337f0: 656c 660d 0a0d 0a20 2020 2064 6566 2068  elf....    def h
-00033800: 6f72 697a 6f6e 7461 6c28 7365 6c66 2c20  orizontal(self, 
-00033810: 2a78 5f70 6f69 6e74 732c 202a 2a6b 7761  *x_points, **kwa
-00033820: 7267 7329 3a0d 0a20 2020 2020 2020 2072  rgs):..        r
-00033830: 656c 6174 6976 6520 3d20 6b77 6172 6773  elative = kwargs
-00033840: 5b22 7265 6c61 7469 7665 225d 2069 6620  ["relative"] if 
-00033850: 2272 656c 6174 6976 6522 2069 6e20 6b77  "relative" in kw
-00033860: 6172 6773 2065 6c73 6520 4661 6c73 650d  args else False.
-00033870: 0a20 2020 2020 2020 2073 7461 7274 5f70  .        start_p
-00033880: 6f73 203d 2073 656c 662e 6375 7272 656e  os = self.curren
-00033890: 745f 706f 696e 740d 0a20 2020 2020 2020  t_point..       
-000338a0: 2069 6620 7265 6c61 7469 7665 3a0d 0a20   if relative:.. 
-000338b0: 2020 2020 2020 2020 2020 2073 6567 6d65             segme
-000338c0: 6e74 203d 204c 696e 6528 7374 6172 745f  nt = Line(start_
-000338d0: 706f 732c 2050 6f69 6e74 2873 7461 7274  pos, Point(start
-000338e0: 5f70 6f73 2e78 202b 2078 5f70 6f69 6e74  _pos.x + x_point
-000338f0: 735b 305d 2c20 7374 6172 745f 706f 732e  s[0], start_pos.
-00033900: 7929 290d 0a20 2020 2020 2020 2020 2020  y))..           
-00033910: 2073 6567 6d65 6e74 2e72 656c 6174 6976   segment.relativ
-00033920: 6520 3d20 7265 6c61 7469 7665 0d0a 2020  e = relative..  
-00033930: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-00033940: 2020 2020 2020 2020 2073 6567 6d65 6e74           segment
-00033950: 203d 204c 696e 6528 7374 6172 745f 706f   = Line(start_po
-00033960: 732c 2050 6f69 6e74 2878 5f70 6f69 6e74  s, Point(x_point
-00033970: 735b 305d 2c20 7374 6172 745f 706f 732e  s[0], start_pos.
-00033980: 7929 290d 0a20 2020 2020 2020 2020 2020  y))..           
-00033990: 2073 6567 6d65 6e74 2e72 656c 6174 6976   segment.relativ
-000339a0: 6520 3d20 7265 6c61 7469 7665 0d0a 2020  e = relative..  
-000339b0: 2020 2020 2020 7365 6c66 2e61 7070 656e        self.appen
-000339c0: 6428 7365 676d 656e 7429 0d0a 2020 2020  d(segment)..    
-000339d0: 2020 2020 6966 206c 656e 2878 5f70 6f69      if len(x_poi
-000339e0: 6e74 7329 203e 2031 3a0d 0a20 2020 2020  nts) > 1:..     
-000339f0: 2020 2020 2020 2073 656c 662e 686f 7269         self.hori
-00033a00: 7a6f 6e74 616c 282a 785f 706f 696e 7473  zontal(*x_points
-00033a10: 5b31 3a5d 2c20 7265 6c61 7469 7665 3d72  [1:], relative=r
-00033a20: 656c 6174 6976 6529 0d0a 2020 2020 2020  elative)..      
-00033a30: 2020 7265 7475 726e 2073 656c 660d 0a0d    return self...
-00033a40: 0a20 2020 2064 6566 2073 6d6f 6f74 685f  .    def smooth_
-00033a50: 7175 6164 2873 656c 662c 202a 706f 696e  quad(self, *poin
-00033a60: 7473 2c20 2a2a 6b77 6172 6773 293a 0d0a  ts, **kwargs):..
-00033a70: 2020 2020 2020 2020 2222 2253 6d6f 6f74          """Smoot
-00033a80: 6820 6375 7276 652e 2046 6972 7374 2063  h curve. First c
-00033a90: 6f6e 7472 6f6c 2070 6f69 6e74 2069 7320  ontrol point is 
-00033aa0: 7468 6520 2272 6566 6c65 6374 696f 6e22  the "reflection"
-00033ab0: 206f 660d 0a20 2020 2020 2020 2074 6865   of..        the
-00033ac0: 2073 6563 6f6e 6420 636f 6e74 726f 6c20   second control 
-00033ad0: 706f 696e 7420 696e 2074 6865 2070 7265  point in the pre
-00033ae0: 7669 6f75 7320 7061 7468 2e22 2222 0d0a  vious path."""..
-00033af0: 2020 2020 2020 2020 7265 6c61 7469 7665          relative
-00033b00: 203d 206b 7761 7267 735b 2272 656c 6174   = kwargs["relat
-00033b10: 6976 6522 5d20 6966 2022 7265 6c61 7469  ive"] if "relati
-00033b20: 7665 2220 696e 206b 7761 7267 7320 656c  ve" in kwargs el
-00033b30: 7365 2046 616c 7365 0d0a 2020 2020 2020  se False..      
-00033b40: 2020 7374 6172 745f 706f 7320 3d20 7365    start_pos = se
-00033b50: 6c66 2e63 7572 7265 6e74 5f70 6f69 6e74  lf.current_point
-00033b60: 0d0a 2020 2020 2020 2020 636f 6e74 726f  ..        contro
-00033b70: 6c31 203d 2073 656c 662e 736d 6f6f 7468  l1 = self.smooth
-00033b80: 5f70 6f69 6e74 0d0a 2020 2020 2020 2020  _point..        
-00033b90: 656e 645f 706f 7320 3d20 706f 696e 7473  end_pos = points
-00033ba0: 5b30 5d0d 0a20 2020 2020 2020 2069 6620  [0]..        if 
-00033bb0: 656e 645f 706f 7320 696e 2028 227a 222c  end_pos in ("z",
-00033bc0: 2022 5a22 293a 0d0a 2020 2020 2020 2020   "Z"):..        
-00033bd0: 2020 2020 656e 645f 706f 7320 3d20 7365      end_pos = se
-00033be0: 6c66 2e7a 5f70 6f69 6e74 0d0a 2020 2020  lf.z_point..    
-00033bf0: 2020 2020 7365 676d 656e 7420 3d20 5175      segment = Qu
-00033c00: 6164 7261 7469 6342 657a 6965 7228 7374  adraticBezier(st
-00033c10: 6172 745f 706f 732c 2063 6f6e 7472 6f6c  art_pos, control
-00033c20: 312c 2065 6e64 5f70 6f73 290d 0a20 2020  1, end_pos)..   
-00033c30: 2020 2020 2073 6567 6d65 6e74 2e72 656c       segment.rel
-00033c40: 6174 6976 6520 3d20 7265 6c61 7469 7665  ative = relative
-00033c50: 0d0a 2020 2020 2020 2020 7365 676d 656e  ..        segmen
-00033c60: 742e 736d 6f6f 7468 203d 2054 7275 650d  t.smooth = True.
-00033c70: 0a20 2020 2020 2020 2073 656c 662e 6170  .        self.ap
-00033c80: 7065 6e64 2873 6567 6d65 6e74 290d 0a20  pend(segment).. 
-00033c90: 2020 2020 2020 2069 6620 6c65 6e28 706f         if len(po
-00033ca0: 696e 7473 2920 3e20 313a 0d0a 2020 2020  ints) > 1:..    
-00033cb0: 2020 2020 2020 2020 7365 6c66 2e73 6d6f          self.smo
-00033cc0: 6f74 685f 7175 6164 282a 706f 696e 7473  oth_quad(*points
-00033cd0: 5b31 3a5d 290d 0a20 2020 2020 2020 2072  [1:])..        r
-00033ce0: 6574 7572 6e20 7365 6c66 0d0a 0d0a 2020  eturn self....  
-00033cf0: 2020 6465 6620 7175 6164 2873 656c 662c    def quad(self,
-00033d00: 202a 706f 696e 7473 2c20 2a2a 6b77 6172   *points, **kwar
-00033d10: 6773 293a 0d0a 2020 2020 2020 2020 7265  gs):..        re
-00033d20: 6c61 7469 7665 203d 206b 7761 7267 735b  lative = kwargs[
-00033d30: 2272 656c 6174 6976 6522 5d20 6966 2022  "relative"] if "
-00033d40: 7265 6c61 7469 7665 2220 696e 206b 7761  relative" in kwa
-00033d50: 7267 7320 656c 7365 2046 616c 7365 0d0a  rgs else False..
-00033d60: 2020 2020 2020 2020 7374 6172 745f 706f          start_po
-00033d70: 7320 3d20 7365 6c66 2e63 7572 7265 6e74  s = self.current
-00033d80: 5f70 6f69 6e74 0d0a 2020 2020 2020 2020  _point..        
-00033d90: 636f 6e74 726f 6c20 3d20 706f 696e 7473  control = points
-00033da0: 5b30 5d0d 0a20 2020 2020 2020 2069 6620  [0]..        if 
-00033db0: 636f 6e74 726f 6c20 696e 2028 227a 222c  control in ("z",
-00033dc0: 2022 5a22 293a 0d0a 2020 2020 2020 2020   "Z"):..        
-00033dd0: 2020 2020 636f 6e74 726f 6c20 3d20 7365      control = se
-00033de0: 6c66 2e7a 5f70 6f69 6e74 0d0a 2020 2020  lf.z_point..    
-00033df0: 2020 2020 656e 645f 706f 7320 3d20 706f      end_pos = po
-00033e00: 696e 7473 5b31 5d0d 0a20 2020 2020 2020  ints[1]..       
-00033e10: 2069 6620 656e 645f 706f 7320 696e 2028   if end_pos in (
-00033e20: 227a 222c 2022 5a22 293a 0d0a 2020 2020  "z", "Z"):..    
-00033e30: 2020 2020 2020 2020 656e 645f 706f 7320          end_pos 
-00033e40: 3d20 7365 6c66 2e7a 5f70 6f69 6e74 0d0a  = self.z_point..
-00033e50: 2020 2020 2020 2020 7365 676d 656e 7420          segment 
-00033e60: 3d20 5175 6164 7261 7469 6342 657a 6965  = QuadraticBezie
-00033e70: 7228 7374 6172 745f 706f 732c 2063 6f6e  r(start_pos, con
-00033e80: 7472 6f6c 2c20 656e 645f 706f 7329 0d0a  trol, end_pos)..
-00033e90: 2020 2020 2020 2020 7365 676d 656e 742e          segment.
-00033ea0: 7265 6c61 7469 7665 203d 2072 656c 6174  relative = relat
-00033eb0: 6976 650d 0a20 2020 2020 2020 2073 6567  ive..        seg
-00033ec0: 6d65 6e74 2e73 6d6f 6f74 6820 3d20 4661  ment.smooth = Fa
-00033ed0: 6c73 650d 0a20 2020 2020 2020 2073 656c  lse..        sel
-00033ee0: 662e 6170 7065 6e64 2873 6567 6d65 6e74  f.append(segment
-00033ef0: 290d 0a20 2020 2020 2020 2069 6620 6c65  )..        if le
-00033f00: 6e28 706f 696e 7473 2920 3e20 323a 0d0a  n(points) > 2:..
-00033f10: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00033f20: 2e71 7561 6428 2a70 6f69 6e74 735b 323a  .quad(*points[2:
-00033f30: 5d29 0d0a 2020 2020 2020 2020 7265 7475  ])..        retu
-00033f40: 726e 2073 656c 660d 0a0d 0a20 2020 2064  rn self....    d
-00033f50: 6566 2073 6d6f 6f74 685f 6375 6269 6328  ef smooth_cubic(
-00033f60: 7365 6c66 2c20 2a70 6f69 6e74 732c 202a  self, *points, *
-00033f70: 2a6b 7761 7267 7329 3a0d 0a20 2020 2020  *kwargs):..     
-00033f80: 2020 2022 2222 536d 6f6f 7468 2063 7572     """Smooth cur
-00033f90: 7665 2e20 4669 7273 7420 636f 6e74 726f  ve. First contro
-00033fa0: 6c20 706f 696e 7420 6973 2074 6865 2022  l point is the "
-00033fb0: 7265 666c 6563 7469 6f6e 2220 6f66 0d0a  reflection" of..
-00033fc0: 2020 2020 2020 2020 7468 6520 7365 636f          the seco
-00033fd0: 6e64 2063 6f6e 7472 6f6c 2070 6f69 6e74  nd control point
-00033fe0: 2069 6e20 7468 6520 7072 6576 696f 7573   in the previous
-00033ff0: 2070 6174 682e 2222 220d 0a20 2020 2020   path."""..     
-00034000: 2020 2072 656c 6174 6976 6520 3d20 6b77     relative = kw
-00034010: 6172 6773 5b22 7265 6c61 7469 7665 225d  args["relative"]
-00034020: 2069 6620 2272 656c 6174 6976 6522 2069   if "relative" i
-00034030: 6e20 6b77 6172 6773 2065 6c73 6520 4661  n kwargs else Fa
-00034040: 6c73 650d 0a20 2020 2020 2020 2073 7461  lse..        sta
-00034050: 7274 5f70 6f73 203d 2073 656c 662e 6375  rt_pos = self.cu
-00034060: 7272 656e 745f 706f 696e 740d 0a20 2020  rrent_point..   
-00034070: 2020 2020 2063 6f6e 7472 6f6c 3120 3d20       control1 = 
-00034080: 7365 6c66 2e73 6d6f 6f74 685f 706f 696e  self.smooth_poin
-00034090: 740d 0a20 2020 2020 2020 2063 6f6e 7472  t..        contr
-000340a0: 6f6c 3220 3d20 706f 696e 7473 5b30 5d0d  ol2 = points[0].
-000340b0: 0a0d 0a20 2020 2020 2020 2069 6620 636f  ...        if co
-000340c0: 6e74 726f 6c32 2069 6e20 2822 7a22 2c20  ntrol2 in ("z", 
-000340d0: 225a 2229 3a0d 0a20 2020 2020 2020 2020  "Z"):..         
-000340e0: 2020 2063 6f6e 7472 6f6c 3220 3d20 7365     control2 = se
-000340f0: 6c66 2e7a 5f70 6f69 6e74 0d0a 2020 2020  lf.z_point..    
-00034100: 2020 2020 656e 645f 706f 7320 3d20 706f      end_pos = po
-00034110: 696e 7473 5b31 5d0d 0a20 2020 2020 2020  ints[1]..       
-00034120: 2069 6620 656e 645f 706f 7320 696e 2028   if end_pos in (
-00034130: 227a 222c 2022 5a22 293a 0d0a 2020 2020  "z", "Z"):..    
-00034140: 2020 2020 2020 2020 656e 645f 706f 7320          end_pos 
-00034150: 3d20 7365 6c66 2e7a 5f70 6f69 6e74 0d0a  = self.z_point..
-00034160: 2020 2020 2020 2020 7365 676d 656e 7420          segment 
-00034170: 3d20 4375 6269 6342 657a 6965 7228 7374  = CubicBezier(st
-00034180: 6172 745f 706f 732c 2063 6f6e 7472 6f6c  art_pos, control
-00034190: 312c 2063 6f6e 7472 6f6c 322c 2065 6e64  1, control2, end
-000341a0: 5f70 6f73 290d 0a20 2020 2020 2020 2073  _pos)..        s
-000341b0: 6567 6d65 6e74 2e72 656c 6174 6976 6520  egment.relative 
-000341c0: 3d20 7265 6c61 7469 7665 0d0a 2020 2020  = relative..    
-000341d0: 2020 2020 7365 676d 656e 742e 736d 6f6f      segment.smoo
-000341e0: 7468 203d 2054 7275 650d 0a20 2020 2020  th = True..     
-000341f0: 2020 2073 656c 662e 6170 7065 6e64 2873     self.append(s
-00034200: 6567 6d65 6e74 290d 0a20 2020 2020 2020  egment)..       
-00034210: 2069 6620 6c65 6e28 706f 696e 7473 2920   if len(points) 
-00034220: 3e20 323a 0d0a 2020 2020 2020 2020 2020  > 2:..          
-00034230: 2020 7365 6c66 2e73 6d6f 6f74 685f 6375    self.smooth_cu
-00034240: 6269 6328 2a70 6f69 6e74 735b 323a 5d29  bic(*points[2:])
-00034250: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00034260: 2073 656c 660d 0a0d 0a20 2020 2064 6566   self....    def
-00034270: 2063 7562 6963 2873 656c 662c 202a 706f   cubic(self, *po
-00034280: 696e 7473 2c20 2a2a 6b77 6172 6773 293a  ints, **kwargs):
-00034290: 0d0a 2020 2020 2020 2020 7265 6c61 7469  ..        relati
-000342a0: 7665 203d 206b 7761 7267 735b 2272 656c  ve = kwargs["rel
-000342b0: 6174 6976 6522 5d20 6966 2022 7265 6c61  ative"] if "rela
-000342c0: 7469 7665 2220 696e 206b 7761 7267 7320  tive" in kwargs 
-000342d0: 656c 7365 2046 616c 7365 0d0a 2020 2020  else False..    
-000342e0: 2020 2020 7374 6172 745f 706f 7320 3d20      start_pos = 
-000342f0: 7365 6c66 2e63 7572 7265 6e74 5f70 6f69  self.current_poi
-00034300: 6e74 0d0a 2020 2020 2020 2020 636f 6e74  nt..        cont
-00034310: 726f 6c31 203d 2070 6f69 6e74 735b 305d  rol1 = points[0]
-00034320: 0d0a 2020 2020 2020 2020 6966 2063 6f6e  ..        if con
-00034330: 7472 6f6c 3120 696e 2028 227a 222c 2022  trol1 in ("z", "
-00034340: 5a22 293a 0d0a 2020 2020 2020 2020 2020  Z"):..          
-00034350: 2020 636f 6e74 726f 6c31 203d 2073 656c    control1 = sel
-00034360: 662e 7a5f 706f 696e 740d 0a20 2020 2020  f.z_point..     
-00034370: 2020 2063 6f6e 7472 6f6c 3220 3d20 706f     control2 = po
-00034380: 696e 7473 5b31 5d0d 0a20 2020 2020 2020  ints[1]..       
-00034390: 2069 6620 636f 6e74 726f 6c32 2069 6e20   if control2 in 
-000343a0: 2822 7a22 2c20 225a 2229 3a0d 0a20 2020  ("z", "Z"):..   
-000343b0: 2020 2020 2020 2020 2063 6f6e 7472 6f6c           control
-000343c0: 3220 3d20 7365 6c66 2e7a 5f70 6f69 6e74  2 = self.z_point
-000343d0: 0d0a 2020 2020 2020 2020 656e 645f 706f  ..        end_po
-000343e0: 7320 3d20 706f 696e 7473 5b32 5d0d 0a20  s = points[2].. 
-000343f0: 2020 2020 2020 2069 6620 656e 645f 706f         if end_po
-00034400: 7320 696e 2028 227a 222c 2022 5a22 293a  s in ("z", "Z"):
-00034410: 0d0a 2020 2020 2020 2020 2020 2020 656e  ..            en
-00034420: 645f 706f 7320 3d20 7365 6c66 2e7a 5f70  d_pos = self.z_p
-00034430: 6f69 6e74 0d0a 2020 2020 2020 2020 7365  oint..        se
-00034440: 676d 656e 7420 3d20 4375 6269 6342 657a  gment = CubicBez
-00034450: 6965 7228 7374 6172 745f 706f 732c 2063  ier(start_pos, c
-00034460: 6f6e 7472 6f6c 312c 2063 6f6e 7472 6f6c  ontrol1, control
-00034470: 322c 2065 6e64 5f70 6f73 290d 0a20 2020  2, end_pos)..   
-00034480: 2020 2020 2073 6567 6d65 6e74 2e72 656c       segment.rel
-00034490: 6174 6976 6520 3d20 7265 6c61 7469 7665  ative = relative
-000344a0: 0d0a 2020 2020 2020 2020 7365 676d 656e  ..        segmen
-000344b0: 742e 736d 6f6f 7468 203d 2046 616c 7365  t.smooth = False
-000344c0: 0d0a 2020 2020 2020 2020 7365 6c66 2e61  ..        self.a
-000344d0: 7070 656e 6428 7365 676d 656e 7429 0d0a  ppend(segment)..
-000344e0: 2020 2020 2020 2020 6966 206c 656e 2870          if len(p
-000344f0: 6f69 6e74 7329 203e 2033 3a0d 0a20 2020  oints) > 3:..   
-00034500: 2020 2020 2020 2020 2073 656c 662e 6375           self.cu
-00034510: 6269 6328 2a70 6f69 6e74 735b 333a 5d29  bic(*points[3:])
-00034520: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00034530: 2073 656c 660d 0a0d 0a20 2020 2064 6566   self....    def
-00034540: 2061 7263 2873 656c 662c 202a 6172 635f   arc(self, *arc_
-00034550: 6172 6773 2c20 2a2a 6b77 6172 6773 293a  args, **kwargs):
-00034560: 0d0a 2020 2020 2020 2020 7265 6c61 7469  ..        relati
-00034570: 7665 203d 206b 7761 7267 735b 2272 656c  ve = kwargs["rel
-00034580: 6174 6976 6522 5d20 6966 2022 7265 6c61  ative"] if "rela
-00034590: 7469 7665 2220 696e 206b 7761 7267 7320  tive" in kwargs 
-000345a0: 656c 7365 2046 616c 7365 0d0a 2020 2020  else False..    
-000345b0: 2020 2020 7374 6172 745f 706f 7320 3d20      start_pos = 
-000345c0: 7365 6c66 2e63 7572 7265 6e74 5f70 6f69  self.current_poi
-000345d0: 6e74 0d0a 2020 2020 2020 2020 7278 203d  nt..        rx =
-000345e0: 2061 7263 5f61 7267 735b 305d 0d0a 2020   arc_args[0]..  
-000345f0: 2020 2020 2020 7279 203d 2061 7263 5f61        ry = arc_a
-00034600: 7267 735b 315d 0d0a 2020 2020 2020 2020  rgs[1]..        
-00034610: 6966 2072 7820 3c20 303a 0d0a 2020 2020  if rx < 0:..    
-00034620: 2020 2020 2020 2020 7278 203d 2061 6273          rx = abs
-00034630: 2872 7829 0d0a 2020 2020 2020 2020 6966  (rx)..        if
-00034640: 2072 7920 3c20 303a 0d0a 2020 2020 2020   ry < 0:..      
-00034650: 2020 2020 2020 7279 203d 2061 6273 2872        ry = abs(r
-00034660: 7929 0d0a 2020 2020 2020 2020 726f 7461  y)..        rota
-00034670: 7469 6f6e 203d 2061 7263 5f61 7267 735b  tion = arc_args[
-00034680: 325d 0d0a 2020 2020 2020 2020 6172 6320  2]..        arc 
-00034690: 3d20 6172 635f 6172 6773 5b33 5d0d 0a20  = arc_args[3].. 
-000346a0: 2020 2020 2020 2073 7765 6570 203d 2061         sweep = a
-000346b0: 7263 5f61 7267 735b 345d 0d0a 2020 2020  rc_args[4]..    
-000346c0: 2020 2020 656e 645f 706f 7320 3d20 6172      end_pos = ar
-000346d0: 635f 6172 6773 5b35 5d0d 0a20 2020 2020  c_args[5]..     
-000346e0: 2020 2069 6620 656e 645f 706f 7320 696e     if end_pos in
-000346f0: 2028 227a 222c 2022 5a22 293a 0d0a 2020   ("z", "Z"):..  
-00034700: 2020 2020 2020 2020 2020 656e 645f 706f            end_po
-00034710: 7320 3d20 7365 6c66 2e7a 5f70 6f69 6e74  s = self.z_point
-00034720: 0d0a 2020 2020 2020 2020 7365 676d 656e  ..        segmen
-00034730: 7420 3d20 4172 6328 7374 6172 745f 706f  t = Arc(start_po
-00034740: 732c 2072 782c 2072 792c 2072 6f74 6174  s, rx, ry, rotat
-00034750: 696f 6e2c 2061 7263 2c20 7377 6565 702c  ion, arc, sweep,
-00034760: 2065 6e64 5f70 6f73 290d 0a20 2020 2020   end_pos)..     
-00034770: 2020 2073 6567 6d65 6e74 2e72 656c 6174     segment.relat
-00034780: 6976 6520 3d20 7265 6c61 7469 7665 0d0a  ive = relative..
-00034790: 2020 2020 2020 2020 7365 6c66 2e61 7070          self.app
-000347a0: 656e 6428 7365 676d 656e 7429 0d0a 2020  end(segment)..  
-000347b0: 2020 2020 2020 6966 206c 656e 2861 7263        if len(arc
-000347c0: 5f61 7267 7329 203e 2036 3a0d 0a20 2020  _args) > 6:..   
-000347d0: 2020 2020 2020 2020 2073 656c 662e 6172           self.ar
-000347e0: 6328 2a61 7263 5f61 7267 735b 363a 5d29  c(*arc_args[6:])
-000347f0: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00034800: 2073 656c 660d 0a0d 0a20 2020 2064 6566   self....    def
-00034810: 2063 6c6f 7365 6428 7365 6c66 2c20 7265   closed(self, re
-00034820: 6c61 7469 7665 3d46 616c 7365 293a 0d0a  lative=False):..
-00034830: 2020 2020 2020 2020 7374 6172 745f 706f          start_po
-00034840: 7320 3d20 7365 6c66 2e63 7572 7265 6e74  s = self.current
-00034850: 5f70 6f69 6e74 0d0a 2020 2020 2020 2020  _point..        
-00034860: 656e 645f 706f 7320 3d20 7365 6c66 2e7a  end_pos = self.z
-00034870: 5f70 6f69 6e74 0d0a 2020 2020 2020 2020  _point..        
-00034880: 7365 676d 656e 7420 3d20 436c 6f73 6528  segment = Close(
-00034890: 7374 6172 745f 706f 732c 2065 6e64 5f70  start_pos, end_p
-000348a0: 6f73 290d 0a20 2020 2020 2020 2073 6567  os)..        seg
-000348b0: 6d65 6e74 2e72 656c 6174 6976 6520 3d20  ment.relative = 
-000348c0: 7265 6c61 7469 7665 0d0a 2020 2020 2020  relative..      
-000348d0: 2020 7365 6c66 2e61 7070 656e 6428 7365    self.append(se
-000348e0: 676d 656e 7429 0d0a 2020 2020 2020 2020  gment)..        
-000348f0: 7265 7475 726e 2073 656c 660d 0a0d 0a20  return self.... 
-00034900: 2020 2064 6566 2061 7070 656e 6428 7365     def append(se
-00034910: 6c66 2c20 7661 6c75 6529 3a0d 0a20 2020  lf, value):..   
-00034920: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
-00034930: 6365 2876 616c 7565 2c20 7374 7229 3a0d  ce(value, str):.
-00034940: 0a20 2020 2020 2020 2020 2020 2076 616c  .            val
-00034950: 7565 203d 2050 6174 6828 7661 6c75 6529  ue = Path(value)
-00034960: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00034970: 206c 656e 2876 616c 7565 2920 3d3d 2030   len(value) == 0
-00034980: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00034990: 2020 2072 6574 7572 6e0d 0a20 2020 2020     return..     
-000349a0: 2020 2020 2020 2069 6620 6c65 6e28 7661         if len(va
-000349b0: 6c75 6529 203e 2031 3a0d 0a20 2020 2020  lue) > 1:..     
-000349c0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000349d0: 6578 7465 6e64 2876 616c 7565 290d 0a20  extend(value).. 
-000349e0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-000349f0: 6574 7572 6e0d 0a20 2020 2020 2020 2020  eturn..         
-00034a00: 2020 2076 616c 7565 203d 2076 616c 7565     value = value
-00034a10: 5b30 5d0d 0a20 2020 2020 2020 2073 656c  [0]..        sel
-00034a20: 662e 5f6c 656e 6774 6820 3d20 4e6f 6e65  f._length = None
-00034a30: 0d0a 2020 2020 2020 2020 696e 6465 7820  ..        index 
-00034a40: 3d20 6c65 6e28 7365 6c66 2e5f 7365 676d  = len(self._segm
-00034a50: 656e 7473 2920 2d20 310d 0a20 2020 2020  ents) - 1..     
-00034a60: 2020 2073 656c 662e 5f73 6567 6d65 6e74     self._segment
-00034a70: 732e 6170 7065 6e64 2876 616c 7565 290d  s.append(value).
-00034a80: 0a20 2020 2020 2020 2073 656c 662e 5f76  .        self._v
-00034a90: 616c 6964 6174 655f 636f 6e6e 6563 7469  alidate_connecti
-00034aa0: 6f6e 2869 6e64 6578 290d 0a20 2020 2020  on(index)..     
-00034ab0: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-00034ac0: 2876 616c 7565 2c20 436c 6f73 6529 3a0d  (value, Close):.
-00034ad0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00034ae0: 662e 5f76 616c 6964 6174 655f 636c 6f73  f._validate_clos
-00034af0: 6528 696e 6465 7820 2b20 3129 0d0a 0d0a  e(index + 1)....
-00034b00: 2020 2020 6465 6620 696e 7365 7274 2873      def insert(s
-00034b10: 656c 662c 2069 6e64 6578 2c20 7661 6c75  elf, index, valu
-00034b20: 6529 3a0d 0a20 2020 2020 2020 2069 6620  e):..        if 
-00034b30: 6973 696e 7374 616e 6365 2876 616c 7565  isinstance(value
-00034b40: 2c20 7374 7229 3a0d 0a20 2020 2020 2020  , str):..       
-00034b50: 2020 2020 2076 616c 7565 203d 2050 6174       value = Pat
-00034b60: 6828 7661 6c75 6529 0d0a 2020 2020 2020  h(value)..      
-00034b70: 2020 2020 2020 6966 206c 656e 2876 616c        if len(val
-00034b80: 7565 2920 3d3d 2030 3a0d 0a20 2020 2020  ue) == 0:..     
-00034b90: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00034ba0: 6e0d 0a20 2020 2020 2020 2020 2020 2076  n..            v
-00034bb0: 616c 7565 203d 2076 616c 7565 5b30 5d0d  alue = value[0].
-00034bc0: 0a20 2020 2020 2020 2073 656c 662e 5f6c  .        self._l
-00034bd0: 656e 6774 6820 3d20 4e6f 6e65 0d0a 2020  ength = None..  
-00034be0: 2020 2020 2020 7365 6c66 2e5f 7365 676d        self._segm
-00034bf0: 656e 7473 2e69 6e73 6572 7428 696e 6465  ents.insert(inde
-00034c00: 782c 2076 616c 7565 290d 0a20 2020 2020  x, value)..     
-00034c10: 2020 2073 656c 662e 5f76 616c 6964 6174     self._validat
-00034c20: 655f 636f 6e6e 6563 7469 6f6e 2869 6e64  e_connection(ind
-00034c30: 6578 202d 2031 290d 0a20 2020 2020 2020  ex - 1)..       
-00034c40: 2073 656c 662e 5f76 616c 6964 6174 655f   self._validate_
-00034c50: 636f 6e6e 6563 7469 6f6e 2869 6e64 6578  connection(index
-00034c60: 290d 0a20 2020 2020 2020 2069 6620 6973  )..        if is
-00034c70: 696e 7374 616e 6365 2876 616c 7565 2c20  instance(value, 
-00034c80: 4d6f 7665 293a 0d0a 2020 2020 2020 2020  Move):..        
-00034c90: 2020 2020 7365 6c66 2e5f 7661 6c69 6461      self._valida
-00034ca0: 7465 5f6d 6f76 6528 696e 6465 7829 0d0a  te_move(index)..
-00034cb0: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-00034cc0: 7461 6e63 6528 7661 6c75 652c 2043 6c6f  tance(value, Clo
-00034cd0: 7365 293a 0d0a 2020 2020 2020 2020 2020  se):..          
-00034ce0: 2020 7365 6c66 2e5f 7661 6c69 6461 7465    self._validate
-00034cf0: 5f63 6c6f 7365 2869 6e64 6578 290d 0a0d  _close(index)...
-00034d00: 0a20 2020 2064 6566 2065 7874 656e 6428  .    def extend(
-00034d10: 7365 6c66 2c20 6974 6572 6162 6c65 293a  self, iterable):
-00034d20: 0d0a 2020 2020 2020 2020 6966 2069 7369  ..        if isi
-00034d30: 6e73 7461 6e63 6528 6974 6572 6162 6c65  nstance(iterable
-00034d40: 2c20 7374 7229 3a0d 0a20 2020 2020 2020  , str):..       
-00034d50: 2020 2020 2069 7465 7261 626c 6520 3d20       iterable = 
-00034d60: 5061 7468 2869 7465 7261 626c 6529 0d0a  Path(iterable)..
-00034d70: 2020 2020 2020 2020 7365 6c66 2e5f 6c65          self._le
-00034d80: 6e67 7468 203d 204e 6f6e 650d 0a20 2020  ngth = None..   
-00034d90: 2020 2020 2069 6e64 6578 203d 206c 656e       index = len
-00034da0: 2873 656c 662e 5f73 6567 6d65 6e74 7329  (self._segments)
-00034db0: 202d 2031 0d0a 2020 2020 2020 2020 7365   - 1..        se
-00034dc0: 6c66 2e5f 7365 676d 656e 7473 2e65 7874  lf._segments.ext
-00034dd0: 656e 6428 6974 6572 6162 6c65 290d 0a20  end(iterable).. 
-00034de0: 2020 2020 2020 2073 656c 662e 5f76 616c         self._val
-00034df0: 6964 6174 655f 636f 6e6e 6563 7469 6f6e  idate_connection
-00034e00: 2869 6e64 6578 290d 0a20 2020 2020 2020  (index)..       
-00034e10: 2073 656c 662e 5f76 616c 6964 6174 655f   self._validate_
-00034e20: 7375 6270 6174 6828 696e 6465 7829 0d0a  subpath(index)..
-00034e30: 0d0a 2020 2020 6465 6620 6469 7265 6374  ..    def direct
-00034e40: 5f63 6c6f 7365 2873 656c 6629 3a0d 0a20  _close(self):.. 
-00034e50: 2020 2020 2020 2022 2222 466f 7263 6573         """Forces
-00034e60: 2063 6c6f 7365 206f 7065 7261 7469 6f6e   close operation
-00034e70: 7320 746f 2062 6520 7a65 726f 206c 656e  s to be zero len
-00034e80: 6774 6820 6279 2069 6e74 726f 6475 6369  gth by introduci
-00034e90: 6e67 2061 2064 6972 6563 740d 0a20 2020  ng a direct..   
-00034ea0: 2020 2020 206c 696e 6520 746f 206f 7065       line to ope
-00034eb0: 7261 7469 6f6e 206a 7573 7420 6265 666f  ration just befo
-00034ec0: 7265 2061 6e79 206e 6f6e 2d7a 6572 6f20  re any non-zero 
-00034ed0: 6c65 6e67 7468 2063 6c6f 7365 2e0d 0a0d  length close....
-00034ee0: 0a20 2020 2020 2020 2054 6869 7320 6973  .        This is
-00034ef0: 2068 656c 7066 756c 2062 6563 6175 7365   helpful because
-00034f00: 2066 6f72 2073 6f6d 6520 6f70 6572 6174   for some operat
-00034f10: 696f 6e73 206c 696b 6520 7265 7665 7273  ions like revers
-00034f20: 6528 2920 6265 6361 7573 6520 7468 650d  e() because the.
-00034f30: 0a20 2020 2020 2020 2063 6c6f 7365 206d  .        close m
-00034f40: 7573 7420 6c6f 6361 7465 6420 6174 2074  ust located at t
-00034f50: 6865 2076 6572 7920 656e 6420 6f66 2074  he very end of t
-00034f60: 6865 2070 6174 6820 7365 7175 656e 6365  he path sequence
-00034f70: 2e20 4275 742c 2069 6620 6974 2773 0d0a  . But, if it's..
-00034f80: 2020 2020 2020 2020 696e 2065 6666 6563          in effec
-00034f90: 7420 6120 6c69 6e65 2d74 6f20 616e 6420  t a line-to and 
-00034fa0: 636c 6f73 652c 2074 6865 206c 696e 652d  close, the line-
-00034fb0: 746f 2077 6f75 6c64 206e 6565 6420 746f  to would need to
-00034fc0: 2073 7461 7274 2074 6865 2073 6571 7565   start the seque
-00034fd0: 6e63 652e 0d0a 0d0a 2020 2020 2020 2020  nce.....        
-00034fe0: 4275 742c 2066 6f72 2073 6f6d 6520 6f70  But, for some op
-00034ff0: 6572 6174 696f 6e73 2074 6869 7320 776f  erations this wo
-00035000: 6e27 7420 6d61 7474 6572 2073 696e 6365  n't matter since
-00035010: 2069 7420 7769 6c6c 2073 7469 6c6c 2072   it will still r
-00035020: 6573 756c 7420 696e 0d0a 2020 2020 2020  esult in..      
-00035030: 2020 6120 636c 6f73 6564 2073 6861 7065    a closed shape
-00035040: 2077 6974 6820 7265 7665 7273 6564 206f   with reversed o
-00035050: 7264 6572 696e 672e 2042 7574 2c20 6966  rdering. But, if
-00035060: 2074 6865 2066 696e 616c 2070 6f69 6e74   the final point
-00035070: 2069 6e20 7468 650d 0a20 2020 2020 2020   in the..       
-00035080: 2073 6571 7565 6e63 6520 6d75 7374 2065   sequence must e
-00035090: 7861 6374 6c79 2073 7769 7463 6820 7769  xactly switch wi
-000350a0: 7468 2074 6865 2066 6972 7374 2070 6f69  th the first poi
-000350b0: 6e74 2069 6e20 7468 6520 7365 7175 656e  nt in the sequen
-000350c0: 6365 2e20 5468 650d 0a20 2020 2020 2020  ce. The..       
-000350d0: 2063 6c6f 7365 2073 6567 6d65 6e74 7320   close segments 
-000350e0: 6d75 7374 2062 6520 6469 7265 6374 2061  must be direct a
-000350f0: 6e64 207a 6572 6f20 6c65 6e67 7468 2e0d  nd zero length..
-00035100: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
-00035110: 2020 2020 2020 6966 206c 656e 2873 656c        if len(sel
-00035120: 662e 5f73 6567 6d65 6e74 7329 203d 3d20  f._segments) == 
-00035130: 303a 0d0a 2020 2020 2020 2020 2020 2020  0:..            
-00035140: 7265 7475 726e 0d0a 2020 2020 2020 2020  return..        
-00035150: 666f 7220 6920 696e 2072 616e 6765 286c  for i in range(l
-00035160: 656e 2873 656c 662e 5f73 6567 6d65 6e74  en(self._segment
-00035170: 7329 202d 2031 2c20 2d31 2c20 2d31 293a  s) - 1, -1, -1):
-00035180: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00035190: 676d 656e 7420 3d20 7365 6c66 2e5f 7365  gment = self._se
-000351a0: 676d 656e 7473 5b69 5d0d 0a20 2020 2020  gments[i]..     
-000351b0: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-000351c0: 616e 6365 2873 6567 6d65 6e74 2c20 436c  ance(segment, Cl
-000351d0: 6f73 6529 3a0d 0a20 2020 2020 2020 2020  ose):..         
-000351e0: 2020 2020 2020 2069 6620 7365 676d 656e         if segmen
-000351f0: 742e 6c65 6e67 7468 2829 2021 3d20 303a  t.length() != 0:
-00035200: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00035210: 2020 2020 2020 6c69 6e65 203d 204c 696e        line = Lin
-00035220: 6528 7365 676d 656e 742e 7374 6172 742c  e(segment.start,
-00035230: 2073 6567 6d65 6e74 2e65 6e64 290d 0a20   segment.end).. 
-00035240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035250: 2020 2073 6567 6d65 6e74 2e73 7461 7274     segment.start
-00035260: 203d 2050 6f69 6e74 2873 6567 6d65 6e74   = Point(segment
-00035270: 2e65 6e64 290d 0a20 2020 2020 2020 2020  .end)..         
-00035280: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00035290: 696e 7365 7274 2869 2c20 6c69 6e65 290d  insert(i, line).
-000352a0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000352b0: 7365 6c66 0d0a 0d0a 2020 2020 6465 6620  self....    def 
-000352c0: 7265 7665 7273 6528 7365 6c66 293a 0d0a  reverse(self):..
-000352d0: 2020 2020 2020 2020 6966 206c 656e 2873          if len(s
-000352e0: 656c 662e 5f73 6567 6d65 6e74 7329 203d  elf._segments) =
-000352f0: 3d20 303a 0d0a 2020 2020 2020 2020 2020  = 0:..          
-00035300: 2020 7265 7475 726e 0d0a 2020 2020 2020    return..      
-00035310: 2020 7072 6570 6f69 6e74 203d 2073 656c    prepoint = sel
-00035320: 662e 5f73 6567 6d65 6e74 735b 305d 2e73  f._segments[0].s
-00035330: 7461 7274 0d0a 2020 2020 2020 2020 7365  tart..        se
-00035340: 6c66 2e5f 7365 676d 656e 7473 5b30 5d2e  lf._segments[0].
-00035350: 7374 6172 7420 3d20 4e6f 6e65 0d0a 2020  start = None..  
-00035360: 2020 2020 2020 7020 3d20 5061 7468 2829        p = Path()
-00035370: 0d0a 2020 2020 2020 2020 7375 6270 6174  ..        subpat
-00035380: 6873 203d 206c 6973 7428 7365 6c66 2e61  hs = list(self.a
-00035390: 735f 7375 6270 6174 6873 2829 290d 0a20  s_subpaths()).. 
-000353a0: 2020 2020 2020 2066 6f72 2073 7562 7061         for subpa
-000353b0: 7468 2069 6e20 7375 6270 6174 6873 3a0d  th in subpaths:.
-000353c0: 0a20 2020 2020 2020 2020 2020 2073 7562  .            sub
-000353d0: 7061 7468 2e72 6576 6572 7365 2829 0d0a  path.reverse()..
-000353e0: 2020 2020 2020 2020 666f 7220 7375 6270          for subp
-000353f0: 6174 6820 696e 2072 6576 6572 7365 6428  ath in reversed(
-00035400: 7375 6270 6174 6873 293a 0d0a 2020 2020  subpaths):..    
-00035410: 2020 2020 2020 2020 7020 2b3d 2073 7562          p += sub
-00035420: 7061 7468 0d0a 2020 2020 2020 2020 7365  path..        se
-00035430: 6c66 2e5f 7365 676d 656e 7473 203d 2070  lf._segments = p
-00035440: 2e5f 7365 676d 656e 7473 0d0a 2020 2020  ._segments..    
-00035450: 2020 2020 7365 6c66 2e5f 7365 676d 656e      self._segmen
-00035460: 7473 5b30 5d2e 7374 6172 7420 3d20 7072  ts[0].start = pr
-00035470: 6570 6f69 6e74 0d0a 2020 2020 2020 2020  epoint..        
-00035480: 7265 7475 726e 2073 656c 660d 0a0d 0a20  return self.... 
-00035490: 2020 2064 6566 2073 7562 7061 7468 2873     def subpath(s
-000354a0: 656c 662c 2069 6e64 6578 293a 0d0a 2020  elf, index):..  
-000354b0: 2020 2020 2020 7375 6270 6174 6873 203d        subpaths =
-000354c0: 206c 6973 7428 7365 6c66 2e61 735f 7375   list(self.as_su
-000354d0: 6270 6174 6873 2829 290d 0a20 2020 2020  bpaths())..     
-000354e0: 2020 2072 6574 7572 6e20 7375 6270 6174     return subpat
-000354f0: 6873 5b69 6e64 6578 5d0d 0a0d 0a20 2020  hs[index]....   
-00035500: 2064 6566 2063 6f75 6e74 5f73 7562 7061   def count_subpa
-00035510: 7468 7328 7365 6c66 293a 0d0a 2020 2020  ths(self):..    
-00035520: 2020 2020 7375 6270 6174 6873 203d 206c      subpaths = l
-00035530: 6973 7428 7365 6c66 2e61 735f 7375 6270  ist(self.as_subp
-00035540: 6174 6873 2829 290d 0a20 2020 2020 2020  aths())..       
-00035550: 2072 6574 7572 6e20 6c65 6e28 7375 6270   return len(subp
-00035560: 6174 6873 290d 0a0d 0a20 2020 2064 6566  aths)....    def
-00035570: 2061 735f 7375 6270 6174 6873 2873 656c   as_subpaths(sel
-00035580: 6629 3a0d 0a20 2020 2020 2020 2073 7461  f):..        sta
-00035590: 7274 203d 2030 0d0a 2020 2020 2020 2020  rt = 0..        
-000355a0: 666f 7220 6375 7272 656e 742c 2073 6567  for current, seg
-000355b0: 2069 6e20 656e 756d 6572 6174 6528 7365   in enumerate(se
-000355c0: 6c66 293a 0d0a 2020 2020 2020 2020 2020  lf):..          
-000355d0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-000355e0: 7365 672c 204d 6f76 6529 3a0d 0a20 2020  seg, Move):..   
-000355f0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00035600: 6375 7272 656e 7420 213d 2073 7461 7274  current != start
-00035610: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00035620: 2020 2020 2020 2079 6965 6c64 2053 7562         yield Sub
-00035630: 7061 7468 2873 656c 662c 2073 7461 7274  path(self, start
-00035640: 2c20 6375 7272 656e 7420 2d20 3129 0d0a  , current - 1)..
-00035650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035660: 2020 2020 7374 6172 7420 3d20 6375 7272      start = curr
-00035670: 656e 740d 0a20 2020 2020 2020 2020 2020  ent..           
-00035680: 2069 6620 6973 696e 7374 616e 6365 2873   if isinstance(s
-00035690: 6567 2c20 436c 6f73 6529 3a0d 0a20 2020  eg, Close):..   
-000356a0: 2020 2020 2020 2020 2020 2020 2079 6965               yie
-000356b0: 6c64 2053 7562 7061 7468 2873 656c 662c  ld Subpath(self,
-000356c0: 2073 7461 7274 2c20 6375 7272 656e 7429   start, current)
-000356d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000356e0: 2020 7374 6172 7420 3d20 6375 7272 656e    start = curren
-000356f0: 7420 2b20 310d 0a20 2020 2020 2020 2069  t + 1..        i
-00035700: 6620 7374 6172 7420 213d 206c 656e 2873  f start != len(s
-00035710: 656c 6629 3a0d 0a20 2020 2020 2020 2020  elf):..         
-00035720: 2020 2079 6965 6c64 2053 7562 7061 7468     yield Subpath
-00035730: 2873 656c 662c 2073 7461 7274 2c20 6c65  (self, start, le
-00035740: 6e28 7365 6c66 2920 2d20 3129 0d0a 0d0a  n(self) - 1)....
-00035750: 2020 2020 6465 6620 6173 5f70 6f69 6e74      def as_point
-00035760: 7328 7365 6c66 293a 0d0a 2020 2020 2020  s(self):..      
-00035770: 2020 2222 2252 6574 7572 6e73 2074 6865    """Returns the
-00035780: 206c 6973 7420 6f66 2064 6566 696e 696e   list of definin
-00035790: 6720 706f 696e 7473 2077 6974 6869 6e20  g points within 
-000357a0: 7061 7468 2222 220d 0a20 2020 2020 2020  path"""..       
-000357b0: 2066 6f72 2073 6567 2069 6e20 7365 6c66   for seg in self
-000357c0: 3a0d 0a20 2020 2020 2020 2020 2020 2066  :..            f
-000357d0: 6f72 2070 2069 6e20 7365 673a 0d0a 2020  or p in seg:..  
-000357e0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-000357f0: 206e 6f74 2069 7369 6e73 7461 6e63 6528   not isinstance(
-00035800: 702c 2050 6f69 6e74 293a 0d0a 2020 2020  p, Point):..    
-00035810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035820: 7969 656c 6420 506f 696e 7428 7029 0d0a  yield Point(p)..
-00035830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035840: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
-00035850: 2020 2020 2020 2020 2020 2079 6965 6c64             yield
-00035860: 2070 0d0a 0d0a 2020 2020 6465 6620 7265   p....    def re
-00035870: 6966 7928 7365 6c66 293a 0d0a 2020 2020  ify(self):..    
-00035880: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
-00035890: 2052 6561 6c69 7a65 7320 7468 6520 7472   Realizes the tr
-000358a0: 616e 7366 6f72 6d20 746f 2074 6865 2073  ansform to the s
-000358b0: 6861 7065 2070 726f 7065 7274 6965 732e  hape properties.
-000358c0: 0d0a 0d0a 2020 2020 2020 2020 5061 7468  ....        Path
-000358d0: 206f 626a 6563 7473 2072 6569 6679 2070   objects reify p
-000358e0: 6572 6665 6374 6c79 2e0d 0a20 2020 2020  erfectly...     
-000358f0: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
-00035900: 4772 6170 6869 634f 626a 6563 742e 7265  GraphicObject.re
-00035910: 6966 7928 7365 6c66 290d 0a20 2020 2020  ify(self)..     
-00035920: 2020 2054 7261 6e73 666f 726d 6162 6c65     Transformable
-00035930: 2e72 6569 6679 2873 656c 6629 0d0a 2020  .reify(self)..  
-00035940: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-00035950: 6e63 6528 7365 6c66 2e74 7261 6e73 666f  nce(self.transfo
-00035960: 726d 2c20 4d61 7472 6978 293a 0d0a 2020  rm, Matrix):..  
-00035970: 2020 2020 2020 2020 2020 666f 7220 6520            for e 
-00035980: 696e 2073 656c 662e 5f73 6567 6d65 6e74  in self._segment
-00035990: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
-000359a0: 2020 2020 6520 2a3d 2073 656c 662e 7472      e *= self.tr
-000359b0: 616e 7366 6f72 6d0d 0a20 2020 2020 2020  ansform..       
-000359c0: 2073 656c 662e 7472 616e 7366 6f72 6d2e   self.transform.
-000359d0: 7265 7365 7428 290d 0a20 2020 2020 2020  reset()..       
-000359e0: 2072 6574 7572 6e20 7365 6c66 0d0a 0d0a   return self....
-000359f0: 2020 2020 4073 7461 7469 636d 6574 686f      @staticmetho
-00035a00: 640d 0a20 2020 2064 6566 2073 7667 5f64  d..    def svg_d
-00035a10: 2873 6567 6d65 6e74 732c 2072 656c 6174  (segments, relat
-00035a20: 6976 653d 4e6f 6e65 2c20 736d 6f6f 7468  ive=None, smooth
-00035a30: 3d4e 6f6e 6529 3a0d 0a20 2020 2020 2020  =None):..       
-00035a40: 2069 6620 6c65 6e28 7365 676d 656e 7473   if len(segments
-00035a50: 2920 3d3d 2030 3a0d 0a20 2020 2020 2020  ) == 0:..       
-00035a60: 2020 2020 2072 6574 7572 6e20 2222 0d0a       return ""..
-00035a70: 2020 2020 2020 2020 7061 7274 7320 3d20          parts = 
-00035a80: 5b5d 0d0a 2020 2020 2020 2020 7072 6576  []..        prev
-00035a90: 696f 7573 5f73 6567 6d65 6e74 203d 204e  ious_segment = N
-00035aa0: 6f6e 650d 0a20 2020 2020 2020 2070 203d  one..        p =
-00035ab0: 2050 6f69 6e74 2830 290d 0a20 2020 2020   Point(0)..     
-00035ac0: 2020 2069 6620 736d 6f6f 7468 2069 7320     if smooth is 
-00035ad0: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
-00035ae0: 2020 206f 7665 7272 6964 655f 736d 6f6f     override_smoo
-00035af0: 7468 203d 2046 616c 7365 0d0a 2020 2020  th = False..    
-00035b00: 2020 2020 2020 2020 736d 6f6f 7468 5f73          smooth_s
-00035b10: 6574 5f76 616c 7565 203d 2054 7275 650d  et_value = True.
-00035b20: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
-00035b30: 2020 2020 2020 2020 2020 2020 6f76 6572              over
-00035b40: 7269 6465 5f73 6d6f 6f74 6820 3d20 5472  ride_smooth = Tr
-00035b50: 7565 0d0a 2020 2020 2020 2020 2020 2020  ue..            
-00035b60: 736d 6f6f 7468 5f73 6574 5f76 616c 7565  smooth_set_value
-00035b70: 203d 2062 6f6f 6c28 736d 6f6f 7468 290d   = bool(smooth).
-00035b80: 0a20 2020 2020 2020 2069 6620 7265 6c61  .        if rela
-00035b90: 7469 7665 2069 7320 6e6f 7420 4e6f 6e65  tive is not None
-00035ba0: 3a0d 0a20 2020 2020 2020 2020 2020 2066  :..            f
-00035bb0: 6f72 2073 6567 6d65 6e74 2069 6e20 7365  or segment in se
-00035bc0: 676d 656e 7473 3a0d 0a20 2020 2020 2020  gments:..       
-00035bd0: 2020 2020 2020 2020 2069 6620 6973 696e           if isin
-00035be0: 7374 616e 6365 2873 6567 6d65 6e74 2c20  stance(segment, 
-00035bf0: 284d 6f76 652c 204c 696e 652c 2041 7263  (Move, Line, Arc
-00035c00: 2c20 436c 6f73 6529 293a 0d0a 2020 2020  , Close)):..    
-00035c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035c20: 7061 7274 732e 6170 7065 6e64 2873 6567  parts.append(seg
-00035c30: 6d65 6e74 2e64 2870 2c20 7265 6c61 7469  ment.d(p, relati
-00035c40: 7665 3d72 656c 6174 6976 6529 290d 0a20  ve=relative)).. 
-00035c50: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00035c60: 6c69 6620 6973 696e 7374 616e 6365 2873  lif isinstance(s
-00035c70: 6567 6d65 6e74 2c20 2843 7562 6963 4265  egment, (CubicBe
-00035c80: 7a69 6572 2c20 5175 6164 7261 7469 6342  zier, QuadraticB
-00035c90: 657a 6965 7229 293a 0d0a 2020 2020 2020  ezier)):..      
-00035ca0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00035cb0: 2028 6f76 6572 7269 6465 5f73 6d6f 6f74   (override_smoot
-00035cc0: 6820 616e 6420 736d 6f6f 7468 5f73 6574  h and smooth_set
-00035cd0: 5f76 616c 7565 2920 6f72 2028 0d0a 2020  _value) or (..  
-00035ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035cf0: 2020 2020 2020 6e6f 7420 6f76 6572 7269        not overri
-00035d00: 6465 5f73 6d6f 6f74 6820 616e 6420 7365  de_smooth and se
-00035d10: 676d 656e 742e 736d 6f6f 7468 0d0a 2020  gment.smooth..  
-00035d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035d30: 2020 293a 0d0a 2020 2020 2020 2020 2020    ):..          
-00035d40: 2020 2020 2020 2020 2020 2020 2020 7061                pa
-00035d50: 7274 732e 6170 7065 6e64 280d 0a20 2020  rts.append(..   
-00035d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035d70: 2020 2020 2020 2020 2073 6567 6d65 6e74           segment
-00035d80: 2e64 280d 0a20 2020 2020 2020 2020 2020  .d(..           
-00035d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035da0: 2020 2020 2070 2c0d 0a20 2020 2020 2020       p,..       
-00035db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035dc0: 2020 2020 2020 2020 2072 656c 6174 6976           relativ
-00035dd0: 653d 7265 6c61 7469 7665 2c0d 0a20 2020  e=relative,..   
-00035de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035df0: 2020 2020 2020 2020 2020 2020 2073 6d6f               smo
-00035e00: 6f74 683d 7365 676d 656e 742e 6973 5f73  oth=segment.is_s
-00035e10: 6d6f 6f74 685f 6672 6f6d 2870 7265 7669  mooth_from(previ
-00035e20: 6f75 735f 7365 676d 656e 7429 2c0d 0a20  ous_segment),.. 
-00035e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035e40: 2020 2020 2020 2020 2020 2029 0d0a 2020             )..  
-00035e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035e60: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
-00035e70: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-00035e80: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00035e90: 2020 2020 2020 2020 2020 2020 7061 7274              part
-00035ea0: 732e 6170 7065 6e64 2873 6567 6d65 6e74  s.append(segment
-00035eb0: 2e64 2870 2c20 7265 6c61 7469 7665 3d72  .d(p, relative=r
-00035ec0: 656c 6174 6976 652c 2073 6d6f 6f74 683d  elative, smooth=
-00035ed0: 4661 6c73 6529 290d 0a20 2020 2020 2020  False))..       
-00035ee0: 2020 2020 2020 2020 2070 7265 7669 6f75           previou
-00035ef0: 735f 7365 676d 656e 7420 3d20 7365 676d  s_segment = segm
-00035f00: 656e 740d 0a20 2020 2020 2020 2020 2020  ent..           
-00035f10: 2020 2020 2070 203d 2070 7265 7669 6f75       p = previou
-00035f20: 735f 7365 676d 656e 742e 656e 640d 0a20  s_segment.end.. 
-00035f30: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-00035f40: 2020 2020 2020 2020 2020 666f 7220 7365            for se
-00035f50: 676d 656e 7420 696e 2073 6567 6d65 6e74  gment in segment
-00035f60: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
-00035f70: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-00035f80: 6528 7365 676d 656e 742c 2028 4d6f 7665  e(segment, (Move
-00035f90: 2c20 4c69 6e65 2c20 4172 632c 2043 6c6f  , Line, Arc, Clo
-00035fa0: 7365 2929 3a0d 0a20 2020 2020 2020 2020  se)):..         
-00035fb0: 2020 2020 2020 2020 2020 2070 6172 7473             parts
-00035fc0: 2e61 7070 656e 6428 7365 676d 656e 742e  .append(segment.
-00035fd0: 6428 702c 2072 656c 6174 6976 653d 7365  d(p, relative=se
-00035fe0: 676d 656e 742e 7265 6c61 7469 7665 2929  gment.relative))
-00035ff0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00036000: 2020 656c 6966 2069 7369 6e73 7461 6e63    elif isinstanc
-00036010: 6528 7365 676d 656e 742c 2028 4375 6269  e(segment, (Cubi
-00036020: 6342 657a 6965 722c 2051 7561 6472 6174  cBezier, Quadrat
-00036030: 6963 4265 7a69 6572 2929 3a0d 0a20 2020  icBezier)):..   
-00036040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00036050: 2069 6620 286f 7665 7272 6964 655f 736d   if (override_sm
-00036060: 6f6f 7468 2061 6e64 2073 6d6f 6f74 685f  ooth and smooth_
-00036070: 7365 745f 7661 6c75 6529 206f 7220 280d  set_value) or (.
-00036080: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00036090: 2020 2020 2020 2020 206e 6f74 206f 7665           not ove
-000360a0: 7272 6964 655f 736d 6f6f 7468 2061 6e64  rride_smooth and
-000360b0: 2073 6567 6d65 6e74 2e73 6d6f 6f74 680d   segment.smooth.
-000360c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000360d0: 2020 2020 2029 3a0d 0a20 2020 2020 2020       ):..       
-000360e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000360f0: 2070 6172 7473 2e61 7070 656e 6428 0d0a   parts.append(..
-00036100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00036110: 2020 2020 2020 2020 2020 2020 7365 676d              segm
-00036120: 656e 742e 6428 0d0a 2020 2020 2020 2020  ent.d(..        
-00036130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00036140: 2020 2020 2020 2020 702c 0d0a 2020 2020          p,..    
-00036150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00036160: 2020 2020 2020 2020 2020 2020 7265 6c61              rela
-00036170: 7469 7665 3d73 6567 6d65 6e74 2e72 656c  tive=segment.rel
-00036180: 6174 6976 652c 0d0a 2020 2020 2020 2020  ative,..        
-00036190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000361a0: 2020 2020 2020 2020 736d 6f6f 7468 3d73          smooth=s
-000361b0: 6567 6d65 6e74 2e69 735f 736d 6f6f 7468  egment.is_smooth
-000361c0: 5f66 726f 6d28 7072 6576 696f 7573 5f73  _from(previous_s
-000361d0: 6567 6d65 6e74 292c 0d0a 2020 2020 2020  egment),..      
-000361e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000361f0: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
-00036200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00036210: 2029 0d0a 2020 2020 2020 2020 2020 2020   )..            
-00036220: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-00036230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00036240: 2020 2020 2020 2070 6172 7473 2e61 7070         parts.app
-00036250: 656e 6428 0d0a 2020 2020 2020 2020 2020  end(..          
-00036260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00036270: 2020 7365 676d 656e 742e 6428 702c 2072    segment.d(p, r
-00036280: 656c 6174 6976 653d 7365 676d 656e 742e  elative=segment.
-00036290: 7265 6c61 7469 7665 2c20 736d 6f6f 7468  relative, smooth
-000362a0: 3d46 616c 7365 290d 0a20 2020 2020 2020  =False)..       
-000362b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000362c0: 2029 0d0a 2020 2020 2020 2020 2020 2020   )..            
-000362d0: 2020 2020 7072 6576 696f 7573 5f73 6567      previous_seg
-000362e0: 6d65 6e74 203d 2073 6567 6d65 6e74 0d0a  ment = segment..
-000362f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00036300: 7020 3d20 7072 6576 696f 7573 5f73 6567  p = previous_seg
-00036310: 6d65 6e74 2e65 6e64 0d0a 2020 2020 2020  ment.end..      
-00036320: 2020 7265 7475 726e 2022 2022 2e6a 6f69    return " ".joi
-00036330: 6e28 7061 7274 7329 0d0a 0d0a 2020 2020  n(parts)....    
-00036340: 6465 6620 6428 7365 6c66 2c20 7265 6c61  def d(self, rela
-00036350: 7469 7665 3d4e 6f6e 652c 2074 7261 6e73  tive=None, trans
-00036360: 666f 726d 6564 3d54 7275 652c 2073 6d6f  formed=True, smo
-00036370: 6f74 683d 4e6f 6e65 293a 0d0a 2020 2020  oth=None):..    
-00036380: 2020 2020 7061 7468 203d 2073 656c 660d      path = self.
-00036390: 0a20 2020 2020 2020 2069 6620 7472 616e  .        if tran
-000363a0: 7366 6f72 6d65 643a 0d0a 2020 2020 2020  sformed:..      
-000363b0: 2020 2020 2020 7061 7468 203d 2061 6273        path = abs
-000363c0: 2870 6174 6829 0d0a 2020 2020 2020 2020  (path)..        
-000363d0: 7265 7475 726e 2050 6174 682e 7376 675f  return Path.svg_
-000363e0: 6428 7061 7468 2e5f 7365 676d 656e 7473  d(path._segments
-000363f0: 2c20 7265 6c61 7469 7665 3d72 656c 6174  , relative=relat
-00036400: 6976 652c 2073 6d6f 6f74 683d 736d 6f6f  ive, smooth=smoo
-00036410: 7468 290d 0a0d 0a20 2020 2064 6566 2073  th)....    def s
-00036420: 6567 6d65 6e74 7328 7365 6c66 2c20 7472  egments(self, tr
-00036430: 616e 7366 6f72 6d65 643d 5472 7565 293a  ansformed=True):
-00036440: 0d0a 2020 2020 2020 2020 6966 2074 7261  ..        if tra
-00036450: 6e73 666f 726d 6564 2061 6e64 206e 6f74  nsformed and not
-00036460: 2073 656c 662e 7472 616e 7366 6f72 6d2e   self.transform.
-00036470: 6973 5f69 6465 6e74 6974 7928 293a 0d0a  is_identity():..
-00036480: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00036490: 726e 205b 7320 2a20 7365 6c66 2e74 7261  rn [s * self.tra
-000364a0: 6e73 666f 726d 2066 6f72 2073 2069 6e20  nsform for s in 
-000364b0: 7365 6c66 2e5f 7365 676d 656e 7473 5d0d  self._segments].
-000364c0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000364d0: 7365 6c66 2e5f 7365 676d 656e 7473 0d0a  self._segments..
-000364e0: 0d0a 2020 2020 6465 6620 6170 7072 6f78  ..    def approx
-000364f0: 696d 6174 655f 6172 6373 5f77 6974 685f  imate_arcs_with_
-00036500: 6375 6269 6373 2873 656c 662c 2065 7272  cubics(self, err
-00036510: 6f72 3d30 2e31 293a 0d0a 2020 2020 2020  or=0.1):..      
-00036520: 2020 2222 220d 0a20 2020 2020 2020 2049    """..        I
-00036530: 7465 7261 7465 7320 7468 726f 7567 6820  terates through 
-00036540: 7468 6973 2070 6174 6820 616e 6420 7265  this path and re
-00036550: 706c 6163 6573 2061 6e79 2041 7263 7320  places any Arcs 
-00036560: 7769 7468 2063 7562 6963 2062 657a 6965  with cubic bezie
-00036570: 7220 6375 7276 6573 2e0d 0a20 2020 2020  r curves...     
-00036580: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
-00036590: 7377 6565 705f 6c69 6d69 7420 3d20 7461  sweep_limit = ta
-000365a0: 7520 2a20 6572 726f 720d 0a20 2020 2020  u * error..     
-000365b0: 2020 2066 6f72 2073 2069 6e20 7261 6e67     for s in rang
-000365c0: 6528 6c65 6e28 7365 6c66 2920 2d20 312c  e(len(self) - 1,
-000365d0: 202d 312c 202d 3129 3a0d 0a20 2020 2020   -1, -1):..     
-000365e0: 2020 2020 2020 2073 6567 6d65 6e74 203d         segment =
-000365f0: 2073 656c 665b 735d 0d0a 2020 2020 2020   self[s]..      
-00036600: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-00036610: 6e63 6528 7365 676d 656e 742c 2041 7263  nce(segment, Arc
-00036620: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00036630: 2020 2020 6172 635f 7265 7175 6972 6564      arc_required
-00036640: 203d 2069 6e74 2863 6569 6c28 6162 7328   = int(ceil(abs(
-00036650: 7365 676d 656e 742e 7377 6565 7029 202f  segment.sweep) /
-00036660: 2073 7765 6570 5f6c 696d 6974 2929 0d0a   sweep_limit))..
-00036670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00036680: 7365 6c66 5b73 203a 2073 202b 2031 5d20  self[s : s + 1] 
-00036690: 3d20 6c69 7374 2873 6567 6d65 6e74 2e61  = list(segment.a
-000366a0: 735f 6375 6269 635f 6375 7276 6573 2861  s_cubic_curves(a
-000366b0: 7263 5f72 6571 7569 7265 6429 290d 0a0d  rc_required))...
-000366c0: 0a20 2020 2064 6566 2061 7070 726f 7869  .    def approxi
-000366d0: 6d61 7465 5f61 7263 735f 7769 7468 5f71  mate_arcs_with_q
-000366e0: 7561 6473 2873 656c 662c 2065 7272 6f72  uads(self, error
-000366f0: 3d30 2e31 293a 0d0a 2020 2020 2020 2020  =0.1):..        
-00036700: 2222 220d 0a20 2020 2020 2020 2049 7465  """..        Ite
-00036710: 7261 7465 7320 7468 726f 7567 6820 7468  rates through th
-00036720: 6973 2070 6174 6820 616e 6420 7265 706c  is path and repl
-00036730: 6163 6573 2061 6e79 2041 7263 7320 7769  aces any Arcs wi
-00036740: 7468 2071 7561 6472 6174 6963 2062 657a  th quadratic bez
-00036750: 6965 7220 6375 7276 6573 2e0d 0a20 2020  ier curves...   
-00036760: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
-00036770: 2020 7377 6565 705f 6c69 6d69 7420 3d20    sweep_limit = 
-00036780: 7461 7520 2a20 6572 726f 720d 0a20 2020  tau * error..   
-00036790: 2020 2020 2066 6f72 2073 2069 6e20 7261       for s in ra
-000367a0: 6e67 6528 6c65 6e28 7365 6c66 2920 2d20  nge(len(self) - 
-000367b0: 312c 202d 312c 202d 3129 3a0d 0a20 2020  1, -1, -1):..   
-000367c0: 2020 2020 2020 2020 2073 6567 6d65 6e74           segment
-000367d0: 203d 2073 656c 665b 735d 0d0a 2020 2020   = self[s]..    
-000367e0: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-000367f0: 7461 6e63 6528 7365 676d 656e 742c 2041  tance(segment, A
-00036800: 7263 293a 0d0a 2020 2020 2020 2020 2020  rc):..          
-00036810: 2020 2020 2020 6172 635f 7265 7175 6972        arc_requir
-00036820: 6564 203d 2069 6e74 2863 6569 6c28 6162  ed = int(ceil(ab
-00036830: 7328 7365 676d 656e 742e 7377 6565 7029  s(segment.sweep)
-00036840: 202f 2073 7765 6570 5f6c 696d 6974 2929   / sweep_limit))
-00036850: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00036860: 2020 7365 6c66 5b73 203a 2073 202b 2031    self[s : s + 1
-00036870: 5d20 3d20 6c69 7374 2873 6567 6d65 6e74  ] = list(segment
-00036880: 2e61 735f 7175 6164 5f63 7572 7665 7328  .as_quad_curves(
-00036890: 6172 635f 7265 7175 6972 6564 2929 0d0a  arc_required))..
-000368a0: 0d0a 2020 2020 6465 6620 6170 7072 6f78  ..    def approx
-000368b0: 696d 6174 655f 6265 7a69 6572 5f77 6974  imate_bezier_wit
-000368c0: 685f 6369 7263 756c 6172 5f61 7263 7328  h_circular_arcs(
-000368d0: 7365 6c66 2c20 6572 726f 723d 302e 3031  self, error=0.01
-000368e0: 293a 0d0a 2020 2020 2020 2020 2222 220d  ):..        """.
-000368f0: 0a20 2020 2020 2020 2049 7465 7261 7465  .        Iterate
-00036900: 7320 7468 726f 7567 6820 7468 6973 2070  s through this p
-00036910: 6174 6820 616e 6420 7265 706c 6163 6573  ath and replaces
-00036920: 2061 6e79 2062 657a 6965 7220 6375 7276   any bezier curv
-00036930: 6573 2077 6974 6820 6369 7263 756c 6172  es with circular
-00036940: 2061 7263 732e 0d0a 2020 2020 2020 2020   arcs...        
-00036950: 2222 220d 0a20 2020 2020 2020 2066 6f72  """..        for
-00036960: 2073 2069 6e20 7261 6e67 6528 6c65 6e28   s in range(len(
-00036970: 7365 6c66 2920 2d20 312c 202d 312c 202d  self) - 1, -1, -
-00036980: 3129 3a0d 0a20 2020 2020 2020 2020 2020  1):..           
-00036990: 2073 6567 6d65 6e74 203d 2073 656c 665b   segment = self[
-000369a0: 735d 0d0a 2020 2020 2020 2020 2020 2020  s]..            
-000369b0: 6966 2069 7369 6e73 7461 6e63 6528 7365  if isinstance(se
-000369c0: 676d 656e 742c 2028 5175 6164 7261 7469  gment, (Quadrati
-000369d0: 6342 657a 6965 722c 2043 7562 6963 4265  cBezier, CubicBe
-000369e0: 7a69 6572 2929 3a0d 0a20 2020 2020 2020  zier)):..       
-000369f0: 2020 2020 2020 2020 2073 656c 665b 7320           self[s 
-00036a00: 3a20 7320 2b20 315d 203d 206c 6973 7428  : s + 1] = list(
-00036a10: 7365 676d 656e 742e 6173 5f63 6972 6375  segment.as_circu
-00036a20: 6c61 725f 6172 6373 2865 7272 6f72 3d65  lar_arcs(error=e
-00036a30: 7272 6f72 2929 0d0a 0d0a 0d0a 636c 6173  rror))......clas
-00036a40: 7320 5265 6374 2853 6861 7065 293a 0d0a  s Rect(Shape):..
-00036a50: 2020 2020 2222 220d 0a20 2020 2053 5647      """..    SVG
-00036a60: 2052 6563 7420 7368 6170 6573 2061 7265   Rect shapes are
-00036a70: 2064 6566 696e 6564 2069 6e20 5356 4732   defined in SVG2
-00036a80: 2031 302e 320d 0a20 2020 2068 7474 7073   10.2..    https
-00036a90: 3a2f 2f77 7777 2e77 332e 6f72 672f 5452  ://www.w3.org/TR
-00036aa0: 2f53 5647 322f 7368 6170 6573 2e68 746d  /SVG2/shapes.htm
-00036ab0: 6c23 5265 6374 456c 656d 656e 740d 0a0d  l#RectElement...
-00036ac0: 0a20 2020 2054 6865 7365 2068 6176 6520  .    These have 
-00036ad0: 6765 6f6d 6574 7269 6320 7072 6f70 6572  geometric proper
-00036ae0: 7469 6573 2078 2c20 792c 2077 6964 7468  ties x, y, width
-00036af0: 2c20 6865 6967 6874 2c20 7278 2c20 7279  , height, rx, ry
-00036b00: 0d0a 2020 2020 4765 6f6d 6574 7269 6320  ..    Geometric 
-00036b10: 7072 6f70 6572 7469 6573 2063 616e 2062  properties can b
-00036b20: 6520 4c65 6e67 7468 2076 616c 7565 732e  e Length values.
-00036b30: 0d0a 0d0a 2020 2020 5265 6374 2878 2c20  ....    Rect(x, 
-00036b40: 792c 2077 6964 7468 2c20 6865 6967 6874  y, width, height
-00036b50: 290d 0a20 2020 2052 6563 7428 782c 2079  )..    Rect(x, y
-00036b60: 2c20 7769 6474 682c 2068 6569 6768 742c  , width, height,
-00036b70: 2072 782c 2072 7929 0d0a 2020 2020 5265   rx, ry)..    Re
-00036b80: 6374 2878 2c20 792c 2077 6964 7468 2c20  ct(x, y, width, 
-00036b90: 6865 6967 6874 2c20 7278 2c20 7279 2c20  height, rx, ry, 
-00036ba0: 6d61 7472 6978 290d 0a20 2020 2052 6563  matrix)..    Rec
-00036bb0: 7428 782c 2079 2c20 7769 6474 682c 2068  t(x, y, width, h
-00036bc0: 6569 6768 742c 2072 782c 2072 792c 206d  eight, rx, ry, m
-00036bd0: 6174 7269 782c 2073 7472 6f6b 652c 2066  atrix, stroke, f
-00036be0: 696c 6c29 0d0a 0d0a 2020 2020 5265 6374  ill)....    Rect
-00036bf0: 2864 6963 7429 3a20 6469 6374 696f 6e61  (dict): dictiona
-00036c00: 7279 2076 616c 7565 7320 7265 6164 2066  ry values read f
-00036c10: 726f 6d20 7376 672e 0d0a 0d0a 2020 2020  rom svg.....    
-00036c20: 2222 220d 0a0d 0a20 2020 2064 6566 205f  """....    def _
-00036c30: 5f69 6e69 745f 5f28 7365 6c66 2c20 2a61  _init__(self, *a
-00036c40: 7267 732c 202a 2a6b 7761 7267 7329 3a0d  rgs, **kwargs):.
-00036c50: 0a20 2020 2020 2020 2073 656c 662e 7820  .        self.x 
-00036c60: 3d20 4e6f 6e65 0d0a 2020 2020 2020 2020  = None..        
-00036c70: 7365 6c66 2e79 203d 204e 6f6e 650d 0a20  self.y = None.. 
-00036c80: 2020 2020 2020 2073 656c 662e 7769 6474         self.widt
-00036c90: 6820 3d20 4e6f 6e65 0d0a 2020 2020 2020  h = None..      
-00036ca0: 2020 7365 6c66 2e68 6569 6768 7420 3d20    self.height = 
-00036cb0: 4e6f 6e65 0d0a 2020 2020 2020 2020 7365  None..        se
-00036cc0: 6c66 2e72 7820 3d20 4e6f 6e65 0d0a 2020  lf.rx = None..  
-00036cd0: 2020 2020 2020 7365 6c66 2e72 7920 3d20        self.ry = 
-00036ce0: 4e6f 6e65 0d0a 2020 2020 2020 2020 5368  None..        Sh
-00036cf0: 6170 652e 5f5f 696e 6974 5f5f 2873 656c  ape.__init__(sel
-00036d00: 662c 202a 6172 6773 2c20 2a2a 6b77 6172  f, *args, **kwar
-00036d10: 6773 290d 0a20 2020 2020 2020 2073 656c  gs)..        sel
-00036d20: 662e 5f76 616c 6964 6174 655f 7265 6374  f._validate_rect
-00036d30: 2829 0d0a 0d0a 2020 2020 6465 6620 7072  ()....    def pr
-00036d40: 6f70 6572 7479 5f62 795f 6f62 6a65 6374  operty_by_object
-00036d50: 2873 656c 662c 2073 293a 0d0a 2020 2020  (self, s):..    
-00036d60: 2020 2020 5368 6170 652e 7072 6f70 6572      Shape.proper
-00036d70: 7479 5f62 795f 6f62 6a65 6374 2873 656c  ty_by_object(sel
-00036d80: 662c 2073 290d 0a20 2020 2020 2020 2073  f, s)..        s
-00036d90: 656c 662e 7820 3d20 732e 780d 0a20 2020  elf.x = s.x..   
-00036da0: 2020 2020 2073 656c 662e 7920 3d20 732e       self.y = s.
-00036db0: 790d 0a20 2020 2020 2020 2073 656c 662e  y..        self.
-00036dc0: 7769 6474 6820 3d20 732e 7769 6474 680d  width = s.width.
-00036dd0: 0a20 2020 2020 2020 2073 656c 662e 6865  .        self.he
-00036de0: 6967 6874 203d 2073 2e68 6569 6768 740d  ight = s.height.
-00036df0: 0a20 2020 2020 2020 2073 656c 662e 7278  .        self.rx
-00036e00: 203d 2073 2e72 780d 0a20 2020 2020 2020   = s.rx..       
-00036e10: 2073 656c 662e 7279 203d 2073 2e72 790d   self.ry = s.ry.
-00036e20: 0a20 2020 2020 2020 2073 656c 662e 5f76  .        self._v
-00036e30: 616c 6964 6174 655f 7265 6374 2829 0d0a  alidate_rect()..
-00036e40: 0d0a 2020 2020 6465 6620 7072 6f70 6572  ..    def proper
-00036e50: 7479 5f62 795f 7661 6c75 6573 2873 656c  ty_by_values(sel
-00036e60: 662c 2076 616c 7565 7329 3a0d 0a20 2020  f, values):..   
-00036e70: 2020 2020 2053 6861 7065 2e70 726f 7065       Shape.prope
-00036e80: 7274 795f 6279 5f76 616c 7565 7328 7365  rty_by_values(se
-00036e90: 6c66 2c20 7661 6c75 6573 290d 0a20 2020  lf, values)..   
-00036ea0: 2020 2020 2073 656c 662e 7820 3d20 4c65       self.x = Le
-00036eb0: 6e67 7468 2876 616c 7565 732e 6765 7428  ngth(values.get(
-00036ec0: 5356 475f 4154 5452 5f58 2c20 3029 292e  SVG_ATTR_X, 0)).
-00036ed0: 7661 6c75 6528 290d 0a20 2020 2020 2020  value()..       
-00036ee0: 2073 656c 662e 7920 3d20 4c65 6e67 7468   self.y = Length
-00036ef0: 2876 616c 7565 732e 6765 7428 5356 475f  (values.get(SVG_
-00036f00: 4154 5452 5f59 2c20 3029 292e 7661 6c75  ATTR_Y, 0)).valu
-00036f10: 6528 290d 0a20 2020 2020 2020 2073 656c  e()..        sel
-00036f20: 662e 7769 6474 6820 3d20 4c65 6e67 7468  f.width = Length
-00036f30: 2876 616c 7565 732e 6765 7428 5356 475f  (values.get(SVG_
-00036f40: 4154 5452 5f57 4944 5448 2c20 3129 292e  ATTR_WIDTH, 1)).
-00036f50: 7661 6c75 6528 290d 0a20 2020 2020 2020  value()..       
-00036f60: 2073 656c 662e 6865 6967 6874 203d 204c   self.height = L
-00036f70: 656e 6774 6828 7661 6c75 6573 2e67 6574  ength(values.get
-00036f80: 2853 5647 5f41 5454 525f 4845 4947 4854  (SVG_ATTR_HEIGHT
-00036f90: 2c20 3129 292e 7661 6c75 6528 290d 0a20  , 1)).value().. 
-00036fa0: 2020 2020 2020 2073 656c 662e 7278 203d         self.rx =
-00036fb0: 204c 656e 6774 6828 7661 6c75 6573 2e67   Length(values.g
-00036fc0: 6574 2853 5647 5f41 5454 525f 5241 4449  et(SVG_ATTR_RADI
-00036fd0: 5553 5f58 2c20 4e6f 6e65 2929 2e76 616c  US_X, None)).val
-00036fe0: 7565 2829 0d0a 2020 2020 2020 2020 7365  ue()..        se
-00036ff0: 6c66 2e72 7920 3d20 4c65 6e67 7468 2876  lf.ry = Length(v
-00037000: 616c 7565 732e 6765 7428 5356 475f 4154  alues.get(SVG_AT
-00037010: 5452 5f52 4144 4955 535f 592c 204e 6f6e  TR_RADIUS_Y, Non
-00037020: 6529 292e 7661 6c75 6528 290d 0a0d 0a20  e)).value().... 
-00037030: 2020 2064 6566 2070 726f 7065 7274 795f     def property_
-00037040: 6279 5f61 7267 7328 7365 6c66 2c20 2a61  by_args(self, *a
-00037050: 7267 7329 3a0d 0a20 2020 2020 2020 2061  rgs):..        a
-00037060: 7267 5f6c 656e 6774 6820 3d20 6c65 6e28  rg_length = len(
-00037070: 6172 6773 290d 0a20 2020 2020 2020 2069  args)..        i
-00037080: 6620 6172 675f 6c65 6e67 7468 203e 3d20  f arg_length >= 
-00037090: 313a 0d0a 2020 2020 2020 2020 2020 2020  1:..            
-000370a0: 7365 6c66 2e78 203d 204c 656e 6774 6828  self.x = Length(
-000370b0: 6172 6773 5b30 5d29 2e76 616c 7565 2829  args[0]).value()
-000370c0: 0d0a 2020 2020 2020 2020 6966 2061 7267  ..        if arg
-000370d0: 5f6c 656e 6774 6820 3e3d 2032 3a0d 0a20  _length >= 2:.. 
-000370e0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000370f0: 7920 3d20 4c65 6e67 7468 2861 7267 735b  y = Length(args[
-00037100: 315d 292e 7661 6c75 6528 290d 0a20 2020  1]).value()..   
-00037110: 2020 2020 2069 6620 6172 675f 6c65 6e67       if arg_leng
-00037120: 7468 203e 3d20 333a 0d0a 2020 2020 2020  th >= 3:..      
-00037130: 2020 2020 2020 7365 6c66 2e77 6964 7468        self.width
-00037140: 203d 204c 656e 6774 6828 6172 6773 5b32   = Length(args[2
-00037150: 5d29 2e76 616c 7565 2829 0d0a 2020 2020  ]).value()..    
-00037160: 2020 2020 6966 2061 7267 5f6c 656e 6774      if arg_lengt
-00037170: 6820 3e3d 2034 3a0d 0a20 2020 2020 2020  h >= 4:..       
-00037180: 2020 2020 2073 656c 662e 6865 6967 6874       self.height
-00037190: 203d 204c 656e 6774 6828 6172 6773 5b33   = Length(args[3
-000371a0: 5d29 2e76 616c 7565 2829 0d0a 2020 2020  ]).value()..    
-000371b0: 2020 2020 6966 2061 7267 5f6c 656e 6774      if arg_lengt
-000371c0: 6820 3e3d 2035 3a0d 0a20 2020 2020 2020  h >= 5:..       
-000371d0: 2020 2020 2073 656c 662e 7278 203d 204c       self.rx = L
-000371e0: 656e 6774 6828 6172 6773 5b34 5d29 2e76  ength(args[4]).v
-000371f0: 616c 7565 2829 0d0a 2020 2020 2020 2020  alue()..        
-00037200: 6966 2061 7267 5f6c 656e 6774 6820 3e3d  if arg_length >=
-00037210: 2036 3a0d 0a20 2020 2020 2020 2020 2020   6:..           
-00037220: 2073 656c 662e 7279 203d 204c 656e 6774   self.ry = Lengt
-00037230: 6828 6172 6773 5b35 5d29 2e76 616c 7565  h(args[5]).value
-00037240: 2829 0d0a 2020 2020 2020 2020 6966 2061  ()..        if a
-00037250: 7267 5f6c 656e 6774 6820 3e3d 2037 3a0d  rg_length >= 7:.
-00037260: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00037270: 662e 5f69 6e69 745f 7368 6170 6528 2a61  f._init_shape(*a
-00037280: 7267 735b 363a 5d29 0d0a 0d0a 2020 2020  rgs[6:])....    
-00037290: 6465 6620 5f76 616c 6964 6174 655f 7265  def _validate_re
-000372a0: 6374 2873 656c 6629 3a0d 0a20 2020 2020  ct(self):..     
-000372b0: 2020 2022 2222 4e6f 6e65 2069 7320 2761     """None is 'a
-000372c0: 7574 6f27 2066 6f72 2076 616c 7565 732e  uto' for values.
-000372d0: 2222 220d 0a20 2020 2020 2020 2072 7820  """..        rx 
-000372e0: 3d20 7365 6c66 2e72 780d 0a20 2020 2020  = self.rx..     
-000372f0: 2020 2072 7920 3d20 7365 6c66 2e72 790d     ry = self.ry.
-00037300: 0a20 2020 2020 2020 2069 6620 7278 2069  .        if rx i
-00037310: 7320 4e6f 6e65 2061 6e64 2072 7920 6973  s None and ry is
-00037320: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
-00037330: 2020 2020 7278 203d 2072 7920 3d20 300d      rx = ry = 0.
-00037340: 0a20 2020 2020 2020 2069 6620 7278 2069  .        if rx i
-00037350: 7320 6e6f 7420 4e6f 6e65 2061 6e64 2072  s not None and r
-00037360: 7920 6973 204e 6f6e 653a 0d0a 2020 2020  y is None:..    
-00037370: 2020 2020 2020 2020 7278 203d 204c 656e          rx = Len
-00037380: 6774 6828 7278 292e 7661 6c75 6528 7265  gth(rx).value(re
-00037390: 6c61 7469 7665 5f6c 656e 6774 683d 7365  lative_length=se
-000373a0: 6c66 2e77 6964 7468 290d 0a20 2020 2020  lf.width)..     
-000373b0: 2020 2020 2020 2072 7920 3d20 7278 0d0a         ry = rx..
-000373c0: 2020 2020 2020 2020 656c 6966 2072 7920          elif ry 
-000373d0: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
-000373e0: 7278 2069 7320 4e6f 6e65 3a0d 0a20 2020  rx is None:..   
-000373f0: 2020 2020 2020 2020 2072 7920 3d20 4c65           ry = Le
-00037400: 6e67 7468 2872 7929 2e76 616c 7565 2872  ngth(ry).value(r
-00037410: 656c 6174 6976 655f 6c65 6e67 7468 3d73  elative_length=s
-00037420: 656c 662e 6865 6967 6874 290d 0a20 2020  elf.height)..   
-00037430: 2020 2020 2020 2020 2072 7820 3d20 7279           rx = ry
-00037440: 0d0a 2020 2020 2020 2020 656c 6966 2072  ..        elif r
-00037450: 7820 6973 206e 6f74 204e 6f6e 6520 616e  x is not None an
-00037460: 6420 7279 2069 7320 6e6f 7420 4e6f 6e65  d ry is not None
-00037470: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
-00037480: 7820 3d20 4c65 6e67 7468 2872 7829 2e76  x = Length(rx).v
-00037490: 616c 7565 2872 656c 6174 6976 655f 6c65  alue(relative_le
-000374a0: 6e67 7468 3d73 656c 662e 7769 6474 6829  ngth=self.width)
-000374b0: 0d0a 2020 2020 2020 2020 2020 2020 7279  ..            ry
-000374c0: 203d 204c 656e 6774 6828 7279 292e 7661   = Length(ry).va
-000374d0: 6c75 6528 7265 6c61 7469 7665 5f6c 656e  lue(relative_len
-000374e0: 6774 683d 7365 6c66 2e68 6569 6768 7429  gth=self.height)
-000374f0: 0d0a 2020 2020 2020 2020 6966 2072 7820  ..        if rx 
-00037500: 3d3d 2030 206f 7220 7279 203d 3d20 303a  == 0 or ry == 0:
-00037510: 0d0a 2020 2020 2020 2020 2020 2020 7278  ..            rx
-00037520: 203d 2072 7920 3d20 300d 0a20 2020 2020   = ry = 0..     
-00037530: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-00037540: 2020 2020 2020 7472 793a 0d0a 2020 2020        try:..    
-00037550: 2020 2020 2020 2020 2020 2020 7278 203d              rx =
-00037560: 206d 696e 2872 782c 2073 656c 662e 7769   min(rx, self.wi
-00037570: 6474 6820 2f20 322e 3029 0d0a 2020 2020  dth / 2.0)..    
-00037580: 2020 2020 2020 2020 2020 2020 7279 203d              ry =
-00037590: 206d 696e 2872 792c 2073 656c 662e 6865   min(ry, self.he
-000375a0: 6967 6874 202f 2032 2e30 290d 0a20 2020  ight / 2.0)..   
-000375b0: 2020 2020 2020 2020 2065 7863 6570 7420           except 
-000375c0: 5661 6c75 6545 7272 6f72 3a0d 0a20 2020  ValueError:..   
-000375d0: 2020 2020 2020 2020 2020 2020 2070 6173               pas
-000375e0: 7320 2023 2049 6620 7769 6474 6820 6973  s  # If width is
-000375f0: 2069 6e20 696e 6368 6573 2061 6e64 2072   in inches and r
-00037600: 7820 6973 2069 6e20 756e 6974 732c 2074  x is in units, t
-00037610: 6869 7320 6973 2075 6e73 6f6c 7661 626c  his is unsolvabl
-00037620: 6520 7769 7468 6f75 7420 6b6e 6f77 696e  e without knowin
-00037630: 6720 7468 6520 7070 690d 0a20 2020 2020  g the ppi..     
-00037640: 2020 2073 656c 662e 7278 203d 2072 780d     self.rx = rx.
-00037650: 0a20 2020 2020 2020 2073 656c 662e 7279  .        self.ry
-00037660: 203d 2072 790d 0a0d 0a20 2020 2064 6566   = ry....    def
-00037670: 205f 6174 7472 7328 7365 6c66 2c20 7661   _attrs(self, va
-00037680: 6c75 6573 293a 0d0a 2020 2020 2020 2020  lues):..        
-00037690: 6966 2073 656c 662e 7820 213d 2030 3a0d  if self.x != 0:.
-000376a0: 0a20 2020 2020 2020 2020 2020 2076 616c  .            val
-000376b0: 7565 732e 6170 7065 6e64 2822 2573 3d25  ues.append("%s=%
-000376c0: 7322 2025 2028 5356 475f 4154 5452 5f58  s" % (SVG_ATTR_X
-000376d0: 2c20 4c65 6e67 7468 2e73 7472 2873 656c  , Length.str(sel
-000376e0: 662e 7829 2929 0d0a 2020 2020 2020 2020  f.x)))..        
-000376f0: 6966 2073 656c 662e 7920 213d 2030 3a0d  if self.y != 0:.
-00037700: 0a20 2020 2020 2020 2020 2020 2076 616c  .            val
-00037710: 7565 732e 6170 7065 6e64 2822 2573 3d25  ues.append("%s=%
-00037720: 7322 2025 2028 5356 475f 4154 5452 5f59  s" % (SVG_ATTR_Y
-00037730: 2c20 4c65 6e67 7468 2e73 7472 2873 656c  , Length.str(sel
-00037740: 662e 7929 2929 0d0a 2020 2020 2020 2020  f.y)))..        
-00037750: 6966 2073 656c 662e 7769 6474 6820 213d  if self.width !=
-00037760: 2030 3a0d 0a20 2020 2020 2020 2020 2020   0:..           
-00037770: 2076 616c 7565 732e 6170 7065 6e64 2822   values.append("
-00037780: 2573 3d25 7322 2025 2028 5356 475f 4154  %s=%s" % (SVG_AT
-00037790: 5452 5f57 4944 5448 2c20 4c65 6e67 7468  TR_WIDTH, Length
-000377a0: 2e73 7472 2873 656c 662e 7769 6474 6829  .str(self.width)
-000377b0: 2929 0d0a 2020 2020 2020 2020 6966 2073  ))..        if s
-000377c0: 656c 662e 6865 6967 6874 2021 3d20 303a  elf.height != 0:
-000377d0: 0d0a 2020 2020 2020 2020 2020 2020 7661  ..            va
-000377e0: 6c75 6573 2e61 7070 656e 6428 2225 733d  lues.append("%s=
-000377f0: 2573 2220 2520 2853 5647 5f41 5454 525f  %s" % (SVG_ATTR_
-00037800: 4845 4947 4854 2c20 4c65 6e67 7468 2e73  HEIGHT, Length.s
-00037810: 7472 2873 656c 662e 6865 6967 6874 2929  tr(self.height))
-00037820: 290d 0a20 2020 2020 2020 2069 6620 7365  )..        if se
-00037830: 6c66 2e72 7820 213d 2030 3a0d 0a20 2020  lf.rx != 0:..   
-00037840: 2020 2020 2020 2020 2076 616c 7565 732e           values.
-00037850: 6170 7065 6e64 2822 2573 3d25 7322 2025  append("%s=%s" %
-00037860: 2028 5356 475f 4154 5452 5f52 4144 4955   (SVG_ATTR_RADIU
-00037870: 535f 582c 204c 656e 6774 682e 7374 7228  S_X, Length.str(
-00037880: 7365 6c66 2e72 7829 2929 0d0a 2020 2020  self.rx)))..    
-00037890: 2020 2020 6966 2073 656c 662e 7279 2021      if self.ry !
-000378a0: 3d20 303a 0d0a 2020 2020 2020 2020 2020  = 0:..          
-000378b0: 2020 7661 6c75 6573 2e61 7070 656e 6428    values.append(
-000378c0: 2225 733d 2573 2220 2520 2853 5647 5f41  "%s=%s" % (SVG_A
-000378d0: 5454 525f 5241 4449 5553 5f59 2c20 4c65  TTR_RADIUS_Y, Le
-000378e0: 6e67 7468 2e73 7472 2873 656c 662e 7279  ngth.str(self.ry
-000378f0: 2929 290d 0a0d 0a20 2020 2064 6566 205f  )))....    def _
-00037900: 5f72 6570 725f 5f28 7365 6c66 293a 0d0a  _repr__(self):..
-00037910: 2020 2020 2020 2020 7661 6c75 6573 203d          values =
-00037920: 205b 5d0d 0a20 2020 2020 2020 2073 656c   []..        sel
-00037930: 662e 5f61 7474 7273 2876 616c 7565 7329  f._attrs(values)
-00037940: 0d0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
-00037950: 7265 7072 5f73 6861 7065 2876 616c 7565  repr_shape(value
-00037960: 7329 0d0a 2020 2020 2020 2020 7061 7261  s)..        para
-00037970: 6d73 203d 2022 2c20 222e 6a6f 696e 2876  ms = ", ".join(v
-00037980: 616c 7565 7329 0d0a 2020 2020 2020 2020  alues)..        
-00037990: 7265 7475 726e 2022 5265 6374 2825 7329  return "Rect(%s)
-000379a0: 2220 2520 7061 7261 6d73 0d0a 0d0a 2020  " % params....  
-000379b0: 2020 6465 6620 5f5f 7374 725f 5f28 7365    def __str__(se
-000379c0: 6c66 293a 0d0a 2020 2020 2020 2020 7661  lf):..        va
-000379d0: 6c75 6573 203d 205b 5d0d 0a20 2020 2020  lues = []..     
-000379e0: 2020 2073 656c 662e 5f61 7474 7273 2876     self._attrs(v
-000379f0: 616c 7565 7329 0d0a 2020 2020 2020 2020  alues)..        
-00037a00: 7365 6c66 2e5f 7374 725f 7368 6170 6528  self._str_shape(
-00037a10: 7661 6c75 6573 290d 0a20 2020 2020 2020  values)..       
-00037a20: 2070 6172 616d 7320 3d20 222c 2022 2e6a   params = ", ".j
-00037a30: 6f69 6e28 7661 6c75 6573 290d 0a20 2020  oin(values)..   
-00037a40: 2020 2020 2072 6574 7572 6e20 2252 6563       return "Rec
-00037a50: 7428 2573 2922 2025 2070 6172 616d 730d  t(%s)" % params.
-00037a60: 0a0d 0a20 2020 2064 6566 205f 5f63 6f70  ...    def __cop
-00037a70: 795f 5f28 7365 6c66 293a 0d0a 2020 2020  y__(self):..    
-00037a80: 2020 2020 7265 7475 726e 2052 6563 7428      return Rect(
-00037a90: 7365 6c66 290d 0a0d 0a20 2020 2040 7072  self)....    @pr
-00037aa0: 6f70 6572 7479 0d0a 2020 2020 6465 6620  operty..    def 
-00037ab0: 696d 706c 6963 6974 5f70 6f73 6974 696f  implicit_positio
-00037ac0: 6e28 7365 6c66 293a 0d0a 2020 2020 2020  n(self):..      
-00037ad0: 2020 6966 206e 6f74 2073 656c 662e 6170    if not self.ap
-00037ae0: 706c 793a 0d0a 2020 2020 2020 2020 2020  ply:..          
-00037af0: 2020 7265 7475 726e 2050 6f69 6e74 2873    return Point(s
-00037b00: 656c 662e 782c 2073 656c 662e 7929 0d0a  elf.x, self.y)..
-00037b10: 2020 2020 2020 2020 706f 696e 7420 3d20          point = 
-00037b20: 506f 696e 7428 7365 6c66 2e78 2c20 7365  Point(self.x, se
-00037b30: 6c66 2e79 290d 0a20 2020 2020 2020 2070  lf.y)..        p
-00037b40: 6f69 6e74 202a 3d20 7365 6c66 2e74 7261  oint *= self.tra
-00037b50: 6e73 666f 726d 0d0a 2020 2020 2020 2020  nsform..        
-00037b60: 7265 7475 726e 2070 6f69 6e74 0d0a 0d0a  return point....
-00037b70: 2020 2020 4070 726f 7065 7274 790d 0a20      @property.. 
-00037b80: 2020 2064 6566 2069 6d70 6c69 6369 745f     def implicit_
-00037b90: 7828 7365 6c66 293a 0d0a 2020 2020 2020  x(self):..      
-00037ba0: 2020 6966 206e 6f74 2073 656c 662e 6170    if not self.ap
-00037bb0: 706c 793a 0d0a 2020 2020 2020 2020 2020  ply:..          
-00037bc0: 2020 7265 7475 726e 2073 656c 662e 780d    return self.x.
-00037bd0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00037be0: 7365 6c66 2e69 6d70 6c69 6369 745f 706f  self.implicit_po
-00037bf0: 7369 7469 6f6e 5b30 5d0d 0a0d 0a20 2020  sition[0]....   
-00037c00: 2040 7072 6f70 6572 7479 0d0a 2020 2020   @property..    
-00037c10: 6465 6620 696d 706c 6963 6974 5f79 2873  def implicit_y(s
-00037c20: 656c 6629 3a0d 0a20 2020 2020 2020 2069  elf):..        i
-00037c30: 6620 6e6f 7420 7365 6c66 2e61 7070 6c79  f not self.apply
-00037c40: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
-00037c50: 6574 7572 6e20 7365 6c66 2e79 0d0a 2020  eturn self.y..  
-00037c60: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-00037c70: 662e 696d 706c 6963 6974 5f70 6f73 6974  f.implicit_posit
-00037c80: 696f 6e5b 315d 0d0a 0d0a 2020 2020 4070  ion[1]....    @p
-00037c90: 726f 7065 7274 790d 0a20 2020 2064 6566  roperty..    def
-00037ca0: 2069 6d70 6c69 6369 745f 7769 6474 6828   implicit_width(
-00037cb0: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
-00037cc0: 6966 206e 6f74 2073 656c 662e 6170 706c  if not self.appl
-00037cd0: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
-00037ce0: 7265 7475 726e 2073 656c 662e 7769 6474  return self.widt
-00037cf0: 680d 0a20 2020 2020 2020 2070 203d 2050  h..        p = P
-00037d00: 6f69 6e74 2873 656c 662e 7769 6474 682c  oint(self.width,
-00037d10: 2030 290d 0a20 2020 2020 2020 2070 202a   0)..        p *
-00037d20: 3d20 7365 6c66 2e74 7261 6e73 666f 726d  = self.transform
-00037d30: 0d0a 2020 2020 2020 2020 6f72 6967 696e  ..        origin
-00037d40: 203d 2050 6f69 6e74 2830 2c20 3029 0d0a   = Point(0, 0)..
-00037d50: 2020 2020 2020 2020 6f72 6967 696e 202a          origin *
-00037d60: 3d20 7365 6c66 2e74 7261 6e73 666f 726d  = self.transform
-00037d70: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00037d80: 206f 7269 6769 6e2e 6469 7374 616e 6365   origin.distance
-00037d90: 5f74 6f28 7029 0d0a 0d0a 2020 2020 4070  _to(p)....    @p
-00037da0: 726f 7065 7274 790d 0a20 2020 2064 6566  roperty..    def
-00037db0: 2069 6d70 6c69 6369 745f 6865 6967 6874   implicit_height
-00037dc0: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
-00037dd0: 2069 6620 6e6f 7420 7365 6c66 2e61 7070   if not self.app
-00037de0: 6c79 3a0d 0a20 2020 2020 2020 2020 2020  ly:..           
-00037df0: 2072 6574 7572 6e20 7365 6c66 2e68 6569   return self.hei
-00037e00: 6768 740d 0a20 2020 2020 2020 2070 203d  ght..        p =
-00037e10: 2050 6f69 6e74 2830 2c20 7365 6c66 2e68   Point(0, self.h
-00037e20: 6569 6768 7429 0d0a 2020 2020 2020 2020  eight)..        
-00037e30: 7020 2a3d 2073 656c 662e 7472 616e 7366  p *= self.transf
-00037e40: 6f72 6d0d 0a20 2020 2020 2020 206f 7269  orm..        ori
-00037e50: 6769 6e20 3d20 506f 696e 7428 302c 2030  gin = Point(0, 0
-00037e60: 290d 0a20 2020 2020 2020 206f 7269 6769  )..        origi
-00037e70: 6e20 2a3d 2073 656c 662e 7472 616e 7366  n *= self.transf
-00037e80: 6f72 6d0d 0a20 2020 2020 2020 2072 6574  orm..        ret
-00037e90: 7572 6e20 6f72 6967 696e 2e64 6973 7461  urn origin.dista
-00037ea0: 6e63 655f 746f 2870 290d 0a0d 0a20 2020  nce_to(p)....   
-00037eb0: 2040 7072 6f70 6572 7479 0d0a 2020 2020   @property..    
-00037ec0: 6465 6620 696d 706c 6963 6974 5f72 7828  def implicit_rx(
-00037ed0: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
-00037ee0: 6966 206e 6f74 2073 656c 662e 6170 706c  if not self.appl
-00037ef0: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
-00037f00: 7265 7475 726e 2073 656c 662e 7278 0d0a  return self.rx..
-00037f10: 2020 2020 2020 2020 7020 3d20 506f 696e          p = Poin
-00037f20: 7428 7365 6c66 2e72 782c 2030 290d 0a20  t(self.rx, 0).. 
-00037f30: 2020 2020 2020 2070 202a 3d20 7365 6c66         p *= self
-00037f40: 2e74 7261 6e73 666f 726d 0d0a 2020 2020  .transform..    
-00037f50: 2020 2020 6f72 6967 696e 203d 2050 6f69      origin = Poi
-00037f60: 6e74 2830 2c20 3029 0d0a 2020 2020 2020  nt(0, 0)..      
-00037f70: 2020 6f72 6967 696e 202a 3d20 7365 6c66    origin *= self
-00037f80: 2e74 7261 6e73 666f 726d 0d0a 2020 2020  .transform..    
-00037f90: 2020 2020 7265 7475 726e 206f 7269 6769      return origi
-00037fa0: 6e2e 6469 7374 616e 6365 5f74 6f28 7029  n.distance_to(p)
-00037fb0: 0d0a 0d0a 2020 2020 4070 726f 7065 7274  ....    @propert
-00037fc0: 790d 0a20 2020 2064 6566 2069 6d70 6c69  y..    def impli
-00037fd0: 6369 745f 7279 2873 656c 6629 3a0d 0a20  cit_ry(self):.. 
-00037fe0: 2020 2020 2020 2069 6620 6e6f 7420 7365         if not se
-00037ff0: 6c66 2e61 7070 6c79 3a0d 0a20 2020 2020  lf.apply:..     
-00038000: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-00038010: 6c66 2e72 790d 0a20 2020 2020 2020 2070  lf.ry..        p
-00038020: 203d 2050 6f69 6e74 2830 2c20 7365 6c66   = Point(0, self
-00038030: 2e72 7929 0d0a 2020 2020 2020 2020 7020  .ry)..        p 
-00038040: 2a3d 2073 656c 662e 7472 616e 7366 6f72  *= self.transfor
-00038050: 6d0d 0a20 2020 2020 2020 206f 7269 6769  m..        origi
-00038060: 6e20 3d20 506f 696e 7428 302c 2030 290d  n = Point(0, 0).
-00038070: 0a20 2020 2020 2020 206f 7269 6769 6e20  .        origin 
-00038080: 2a3d 2073 656c 662e 7472 616e 7366 6f72  *= self.transfor
-00038090: 6d0d 0a20 2020 2020 2020 2072 6574 7572  m..        retur
-000380a0: 6e20 6f72 6967 696e 2e64 6973 7461 6e63  n origin.distanc
-000380b0: 655f 746f 2870 290d 0a0d 0a20 2020 2064  e_to(p)....    d
-000380c0: 6566 2073 6567 6d65 6e74 7328 7365 6c66  ef segments(self
-000380d0: 2c20 7472 616e 7366 6f72 6d65 643d 5472  , transformed=Tr
-000380e0: 7565 293a 0d0a 2020 2020 2020 2020 2222  ue):..        ""
-000380f0: 220d 0a20 2020 2020 2020 2052 6563 7420  "..        Rect 
-00038100: 6465 636f 6d70 6f73 6974 696f 6e20 6973  decomposition is
-00038110: 2067 6976 656e 2069 6e20 5356 4720 322e   given in SVG 2.
-00038120: 3020 3130 2e32 0d0a 0d0a 2020 2020 2020  0 10.2....      
-00038130: 2020 5265 6374 3a0d 0a20 2020 2020 2020    Rect:..       
-00038140: 202a 2070 6572 666f 726d 2061 6e20 6162   * perform an ab
-00038150: 736f 6c75 7465 206d 6f76 6574 6f20 6f70  solute moveto op
-00038160: 6572 6174 696f 6e20 746f 206c 6f63 6174  eration to locat
-00038170: 696f 6e20 2878 2c79 293b 0d0a 2020 2020  ion (x,y);..    
-00038180: 2020 2020 2a20 7065 7266 6f72 6d20 616e      * perform an
-00038190: 2061 6273 6f6c 7574 6520 686f 7269 7a6f   absolute horizo
-000381a0: 6e74 616c 206c 696e 6574 6f20 7769 7468  ntal lineto with
-000381b0: 2070 6172 616d 6574 6572 2078 2b77 6964   parameter x+wid
-000381c0: 7468 3b0d 0a20 2020 2020 2020 202a 2070  th;..        * p
-000381d0: 6572 666f 726d 2061 6e20 6162 736f 6c75  erform an absolu
-000381e0: 7465 2076 6572 7469 6361 6c20 6c69 6e65  te vertical line
-000381f0: 746f 2070 6172 616d 6574 6572 2079 2b68  to parameter y+h
-00038200: 6569 6768 743b 0d0a 2020 2020 2020 2020  eight;..        
-00038210: 2a20 7065 7266 6f72 6d20 616e 2061 6273  * perform an abs
-00038220: 6f6c 7574 6520 686f 7269 7a6f 6e74 616c  olute horizontal
-00038230: 206c 696e 6574 6f20 7061 7261 6d65 7465   lineto paramete
-00038240: 7220 783b 0d0a 2020 2020 2020 2020 2a20  r x;..        * 
-00038250: 2820 636c 6f73 6520 7468 6520 7061 7468  ( close the path
-00038260: 290d 0a0d 0a20 2020 2020 2020 2052 6f75  )....        Rou
-00038270: 6e64 6564 2052 6563 743a 0d0a 2020 2020  nded Rect:..    
-00038280: 2020 2020 7278 2061 6e64 2072 7920 6172      rx and ry ar
-00038290: 6520 7573 6564 2061 7320 7468 6520 6571  e used as the eq
-000382a0: 7569 7661 6c65 6e74 2070 6172 616d 6574  uivalent paramet
-000382b0: 6572 7320 746f 2074 6865 2065 6c6c 6970  ers to the ellip
-000382c0: 7469 6361 6c20 6172 6320 636f 6d6d 616e  tical arc comman
-000382d0: 642c 0d0a 2020 2020 2020 2020 7468 6520  d,..        the 
-000382e0: 782d 6178 6973 2d72 6f74 6174 696f 6e20  x-axis-rotation 
-000382f0: 616e 6420 6c61 7267 652d 6172 632d 666c  and large-arc-fl
-00038300: 6167 2061 7265 2073 6574 2074 6f20 7a65  ag are set to ze
-00038310: 726f 2c20 7468 6520 7377 6565 702d 666c  ro, the sweep-fl
-00038320: 6167 2069 7320 7365 7420 746f 206f 6e65  ag is set to one
-00038330: 0d0a 0d0a 2020 2020 2020 2020 2a20 7065  ....        * pe
-00038340: 7266 6f72 6d20 616e 2061 6273 6f6c 7574  rform an absolut
-00038350: 6520 6d6f 7665 746f 206f 7065 7261 7469  e moveto operati
-00038360: 6f6e 2074 6f20 6c6f 6361 7469 6f6e 2028  on to location (
-00038370: 782b 7278 2c79 293b 0d0a 2020 2020 2020  x+rx,y);..      
-00038380: 2020 2a20 7065 7266 6f72 6d20 616e 2061    * perform an a
-00038390: 6273 6f6c 7574 6520 686f 7269 7a6f 6e74  bsolute horizont
-000383a0: 616c 206c 696e 6574 6f20 7769 7468 2070  al lineto with p
-000383b0: 6172 616d 6574 6572 2078 2b77 6964 7468  arameter x+width
-000383c0: 2d72 783b 0d0a 2020 2020 2020 2020 2a20  -rx;..        * 
-000383d0: 7065 7266 6f72 6d20 616e 2061 6273 6f6c  perform an absol
-000383e0: 7574 6520 656c 6c69 7074 6963 616c 2061  ute elliptical a
-000383f0: 7263 206f 7065 7261 7469 6f6e 2074 6f20  rc operation to 
-00038400: 636f 6f72 6469 6e61 7465 2028 782b 7769  coordinate (x+wi
-00038410: 6474 682c 792b 7279 290d 0a20 2020 2020  dth,y+ry)..     
-00038420: 2020 202a 2070 6572 666f 726d 2061 6e20     * perform an 
-00038430: 6162 736f 6c75 7465 2076 6572 7469 6361  absolute vertica
-00038440: 6c20 6c69 6e65 746f 2070 6172 616d 6574  l lineto paramet
-00038450: 6572 2079 2b68 6569 6768 742d 7279 3b0d  er y+height-ry;.
-00038460: 0a20 2020 2020 2020 202a 2070 6572 666f  .        * perfo
-00038470: 726d 2061 6e20 6162 736f 6c75 7465 2065  rm an absolute e
-00038480: 6c6c 6970 7469 6361 6c20 6172 6320 6f70  lliptical arc op
-00038490: 6572 6174 696f 6e20 746f 2063 6f6f 7264  eration to coord
-000384a0: 696e 6174 6520 2878 2b77 6964 7468 2d72  inate (x+width-r
-000384b0: 782c 792b 6865 6967 6874 290d 0a20 2020  x,y+height)..   
-000384c0: 2020 2020 202a 2070 6572 666f 726d 2061       * perform a
-000384d0: 6e20 6162 736f 6c75 7465 2068 6f72 697a  n absolute horiz
-000384e0: 6f6e 7461 6c20 6c69 6e65 746f 2070 6172  ontal lineto par
-000384f0: 616d 6574 6572 2078 2b72 783b 0d0a 2020  ameter x+rx;..  
-00038500: 2020 2020 2020 2a20 7065 7266 6f72 6d20        * perform 
-00038510: 616e 2061 6273 6f6c 7574 6520 656c 6c69  an absolute elli
-00038520: 7074 6963 616c 2061 7263 206f 7065 7261  ptical arc opera
-00038530: 7469 6f6e 2074 6f20 636f 6f72 6469 6e61  tion to coordina
-00038540: 7465 2028 782c 792b 6865 6967 6874 2d72  te (x,y+height-r
-00038550: 7929 0d0a 2020 2020 2020 2020 2a20 7065  y)..        * pe
-00038560: 7266 6f72 6d20 616e 2061 6273 6f6c 7574  rform an absolut
-00038570: 6520 7665 7274 6963 616c 206c 696e 6574  e vertical linet
-00038580: 6f20 7061 7261 6d65 7465 7220 792b 7279  o parameter y+ry
-00038590: 0d0a 2020 2020 2020 2020 2a20 7065 7266  ..        * perf
-000385a0: 6f72 6d20 616e 2061 6273 6f6c 7574 6520  orm an absolute 
-000385b0: 656c 6c69 7074 6963 616c 2061 7263 206f  elliptical arc o
-000385c0: 7065 7261 7469 6f6e 2077 6974 6820 6120  peration with a 
-000385d0: 7365 676d 656e 742d 636f 6d70 6c65 7469  segment-completi
-000385e0: 6e67 2063 6c6f 7365 2070 6174 6820 6f70  ng close path op
-000385f0: 6572 6174 696f 6e0d 0a0d 0a20 2020 2020  eration....     
-00038600: 2020 203a 7061 7261 6d20 7472 616e 7366     :param transf
-00038610: 6f72 6d65 643a 2070 726f 7669 6465 2074  ormed: provide t
-00038620: 6865 2072 6569 6669 6564 2076 6572 7369  he reified versi
-00038630: 6f6e 2e0d 0a20 2020 2020 2020 203a 7265  on...        :re
-00038640: 7475 726e 3a20 7061 7468 5f64 206f 6620  turn: path_d of 
-00038650: 7368 6170 652e 0d0a 2020 2020 2020 2020  shape...        
-00038660: 2222 220d 0a20 2020 2020 2020 2073 636f  """..        sco
-00038670: 6f70 6564 203d 2046 616c 7365 0d0a 2020  oped = False..  
-00038680: 2020 2020 2020 7820 3d20 7365 6c66 2e78        x = self.x
-00038690: 0d0a 2020 2020 2020 2020 7920 3d20 7365  ..        y = se
-000386a0: 6c66 2e79 0d0a 2020 2020 2020 2020 7769  lf.y..        wi
-000386b0: 6474 6820 3d20 7365 6c66 2e77 6964 7468  dth = self.width
-000386c0: 0d0a 2020 2020 2020 2020 6865 6967 6874  ..        height
-000386d0: 203d 2073 656c 662e 6865 6967 6874 0d0a   = self.height..
-000386e0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-000386f0: 6973 5f64 6567 656e 6572 6174 6528 293a  is_degenerate():
-00038700: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
-00038710: 7475 726e 2028 2920 2023 2061 2063 6f6d  turn ()  # a com
-00038720: 7075 7465 6420 7661 6c75 6520 6f66 207a  puted value of z
-00038730: 6572 6f20 666f 7220 6569 7468 6572 2064  ero for either d
-00038740: 696d 656e 7369 6f6e 2064 6973 6162 6c65  imension disable
-00038750: 7320 7265 6e64 6572 696e 672e 0d0a 2020  s rendering...  
-00038760: 2020 2020 2020 7278 203d 2073 656c 662e        rx = self.
-00038770: 7278 0d0a 2020 2020 2020 2020 7279 203d  rx..        ry =
-00038780: 2073 656c 662e 7279 0d0a 2020 2020 2020   self.ry..      
-00038790: 2020 6966 206e 6f74 2073 656c 662e 5f73    if not self._s
-000387a0: 7472 6963 743a 0d0a 2020 2020 2020 2020  trict:..        
-000387b0: 2020 2020 6966 2072 7820 3c20 3020 3c20      if rx < 0 < 
-000387c0: 7769 6474 6820 616e 6420 7279 203c 2030  width and ry < 0
-000387d0: 203c 2068 6569 6768 743a 0d0a 2020 2020   < height:..    
-000387e0: 2020 2020 2020 2020 2020 2020 7363 6f6f              scoo
-000387f0: 7065 6420 3d20 5472 7565 0d0a 2020 2020  ped = True..    
-00038800: 2020 2020 2020 2020 2020 2020 7278 203d              rx =
-00038810: 2061 6273 2872 7829 0d0a 2020 2020 2020   abs(rx)..      
-00038820: 2020 2020 2020 2020 2020 7279 203d 2061            ry = a
-00038830: 6273 2872 7929 0d0a 2020 2020 2020 2020  bs(ry)..        
-00038840: 6966 2072 7820 3c20 3020 3c20 7769 6474  if rx < 0 < widt
-00038850: 6820 6f72 2072 7920 3c20 3020 3c20 6865  h or ry < 0 < he
-00038860: 6967 6874 3a0d 0a20 2020 2020 2020 2020  ight:..         
-00038870: 2020 2072 7820 3d20 300d 0a20 2020 2020     rx = 0..     
-00038880: 2020 2020 2020 2072 7920 3d20 300d 0a20         ry = 0.. 
-00038890: 2020 2020 2020 2069 6620 7278 203d 3d20         if rx == 
-000388a0: 7279 203d 3d20 303a 0d0a 2020 2020 2020  ry == 0:..      
-000388b0: 2020 2020 2020 7365 676d 656e 7473 203d        segments =
-000388c0: 2028 0d0a 2020 2020 2020 2020 2020 2020   (..            
-000388d0: 2020 2020 4d6f 7665 284e 6f6e 652c 2028      Move(None, (
-000388e0: 782c 2079 2929 2c0d 0a20 2020 2020 2020  x, y)),..       
-000388f0: 2020 2020 2020 2020 204c 696e 6528 2878           Line((x
-00038900: 2c20 7929 2c20 2878 202b 2077 6964 7468  , y), (x + width
-00038910: 2c20 7929 292c 0d0a 2020 2020 2020 2020  , y)),..        
-00038920: 2020 2020 2020 2020 4c69 6e65 2828 7820          Line((x 
-00038930: 2b20 7769 6474 682c 2079 292c 2028 7820  + width, y), (x 
-00038940: 2b20 7769 6474 682c 2079 202b 2068 6569  + width, y + hei
-00038950: 6768 7429 292c 0d0a 2020 2020 2020 2020  ght)),..        
-00038960: 2020 2020 2020 2020 4c69 6e65 2828 7820          Line((x 
-00038970: 2b20 7769 6474 682c 2079 202b 2068 6569  + width, y + hei
-00038980: 6768 7429 2c20 2878 2c20 7920 2b20 6865  ght), (x, y + he
-00038990: 6967 6874 2929 2c0d 0a20 2020 2020 2020  ight)),..       
-000389a0: 2020 2020 2020 2020 2043 6c6f 7365 2828           Close((
-000389b0: 782c 2079 202b 2068 6569 6768 7429 2c20  x, y + height), 
-000389c0: 2878 2c20 7929 292c 0d0a 2020 2020 2020  (x, y)),..      
-000389d0: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
-000389e0: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-000389f0: 2020 2020 7365 676d 656e 7473 203d 2028      segments = (
-00038a00: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00038a10: 2020 4d6f 7665 284e 6f6e 652c 2028 7820    Move(None, (x 
-00038a20: 2b20 7278 2c20 7929 292c 0d0a 2020 2020  + rx, y)),..    
-00038a30: 2020 2020 2020 2020 2020 2020 4c69 6e65              Line
-00038a40: 2828 7820 2b20 7278 2c20 7929 2c20 2878  ((x + rx, y), (x
-00038a50: 202b 2077 6964 7468 202d 2072 782c 2079   + width - rx, y
-00038a60: 2929 2c0d 0a20 2020 2020 2020 2020 2020  )),..           
-00038a70: 2020 2020 2041 7263 280d 0a20 2020 2020       Arc(..     
-00038a80: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-00038a90: 7820 2b20 7769 6474 6820 2d20 7278 2c20  x + width - rx, 
-00038aa0: 7929 2c0d 0a20 2020 2020 2020 2020 2020  y),..           
-00038ab0: 2020 2020 2020 2020 2028 7820 2b20 7769           (x + wi
-00038ac0: 6474 682c 2079 202b 2072 7929 2c0d 0a20  dth, y + ry),.. 
-00038ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038ae0: 2020 2072 783d 7278 2c0d 0a20 2020 2020     rx=rx,..     
-00038af0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00038b00: 793d 7279 2c0d 0a20 2020 2020 2020 2020  y=ry,..         
-00038b10: 2020 2020 2020 2020 2020 2073 636f 6f70             scoop
-00038b20: 6564 3d73 636f 6f70 6564 2c0d 0a20 2020  ed=scooped,..   
-00038b30: 2020 2020 2020 2020 2020 2020 2029 2c0d               ),.
-00038b40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00038b50: 204c 696e 6528 2878 202b 2077 6964 7468   Line((x + width
-00038b60: 2c20 7920 2b20 7279 292c 2028 7820 2b20  , y + ry), (x + 
-00038b70: 7769 6474 682c 2079 202b 2068 6569 6768  width, y + heigh
-00038b80: 7420 2d20 7279 2929 2c0d 0a20 2020 2020  t - ry)),..     
-00038b90: 2020 2020 2020 2020 2020 2041 7263 280d             Arc(.
-00038ba0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00038bb0: 2020 2020 2028 7820 2b20 7769 6474 682c       (x + width,
-00038bc0: 2079 202b 2068 6569 6768 7420 2d20 7279   y + height - ry
-00038bd0: 292c 0d0a 2020 2020 2020 2020 2020 2020  ),..            
-00038be0: 2020 2020 2020 2020 2878 202b 2077 6964          (x + wid
-00038bf0: 7468 202d 2072 782c 2079 202b 2068 6569  th - rx, y + hei
-00038c00: 6768 7429 2c0d 0a20 2020 2020 2020 2020  ght),..         
-00038c10: 2020 2020 2020 2020 2020 2072 783d 7278             rx=rx
-00038c20: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00038c30: 2020 2020 2020 2072 793d 7279 2c0d 0a20         ry=ry,.. 
-00038c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038c50: 2020 2073 636f 6f70 6564 3d73 636f 6f70     scooped=scoop
-00038c60: 6564 2c0d 0a20 2020 2020 2020 2020 2020  ed,..           
-00038c70: 2020 2020 2029 2c0d 0a20 2020 2020 2020       ),..       
-00038c80: 2020 2020 2020 2020 204c 696e 6528 2878           Line((x
-00038c90: 202b 2077 6964 7468 202d 2072 782c 2079   + width - rx, y
-00038ca0: 202b 2068 6569 6768 7429 2c20 2878 202b   + height), (x +
-00038cb0: 2072 782c 2079 202b 2068 6569 6768 7429   rx, y + height)
-00038cc0: 292c 0d0a 2020 2020 2020 2020 2020 2020  ),..            
-00038cd0: 2020 2020 4172 6328 0d0a 2020 2020 2020      Arc(..      
-00038ce0: 2020 2020 2020 2020 2020 2020 2020 2878                (x
-00038cf0: 202b 2072 782c 2079 202b 2068 6569 6768   + rx, y + heigh
-00038d00: 7429 2c0d 0a20 2020 2020 2020 2020 2020  t),..           
-00038d10: 2020 2020 2020 2020 2028 782c 2079 202b           (x, y +
-00038d20: 2068 6569 6768 7420 2d20 7279 292c 0d0a   height - ry),..
-00038d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038d40: 2020 2020 7278 3d72 782c 0d0a 2020 2020      rx=rx,..    
-00038d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038d60: 7279 3d72 792c 0d0a 2020 2020 2020 2020  ry=ry,..        
-00038d70: 2020 2020 2020 2020 2020 2020 7363 6f6f              scoo
-00038d80: 7065 643d 7363 6f6f 7065 642c 0d0a 2020  ped=scooped,..  
-00038d90: 2020 2020 2020 2020 2020 2020 2020 292c                ),
-00038da0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00038db0: 2020 4c69 6e65 2828 782c 2079 202b 2068    Line((x, y + h
-00038dc0: 6569 6768 7420 2d20 7279 292c 2028 782c  eight - ry), (x,
-00038dd0: 2079 202b 2072 7929 292c 0d0a 2020 2020   y + ry)),..    
-00038de0: 2020 2020 2020 2020 2020 2020 4172 6328              Arc(
-00038df0: 2878 2c20 7920 2b20 7279 292c 2028 7820  (x, y + ry), (x 
-00038e00: 2b20 7278 2c20 7929 2c20 7278 3d72 782c  + rx, y), rx=rx,
-00038e10: 2072 793d 7279 2c20 7363 6f6f 7065 643d   ry=ry, scooped=
-00038e20: 7363 6f6f 7065 6429 2c0d 0a20 2020 2020  scooped),..     
-00038e30: 2020 2020 2020 2020 2020 2043 6c6f 7365             Close
-00038e40: 2828 7820 2b20 7278 2c20 7929 2c20 2878  ((x + rx, y), (x
-00038e50: 202b 2072 782c 2079 2929 2c0d 0a20 2020   + rx, y)),..   
-00038e60: 2020 2020 2020 2020 2029 0d0a 2020 2020           )..    
-00038e70: 2020 2020 6966 206e 6f74 2074 7261 6e73      if not trans
-00038e80: 666f 726d 6564 206f 7220 7365 6c66 2e74  formed or self.t
-00038e90: 7261 6e73 666f 726d 2e69 735f 6964 656e  ransform.is_iden
-00038ea0: 7469 7479 2829 3a0d 0a20 2020 2020 2020  tity():..       
-00038eb0: 2020 2020 2072 6574 7572 6e20 7365 676d       return segm
-00038ec0: 656e 7473 0d0a 2020 2020 2020 2020 656c  ents..        el
-00038ed0: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
-00038ee0: 2072 6574 7572 6e20 5b73 202a 2073 656c   return [s * sel
-00038ef0: 662e 7472 616e 7366 6f72 6d20 666f 7220  f.transform for 
-00038f00: 7320 696e 2073 6567 6d65 6e74 735d 0d0a  s in segments]..
-00038f10: 0d0a 2020 2020 6465 6620 7265 6966 7928  ..    def reify(
-00038f20: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
-00038f30: 2222 220d 0a20 2020 2020 2020 2052 6561  """..        Rea
-00038f40: 6c69 7a65 7320 7468 6520 7472 616e 7366  lizes the transf
-00038f50: 6f72 6d20 746f 2074 6865 2073 6861 7065  orm to the shape
-00038f60: 2070 726f 7065 7274 6965 732e 0d0a 0d0a   properties.....
-00038f70: 2020 2020 2020 2020 4966 2074 6865 2072          If the r
-00038f80: 6561 6c69 7a65 6420 7368 6170 6520 6361  ealized shape ca
-00038f90: 6e20 6265 2070 726f 7065 726c 7920 7265  n be properly re
-00038fa0: 7072 6573 656e 7465 6420 6173 2061 2072  presented as a r
-00038fb0: 6563 7461 6e67 6c65 2077 6974 6820 616e  ectangle with an
-00038fc0: 2069 6465 6e74 6974 7920 6d61 7472 6978   identity matrix
-00038fd0: 0d0a 2020 2020 2020 2020 6974 2077 696c  ..        it wil
-00038fe0: 6c20 6265 2c20 6f74 6865 7277 6973 6520  l be, otherwise 
-00038ff0: 7468 6520 7072 6f70 6572 7469 6573 2077  the properties w
-00039000: 696c 6c20 6170 7072 6f78 696d 6174 6520  ill approximate 
-00039010: 7468 6520 696d 706c 6965 6420 7661 6c75  the implied valu
-00039020: 6573 2e0d 0a0d 0a20 2020 2020 2020 2053  es.....        S
-00039030: 6b65 7765 6420 616e 6420 526f 7461 7465  kewed and Rotate
-00039040: 6420 7265 6374 616e 676c 6573 2063 616e  d rectangles can
-00039050: 6e6f 7420 6265 2072 6569 6669 6564 2e0d  not be reified..
-00039060: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
-00039070: 2020 2020 2020 7363 616c 655f 7820 3d20        scale_x = 
-00039080: 7365 6c66 2e74 7261 6e73 666f 726d 2e76  self.transform.v
-00039090: 616c 7565 5f73 6361 6c65 5f78 2829 0d0a  alue_scale_x()..
-000390a0: 2020 2020 2020 2020 7363 616c 655f 7920          scale_y 
-000390b0: 3d20 7365 6c66 2e74 7261 6e73 666f 726d  = self.transform
-000390c0: 2e76 616c 7565 5f73 6361 6c65 5f79 2829  .value_scale_y()
-000390d0: 0d0a 2020 2020 2020 2020 6966 2073 6361  ..        if sca
-000390e0: 6c65 5f78 202a 2073 6361 6c65 5f79 203c  le_x * scale_y <
-000390f0: 2030 3a0d 0a20 2020 2020 2020 2020 2020   0:..           
-00039100: 2072 6574 7572 6e20 7365 6c66 2020 2320   return self  # 
-00039110: 4e6f 2072 6569 6669 6361 7469 6f6e 206f  No reification o
-00039120: 6620 6e65 6761 7469 7665 2076 616c 7565  f negative value
-00039130: 732c 2067 6976 6573 206e 6567 6174 6976  s, gives negativ
-00039140: 6520 6469 6d73 2e0d 0a20 2020 2020 2020  e dims...       
-00039150: 2074 7261 6e73 6c61 7465 5f78 203d 2073   translate_x = s
-00039160: 656c 662e 7472 616e 7366 6f72 6d2e 7661  elf.transform.va
-00039170: 6c75 655f 7472 616e 735f 7828 290d 0a20  lue_trans_x().. 
-00039180: 2020 2020 2020 2074 7261 6e73 6c61 7465         translate
-00039190: 5f79 203d 2073 656c 662e 7472 616e 7366  _y = self.transf
-000391a0: 6f72 6d2e 7661 6c75 655f 7472 616e 735f  orm.value_trans_
-000391b0: 7928 290d 0a20 2020 2020 2020 2069 6620  y()..        if 
-000391c0: 280d 0a20 2020 2020 2020 2020 2020 2073  (..            s
-000391d0: 656c 662e 7472 616e 7366 6f72 6d2e 7661  elf.transform.va
-000391e0: 6c75 655f 736b 6577 5f78 2829 203d 3d20  lue_skew_x() == 
-000391f0: 300d 0a20 2020 2020 2020 2020 2020 2061  0..            a
-00039200: 6e64 2073 656c 662e 7472 616e 7366 6f72  nd self.transfor
-00039210: 6d2e 7661 6c75 655f 736b 6577 5f79 2829  m.value_skew_y()
-00039220: 203d 3d20 300d 0a20 2020 2020 2020 2020   == 0..         
-00039230: 2020 2061 6e64 2073 6361 6c65 5f78 2021     and scale_x !
-00039240: 3d20 300d 0a20 2020 2020 2020 2020 2020  = 0..           
-00039250: 2061 6e64 2073 6361 6c65 5f79 2021 3d20   and scale_y != 
-00039260: 300d 0a20 2020 2020 2020 2029 3a0d 0a20  0..        ):.. 
-00039270: 2020 2020 2020 2020 2020 2047 7261 7068             Graph
-00039280: 6963 4f62 6a65 6374 2e72 6569 6679 2873  icObject.reify(s
-00039290: 656c 6629 0d0a 2020 2020 2020 2020 2020  elf)..          
-000392a0: 2020 5472 616e 7366 6f72 6d61 626c 652e    Transformable.
-000392b0: 7265 6966 7928 7365 6c66 290d 0a20 2020  reify(self)..   
-000392c0: 2020 2020 2020 2020 2073 656c 662e 7820           self.x 
-000392d0: 2a3d 2073 6361 6c65 5f78 0d0a 2020 2020  *= scale_x..    
-000392e0: 2020 2020 2020 2020 7365 6c66 2e79 202a          self.y *
-000392f0: 3d20 7363 616c 655f 790d 0a20 2020 2020  = scale_y..     
-00039300: 2020 2020 2020 2073 656c 662e 7820 2b3d         self.x +=
-00039310: 2074 7261 6e73 6c61 7465 5f78 0d0a 2020   translate_x..  
-00039320: 2020 2020 2020 2020 2020 7365 6c66 2e79            self.y
-00039330: 202b 3d20 7472 616e 736c 6174 655f 790d   += translate_y.
-00039340: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00039350: 662e 7472 616e 7366 6f72 6d20 2a3d 204d  f.transform *= M
-00039360: 6174 7269 782e 7472 616e 736c 6174 6528  atrix.translate(
-00039370: 2d74 7261 6e73 6c61 7465 5f78 2c20 2d74  -translate_x, -t
-00039380: 7261 6e73 6c61 7465 5f79 290d 0a20 2020  ranslate_y)..   
-00039390: 2020 2020 2020 2020 2073 656c 662e 7278           self.rx
-000393a0: 203d 2073 6361 6c65 5f78 202a 2073 656c   = scale_x * sel
-000393b0: 662e 7278 0d0a 2020 2020 2020 2020 2020  f.rx..          
-000393c0: 2020 7365 6c66 2e72 7920 3d20 7363 616c    self.ry = scal
-000393d0: 655f 7920 2a20 7365 6c66 2e72 790d 0a20  e_y * self.ry.. 
-000393e0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000393f0: 7769 6474 6820 3d20 7363 616c 655f 7820  width = scale_x 
-00039400: 2a20 7365 6c66 2e77 6964 7468 0d0a 2020  * self.width..  
-00039410: 2020 2020 2020 2020 2020 7365 6c66 2e68            self.h
-00039420: 6569 6768 7420 3d20 7363 616c 655f 7920  eight = scale_y 
-00039430: 2a20 7365 6c66 2e68 6569 6768 740d 0a20  * self.height.. 
-00039440: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00039450: 7472 616e 7366 6f72 6d20 2a3d 204d 6174  transform *= Mat
-00039460: 7269 782e 7363 616c 6528 312e 3020 2f20  rix.scale(1.0 / 
-00039470: 7363 616c 655f 782c 2031 2e30 202f 2073  scale_x, 1.0 / s
-00039480: 6361 6c65 5f79 290d 0a20 2020 2020 2020  cale_y)..       
-00039490: 2072 6574 7572 6e20 7365 6c66 0d0a 0d0a   return self....
-000394a0: 2020 2020 6465 6620 7265 6e64 6572 2873      def render(s
-000394b0: 656c 662c 202a 2a6b 7761 7267 7329 3a0d  elf, **kwargs):.
-000394c0: 0a20 2020 2020 2020 2053 6861 7065 2e72  .        Shape.r
-000394d0: 656e 6465 7228 7365 6c66 2c20 2a2a 6b77  ender(self, **kw
-000394e0: 6172 6773 290d 0a20 2020 2020 2020 2077  args)..        w
-000394f0: 6964 7468 203d 206b 7761 7267 732e 6765  idth = kwargs.ge
-00039500: 7428 2277 6964 7468 222c 206b 7761 7267  t("width", kwarg
-00039510: 732e 6765 7428 2272 656c 6174 6976 655f  s.get("relative_
-00039520: 6c65 6e67 7468 2229 290d 0a20 2020 2020  length"))..     
-00039530: 2020 2068 6569 6768 7420 3d20 6b77 6172     height = kwar
-00039540: 6773 2e67 6574 2822 6865 6967 6874 222c  gs.get("height",
-00039550: 206b 7761 7267 732e 6765 7428 2272 656c   kwargs.get("rel
-00039560: 6174 6976 655f 6c65 6e67 7468 2229 290d  ative_length")).
-00039570: 0a20 2020 2020 2020 2074 7279 3a0d 0a20  .        try:.. 
-00039580: 2020 2020 2020 2020 2020 2064 656c 206b             del k
-00039590: 7761 7267 735b 2272 656c 6174 6976 655f  wargs["relative_
-000395a0: 6c65 6e67 7468 225d 0d0a 2020 2020 2020  length"]..      
-000395b0: 2020 6578 6365 7074 204b 6579 4572 726f    except KeyErro
-000395c0: 723a 0d0a 2020 2020 2020 2020 2020 2020  r:..            
-000395d0: 7061 7373 0d0a 2020 2020 2020 2020 6966  pass..        if
-000395e0: 2069 7369 6e73 7461 6e63 6528 7365 6c66   isinstance(self
-000395f0: 2e78 2c20 4c65 6e67 7468 293a 0d0a 2020  .x, Length):..  
-00039600: 2020 2020 2020 2020 2020 7365 6c66 2e78            self.x
-00039610: 203d 2073 656c 662e 782e 7661 6c75 6528   = self.x.value(
-00039620: 7265 6c61 7469 7665 5f6c 656e 6774 683d  relative_length=
-00039630: 7769 6474 682c 202a 2a6b 7761 7267 7329  width, **kwargs)
-00039640: 0d0a 2020 2020 2020 2020 6966 2069 7369  ..        if isi
-00039650: 6e73 7461 6e63 6528 7365 6c66 2e79 2c20  nstance(self.y, 
-00039660: 4c65 6e67 7468 293a 0d0a 2020 2020 2020  Length):..      
-00039670: 2020 2020 2020 7365 6c66 2e79 203d 2073        self.y = s
-00039680: 656c 662e 792e 7661 6c75 6528 7265 6c61  elf.y.value(rela
-00039690: 7469 7665 5f6c 656e 6774 683d 6865 6967  tive_length=heig
-000396a0: 6874 2c20 2a2a 6b77 6172 6773 290d 0a20  ht, **kwargs).. 
-000396b0: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-000396c0: 616e 6365 2873 656c 662e 7769 6474 682c  ance(self.width,
-000396d0: 204c 656e 6774 6829 3a0d 0a20 2020 2020   Length):..     
-000396e0: 2020 2020 2020 2073 656c 662e 7769 6474         self.widt
-000396f0: 6820 3d20 7365 6c66 2e77 6964 7468 2e76  h = self.width.v
-00039700: 616c 7565 2872 656c 6174 6976 655f 6c65  alue(relative_le
-00039710: 6e67 7468 3d77 6964 7468 2c20 2a2a 6b77  ngth=width, **kw
-00039720: 6172 6773 290d 0a20 2020 2020 2020 2069  args)..        i
-00039730: 6620 6973 696e 7374 616e 6365 2873 656c  f isinstance(sel
-00039740: 662e 6865 6967 6874 2c20 4c65 6e67 7468  f.height, Length
-00039750: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00039760: 7365 6c66 2e68 6569 6768 7420 3d20 7365  self.height = se
-00039770: 6c66 2e68 6569 6768 742e 7661 6c75 6528  lf.height.value(
-00039780: 7265 6c61 7469 7665 5f6c 656e 6774 683d  relative_length=
-00039790: 6865 6967 6874 2c20 2a2a 6b77 6172 6773  height, **kwargs
-000397a0: 290d 0a20 2020 2020 2020 2069 6620 6973  )..        if is
-000397b0: 696e 7374 616e 6365 2873 656c 662e 7278  instance(self.rx
-000397c0: 2c20 4c65 6e67 7468 293a 0d0a 2020 2020  , Length):..    
-000397d0: 2020 2020 2020 2020 7365 6c66 2e72 7820          self.rx 
-000397e0: 3d20 7365 6c66 2e72 782e 7661 6c75 6528  = self.rx.value(
-000397f0: 7265 6c61 7469 7665 5f6c 656e 6774 683d  relative_length=
-00039800: 7769 6474 682c 202a 2a6b 7761 7267 7329  width, **kwargs)
-00039810: 0d0a 2020 2020 2020 2020 6966 2069 7369  ..        if isi
-00039820: 6e73 7461 6e63 6528 7365 6c66 2e72 792c  nstance(self.ry,
-00039830: 204c 656e 6774 6829 3a0d 0a20 2020 2020   Length):..     
-00039840: 2020 2020 2020 2073 656c 662e 7279 203d         self.ry =
-00039850: 2073 656c 662e 7279 2e76 616c 7565 2872   self.ry.value(r
-00039860: 656c 6174 6976 655f 6c65 6e67 7468 3d68  elative_length=h
-00039870: 6569 6768 742c 202a 2a6b 7761 7267 7329  eight, **kwargs)
-00039880: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00039890: 2073 656c 660d 0a0d 0a20 2020 2064 6566   self....    def
-000398a0: 2069 735f 6465 6765 6e65 7261 7465 2873   is_degenerate(s
-000398b0: 656c 6629 3a0d 0a20 2020 2020 2020 2072  elf):..        r
-000398c0: 6574 7572 6e20 280d 0a20 2020 2020 2020  eturn (..       
-000398d0: 2020 2020 2073 656c 662e 7769 6474 6820       self.width 
-000398e0: 3d3d 2030 0d0a 2020 2020 2020 2020 2020  == 0..          
-000398f0: 2020 6f72 2073 656c 662e 6865 6967 6874    or self.height
-00039900: 203d 3d20 300d 0a20 2020 2020 2020 2020   == 0..         
-00039910: 2020 206f 7220 7365 6c66 2e77 6964 7468     or self.width
-00039920: 2069 7320 4e6f 6e65 0d0a 2020 2020 2020   is None..      
-00039930: 2020 2020 2020 6f72 2073 656c 662e 6865        or self.he
-00039940: 6967 6874 2069 7320 4e6f 6e65 0d0a 2020  ight is None..  
-00039950: 2020 2020 2020 290d 0a0d 0a0d 0a63 6c61        )......cla
-00039960: 7373 205f 526f 756e 6453 6861 7065 2853  ss _RoundShape(S
-00039970: 6861 7065 293a 0d0a 2020 2020 6465 6620  hape):..    def 
-00039980: 5f5f 696e 6974 5f5f 2873 656c 662c 202a  __init__(self, *
-00039990: 6172 6773 2c20 2a2a 6b77 6172 6773 293a  args, **kwargs):
-000399a0: 0d0a 2020 2020 2020 2020 7365 6c66 2e63  ..        self.c
-000399b0: 7820 3d20 4e6f 6e65 0d0a 2020 2020 2020  x = None..      
-000399c0: 2020 7365 6c66 2e63 7920 3d20 4e6f 6e65    self.cy = None
-000399d0: 0d0a 2020 2020 2020 2020 7365 6c66 2e72  ..        self.r
-000399e0: 7820 3d20 4e6f 6e65 0d0a 2020 2020 2020  x = None..      
-000399f0: 2020 7365 6c66 2e72 7920 3d20 4e6f 6e65    self.ry = None
-00039a00: 0d0a 2020 2020 2020 2020 5368 6170 652e  ..        Shape.
-00039a10: 5f5f 696e 6974 5f5f 2873 656c 662c 202a  __init__(self, *
-00039a20: 6172 6773 2c20 2a2a 6b77 6172 6773 290d  args, **kwargs).
-00039a30: 0a0d 0a20 2020 2064 6566 2070 726f 7065  ...    def prope
-00039a40: 7274 795f 6279 5f6f 626a 6563 7428 7365  rty_by_object(se
-00039a50: 6c66 2c20 7329 3a0d 0a20 2020 2020 2020  lf, s):..       
-00039a60: 2053 6861 7065 2e70 726f 7065 7274 795f   Shape.property_
-00039a70: 6279 5f6f 626a 6563 7428 7365 6c66 2c20  by_object(self, 
-00039a80: 7329 0d0a 2020 2020 2020 2020 7365 6c66  s)..        self
-00039a90: 2e63 7820 3d20 732e 6378 0d0a 2020 2020  .cx = s.cx..    
-00039aa0: 2020 2020 7365 6c66 2e63 7920 3d20 732e      self.cy = s.
-00039ab0: 6379 0d0a 2020 2020 2020 2020 7365 6c66  cy..        self
-00039ac0: 2e72 7820 3d20 732e 7278 0d0a 2020 2020  .rx = s.rx..    
-00039ad0: 2020 2020 7365 6c66 2e72 7920 3d20 732e      self.ry = s.
-00039ae0: 7279 0d0a 0d0a 2020 2020 6465 6620 7072  ry....    def pr
-00039af0: 6f70 6572 7479 5f62 795f 7661 6c75 6573  operty_by_values
-00039b00: 2873 656c 662c 2076 616c 7565 7329 3a0d  (self, values):.
-00039b10: 0a20 2020 2020 2020 2053 6861 7065 2e70  .        Shape.p
-00039b20: 726f 7065 7274 795f 6279 5f76 616c 7565  roperty_by_value
-00039b30: 7328 7365 6c66 2c20 7661 6c75 6573 290d  s(self, values).
-00039b40: 0a20 2020 2020 2020 2073 656c 662e 6378  .        self.cx
-00039b50: 203d 204c 656e 6774 6828 7661 6c75 6573   = Length(values
-00039b60: 2e67 6574 2853 5647 5f41 5454 525f 4345  .get(SVG_ATTR_CE
-00039b70: 4e54 4552 5f58 2929 2e76 616c 7565 2829  NTER_X)).value()
-00039b80: 0d0a 2020 2020 2020 2020 7365 6c66 2e63  ..        self.c
-00039b90: 7920 3d20 4c65 6e67 7468 2876 616c 7565  y = Length(value
-00039ba0: 732e 6765 7428 5356 475f 4154 5452 5f43  s.get(SVG_ATTR_C
-00039bb0: 454e 5445 525f 5929 292e 7661 6c75 6528  ENTER_Y)).value(
-00039bc0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-00039bd0: 7278 203d 204c 656e 6774 6828 7661 6c75  rx = Length(valu
-00039be0: 6573 2e67 6574 2853 5647 5f41 5454 525f  es.get(SVG_ATTR_
-00039bf0: 5241 4449 5553 5f58 2929 2e76 616c 7565  RADIUS_X)).value
-00039c00: 2829 0d0a 2020 2020 2020 2020 7365 6c66  ()..        self
-00039c10: 2e72 7920 3d20 4c65 6e67 7468 2876 616c  .ry = Length(val
-00039c20: 7565 732e 6765 7428 5356 475f 4154 5452  ues.get(SVG_ATTR
-00039c30: 5f52 4144 4955 535f 5929 292e 7661 6c75  _RADIUS_Y)).valu
-00039c40: 6528 290d 0a20 2020 2020 2020 2072 203d  e()..        r =
-00039c50: 204c 656e 6774 6828 7661 6c75 6573 2e67   Length(values.g
-00039c60: 6574 2853 5647 5f41 5454 525f 5241 4449  et(SVG_ATTR_RADI
-00039c70: 5553 2c20 4e6f 6e65 2929 2e76 616c 7565  US, None)).value
-00039c80: 2829 0d0a 2020 2020 2020 2020 6966 2072  ()..        if r
-00039c90: 2069 7320 6e6f 7420 4e6f 6e65 3a0d 0a20   is not None:.. 
-00039ca0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00039cb0: 7278 203d 2072 0d0a 2020 2020 2020 2020  rx = r..        
-00039cc0: 2020 2020 7365 6c66 2e72 7920 3d20 720d      self.ry = r.
-00039cd0: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
-00039ce0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-00039cf0: 656c 662e 7278 2069 7320 4e6f 6e65 3a0d  elf.rx is None:.
-00039d00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00039d10: 2073 656c 662e 7278 203d 2031 0d0a 2020   self.rx = 1..  
-00039d20: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-00039d30: 662e 7279 2069 7320 4e6f 6e65 3a0d 0a20  f.ry is None:.. 
-00039d40: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00039d50: 656c 662e 7279 203d 2031 0d0a 2020 2020  elf.ry = 1..    
-00039d60: 2020 2020 6365 6e74 6572 203d 2076 616c      center = val
-00039d70: 7565 732e 6765 7428 2263 656e 7465 7222  ues.get("center"
-00039d80: 2c20 4e6f 6e65 290d 0a20 2020 2020 2020  , None)..       
-00039d90: 2069 6620 6365 6e74 6572 2069 7320 6e6f   if center is no
-00039da0: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
-00039db0: 2020 2020 2073 656c 662e 6378 2c20 7365       self.cx, se
-00039dc0: 6c66 2e63 7920 3d20 506f 696e 7428 6365  lf.cy = Point(ce
-00039dd0: 6e74 6572 290d 0a0d 0a20 2020 2020 2020  nter)....       
-00039de0: 2069 6620 7365 6c66 2e63 7820 6973 204e   if self.cx is N
-00039df0: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
-00039e00: 2020 7365 6c66 2e63 7820 3d20 300d 0a20    self.cx = 0.. 
-00039e10: 2020 2020 2020 2069 6620 7365 6c66 2e63         if self.c
-00039e20: 7920 6973 204e 6f6e 653a 0d0a 2020 2020  y is None:..    
-00039e30: 2020 2020 2020 2020 7365 6c66 2e63 7920          self.cy 
-00039e40: 3d20 300d 0a0d 0a20 2020 2064 6566 2070  = 0....    def p
-00039e50: 726f 7065 7274 795f 6279 5f61 7267 7328  roperty_by_args(
-00039e60: 7365 6c66 2c20 2a61 7267 7329 3a0d 0a20  self, *args):.. 
-00039e70: 2020 2020 2020 2061 7267 5f6c 656e 6774         arg_lengt
-00039e80: 6820 3d20 6c65 6e28 6172 6773 290d 0a20  h = len(args).. 
-00039e90: 2020 2020 2020 2069 6620 6172 675f 6c65         if arg_le
-00039ea0: 6e67 7468 203e 3d20 313a 0d0a 2020 2020  ngth >= 1:..    
-00039eb0: 2020 2020 2020 2020 7365 6c66 2e63 7820          self.cx 
-00039ec0: 3d20 4c65 6e67 7468 2861 7267 735b 305d  = Length(args[0]
-00039ed0: 292e 7661 6c75 6528 290d 0a20 2020 2020  ).value()..     
-00039ee0: 2020 2069 6620 6172 675f 6c65 6e67 7468     if arg_length
-00039ef0: 203e 3d20 323a 0d0a 2020 2020 2020 2020   >= 2:..        
-00039f00: 2020 2020 7365 6c66 2e63 7920 3d20 4c65      self.cy = Le
-00039f10: 6e67 7468 2861 7267 735b 315d 292e 7661  ngth(args[1]).va
-00039f20: 6c75 6528 290d 0a20 2020 2020 2020 2069  lue()..        i
-00039f30: 6620 6172 675f 6c65 6e67 7468 203e 3d20  f arg_length >= 
-00039f40: 333a 0d0a 2020 2020 2020 2020 2020 2020  3:..            
-00039f50: 7365 6c66 2e72 7820 3d20 4c65 6e67 7468  self.rx = Length
-00039f60: 2861 7267 735b 325d 292e 7661 6c75 6528  (args[2]).value(
-00039f70: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
-00039f80: 6620 6172 675f 6c65 6e67 7468 203e 3d20  f arg_length >= 
-00039f90: 343a 0d0a 2020 2020 2020 2020 2020 2020  4:..            
-00039fa0: 2020 2020 7365 6c66 2e72 7920 3d20 4c65      self.ry = Le
-00039fb0: 6e67 7468 2861 7267 735b 335d 292e 7661  ngth(args[3]).va
-00039fc0: 6c75 6528 290d 0a20 2020 2020 2020 2020  lue()..         
-00039fd0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-00039fe0: 2020 2020 2020 2020 2020 7365 6c66 2e72            self.r
-00039ff0: 7920 3d20 7365 6c66 2e72 780d 0a20 2020  y = self.rx..   
-0003a000: 2020 2020 2069 6620 6172 675f 6c65 6e67       if arg_leng
-0003a010: 7468 203e 3d20 353a 0d0a 2020 2020 2020  th >= 5:..      
-0003a020: 2020 2020 2020 7365 6c66 2e5f 696e 6974        self._init
-0003a030: 5f73 6861 7065 282a 6172 6773 5b34 3a5d  _shape(*args[4:]
-0003a040: 290d 0a0d 0a20 2020 2064 6566 205f 6174  )....    def _at
-0003a050: 7472 7328 7365 6c66 2c20 7661 6c75 6573  trs(self, values
-0003a060: 293a 0d0a 2020 2020 2020 2020 6966 2073  ):..        if s
-0003a070: 656c 662e 6378 2069 7320 6e6f 7420 4e6f  elf.cx is not No
-0003a080: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
-0003a090: 2076 616c 7565 732e 6170 7065 6e64 2822   values.append("
-0003a0a0: 2573 3d25 7322 2025 2028 5356 475f 4154  %s=%s" % (SVG_AT
-0003a0b0: 5452 5f43 454e 5445 525f 582c 204c 656e  TR_CENTER_X, Len
-0003a0c0: 6774 682e 7374 7228 7365 6c66 2e63 7829  gth.str(self.cx)
-0003a0d0: 2929 0d0a 2020 2020 2020 2020 6966 2073  ))..        if s
-0003a0e0: 656c 662e 6379 2069 7320 6e6f 7420 4e6f  elf.cy is not No
-0003a0f0: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
-0003a100: 2076 616c 7565 732e 6170 7065 6e64 2822   values.append("
-0003a110: 2573 3d25 7322 2025 2028 5356 475f 4154  %s=%s" % (SVG_AT
-0003a120: 5452 5f43 454e 5445 525f 592c 204c 656e  TR_CENTER_Y, Len
-0003a130: 6774 682e 7374 7228 7365 6c66 2e63 7929  gth.str(self.cy)
-0003a140: 2929 0d0a 2020 2020 2020 2020 6966 2073  ))..        if s
-0003a150: 656c 662e 7278 203d 3d20 7365 6c66 2e72  elf.rx == self.r
-0003a160: 7920 6f72 2073 656c 662e 7279 2069 7320  y or self.ry is 
-0003a170: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
-0003a180: 2020 2076 616c 7565 732e 6170 7065 6e64     values.append
-0003a190: 2822 2573 3d25 7322 2025 2028 5356 475f  ("%s=%s" % (SVG_
-0003a1a0: 4154 5452 5f52 4144 4955 532c 204c 656e  ATTR_RADIUS, Len
-0003a1b0: 6774 682e 7374 7228 7365 6c66 2e72 7829  gth.str(self.rx)
-0003a1c0: 2929 0d0a 2020 2020 2020 2020 656c 7365  ))..        else
-0003a1d0: 3a0d 0a20 2020 2020 2020 2020 2020 2076  :..            v
-0003a1e0: 616c 7565 732e 6170 7065 6e64 2822 2573  alues.append("%s
-0003a1f0: 3d25 7322 2025 2028 5356 475f 4154 5452  =%s" % (SVG_ATTR
-0003a200: 5f52 4144 4955 535f 582c 204c 656e 6774  _RADIUS_X, Lengt
-0003a210: 682e 7374 7228 7365 6c66 2e72 7829 2929  h.str(self.rx)))
-0003a220: 0d0a 2020 2020 2020 2020 2020 2020 7661  ..            va
-0003a230: 6c75 6573 2e61 7070 656e 6428 2225 733d  lues.append("%s=
-0003a240: 2573 2220 2520 2853 5647 5f41 5454 525f  %s" % (SVG_ATTR_
-0003a250: 5241 4449 5553 5f59 2c20 4c65 6e67 7468  RADIUS_Y, Length
-0003a260: 2e73 7472 2873 656c 662e 7279 2929 290d  .str(self.ry))).
-0003a270: 0a0d 0a20 2020 2064 6566 205f 5f72 6570  ...    def __rep
-0003a280: 725f 5f28 7365 6c66 293a 0d0a 2020 2020  r__(self):..    
-0003a290: 2020 2020 7661 6c75 6573 203d 205b 5d0d      values = [].
-0003a2a0: 0a20 2020 2020 2020 2073 656c 662e 5f61  .        self._a
-0003a2b0: 7474 7273 2876 616c 7565 7329 0d0a 2020  ttrs(values)..  
-0003a2c0: 2020 2020 2020 7365 6c66 2e5f 7265 7072        self._repr
-0003a2d0: 5f73 6861 7065 2876 616c 7565 7329 0d0a  _shape(values)..
-0003a2e0: 2020 2020 2020 2020 7061 7261 6d73 203d          params =
-0003a2f0: 2022 2c20 222e 6a6f 696e 2876 616c 7565   ", ".join(value
-0003a300: 7329 0d0a 2020 2020 2020 2020 7265 7475  s)..        retu
-0003a310: 726e 2022 2573 2825 7329 2220 2520 2873  rn "%s(%s)" % (s
-0003a320: 656c 662e 5f5f 636c 6173 735f 5f2e 5f5f  elf.__class__.__
-0003a330: 6e61 6d65 5f5f 2c20 7061 7261 6d73 290d  name__, params).
-0003a340: 0a0d 0a20 2020 2064 6566 205f 5f73 7472  ...    def __str
-0003a350: 5f5f 2873 656c 6629 3a0d 0a20 2020 2020  __(self):..     
-0003a360: 2020 2076 616c 7565 7320 3d20 5b5d 0d0a     values = []..
-0003a370: 2020 2020 2020 2020 7365 6c66 2e5f 6174          self._at
-0003a380: 7472 7328 7661 6c75 6573 290d 0a20 2020  trs(values)..   
-0003a390: 2020 2020 2073 656c 662e 5f73 7472 5f73       self._str_s
-0003a3a0: 6861 7065 2876 616c 7565 7329 0d0a 2020  hape(values)..  
-0003a3b0: 2020 2020 2020 7061 7261 6d73 203d 2022        params = "
-0003a3c0: 2c20 222e 6a6f 696e 2876 616c 7565 7329  , ".join(values)
-0003a3d0: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-0003a3e0: 2022 2573 2825 7329 2220 2520 2873 656c   "%s(%s)" % (sel
-0003a3f0: 662e 5f5f 636c 6173 735f 5f2e 5f5f 6e61  f.__class__.__na
-0003a400: 6d65 5f5f 2c20 7061 7261 6d73 290d 0a0d  me__, params)...
-0003a410: 0a20 2020 2040 7072 6f70 6572 7479 0d0a  .    @property..
-0003a420: 2020 2020 6465 6620 696d 706c 6963 6974      def implicit
-0003a430: 5f72 7828 7365 6c66 293a 0d0a 2020 2020  _rx(self):..    
-0003a440: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
-0003a450: 6170 706c 793a 0d0a 2020 2020 2020 2020  apply:..        
-0003a460: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-0003a470: 7278 0d0a 2020 2020 2020 2020 7072 7820  rx..        prx 
-0003a480: 3d20 506f 696e 7428 7365 6c66 2e72 782c  = Point(self.rx,
-0003a490: 2030 290d 0a20 2020 2020 2020 2070 7278   0)..        prx
-0003a4a0: 202a 3d20 7365 6c66 2e74 7261 6e73 666f   *= self.transfo
-0003a4b0: 726d 0d0a 2020 2020 2020 2020 6f72 6967  rm..        orig
-0003a4c0: 696e 203d 2050 6f69 6e74 2830 2c20 3029  in = Point(0, 0)
-0003a4d0: 0d0a 2020 2020 2020 2020 6f72 6967 696e  ..        origin
-0003a4e0: 202a 3d20 7365 6c66 2e74 7261 6e73 666f   *= self.transfo
-0003a4f0: 726d 0d0a 2020 2020 2020 2020 7265 7475  rm..        retu
-0003a500: 726e 206f 7269 6769 6e2e 6469 7374 616e  rn origin.distan
-0003a510: 6365 5f74 6f28 7072 7829 0d0a 0d0a 2020  ce_to(prx)....  
-0003a520: 2020 4070 726f 7065 7274 790d 0a20 2020    @property..   
-0003a530: 2064 6566 2069 6d70 6c69 6369 745f 7279   def implicit_ry
-0003a540: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
-0003a550: 2069 6620 6e6f 7420 7365 6c66 2e61 7070   if not self.app
-0003a560: 6c79 3a0d 0a20 2020 2020 2020 2020 2020  ly:..           
-0003a570: 2072 6574 7572 6e20 7365 6c66 2e72 790d   return self.ry.
-0003a580: 0a20 2020 2020 2020 2070 7279 203d 2050  .        pry = P
-0003a590: 6f69 6e74 2830 2c20 7365 6c66 2e72 7929  oint(0, self.ry)
-0003a5a0: 0d0a 2020 2020 2020 2020 7072 7920 2a3d  ..        pry *=
-0003a5b0: 2073 656c 662e 7472 616e 7366 6f72 6d0d   self.transform.
-0003a5c0: 0a20 2020 2020 2020 206f 7269 6769 6e20  .        origin 
-0003a5d0: 3d20 506f 696e 7428 302c 2030 290d 0a20  = Point(0, 0).. 
-0003a5e0: 2020 2020 2020 206f 7269 6769 6e20 2a3d         origin *=
-0003a5f0: 2073 656c 662e 7472 616e 7366 6f72 6d0d   self.transform.
-0003a600: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0003a610: 6f72 6967 696e 2e64 6973 7461 6e63 655f  origin.distance_
-0003a620: 746f 2870 7279 290d 0a0d 0a20 2020 2069  to(pry)....    i
-0003a630: 6d70 6c69 6369 745f 7220 3d20 696d 706c  mplicit_r = impl
-0003a640: 6963 6974 5f72 780d 0a0d 0a20 2020 2040  icit_rx....    @
-0003a650: 7072 6f70 6572 7479 0d0a 2020 2020 6465  property..    de
-0003a660: 6620 696d 706c 6963 6974 5f63 656e 7465  f implicit_cente
-0003a670: 7228 7365 6c66 293a 0d0a 2020 2020 2020  r(self):..      
-0003a680: 2020 6365 6e74 6572 203d 2050 6f69 6e74    center = Point
-0003a690: 2873 656c 662e 6378 2c20 7365 6c66 2e63  (self.cx, self.c
-0003a6a0: 7929 0d0a 2020 2020 2020 2020 6966 206e  y)..        if n
-0003a6b0: 6f74 2073 656c 662e 6170 706c 793a 0d0a  ot self.apply:..
-0003a6c0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0003a6d0: 726e 2063 656e 7465 720d 0a20 2020 2020  rn center..     
-0003a6e0: 2020 2063 656e 7465 7220 2a3d 2073 656c     center *= sel
-0003a6f0: 662e 7472 616e 7366 6f72 6d0d 0a20 2020  f.transform..   
-0003a700: 2020 2020 2072 6574 7572 6e20 6365 6e74       return cent
-0003a710: 6572 0d0a 0d0a 2020 2020 6465 6620 7365  er....    def se
-0003a720: 676d 656e 7473 2873 656c 662c 2074 7261  gments(self, tra
-0003a730: 6e73 666f 726d 6564 3d54 7275 6529 3a0d  nsformed=True):.
-0003a740: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
-0003a750: 2020 2020 2020 5356 4720 7061 7468 2064        SVG path d
-0003a760: 6563 6f6d 706f 7369 7469 6f6e 2069 7320  ecomposition is 
-0003a770: 6769 7665 6e20 696e 2053 5647 2032 2e30  given in SVG 2.0
-0003a780: 2031 302e 332c 2031 302e 342e 0d0a 0d0a   10.3, 10.4.....
-0003a790: 2020 2020 2020 2020 4120 6d6f 7665 2d74          A move-t
-0003a7a0: 6f20 636f 6d6d 616e 6420 746f 2074 6865  o command to the
-0003a7b0: 2070 6f69 6e74 2063 782b 7278 2c63 793b   point cx+rx,cy;
-0003a7c0: 0d0a 2020 2020 2020 2020 6172 6320 746f  ..        arc to
-0003a7d0: 2063 782c 6379 2b72 793b 0d0a 2020 2020   cx,cy+ry;..    
-0003a7e0: 2020 2020 6172 6320 746f 2063 782d 7278      arc to cx-rx
-0003a7f0: 2c63 793b 0d0a 2020 2020 2020 2020 6172  ,cy;..        ar
-0003a800: 6320 746f 2063 782c 6379 2d72 793b 0d0a  c to cx,cy-ry;..
-0003a810: 2020 2020 2020 2020 6172 6320 7769 7468          arc with
-0003a820: 2061 2073 6567 6d65 6e74 2d63 6f6d 706c   a segment-compl
-0003a830: 6574 696e 6720 636c 6f73 6520 7061 7468  eting close path
-0003a840: 206f 7065 7261 7469 6f6e 2e0d 0a0d 0a20   operation..... 
-0003a850: 2020 2020 2020 2043 6f6e 7665 7274 7320         Converts 
-0003a860: 7468 6520 7061 7261 6d65 7465 7273 2066  the parameters f
-0003a870: 726f 6d20 616e 2065 6c6c 6970 7365 206f  rom an ellipse o
-0003a880: 7220 6120 6369 7263 6c65 2074 6f20 6120  r a circle to a 
-0003a890: 7374 7269 6e67 2066 6f72 2061 0d0a 2020  string for a..  
-0003a8a0: 2020 2020 2020 5061 7468 206f 626a 6563        Path objec
-0003a8b0: 7420 642d 6174 7472 6962 7574 6522 2222  t d-attribute"""
-0003a8c0: 0d0a 2020 2020 2020 2020 6f72 6967 696e  ..        origin
-0003a8d0: 616c 203d 2073 656c 662e 6170 706c 790d  al = self.apply.
-0003a8e0: 0a20 2020 2020 2020 2073 656c 662e 6170  .        self.ap
-0003a8f0: 706c 7920 3d20 7472 616e 7366 6f72 6d65  ply = transforme
-0003a900: 640d 0a20 2020 2020 2020 2070 6174 6820  d..        path 
-0003a910: 3d20 5061 7468 2829 0d0a 2020 2020 2020  = Path()..      
-0003a920: 2020 7374 6570 7320 3d20 340d 0a20 2020    steps = 4..   
-0003a930: 2020 2020 2073 7465 705f 7369 7a65 203d       step_size =
-0003a940: 2074 6175 202f 2073 7465 7073 0d0a 2020   tau / steps..  
-0003a950: 2020 2020 2020 6966 2028 0d0a 2020 2020        if (..    
-0003a960: 2020 2020 2020 2020 7472 616e 7366 6f72          transfor
-0003a970: 6d65 640d 0a20 2020 2020 2020 2020 2020  med..           
-0003a980: 2061 6e64 2073 656c 662e 7472 616e 7366   and self.transf
-0003a990: 6f72 6d2e 7661 6c75 655f 7363 616c 655f  orm.value_scale_
-0003a9a0: 7828 2920 2a20 7365 6c66 2e74 7261 6e73  x() * self.trans
-0003a9b0: 666f 726d 2e76 616c 7565 5f73 6361 6c65  form.value_scale
-0003a9c0: 5f79 2829 203c 2030 0d0a 2020 2020 2020  _y() < 0..      
-0003a9d0: 2020 293a 0d0a 2020 2020 2020 2020 2020    ):..          
-0003a9e0: 2020 7374 6570 5f73 697a 6520 3d20 2d73    step_size = -s
-0003a9f0: 7465 705f 7369 7a65 0d0a 2020 2020 2020  tep_size..      
-0003aa00: 2020 745f 7374 6172 7420 3d20 300d 0a20    t_start = 0.. 
-0003aa10: 2020 2020 2020 2074 5f65 6e64 203d 2073         t_end = s
-0003aa20: 7465 705f 7369 7a65 0d0a 2020 2020 2020  tep_size..      
-0003aa30: 2020 2320 7a65 726f 2066 6f72 2065 6974    # zero for eit
-0003aa40: 6865 7220 6469 6d65 6e73 696f 6e2c 206f  her dimension, o
-0003aa50: 7220 6120 636f 6d70 7574 6564 2076 616c  r a computed val
-0003aa60: 7565 206f 6620 6175 746f 2066 6f72 2062  ue of auto for b
-0003aa70: 6f74 6820 6469 6d65 6e73 696f 6e73 2c20  oth dimensions, 
-0003aa80: 6469 7361 626c 6573 2072 656e 6465 7269  disables renderi
-0003aa90: 6e67 206f 6620 7468 6520 656c 656d 656e  ng of the elemen
-0003aaa0: 742e 0d0a 2020 2020 2020 2020 7278 203d  t...        rx =
-0003aab0: 2073 656c 662e 696d 706c 6963 6974 5f72   self.implicit_r
-0003aac0: 780d 0a20 2020 2020 2020 2072 7920 3d20  x..        ry = 
-0003aad0: 7365 6c66 2e69 6d70 6c69 6369 745f 7279  self.implicit_ry
-0003aae0: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
-0003aaf0: 662e 6973 5f64 6567 656e 6572 6174 6528  f.is_degenerate(
-0003ab00: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-0003ab10: 7265 7475 726e 2028 290d 0a20 2020 2020  return ()..     
-0003ab20: 2020 2063 656e 7465 7220 3d20 7365 6c66     center = self
-0003ab30: 2e69 6d70 6c69 6369 745f 6365 6e74 6572  .implicit_center
-0003ab40: 0d0a 2020 2020 2020 2020 7061 7468 2e6d  ..        path.m
-0003ab50: 6f76 6528 2873 656c 662e 706f 696e 745f  ove((self.point_
-0003ab60: 6174 5f74 2830 2929 290d 0a20 2020 2020  at_t(0)))..     
-0003ab70: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
-0003ab80: 6528 7374 6570 7329 3a0d 0a20 2020 2020  e(steps):..     
-0003ab90: 2020 2020 2020 2070 6174 6820 2b3d 2041         path += A
-0003aba0: 7263 280d 0a20 2020 2020 2020 2020 2020  rc(..           
-0003abb0: 2020 2020 2073 656c 662e 706f 696e 745f       self.point_
-0003abc0: 6174 5f74 2874 5f73 7461 7274 292c 0d0a  at_t(t_start),..
-0003abd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003abe0: 7365 6c66 2e70 6f69 6e74 5f61 745f 7428  self.point_at_t(
-0003abf0: 745f 656e 6429 2c0d 0a20 2020 2020 2020  t_end),..       
-0003ac00: 2020 2020 2020 2020 2063 656e 7465 722c           center,
-0003ac10: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0003ac20: 2020 7278 3d72 782c 0d0a 2020 2020 2020    rx=rx,..      
-0003ac30: 2020 2020 2020 2020 2020 7279 3d72 792c            ry=ry,
-0003ac40: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0003ac50: 2020 726f 7461 7469 6f6e 3d73 656c 662e    rotation=self.
-0003ac60: 726f 7461 7469 6f6e 2c0d 0a20 2020 2020  rotation,..     
-0003ac70: 2020 2020 2020 2020 2020 2073 7765 6570             sweep
-0003ac80: 3d73 7465 705f 7369 7a65 2c0d 0a20 2020  =step_size,..   
-0003ac90: 2020 2020 2020 2020 2029 0d0a 2020 2020           )..    
-0003aca0: 2020 2020 2020 2020 745f 7374 6172 7420          t_start 
-0003acb0: 3d20 745f 656e 640d 0a20 2020 2020 2020  = t_end..       
-0003acc0: 2020 2020 2074 5f65 6e64 202b 3d20 7374       t_end += st
-0003acd0: 6570 5f73 697a 650d 0a20 2020 2020 2020  ep_size..       
-0003ace0: 2070 6174 682e 636c 6f73 6564 2829 0d0a   path.closed()..
-0003acf0: 2020 2020 2020 2020 7365 6c66 2e61 7070          self.app
-0003ad00: 6c79 203d 206f 7269 6769 6e61 6c0d 0a20  ly = original.. 
-0003ad10: 2020 2020 2020 2072 6574 7572 6e20 7061         return pa
-0003ad20: 7468 2e73 6567 6d65 6e74 7328 7472 616e  th.segments(tran
-0003ad30: 7366 6f72 6d65 6429 0d0a 0d0a 2020 2020  sformed)....    
-0003ad40: 6465 6620 7265 6966 7928 7365 6c66 293a  def reify(self):
-0003ad50: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
-0003ad60: 2020 2020 2020 2052 6561 6c69 7a65 7320         Realizes 
-0003ad70: 7468 6520 7472 616e 7366 6f72 6d20 746f  the transform to
-0003ad80: 2074 6865 2073 6861 7065 2070 726f 7065   the shape prope
-0003ad90: 7274 6965 732e 0d0a 0d0a 2020 2020 2020  rties.....      
-0003ada0: 2020 536b 6577 6564 2061 6e64 2052 6f74    Skewed and Rot
-0003adb0: 6174 6564 2072 6f75 6e64 7368 6170 6573  ated roundshapes
-0003adc0: 2063 616e 6e6f 7420 6265 2072 6569 6669   cannot be reifi
-0003add0: 6564 2e0d 0a20 2020 2020 2020 2022 2222  ed...        """
-0003ade0: 0d0a 2020 2020 2020 2020 7363 616c 655f  ..        scale_
-0003adf0: 7820 3d20 7365 6c66 2e74 7261 6e73 666f  x = self.transfo
-0003ae00: 726d 2e76 616c 7565 5f73 6361 6c65 5f78  rm.value_scale_x
-0003ae10: 2829 0d0a 2020 2020 2020 2020 7363 616c  ()..        scal
-0003ae20: 655f 7920 3d20 7365 6c66 2e74 7261 6e73  e_y = self.trans
-0003ae30: 666f 726d 2e76 616c 7565 5f73 6361 6c65  form.value_scale
-0003ae40: 5f79 2829 0d0a 2020 2020 2020 2020 6966  _y()..        if
-0003ae50: 2073 6361 6c65 5f79 202a 2073 6361 6c65   scale_y * scale
-0003ae60: 5f78 203c 2030 3a0d 0a20 2020 2020 2020  _x < 0:..       
-0003ae70: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-0003ae80: 2020 2320 4e6f 2072 6569 6669 6361 7469    # No reificati
-0003ae90: 6f6e 206f 6620 666c 6970 7065 6420 7661  on of flipped va
-0003aea0: 6c75 6573 2e0d 0a20 2020 2020 2020 2074  lues...        t
-0003aeb0: 7261 6e73 6c61 7465 5f78 203d 2073 656c  ranslate_x = sel
-0003aec0: 662e 7472 616e 7366 6f72 6d2e 7661 6c75  f.transform.valu
-0003aed0: 655f 7472 616e 735f 7828 290d 0a20 2020  e_trans_x()..   
-0003aee0: 2020 2020 2074 7261 6e73 6c61 7465 5f79       translate_y
-0003aef0: 203d 2073 656c 662e 7472 616e 7366 6f72   = self.transfor
-0003af00: 6d2e 7661 6c75 655f 7472 616e 735f 7928  m.value_trans_y(
-0003af10: 290d 0a20 2020 2020 2020 2069 6620 280d  )..        if (.
-0003af20: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0003af30: 662e 7472 616e 7366 6f72 6d2e 7661 6c75  f.transform.valu
-0003af40: 655f 736b 6577 5f78 2829 203d 3d20 300d  e_skew_x() == 0.
-0003af50: 0a20 2020 2020 2020 2020 2020 2061 6e64  .            and
-0003af60: 2073 656c 662e 7472 616e 7366 6f72 6d2e   self.transform.
-0003af70: 7661 6c75 655f 736b 6577 5f79 2829 203d  value_skew_y() =
-0003af80: 3d20 300d 0a20 2020 2020 2020 2020 2020  = 0..           
-0003af90: 2061 6e64 2073 6361 6c65 5f78 2021 3d20   and scale_x != 
-0003afa0: 300d 0a20 2020 2020 2020 2020 2020 2061  0..            a
-0003afb0: 6e64 2073 6361 6c65 5f79 2021 3d20 300d  nd scale_y != 0.
-0003afc0: 0a20 2020 2020 2020 2029 3a0d 0a20 2020  .        ):..   
-0003afd0: 2020 2020 2020 2020 2047 7261 7068 6963           Graphic
-0003afe0: 4f62 6a65 6374 2e72 6569 6679 2873 656c  Object.reify(sel
-0003aff0: 6629 0d0a 2020 2020 2020 2020 2020 2020  f)..            
-0003b000: 5472 616e 7366 6f72 6d61 626c 652e 7265  Transformable.re
-0003b010: 6966 7928 7365 6c66 290d 0a20 2020 2020  ify(self)..     
-0003b020: 2020 2020 2020 2073 656c 662e 6378 202a         self.cx *
-0003b030: 3d20 7363 616c 655f 780d 0a20 2020 2020  = scale_x..     
-0003b040: 2020 2020 2020 2073 656c 662e 6379 202a         self.cy *
-0003b050: 3d20 7363 616c 655f 790d 0a20 2020 2020  = scale_y..     
-0003b060: 2020 2020 2020 2073 656c 662e 6378 202b         self.cx +
-0003b070: 3d20 7472 616e 736c 6174 655f 780d 0a20  = translate_x.. 
-0003b080: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0003b090: 6379 202b 3d20 7472 616e 736c 6174 655f  cy += translate_
-0003b0a0: 790d 0a20 2020 2020 2020 2020 2020 2073  y..            s
-0003b0b0: 656c 662e 7472 616e 7366 6f72 6d20 2a3d  elf.transform *=
-0003b0c0: 204d 6174 7269 782e 7472 616e 736c 6174   Matrix.translat
-0003b0d0: 6528 2d74 7261 6e73 6c61 7465 5f78 2c20  e(-translate_x, 
-0003b0e0: 2d74 7261 6e73 6c61 7465 5f79 290d 0a20  -translate_y).. 
-0003b0f0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0003b100: 7278 203d 2073 6361 6c65 5f78 202a 2073  rx = scale_x * s
-0003b110: 656c 662e 7278 0d0a 2020 2020 2020 2020  elf.rx..        
-0003b120: 2020 2020 7365 6c66 2e72 7920 3d20 7363      self.ry = sc
-0003b130: 616c 655f 7920 2a20 7365 6c66 2e72 790d  ale_y * self.ry.
-0003b140: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0003b150: 662e 7472 616e 7366 6f72 6d20 2a3d 204d  f.transform *= M
-0003b160: 6174 7269 782e 7363 616c 6528 312e 3020  atrix.scale(1.0 
-0003b170: 2f20 7363 616c 655f 782c 2031 2e30 202f  / scale_x, 1.0 /
-0003b180: 2073 6361 6c65 5f79 290d 0a20 2020 2020   scale_y)..     
-0003b190: 2020 2072 6574 7572 6e20 7365 6c66 0d0a     return self..
-0003b1a0: 0d0a 2020 2020 6465 6620 7265 6e64 6572  ..    def render
-0003b1b0: 2873 656c 662c 202a 2a6b 7761 7267 7329  (self, **kwargs)
-0003b1c0: 3a0d 0a20 2020 2020 2020 2053 6861 7065  :..        Shape
-0003b1d0: 2e72 656e 6465 7228 7365 6c66 2c20 2a2a  .render(self, **
-0003b1e0: 6b77 6172 6773 290d 0a20 2020 2020 2020  kwargs)..       
-0003b1f0: 2077 6964 7468 203d 206b 7761 7267 732e   width = kwargs.
-0003b200: 6765 7428 2277 6964 7468 222c 206b 7761  get("width", kwa
-0003b210: 7267 732e 6765 7428 2272 656c 6174 6976  rgs.get("relativ
-0003b220: 655f 6c65 6e67 7468 2229 290d 0a20 2020  e_length"))..   
-0003b230: 2020 2020 2068 6569 6768 7420 3d20 6b77       height = kw
-0003b240: 6172 6773 2e67 6574 2822 6865 6967 6874  args.get("height
-0003b250: 222c 206b 7761 7267 732e 6765 7428 2272  ", kwargs.get("r
-0003b260: 656c 6174 6976 655f 6c65 6e67 7468 2229  elative_length")
-0003b270: 290d 0a20 2020 2020 2020 2074 7279 3a0d  )..        try:.
-0003b280: 0a20 2020 2020 2020 2020 2020 2064 656c  .            del
-0003b290: 206b 7761 7267 735b 2272 656c 6174 6976   kwargs["relativ
-0003b2a0: 655f 6c65 6e67 7468 225d 0d0a 2020 2020  e_length"]..    
-0003b2b0: 2020 2020 6578 6365 7074 204b 6579 4572      except KeyEr
-0003b2c0: 726f 723a 0d0a 2020 2020 2020 2020 2020  ror:..          
-0003b2d0: 2020 7061 7373 0d0a 2020 2020 2020 2020    pass..        
-0003b2e0: 6966 2069 7369 6e73 7461 6e63 6528 7365  if isinstance(se
-0003b2f0: 6c66 2e63 782c 204c 656e 6774 6829 3a0d  lf.cx, Length):.
-0003b300: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0003b310: 662e 6378 203d 2073 656c 662e 6378 2e76  f.cx = self.cx.v
-0003b320: 616c 7565 2872 656c 6174 6976 655f 6c65  alue(relative_le
-0003b330: 6e67 7468 3d77 6964 7468 2c20 2a2a 6b77  ngth=width, **kw
-0003b340: 6172 6773 290d 0a20 2020 2020 2020 2069  args)..        i
-0003b350: 6620 6973 696e 7374 616e 6365 2873 656c  f isinstance(sel
-0003b360: 662e 6379 2c20 4c65 6e67 7468 293a 0d0a  f.cy, Length):..
-0003b370: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0003b380: 2e63 7920 3d20 7365 6c66 2e63 792e 7661  .cy = self.cy.va
-0003b390: 6c75 6528 7265 6c61 7469 7665 5f6c 656e  lue(relative_len
-0003b3a0: 6774 683d 6865 6967 6874 2c20 2a2a 6b77  gth=height, **kw
-0003b3b0: 6172 6773 290d 0a20 2020 2020 2020 2069  args)..        i
-0003b3c0: 6620 6973 696e 7374 616e 6365 2873 656c  f isinstance(sel
-0003b3d0: 662e 7278 2c20 4c65 6e67 7468 293a 0d0a  f.rx, Length):..
-0003b3e0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0003b3f0: 2e72 7820 3d20 7365 6c66 2e72 782e 7661  .rx = self.rx.va
-0003b400: 6c75 6528 7265 6c61 7469 7665 5f6c 656e  lue(relative_len
-0003b410: 6774 683d 7769 6474 682c 202a 2a6b 7761  gth=width, **kwa
-0003b420: 7267 7329 0d0a 2020 2020 2020 2020 6966  rgs)..        if
-0003b430: 2069 7369 6e73 7461 6e63 6528 7365 6c66   isinstance(self
-0003b440: 2e72 792c 204c 656e 6774 6829 3a0d 0a20  .ry, Length):.. 
-0003b450: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0003b460: 7279 203d 2073 656c 662e 7279 2e76 616c  ry = self.ry.val
-0003b470: 7565 2872 656c 6174 6976 655f 6c65 6e67  ue(relative_leng
-0003b480: 7468 3d68 6569 6768 742c 202a 2a6b 7761  th=height, **kwa
-0003b490: 7267 7329 0d0a 2020 2020 2020 2020 7265  rgs)..        re
-0003b4a0: 7475 726e 2073 656c 660d 0a0d 0a20 2020  turn self....   
-0003b4b0: 2064 6566 2069 735f 6465 6765 6e65 7261   def is_degenera
-0003b4c0: 7465 2873 656c 6629 3a0d 0a20 2020 2020  te(self):..     
-0003b4d0: 2020 2072 7820 3d20 7365 6c66 2e69 6d70     rx = self.imp
-0003b4e0: 6c69 6369 745f 7278 0d0a 2020 2020 2020  licit_rx..      
-0003b4f0: 2020 7279 203d 2073 656c 662e 696d 706c    ry = self.impl
-0003b500: 6963 6974 5f72 790d 0a20 2020 2020 2020  icit_ry..       
-0003b510: 2072 6574 7572 6e20 7278 203d 3d20 3020   return rx == 0 
-0003b520: 6f72 2072 7920 3d3d 2030 0d0a 0d0a 2020  or ry == 0....  
-0003b530: 2020 6465 6620 756e 6974 5f6d 6174 7269    def unit_matri
-0003b540: 7828 7365 6c66 293a 0d0a 2020 2020 2020  x(self):..      
-0003b550: 2020 2222 220d 0a20 2020 2020 2020 2072    """..        r
-0003b560: 6574 7572 6e20 7468 6520 756e 6974 206d  eturn the unit m
-0003b570: 6174 7269 7820 7768 6963 6820 636f 756c  atrix which coul
-0003b580: 6420 776f 756c 6420 7472 616e 7366 6f72  d would transfor
-0003b590: 6d20 7468 6520 756e 6974 2063 6972 636c  m the unit circl
-0003b5a0: 6520 696e 746f 2074 6869 7320 656c 6c69  e into this elli
-0003b5b0: 7073 652e 0d0a 0d0a 2020 2020 2020 2020  pse.....        
-0003b5c0: 4f6e 6520 6f66 2074 6865 2076 616c 6964  One of the valid
-0003b5d0: 2070 6172 616d 6574 6572 697a 6174 696f   parameterizatio
-0003b5e0: 6e73 2066 6f72 2065 6c6c 6970 7365 7320  ns for ellipses 
-0003b5f0: 6973 2074 6861 7420 7468 6579 2061 7265  is that they are
-0003b600: 2061 6c6c 2061 6666 696e 6520 7472 616e   all affine tran
-0003b610: 7366 6f72 6d73 206f 6620 7468 6520 756e  sforms of the un
-0003b620: 6974 2063 6972 636c 652e 0d0a 2020 2020  it circle...    
-0003b630: 2020 2020 5468 6973 2070 726f 7669 6465      This provide
-0003b640: 7320 6578 6163 746c 7920 7375 6368 2061  s exactly such a
-0003b650: 206d 6174 7269 782e 0d0a 0d0a 2020 2020   matrix.....    
-0003b660: 2020 2020 3a72 6574 7572 6e3a 206d 6174      :return: mat
-0003b670: 7269 780d 0a20 2020 2020 2020 2022 2222  rix..        """
-0003b680: 0d0a 2020 2020 2020 2020 6d20 3d20 4d61  ..        m = Ma
-0003b690: 7472 6978 2829 0d0a 2020 2020 2020 2020  trix()..        
-0003b6a0: 6d2e 706f 7374 5f73 6361 6c65 2873 656c  m.post_scale(sel
-0003b6b0: 662e 696d 706c 6963 6974 5f72 782c 2073  f.implicit_rx, s
-0003b6c0: 656c 662e 696d 706c 6963 6974 5f72 7929  elf.implicit_ry)
-0003b6d0: 0d0a 2020 2020 2020 2020 6d2e 706f 7374  ..        m.post
-0003b6e0: 5f72 6f74 6174 6528 7365 6c66 2e72 6f74  _rotate(self.rot
-0003b6f0: 6174 696f 6e29 0d0a 2020 2020 2020 2020  ation)..        
-0003b700: 6365 6e74 6572 203d 2073 656c 662e 696d  center = self.im
-0003b710: 706c 6963 6974 5f63 656e 7465 720d 0a20  plicit_center.. 
-0003b720: 2020 2020 2020 206d 2e70 6f73 745f 7472         m.post_tr
-0003b730: 616e 736c 6174 6528 6365 6e74 6572 2e78  anslate(center.x
-0003b740: 2c20 6365 6e74 6572 2e79 290d 0a20 2020  , center.y)..   
-0003b750: 2020 2020 2072 6574 7572 6e20 6d0d 0a0d       return m...
-0003b760: 0a20 2020 2064 6566 2061 7263 5f74 2873  .    def arc_t(s
-0003b770: 656c 662c 2074 302c 2074 3129 3a0d 0a20  elf, t0, t1):.. 
-0003b780: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
-0003b790: 2020 2020 7265 7475 726e 2074 6865 2061      return the a
-0003b7a0: 7263 2066 6f75 6e64 2062 6574 7765 656e  rc found between
-0003b7b0: 2074 6865 2067 6976 656e 2076 616c 7565   the given value
-0003b7c0: 7320 6f66 2074 206f 6e20 7468 6520 656c  s of t on the el
-0003b7d0: 6c69 7073 652e 0d0a 0d0a 2020 2020 2020  lipse.....      
-0003b7e0: 2020 3a70 6172 616d 2074 303a 2074 2073    :param t0: t s
-0003b7f0: 7461 7274 0d0a 2020 2020 2020 2020 3a70  tart..        :p
-0003b800: 6172 616d 2074 313a 2074 2065 6e64 0d0a  aram t1: t end..
-0003b810: 2020 2020 2020 2020 3a72 6574 7572 6e3a          :return:
-0003b820: 2061 7263 0d0a 2020 2020 2020 2020 2222   arc..        ""
-0003b830: 220d 0a20 2020 2020 2020 2072 6574 7572  "..        retur
-0003b840: 6e20 4172 6328 0d0a 2020 2020 2020 2020  n Arc(..        
-0003b850: 2020 2020 7365 6c66 2e70 6f69 6e74 5f61      self.point_a
-0003b860: 745f 7428 7430 292c 0d0a 2020 2020 2020  t_t(t0),..      
-0003b870: 2020 2020 2020 7365 6c66 2e70 6f69 6e74        self.point
-0003b880: 5f61 745f 7428 7431 292c 0d0a 2020 2020  _at_t(t1),..    
-0003b890: 2020 2020 2020 2020 7365 6c66 2e69 6d70          self.imp
-0003b8a0: 6c69 6369 745f 6365 6e74 6572 2c0d 0a20  licit_center,.. 
-0003b8b0: 2020 2020 2020 2020 2020 2072 783d 7365             rx=se
-0003b8c0: 6c66 2e69 6d70 6c69 6369 745f 7278 2c0d  lf.implicit_rx,.
-0003b8d0: 0a20 2020 2020 2020 2020 2020 2072 793d  .            ry=
-0003b8e0: 7365 6c66 2e69 6d70 6c69 6369 745f 7279  self.implicit_ry
-0003b8f0: 2c0d 0a20 2020 2020 2020 2020 2020 2072  ,..            r
-0003b900: 6f74 6174 696f 6e3d 7365 6c66 2e72 6f74  otation=self.rot
-0003b910: 6174 696f 6e2c 0d0a 2020 2020 2020 2020  ation,..        
-0003b920: 2020 2020 7377 6565 703d 7431 202d 2074      sweep=t1 - t
-0003b930: 302c 0d0a 2020 2020 2020 2020 290d 0a0d  0,..        )...
-0003b940: 0a20 2020 2064 6566 2061 7263 5f61 6e67  .    def arc_ang
-0003b950: 6c65 2873 656c 662c 2061 302c 2061 312c  le(self, a0, a1,
-0003b960: 2063 6377 3d4e 6f6e 6529 3a0d 0a20 2020   ccw=None):..   
-0003b970: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
-0003b980: 2020 7265 7475 726e 2074 6865 2061 7263    return the arc
-0003b990: 2066 6f75 6e64 2062 6574 7765 656e 2074   found between t
-0003b9a0: 6865 2067 6976 656e 2061 6e67 6c65 7320  he given angles 
-0003b9b0: 6f6e 2074 6865 2065 6c6c 6970 7365 2e0d  on the ellipse..
-0003b9c0: 0a0d 0a20 2020 2020 2020 203a 7061 7261  ...        :para
-0003b9d0: 6d20 6130 3a20 7374 6172 7420 616e 676c  m a0: start angl
-0003b9e0: 650d 0a20 2020 2020 2020 203a 7061 7261  e..        :para
-0003b9f0: 6d20 6131 3a20 656e 6420 616e 676c 650d  m a1: end angle.
-0003ba00: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-0003ba10: 6363 773a 206f 7074 696f 6e61 6c20 666c  ccw: optional fl
-0003ba20: 6167 2074 6f20 666f 7263 6520 636c 6f63  ag to force cloc
-0003ba30: 6b77 6973 6520 6f72 2063 6f75 6e74 6572  kwise or counter
-0003ba40: 2d63 6c6f 636b 7769 7365 2061 7263 2d61  -clockwise arc-a
-0003ba50: 6e67 6c65 732c 2064 6566 6175 6c74 2069  ngles, default i
-0003ba60: 7320 736d 616c 6c65 7220 616e 676c 650d  s smaller angle.
-0003ba70: 0a20 2020 2020 2020 203a 7265 7475 726e  .        :return
-0003ba80: 3a20 6172 630d 0a20 2020 2020 2020 2022  : arc..        "
-0003ba90: 2222 0d0a 2020 2020 2020 2020 6966 2063  ""..        if c
-0003baa0: 6377 2069 7320 4e6f 6e65 3a0d 0a20 2020  cw is None:..   
-0003bab0: 2020 2020 2020 2020 2063 6377 203d 2061           ccw = a
-0003bac0: 3020 3e20 6131 0d0a 2020 2020 2020 2020  0 > a1..        
-0003bad0: 7265 7475 726e 2041 7263 280d 0a20 2020  return Arc(..   
-0003bae0: 2020 2020 2020 2020 2073 656c 662e 706f           self.po
-0003baf0: 696e 745f 6174 5f61 6e67 6c65 2861 3029  int_at_angle(a0)
-0003bb00: 2c0d 0a20 2020 2020 2020 2020 2020 2073  ,..            s
-0003bb10: 656c 662e 706f 696e 745f 6174 5f61 6e67  elf.point_at_ang
-0003bb20: 6c65 2861 3129 2c0d 0a20 2020 2020 2020  le(a1),..       
-0003bb30: 2020 2020 2073 656c 662e 696d 706c 6963       self.implic
-0003bb40: 6974 5f63 656e 7465 722c 0d0a 2020 2020  it_center,..    
-0003bb50: 2020 2020 2020 2020 7278 3d73 656c 662e          rx=self.
-0003bb60: 696d 706c 6963 6974 5f72 782c 0d0a 2020  implicit_rx,..  
-0003bb70: 2020 2020 2020 2020 2020 7279 3d73 656c            ry=sel
-0003bb80: 662e 696d 706c 6963 6974 5f72 792c 0d0a  f.implicit_ry,..
-0003bb90: 2020 2020 2020 2020 2020 2020 726f 7461              rota
-0003bba0: 7469 6f6e 3d73 656c 662e 726f 7461 7469  tion=self.rotati
-0003bbb0: 6f6e 2c0d 0a20 2020 2020 2020 2020 2020  on,..           
-0003bbc0: 2063 6377 3d63 6377 2c0d 0a20 2020 2020   ccw=ccw,..     
-0003bbd0: 2020 2029 0d0a 0d0a 2020 2020 6465 6620     )....    def 
-0003bbe0: 706f 696e 745f 6174 5f61 6e67 6c65 2873  point_at_angle(s
-0003bbf0: 656c 662c 2061 6e67 6c65 293a 0d0a 2020  elf, angle):..  
-0003bc00: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
-0003bc10: 2020 2066 696e 6420 7468 6520 706f 696e     find the poin
-0003bc20: 7420 6f6e 2074 6865 2065 6c6c 6970 7365  t on the ellipse
-0003bc30: 2066 726f 6d20 7468 6520 6365 6e74 6572   from the center
-0003bc40: 2061 7420 7468 6520 6769 7665 6e20 616e   at the given an
-0003bc50: 676c 652e 0d0a 2020 2020 2020 2020 4e6f  gle...        No
-0003bc60: 7465 3a20 466f 7220 6e6f 6e2d 6369 7263  te: For non-circ
-0003bc70: 756c 6172 2061 7263 7320 7468 6973 2069  ular arcs this i
-0003bc80: 7320 6469 6666 6572 656e 7420 7468 616e  s different than
-0003bc90: 2070 6f69 6e74 2874 292e 0d0a 0d0a 2020   point(t).....  
-0003bca0: 2020 2020 2020 3a70 6172 616d 2061 6e67        :param ang
-0003bcb0: 6c65 3a20 616e 676c 6520 6672 6f6d 2063  le: angle from c
-0003bcc0: 656e 7465 7220 746f 2066 696e 6420 706f  enter to find po
-0003bcd0: 696e 740d 0a20 2020 2020 2020 203a 7265  int..        :re
-0003bce0: 7475 726e 3a20 706f 696e 7420 666f 756e  turn: point foun
-0003bcf0: 640d 0a20 2020 2020 2020 2022 2222 0d0a  d..        """..
-0003bd00: 2020 2020 2020 2020 6120 3d20 7365 6c66          a = self
-0003bd10: 2e69 6d70 6c69 6369 745f 7278 0d0a 2020  .implicit_rx..  
-0003bd20: 2020 2020 2020 6220 3d20 7365 6c66 2e69        b = self.i
-0003bd30: 6d70 6c69 6369 745f 7279 0d0a 2020 2020  mplicit_ry..    
-0003bd40: 2020 2020 6966 2061 203d 3d20 623a 0d0a      if a == b:..
-0003bd50: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0003bd60: 726e 2073 656c 662e 706f 696e 745f 6174  rn self.point_at
-0003bd70: 5f74 2861 6e67 6c65 290d 0a20 2020 2020  _t(angle)..     
-0003bd80: 2020 2061 6e67 6c65 202d 3d20 7365 6c66     angle -= self
-0003bd90: 2e72 6f74 6174 696f 6e0d 0a20 2020 2020  .rotation..     
-0003bda0: 2020 2074 203d 2061 7461 6e32 2861 202a     t = atan2(a *
-0003bdb0: 2074 616e 2861 6e67 6c65 292c 2062 290d   tan(angle), b).
-0003bdc0: 0a20 2020 2020 2020 2074 6175 5f31 5f34  .        tau_1_4
-0003bdd0: 203d 2074 6175 202f 2034 2e30 0d0a 2020   = tau / 4.0..  
-0003bde0: 2020 2020 2020 7461 755f 335f 3420 3d20        tau_3_4 = 
-0003bdf0: 3320 2a20 7461 755f 315f 340d 0a20 2020  3 * tau_1_4..   
-0003be00: 2020 2020 2069 6620 7461 755f 335f 3420       if tau_3_4 
-0003be10: 3e3d 2061 6273 2861 6e67 6c65 2920 2520  >= abs(angle) % 
-0003be20: 7461 7520 3e20 7461 755f 315f 343a 0d0a  tau > tau_1_4:..
-0003be30: 2020 2020 2020 2020 2020 2020 7420 2b3d              t +=
-0003be40: 2074 6175 202f 2032 2e30 0d0a 2020 2020   tau / 2.0..    
-0003be50: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-0003be60: 706f 696e 745f 6174 5f74 2874 290d 0a0d  point_at_t(t)...
-0003be70: 0a20 2020 2064 6566 2061 6e67 6c65 5f61  .    def angle_a
-0003be80: 745f 706f 696e 7428 7365 6c66 2c20 7029  t_point(self, p)
-0003be90: 3a0d 0a20 2020 2020 2020 2022 2222 0d0a  :..        """..
-0003bea0: 2020 2020 2020 2020 6669 6e64 2074 6865          find the
-0003beb0: 2061 6e67 6c65 2074 6f20 7468 6520 706f   angle to the po
-0003bec0: 696e 742e 0d0a 0d0a 2020 2020 2020 2020  int.....        
-0003bed0: 3a70 6172 616d 2070 3a20 706f 696e 740d  :param p: point.
-0003bee0: 0a20 2020 2020 2020 203a 7265 7475 726e  .        :return
-0003bef0: 3a20 616e 676c 6520 746f 2067 6976 656e  : angle to given
-0003bf00: 2070 6f69 6e74 2e0d 0a20 2020 2020 2020   point...       
-0003bf10: 2022 2222 0d0a 2020 2020 2020 2020 6966   """..        if
-0003bf20: 2073 656c 662e 6170 706c 7920 616e 6420   self.apply and 
-0003bf30: 6e6f 7420 7365 6c66 2e74 7261 6e73 666f  not self.transfo
-0003bf40: 726d 2e69 735f 6964 656e 7469 7479 2829  rm.is_identity()
-0003bf50: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
-0003bf60: 6574 7572 6e20 7365 6c66 2e69 6d70 6c69  eturn self.impli
-0003bf70: 6369 745f 6365 6e74 6572 2e61 6e67 6c65  cit_center.angle
-0003bf80: 5f74 6f28 7029 0d0a 2020 2020 2020 2020  _to(p)..        
-0003bf90: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
-0003bfa0: 2020 2063 656e 7465 7220 3d20 506f 696e     center = Poin
-0003bfb0: 7428 7365 6c66 2e63 782c 2073 656c 662e  t(self.cx, self.
-0003bfc0: 6379 290d 0a20 2020 2020 2020 2020 2020  cy)..           
-0003bfd0: 2072 6574 7572 6e20 6365 6e74 6572 2e61   return center.a
-0003bfe0: 6e67 6c65 5f74 6f28 7029 0d0a 0d0a 2020  ngle_to(p)....  
-0003bff0: 2020 6465 6620 745f 6174 5f70 6f69 6e74    def t_at_point
-0003c000: 2873 656c 662c 2070 293a 0d0a 2020 2020  (self, p):..    
-0003c010: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
-0003c020: 2066 696e 6420 7468 6520 7420 7061 7261   find the t para
-0003c030: 6d65 7465 7220 746f 2061 7420 7468 6520  meter to at the 
-0003c040: 706f 696e 742e 0d0a 0d0a 2020 2020 2020  point.....      
-0003c050: 2020 3a70 6172 616d 2070 3a20 706f 696e    :param p: poin
-0003c060: 740d 0a20 2020 2020 2020 203a 7265 7475  t..        :retu
-0003c070: 726e 3a20 7420 7061 7261 6d65 7465 7220  rn: t parameter 
-0003c080: 746f 2074 6865 2067 6976 656e 2070 6f69  to the given poi
-0003c090: 6e74 2e0d 0a20 2020 2020 2020 2022 2222  nt...        """
-0003c0a0: 0d0a 2020 2020 2020 2020 616e 676c 6520  ..        angle 
-0003c0b0: 3d20 7365 6c66 2e61 6e67 6c65 5f61 745f  = self.angle_at_
-0003c0c0: 706f 696e 7428 7029 0d0a 2020 2020 2020  point(p)..      
-0003c0d0: 2020 616e 676c 6520 2d3d 2073 656c 662e    angle -= self.
-0003c0e0: 726f 7461 7469 6f6e 0d0a 2020 2020 2020  rotation..      
-0003c0f0: 2020 6120 3d20 7365 6c66 2e69 6d70 6c69    a = self.impli
-0003c100: 6369 745f 7278 0d0a 2020 2020 2020 2020  cit_rx..        
-0003c110: 6220 3d20 7365 6c66 2e69 6d70 6c69 6369  b = self.implici
-0003c120: 745f 7279 0d0a 2020 2020 2020 2020 7420  t_ry..        t 
-0003c130: 3d20 6174 616e 3228 6120 2a20 7461 6e28  = atan2(a * tan(
-0003c140: 616e 676c 6529 2c20 6229 0d0a 2020 2020  angle), b)..    
-0003c150: 2020 2020 7461 755f 315f 3420 3d20 7461      tau_1_4 = ta
-0003c160: 7520 2f20 342e 300d 0a20 2020 2020 2020  u / 4.0..       
-0003c170: 2074 6175 5f33 5f34 203d 2033 202a 2074   tau_3_4 = 3 * t
-0003c180: 6175 5f31 5f34 0d0a 2020 2020 2020 2020  au_1_4..        
-0003c190: 6966 2074 6175 5f33 5f34 203e 3d20 6162  if tau_3_4 >= ab
-0003c1a0: 7328 616e 676c 6529 2025 2074 6175 203e  s(angle) % tau >
-0003c1b0: 2074 6175 5f31 5f34 3a0d 0a20 2020 2020   tau_1_4:..     
-0003c1c0: 2020 2020 2020 2074 202b 3d20 7461 7520         t += tau 
-0003c1d0: 2f20 322e 300d 0a20 2020 2020 2020 2072  / 2.0..        r
-0003c1e0: 6574 7572 6e20 740d 0a0d 0a20 2020 2064  eturn t....    d
-0003c1f0: 6566 2070 6f69 6e74 5f61 745f 7428 7365  ef point_at_t(se
-0003c200: 6c66 2c20 7429 3a0d 0a20 2020 2020 2020  lf, t):..       
-0003c210: 2022 2222 0d0a 2020 2020 2020 2020 6669   """..        fi
-0003c220: 6e64 2074 6865 2070 6f69 6e74 2074 6861  nd the point tha
-0003c230: 7420 636f 7272 6573 706f 6e64 7320 746f  t corresponds to
-0003c240: 2067 6976 656e 2076 616c 7565 2074 2e0d   given value t..
-0003c250: 0a20 2020 2020 2020 2057 6865 7265 2074  .        Where t
-0003c260: 3d30 2069 7320 7468 6520 6669 7273 7420  =0 is the first 
-0003c270: 706f 696e 7420 616e 6420 743d 7461 7520  point and t=tau 
-0003c280: 6973 2074 6865 2066 696e 616c 2070 6f69  is the final poi
-0003c290: 6e74 2e0d 0a0d 0a20 2020 2020 2020 2049  nt.....        I
-0003c2a0: 6e20 7468 6520 6361 7365 206f 6620 6120  n the case of a 
-0003c2b0: 6369 7263 6c65 3a20 7420 3d20 616e 676c  circle: t = angl
-0003c2c0: 652e 0d0a 0d0a 2020 2020 2020 2020 3a70  e.....        :p
-0003c2d0: 6172 616d 2074 3a0d 0a20 2020 2020 2020  aram t:..       
-0003c2e0: 203a 7265 7475 726e 3a0d 0a20 2020 2020   :return:..     
-0003c2f0: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
-0003c300: 726f 7461 7469 6f6e 203d 2073 656c 662e  rotation = self.
-0003c310: 726f 7461 7469 6f6e 0d0a 2020 2020 2020  rotation..      
-0003c320: 2020 6120 3d20 7365 6c66 2e69 6d70 6c69    a = self.impli
-0003c330: 6369 745f 7278 0d0a 2020 2020 2020 2020  cit_rx..        
-0003c340: 6220 3d20 7365 6c66 2e69 6d70 6c69 6369  b = self.implici
-0003c350: 745f 7279 0d0a 2020 2020 2020 2020 6365  t_ry..        ce
-0003c360: 6e74 6572 203d 2073 656c 662e 696d 706c  nter = self.impl
-0003c370: 6963 6974 5f63 656e 7465 720d 0a20 2020  icit_center..   
-0003c380: 2020 2020 2063 7820 3d20 6365 6e74 6572       cx = center
-0003c390: 2e78 0d0a 2020 2020 2020 2020 6379 203d  .x..        cy =
-0003c3a0: 2063 656e 7465 722e 790d 0a20 2020 2020   center.y..     
-0003c3b0: 2020 2063 6f73 5f74 6865 7461 203d 2063     cos_theta = c
-0003c3c0: 6f73 2872 6f74 6174 696f 6e29 0d0a 2020  os(rotation)..  
-0003c3d0: 2020 2020 2020 7369 6e5f 7468 6574 6120        sin_theta 
-0003c3e0: 3d20 7369 6e28 726f 7461 7469 6f6e 290d  = sin(rotation).
-0003c3f0: 0a20 2020 2020 2020 2063 6f73 5f74 203d  .        cos_t =
-0003c400: 2063 6f73 2874 290d 0a20 2020 2020 2020   cos(t)..       
-0003c410: 2073 696e 5f74 203d 2073 696e 2874 290d   sin_t = sin(t).
-0003c420: 0a20 2020 2020 2020 2070 7820 3d20 6378  .        px = cx
-0003c430: 202b 2061 202a 2063 6f73 5f74 202a 2063   + a * cos_t * c
-0003c440: 6f73 5f74 6865 7461 202d 2062 202a 2073  os_theta - b * s
-0003c450: 696e 5f74 202a 2073 696e 5f74 6865 7461  in_t * sin_theta
-0003c460: 0d0a 2020 2020 2020 2020 7079 203d 2063  ..        py = c
-0003c470: 7920 2b20 6120 2a20 636f 735f 7420 2a20  y + a * cos_t * 
-0003c480: 7369 6e5f 7468 6574 6120 2b20 6220 2a20  sin_theta + b * 
-0003c490: 7369 6e5f 7420 2a20 636f 735f 7468 6574  sin_t * cos_thet
-0003c4a0: 610d 0a20 2020 2020 2020 2072 6574 7572  a..        retur
-0003c4b0: 6e20 506f 696e 7428 7078 2c20 7079 290d  n Point(px, py).
-0003c4c0: 0a0d 0a20 2020 2064 6566 2070 6f69 6e74  ...    def point
-0003c4d0: 2873 656c 662c 2070 6f73 6974 696f 6e2c  (self, position,
-0003c4e0: 2065 7272 6f72 3d45 5252 4f52 293a 0d0a   error=ERROR):..
-0003c4f0: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
-0003c500: 2020 2020 2066 696e 6420 7468 6520 706f       find the po
-0003c510: 696e 7420 7468 6174 2063 6f72 7265 7370  int that corresp
-0003c520: 6f6e 6473 2074 6f20 6769 7665 6e20 7661  onds to given va
-0003c530: 6c75 6520 5b30 2c31 5d2e 0d0a 2020 2020  lue [0,1]...    
-0003c540: 2020 2020 5768 6572 6520 743d 3020 6973      Where t=0 is
-0003c550: 2074 6865 2066 6972 7374 2070 6f69 6e74   the first point
-0003c560: 2061 6e64 2074 3d31 2069 7320 7468 6520   and t=1 is the 
-0003c570: 6669 6e61 6c20 706f 696e 742e 0d0a 0d0a  final point.....
-0003c580: 2020 2020 2020 2020 3a70 6172 616d 2070          :param p
-0003c590: 6f73 6974 696f 6e3a 2070 6f73 6974 696f  osition: positio
-0003c5a0: 6e20 7661 6c75 6520 6265 7477 6565 6e20  n value between 
-0003c5b0: 302c 3120 7768 6572 6520 7661 6c75 6520  0,1 where value 
-0003c5c0: 6571 7561 6c73 2074 6865 2061 6d6f 756e  equals the amoun
-0003c5d0: 7420 7468 726f 7567 6820 7468 6520 7368  t through the sh
-0003c5e0: 6170 650d 0a20 2020 2020 2020 203a 7061  ape..        :pa
-0003c5f0: 7261 6d20 6572 726f 723a 2065 7272 6f72  ram error: error
-0003c600: 2070 6572 6d69 7474 6564 2069 6e20 6465   permitted in de
-0003c610: 7465 726d 696e 696e 6720 706f 696e 7420  termining point 
-0003c620: 7661 6c75 6520 2875 6e75 7365 6420 666f  value (unused fo
-0003c630: 7220 7468 6973 2073 6861 7065 290d 0a20  r this shape).. 
-0003c640: 2020 2020 2020 203a 7265 7475 726e 3a20         :return: 
-0003c650: 706f 696e 7420 6174 2074 0d0a 2020 2020  point at t..    
-0003c660: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
-0003c670: 2072 6574 7572 6e20 7365 6c66 2e70 6f69   return self.poi
-0003c680: 6e74 5f61 745f 7428 7461 7520 2a20 706f  nt_at_t(tau * po
-0003c690: 7369 7469 6f6e 290d 0a0d 0a20 2020 2064  sition)....    d
-0003c6a0: 6566 205f 7261 6d61 6e75 6a61 6e5f 6c65  ef _ramanujan_le
-0003c6b0: 6e67 7468 2873 656c 6629 3a0d 0a20 2020  ngth(self):..   
-0003c6c0: 2020 2020 2061 203d 2073 656c 662e 696d       a = self.im
-0003c6d0: 706c 6963 6974 5f72 780d 0a20 2020 2020  plicit_rx..     
-0003c6e0: 2020 2062 203d 2073 656c 662e 696d 706c     b = self.impl
-0003c6f0: 6963 6974 5f72 790d 0a20 2020 2020 2020  icit_ry..       
-0003c700: 2069 6620 6220 3e20 613a 0d0a 2020 2020   if b > a:..    
-0003c710: 2020 2020 2020 2020 612c 2062 203d 2062          a, b = b
-0003c720: 2c20 610d 0a20 2020 2020 2020 2068 203d  , a..        h =
-0003c730: 2028 2861 202d 2062 2920 2a20 2861 202d   ((a - b) * (a -
-0003c740: 2062 2929 202f 2028 2861 202b 2062 2920   b)) / ((a + b) 
-0003c750: 2a20 2861 202b 2062 2929 0d0a 2020 2020  * (a + b))..    
-0003c760: 2020 2020 7265 7475 726e 2074 6175 202f      return tau /
-0003c770: 2032 202a 2028 6120 2b20 6229 202a 2028   2 * (a + b) * (
-0003c780: 3120 2b20 2833 202a 2068 202f 2028 3130  1 + (3 * h / (10
-0003c790: 202b 2073 7172 7428 3420 2d20 3320 2a20   + sqrt(4 - 3 * 
-0003c7a0: 6829 2929 290d 0a0d 0a0d 0a63 6c61 7373  h))))......class
-0003c7b0: 2045 6c6c 6970 7365 285f 526f 756e 6453   Ellipse(_RoundS
-0003c7c0: 6861 7065 293a 0d0a 2020 2020 2222 220d  hape):..    """.
-0003c7d0: 0a20 2020 2053 5647 2045 6c6c 6970 7365  .    SVG Ellipse
-0003c7e0: 2073 6861 7065 7320 6172 6520 6465 6669   shapes are defi
-0003c7f0: 6e65 6420 696e 2053 5647 3220 3130 2e34  ned in SVG2 10.4
-0003c800: 0d0a 2020 2020 6874 7470 733a 2f2f 7777  ..    https://ww
-0003c810: 772e 7733 2e6f 7267 2f54 522f 5356 4732  w.w3.org/TR/SVG2
-0003c820: 2f73 6861 7065 732e 6874 6d6c 2345 6c6c  /shapes.html#Ell
-0003c830: 6970 7365 456c 656d 656e 740d 0a0d 0a20  ipseElement.... 
-0003c840: 2020 2054 6865 7365 2068 6176 6520 6765     These have ge
-0003c850: 6f6d 6574 7269 6320 7072 6f70 6572 7469  ometric properti
-0003c860: 6573 2063 782c 2063 792c 2072 782c 2072  es cx, cy, rx, r
-0003c870: 790d 0a20 2020 2022 2222 0d0a 0d0a 2020  y..    """....  
-0003c880: 2020 6465 6620 5f5f 696e 6974 5f5f 2873    def __init__(s
-0003c890: 656c 662c 202a 6172 6773 2c20 2a2a 6b77  elf, *args, **kw
-0003c8a0: 6172 6773 293a 0d0a 2020 2020 2020 2020  args):..        
-0003c8b0: 5f52 6f75 6e64 5368 6170 652e 5f5f 696e  _RoundShape.__in
-0003c8c0: 6974 5f5f 2873 656c 662c 202a 6172 6773  it__(self, *args
-0003c8d0: 2c20 2a2a 6b77 6172 6773 290d 0a0d 0a20  , **kwargs).... 
-0003c8e0: 2020 2064 6566 205f 5f63 6f70 795f 5f28     def __copy__(
-0003c8f0: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
-0003c900: 7265 7475 726e 2045 6c6c 6970 7365 2873  return Ellipse(s
-0003c910: 656c 6629 0d0a 0d0a 2020 2020 6465 6620  elf)....    def 
-0003c920: 5f6e 616d 6528 7365 6c66 293a 0d0a 2020  _name(self):..  
-0003c930: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0003c940: 662e 5f5f 636c 6173 735f 5f2e 5f5f 6e61  f.__class__.__na
-0003c950: 6d65 5f5f 0d0a 0d0a 0d0a 636c 6173 7320  me__......class 
-0003c960: 4369 7263 6c65 285f 526f 756e 6453 6861  Circle(_RoundSha
-0003c970: 7065 293a 0d0a 2020 2020 2222 220d 0a20  pe):..    """.. 
-0003c980: 2020 2053 5647 2043 6972 636c 6520 7368     SVG Circle sh
-0003c990: 6170 6573 2061 7265 2064 6566 696e 6564  apes are defined
-0003c9a0: 2069 6e20 5356 4732 2031 302e 330d 0a20   in SVG2 10.3.. 
-0003c9b0: 2020 2068 7474 7073 3a2f 2f77 7777 2e77     https://www.w
-0003c9c0: 332e 6f72 672f 5452 2f53 5647 322f 7368  3.org/TR/SVG2/sh
-0003c9d0: 6170 6573 2e68 746d 6c23 4369 7263 6c65  apes.html#Circle
-0003c9e0: 456c 656d 656e 740d 0a0d 0a20 2020 2054  Element....    T
-0003c9f0: 6865 7365 2068 6176 6520 6765 6f6d 6574  hese have geomet
-0003ca00: 7269 6320 7072 6f70 6572 7469 6573 2063  ric properties c
-0003ca10: 782c 2063 792c 2072 0d0a 2020 2020 2222  x, cy, r..    ""
-0003ca20: 220d 0a0d 0a20 2020 2064 6566 205f 5f69  "....    def __i
-0003ca30: 6e69 745f 5f28 7365 6c66 2c20 2a61 7267  nit__(self, *arg
-0003ca40: 732c 202a 2a6b 7761 7267 7329 3a0d 0a20  s, **kwargs):.. 
-0003ca50: 2020 2020 2020 205f 526f 756e 6453 6861         _RoundSha
-0003ca60: 7065 2e5f 5f69 6e69 745f 5f28 7365 6c66  pe.__init__(self
-0003ca70: 2c20 2a61 7267 732c 202a 2a6b 7761 7267  , *args, **kwarg
-0003ca80: 7329 0d0a 0d0a 2020 2020 6465 6620 5f5f  s)....    def __
-0003ca90: 636f 7079 5f5f 2873 656c 6629 3a0d 0a20  copy__(self):.. 
-0003caa0: 2020 2020 2020 2072 6574 7572 6e20 4369         return Ci
-0003cab0: 7263 6c65 2873 656c 6629 0d0a 0d0a 2020  rcle(self)....  
-0003cac0: 2020 6465 6620 5f6e 616d 6528 7365 6c66    def _name(self
-0003cad0: 293a 0d0a 2020 2020 2020 2020 7265 7475  ):..        retu
-0003cae0: 726e 2073 656c 662e 5f5f 636c 6173 735f  rn self.__class_
-0003caf0: 5f2e 5f5f 6e61 6d65 5f5f 0d0a 0d0a 0d0a  _.__name__......
-0003cb00: 636c 6173 7320 5369 6d70 6c65 4c69 6e65  class SimpleLine
-0003cb10: 2853 6861 7065 293a 0d0a 2020 2020 2222  (Shape):..    ""
-0003cb20: 220d 0a20 2020 2053 5647 204c 696e 6520  "..    SVG Line 
-0003cb30: 7368 6170 6573 2061 7265 2064 6566 696e  shapes are defin
-0003cb40: 6564 2069 6e20 5356 4732 2031 302e 350d  ed in SVG2 10.5.
-0003cb50: 0a20 2020 2068 7474 7073 3a2f 2f77 7777  .    https://www
-0003cb60: 2e77 332e 6f72 672f 5452 2f53 5647 322f  .w3.org/TR/SVG2/
-0003cb70: 7368 6170 6573 2e68 746d 6c23 4c69 6e65  shapes.html#Line
-0003cb80: 456c 656d 656e 740d 0a0d 0a20 2020 2054  Element....    T
-0003cb90: 6865 7365 2068 6176 6520 6765 6f6d 6574  hese have geomet
-0003cba0: 7269 6320 7072 6f70 6572 7469 6573 2078  ric properties x
-0003cbb0: 312c 2079 312c 2078 322c 2079 320d 0a0d  1, y1, x2, y2...
-0003cbc0: 0a20 2020 2054 6865 7365 2061 7265 2063  .    These are c
-0003cbd0: 616c 6c65 6420 4c69 6e65 2069 6e20 5356  alled Line in SV
-0003cbe0: 4720 6275 7420 7468 6174 206e 616d 6520  G but that name 
-0003cbf0: 6973 2061 6c72 6561 6479 2075 7365 6420  is already used 
-0003cc00: 666f 7220 4c69 6e65 2850 6174 6853 6567  for Line(PathSeg
-0003cc10: 6d65 6e74 290d 0a20 2020 2022 2222 0d0a  ment)..    """..
-0003cc20: 0d0a 2020 2020 6465 6620 5f5f 696e 6974  ..    def __init
-0003cc30: 5f5f 2873 656c 662c 202a 6172 6773 2c20  __(self, *args, 
-0003cc40: 2a2a 6b77 6172 6773 293a 0d0a 2020 2020  **kwargs):..    
-0003cc50: 2020 2020 7365 6c66 2e78 3120 3d20 4e6f      self.x1 = No
-0003cc60: 6e65 0d0a 2020 2020 2020 2020 7365 6c66  ne..        self
-0003cc70: 2e79 3120 3d20 4e6f 6e65 0d0a 2020 2020  .y1 = None..    
-0003cc80: 2020 2020 7365 6c66 2e78 3220 3d20 4e6f      self.x2 = No
-0003cc90: 6e65 0d0a 2020 2020 2020 2020 7365 6c66  ne..        self
-0003cca0: 2e79 3220 3d20 4e6f 6e65 0d0a 2020 2020  .y2 = None..    
-0003ccb0: 2020 2020 5368 6170 652e 5f5f 696e 6974      Shape.__init
-0003ccc0: 5f5f 2873 656c 662c 202a 6172 6773 2c20  __(self, *args, 
-0003ccd0: 2a2a 6b77 6172 6773 290d 0a0d 0a20 2020  **kwargs)....   
-0003cce0: 2064 6566 2070 726f 7065 7274 795f 6279   def property_by
-0003ccf0: 5f6f 626a 6563 7428 7365 6c66 2c20 7329  _object(self, s)
-0003cd00: 3a0d 0a20 2020 2020 2020 2053 6861 7065  :..        Shape
-0003cd10: 2e70 726f 7065 7274 795f 6279 5f6f 626a  .property_by_obj
-0003cd20: 6563 7428 7365 6c66 2c20 7329 0d0a 2020  ect(self, s)..  
-0003cd30: 2020 2020 2020 7365 6c66 2e78 3120 3d20        self.x1 = 
-0003cd40: 732e 7831 0d0a 2020 2020 2020 2020 7365  s.x1..        se
-0003cd50: 6c66 2e79 3120 3d20 732e 7931 0d0a 2020  lf.y1 = s.y1..  
-0003cd60: 2020 2020 2020 7365 6c66 2e78 3220 3d20        self.x2 = 
-0003cd70: 732e 7832 0d0a 2020 2020 2020 2020 7365  s.x2..        se
-0003cd80: 6c66 2e79 3220 3d20 732e 7932 0d0a 0d0a  lf.y2 = s.y2....
-0003cd90: 2020 2020 6465 6620 7072 6f70 6572 7479      def property
-0003cda0: 5f62 795f 7661 6c75 6573 2873 656c 662c  _by_values(self,
-0003cdb0: 2076 616c 7565 7329 3a0d 0a20 2020 2020   values):..     
-0003cdc0: 2020 2053 6861 7065 2e70 726f 7065 7274     Shape.propert
-0003cdd0: 795f 6279 5f76 616c 7565 7328 7365 6c66  y_by_values(self
-0003cde0: 2c20 7661 6c75 6573 290d 0a20 2020 2020  , values)..     
-0003cdf0: 2020 2073 656c 662e 7831 203d 204c 656e     self.x1 = Len
-0003ce00: 6774 6828 7661 6c75 6573 2e67 6574 2853  gth(values.get(S
-0003ce10: 5647 5f41 5454 525f 5831 2c20 3029 292e  VG_ATTR_X1, 0)).
-0003ce20: 7661 6c75 6528 290d 0a20 2020 2020 2020  value()..       
-0003ce30: 2073 656c 662e 7931 203d 204c 656e 6774   self.y1 = Lengt
-0003ce40: 6828 7661 6c75 6573 2e67 6574 2853 5647  h(values.get(SVG
-0003ce50: 5f41 5454 525f 5931 2c20 3029 292e 7661  _ATTR_Y1, 0)).va
-0003ce60: 6c75 6528 290d 0a20 2020 2020 2020 2073  lue()..        s
-0003ce70: 656c 662e 7832 203d 204c 656e 6774 6828  elf.x2 = Length(
-0003ce80: 7661 6c75 6573 2e67 6574 2853 5647 5f41  values.get(SVG_A
-0003ce90: 5454 525f 5832 2c20 3029 292e 7661 6c75  TTR_X2, 0)).valu
-0003cea0: 6528 290d 0a20 2020 2020 2020 2073 656c  e()..        sel
-0003ceb0: 662e 7932 203d 204c 656e 6774 6828 7661  f.y2 = Length(va
-0003cec0: 6c75 6573 2e67 6574 2853 5647 5f41 5454  lues.get(SVG_ATT
-0003ced0: 525f 5932 2c20 3029 292e 7661 6c75 6528  R_Y2, 0)).value(
-0003cee0: 290d 0a0d 0a20 2020 2064 6566 2070 726f  )....    def pro
-0003cef0: 7065 7274 795f 6279 5f61 7267 7328 7365  perty_by_args(se
-0003cf00: 6c66 2c20 2a61 7267 7329 3a0d 0a20 2020  lf, *args):..   
-0003cf10: 2020 2020 2061 7267 5f6c 656e 6774 6820       arg_length 
-0003cf20: 3d20 6c65 6e28 6172 6773 290d 0a20 2020  = len(args)..   
-0003cf30: 2020 2020 2069 6620 6172 675f 6c65 6e67       if arg_leng
-0003cf40: 7468 203e 3d20 313a 0d0a 2020 2020 2020  th >= 1:..      
-0003cf50: 2020 2020 2020 7365 6c66 2e78 3120 3d20        self.x1 = 
-0003cf60: 4c65 6e67 7468 2861 7267 735b 305d 292e  Length(args[0]).
-0003cf70: 7661 6c75 6528 290d 0a20 2020 2020 2020  value()..       
-0003cf80: 2069 6620 6172 675f 6c65 6e67 7468 203e   if arg_length >
-0003cf90: 3d20 323a 0d0a 2020 2020 2020 2020 2020  = 2:..          
-0003cfa0: 2020 7365 6c66 2e79 3120 3d20 4c65 6e67    self.y1 = Leng
-0003cfb0: 7468 2861 7267 735b 315d 292e 7661 6c75  th(args[1]).valu
-0003cfc0: 6528 290d 0a20 2020 2020 2020 2069 6620  e()..        if 
-0003cfd0: 6172 675f 6c65 6e67 7468 203e 3d20 333a  arg_length >= 3:
-0003cfe0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-0003cff0: 6c66 2e78 3220 3d20 4c65 6e67 7468 2861  lf.x2 = Length(a
-0003d000: 7267 735b 325d 292e 7661 6c75 6528 290d  rgs[2]).value().
-0003d010: 0a20 2020 2020 2020 2069 6620 6172 675f  .        if arg_
-0003d020: 6c65 6e67 7468 203e 3d20 343a 0d0a 2020  length >= 4:..  
-0003d030: 2020 2020 2020 2020 2020 7365 6c66 2e79            self.y
-0003d040: 3220 3d20 4c65 6e67 7468 2861 7267 735b  2 = Length(args[
-0003d050: 335d 292e 7661 6c75 6528 290d 0a20 2020  3]).value()..   
-0003d060: 2020 2020 2073 656c 662e 5f69 6e69 745f       self._init_
-0003d070: 7368 6170 6528 2a61 7267 735b 343a 5d29  shape(*args[4:])
-0003d080: 0d0a 0d0a 2020 2020 6465 6620 5f61 7474  ....    def _att
-0003d090: 7273 2873 656c 662c 2076 616c 7565 7329  rs(self, values)
-0003d0a0: 3a0d 0a20 2020 2020 2020 2069 6620 7365  :..        if se
-0003d0b0: 6c66 2e78 3120 6973 206e 6f74 204e 6f6e  lf.x1 is not Non
-0003d0c0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-0003d0d0: 7661 6c75 6573 2e61 7070 656e 6428 2225  values.append("%
-0003d0e0: 733d 2573 2220 2520 2853 5647 5f41 5454  s=%s" % (SVG_ATT
-0003d0f0: 525f 5831 2c20 7374 7228 7365 6c66 2e78  R_X1, str(self.x
-0003d100: 3129 2929 0d0a 2020 2020 2020 2020 6966  1)))..        if
-0003d110: 2073 656c 662e 7931 2069 7320 6e6f 7420   self.y1 is not 
-0003d120: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
-0003d130: 2020 2076 616c 7565 732e 6170 7065 6e64     values.append
-0003d140: 2822 2573 3d25 7322 2025 2028 5356 475f  ("%s=%s" % (SVG_
-0003d150: 4154 5452 5f59 312c 2073 7472 2873 656c  ATTR_Y1, str(sel
-0003d160: 662e 7931 2929 290d 0a20 2020 2020 2020  f.y1)))..       
-0003d170: 2069 6620 7365 6c66 2e78 3220 6973 206e   if self.x2 is n
-0003d180: 6f74 204e 6f6e 653a 0d0a 2020 2020 2020  ot None:..      
-0003d190: 2020 2020 2020 7661 6c75 6573 2e61 7070        values.app
-0003d1a0: 656e 6428 2225 733d 2573 2220 2520 2853  end("%s=%s" % (S
-0003d1b0: 5647 5f41 5454 525f 5832 2c20 7374 7228  VG_ATTR_X2, str(
-0003d1c0: 7365 6c66 2e78 3229 2929 0d0a 2020 2020  self.x2)))..    
-0003d1d0: 2020 2020 6966 2073 656c 662e 7932 2069      if self.y2 i
-0003d1e0: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
-0003d1f0: 2020 2020 2020 2020 2076 616c 7565 732e           values.
-0003d200: 6170 7065 6e64 2822 2573 3d25 7322 2025  append("%s=%s" %
-0003d210: 2028 5356 475f 4154 5452 5f59 322c 2073   (SVG_ATTR_Y2, s
-0003d220: 7472 2873 656c 662e 7932 2929 290d 0a0d  tr(self.y2)))...
-0003d230: 0a20 2020 2064 6566 205f 5f72 6570 725f  .    def __repr_
-0003d240: 5f28 7365 6c66 293a 0d0a 2020 2020 2020  _(self):..      
-0003d250: 2020 7661 6c75 6573 203d 205b 5d0d 0a20    values = [].. 
-0003d260: 2020 2020 2020 2073 656c 662e 5f61 7474         self._att
-0003d270: 7273 2876 616c 7565 7329 0d0a 2020 2020  rs(values)..    
-0003d280: 2020 2020 7365 6c66 2e5f 7265 7072 5f73      self._repr_s
-0003d290: 6861 7065 2876 616c 7565 7329 0d0a 2020  hape(values)..  
-0003d2a0: 2020 2020 2020 7061 7261 6d73 203d 2022        params = "
-0003d2b0: 2c20 222e 6a6f 696e 2876 616c 7565 7329  , ".join(values)
-0003d2c0: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-0003d2d0: 2022 5369 6d70 6c65 4c69 6e65 2825 7329   "SimpleLine(%s)
-0003d2e0: 2220 2520 7061 7261 6d73 0d0a 0d0a 2020  " % params....  
-0003d2f0: 2020 6465 6620 5f5f 7374 725f 5f28 7365    def __str__(se
-0003d300: 6c66 293a 0d0a 2020 2020 2020 2020 7661  lf):..        va
-0003d310: 6c75 6573 203d 205b 5d0d 0a20 2020 2020  lues = []..     
-0003d320: 2020 2073 656c 662e 5f61 7474 7273 2876     self._attrs(v
-0003d330: 616c 7565 7329 0d0a 2020 2020 2020 2020  alues)..        
-0003d340: 7365 6c66 2e5f 7374 725f 7368 6170 6528  self._str_shape(
-0003d350: 7661 6c75 6573 290d 0a20 2020 2020 2020  values)..       
-0003d360: 2070 6172 616d 7320 3d20 222c 2022 2e6a   params = ", ".j
-0003d370: 6f69 6e28 7661 6c75 6573 290d 0a20 2020  oin(values)..   
-0003d380: 2020 2020 2072 6574 7572 6e20 2253 696d       return "Sim
-0003d390: 706c 654c 696e 6528 2573 2922 2025 2070  pleLine(%s)" % p
-0003d3a0: 6172 616d 730d 0a0d 0a20 2020 2064 6566  arams....    def
-0003d3b0: 205f 5f63 6f70 795f 5f28 7365 6c66 293a   __copy__(self):
-0003d3c0: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-0003d3d0: 2053 696d 706c 654c 696e 6528 7365 6c66   SimpleLine(self
-0003d3e0: 290d 0a0d 0a20 2020 2040 7072 6f70 6572  )....    @proper
-0003d3f0: 7479 0d0a 2020 2020 6465 6620 696d 706c  ty..    def impl
-0003d400: 6963 6974 5f78 3128 7365 6c66 293a 0d0a  icit_x1(self):..
-0003d410: 2020 2020 2020 2020 706f 696e 7420 3d20          point = 
-0003d420: 506f 696e 7428 7365 6c66 2e78 312c 2073  Point(self.x1, s
-0003d430: 656c 662e 7931 290d 0a20 2020 2020 2020  elf.y1)..       
-0003d440: 2070 6f69 6e74 202a 3d20 7365 6c66 2e74   point *= self.t
-0003d450: 7261 6e73 666f 726d 0d0a 2020 2020 2020  ransform..      
-0003d460: 2020 7265 7475 726e 2070 6f69 6e74 2e78    return point.x
-0003d470: 0d0a 0d0a 2020 2020 4070 726f 7065 7274  ....    @propert
-0003d480: 790d 0a20 2020 2064 6566 2069 6d70 6c69  y..    def impli
-0003d490: 6369 745f 7931 2873 656c 6629 3a0d 0a20  cit_y1(self):.. 
-0003d4a0: 2020 2020 2020 2070 6f69 6e74 203d 2050         point = P
-0003d4b0: 6f69 6e74 2873 656c 662e 7831 2c20 7365  oint(self.x1, se
-0003d4c0: 6c66 2e79 3129 0d0a 2020 2020 2020 2020  lf.y1)..        
-0003d4d0: 706f 696e 7420 2a3d 2073 656c 662e 7472  point *= self.tr
-0003d4e0: 616e 7366 6f72 6d0d 0a20 2020 2020 2020  ansform..       
-0003d4f0: 2072 6574 7572 6e20 706f 696e 742e 790d   return point.y.
-0003d500: 0a0d 0a20 2020 2040 7072 6f70 6572 7479  ...    @property
-0003d510: 0d0a 2020 2020 6465 6620 696d 706c 6963  ..    def implic
-0003d520: 6974 5f78 3228 7365 6c66 293a 0d0a 2020  it_x2(self):..  
-0003d530: 2020 2020 2020 706f 696e 7420 3d20 506f        point = Po
-0003d540: 696e 7428 7365 6c66 2e78 322c 2073 656c  int(self.x2, sel
-0003d550: 662e 7932 290d 0a20 2020 2020 2020 2070  f.y2)..        p
-0003d560: 6f69 6e74 202a 3d20 7365 6c66 2e74 7261  oint *= self.tra
-0003d570: 6e73 666f 726d 0d0a 2020 2020 2020 2020  nsform..        
-0003d580: 7265 7475 726e 2070 6f69 6e74 2e78 0d0a  return point.x..
-0003d590: 0d0a 2020 2020 4070 726f 7065 7274 790d  ..    @property.
-0003d5a0: 0a20 2020 2064 6566 2069 6d70 6c69 6369  .    def implici
-0003d5b0: 745f 7932 2873 656c 6629 3a0d 0a20 2020  t_y2(self):..   
-0003d5c0: 2020 2020 2070 6f69 6e74 203d 2050 6f69       point = Poi
-0003d5d0: 6e74 2873 656c 662e 7832 2c20 7365 6c66  nt(self.x2, self
-0003d5e0: 2e79 3229 0d0a 2020 2020 2020 2020 706f  .y2)..        po
-0003d5f0: 696e 7420 2a3d 2073 656c 662e 7472 616e  int *= self.tran
-0003d600: 7366 6f72 6d0d 0a20 2020 2020 2020 2072  sform..        r
-0003d610: 6574 7572 6e20 706f 696e 742e 790d 0a0d  eturn point.y...
-0003d620: 0a20 2020 2064 6566 2073 6567 6d65 6e74  .    def segment
-0003d630: 7328 7365 6c66 2c20 7472 616e 7366 6f72  s(self, transfor
-0003d640: 6d65 643d 5472 7565 293a 0d0a 2020 2020  med=True):..    
-0003d650: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
-0003d660: 2053 5647 2070 6174 6820 6465 636f 6d70   SVG path decomp
-0003d670: 6f73 6974 696f 6e20 6973 2067 6976 656e  osition is given
-0003d680: 2069 6e20 5356 4720 322e 3020 3130 2e35   in SVG 2.0 10.5
-0003d690: 2e0d 0a0d 0a20 2020 2020 2020 2070 6572  .....        per
-0003d6a0: 666f 726d 2061 6e20 6162 736f 6c75 7465  form an absolute
-0003d6b0: 206d 6f76 6574 6f20 6f70 6572 6174 696f   moveto operatio
-0003d6c0: 6e20 746f 2061 6273 6f6c 7574 6520 6c6f  n to absolute lo
-0003d6d0: 6361 7469 6f6e 2028 7831 2c79 3129 0d0a  cation (x1,y1)..
-0003d6e0: 2020 2020 2020 2020 7065 7266 6f72 6d20          perform 
-0003d6f0: 616e 2061 6273 6f6c 7574 6520 6c69 6e65  an absolute line
-0003d700: 746f 206f 7065 7261 7469 6f6e 2074 6f20  to operation to 
-0003d710: 6162 736f 6c75 7465 206c 6f63 6174 696f  absolute locatio
-0003d720: 6e20 2878 322c 7932 290d 0a0d 0a20 2020  n (x2,y2)....   
-0003d730: 2020 2020 203a 7265 7475 726e 7320 5061       :returns Pa
-0003d740: 7468 5f64 2070 6174 6820 666f 7220 6c69  th_d path for li
-0003d750: 6e65 2e0d 0a20 2020 2020 2020 2022 2222  ne...        """
-0003d760: 0d0a 0d0a 2020 2020 2020 2020 7374 6172  ....        star
-0003d770: 7420 3d20 506f 696e 7428 7365 6c66 2e78  t = Point(self.x
-0003d780: 312c 2073 656c 662e 7931 290d 0a20 2020  1, self.y1)..   
-0003d790: 2020 2020 2065 6e64 203d 2050 6f69 6e74       end = Point
-0003d7a0: 2873 656c 662e 7832 2c20 7365 6c66 2e79  (self.x2, self.y
-0003d7b0: 3229 0d0a 2020 2020 2020 2020 6966 2074  2)..        if t
-0003d7c0: 7261 6e73 666f 726d 6564 3a0d 0a20 2020  ransformed:..   
-0003d7d0: 2020 2020 2020 2020 2073 7461 7274 202a           start *
-0003d7e0: 3d20 7365 6c66 2e74 7261 6e73 666f 726d  = self.transform
-0003d7f0: 0d0a 2020 2020 2020 2020 2020 2020 656e  ..            en
-0003d800: 6420 2a3d 2073 656c 662e 7472 616e 7366  d *= self.transf
-0003d810: 6f72 6d0d 0a20 2020 2020 2020 2072 6574  orm..        ret
-0003d820: 7572 6e20 4d6f 7665 284e 6f6e 652c 2073  urn Move(None, s
-0003d830: 7461 7274 292c 204c 696e 6528 7374 6172  tart), Line(star
-0003d840: 742c 2065 6e64 290d 0a0d 0a20 2020 2064  t, end)....    d
-0003d850: 6566 2072 6569 6679 2873 656c 6629 3a0d  ef reify(self):.
-0003d860: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
-0003d870: 2020 2020 2020 5265 616c 697a 6573 2074        Realizes t
-0003d880: 6865 2074 7261 6e73 666f 726d 2074 6f20  he transform to 
-0003d890: 7468 6520 7368 6170 6520 7072 6f70 6572  the shape proper
-0003d8a0: 7469 6573 2e0d 0a0d 0a20 2020 2020 2020  ties.....       
-0003d8b0: 2053 696d 706c 654c 696e 6573 2061 7265   SimpleLines are
-0003d8c0: 2070 6572 6665 6374 6c79 2072 6569 6669   perfectly reifi
-0003d8d0: 6564 2e0d 0a20 2020 2020 2020 2022 2222  ed...        """
-0003d8e0: 0d0a 2020 2020 2020 2020 4772 6170 6869  ..        Graphi
-0003d8f0: 634f 626a 6563 742e 7265 6966 7928 7365  cObject.reify(se
-0003d900: 6c66 290d 0a20 2020 2020 2020 2054 7261  lf)..        Tra
-0003d910: 6e73 666f 726d 6162 6c65 2e72 6569 6679  nsformable.reify
-0003d920: 2873 656c 6629 0d0a 2020 2020 2020 2020  (self)..        
-0003d930: 6d61 7472 6978 203d 2073 656c 662e 7472  matrix = self.tr
-0003d940: 616e 7366 6f72 6d0d 0a20 2020 2020 2020  ansform..       
-0003d950: 2070 203d 2050 6f69 6e74 2873 656c 662e   p = Point(self.
-0003d960: 7831 2c20 7365 6c66 2e79 3129 0d0a 2020  x1, self.y1)..  
-0003d970: 2020 2020 2020 7020 2a3d 206d 6174 7269        p *= matri
-0003d980: 780d 0a20 2020 2020 2020 2073 656c 662e  x..        self.
-0003d990: 7831 203d 2070 2e78 0d0a 2020 2020 2020  x1 = p.x..      
-0003d9a0: 2020 7365 6c66 2e79 3120 3d20 702e 790d    self.y1 = p.y.
-0003d9b0: 0a0d 0a20 2020 2020 2020 2070 203d 2050  ...        p = P
-0003d9c0: 6f69 6e74 2873 656c 662e 7832 2c20 7365  oint(self.x2, se
-0003d9d0: 6c66 2e79 3229 0d0a 2020 2020 2020 2020  lf.y2)..        
-0003d9e0: 7020 2a3d 206d 6174 7269 780d 0a20 2020  p *= matrix..   
-0003d9f0: 2020 2020 2073 656c 662e 7832 203d 2070       self.x2 = p
-0003da00: 2e78 0d0a 2020 2020 2020 2020 7365 6c66  .x..        self
-0003da10: 2e79 3220 3d20 702e 790d 0a0d 0a20 2020  .y2 = p.y....   
-0003da20: 2020 2020 206d 6174 7269 782e 7265 7365       matrix.rese
-0003da30: 7428 290d 0a20 2020 2020 2020 2072 6574  t()..        ret
-0003da40: 7572 6e20 7365 6c66 0d0a 0d0a 2020 2020  urn self....    
-0003da50: 6465 6620 7265 6e64 6572 2873 656c 662c  def render(self,
-0003da60: 202a 2a6b 7761 7267 7329 3a0d 0a20 2020   **kwargs):..   
-0003da70: 2020 2020 2053 6861 7065 2e72 656e 6465       Shape.rende
-0003da80: 7228 7365 6c66 2c20 2a2a 6b77 6172 6773  r(self, **kwargs
-0003da90: 290d 0a20 2020 2020 2020 2077 6964 7468  )..        width
-0003daa0: 203d 206b 7761 7267 732e 6765 7428 2277   = kwargs.get("w
-0003dab0: 6964 7468 222c 206b 7761 7267 732e 6765  idth", kwargs.ge
-0003dac0: 7428 2272 656c 6174 6976 655f 6c65 6e67  t("relative_leng
-0003dad0: 7468 2229 290d 0a20 2020 2020 2020 2068  th"))..        h
-0003dae0: 6569 6768 7420 3d20 6b77 6172 6773 2e67  eight = kwargs.g
-0003daf0: 6574 2822 6865 6967 6874 222c 206b 7761  et("height", kwa
-0003db00: 7267 732e 6765 7428 2272 656c 6174 6976  rgs.get("relativ
-0003db10: 655f 6c65 6e67 7468 2229 290d 0a20 2020  e_length"))..   
-0003db20: 2020 2020 2074 7279 3a0d 0a20 2020 2020       try:..     
-0003db30: 2020 2020 2020 2064 656c 206b 7761 7267         del kwarg
-0003db40: 735b 2272 656c 6174 6976 655f 6c65 6e67  s["relative_leng
-0003db50: 7468 225d 0d0a 2020 2020 2020 2020 6578  th"]..        ex
-0003db60: 6365 7074 204b 6579 4572 726f 723a 0d0a  cept KeyError:..
-0003db70: 2020 2020 2020 2020 2020 2020 7061 7373              pass
-0003db80: 0d0a 2020 2020 2020 2020 6966 2069 7369  ..        if isi
-0003db90: 6e73 7461 6e63 6528 7365 6c66 2e78 312c  nstance(self.x1,
-0003dba0: 204c 656e 6774 6829 3a0d 0a20 2020 2020   Length):..     
-0003dbb0: 2020 2020 2020 2073 656c 662e 7831 203d         self.x1 =
-0003dbc0: 2073 656c 662e 7831 2e76 616c 7565 2872   self.x1.value(r
-0003dbd0: 656c 6174 6976 655f 6c65 6e67 7468 3d77  elative_length=w
-0003dbe0: 6964 7468 2c20 2a2a 6b77 6172 6773 290d  idth, **kwargs).
-0003dbf0: 0a20 2020 2020 2020 2069 6620 6973 696e  .        if isin
-0003dc00: 7374 616e 6365 2873 656c 662e 7931 2c20  stance(self.y1, 
-0003dc10: 4c65 6e67 7468 293a 0d0a 2020 2020 2020  Length):..      
-0003dc20: 2020 2020 2020 7365 6c66 2e79 3120 3d20        self.y1 = 
-0003dc30: 7365 6c66 2e79 312e 7661 6c75 6528 7265  self.y1.value(re
-0003dc40: 6c61 7469 7665 5f6c 656e 6774 683d 6865  lative_length=he
-0003dc50: 6967 6874 2c20 2a2a 6b77 6172 6773 290d  ight, **kwargs).
-0003dc60: 0a20 2020 2020 2020 2069 6620 6973 696e  .        if isin
-0003dc70: 7374 616e 6365 2873 656c 662e 7832 2c20  stance(self.x2, 
-0003dc80: 4c65 6e67 7468 293a 0d0a 2020 2020 2020  Length):..      
-0003dc90: 2020 2020 2020 7365 6c66 2e78 3220 3d20        self.x2 = 
-0003dca0: 7365 6c66 2e78 322e 7661 6c75 6528 7265  self.x2.value(re
-0003dcb0: 6c61 7469 7665 5f6c 656e 6774 683d 7769  lative_length=wi
-0003dcc0: 6474 682c 202a 2a6b 7761 7267 7329 0d0a  dth, **kwargs)..
-0003dcd0: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-0003dce0: 7461 6e63 6528 7365 6c66 2e79 322c 204c  tance(self.y2, L
-0003dcf0: 656e 6774 6829 3a0d 0a20 2020 2020 2020  ength):..       
-0003dd00: 2020 2020 2073 656c 662e 7932 203d 2073       self.y2 = s
-0003dd10: 656c 662e 7932 2e76 616c 7565 2872 656c  elf.y2.value(rel
-0003dd20: 6174 6976 655f 6c65 6e67 7468 3d68 6569  ative_length=hei
-0003dd30: 6768 742c 202a 2a6b 7761 7267 7329 0d0a  ght, **kwargs)..
-0003dd40: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-0003dd50: 656c 660d 0a0d 0a0d 0a63 6c61 7373 205f  elf......class _
-0003dd60: 506f 6c79 7368 6170 6528 5368 6170 6529  Polyshape(Shape)
-0003dd70: 3a0d 0a20 2020 2022 2222 4261 7365 2066  :..    """Base f
-0003dd80: 6f72 6d20 6f66 2050 6f6c 7967 6f6e 2061  orm of Polygon a
-0003dd90: 6e64 2050 6f6c 796c 696e 6520 7369 6e63  nd Polyline sinc
-0003dda0: 6520 7468 6520 6f62 6a65 6374 7320 6172  e the objects ar
-0003ddb0: 6520 6e65 6172 6c79 2074 6865 2073 616d  e nearly the sam
-0003ddc0: 652e 2222 220d 0a0d 0a20 2020 2064 6566  e."""....    def
-0003ddd0: 205f 5f69 6e69 745f 5f28 7365 6c66 2c20   __init__(self, 
-0003dde0: 2a61 7267 732c 202a 2a6b 7761 7267 7329  *args, **kwargs)
-0003ddf0: 3a0d 0a20 2020 2020 2020 2073 656c 662e  :..        self.
-0003de00: 706f 696e 7473 203d 206c 6973 7428 290d  points = list().
-0003de10: 0a20 2020 2020 2020 2053 6861 7065 2e5f  .        Shape._
-0003de20: 5f69 6e69 745f 5f28 7365 6c66 2c20 2a61  _init__(self, *a
-0003de30: 7267 732c 202a 2a6b 7761 7267 7329 0d0a  rgs, **kwargs)..
-0003de40: 0d0a 2020 2020 6465 6620 7072 6f70 6572  ..    def proper
-0003de50: 7479 5f62 795f 6f62 6a65 6374 2873 656c  ty_by_object(sel
-0003de60: 662c 2073 293a 0d0a 2020 2020 2020 2020  f, s):..        
-0003de70: 5368 6170 652e 7072 6f70 6572 7479 5f62  Shape.property_b
-0003de80: 795f 6f62 6a65 6374 2873 656c 662c 2073  y_object(self, s
-0003de90: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-0003dea0: 5f69 6e69 745f 706f 696e 7473 2873 2e70  _init_points(s.p
-0003deb0: 6f69 6e74 7329 0d0a 0d0a 2020 2020 6465  oints)....    de
-0003dec0: 6620 7072 6f70 6572 7479 5f62 795f 7661  f property_by_va
-0003ded0: 6c75 6573 2873 656c 662c 2076 616c 7565  lues(self, value
-0003dee0: 7329 3a0d 0a20 2020 2020 2020 2053 6861  s):..        Sha
-0003def0: 7065 2e70 726f 7065 7274 795f 6279 5f76  pe.property_by_v
-0003df00: 616c 7565 7328 7365 6c66 2c20 7661 6c75  alues(self, valu
-0003df10: 6573 290d 0a20 2020 2020 2020 2073 656c  es)..        sel
-0003df20: 662e 5f69 6e69 745f 706f 696e 7473 2876  f._init_points(v
-0003df30: 616c 7565 7329 0d0a 0d0a 2020 2020 6465  alues)....    de
-0003df40: 6620 7072 6f70 6572 7479 5f62 795f 6172  f property_by_ar
-0003df50: 6773 2873 656c 662c 202a 6172 6773 293a  gs(self, *args):
-0003df60: 0d0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
-0003df70: 696e 6974 5f70 6f69 6e74 7328 6172 6773  init_points(args
-0003df80: 290d 0a0d 0a20 2020 2064 6566 205f 696e  )....    def _in
-0003df90: 6974 5f70 6f69 6e74 7328 7365 6c66 2c20  it_points(self, 
-0003dfa0: 706f 696e 7473 293a 0d0a 2020 2020 2020  points):..      
-0003dfb0: 2020 6966 206c 656e 2873 656c 662e 706f    if len(self.po
-0003dfc0: 696e 7473 2920 213d 2030 3a0d 0a20 2020  ints) != 0:..   
-0003dfd0: 2020 2020 2020 2020 2072 6574 7572 6e0d           return.
-0003dfe0: 0a20 2020 2020 2020 2069 6620 706f 696e  .        if poin
-0003dff0: 7473 2069 7320 4e6f 6e65 3a0d 0a20 2020  ts is None:..   
-0003e000: 2020 2020 2020 2020 2073 656c 662e 706f           self.po
-0003e010: 696e 7473 203d 206c 6973 7428 290d 0a20  ints = list().. 
-0003e020: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0003e030: 6e0d 0a20 2020 2020 2020 2069 6620 6973  n..        if is
-0003e040: 696e 7374 616e 6365 2870 6f69 6e74 732c  instance(points,
-0003e050: 2064 6963 7429 3a0d 0a20 2020 2020 2020   dict):..       
-0003e060: 2020 2020 2069 6620 5356 475f 4154 5452       if SVG_ATTR
-0003e070: 5f50 4f49 4e54 5320 696e 2070 6f69 6e74  _POINTS in point
-0003e080: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
-0003e090: 2020 2020 706f 696e 7473 203d 2070 6f69      points = poi
-0003e0a0: 6e74 735b 5356 475f 4154 5452 5f50 4f49  nts[SVG_ATTR_POI
-0003e0b0: 4e54 535d 0d0a 2020 2020 2020 2020 2020  NTS]..          
-0003e0c0: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-0003e0d0: 2020 2020 2020 2020 2073 656c 662e 706f           self.po
-0003e0e0: 696e 7473 203d 206c 6973 7428 290d 0a20  ints = list().. 
-0003e0f0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0003e100: 6574 7572 6e0d 0a20 2020 2020 2020 2074  eturn..        t
-0003e110: 7279 3a0d 0a20 2020 2020 2020 2020 2020  ry:..           
-0003e120: 2069 6620 6c65 6e28 706f 696e 7473 2920   if len(points) 
-0003e130: 3d3d 2031 2061 6e64 2069 7369 6e73 7461  == 1 and isinsta
-0003e140: 6e63 6528 706f 696e 7473 5b30 5d2c 2028  nce(points[0], (
-0003e150: 6c69 7374 2c20 7475 706c 652c 2073 7472  list, tuple, str
-0003e160: 2929 3a0d 0a20 2020 2020 2020 2020 2020  )):..           
-0003e170: 2020 2020 2070 6f69 6e74 7320 3d20 706f       points = po
-0003e180: 696e 7473 5b30 5d0d 0a20 2020 2020 2020  ints[0]..       
-0003e190: 2065 7863 6570 7420 5479 7065 4572 726f   except TypeErro
-0003e1a0: 723a 0d0a 2020 2020 2020 2020 2020 2020  r:..            
-0003e1b0: 7061 7373 0d0a 2020 2020 2020 2020 6966  pass..        if
-0003e1c0: 2069 7369 6e73 7461 6e63 6528 706f 696e   isinstance(poin
-0003e1d0: 7473 2c20 7374 7229 3a0d 0a20 2020 2020  ts, str):..     
-0003e1e0: 2020 2020 2020 2066 696e 6461 6c6c 203d         findall =
-0003e1f0: 2052 4547 4558 5f43 4f4f 5244 5f50 4149   REGEX_COORD_PAI
-0003e200: 522e 6669 6e64 616c 6c28 706f 696e 7473  R.findall(points
-0003e210: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
-0003e220: 656c 662e 706f 696e 7473 203d 205b 506f  elf.points = [Po
-0003e230: 696e 7428 666c 6f61 7428 6a29 2c20 666c  int(float(j), fl
-0003e240: 6f61 7428 6b29 2920 666f 7220 6a2c 206b  oat(k)) for j, k
-0003e250: 2069 6e20 6669 6e64 616c 6c5d 0d0a 2020   in findall]..  
-0003e260: 2020 2020 2020 656c 6966 2069 7369 6e73        elif isins
-0003e270: 7461 6e63 6528 706f 696e 7473 2c20 286c  tance(points, (l
-0003e280: 6973 742c 2074 7570 6c65 2929 3a0d 0a20  ist, tuple)):.. 
-0003e290: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
-0003e2a0: 6e28 706f 696e 7473 2920 3d3d 2030 3a0d  n(points) == 0:.
-0003e2b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003e2c0: 2073 656c 662e 706f 696e 7473 203d 206c   self.points = l
-0003e2d0: 6973 7428 290d 0a20 2020 2020 2020 2020  ist()..         
-0003e2e0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-0003e2f0: 2020 2020 2020 2020 2020 6669 7273 745f            first_
-0003e300: 706f 696e 7420 3d20 706f 696e 7473 5b30  point = points[0
-0003e310: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
-0003e320: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-0003e330: 2866 6972 7374 5f70 6f69 6e74 2c20 2866  (first_point, (f
-0003e340: 6c6f 6174 2c20 696e 7429 293a 0d0a 2020  loat, int)):..  
-0003e350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003e360: 2020 7365 6c66 2e70 6f69 6e74 7320 3d20    self.points = 
-0003e370: 6c69 7374 286d 6170 2850 6f69 6e74 2c20  list(map(Point, 
-0003e380: 7a69 7028 2a5b 6974 6572 2870 6f69 6e74  zip(*[iter(point
-0003e390: 7329 5d20 2a20 3229 2929 0d0a 2020 2020  s)] * 2)))..    
-0003e3a0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-0003e3b0: 2069 7369 6e73 7461 6e63 6528 6669 7273   isinstance(firs
-0003e3c0: 745f 706f 696e 742c 2028 6c69 7374 2c20  t_point, (list, 
-0003e3d0: 7475 706c 652c 2063 6f6d 706c 6578 2c20  tuple, complex, 
-0003e3e0: 7374 722c 2050 6f69 6e74 2929 3a0d 0a20  str, Point)):.. 
-0003e3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003e400: 2020 2073 656c 662e 706f 696e 7473 203d     self.points =
-0003e410: 206c 6973 7428 6d61 7028 506f 696e 742c   list(map(Point,
-0003e420: 2070 6f69 6e74 7329 290d 0a20 2020 2020   points))..     
-0003e430: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-0003e440: 2020 2020 2020 7365 6c66 2e70 6f69 6e74        self.point
-0003e450: 7320 3d20 6c69 7374 2829 0d0a 0d0a 2020  s = list()....  
-0003e460: 2020 6465 6620 5f5f 7265 7072 5f5f 2873    def __repr__(s
-0003e470: 656c 6629 3a0d 0a20 2020 2020 2020 2076  elf):..        v
-0003e480: 616c 7565 7320 3d20 5b5d 0d0a 2020 2020  alues = []..    
-0003e490: 2020 2020 6966 2073 656c 662e 706f 696e      if self.poin
-0003e4a0: 7473 2069 7320 6e6f 7420 4e6f 6e65 3a0d  ts is not None:.
-0003e4b0: 0a20 2020 2020 2020 2020 2020 2073 203d  .            s =
-0003e4c0: 2022 2022 2e6a 6f69 6e28 6d61 7028 7374   " ".join(map(st
-0003e4d0: 722c 2073 656c 662e 706f 696e 7473 2929  r, self.points))
-0003e4e0: 0d0a 2020 2020 2020 2020 2020 2020 7661  ..            va
-0003e4f0: 6c75 6573 2e61 7070 656e 6428 2225 733d  lues.append("%s=
-0003e500: 2725 7327 2220 2520 2853 5647 5f41 5454  '%s'" % (SVG_ATT
-0003e510: 525f 504f 494e 5453 2c20 7329 290d 0a20  R_POINTS, s)).. 
-0003e520: 2020 2020 2020 2073 656c 662e 5f72 6570         self._rep
-0003e530: 725f 7368 6170 6528 7661 6c75 6573 290d  r_shape(values).
-0003e540: 0a20 2020 2020 2020 2070 6172 616d 7320  .        params 
-0003e550: 3d20 222c 2022 2e6a 6f69 6e28 7661 6c75  = ", ".join(valu
-0003e560: 6573 290d 0a20 2020 2020 2020 2072 6574  es)..        ret
-0003e570: 7572 6e20 2225 7328 2573 2922 2025 2028  urn "%s(%s)" % (
-0003e580: 7365 6c66 2e5f 5f63 6c61 7373 5f5f 2e5f  self.__class__._
-0003e590: 5f6e 616d 655f 5f2c 2070 6172 616d 7329  _name__, params)
-0003e5a0: 0d0a 0d0a 2020 2020 6465 6620 5f5f 7374  ....    def __st
-0003e5b0: 725f 5f28 7365 6c66 293a 0d0a 2020 2020  r__(self):..    
-0003e5c0: 2020 2020 7661 6c75 6573 203d 205b 5d0d      values = [].
-0003e5d0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-0003e5e0: 2e70 6f69 6e74 7320 6973 206e 6f74 204e  .points is not N
-0003e5f0: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
-0003e600: 2020 7320 3d20 2220 222e 6a6f 696e 286d    s = " ".join(m
-0003e610: 6170 2873 7472 2c20 7365 6c66 2e70 6f69  ap(str, self.poi
-0003e620: 6e74 7329 290d 0a20 2020 2020 2020 2020  nts))..         
-0003e630: 2020 2076 616c 7565 732e 6170 7065 6e64     values.append
-0003e640: 2822 2573 3d27 2573 2722 2025 2028 5356  ("%s='%s'" % (SV
-0003e650: 475f 4154 5452 5f50 4f49 4e54 532c 2073  G_ATTR_POINTS, s
-0003e660: 2929 0d0a 2020 2020 2020 2020 7365 6c66  ))..        self
-0003e670: 2e5f 7374 725f 7368 6170 6528 7661 6c75  ._str_shape(valu
-0003e680: 6573 290d 0a20 2020 2020 2020 2070 6172  es)..        par
-0003e690: 616d 7320 3d20 222c 2022 2e6a 6f69 6e28  ams = ", ".join(
-0003e6a0: 7661 6c75 6573 290d 0a20 2020 2020 2020  values)..       
-0003e6b0: 2072 6574 7572 6e20 2225 7328 2573 2922   return "%s(%s)"
-0003e6c0: 2025 2028 7365 6c66 2e5f 5f63 6c61 7373   % (self.__class
-0003e6d0: 5f5f 2e5f 5f6e 616d 655f 5f2c 2070 6172  __.__name__, par
-0003e6e0: 616d 7329 0d0a 0d0a 2020 2020 6465 6620  ams)....    def 
-0003e6f0: 5f5f 6c65 6e5f 5f28 7365 6c66 293a 0d0a  __len__(self):..
-0003e700: 2020 2020 2020 2020 7265 7475 726e 206c          return l
-0003e710: 656e 2873 656c 662e 706f 696e 7473 290d  en(self.points).
-0003e720: 0a0d 0a20 2020 2064 6566 205f 5f67 6574  ...    def __get
-0003e730: 6974 656d 5f5f 2873 656c 662c 2069 7465  item__(self, ite
-0003e740: 6d29 3a0d 0a20 2020 2020 2020 2072 6574  m):..        ret
-0003e750: 7572 6e20 7365 6c66 2e70 6f69 6e74 735b  urn self.points[
-0003e760: 6974 656d 5d0d 0a0d 0a20 2020 2064 6566  item]....    def
-0003e770: 2073 6567 6d65 6e74 7328 7365 6c66 2c20   segments(self, 
-0003e780: 7472 616e 7366 6f72 6d65 643d 5472 7565  transformed=True
-0003e790: 293a 0d0a 2020 2020 2020 2020 2222 220d  ):..        """.
-0003e7a0: 0a20 2020 2020 2020 2050 6f6c 796c 696e  .        Polylin
-0003e7b0: 6520 616e 6420 506f 6c79 676f 6e20 6465  e and Polygon de
-0003e7c0: 636f 6d70 6f73 6974 696f 6e20 6973 2067  composition is g
-0003e7d0: 6976 656e 2069 6e20 5356 4732 2e20 3130  iven in SVG2. 10
-0003e7e0: 2e36 2061 6e64 2031 302e 370d 0a0d 0a20  .6 and 10.7.... 
-0003e7f0: 2020 2020 2020 202a 2070 6572 666f 726d         * perform
-0003e800: 2061 6e20 6162 736f 6c75 7465 206d 6f76   an absolute mov
-0003e810: 6574 6f20 6f70 6572 6174 696f 6e20 746f  eto operation to
-0003e820: 2074 6865 2066 6972 7374 2063 6f6f 7264   the first coord
-0003e830: 696e 6174 6520 7061 6972 2069 6e20 7468  inate pair in th
-0003e840: 6520 6c69 7374 206f 6620 706f 696e 7473  e list of points
-0003e850: 0d0a 2020 2020 2020 2020 2a20 666f 7220  ..        * for 
-0003e860: 6561 6368 2073 7562 7365 7175 656e 7420  each subsequent 
-0003e870: 636f 6f72 6469 6e61 7465 2070 6169 722c  coordinate pair,
-0003e880: 2070 6572 666f 726d 2061 6e20 6162 736f   perform an abso
-0003e890: 6c75 7465 206c 696e 6574 6f20 6f70 6572  lute lineto oper
-0003e8a0: 6174 696f 6e20 746f 2074 6861 7420 636f  ation to that co
-0003e8b0: 6f72 6469 6e61 7465 2070 6169 722e 0d0a  ordinate pair...
-0003e8c0: 2020 2020 2020 2020 2a20 2850 6f6c 7967          * (Polyg
-0003e8d0: 6f6e 2d6f 6e6c 7929 2070 6572 666f 726d  on-only) perform
-0003e8e0: 2061 2063 6c6f 7365 7061 7468 2063 6f6d   a closepath com
-0003e8f0: 6d61 6e64 0d0a 0d0a 2020 2020 2020 2020  mand....        
-0003e900: 4e6f 7465 3a20 2046 6f72 2061 2070 6f6c  Note:  For a pol
-0003e910: 7967 6f6e 2f70 6f6c 796c 696e 6520 6d61  ygon/polyline ma
-0003e920: 6465 2066 726f 6d20 6e20 706f 696e 7473  de from n points
-0003e930: 2c20 7468 6520 7265 7375 6c74 696e 6720  , the resulting 
-0003e940: 7061 7468 2077 696c 6c0d 0a20 2020 2020  path will..     
-0003e950: 2020 2062 6520 636f 6d70 6f73 6564 206f     be composed o
-0003e960: 6620 6e20 6c69 6e65 7320 2865 7665 6e20  f n lines (even 
-0003e970: 6966 2073 6f6d 6520 6f66 2074 6865 7365  if some of these
-0003e980: 206c 696e 6573 2068 6176 6520 6c65 6e67   lines have leng
-0003e990: 7468 207a 6572 6f29 2e0d 0a20 2020 2020  th zero)...     
-0003e9a0: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
-0003e9b0: 6966 2073 656c 662e 7472 616e 7366 6f72  if self.transfor
-0003e9c0: 6d2e 6973 5f69 6465 6e74 6974 7928 2920  m.is_identity() 
-0003e9d0: 6f72 206e 6f74 2074 7261 6e73 666f 726d  or not transform
-0003e9e0: 6564 3a0d 0a20 2020 2020 2020 2020 2020  ed:..           
-0003e9f0: 2070 6f69 6e74 7320 3d20 7365 6c66 2e70   points = self.p
-0003ea00: 6f69 6e74 730d 0a20 2020 2020 2020 2065  oints..        e
-0003ea10: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-0003ea20: 2020 706f 696e 7473 203d 206c 6973 7428    points = list(
-0003ea30: 6d61 7028 7365 6c66 2e74 7261 6e73 666f  map(self.transfo
-0003ea40: 726d 2e70 6f69 6e74 5f69 6e5f 6d61 7472  rm.point_in_matr
-0003ea50: 6978 5f73 7061 6365 2c20 7365 6c66 2e70  ix_space, self.p
-0003ea60: 6f69 6e74 7329 290d 0a20 2020 2020 2020  oints))..       
-0003ea70: 2069 6620 7365 6c66 2e69 735f 6465 6765   if self.is_dege
-0003ea80: 6e65 7261 7465 2829 3a0d 0a20 2020 2020  nerate():..     
-0003ea90: 2020 2020 2020 2072 6574 7572 6e20 5b5d         return []
-0003eaa0: 0d0a 2020 2020 2020 2020 7365 676d 656e  ..        segmen
-0003eab0: 7473 203d 205b 4d6f 7665 284e 6f6e 652c  ts = [Move(None,
-0003eac0: 2070 6f69 6e74 735b 305d 295d 0d0a 2020   points[0])]..  
-0003ead0: 2020 2020 2020 6c61 7374 203d 2070 6f69        last = poi
-0003eae0: 6e74 735b 305d 0d0a 2020 2020 2020 2020  nts[0]..        
-0003eaf0: 666f 7220 6920 696e 2072 616e 6765 2831  for i in range(1
-0003eb00: 2c20 6c65 6e28 706f 696e 7473 2929 3a0d  , len(points)):.
-0003eb10: 0a20 2020 2020 2020 2020 2020 2063 7572  .            cur
-0003eb20: 7265 6e74 203d 2070 6f69 6e74 735b 695d  rent = points[i]
-0003eb30: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-0003eb40: 676d 656e 7473 2e61 7070 656e 6428 4c69  gments.append(Li
-0003eb50: 6e65 286c 6173 742c 2063 7572 7265 6e74  ne(last, current
-0003eb60: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
-0003eb70: 6c61 7374 203d 2063 7572 7265 6e74 0d0a  last = current..
-0003eb80: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-0003eb90: 7461 6e63 6528 7365 6c66 2c20 506f 6c79  tance(self, Poly
-0003eba0: 676f 6e29 3a0d 0a20 2020 2020 2020 2020  gon):..         
-0003ebb0: 2020 2073 6567 6d65 6e74 732e 6170 7065     segments.appe
-0003ebc0: 6e64 2843 6c6f 7365 286c 6173 742c 2070  nd(Close(last, p
-0003ebd0: 6f69 6e74 735b 305d 2929 0d0a 2020 2020  oints[0]))..    
-0003ebe0: 2020 2020 7265 7475 726e 2073 6567 6d65      return segme
-0003ebf0: 6e74 730d 0a0d 0a20 2020 2064 6566 2072  nts....    def r
-0003ec00: 6569 6679 2873 656c 6629 3a0d 0a20 2020  eify(self):..   
-0003ec10: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
-0003ec20: 2020 5265 616c 697a 6573 2074 6865 2074    Realizes the t
-0003ec30: 7261 6e73 666f 726d 2074 6f20 7468 6520  ransform to the 
-0003ec40: 7368 6170 6520 7072 6f70 6572 7469 6573  shape properties
-0003ec50: 2e0d 0a0d 0a20 2020 2020 2020 2050 6f6c  .....        Pol
-0003ec60: 7973 6861 7065 7320 6172 6520 7065 7266  yshapes are perf
-0003ec70: 6563 746c 7920 7265 6966 6965 642e 0d0a  ectly reified...
-0003ec80: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
-0003ec90: 2020 2020 2047 7261 7068 6963 4f62 6a65       GraphicObje
-0003eca0: 6374 2e72 6569 6679 2873 656c 6629 0d0a  ct.reify(self)..
-0003ecb0: 2020 2020 2020 2020 5472 616e 7366 6f72          Transfor
-0003ecc0: 6d61 626c 652e 7265 6966 7928 7365 6c66  mable.reify(self
-0003ecd0: 290d 0a20 2020 2020 2020 206d 6174 7269  )..        matri
-0003ece0: 7820 3d20 7365 6c66 2e74 7261 6e73 666f  x = self.transfo
-0003ecf0: 726d 0d0a 2020 2020 2020 2020 666f 7220  rm..        for 
-0003ed00: 7020 696e 2073 656c 663a 0d0a 2020 2020  p in self:..    
-0003ed10: 2020 2020 2020 2020 7020 2a3d 206d 6174          p *= mat
-0003ed20: 7269 780d 0a20 2020 2020 2020 206d 6174  rix..        mat
-0003ed30: 7269 782e 7265 7365 7428 290d 0a20 2020  rix.reset()..   
-0003ed40: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-0003ed50: 0d0a 0d0a 2020 2020 6465 6620 6973 5f64  ....    def is_d
-0003ed60: 6567 656e 6572 6174 6528 7365 6c66 293a  egenerate(self):
-0003ed70: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-0003ed80: 206c 656e 2873 656c 662e 706f 696e 7473   len(self.points
-0003ed90: 2920 3d3d 2030 0d0a 0d0a 0d0a 636c 6173  ) == 0......clas
-0003eda0: 7320 506f 6c79 6c69 6e65 285f 506f 6c79  s Polyline(_Poly
-0003edb0: 7368 6170 6529 3a0d 0a20 2020 2022 2222  shape):..    """
-0003edc0: 0d0a 2020 2020 5356 4720 506f 6c79 6c69  ..    SVG Polyli
-0003edd0: 6e65 2073 6861 7065 7320 6172 6520 6465  ne shapes are de
-0003ede0: 6669 6e65 6420 696e 2053 5647 3220 3130  fined in SVG2 10
-0003edf0: 2e36 0d0a 2020 2020 6874 7470 733a 2f2f  .6..    https://
-0003ee00: 7777 772e 7733 2e6f 7267 2f54 522f 5356  www.w3.org/TR/SV
-0003ee10: 4732 2f73 6861 7065 732e 6874 6d6c 2350  G2/shapes.html#P
-0003ee20: 6f6c 796c 696e 6545 6c65 6d65 6e74 0d0a  olylineElement..
-0003ee30: 0d0a 2020 2020 5468 6573 6520 6861 7665  ..    These have
-0003ee40: 2067 656f 6d65 7472 6963 2070 726f 7065   geometric prope
-0003ee50: 7274 6965 7320 706f 696e 7473 0d0a 2020  rties points..  
-0003ee60: 2020 2222 220d 0a0d 0a20 2020 2064 6566    """....    def
-0003ee70: 205f 5f69 6e69 745f 5f28 7365 6c66 2c20   __init__(self, 
-0003ee80: 2a61 7267 732c 202a 2a6b 7761 7267 7329  *args, **kwargs)
-0003ee90: 3a0d 0a20 2020 2020 2020 205f 506f 6c79  :..        _Poly
-0003eea0: 7368 6170 652e 5f5f 696e 6974 5f5f 2873  shape.__init__(s
-0003eeb0: 656c 662c 202a 6172 6773 2c20 2a2a 6b77  elf, *args, **kw
-0003eec0: 6172 6773 290d 0a0d 0a20 2020 2064 6566  args)....    def
-0003eed0: 205f 5f63 6f70 795f 5f28 7365 6c66 293a   __copy__(self):
-0003eee0: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-0003eef0: 2050 6f6c 796c 696e 6528 7365 6c66 290d   Polyline(self).
-0003ef00: 0a0d 0a20 2020 2064 6566 205f 6e61 6d65  ...    def _name
-0003ef10: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
-0003ef20: 2072 6574 7572 6e20 7365 6c66 2e5f 5f63   return self.__c
-0003ef30: 6c61 7373 5f5f 2e5f 5f6e 616d 655f 5f0d  lass__.__name__.
-0003ef40: 0a0d 0a0d 0a63 6c61 7373 2050 6f6c 7967  .....class Polyg
-0003ef50: 6f6e 285f 506f 6c79 7368 6170 6529 3a0d  on(_Polyshape):.
-0003ef60: 0a20 2020 2022 2222 0d0a 2020 2020 5356  .    """..    SV
-0003ef70: 4720 506f 6c79 676f 6e20 7368 6170 6573  G Polygon shapes
-0003ef80: 2061 7265 2064 6566 696e 6564 2069 6e20   are defined in 
-0003ef90: 5356 4732 2031 302e 370d 0a20 2020 2068  SVG2 10.7..    h
-0003efa0: 7474 7073 3a2f 2f77 7777 2e77 332e 6f72  ttps://www.w3.or
-0003efb0: 672f 5452 2f53 5647 322f 7368 6170 6573  g/TR/SVG2/shapes
-0003efc0: 2e68 746d 6c23 506f 6c79 676f 6e45 6c65  .html#PolygonEle
-0003efd0: 6d65 6e74 0d0a 0d0a 2020 2020 5468 6573  ment....    Thes
-0003efe0: 6520 6861 7665 2067 656f 6d65 7472 6963  e have geometric
-0003eff0: 2070 726f 7065 7274 6965 7320 706f 696e   properties poin
-0003f000: 7473 0d0a 2020 2020 2222 220d 0a0d 0a20  ts..    """.... 
-0003f010: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
-0003f020: 7365 6c66 2c20 2a61 7267 732c 202a 2a6b  self, *args, **k
-0003f030: 7761 7267 7329 3a0d 0a20 2020 2020 2020  wargs):..       
-0003f040: 205f 506f 6c79 7368 6170 652e 5f5f 696e   _Polyshape.__in
-0003f050: 6974 5f5f 2873 656c 662c 202a 6172 6773  it__(self, *args
-0003f060: 2c20 2a2a 6b77 6172 6773 290d 0a0d 0a20  , **kwargs).... 
-0003f070: 2020 2064 6566 205f 5f63 6f70 795f 5f28     def __copy__(
-0003f080: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
-0003f090: 7265 7475 726e 2050 6f6c 7967 6f6e 2873  return Polygon(s
-0003f0a0: 656c 6629 0d0a 0d0a 2020 2020 6465 6620  elf)....    def 
-0003f0b0: 5f6e 616d 6528 7365 6c66 293a 0d0a 2020  _name(self):..  
-0003f0c0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0003f0d0: 662e 5f5f 636c 6173 735f 5f2e 5f5f 6e61  f.__class__.__na
-0003f0e0: 6d65 5f5f 0d0a 0d0a 0d0a 636c 6173 7320  me__......class 
-0003f0f0: 5375 6270 6174 683a 0d0a 2020 2020 2222  Subpath:..    ""
-0003f100: 220d 0a20 2020 2053 7562 7061 7468 2069  "..    Subpath i
-0003f110: 7320 6120 5061 7468 2d62 6163 6b65 6420  s a Path-backed 
-0003f120: 7769 6e64 6f77 2069 6d70 6c65 6d65 6e74  window implement
-0003f130: 6174 696f 6e2e 2049 7420 646f 6573 206e  ation. It does n
-0003f140: 6f74 2073 746f 7265 2061 206c 6973 7420  ot store a list 
-0003f150: 6f66 2073 6567 6d65 6e74 7320 6275 7420  of segments but 
-0003f160: 7261 7468 6572 0d0a 2020 2020 7374 6f72  rather..    stor
-0003f170: 6573 2061 2050 6174 682c 2073 7461 7274  es a Path, start
-0003f180: 2070 6f73 6974 696f 6e2c 2065 6e64 2070   position, end p
-0003f190: 6f73 6974 696f 6e2e 2057 6865 6e20 6120  osition. When a 
-0003f1a0: 6675 6e63 7469 6f6e 2069 7320 6361 6c6c  function is call
-0003f1b0: 6564 206f 6e20 6120 7375 6270 6174 682c  ed on a subpath,
-0003f1c0: 2074 6865 2072 6573 756c 7420 6f66 0d0a   the result of..
-0003f1d0: 2020 2020 7468 6f73 6520 6576 656e 7473      those events
-0003f1e0: 2069 7320 7065 7266 6f72 6d65 6420 6f6e   is performed on
-0003f1f0: 2074 6865 2062 6163 6b69 6e67 2050 6174   the backing Pat
-0003f200: 682e 2057 6865 6e20 7468 6520 6261 636b  h. When the back
-0003f210: 696e 6720 5061 7468 2069 7320 6d6f 6469  ing Path is modi
-0003f220: 6669 6564 2074 6865 2062 6568 6176 696f  fied the behavio
-0003f230: 7220 6973 0d0a 2020 2020 756e 6465 6669  r is..    undefi
-0003f240: 6e65 642e 2222 220d 0a0d 0a20 2020 2064  ned."""....    d
-0003f250: 6566 205f 5f69 6e69 745f 5f28 7365 6c66  ef __init__(self
-0003f260: 2c20 7061 7468 2c20 7374 6172 742c 2065  , path, start, e
-0003f270: 6e64 293a 0d0a 2020 2020 2020 2020 7365  nd):..        se
-0003f280: 6c66 2e5f 7061 7468 203d 2070 6174 680d  lf._path = path.
-0003f290: 0a20 2020 2020 2020 2073 656c 662e 5f73  .        self._s
-0003f2a0: 7461 7274 203d 2073 7461 7274 0d0a 2020  tart = start..  
-0003f2b0: 2020 2020 2020 7365 6c66 2e5f 656e 6420        self._end 
-0003f2c0: 3d20 656e 640d 0a0d 0a20 2020 2064 6566  = end....    def
-0003f2d0: 205f 5f63 6f70 795f 5f28 7365 6c66 293a   __copy__(self):
-0003f2e0: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-0003f2f0: 2053 7562 7061 7468 2850 6174 6828 7365   Subpath(Path(se
-0003f300: 6c66 2e5f 7061 7468 292c 2073 656c 662e  lf._path), self.
-0003f310: 5f73 7461 7274 2c20 7365 6c66 2e5f 656e  _start, self._en
-0003f320: 6429 0d0a 0d0a 2020 2020 6465 6620 5f5f  d)....    def __
-0003f330: 6765 7469 7465 6d5f 5f28 7365 6c66 2c20  getitem__(self, 
-0003f340: 696e 6465 7829 3a0d 0a20 2020 2020 2020  index):..       
-0003f350: 2072 6574 7572 6e20 7365 6c66 2e5f 7061   return self._pa
-0003f360: 7468 5b73 656c 662e 696e 6465 785f 746f  th[self.index_to
-0003f370: 5f70 6174 685f 696e 6465 7828 696e 6465  _path_index(inde
-0003f380: 7829 5d0d 0a0d 0a20 2020 2064 6566 205f  x)]....    def _
-0003f390: 5f73 6574 6974 656d 5f5f 2873 656c 662c  _setitem__(self,
-0003f3a0: 2069 6e64 6578 2c20 7661 6c75 6529 3a0d   index, value):.
-0003f3b0: 0a20 2020 2020 2020 2073 656c 662e 5f70  .        self._p
-0003f3c0: 6174 685b 7365 6c66 2e69 6e64 6578 5f74  ath[self.index_t
-0003f3d0: 6f5f 7061 7468 5f69 6e64 6578 2869 6e64  o_path_index(ind
-0003f3e0: 6578 295d 203d 2076 616c 7565 0d0a 0d0a  ex)] = value....
-0003f3f0: 2020 2020 6465 6620 5f5f 6465 6c69 7465      def __delite
-0003f400: 6d5f 5f28 7365 6c66 2c20 696e 6465 7829  m__(self, index)
-0003f410: 3a0d 0a20 2020 2020 2020 2064 656c 2073  :..        del s
-0003f420: 656c 662e 5f70 6174 685b 7365 6c66 2e69  elf._path[self.i
-0003f430: 6e64 6578 5f74 6f5f 7061 7468 5f69 6e64  ndex_to_path_ind
-0003f440: 6578 2869 6e64 6578 295d 0d0a 2020 2020  ex(index)]..    
-0003f450: 2020 2020 7365 6c66 2e5f 656e 6420 2d3d      self._end -=
-0003f460: 2031 0d0a 0d0a 2020 2020 6465 6620 5f5f   1....    def __
-0003f470: 6961 6464 5f5f 2873 656c 662c 206f 7468  iadd__(self, oth
-0003f480: 6572 293a 0d0a 2020 2020 2020 2020 6966  er):..        if
-0003f490: 2069 7369 6e73 7461 6e63 6528 6f74 6865   isinstance(othe
-0003f4a0: 722c 2073 7472 293a 0d0a 2020 2020 2020  r, str):..      
-0003f4b0: 2020 2020 2020 7020 3d20 5061 7468 286f        p = Path(o
-0003f4c0: 7468 6572 290d 0a20 2020 2020 2020 2020  ther)..         
-0003f4d0: 2020 2073 656c 662e 5f70 6174 685b 7365     self._path[se
-0003f4e0: 6c66 2e5f 656e 6420 3a20 7365 6c66 2e5f  lf._end : self._
-0003f4f0: 656e 645d 203d 2070 0d0a 2020 2020 2020  end] = p..      
-0003f500: 2020 656c 6966 2069 7369 6e73 7461 6e63    elif isinstanc
-0003f510: 6528 6f74 6865 722c 2050 6174 6829 3a0d  e(other, Path):.
-0003f520: 0a20 2020 2020 2020 2020 2020 2070 203d  .            p =
-0003f530: 2063 6f70 7928 6f74 6865 7229 0d0a 2020   copy(other)..  
-0003f540: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-0003f550: 7061 7468 5b73 656c 662e 5f65 6e64 203a  path[self._end :
-0003f560: 2073 656c 662e 5f65 6e64 5d20 3d20 700d   self._end] = p.
-0003f570: 0a20 2020 2020 2020 2065 6c69 6620 6973  .        elif is
-0003f580: 696e 7374 616e 6365 286f 7468 6572 2c20  instance(other, 
-0003f590: 5061 7468 5365 676d 656e 7429 3a0d 0a20  PathSegment):.. 
-0003f5a0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0003f5b0: 5f70 6174 682e 696e 7365 7274 2873 656c  _path.insert(sel
-0003f5c0: 662e 5f65 6e64 2c20 6f74 6865 7229 0d0a  f._end, other)..
-0003f5d0: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-0003f5e0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0003f5f0: 6e20 4e6f 7449 6d70 6c65 6d65 6e74 6564  n NotImplemented
-0003f600: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-0003f610: 2073 656c 660d 0a0d 0a20 2020 2064 6566   self....    def
-0003f620: 205f 5f61 6464 5f5f 2873 656c 662c 206f   __add__(self, o
-0003f630: 7468 6572 293a 0d0a 2020 2020 2020 2020  ther):..        
-0003f640: 6966 2069 7369 6e73 7461 6e63 6528 6f74  if isinstance(ot
-0003f650: 6865 722c 2028 7374 722c 2050 6174 682c  her, (str, Path,
-0003f660: 2050 6174 6853 6567 6d65 6e74 2929 3a0d   PathSegment)):.
-0003f670: 0a20 2020 2020 2020 2020 2020 206e 203d  .            n =
-0003f680: 2063 6f70 7928 7365 6c66 290d 0a20 2020   copy(self)..   
-0003f690: 2020 2020 2020 2020 206e 202b 3d20 6f74           n += ot
-0003f6a0: 6865 720d 0a20 2020 2020 2020 2020 2020  her..           
-0003f6b0: 2072 6574 7572 6e20 6e0d 0a20 2020 2020   return n..     
-0003f6c0: 2020 2072 6574 7572 6e20 4e6f 7449 6d70     return NotImp
-0003f6d0: 6c65 6d65 6e74 6564 0d0a 0d0a 2020 2020  lemented....    
-0003f6e0: 6465 6620 5f5f 7261 6464 5f5f 2873 656c  def __radd__(sel
-0003f6f0: 662c 206f 7468 6572 293a 0d0a 2020 2020  f, other):..    
-0003f700: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-0003f710: 6528 6f74 6865 722c 2073 7472 293a 0d0a  e(other, str):..
-0003f720: 2020 2020 2020 2020 2020 2020 7061 7468              path
-0003f730: 203d 2050 6174 6828 6f74 6865 7229 0d0a   = Path(other)..
-0003f740: 2020 2020 2020 2020 2020 2020 7061 7468              path
-0003f750: 2e65 7874 656e 6428 6d61 7028 636f 7079  .extend(map(copy
-0003f760: 2c20 7365 6c66 2e5f 7061 7468 2929 0d0a  , self._path))..
-0003f770: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0003f780: 726e 2070 6174 680d 0a20 2020 2020 2020  rn path..       
-0003f790: 2065 6c69 6620 6973 696e 7374 616e 6365   elif isinstance
-0003f7a0: 286f 7468 6572 2c20 5061 7468 5365 676d  (other, PathSegm
-0003f7b0: 656e 7429 3a0d 0a20 2020 2020 2020 2020  ent):..         
-0003f7c0: 2020 2070 6174 6820 3d20 5061 7468 2873     path = Path(s
-0003f7d0: 656c 6629 0d0a 2020 2020 2020 2020 2020  elf)..          
-0003f7e0: 2020 7061 7468 2e69 6e73 6572 7428 302c    path.insert(0,
-0003f7f0: 206f 7468 6572 290d 0a20 2020 2020 2020   other)..       
-0003f800: 2020 2020 2072 6574 7572 6e20 7061 7468       return path
-0003f810: 0d0a 2020 2020 2020 2020 656c 7365 3a0d  ..        else:.
-0003f820: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0003f830: 7572 6e20 4e6f 7449 6d70 6c65 6d65 6e74  urn NotImplement
-0003f840: 6564 0d0a 0d0a 2020 2020 6465 6620 5f5f  ed....    def __
-0003f850: 696d 756c 5f5f 2873 656c 662c 206f 7468  imul__(self, oth
-0003f860: 6572 293a 0d0a 2020 2020 2020 2020 6966  er):..        if
-0003f870: 2069 7369 6e73 7461 6e63 6528 6f74 6865   isinstance(othe
-0003f880: 722c 2073 7472 293a 0d0a 2020 2020 2020  r, str):..      
-0003f890: 2020 2020 2020 6f74 6865 7220 3d20 4d61        other = Ma
-0003f8a0: 7472 6978 286f 7468 6572 290d 0a20 2020  trix(other)..   
-0003f8b0: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
-0003f8c0: 6365 286f 7468 6572 2c20 4d61 7472 6978  ce(other, Matrix
-0003f8d0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-0003f8e0: 666f 7220 6520 696e 2073 656c 663a 0d0a  for e in self:..
-0003f8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003f900: 6520 2a3d 206f 7468 6572 0d0a 2020 2020  e *= other..    
-0003f910: 2020 2020 7265 7475 726e 2073 656c 660d      return self.
-0003f920: 0a0d 0a20 2020 2064 6566 205f 5f6d 756c  ...    def __mul
-0003f930: 5f5f 2873 656c 662c 206f 7468 6572 293a  __(self, other):
-0003f940: 0d0a 2020 2020 2020 2020 6966 2069 7369  ..        if isi
-0003f950: 6e73 7461 6e63 6528 6f74 6865 722c 2028  nstance(other, (
-0003f960: 4d61 7472 6978 2c20 7374 7229 293a 0d0a  Matrix, str)):..
-0003f970: 2020 2020 2020 2020 2020 2020 6e20 3d20              n = 
-0003f980: 636f 7079 2873 656c 6629 0d0a 2020 2020  copy(self)..    
-0003f990: 2020 2020 2020 2020 6e20 2a3d 206f 7468          n *= oth
-0003f9a0: 6572 0d0a 2020 2020 2020 2020 2020 2020  er..            
-0003f9b0: 7265 7475 726e 206e 0d0a 2020 2020 2020  return n..      
-0003f9c0: 2020 7265 7475 726e 204e 6f74 496d 706c    return NotImpl
-0003f9d0: 656d 656e 7465 640d 0a0d 0a20 2020 205f  emented....    _
-0003f9e0: 5f72 6d75 6c5f 5f20 3d20 5f5f 6d75 6c5f  _rmul__ = __mul_
-0003f9f0: 5f0d 0a0d 0a20 2020 2064 6566 205f 5f69  _....    def __i
-0003fa00: 7465 725f 5f28 7365 6c66 293a 0d0a 2020  ter__(self):..  
-0003fa10: 2020 2020 2020 636c 6173 7320 4974 6572        class Iter
-0003fa20: 6174 6f72 3a0d 0a20 2020 2020 2020 2020  ator:..         
-0003fa30: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
-0003fa40: 7365 6c66 2c20 7375 6270 6174 6829 3a0d  self, subpath):.
-0003fa50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003fa60: 2073 656c 662e 6e20 3d20 7375 6270 6174   self.n = subpat
-0003fa70: 682e 5f73 7461 7274 202d 2031 0d0a 2020  h._start - 1..  
-0003fa80: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0003fa90: 6c66 2e73 7562 7061 7468 203d 2073 7562  lf.subpath = sub
-0003faa0: 7061 7468 0d0a 0d0a 2020 2020 2020 2020  path....        
-0003fab0: 2020 2020 6465 6620 5f5f 6e65 7874 5f5f      def __next__
-0003fac0: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
-0003fad0: 2020 2020 2020 2020 2073 656c 662e 6e20           self.n 
-0003fae0: 2b3d 2031 0d0a 2020 2020 2020 2020 2020  += 1..          
-0003faf0: 2020 2020 2020 7472 793a 0d0a 2020 2020        try:..    
-0003fb00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003fb10: 6966 2073 656c 662e 6e20 3e20 7365 6c66  if self.n > self
-0003fb20: 2e73 7562 7061 7468 2e5f 656e 643a 0d0a  .subpath._end:..
-0003fb30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003fb40: 2020 2020 2020 2020 7261 6973 6520 5374          raise St
-0003fb50: 6f70 4974 6572 6174 696f 6e0d 0a20 2020  opIteration..   
-0003fb60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003fb70: 2072 6574 7572 6e20 7365 6c66 2e73 7562   return self.sub
-0003fb80: 7061 7468 2e5f 7061 7468 5b73 656c 662e  path._path[self.
-0003fb90: 6e5d 0d0a 2020 2020 2020 2020 2020 2020  n]..            
-0003fba0: 2020 2020 6578 6365 7074 2049 6e64 6578      except Index
-0003fbb0: 4572 726f 723a 0d0a 2020 2020 2020 2020  Error:..        
-0003fbc0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-0003fbd0: 6520 5374 6f70 4974 6572 6174 696f 6e0d  e StopIteration.
-0003fbe0: 0a0d 0a20 2020 2020 2020 2020 2020 206e  ...            n
-0003fbf0: 6578 7420 3d20 5f5f 6e65 7874 5f5f 0d0a  ext = __next__..
-0003fc00: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-0003fc10: 2049 7465 7261 746f 7228 7365 6c66 290d   Iterator(self).
-0003fc20: 0a0d 0a20 2020 2064 6566 205f 5f6c 656e  ...    def __len
-0003fc30: 5f5f 2873 656c 6629 3a0d 0a20 2020 2020  __(self):..     
-0003fc40: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
-0003fc50: 656e 6420 2d20 7365 6c66 2e5f 7374 6172  end - self._star
-0003fc60: 7420 2b20 310d 0a0d 0a20 2020 2064 6566  t + 1....    def
-0003fc70: 205f 5f73 7472 5f5f 2873 656c 6629 3a0d   __str__(self):.
-0003fc80: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0003fc90: 7365 6c66 2e64 2829 0d0a 0d0a 2020 2020  self.d()....    
-0003fca0: 6465 6620 5f5f 7265 7072 5f5f 2873 656c  def __repr__(sel
-0003fcb0: 6629 3a0d 0a20 2020 2020 2020 2072 6574  f):..        ret
-0003fcc0: 7572 6e20 2250 6174 6828 2573 2922 2025  urn "Path(%s)" %
-0003fcd0: 2028 222c 2022 2e6a 6f69 6e28 7265 7072   (", ".join(repr
-0003fce0: 2878 2920 666f 7220 7820 696e 2073 656c  (x) for x in sel
-0003fcf0: 6629 290d 0a0d 0a20 2020 2064 6566 205f  f))....    def _
-0003fd00: 5f65 715f 5f28 7365 6c66 2c20 6f74 6865  _eq__(self, othe
-0003fd10: 7229 3a0d 0a20 2020 2020 2020 2069 6620  r):..        if 
-0003fd20: 6973 696e 7374 616e 6365 286f 7468 6572  isinstance(other
-0003fd30: 2c20 7374 7229 3a0d 0a20 2020 2020 2020  , str):..       
-0003fd40: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-0003fd50: 2e5f 5f65 715f 5f28 5061 7468 286f 7468  .__eq__(Path(oth
-0003fd60: 6572 2929 0d0a 2020 2020 2020 2020 6966  er))..        if
-0003fd70: 206e 6f74 2069 7369 6e73 7461 6e63 6528   not isinstance(
-0003fd80: 6f74 6865 722c 2028 5061 7468 2c20 5375  other, (Path, Su
-0003fd90: 6270 6174 6829 293a 0d0a 2020 2020 2020  bpath)):..      
-0003fda0: 2020 2020 2020 7265 7475 726e 204e 6f74        return Not
-0003fdb0: 496d 706c 656d 656e 7465 640d 0a20 2020  Implemented..   
-0003fdc0: 2020 2020 2069 6620 6c65 6e28 7365 6c66       if len(self
-0003fdd0: 2920 213d 206c 656e 286f 7468 6572 293a  ) != len(other):
-0003fde0: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
-0003fdf0: 7475 726e 2046 616c 7365 0d0a 2020 2020  turn False..    
-0003fe00: 2020 2020 666f 7220 732c 206f 2069 6e20      for s, o in 
-0003fe10: 7a69 7028 7365 6c66 2c20 6f74 6865 7229  zip(self, other)
-0003fe20: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
-0003fe30: 6620 6e6f 7420 7320 3d3d 206f 3a0d 0a20  f not s == o:.. 
-0003fe40: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0003fe50: 6574 7572 6e20 4661 6c73 650d 0a20 2020  eturn False..   
-0003fe60: 2020 2020 2072 6574 7572 6e20 5472 7565       return True
-0003fe70: 0d0a 0d0a 2020 2020 6465 6620 5f5f 6e65  ....    def __ne
-0003fe80: 5f5f 2873 656c 662c 206f 7468 6572 293a  __(self, other):
-0003fe90: 0d0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
-0003fea0: 2069 7369 6e73 7461 6e63 6528 6f74 6865   isinstance(othe
-0003feb0: 722c 2028 5061 7468 2c20 5375 6270 6174  r, (Path, Subpat
-0003fec0: 682c 2073 7472 2929 3a0d 0a20 2020 2020  h, str)):..     
-0003fed0: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
-0003fee0: 7449 6d70 6c65 6d65 6e74 6564 0d0a 2020  tImplemented..  
-0003fef0: 2020 2020 2020 7265 7475 726e 206e 6f74        return not
-0003ff00: 2073 656c 6620 3d3d 206f 7468 6572 0d0a   self == other..
-0003ff10: 0d0a 2020 2020 6465 6620 7365 676d 656e  ..    def segmen
-0003ff20: 7473 2873 656c 662c 2074 7261 6e73 666f  ts(self, transfo
-0003ff30: 726d 6564 3d54 7275 6529 3a0d 0a20 2020  rmed=True):..   
-0003ff40: 2020 2020 2070 6174 6820 3d20 7365 6c66       path = self
-0003ff50: 2e5f 7061 7468 0d0a 2020 2020 2020 2020  ._path..        
-0003ff60: 6966 2074 7261 6e73 666f 726d 6564 3a0d  if transformed:.
-0003ff70: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0003ff80: 7572 6e20 5b0d 0a20 2020 2020 2020 2020  urn [..         
-0003ff90: 2020 2020 2020 2073 202a 2070 6174 682e         s * path.
-0003ffa0: 7472 616e 7366 6f72 6d20 666f 7220 7320  transform for s 
-0003ffb0: 696e 2070 6174 682e 5f73 6567 6d65 6e74  in path._segment
-0003ffc0: 735b 7365 6c66 2e5f 7374 6172 7420 3a20  s[self._start : 
-0003ffd0: 7365 6c66 2e5f 656e 6420 2b20 315d 0d0a  self._end + 1]..
-0003ffe0: 2020 2020 2020 2020 2020 2020 5d0d 0a20              ].. 
-0003fff0: 2020 2020 2020 2072 6574 7572 6e20 7061         return pa
-00040000: 7468 2e5f 7365 676d 656e 7473 5b73 656c  th._segments[sel
-00040010: 662e 5f73 7461 7274 203a 2073 656c 662e  f._start : self.
-00040020: 5f65 6e64 202b 2031 5d0d 0a0d 0a20 2020  _end + 1]....   
-00040030: 2064 6566 205f 6e75 6d65 7269 635f 696e   def _numeric_in
-00040040: 6465 7828 7365 6c66 2c20 696e 6465 7829  dex(self, index)
-00040050: 3a0d 0a20 2020 2020 2020 2069 6620 696e  :..        if in
-00040060: 6465 7820 3c20 303a 0d0a 2020 2020 2020  dex < 0:..      
-00040070: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-00040080: 662e 5f65 6e64 202b 2069 6e64 6578 202b  f._end + index +
-00040090: 2031 0d0a 2020 2020 2020 2020 656c 7365   1..        else
-000400a0: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
-000400b0: 6574 7572 6e20 7365 6c66 2e5f 7374 6172  eturn self._star
-000400c0: 7420 2b20 696e 6465 780d 0a0d 0a20 2020  t + index....   
-000400d0: 2064 6566 2069 6e64 6578 5f74 6f5f 7061   def index_to_pa
-000400e0: 7468 5f69 6e64 6578 2873 656c 662c 2069  th_index(self, i
-000400f0: 6e64 6578 293a 0d0a 2020 2020 2020 2020  ndex):..        
-00040100: 6966 2069 7369 6e73 7461 6e63 6528 696e  if isinstance(in
-00040110: 6465 782c 2073 6c69 6365 293a 0d0a 2020  dex, slice):..  
-00040120: 2020 2020 2020 2020 2020 7374 6172 7420            start 
-00040130: 3d20 696e 6465 782e 7374 6172 740d 0a20  = index.start.. 
-00040140: 2020 2020 2020 2020 2020 2073 746f 7020             stop 
-00040150: 3d20 696e 6465 782e 7374 6f70 0d0a 2020  = index.stop..  
-00040160: 2020 2020 2020 2020 2020 7374 6570 203d            step =
-00040170: 2069 6e64 6578 2e73 7465 700d 0a20 2020   index.step..   
-00040180: 2020 2020 2020 2020 2069 6620 7374 6172           if star
-00040190: 7420 6973 204e 6f6e 653a 0d0a 2020 2020  t is None:..    
-000401a0: 2020 2020 2020 2020 2020 2020 7374 6172              star
-000401b0: 7420 3d20 300d 0a20 2020 2020 2020 2020  t = 0..         
-000401c0: 2020 2073 7461 7274 203d 2073 656c 662e     start = self.
-000401d0: 5f6e 756d 6572 6963 5f69 6e64 6578 2873  _numeric_index(s
-000401e0: 7461 7274 290d 0a20 2020 2020 2020 2020  tart)..         
-000401f0: 2020 2069 6620 7374 6f70 2069 7320 4e6f     if stop is No
-00040200: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
-00040210: 2020 2020 2073 746f 7020 3d20 6c65 6e28       stop = len(
-00040220: 7365 6c66 290d 0a20 2020 2020 2020 2020  self)..         
-00040230: 2020 2073 746f 7020 3d20 7365 6c66 2e5f     stop = self._
-00040240: 6e75 6d65 7269 635f 696e 6465 7828 7374  numeric_index(st
-00040250: 6f70 290d 0a20 2020 2020 2020 2020 2020  op)..           
-00040260: 2072 6574 7572 6e20 736c 6963 6528 7374   return slice(st
-00040270: 6172 742c 2073 746f 702c 2073 7465 7029  art, stop, step)
-00040280: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00040290: 2073 656c 662e 5f6e 756d 6572 6963 5f69   self._numeric_i
-000402a0: 6e64 6578 2869 6e64 6578 290d 0a0d 0a20  ndex(index).... 
-000402b0: 2020 2064 6566 2062 626f 7828 7365 6c66     def bbox(self
-000402c0: 2c20 7472 616e 7366 6f72 6d65 643d 5472  , transformed=Tr
-000402d0: 7565 2c20 7769 7468 5f73 7472 6f6b 653d  ue, with_stroke=
-000402e0: 4661 6c73 6529 3a0d 0a20 2020 2020 2020  False):..       
-000402f0: 2022 2222 7265 7475 726e 7320 6120 626f   """returns a bo
-00040300: 756e 6469 6e67 2062 6f78 2066 6f72 2074  unding box for t
-00040310: 6865 2073 7562 7061 7468 2222 220d 0a20  he subpath""".. 
-00040320: 2020 2020 2020 2069 6620 7472 616e 7366         if transf
-00040330: 6f72 6d65 643a 0d0a 2020 2020 2020 2020  ormed:..        
-00040340: 2020 2020 7265 7475 726e 2050 6174 6828      return Path(
-00040350: 7365 6c66 292e 6262 6f78 2874 7261 6e73  self).bbox(trans
-00040360: 666f 726d 6564 3d74 7261 6e73 666f 726d  formed=transform
-00040370: 6564 2c20 7769 7468 5f73 7472 6f6b 653d  ed, with_stroke=
-00040380: 7769 7468 5f73 7472 6f6b 6529 0d0a 0d0a  with_stroke)....
-00040390: 2020 2020 2020 2020 7365 676d 656e 7473          segments
-000403a0: 203d 2073 656c 662e 5f70 6174 682e 5f73   = self._path._s
-000403b0: 6567 6d65 6e74 735b 7365 6c66 2e5f 7374  egments[self._st
-000403c0: 6172 7420 3a20 7365 6c66 2e5f 656e 6420  art : self._end 
-000403d0: 2b20 315d 0d0a 2020 2020 2020 2020 6262  + 1]..        bb
-000403e0: 7320 3d20 5b73 6567 2e62 626f 7828 2920  s = [seg.bbox() 
-000403f0: 666f 7220 7365 6720 696e 2073 6567 6d65  for seg in segme
-00040400: 6e74 7320 6966 206e 6f74 2069 7369 6e73  nts if not isins
-00040410: 7461 6e63 6528 436c 6f73 652c 204d 6f76  tance(Close, Mov
-00040420: 6529 5d0d 0a20 2020 2020 2020 2074 7279  e)]..        try
-00040430: 3a0d 0a20 2020 2020 2020 2020 2020 2078  :..            x
-00040440: 6d69 6e73 2c20 796d 696e 732c 2078 6d61  mins, ymins, xma
-00040450: 7873 2c20 796d 6178 7320 3d20 6c69 7374  xs, ymaxs = list
-00040460: 287a 6970 282a 6262 7329 290d 0a20 2020  (zip(*bbs))..   
-00040470: 2020 2020 2065 7863 6570 7420 5661 6c75       except Valu
-00040480: 6545 7272 6f72 3a0d 0a20 2020 2020 2020  eError:..       
-00040490: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
-000404a0: 2020 2320 4e6f 2062 6f75 6e64 696e 6720    # No bounding 
-000404b0: 626f 7820 6974 656d 7320 6578 6973 7465  box items existe
-000404c0: 642e 2053 6f20 6e6f 2062 6f75 6e64 696e  d. So no boundin
-000404d0: 6720 626f 782e 0d0a 0d0a 2020 2020 2020  g box.....      
-000404e0: 2020 6966 2028 0d0a 2020 2020 2020 2020    if (..        
-000404f0: 2020 2020 7769 7468 5f73 7472 6f6b 650d      with_stroke.
-00040500: 0a20 2020 2020 2020 2020 2020 2061 6e64  .            and
-00040510: 2073 656c 662e 5f70 6174 682e 7374 726f   self._path.stro
-00040520: 6b65 5f77 6964 7468 2069 7320 6e6f 7420  ke_width is not 
-00040530: 4e6f 6e65 0d0a 2020 2020 2020 2020 2020  None..          
-00040540: 2020 616e 6420 6e6f 7420 2873 656c 662e    and not (self.
-00040550: 5f70 6174 682e 7374 726f 6b65 2069 7320  _path.stroke is 
-00040560: 4e6f 6e65 206f 7220 7365 6c66 2e5f 7061  None or self._pa
-00040570: 7468 2e73 7472 6f6b 652e 7661 6c75 6520  th.stroke.value 
-00040580: 6973 204e 6f6e 6529 0d0a 2020 2020 2020  is None)..      
-00040590: 2020 293a 0d0a 2020 2020 2020 2020 2020    ):..          
-000405a0: 2020 6465 6c74 6120 3d20 666c 6f61 7428    delta = float(
-000405b0: 7365 6c66 2e5f 7061 7468 2e73 7472 6f6b  self._path.strok
-000405c0: 655f 7769 6474 6829 202f 2032 2e30 0d0a  e_width) / 2.0..
-000405d0: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-000405e0: 2020 2020 2020 2020 2020 2064 656c 7461             delta
-000405f0: 203d 2030 2e30 0d0a 0d0a 2020 2020 2020   = 0.0....      
-00040600: 2020 7265 7475 726e 2028 0d0a 2020 2020    return (..    
-00040610: 2020 2020 2020 2020 6d69 6e28 786d 696e          min(xmin
-00040620: 7329 202d 2064 656c 7461 2c0d 0a20 2020  s) - delta,..   
-00040630: 2020 2020 2020 2020 206d 696e 2879 6d69           min(ymi
-00040640: 6e73 2920 2d20 6465 6c74 612c 0d0a 2020  ns) - delta,..  
-00040650: 2020 2020 2020 2020 2020 6d61 7828 786d            max(xm
-00040660: 6178 7329 202b 2064 656c 7461 2c0d 0a20  axs) + delta,.. 
-00040670: 2020 2020 2020 2020 2020 206d 6178 2879             max(y
-00040680: 6d61 7873 2920 2b20 6465 6c74 612c 0d0a  maxs) + delta,..
-00040690: 2020 2020 2020 2020 290d 0a0d 0a20 2020          )....   
-000406a0: 2064 6566 2064 2873 656c 662c 2072 656c   def d(self, rel
-000406b0: 6174 6976 653d 4e6f 6e65 2c20 736d 6f6f  ative=None, smoo
-000406c0: 7468 3d4e 6f6e 6529 3a0d 0a20 2020 2020  th=None):..     
-000406d0: 2020 2073 6567 6d65 6e74 7320 3d20 7365     segments = se
-000406e0: 6c66 2e5f 7061 7468 2e5f 7365 676d 656e  lf._path._segmen
-000406f0: 7473 5b73 656c 662e 5f73 7461 7274 203a  ts[self._start :
-00040700: 2073 656c 662e 5f65 6e64 202b 2031 5d0d   self._end + 1].
-00040710: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00040720: 5061 7468 2e73 7667 5f64 2873 6567 6d65  Path.svg_d(segme
-00040730: 6e74 732c 2072 656c 6174 6976 653d 7265  nts, relative=re
-00040740: 6c61 7469 7665 2c20 736d 6f6f 7468 3d4e  lative, smooth=N
-00040750: 6f6e 6529 0d0a 0d0a 2020 2020 6465 6620  one)....    def 
-00040760: 5f72 6576 6572 7365 5f73 6567 6d65 6e74  _reverse_segment
-00040770: 7328 7365 6c66 2c20 7374 6172 742c 2065  s(self, start, e
-00040780: 6e64 293a 0d0a 2020 2020 2020 2020 2222  nd):..        ""
-00040790: 2252 6576 6572 7365 7320 7365 676d 656e  "Reverses segmen
-000407a0: 7473 2062 6574 7765 656e 2074 6865 2067  ts between the g
-000407b0: 6976 656e 2069 6e64 6578 6573 2069 6e20  iven indexes in 
-000407c0: 7468 6520 7375 6270 6174 6820 7370 6163  the subpath spac
-000407d0: 652e 2222 220d 0a20 2020 2020 2020 2073  e."""..        s
-000407e0: 6567 6d65 6e74 7320 3d20 7365 6c66 2e5f  egments = self._
-000407f0: 7061 7468 2e5f 7365 676d 656e 7473 2020  path._segments  
-00040800: 2320 6d75 7374 2061 766f 6964 2070 6174  # must avoid pat
-00040810: 6820 7661 6c69 6461 7469 6f6e 2e0d 0a20  h validation... 
-00040820: 2020 2020 2020 2073 203d 2073 656c 662e         s = self.
-00040830: 696e 6465 785f 746f 5f70 6174 685f 696e  index_to_path_in
-00040840: 6465 7828 7374 6172 7429 0d0a 2020 2020  dex(start)..    
-00040850: 2020 2020 6520 3d20 7365 6c66 2e69 6e64      e = self.ind
-00040860: 6578 5f74 6f5f 7061 7468 5f69 6e64 6578  ex_to_path_index
-00040870: 2865 6e64 290d 0a20 2020 2020 2020 2077  (end)..        w
-00040880: 6869 6c65 2073 203c 3d20 653a 0d0a 2020  hile s <= e:..  
-00040890: 2020 2020 2020 2020 2020 7374 6172 745f            start_
-000408a0: 7365 676d 656e 7420 3d20 7365 676d 656e  segment = segmen
-000408b0: 7473 5b73 5d0d 0a20 2020 2020 2020 2020  ts[s]..         
-000408c0: 2020 2065 6e64 5f73 6567 6d65 6e74 203d     end_segment =
-000408d0: 2073 6567 6d65 6e74 735b 655d 0d0a 2020   segments[e]..  
-000408e0: 2020 2020 2020 2020 2020 7374 6172 745f            start_
-000408f0: 7365 676d 656e 742e 7265 7665 7273 6528  segment.reverse(
-00040900: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
-00040910: 6620 7374 6172 745f 7365 676d 656e 7420  f start_segment 
-00040920: 6973 206e 6f74 2065 6e64 5f73 6567 6d65  is not end_segme
-00040930: 6e74 3a0d 0a20 2020 2020 2020 2020 2020  nt:..           
-00040940: 2020 2020 2065 6e64 5f73 6567 6d65 6e74       end_segment
-00040950: 2e72 6576 6572 7365 2829 0d0a 2020 2020  .reverse()..    
-00040960: 2020 2020 2020 2020 2020 2020 7365 676d              segm
-00040970: 656e 7473 5b73 5d20 3d20 656e 645f 7365  ents[s] = end_se
-00040980: 676d 656e 740d 0a20 2020 2020 2020 2020  gment..         
-00040990: 2020 2020 2020 2073 6567 6d65 6e74 735b         segments[
-000409a0: 655d 203d 2073 7461 7274 5f73 6567 6d65  e] = start_segme
-000409b0: 6e74 0d0a 2020 2020 2020 2020 2020 2020  nt..            
-000409c0: 7320 2b3d 2031 0d0a 2020 2020 2020 2020  s += 1..        
-000409d0: 2020 2020 6520 2d3d 2031 0d0a 2020 2020      e -= 1..    
-000409e0: 2020 2020 7374 6172 7420 3d20 7365 6c66      start = self
-000409f0: 2e69 6e64 6578 5f74 6f5f 7061 7468 5f69  .index_to_path_i
-00040a00: 6e64 6578 2873 7461 7274 290d 0a20 2020  ndex(start)..   
-00040a10: 2020 2020 2065 6e64 203d 2073 656c 662e       end = self.
-00040a20: 696e 6465 785f 746f 5f70 6174 685f 696e  index_to_path_in
-00040a30: 6465 7828 656e 6429 0d0a 2020 2020 2020  dex(end)..      
-00040a40: 2020 7365 6c66 2e5f 7061 7468 2e5f 7661    self._path._va
-00040a50: 6c69 6461 7465 5f63 6f6e 6e65 6374 696f  lidate_connectio
-00040a60: 6e28 7374 6172 7420 2d20 312c 2070 7265  n(start - 1, pre
-00040a70: 6665 725f 7365 636f 6e64 3d54 7275 6529  fer_second=True)
-00040a80: 0d0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
-00040a90: 7061 7468 2e5f 7661 6c69 6461 7465 5f63  path._validate_c
-00040aa0: 6f6e 6e65 6374 696f 6e28 656e 6429 0d0a  onnection(end)..
-00040ab0: 0d0a 2020 2020 6465 6620 7265 7665 7273  ..    def revers
-00040ac0: 6528 7365 6c66 293a 0d0a 2020 2020 2020  e(self):..      
-00040ad0: 2020 7369 7a65 203d 206c 656e 2873 656c    size = len(sel
-00040ae0: 6629 0d0a 2020 2020 2020 2020 6966 2073  f)..        if s
-00040af0: 697a 6520 3d3d 2030 3a0d 0a20 2020 2020  ize == 0:..     
-00040b00: 2020 2020 2020 2072 6574 7572 6e0d 0a20         return.. 
-00040b10: 2020 2020 2020 2073 7461 7274 203d 2030         start = 0
-00040b20: 0d0a 2020 2020 2020 2020 656e 6420 3d20  ..        end = 
-00040b30: 7369 7a65 202d 2031 0d0a 2020 2020 2020  size - 1..      
-00040b40: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-00040b50: 7365 6c66 5b2d 315d 2c20 436c 6f73 6529  self[-1], Close)
-00040b60: 3a0d 0a20 2020 2020 2020 2020 2020 2065  :..            e
-00040b70: 6e64 202d 3d20 310d 0a20 2020 2020 2020  nd -= 1..       
-00040b80: 2069 6620 6973 696e 7374 616e 6365 280d   if isinstance(.
-00040b90: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00040ba0: 665b 305d 2c20 4d6f 7665 0d0a 2020 2020  f[0], Move..    
-00040bb0: 2020 2020 293a 2020 2320 4d6f 7665 2072      ):  # Move r
-00040bc0: 656d 6169 6e73 2069 6e20 706c 6163 6520  emains in place 
-00040bd0: 6275 7420 7265 6665 7265 6e63 6573 206e  but references n
-00040be0: 6578 7420 656c 656d 656e 742e 0d0a 2020  ext element...  
-00040bf0: 2020 2020 2020 2020 2020 7374 6172 7420            start 
-00040c00: 2b3d 2031 0d0a 2020 2020 2020 2020 7365  += 1..        se
-00040c10: 6c66 2e5f 7265 7665 7273 655f 7365 676d  lf._reverse_segm
-00040c20: 656e 7473 2873 7461 7274 2c20 656e 6429  ents(start, end)
-00040c30: 0d0a 2020 2020 2020 2020 6966 2073 697a  ..        if siz
-00040c40: 6520 3e20 313a 0d0a 2020 2020 2020 2020  e > 1:..        
-00040c50: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-00040c60: 6528 7365 6c66 5b30 5d2c 204d 6f76 6529  e(self[0], Move)
-00040c70: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00040c80: 2020 2073 656c 665b 305d 2e65 6e64 203d     self[0].end =
-00040c90: 2050 6f69 6e74 2873 656c 665b 315d 2e73   Point(self[1].s
-00040ca0: 7461 7274 290d 0a20 2020 2020 2020 206c  tart)..        l
-00040cb0: 6173 7420 3d20 7365 6c66 5b2d 315d 0d0a  ast = self[-1]..
-00040cc0: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-00040cd0: 7461 6e63 6528 6c61 7374 2c20 436c 6f73  tance(last, Clos
-00040ce0: 6529 3a0d 0a20 2020 2020 2020 2020 2020  e):..           
-00040cf0: 206c 6173 742e 7265 7665 7273 6528 290d   last.reverse().
-00040d00: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00040d10: 6c61 7374 2e73 7461 7274 2021 3d20 7365  last.start != se
-00040d20: 6c66 5b2d 325d 2e65 6e64 3a0d 0a20 2020  lf[-2].end:..   
-00040d30: 2020 2020 2020 2020 2020 2020 206c 6173               las
-00040d40: 742e 7374 6172 7420 3d20 506f 696e 7428  t.start = Point(
-00040d50: 7365 6c66 5b2d 325d 2e65 6e64 290d 0a20  self[-2].end).. 
-00040d60: 2020 2020 2020 2020 2020 2069 6620 6c61             if la
-00040d70: 7374 2e65 6e64 2021 3d20 7365 6c66 5b30  st.end != self[0
-00040d80: 5d2e 656e 643a 0d0a 2020 2020 2020 2020  ].end:..        
-00040d90: 2020 2020 2020 2020 6c61 7374 2e65 6e64          last.end
-00040da0: 203d 2050 6f69 6e74 2873 656c 665b 305d   = Point(self[0]
-00040db0: 2e65 6e64 290d 0a20 2020 2020 2020 2072  .end)..        r
-00040dc0: 6574 7572 6e20 7365 6c66 0d0a 0d0a 0d0a  eturn self......
-00040dd0: 636c 6173 7320 4772 6f75 7028 5356 4745  class Group(SVGE
-00040de0: 6c65 6d65 6e74 2c20 5472 616e 7366 6f72  lement, Transfor
-00040df0: 6d61 626c 652c 206c 6973 7429 3a0d 0a20  mable, list):.. 
-00040e00: 2020 2022 2222 0d0a 2020 2020 4772 6f75     """..    Grou
-00040e10: 7020 436f 6e74 6169 6e65 7220 656c 656d  p Container elem
-00040e20: 656e 7420 6361 6e20 6861 7665 2063 6869  ent can have chi
-00040e30: 6c64 7265 6e2e 0d0a 2020 2020 5356 4720  ldren...    SVG 
-00040e40: 322e 3020 3c67 3e20 6172 6520 6465 6669  2.0 <g> are defi
-00040e50: 6e65 6420 696e 3a0d 0a20 2020 2035 2e32  ned in:..    5.2
-00040e60: 2e20 4772 6f75 7069 6e67 3a20 7468 6520  . Grouping: the 
-00040e70: 6720 656c 656d 656e 740d 0a20 2020 2022  g element..    "
-00040e80: 2222 0d0a 0d0a 2020 2020 6465 6620 5f5f  ""....    def __
-00040e90: 696e 6974 5f5f 2873 656c 662c 202a 6172  init__(self, *ar
-00040ea0: 6773 2c20 2a2a 6b77 6172 6773 293a 0d0a  gs, **kwargs):..
-00040eb0: 2020 2020 2020 2020 5472 616e 7366 6f72          Transfor
-00040ec0: 6d61 626c 652e 5f5f 696e 6974 5f5f 2873  mable.__init__(s
-00040ed0: 656c 662c 202a 6172 6773 2c20 2a2a 6b77  elf, *args, **kw
-00040ee0: 6172 6773 290d 0a20 2020 2020 2020 206c  args)..        l
-00040ef0: 6973 742e 5f5f 696e 6974 5f5f 2873 656c  ist.__init__(sel
-00040f00: 6629 0d0a 2020 2020 2020 2020 6966 206c  f)..        if l
-00040f10: 656e 2861 7267 7329 203e 3d20 313a 0d0a  en(args) >= 1:..
-00040f20: 2020 2020 2020 2020 2020 2020 7320 3d20              s = 
-00040f30: 6172 6773 5b30 5d0d 0a20 2020 2020 2020  args[0]..       
-00040f40: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
-00040f50: 6365 2873 2c20 4772 6f75 7029 3a0d 0a20  ce(s, Group):.. 
-00040f60: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00040f70: 656c 662e 6578 7465 6e64 286c 6973 7428  elf.extend(list(
-00040f80: 6d61 7028 636f 7079 2c20 7329 2929 0d0a  map(copy, s)))..
-00040f90: 2020 2020 2020 2020 5356 4745 6c65 6d65          SVGEleme
-00040fa0: 6e74 2e5f 5f69 6e69 745f 5f28 7365 6c66  nt.__init__(self
-00040fb0: 2c20 2a61 7267 732c 202a 2a6b 7761 7267  , *args, **kwarg
-00040fc0: 7329 0d0a 0d0a 2020 2020 6465 6620 5f5f  s)....    def __
-00040fd0: 696d 756c 5f5f 2873 656c 662c 206f 7468  imul__(self, oth
-00040fe0: 6572 293a 0d0a 2020 2020 2020 2020 6966  er):..        if
-00040ff0: 2069 7369 6e73 7461 6e63 6528 6f74 6865   isinstance(othe
-00041000: 722c 2073 7472 293a 0d0a 2020 2020 2020  r, str):..      
-00041010: 2020 2020 2020 6f74 6865 7220 3d20 4d61        other = Ma
-00041020: 7472 6978 286f 7468 6572 290d 0a20 2020  trix(other)..   
-00041030: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
-00041040: 6365 286f 7468 6572 2c20 4d61 7472 6978  ce(other, Matrix
-00041050: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00041060: 7365 6c66 2e74 7261 6e73 666f 726d 202a  self.transform *
-00041070: 3d20 6f74 6865 720d 0a20 2020 2020 2020  = other..       
-00041080: 2020 2020 2066 6f72 2065 2069 6e20 7365       for e in se
-00041090: 6c66 3a0d 0a20 2020 2020 2020 2020 2020  lf:..           
-000410a0: 2020 2020 2065 202a 3d20 6f74 6865 720d       e *= other.
-000410b0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000410c0: 7365 6c66 0d0a 0d0a 2020 2020 6465 6620  self....    def 
-000410d0: 7265 6e64 6572 2873 656c 662c 202a 2a6b  render(self, **k
-000410e0: 7761 7267 7329 3a0d 0a20 2020 2020 2020  wargs):..       
-000410f0: 2054 7261 6e73 666f 726d 6162 6c65 2e72   Transformable.r
-00041100: 656e 6465 7228 7365 6c66 2c20 2a2a 6b77  ender(self, **kw
-00041110: 6172 6773 290d 0a0d 0a20 2020 2064 6566  args)....    def
-00041120: 205f 5f63 6f70 795f 5f28 7365 6c66 293a   __copy__(self):
-00041130: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00041140: 2047 726f 7570 2873 656c 6629 0d0a 0d0a   Group(self)....
-00041150: 2020 2020 6465 6620 7072 6f70 6572 7479      def property
-00041160: 5f62 795f 6f62 6a65 6374 2873 656c 662c  _by_object(self,
-00041170: 2073 293a 0d0a 2020 2020 2020 2020 5472   s):..        Tr
-00041180: 616e 7366 6f72 6d61 626c 652e 7072 6f70  ansformable.prop
-00041190: 6572 7479 5f62 795f 6f62 6a65 6374 2873  erty_by_object(s
-000411a0: 656c 662c 2073 290d 0a20 2020 2020 2020  elf, s)..       
-000411b0: 2053 5647 456c 656d 656e 742e 7072 6f70   SVGElement.prop
-000411c0: 6572 7479 5f62 795f 6f62 6a65 6374 2873  erty_by_object(s
-000411d0: 656c 662c 2073 290d 0a0d 0a20 2020 2064  elf, s)....    d
-000411e0: 6566 2070 726f 7065 7274 795f 6279 5f76  ef property_by_v
-000411f0: 616c 7565 7328 7365 6c66 2c20 7661 6c75  alues(self, valu
-00041200: 6573 293a 0d0a 2020 2020 2020 2020 5472  es):..        Tr
-00041210: 616e 7366 6f72 6d61 626c 652e 7072 6f70  ansformable.prop
-00041220: 6572 7479 5f62 795f 7661 6c75 6573 2873  erty_by_values(s
-00041230: 656c 662c 2076 616c 7565 7329 0d0a 2020  elf, values)..  
-00041240: 2020 2020 2020 5356 4745 6c65 6d65 6e74        SVGElement
-00041250: 2e70 726f 7065 7274 795f 6279 5f76 616c  .property_by_val
-00041260: 7565 7328 7365 6c66 2c20 7661 6c75 6573  ues(self, values
-00041270: 290d 0a0d 0a20 2020 2064 6566 2073 656c  )....    def sel
-00041280: 6563 7428 7365 6c66 2c20 636f 6e64 6974  ect(self, condit
-00041290: 696f 6e61 6c3d 4e6f 6e65 293a 0d0a 2020  ional=None):..  
-000412a0: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
-000412b0: 2020 2046 696e 6473 2061 6c6c 2066 6c61     Finds all fla
-000412c0: 7474 656e 6564 2073 7562 6f62 6a65 6374  ttened subobject
-000412d0: 7320 6f66 2074 6869 7320 6772 6f75 7020  s of this group 
-000412e0: 666f 7220 7768 6963 6820 7468 6520 636f  for which the co
-000412f0: 6e64 6974 696f 6e61 6c20 7265 7475 726e  nditional return
-00041300: 730d 0a20 2020 2020 2020 2074 7275 652e  s..        true.
-00041310: 0d0a 0d0a 2020 2020 2020 2020 3a70 6172  ....        :par
-00041320: 616d 2063 6f6e 6469 7469 6f6e 616c 3a20  am conditional: 
-00041330: 6675 6e63 7469 6f6e 2074 616b 696e 6720  function taking 
-00041340: 656c 656d 656e 7420 616e 6420 7265 7475  element and retu
-00041350: 726e 7320 5472 7565 2074 6f20 696e 636c  rns True to incl
-00041360: 7564 6520 6f72 2046 616c 7365 2069 6620  ude or False if 
-00041370: 6578 636c 7564 650d 0a20 2020 2020 2020  exclude..       
-00041380: 2022 2222 0d0a 2020 2020 2020 2020 6966   """..        if
-00041390: 2063 6f6e 6469 7469 6f6e 616c 2069 7320   conditional is 
-000413a0: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
-000413b0: 2020 2066 6f72 2073 7562 6974 656d 2069     for subitem i
-000413c0: 6e20 7365 6c66 3a0d 0a20 2020 2020 2020  n self:..       
-000413d0: 2020 2020 2020 2020 2079 6965 6c64 2073           yield s
-000413e0: 7562 6974 656d 0d0a 2020 2020 2020 2020  ubitem..        
-000413f0: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-00041400: 7461 6e63 6528 7375 6269 7465 6d2c 2028  tance(subitem, (
-00041410: 4772 6f75 702c 2055 7365 2929 3a0d 0a20  Group, Use)):.. 
-00041420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00041430: 2020 2066 6f72 2073 2069 6e20 7375 6269     for s in subi
-00041440: 7465 6d2e 7365 6c65 6374 2863 6f6e 6469  tem.select(condi
-00041450: 7469 6f6e 616c 293a 0d0a 2020 2020 2020  tional):..      
-00041460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00041470: 2020 7969 656c 6420 730d 0a20 2020 2020    yield s..     
-00041480: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-00041490: 2020 2020 2020 666f 7220 7375 6269 7465        for subite
-000414a0: 6d20 696e 2073 656c 663a 0d0a 2020 2020  m in self:..    
-000414b0: 2020 2020 2020 2020 2020 2020 6966 2063              if c
-000414c0: 6f6e 6469 7469 6f6e 616c 2873 7562 6974  onditional(subit
-000414d0: 656d 293a 0d0a 2020 2020 2020 2020 2020  em):..          
-000414e0: 2020 2020 2020 2020 2020 7969 656c 6420            yield 
-000414f0: 7375 6269 7465 6d0d 0a20 2020 2020 2020  subitem..       
-00041500: 2020 2020 2020 2020 2069 6620 6973 696e           if isin
-00041510: 7374 616e 6365 2873 7562 6974 656d 2c20  stance(subitem, 
-00041520: 2847 726f 7570 2c20 5573 6529 293a 0d0a  (Group, Use)):..
-00041530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00041540: 2020 2020 666f 7220 7320 696e 2073 7562      for s in sub
-00041550: 6974 656d 2e73 656c 6563 7428 636f 6e64  item.select(cond
-00041560: 6974 696f 6e61 6c29 3a0d 0a20 2020 2020  itional):..     
-00041570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00041580: 2020 2079 6965 6c64 2073 0d0a 0d0a 2020     yield s....  
-00041590: 2020 6465 6620 7265 6966 7928 7365 6c66    def reify(self
-000415a0: 293a 0d0a 2020 2020 2020 2020 5472 616e  ):..        Tran
-000415b0: 7366 6f72 6d61 626c 652e 7265 6966 7928  sformable.reify(
-000415c0: 7365 6c66 290d 0a0d 0a20 2020 2040 7374  self)....    @st
-000415d0: 6174 6963 6d65 7468 6f64 0d0a 2020 2020  aticmethod..    
-000415e0: 6465 6620 756e 696f 6e5f 6262 6f78 2865  def union_bbox(e
-000415f0: 6c65 6d65 6e74 732c 2074 7261 6e73 666f  lements, transfo
-00041600: 726d 6564 3d54 7275 652c 2077 6974 685f  rmed=True, with_
-00041610: 7374 726f 6b65 3d46 616c 7365 293a 0d0a  stroke=False):..
-00041620: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
-00041630: 2020 2020 2052 6574 7572 6e73 2074 6865       Returns the
-00041640: 2075 6e69 6f6e 206f 6620 7468 6520 626f   union of the bo
-00041650: 756e 6469 6e67 2062 6f78 6573 2066 6f72  unding boxes for
-00041660: 2074 6865 2065 6c65 6d65 6e74 7320 7769   the elements wi
-00041670: 7468 696e 2074 6865 2069 7465 7261 746f  thin the iterato
-00041680: 722e 0d0a 0d0a 2020 2020 2020 2020 3a70  r.....        :p
-00041690: 6172 616d 2074 7261 6e73 666f 726d 6564  aram transformed
-000416a0: 3a20 5368 6f75 6c64 2074 6865 2063 6869  : Should the chi
-000416b0: 6c64 7265 6e20 6f66 2074 6869 7320 6f62  ldren of this ob
-000416c0: 6a65 6374 2062 6520 7072 6f70 6572 6c79  ject be properly
-000416d0: 2074 7261 6e73 666f 726d 6564 2e0d 0a20   transformed... 
-000416e0: 2020 2020 2020 203a 7061 7261 6d20 7769         :param wi
-000416f0: 7468 5f73 7472 6f6b 653a 2073 686f 756c  th_stroke: shoul
-00041700: 6420 7468 6520 7374 726f 6b65 2d77 6964  d the stroke-wid
-00041710: 7468 2062 6520 696e 636c 7564 6564 2069  th be included i
-00041720: 6e20 7468 6520 626f 756e 6473 206f 6620  n the bounds of 
-00041730: 7468 6520 656c 656d 656e 7473 0d0a 2020  the elements..  
-00041740: 2020 2020 2020 3a72 6574 7572 6e3a 2075        :return: u
-00041750: 6e69 6f6e 206f 6620 616c 6c20 626f 756e  nion of all boun
-00041760: 6469 6e67 2062 6f78 6573 206f 6620 656c  ding boxes of el
-00041770: 656d 656e 7473 2077 6974 6869 6e20 7468  ements within th
-00041780: 6520 6974 6572 6162 6c65 2e0d 0a20 2020  e iterable...   
-00041790: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
-000417a0: 2020 626f 7865 7320 3d20 5b5d 0d0a 2020    boxes = []..  
-000417b0: 2020 2020 2020 666f 7220 6520 696e 2065        for e in e
-000417c0: 6c65 6d65 6e74 733a 0d0a 2020 2020 2020  lements:..      
-000417d0: 2020 2020 2020 6966 206e 6f74 2068 6173        if not has
-000417e0: 6174 7472 2865 2c20 2262 626f 7822 2920  attr(e, "bbox") 
-000417f0: 6f72 2069 7369 6e73 7461 6e63 6528 652c  or isinstance(e,
-00041800: 2028 4772 6f75 702c 2055 7365 2929 3a0d   (Group, Use)):.
-00041810: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00041820: 2063 6f6e 7469 6e75 650d 0a20 2020 2020   continue..     
-00041830: 2020 2020 2020 2062 6f78 203d 2065 2e62         box = e.b
-00041840: 626f 7828 7472 616e 7366 6f72 6d65 643d  box(transformed=
-00041850: 7472 616e 7366 6f72 6d65 642c 2077 6974  transformed, wit
-00041860: 685f 7374 726f 6b65 3d77 6974 685f 7374  h_stroke=with_st
-00041870: 726f 6b65 290d 0a20 2020 2020 2020 2020  roke)..         
-00041880: 2020 2069 6620 626f 7820 6973 204e 6f6e     if box is Non
-00041890: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-000418a0: 2020 2020 636f 6e74 696e 7565 0d0a 2020      continue..  
-000418b0: 2020 2020 2020 2020 2020 626f 7865 732e            boxes.
-000418c0: 6170 7065 6e64 2862 6f78 290d 0a20 2020  append(box)..   
-000418d0: 2020 2020 2069 6620 6c65 6e28 626f 7865       if len(boxe
-000418e0: 7329 203d 3d20 303a 0d0a 2020 2020 2020  s) == 0:..      
-000418f0: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
-00041900: 650d 0a20 2020 2020 2020 2028 786d 696e  e..        (xmin
-00041910: 732c 2079 6d69 6e73 2c20 786d 6178 732c  s, ymins, xmaxs,
-00041920: 2079 6d61 7873 2920 3d20 7a69 7028 2a62   ymaxs) = zip(*b
-00041930: 6f78 6573 290d 0a20 2020 2020 2020 2072  oxes)..        r
-00041940: 6574 7572 6e20 286d 696e 2878 6d69 6e73  eturn (min(xmins
-00041950: 292c 206d 696e 2879 6d69 6e73 292c 206d  ), min(ymins), m
-00041960: 6178 2878 6d61 7873 292c 206d 6178 2879  ax(xmaxs), max(y
-00041970: 6d61 7873 2929 0d0a 0d0a 2020 2020 6465  maxs))....    de
-00041980: 6620 6262 6f78 2873 656c 662c 2074 7261  f bbox(self, tra
-00041990: 6e73 666f 726d 6564 3d54 7275 652c 2077  nsformed=True, w
-000419a0: 6974 685f 7374 726f 6b65 3d46 616c 7365  ith_stroke=False
-000419b0: 293a 0d0a 2020 2020 2020 2020 2222 220d  ):..        """.
-000419c0: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
-000419d0: 2074 6865 2062 6f75 6e64 696e 6720 626f   the bounding bo
-000419e0: 7820 6f66 2074 6865 2067 6976 656e 206f  x of the given o
-000419f0: 626a 6563 742e 0d0a 0d0a 2020 2020 2020  bject.....      
-00041a00: 2020 496e 2074 6865 2063 6173 6520 6f66    In the case of
-00041a10: 2067 726f 7570 7320 7468 6973 2069 7320   groups this is 
-00041a20: 7468 6520 756e 696f 6e20 6f66 2061 6c6c  the union of all
-00041a30: 2074 6865 2062 6f75 6e64 696e 6720 626f   the bounding bo
-00041a40: 7865 7320 6f66 2061 6c6c 2062 6f75 6e64  xes of all bound
-00041a50: 2063 6869 6c64 7265 6e2e 0d0a 0d0a 2020   children.....  
-00041a60: 2020 2020 2020 5365 7474 696e 6720 7472        Setting tr
-00041a70: 616e 7366 6f72 6d65 6420 746f 2066 616c  ansformed to fal
-00041a80: 7365 2c20 6d61 7920 7969 656c 6420 756e  se, may yield un
-00041a90: 6578 7065 6374 6564 2072 6573 756c 7473  expected results
-00041aa0: 2069 6620 7375 6269 7465 6d73 2061 7265   if subitems are
-00041ab0: 2074 7261 6e73 666f 726d 6564 2069 6e20   transformed in 
-00041ac0: 6e6f 6e2d 756e 6966 6f72 6d0d 0a20 2020  non-uniform..   
-00041ad0: 2020 2020 2077 6179 732e 0d0a 0d0a 2020       ways.....  
-00041ae0: 2020 2020 2020 3a70 6172 616d 2074 7261        :param tra
-00041af0: 6e73 666f 726d 6564 3a20 626f 756e 6469  nsformed: boundi
-00041b00: 6e67 2062 6f78 206f 6620 7468 6520 7072  ng box of the pr
-00041b10: 6f70 6572 6c79 2074 7261 6e73 666f 726d  operly transform
-00041b20: 6564 2063 6869 6c64 7265 6e2e 0d0a 2020  ed children...  
-00041b30: 2020 2020 2020 3a70 6172 616d 2077 6974        :param wit
-00041b40: 685f 7374 726f 6b65 3a20 7368 6f75 6c64  h_stroke: should
-00041b50: 2074 6865 2073 7472 6f6b 652d 7769 6474   the stroke-widt
-00041b60: 6820 6265 2069 6e63 6c75 6465 6420 696e  h be included in
-00041b70: 2074 6865 2062 6f75 6e64 732e 0d0a 2020   the bounds...  
-00041b80: 2020 2020 2020 3a72 6574 7572 6e3a 2062        :return: b
-00041b90: 6f75 6e64 696e 6720 626f 7820 6f66 2074  ounding box of t
-00041ba0: 6865 2067 6976 656e 2065 6c65 6d65 6e74  he given element
-00041bb0: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
-00041bc0: 2020 2020 2020 2072 6574 7572 6e20 4772         return Gr
-00041bd0: 6f75 702e 756e 696f 6e5f 6262 6f78 280d  oup.union_bbox(.
-00041be0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00041bf0: 662e 7365 6c65 6374 2829 2c0d 0a20 2020  f.select(),..   
-00041c00: 2020 2020 2020 2020 2074 7261 6e73 666f           transfo
-00041c10: 726d 6564 3d74 7261 6e73 666f 726d 6564  rmed=transformed
-00041c20: 2c0d 0a20 2020 2020 2020 2020 2020 2077  ,..            w
-00041c30: 6974 685f 7374 726f 6b65 3d77 6974 685f  ith_stroke=with_
-00041c40: 7374 726f 6b65 2c0d 0a20 2020 2020 2020  stroke,..       
-00041c50: 2029 0d0a 0d0a 0d0a 636c 6173 7320 5573   )......class Us
-00041c60: 6528 5356 4745 6c65 6d65 6e74 2c20 5472  e(SVGElement, Tr
-00041c70: 616e 7366 6f72 6d61 626c 652c 206c 6973  ansformable, lis
-00041c80: 7429 3a0d 0a20 2020 2022 2222 0d0a 2020  t):..    """..  
-00041c90: 2020 5573 6520 656c 656d 656e 7473 2061    Use elements a
-00041ca0: 7265 2064 6566 696e 6564 2069 6e20 7376  re defined in sv
-00041cb0: 6720 352e 360d 0a20 2020 2068 7474 7073  g 5.6..    https
-00041cc0: 3a2f 2f77 7777 2e77 332e 6f72 672f 5452  ://www.w3.org/TR
-00041cd0: 2f53 5647 3131 2f73 7472 7563 742e 6874  /SVG11/struct.ht
-00041ce0: 6d6c 2355 7365 456c 656d 656e 740d 0a0d  ml#UseElement...
-00041cf0: 0a20 2020 2055 7365 2069 7320 6120 6765  .    Use is a ge
-00041d00: 6e65 7269 6320 636f 6e74 6169 6e65 7220  neric container 
-00041d10: 6f62 6a65 6374 2067 726f 7570 2d6c 696b  object group-lik
-00041d20: 6520 7468 6174 2075 7365 2072 6566 6572  e that use refer
-00041d30: 656e 6365 206f 626a 6563 7473 2c0d 0a20  ence objects,.. 
-00041d40: 2020 2022 2222 0d0a 0d0a 2020 2020 6465     """....    de
-00041d50: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
-00041d60: 202a 6172 6773 2c20 2a2a 6b77 6172 6773   *args, **kwargs
-00041d70: 293a 0d0a 2020 2020 2020 2020 6c69 7374  ):..        list
-00041d80: 2e5f 5f69 6e69 745f 5f28 7365 6c66 290d  .__init__(self).
-00041d90: 0a20 2020 2020 2020 2073 656c 662e 7820  .        self.x 
-00041da0: 3d20 4e6f 6e65 0d0a 2020 2020 2020 2020  = None..        
-00041db0: 7365 6c66 2e79 203d 204e 6f6e 650d 0a20  self.y = None.. 
-00041dc0: 2020 2020 2020 2073 656c 662e 7769 6474         self.widt
-00041dd0: 6820 3d20 4e6f 6e65 0d0a 2020 2020 2020  h = None..      
-00041de0: 2020 7365 6c66 2e68 6569 6768 7420 3d20    self.height = 
-00041df0: 4e6f 6e65 0d0a 2020 2020 2020 2020 5472  None..        Tr
-00041e00: 616e 7366 6f72 6d61 626c 652e 5f5f 696e  ansformable.__in
-00041e10: 6974 5f5f 2873 656c 662c 202a 6172 6773  it__(self, *args
-00041e20: 2c20 2a2a 6b77 6172 6773 290d 0a20 2020  , **kwargs)..   
-00041e30: 2020 2020 2053 5647 456c 656d 656e 742e       SVGElement.
-00041e40: 5f5f 696e 6974 5f5f 280d 0a20 2020 2020  __init__(..     
-00041e50: 2020 2020 2020 2073 656c 662c 202a 6172         self, *ar
-00041e60: 6773 2c20 2a2a 6b77 6172 6773 0d0a 2020  gs, **kwargs..  
-00041e70: 2020 2020 2020 2920 2023 204d 7573 7420        )  # Must 
-00041e80: 676f 206c 6173 742c 2074 7269 6767 6572  go last, trigger
-00041e90: 732c 2062 795f 6f62 6a65 6374 2c20 6279  s, by_object, by
-00041ea0: 5f76 616c 7565 2c20 6279 5f61 7267 2066  _value, by_arg f
-00041eb0: 756e 6374 696f 6e73 2e0d 0a0d 0a20 2020  unctions.....   
-00041ec0: 2064 6566 2070 726f 7065 7274 795f 6279   def property_by
-00041ed0: 5f6f 626a 6563 7428 7365 6c66 2c20 7329  _object(self, s)
-00041ee0: 3a0d 0a20 2020 2020 2020 2053 5647 456c  :..        SVGEl
-00041ef0: 656d 656e 742e 7072 6f70 6572 7479 5f62  ement.property_b
-00041f00: 795f 6f62 6a65 6374 2873 656c 662c 2073  y_object(self, s
-00041f10: 290d 0a20 2020 2020 2020 2054 7261 6e73  )..        Trans
-00041f20: 666f 726d 6162 6c65 2e70 726f 7065 7274  formable.propert
-00041f30: 795f 6279 5f6f 626a 6563 7428 7365 6c66  y_by_object(self
-00041f40: 2c20 7329 0d0a 2020 2020 2020 2020 7365  , s)..        se
-00041f50: 6c66 2e78 203d 2073 2e78 0d0a 2020 2020  lf.x = s.x..    
-00041f60: 2020 2020 7365 6c66 2e79 203d 2073 2e79      self.y = s.y
-00041f70: 0d0a 2020 2020 2020 2020 7365 6c66 2e77  ..        self.w
-00041f80: 6964 7468 203d 2073 2e77 6964 7468 0d0a  idth = s.width..
-00041f90: 2020 2020 2020 2020 7365 6c66 2e68 6569          self.hei
-00041fa0: 6768 7420 3d20 732e 6865 6967 6874 0d0a  ght = s.height..
-00041fb0: 0d0a 2020 2020 6465 6620 7072 6f70 6572  ..    def proper
-00041fc0: 7479 5f62 795f 7661 6c75 6573 2873 656c  ty_by_values(sel
-00041fd0: 662c 2076 616c 7565 7329 3a0d 0a20 2020  f, values):..   
-00041fe0: 2020 2020 2073 656c 662e 7820 3d20 4c65       self.x = Le
-00041ff0: 6e67 7468 2876 616c 7565 732e 6765 7428  ngth(values.get(
-00042000: 5356 475f 4154 5452 5f58 2c20 3029 292e  SVG_ATTR_X, 0)).
-00042010: 7661 6c75 6528 290d 0a20 2020 2020 2020  value()..       
-00042020: 2073 656c 662e 7920 3d20 4c65 6e67 7468   self.y = Length
-00042030: 2876 616c 7565 732e 6765 7428 5356 475f  (values.get(SVG_
-00042040: 4154 5452 5f59 2c20 3029 292e 7661 6c75  ATTR_Y, 0)).valu
-00042050: 6528 290d 0a20 2020 2020 2020 2073 656c  e()..        sel
-00042060: 662e 7769 6474 6820 3d20 4c65 6e67 7468  f.width = Length
-00042070: 2876 616c 7565 732e 6765 7428 5356 475f  (values.get(SVG_
-00042080: 4154 5452 5f57 4944 5448 2c20 3129 292e  ATTR_WIDTH, 1)).
-00042090: 7661 6c75 6528 290d 0a20 2020 2020 2020  value()..       
-000420a0: 2073 656c 662e 6865 6967 6874 203d 204c   self.height = L
-000420b0: 656e 6774 6828 7661 6c75 6573 2e67 6574  ength(values.get
-000420c0: 2853 5647 5f41 5454 525f 4845 4947 4854  (SVG_ATTR_HEIGHT
-000420d0: 2c20 3129 292e 7661 6c75 6528 290d 0a20  , 1)).value().. 
-000420e0: 2020 2020 2020 2069 6620 7365 6c66 2e78         if self.x
-000420f0: 2021 3d20 3020 6f72 2073 656c 662e 7920   != 0 or self.y 
-00042100: 213d 2030 3a0d 0a20 2020 2020 2020 2020  != 0:..         
-00042110: 2020 2023 2049 6620 7820 6f72 2079 2069     # If x or y i
-00042120: 7320 7365 742c 2061 7070 6c79 2074 6869  s set, apply thi
-00042130: 7320 746f 2074 7261 6e73 666f 726d 0d0a  s to transform..
-00042140: 2020 2020 2020 2020 2020 2020 7472 793a              try:
-00042150: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00042160: 2020 7661 6c75 6573 5b53 5647 5f41 5454    values[SVG_ATT
-00042170: 525f 5452 414e 5346 4f52 4d5d 203d 2022  R_TRANSFORM] = "
-00042180: 2573 2074 7261 6e73 6c61 7465 2825 732c  %s translate(%s,
-00042190: 2025 7329 2220 2520 280d 0a20 2020 2020   %s)" % (..     
-000421a0: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-000421b0: 616c 7565 735b 5356 475f 4154 5452 5f54  alues[SVG_ATTR_T
-000421c0: 5241 4e53 464f 524d 5d2c 0d0a 2020 2020  RANSFORM],..    
-000421d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000421e0: 7365 6c66 2e78 2c0d 0a20 2020 2020 2020  self.x,..       
-000421f0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00042200: 662e 792c 0d0a 2020 2020 2020 2020 2020  f.y,..          
-00042210: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
-00042220: 2020 2020 2065 7863 6570 7420 4b65 7945       except KeyE
-00042230: 7272 6f72 3a0d 0a20 2020 2020 2020 2020  rror:..         
-00042240: 2020 2020 2020 2076 616c 7565 735b 5356         values[SV
-00042250: 475f 4154 5452 5f54 5241 4e53 464f 524d  G_ATTR_TRANSFORM
-00042260: 5d20 3d20 2274 7261 6e73 6c61 7465 2825  ] = "translate(%
-00042270: 732c 2025 7329 2220 2520 280d 0a20 2020  s, %s)" % (..   
-00042280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042290: 2073 656c 662e 782c 0d0a 2020 2020 2020   self.x,..      
-000422a0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-000422b0: 6c66 2e79 2c0d 0a20 2020 2020 2020 2020  lf.y,..         
-000422c0: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
-000422d0: 2020 5356 4745 6c65 6d65 6e74 2e70 726f    SVGElement.pro
-000422e0: 7065 7274 795f 6279 5f76 616c 7565 7328  perty_by_values(
-000422f0: 7365 6c66 2c20 7661 6c75 6573 290d 0a20  self, values).. 
-00042300: 2020 2020 2020 2054 7261 6e73 666f 726d         Transform
-00042310: 6162 6c65 2e70 726f 7065 7274 795f 6279  able.property_by
-00042320: 5f76 616c 7565 7328 7365 6c66 2c20 7661  _values(self, va
-00042330: 6c75 6573 290d 0a0d 0a20 2020 2064 6566  lues)....    def
-00042340: 2072 656e 6465 7228 7365 6c66 2c20 2a2a   render(self, **
-00042350: 6b77 6172 6773 293a 0d0a 2020 2020 2020  kwargs):..      
-00042360: 2020 5356 4745 6c65 6d65 6e74 2e72 656e    SVGElement.ren
-00042370: 6465 7228 7365 6c66 2c20 2a2a 6b77 6172  der(self, **kwar
-00042380: 6773 290d 0a20 2020 2020 2020 2054 7261  gs)..        Tra
-00042390: 6e73 666f 726d 6162 6c65 2e72 656e 6465  nsformable.rende
-000423a0: 7228 7365 6c66 2c20 2a2a 6b77 6172 6773  r(self, **kwargs
-000423b0: 290d 0a0d 0a20 2020 2064 6566 2073 656c  )....    def sel
-000423c0: 6563 7428 7365 6c66 2c20 636f 6e64 6974  ect(self, condit
-000423d0: 696f 6e61 6c3d 4e6f 6e65 293a 0d0a 2020  ional=None):..  
-000423e0: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
-000423f0: 2020 2046 696e 6473 2061 6c6c 2066 6c61     Finds all fla
-00042400: 7474 656e 6564 2073 7562 6f62 6a65 6374  ttened subobject
-00042410: 7320 6f66 2074 6869 7320 6772 6f75 7020  s of this group 
-00042420: 666f 7220 7768 6963 6820 7468 6520 636f  for which the co
-00042430: 6e64 6974 696f 6e61 6c20 7265 7475 726e  nditional return
-00042440: 730d 0a20 2020 2020 2020 2074 7275 652e  s..        true.
-00042450: 0d0a 0d0a 2020 2020 2020 2020 3a70 6172  ....        :par
-00042460: 616d 2063 6f6e 6469 7469 6f6e 616c 3a20  am conditional: 
-00042470: 6675 6e63 7469 6f6e 2074 616b 696e 6720  function taking 
-00042480: 656c 656d 656e 7420 616e 6420 7265 7475  element and retu
-00042490: 726e 7320 5472 7565 2074 6f20 696e 636c  rns True to incl
-000424a0: 7564 6520 6f72 2046 616c 7365 2069 6620  ude or False if 
-000424b0: 6578 636c 7564 650d 0a20 2020 2020 2020  exclude..       
-000424c0: 2022 2222 0d0a 2020 2020 2020 2020 6966   """..        if
-000424d0: 2063 6f6e 6469 7469 6f6e 616c 2069 7320   conditional is 
-000424e0: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
-000424f0: 2020 2066 6f72 2073 7562 6974 656d 2069     for subitem i
-00042500: 6e20 7365 6c66 3a0d 0a20 2020 2020 2020  n self:..       
-00042510: 2020 2020 2020 2020 2079 6965 6c64 2073           yield s
-00042520: 7562 6974 656d 0d0a 2020 2020 2020 2020  ubitem..        
-00042530: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-00042540: 7461 6e63 6528 7375 6269 7465 6d2c 2028  tance(subitem, (
-00042550: 4772 6f75 702c 2055 7365 2929 3a0d 0a20  Group, Use)):.. 
-00042560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042570: 2020 2066 6f72 2073 2069 6e20 7375 6269     for s in subi
-00042580: 7465 6d2e 7365 6c65 6374 2863 6f6e 6469  tem.select(condi
-00042590: 7469 6f6e 616c 293a 0d0a 2020 2020 2020  tional):..      
-000425a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000425b0: 2020 7969 656c 6420 730d 0a20 2020 2020    yield s..     
-000425c0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-000425d0: 2020 2020 2020 666f 7220 7375 6269 7465        for subite
-000425e0: 6d20 696e 2073 656c 663a 0d0a 2020 2020  m in self:..    
-000425f0: 2020 2020 2020 2020 2020 2020 6966 2063              if c
-00042600: 6f6e 6469 7469 6f6e 616c 2873 7562 6974  onditional(subit
-00042610: 656d 293a 0d0a 2020 2020 2020 2020 2020  em):..          
-00042620: 2020 2020 2020 2020 2020 7969 656c 6420            yield 
-00042630: 7375 6269 7465 6d0d 0a20 2020 2020 2020  subitem..       
-00042640: 2020 2020 2020 2020 2069 6620 6973 696e           if isin
-00042650: 7374 616e 6365 2873 7562 6974 656d 2c20  stance(subitem, 
-00042660: 2847 726f 7570 2c20 5573 6529 293a 0d0a  (Group, Use)):..
-00042670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042680: 2020 2020 666f 7220 7320 696e 2073 7562      for s in sub
-00042690: 6974 656d 2e73 656c 6563 7428 636f 6e64  item.select(cond
-000426a0: 6974 696f 6e61 6c29 3a0d 0a20 2020 2020  itional):..     
-000426b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000426c0: 2020 2079 6965 6c64 2073 0d0a 0d0a 2020     yield s....  
-000426d0: 2020 4073 7461 7469 636d 6574 686f 640d    @staticmethod.
-000426e0: 0a20 2020 2064 6566 2075 6e69 6f6e 5f62  .    def union_b
-000426f0: 626f 7828 656c 656d 656e 7473 2c20 7472  box(elements, tr
-00042700: 616e 7366 6f72 6d65 643d 5472 7565 2c20  ansformed=True, 
-00042710: 7769 7468 5f73 7472 6f6b 653d 4661 6c73  with_stroke=Fals
-00042720: 6529 3a0d 0a20 2020 2020 2020 2022 2222  e):..        """
-00042730: 0d0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
-00042740: 7320 7468 6520 756e 696f 6e20 6f66 2074  s the union of t
-00042750: 6865 2062 6f75 6e64 696e 6720 626f 7865  he bounding boxe
-00042760: 7320 666f 7220 7468 6520 656c 656d 656e  s for the elemen
-00042770: 7473 2077 6974 6869 6e20 7468 6520 6974  ts within the it
-00042780: 6572 6174 6f72 2e0d 0a0d 0a20 2020 2020  erator.....     
-00042790: 2020 203a 7061 7261 6d20 7472 616e 7366     :param transf
-000427a0: 6f72 6d65 643a 2053 686f 756c 6420 7468  ormed: Should th
-000427b0: 6520 6368 696c 6472 656e 206f 6620 7468  e children of th
-000427c0: 6973 206f 626a 6563 7420 6265 2070 726f  is object be pro
-000427d0: 7065 726c 7920 7472 616e 7366 6f72 6d65  perly transforme
-000427e0: 642e 0d0a 2020 2020 2020 2020 3a70 6172  d...        :par
-000427f0: 616d 2077 6974 685f 7374 726f 6b65 3a20  am with_stroke: 
-00042800: 7368 6f75 6c64 2074 6865 2073 7472 6f6b  should the strok
-00042810: 652d 7769 6474 6820 6265 2069 6e63 6c75  e-width be inclu
-00042820: 6465 6420 696e 2074 6865 2062 6f75 6e64  ded in the bound
-00042830: 7320 6f66 2074 6865 2065 6c65 6d65 6e74  s of the element
-00042840: 730d 0a20 2020 2020 2020 203a 7265 7475  s..        :retu
-00042850: 726e 3a20 756e 696f 6e20 6f66 2061 6c6c  rn: union of all
-00042860: 2062 6f75 6e64 696e 6720 626f 7865 7320   bounding boxes 
-00042870: 6f66 2065 6c65 6d65 6e74 7320 7769 7468  of elements with
-00042880: 696e 2074 6865 2069 7465 7261 626c 652e  in the iterable.
-00042890: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
-000428a0: 2020 2020 2020 2062 6f78 6573 203d 205b         boxes = [
-000428b0: 5d0d 0a20 2020 2020 2020 2066 6f72 2065  ]..        for e
-000428c0: 2069 6e20 656c 656d 656e 7473 3a0d 0a20   in elements:.. 
-000428d0: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-000428e0: 7420 6861 7361 7474 7228 652c 2022 6262  t hasattr(e, "bb
-000428f0: 6f78 2229 206f 7220 6973 696e 7374 616e  ox") or isinstan
-00042900: 6365 2865 2c20 2847 726f 7570 2c20 5573  ce(e, (Group, Us
-00042910: 6529 293a 0d0a 2020 2020 2020 2020 2020  e)):..          
-00042920: 2020 2020 2020 636f 6e74 696e 7565 0d0a        continue..
-00042930: 2020 2020 2020 2020 2020 2020 626f 7820              box 
-00042940: 3d20 652e 6262 6f78 2874 7261 6e73 666f  = e.bbox(transfo
-00042950: 726d 6564 3d74 7261 6e73 666f 726d 6564  rmed=transformed
-00042960: 2c20 7769 7468 5f73 7472 6f6b 653d 7769  , with_stroke=wi
-00042970: 7468 5f73 7472 6f6b 6529 0d0a 2020 2020  th_stroke)..    
-00042980: 2020 2020 2020 2020 6966 2062 6f78 2069          if box i
-00042990: 7320 4e6f 6e65 3a0d 0a20 2020 2020 2020  s None:..       
-000429a0: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
-000429b0: 650d 0a20 2020 2020 2020 2020 2020 2062  e..            b
-000429c0: 6f78 6573 2e61 7070 656e 6428 626f 7829  oxes.append(box)
-000429d0: 0d0a 2020 2020 2020 2020 6966 206c 656e  ..        if len
-000429e0: 2862 6f78 6573 2920 3d3d 2030 3a0d 0a20  (boxes) == 0:.. 
-000429f0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00042a00: 6e20 4e6f 6e65 0d0a 2020 2020 2020 2020  n None..        
-00042a10: 2878 6d69 6e73 2c20 796d 696e 732c 2078  (xmins, ymins, x
-00042a20: 6d61 7873 2c20 796d 6178 7329 203d 207a  maxs, ymaxs) = z
-00042a30: 6970 282a 626f 7865 7329 0d0a 2020 2020  ip(*boxes)..    
-00042a40: 2020 2020 7265 7475 726e 2028 6d69 6e28      return (min(
-00042a50: 786d 696e 7329 2c20 6d69 6e28 796d 696e  xmins), min(ymin
-00042a60: 7329 2c20 6d61 7828 786d 6178 7329 2c20  s), max(xmaxs), 
-00042a70: 6d61 7828 796d 6178 7329 290d 0a0d 0a20  max(ymaxs)).... 
-00042a80: 2020 2064 6566 2062 626f 7828 7365 6c66     def bbox(self
-00042a90: 2c20 7472 616e 7366 6f72 6d65 643d 5472  , transformed=Tr
-00042aa0: 7565 2c20 7769 7468 5f73 7472 6f6b 653d  ue, with_stroke=
-00042ab0: 4661 6c73 6529 3a0d 0a20 2020 2020 2020  False):..       
-00042ac0: 2022 2222 0d0a 2020 2020 2020 2020 5265   """..        Re
-00042ad0: 7475 726e 7320 7468 6520 626f 756e 6469  turns the boundi
-00042ae0: 6e67 2062 6f78 206f 6620 7468 6520 6769  ng box of the gi
-00042af0: 7665 6e20 6f62 6a65 6374 2e0d 0a0d 0a20  ven object..... 
-00042b00: 2020 2020 2020 2049 6e20 7468 6520 6361         In the ca
-00042b10: 7365 206f 6620 6772 6f75 7073 2074 6869  se of groups thi
-00042b20: 7320 6973 2074 6865 2075 6e69 6f6e 206f  s is the union o
-00042b30: 6620 616c 6c20 7468 6520 626f 756e 6469  f all the boundi
-00042b40: 6e67 2062 6f78 6573 206f 6620 616c 6c20  ng boxes of all 
-00042b50: 626f 756e 6420 6368 696c 6472 656e 2e0d  bound children..
-00042b60: 0a0d 0a20 2020 2020 2020 2053 6574 7469  ...        Setti
-00042b70: 6e67 2074 7261 6e73 666f 726d 6564 2074  ng transformed t
-00042b80: 6f20 6661 6c73 652c 206d 6179 2079 6965  o false, may yie
-00042b90: 6c64 2075 6e65 7870 6563 7465 6420 7265  ld unexpected re
-00042ba0: 7375 6c74 7320 6966 2073 7562 6974 656d  sults if subitem
-00042bb0: 7320 6172 6520 7472 616e 7366 6f72 6d65  s are transforme
-00042bc0: 6420 696e 206e 6f6e 2d75 6e69 666f 726d  d in non-uniform
-00042bd0: 0d0a 2020 2020 2020 2020 7761 7973 2e0d  ..        ways..
-00042be0: 0a0d 0a20 2020 2020 2020 203a 7061 7261  ...        :para
-00042bf0: 6d20 7472 616e 7366 6f72 6d65 643a 2062  m transformed: b
-00042c00: 6f75 6e64 696e 6720 626f 7820 6f66 2074  ounding box of t
-00042c10: 6865 2070 726f 7065 726c 7920 7472 616e  he properly tran
-00042c20: 7366 6f72 6d65 6420 6368 696c 6472 656e  sformed children
-00042c30: 2e0d 0a20 2020 2020 2020 203a 7061 7261  ...        :para
-00042c40: 6d20 7769 7468 5f73 7472 6f6b 653a 2073  m with_stroke: s
-00042c50: 686f 756c 6420 7468 6520 7374 726f 6b65  hould the stroke
-00042c60: 2d77 6964 7468 2062 6520 696e 636c 7564  -width be includ
-00042c70: 6564 2069 6e20 7468 6520 626f 756e 6473  ed in the bounds
-00042c80: 2e0d 0a20 2020 2020 2020 203a 7265 7475  ...        :retu
-00042c90: 726e 3a20 626f 756e 6469 6e67 2062 6f78  rn: bounding box
-00042ca0: 206f 6620 7468 6520 6769 7665 6e20 656c   of the given el
-00042cb0: 656d 656e 740d 0a20 2020 2020 2020 2022  ement..        "
-00042cc0: 2222 0d0a 2020 2020 2020 2020 7265 7475  ""..        retu
-00042cd0: 726e 2055 7365 2e75 6e69 6f6e 5f62 626f  rn Use.union_bbo
-00042ce0: 7828 0d0a 2020 2020 2020 2020 2020 2020  x(..            
-00042cf0: 7365 6c66 2e73 656c 6563 7428 292c 0d0a  self.select(),..
-00042d00: 2020 2020 2020 2020 2020 2020 7472 616e              tran
-00042d10: 7366 6f72 6d65 643d 7472 616e 7366 6f72  sformed=transfor
-00042d20: 6d65 642c 0d0a 2020 2020 2020 2020 2020  med,..          
-00042d30: 2020 7769 7468 5f73 7472 6f6b 653d 7769    with_stroke=wi
-00042d40: 7468 5f73 7472 6f6b 652c 0d0a 2020 2020  th_stroke,..    
-00042d50: 2020 2020 290d 0a0d 0a0d 0a63 6c61 7373      )......class
-00042d60: 2043 6c69 7050 6174 6828 5356 4745 6c65   ClipPath(SVGEle
-00042d70: 6d65 6e74 2c20 6c69 7374 293a 0d0a 2020  ment, list):..  
-00042d80: 2020 2222 220d 0a20 2020 2063 6c69 7050    """..    clipP
-00042d90: 6174 6820 656c 656d 656e 7473 2061 7265  ath elements are
-00042da0: 2064 6566 696e 6564 2069 6e20 7376 6720   defined in svg 
-00042db0: 3134 2e33 2e35 0d0a 2020 2020 6874 7470  14.3.5..    http
-00042dc0: 733a 2f2f 7777 772e 7733 2e6f 7267 2f54  s://www.w3.org/T
-00042dd0: 522f 5356 4731 312f 6d61 736b 696e 672e  R/SVG11/masking.
-00042de0: 6874 6d6c 2343 6c69 7050 6174 6845 6c65  html#ClipPathEle
-00042df0: 6d65 6e74 0d0a 0d0a 2020 2020 436c 6970  ment....    Clip
-00042e00: 2070 6174 6873 2063 6f6e 6365 7074 7561   paths conceptua
-00042e10: 6c6c 7920 6465 6669 6e65 2061 2031 2062  lly define a 1 b
-00042e20: 6974 206d 6173 6b20 666f 7220 696d 6167  it mask for imag
-00042e30: 6573 2074 6865 7365 2061 7265 2075 7375  es these are usu
-00042e40: 616c 6c79 2064 6566 696e 6564 2077 6974  ally defined wit
-00042e50: 6869 6e0d 0a20 2020 2064 6566 2062 6c6f  hin..    def blo
-00042e60: 636b 7320 616e 6420 646f 206e 6f74 2072  cks and do not r
-00042e70: 656e 6465 7220 7468 656d 7365 6c76 6573  ender themselves
-00042e80: 2062 7574 2072 6174 6865 7220 6172 6520   but rather are 
-00042e90: 6174 7461 6368 6564 2062 7920 4952 4920  attached by IRI 
-00042ea0: 7265 6665 7265 6e63 6573 2074 6f20 7468  references to th
-00042eb0: 650d 0a20 2020 2022 2222 0d0a 0d0a 2020  e..    """....  
-00042ec0: 2020 6465 6620 5f5f 696e 6974 5f5f 2873    def __init__(s
-00042ed0: 656c 662c 202a 6172 6773 2c20 2a2a 6b77  elf, *args, **kw
-00042ee0: 6172 6773 293a 0d0a 2020 2020 2020 2020  args):..        
-00042ef0: 6c69 7374 2e5f 5f69 6e69 745f 5f28 7365  list.__init__(se
-00042f00: 6c66 290d 0a20 2020 2020 2020 2073 656c  lf)..        sel
-00042f10: 662e 756e 6974 5f74 7970 6520 3d20 5356  f.unit_type = SV
-00042f20: 475f 554e 4954 5f54 5950 455f 5553 4552  G_UNIT_TYPE_USER
-00042f30: 5350 4143 454f 4e55 5345 0d0a 2020 2020  SPACEONUSE..    
-00042f40: 2020 2020 5356 4745 6c65 6d65 6e74 2e5f      SVGElement._
-00042f50: 5f69 6e69 745f 5f28 7365 6c66 2c20 2a61  _init__(self, *a
-00042f60: 7267 732c 202a 2a6b 7761 7267 7329 0d0a  rgs, **kwargs)..
-00042f70: 0d0a 2020 2020 6465 6620 7072 6f70 6572  ..    def proper
-00042f80: 7479 5f62 795f 6f62 6a65 6374 2873 656c  ty_by_object(sel
-00042f90: 662c 2073 293a 0d0a 2020 2020 2020 2020  f, s):..        
-00042fa0: 5356 4745 6c65 6d65 6e74 2e70 726f 7065  SVGElement.prope
-00042fb0: 7274 795f 6279 5f6f 626a 6563 7428 7365  rty_by_object(se
-00042fc0: 6c66 2c20 7329 0d0a 2020 2020 2020 2020  lf, s)..        
-00042fd0: 7365 6c66 2e75 6e69 745f 7479 7065 203d  self.unit_type =
-00042fe0: 2073 2e75 6e69 745f 7479 7065 0d0a 0d0a   s.unit_type....
-00042ff0: 2020 2020 6465 6620 7072 6f70 6572 7479      def property
-00043000: 5f62 795f 7661 6c75 6573 2873 656c 662c  _by_values(self,
-00043010: 2076 616c 7565 7329 3a0d 0a20 2020 2020   values):..     
-00043020: 2020 2053 5647 456c 656d 656e 742e 7072     SVGElement.pr
-00043030: 6f70 6572 7479 5f62 795f 7661 6c75 6573  operty_by_values
-00043040: 2873 656c 662c 2076 616c 7565 7329 0d0a  (self, values)..
-00043050: 2020 2020 2020 2020 7365 6c66 2e75 6e69          self.uni
-00043060: 745f 7479 7065 203d 2073 656c 662e 7661  t_type = self.va
-00043070: 6c75 6573 2e67 6574 280d 0a20 2020 2020  lues.get(..     
-00043080: 2020 2020 2020 2053 5647 5f41 5454 525f         SVG_ATTR_
-00043090: 434c 4950 5f55 4e49 545f 5459 5045 2c20  CLIP_UNIT_TYPE, 
-000430a0: 5356 475f 554e 4954 5f54 5950 455f 5553  SVG_UNIT_TYPE_US
-000430b0: 4552 5350 4143 454f 4e55 5345 0d0a 2020  ERSPACEONUSE..  
-000430c0: 2020 2020 2020 290d 0a0d 0a0d 0a63 6c61        )......cla
-000430d0: 7373 2050 6174 7465 726e 2853 5647 456c  ss Pattern(SVGEl
-000430e0: 656d 656e 742c 206c 6973 7429 3a0d 0a20  ement, list):.. 
-000430f0: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
-00043100: 7365 6c66 2c20 2a61 7267 732c 202a 2a6b  self, *args, **k
-00043110: 7761 7267 7329 3a0d 0a20 2020 2020 2020  wargs):..       
-00043120: 2073 656c 662e 7669 6577 626f 7820 3d20   self.viewbox = 
-00043130: 4e6f 6e65 0d0a 2020 2020 2020 2020 7365  None..        se
-00043140: 6c66 2e70 7265 7365 7276 655f 6173 7065  lf.preserve_aspe
-00043150: 6374 5f72 6174 696f 203d 204e 6f6e 650d  ct_ratio = None.
-00043160: 0a20 2020 2020 2020 2073 656c 662e 7820  .        self.x 
-00043170: 3d20 4e6f 6e65 0d0a 2020 2020 2020 2020  = None..        
-00043180: 7365 6c66 2e79 203d 204e 6f6e 650d 0a20  self.y = None.. 
-00043190: 2020 2020 2020 2073 656c 662e 7769 6474         self.widt
-000431a0: 6820 3d20 4e6f 6e65 0d0a 2020 2020 2020  h = None..      
-000431b0: 2020 7365 6c66 2e68 6569 6768 7420 3d20    self.height = 
-000431c0: 4e6f 6e65 0d0a 2020 2020 2020 2020 7365  None..        se
-000431d0: 6c66 2e68 7265 6620 3d20 4e6f 6e65 0d0a  lf.href = None..
-000431e0: 2020 2020 2020 2020 7365 6c66 2e70 6174          self.pat
-000431f0: 7465 726e 5f63 6f6e 7465 6e74 5f75 6e69  tern_content_uni
-00043200: 7473 203d 204e 6f6e 6520 2023 2055 7365  ts = None  # Use
-00043210: 7253 7061 6365 4f6e 5573 6520 6465 6661  rSpaceOnUse defa
-00043220: 756c 740d 0a20 2020 2020 2020 2073 656c  ult..        sel
-00043230: 662e 7061 7474 6572 6e5f 7472 616e 7366  f.pattern_transf
-00043240: 6f72 6d20 3d20 4e6f 6e65 0d0a 2020 2020  orm = None..    
-00043250: 2020 2020 7365 6c66 2e70 6174 7465 726e      self.pattern
-00043260: 5f75 6e69 7473 203d 204e 6f6e 650d 0a20  _units = None.. 
-00043270: 2020 2020 2020 2053 5647 456c 656d 656e         SVGElemen
-00043280: 742e 5f5f 696e 6974 5f5f 2873 656c 662c  t.__init__(self,
-00043290: 202a 6172 6773 2c20 2a2a 6b77 6172 6773   *args, **kwargs
-000432a0: 290d 0a0d 0a20 2020 2064 6566 205f 5f69  )....    def __i
-000432b0: 6e74 5f5f 2873 656c 6629 3a0d 0a20 2020  nt__(self):..   
-000432c0: 2020 2020 2072 6574 7572 6e20 300d 0a0d       return 0...
-000432d0: 0a20 2020 2040 7072 6f70 6572 7479 0d0a  .    @property..
-000432e0: 2020 2020 6465 6620 7669 6577 626f 785f      def viewbox_
-000432f0: 7472 616e 7366 6f72 6d28 7365 6c66 293a  transform(self):
-00043300: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
-00043310: 662e 7669 6577 626f 7820 6973 204e 6f6e  f.viewbox is Non
-00043320: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00043330: 7265 7475 726e 2022 220d 0a20 2020 2020  return ""..     
-00043340: 2020 2072 6574 7572 6e20 7365 6c66 2e76     return self.v
-00043350: 6965 7762 6f78 2e74 7261 6e73 666f 726d  iewbox.transform
-00043360: 2873 656c 6629 0d0a 0d0a 2020 2020 6465  (self)....    de
-00043370: 6620 7072 6f70 6572 7479 5f62 795f 6f62  f property_by_ob
-00043380: 6a65 6374 2873 656c 662c 2073 293a 0d0a  ject(self, s):..
-00043390: 2020 2020 2020 2020 5356 4745 6c65 6d65          SVGEleme
-000433a0: 6e74 2e70 726f 7065 7274 795f 6279 5f6f  nt.property_by_o
-000433b0: 626a 6563 7428 7365 6c66 2c20 7329 0d0a  bject(self, s)..
-000433c0: 2020 2020 2020 2020 7365 6c66 2e76 6965          self.vie
-000433d0: 7762 6f78 203d 2073 2e76 6965 7762 6f78  wbox = s.viewbox
-000433e0: 0d0a 2020 2020 2020 2020 7365 6c66 2e70  ..        self.p
-000433f0: 7265 7365 7276 655f 6173 7065 6374 5f72  reserve_aspect_r
-00043400: 6174 696f 203d 2073 2e70 7265 7365 7276  atio = s.preserv
-00043410: 655f 6173 7065 6374 5f72 6174 696f 0d0a  e_aspect_ratio..
-00043420: 0d0a 2020 2020 2020 2020 7365 6c66 2e78  ..        self.x
-00043430: 203d 2073 2e78 0d0a 2020 2020 2020 2020   = s.x..        
-00043440: 7365 6c66 2e79 203d 2073 2e79 0d0a 2020  self.y = s.y..  
-00043450: 2020 2020 2020 7365 6c66 2e77 6964 7468        self.width
-00043460: 203d 2073 2e77 6964 7468 0d0a 2020 2020   = s.width..    
-00043470: 2020 2020 7365 6c66 2e68 6569 6768 7420      self.height 
-00043480: 3d20 732e 6865 6967 6874 0d0a 2020 2020  = s.height..    
-00043490: 2020 2020 7365 6c66 2e68 7265 6620 3d20      self.href = 
-000434a0: 732e 6872 6566 0d0a 2020 2020 2020 2020  s.href..        
-000434b0: 7365 6c66 2e70 6174 7465 726e 5f63 6f6e  self.pattern_con
-000434c0: 7465 6e74 5f75 6e69 7473 203d 2073 2e70  tent_units = s.p
-000434d0: 6174 7465 726e 5f63 6f6e 7465 6e74 735f  attern_contents_
-000434e0: 756e 6974 730d 0a20 2020 2020 2020 2073  units..        s
-000434f0: 656c 662e 7061 7474 6572 6e5f 7472 616e  elf.pattern_tran
-00043500: 7366 6f72 6d20 3d20 280d 0a20 2020 2020  sform = (..     
-00043510: 2020 2020 2020 204d 6174 7269 7828 732e         Matrix(s.
-00043520: 7061 7474 6572 6e5f 7472 616e 7366 6f72  pattern_transfor
-00043530: 6d29 2069 6620 732e 7061 7474 6572 6e5f  m) if s.pattern_
-00043540: 7472 616e 7366 6f72 6d20 6973 206e 6f74  transform is not
-00043550: 204e 6f6e 6520 656c 7365 204e 6f6e 650d   None else None.
-00043560: 0a20 2020 2020 2020 2029 0d0a 2020 2020  .        )..    
-00043570: 2020 2020 7365 6c66 2e70 6174 7465 726e      self.pattern
-00043580: 5f75 6e69 7473 203d 2073 2e70 6174 7465  _units = s.patte
-00043590: 726e 5f75 6e69 7473 0d0a 0d0a 2020 2020  rn_units....    
-000435a0: 6465 6620 7072 6f70 6572 7479 5f62 795f  def property_by_
-000435b0: 7661 6c75 6573 2873 656c 662c 2076 616c  values(self, val
-000435c0: 7565 7329 3a0d 0a20 2020 2020 2020 2053  ues):..        S
-000435d0: 5647 456c 656d 656e 742e 7072 6f70 6572  VGElement.proper
-000435e0: 7479 5f62 795f 7661 6c75 6573 2873 656c  ty_by_values(sel
-000435f0: 662c 2076 616c 7565 7329 0d0a 2020 2020  f, values)..    
-00043600: 2020 2020 6966 2058 4c49 4e4b 5f48 5245      if XLINK_HRE
-00043610: 4620 696e 2076 616c 7565 733a 0d0a 2020  F in values:..  
-00043620: 2020 2020 2020 2020 2020 7365 6c66 2e68            self.h
-00043630: 7265 6620 3d20 7661 6c75 6573 5b58 4c49  ref = values[XLI
-00043640: 4e4b 5f48 5245 465d 0d0a 2020 2020 2020  NK_HREF]..      
-00043650: 2020 656c 6966 2053 5647 5f48 5245 4620    elif SVG_HREF 
-00043660: 696e 2076 616c 7565 733a 0d0a 2020 2020  in values:..    
-00043670: 2020 2020 2020 2020 7365 6c66 2e68 7265          self.hre
-00043680: 6620 3d20 7661 6c75 6573 5b53 5647 5f48  f = values[SVG_H
-00043690: 5245 465d 0d0a 2020 2020 2020 2020 7669  REF]..        vi
-000436a0: 6577 626f 7820 3d20 7661 6c75 6573 2e67  ewbox = values.g
-000436b0: 6574 2853 5647 5f41 5454 525f 5649 4557  et(SVG_ATTR_VIEW
-000436c0: 424f 5829 0d0a 2020 2020 2020 2020 6966  BOX)..        if
-000436d0: 2076 6965 7762 6f78 2069 7320 6e6f 7420   viewbox is not 
-000436e0: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
-000436f0: 2020 2073 656c 662e 7669 6577 626f 7820     self.viewbox 
-00043700: 3d20 5669 6577 626f 7828 7669 6577 626f  = Viewbox(viewbo
-00043710: 7829 0d0a 2020 2020 2020 2020 6966 2053  x)..        if S
-00043720: 5647 5f41 5454 525f 5052 4553 4552 5645  VG_ATTR_PRESERVE
-00043730: 4153 5045 4354 5241 5449 4f20 696e 2076  ASPECTRATIO in v
-00043740: 616c 7565 733a 0d0a 2020 2020 2020 2020  alues:..        
-00043750: 2020 2020 7365 6c66 2e70 7265 7365 7276      self.preserv
-00043760: 655f 6173 7065 6374 5f72 6174 696f 203d  e_aspect_ratio =
-00043770: 2076 616c 7565 735b 5356 475f 4154 5452   values[SVG_ATTR
-00043780: 5f50 5245 5345 5256 4541 5350 4543 5452  _PRESERVEASPECTR
-00043790: 4154 494f 5d0d 0a20 2020 2020 2020 2073  ATIO]..        s
-000437a0: 656c 662e 7820 3d20 4c65 6e67 7468 2876  elf.x = Length(v
-000437b0: 616c 7565 732e 6765 7428 5356 475f 4154  alues.get(SVG_AT
-000437c0: 5452 5f58 2c20 3029 292e 7661 6c75 6528  TR_X, 0)).value(
-000437d0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-000437e0: 7920 3d20 4c65 6e67 7468 2876 616c 7565  y = Length(value
-000437f0: 732e 6765 7428 5356 475f 4154 5452 5f59  s.get(SVG_ATTR_Y
-00043800: 2c20 3029 292e 7661 6c75 6528 290d 0a20  , 0)).value().. 
-00043810: 2020 2020 2020 2073 656c 662e 7769 6474         self.widt
-00043820: 6820 3d20 4c65 6e67 7468 2876 616c 7565  h = Length(value
-00043830: 732e 6765 7428 5356 475f 4154 5452 5f57  s.get(SVG_ATTR_W
-00043840: 4944 5448 2c20 2231 3030 2522 2929 2e76  IDTH, "100%")).v
-00043850: 616c 7565 2829 0d0a 2020 2020 2020 2020  alue()..        
-00043860: 7365 6c66 2e68 6569 6768 7420 3d20 4c65  self.height = Le
-00043870: 6e67 7468 2876 616c 7565 732e 6765 7428  ngth(values.get(
-00043880: 5356 475f 4154 5452 5f48 4549 4748 542c  SVG_ATTR_HEIGHT,
-00043890: 2022 3130 3025 2229 292e 7661 6c75 6528   "100%")).value(
-000438a0: 290d 0a20 2020 2020 2020 2069 6620 5356  )..        if SV
-000438b0: 475f 4154 5452 5f50 4154 5445 524e 5f43  G_ATTR_PATTERN_C
-000438c0: 4f4e 5445 4e54 5f55 4e49 5453 2069 6e20  ONTENT_UNITS in 
-000438d0: 7661 6c75 6573 3a0d 0a20 2020 2020 2020  values:..       
-000438e0: 2020 2020 2073 656c 662e 7061 7474 6572       self.patter
-000438f0: 6e5f 636f 6e74 656e 745f 756e 6974 7320  n_content_units 
-00043900: 3d20 7661 6c75 6573 5b53 5647 5f41 5454  = values[SVG_ATT
-00043910: 525f 5041 5454 4552 4e5f 434f 4e54 454e  R_PATTERN_CONTEN
-00043920: 545f 554e 4954 535d 0d0a 2020 2020 2020  T_UNITS]..      
-00043930: 2020 6966 2053 5647 5f41 5454 525f 5041    if SVG_ATTR_PA
-00043940: 5454 4552 4e5f 5452 414e 5346 4f52 4d20  TTERN_TRANSFORM 
-00043950: 696e 2076 616c 7565 733a 0d0a 2020 2020  in values:..    
-00043960: 2020 2020 2020 2020 7365 6c66 2e70 6174          self.pat
-00043970: 7465 726e 5f74 7261 6e73 666f 726d 203d  tern_transform =
-00043980: 204d 6174 7269 7828 7661 6c75 6573 5b53   Matrix(values[S
-00043990: 5647 5f41 5454 525f 5041 5454 4552 4e5f  VG_ATTR_PATTERN_
-000439a0: 5452 414e 5346 4f52 4d5d 290d 0a20 2020  TRANSFORM])..   
-000439b0: 2020 2020 2069 6620 5356 475f 4154 5452       if SVG_ATTR
-000439c0: 5f50 4154 5445 524e 5f55 4e49 5453 2069  _PATTERN_UNITS i
-000439d0: 6e20 7661 6c75 6573 3a0d 0a20 2020 2020  n values:..     
-000439e0: 2020 2020 2020 2073 656c 662e 7061 7474         self.patt
-000439f0: 6572 6e5f 756e 6974 7320 3d20 7661 6c75  ern_units = valu
-00043a00: 6573 5b53 5647 5f41 5454 525f 5041 5454  es[SVG_ATTR_PATT
-00043a10: 4552 4e5f 554e 4954 535d 0d0a 0d0a 2020  ERN_UNITS]....  
-00043a20: 2020 6465 6620 7265 6e64 6572 2873 656c    def render(sel
-00043a30: 662c 202a 2a6b 7761 7267 7329 3a0d 0a20  f, **kwargs):.. 
-00043a40: 2020 2020 2020 2069 6620 7365 6c66 2e70         if self.p
-00043a50: 6174 7465 726e 5f74 7261 6e73 666f 726d  attern_transform
-00043a60: 2069 7320 6e6f 7420 4e6f 6e65 3a0d 0a20   is not None:.. 
-00043a70: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00043a80: 7061 7474 6572 6e5f 7472 616e 7366 6f72  pattern_transfor
-00043a90: 6d2e 7265 6e64 6572 282a 2a6b 7761 7267  m.render(**kwarg
-00043aa0: 7329 0d0a 2020 2020 2020 2020 7769 6474  s)..        widt
-00043ab0: 6820 3d20 6b77 6172 6773 2e67 6574 2822  h = kwargs.get("
-00043ac0: 7769 6474 6822 2c20 6b77 6172 6773 2e67  width", kwargs.g
-00043ad0: 6574 2822 7265 6c61 7469 7665 5f6c 656e  et("relative_len
-00043ae0: 6774 6822 2929 0d0a 2020 2020 2020 2020  gth"))..        
-00043af0: 6865 6967 6874 203d 206b 7761 7267 732e  height = kwargs.
-00043b00: 6765 7428 2268 6569 6768 7422 2c20 6b77  get("height", kw
-00043b10: 6172 6773 2e67 6574 2822 7265 6c61 7469  args.get("relati
-00043b20: 7665 5f6c 656e 6774 6822 2929 0d0a 2020  ve_length"))..  
-00043b30: 2020 2020 2020 7472 793a 0d0a 2020 2020        try:..    
-00043b40: 2020 2020 2020 2020 6465 6c20 6b77 6172          del kwar
-00043b50: 6773 5b22 7265 6c61 7469 7665 5f6c 656e  gs["relative_len
-00043b60: 6774 6822 5d0d 0a20 2020 2020 2020 2065  gth"]..        e
-00043b70: 7863 6570 7420 4b65 7945 7272 6f72 3a0d  xcept KeyError:.
-00043b80: 0a20 2020 2020 2020 2020 2020 2070 6173  .            pas
-00043b90: 730d 0a20 2020 2020 2020 2069 6620 6973  s..        if is
-00043ba0: 696e 7374 616e 6365 2873 656c 662e 782c  instance(self.x,
-00043bb0: 204c 656e 6774 6829 3a0d 0a20 2020 2020   Length):..     
-00043bc0: 2020 2020 2020 2073 656c 662e 7820 3d20         self.x = 
-00043bd0: 7365 6c66 2e78 2e76 616c 7565 2872 656c  self.x.value(rel
-00043be0: 6174 6976 655f 6c65 6e67 7468 3d77 6964  ative_length=wid
-00043bf0: 7468 2c20 2a2a 6b77 6172 6773 290d 0a20  th, **kwargs).. 
-00043c00: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-00043c10: 616e 6365 2873 656c 662e 792c 204c 656e  ance(self.y, Len
-00043c20: 6774 6829 3a0d 0a20 2020 2020 2020 2020  gth):..         
-00043c30: 2020 2073 656c 662e 7920 3d20 7365 6c66     self.y = self
-00043c40: 2e79 2e76 616c 7565 2872 656c 6174 6976  .y.value(relativ
-00043c50: 655f 6c65 6e67 7468 3d68 6569 6768 742c  e_length=height,
-00043c60: 202a 2a6b 7761 7267 7329 0d0a 2020 2020   **kwargs)..    
-00043c70: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-00043c80: 6528 7365 6c66 2e77 6964 7468 2c20 4c65  e(self.width, Le
-00043c90: 6e67 7468 293a 0d0a 2020 2020 2020 2020  ngth):..        
-00043ca0: 2020 2020 7365 6c66 2e77 6964 7468 203d      self.width =
-00043cb0: 2073 656c 662e 7769 6474 682e 7661 6c75   self.width.valu
-00043cc0: 6528 7265 6c61 7469 7665 5f6c 656e 6774  e(relative_lengt
-00043cd0: 683d 7769 6474 682c 202a 2a6b 7761 7267  h=width, **kwarg
-00043ce0: 7329 0d0a 2020 2020 2020 2020 6966 2069  s)..        if i
-00043cf0: 7369 6e73 7461 6e63 6528 7365 6c66 2e68  sinstance(self.h
-00043d00: 6569 6768 742c 204c 656e 6774 6829 3a0d  eight, Length):.
-00043d10: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00043d20: 662e 6865 6967 6874 203d 2073 656c 662e  f.height = self.
-00043d30: 6865 6967 6874 2e76 616c 7565 2872 656c  height.value(rel
-00043d40: 6174 6976 655f 6c65 6e67 7468 3d68 6569  ative_length=hei
-00043d50: 6768 742c 202a 2a6b 7761 7267 7329 0d0a  ght, **kwargs)..
-00043d60: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00043d70: 656c 660d 0a0d 0a0d 0a63 6c61 7373 2054  elf......class T
-00043d80: 6578 7428 5356 4745 6c65 6d65 6e74 2c20  ext(SVGElement, 
-00043d90: 4772 6170 6869 634f 626a 6563 742c 2054  GraphicObject, T
-00043da0: 7261 6e73 666f 726d 6162 6c65 293a 0d0a  ransformable):..
-00043db0: 2020 2020 2222 220d 0a20 2020 2053 5647      """..    SVG
-00043dc0: 2054 6578 7420 6172 6520 6465 6669 6e65   Text are define
-00043dd0: 6420 696e 2053 5647 2032 2e30 2043 6861  d in SVG 2.0 Cha
-00043de0: 7074 6572 2031 310d 0a0d 0a20 2020 204e  pter 11....    N
-00043df0: 6f20 6d65 7468 6f64 7320 6172 6520 696d  o methods are im
-00043e00: 706c 656d 656e 7465 6420 746f 2070 6572  plemented to per
-00043e10: 666f 726d 2061 2074 6578 7420 746f 2070  form a text to p
-00043e20: 6174 6820 636f 6e76 6572 7369 6f6e 2e0d  ath conversion..
-00043e30: 0a0d 0a20 2020 2048 6f77 6576 6572 2c20  ...    However, 
-00043e40: 6966 2073 7563 6820 6120 6d65 7468 6f64  if such a method
-00043e50: 2065 7869 7374 7320 7468 6520 6173 7375   exists the assu
-00043e60: 6d70 7469 6f6e 2069 7320 7468 6174 2074  mption is that t
-00043e70: 6865 2072 6573 756c 7473 2077 696c 6c20  he results will 
-00043e80: 6265 0d0a 2020 2020 706c 6163 6564 2069  be..    placed i
-00043e90: 6e20 7468 6520 2e70 6174 6820 6174 7472  n the .path attr
-00043ea0: 6962 7574 652c 2061 6e64 2066 756e 6374  ibute, and funct
-00043eb0: 696f 6e73 206c 696b 6520 6262 6f78 2829  ions like bbox()
-00043ec0: 2077 696c 6c20 6368 6563 6b20 6966 2073   will check if s
-00043ed0: 7563 680d 0a20 2020 2061 2076 616c 7565  uch..    a value
-00043ee0: 2065 7869 7374 732e 0d0a 2020 2020 2222   exists...    ""
-00043ef0: 220d 0a0d 0a20 2020 2064 6566 205f 5f69  "....    def __i
-00043f00: 6e69 745f 5f28 7365 6c66 2c20 2a61 7267  nit__(self, *arg
-00043f10: 732c 202a 2a6b 7761 7267 7329 3a0d 0a20  s, **kwargs):.. 
-00043f20: 2020 2020 2020 2069 6620 6c65 6e28 6172         if len(ar
-00043f30: 6773 2920 3e3d 2031 3a0d 0a20 2020 2020  gs) >= 1:..     
-00043f40: 2020 2020 2020 2073 656c 662e 7465 7874         self.text
-00043f50: 203d 2061 7267 735b 305d 0d0a 2020 2020   = args[0]..    
-00043f60: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-00043f70: 2020 2020 2020 2073 656c 662e 7465 7874         self.text
-00043f80: 203d 2022 220d 0a20 2020 2020 2020 2073   = ""..        s
-00043f90: 656c 662e 7769 6474 6820 3d20 300d 0a20  elf.width = 0.. 
-00043fa0: 2020 2020 2020 2073 656c 662e 6865 6967         self.heig
-00043fb0: 6874 203d 2030 0d0a 2020 2020 2020 2020  ht = 0..        
-00043fc0: 7365 6c66 2e78 203d 2030 0d0a 2020 2020  self.x = 0..    
-00043fd0: 2020 2020 7365 6c66 2e79 203d 2030 0d0a      self.y = 0..
-00043fe0: 2020 2020 2020 2020 7365 6c66 2e64 7820          self.dx 
-00043ff0: 3d20 300d 0a20 2020 2020 2020 2073 656c  = 0..        sel
-00044000: 662e 6479 203d 2030 0d0a 2020 2020 2020  f.dy = 0..      
-00044010: 2020 7365 6c66 2e61 6e63 686f 7220 3d20    self.anchor = 
-00044020: 2273 7461 7274 2220 2023 2073 7461 7274  "start"  # start
-00044030: 2c20 6d69 6464 6c65 2c20 656e 642e 0d0a  , middle, end...
-00044040: 2020 2020 2020 2020 7365 6c66 2e66 6f6e          self.fon
-00044050: 745f 7374 796c 6520 3d20 226e 6f72 6d61  t_style = "norma
-00044060: 6c22 0d0a 2020 2020 2020 2020 7365 6c66  l"..        self
-00044070: 2e66 6f6e 745f 7661 7269 616e 7420 3d20  .font_variant = 
-00044080: 226e 6f72 6d61 6c22 0d0a 2020 2020 2020  "normal"..      
-00044090: 2020 7365 6c66 2e66 6f6e 745f 7765 6967    self.font_weig
-000440a0: 6874 203d 2034 3030 0d0a 2020 2020 2020  ht = 400..      
-000440b0: 2020 7365 6c66 2e66 6f6e 745f 7374 7265    self.font_stre
-000440c0: 7463 6820 3d20 226e 6f72 6d61 6c22 0d0a  tch = "normal"..
-000440d0: 2020 2020 2020 2020 7365 6c66 2e66 6f6e          self.fon
-000440e0: 745f 7369 7a65 203d 2031 362e 3020 2023  t_size = 16.0  #
-000440f0: 2031 3670 7820 666f 6e74 2027 6e6f 726d   16px font 'norm
-00044100: 616c 2720 3132 7074 2066 6f6e 740d 0a20  al' 12pt font.. 
-00044110: 2020 2020 2020 2073 656c 662e 6c69 6e65         self.line
-00044120: 5f68 6569 6768 7420 3d20 3136 2e30 0d0a  _height = 16.0..
-00044130: 2020 2020 2020 2020 7365 6c66 2e66 6f6e          self.fon
-00044140: 745f 6661 6d69 6c79 203d 2022 7361 6e73  t_family = "sans
-00044150: 2d73 6572 6966 220d 0a20 2020 2020 2020  -serif"..       
-00044160: 2073 656c 662e 7061 7468 203d 204e 6f6e   self.path = Non
-00044170: 650d 0a0d 0a20 2020 2020 2020 2054 7261  e....        Tra
-00044180: 6e73 666f 726d 6162 6c65 2e5f 5f69 6e69  nsformable.__ini
-00044190: 745f 5f28 7365 6c66 2c20 2a61 7267 732c  t__(self, *args,
-000441a0: 202a 2a6b 7761 7267 7329 0d0a 2020 2020   **kwargs)..    
-000441b0: 2020 2020 4772 6170 6869 634f 626a 6563      GraphicObjec
-000441c0: 742e 5f5f 696e 6974 5f5f 2873 656c 662c  t.__init__(self,
-000441d0: 202a 6172 6773 2c20 2a2a 6b77 6172 6773   *args, **kwargs
-000441e0: 290d 0a20 2020 2020 2020 2053 5647 456c  )..        SVGEl
-000441f0: 656d 656e 742e 5f5f 696e 6974 5f5f 2873  ement.__init__(s
-00044200: 656c 662c 202a 6172 6773 2c20 2a2a 6b77  elf, *args, **kw
-00044210: 6172 6773 290d 0a0d 0a20 2020 2064 6566  args)....    def
-00044220: 205f 5f73 7472 5f5f 2873 656c 6629 3a0d   __str__(self):.
-00044230: 0a20 2020 2020 2020 2076 616c 7565 7320  .        values 
-00044240: 3d20 6c69 7374 2829 0d0a 2020 2020 2020  = list()..      
-00044250: 2020 7661 6c75 6573 2e61 7070 656e 6428    values.append(
-00044260: 2227 2573 2722 2025 2073 656c 662e 7465  "'%s'" % self.te
-00044270: 7874 290d 0a20 2020 2020 2020 2076 616c  xt)..        val
-00044280: 7565 732e 6170 7065 6e64 2822 2573 3d27  ues.append("%s='
-00044290: 2573 2722 2025 2028 5356 475f 4154 5452  %s'" % (SVG_ATTR
-000442a0: 5f46 4f4e 545f 4641 4d49 4c59 2c20 7365  _FONT_FAMILY, se
-000442b0: 6c66 2e66 6f6e 745f 6661 6d69 6c79 2929  lf.font_family))
-000442c0: 0d0a 2020 2020 2020 2020 7661 6c75 6573  ..        values
-000442d0: 2e61 7070 656e 6428 2225 733d 2725 7327  .append("%s='%s'
-000442e0: 2220 2520 2853 5647 5f41 5454 525f 464f  " % (SVG_ATTR_FO
-000442f0: 4e54 5f53 5459 4c45 2c20 7365 6c66 2e66  NT_STYLE, self.f
-00044300: 6f6e 745f 7374 796c 6529 290d 0a20 2020  ont_style))..   
-00044310: 2020 2020 2076 616c 7565 732e 6170 7065       values.appe
-00044320: 6e64 2822 2573 3d27 2573 2722 2025 2028  nd("%s='%s'" % (
-00044330: 5356 475f 4154 5452 5f46 4f4e 545f 5641  SVG_ATTR_FONT_VA
-00044340: 5249 414e 542c 2073 656c 662e 666f 6e74  RIANT, self.font
-00044350: 5f76 6172 6961 6e74 2929 0d0a 2020 2020  _variant))..    
-00044360: 2020 2020 7661 6c75 6573 2e61 7070 656e      values.appen
-00044370: 6428 2225 733d 2725 7327 2220 2520 2853  d("%s='%s'" % (S
-00044380: 5647 5f41 5454 525f 464f 4e54 5f57 4549  VG_ATTR_FONT_WEI
-00044390: 4748 542c 2073 7472 2873 656c 662e 666f  GHT, str(self.fo
-000443a0: 6e74 5f77 6569 6768 7429 2929 0d0a 2020  nt_weight)))..  
-000443b0: 2020 2020 2020 7661 6c75 6573 2e61 7070        values.app
-000443c0: 656e 6428 2225 733d 2725 7327 2220 2520  end("%s='%s'" % 
-000443d0: 2853 5647 5f41 5454 525f 464f 4e54 5f53  (SVG_ATTR_FONT_S
-000443e0: 5452 4554 4348 2c20 7365 6c66 2e66 6f6e  TRETCH, self.fon
-000443f0: 745f 7374 7265 7463 6829 290d 0a20 2020  t_stretch))..   
-00044400: 2020 2020 2076 616c 7565 732e 6170 7065       values.appe
-00044410: 6e64 2822 2573 3d25 6422 2025 2028 5356  nd("%s=%d" % (SV
-00044420: 475f 4154 5452 5f46 4f4e 545f 5349 5a45  G_ATTR_FONT_SIZE
-00044430: 2c20 7365 6c66 2e66 6f6e 745f 7369 7a65  , self.font_size
-00044440: 2929 0d0a 2020 2020 2020 2020 7661 6c75  ))..        valu
-00044450: 6573 2e61 7070 656e 6428 2225 733d 2725  es.append("%s='%
-00044460: 7327 2220 2520 2853 5647 5f41 5454 525f  s'" % (SVG_ATTR_
-00044470: 5445 5854 5f41 4e43 484f 522c 2073 656c  TEXT_ANCHOR, sel
-00044480: 662e 616e 6368 6f72 2929 0d0a 2020 2020  f.anchor))..    
-00044490: 2020 2020 6966 2073 656c 662e 7820 213d      if self.x !=
-000444a0: 2030 206f 7220 7365 6c66 2e79 2021 3d20   0 or self.y != 
-000444b0: 303a 0d0a 2020 2020 2020 2020 2020 2020  0:..            
-000444c0: 7661 6c75 6573 2e61 7070 656e 6428 2225  values.append("%
-000444d0: 733d 2573 2220 2520 2853 5647 5f41 5454  s=%s" % (SVG_ATT
-000444e0: 525f 582c 2073 656c 662e 7829 290d 0a20  R_X, self.x)).. 
-000444f0: 2020 2020 2020 2020 2020 2076 616c 7565             value
-00044500: 732e 6170 7065 6e64 2822 2573 3d25 7322  s.append("%s=%s"
-00044510: 2025 2028 5356 475f 4154 5452 5f59 2c20   % (SVG_ATTR_Y, 
-00044520: 7365 6c66 2e79 2929 0d0a 2020 2020 2020  self.y))..      
-00044530: 2020 6966 2073 656c 662e 6478 2021 3d20    if self.dx != 
-00044540: 3020 6f72 2073 656c 662e 6479 2021 3d20  0 or self.dy != 
-00044550: 303a 0d0a 2020 2020 2020 2020 2020 2020  0:..            
-00044560: 7661 6c75 6573 2e61 7070 656e 6428 2225  values.append("%
-00044570: 733d 2573 2220 2520 2853 5647 5f41 5454  s=%s" % (SVG_ATT
-00044580: 525f 4458 2c20 7365 6c66 2e64 7829 290d  R_DX, self.dx)).
-00044590: 0a20 2020 2020 2020 2020 2020 2076 616c  .            val
-000445a0: 7565 732e 6170 7065 6e64 2822 2573 3d25  ues.append("%s=%
-000445b0: 7322 2025 2028 5356 475f 4154 5452 5f44  s" % (SVG_ATTR_D
-000445c0: 592c 2073 656c 662e 6479 2929 0d0a 2020  Y, self.dy))..  
-000445d0: 2020 2020 2020 6966 2073 656c 662e 7374        if self.st
-000445e0: 726f 6b65 2069 7320 6e6f 7420 4e6f 6e65  roke is not None
-000445f0: 3a0d 0a20 2020 2020 2020 2020 2020 2076  :..            v
-00044600: 616c 7565 732e 6170 7065 6e64 2822 2573  alues.append("%s
-00044610: 3d27 2573 2722 2025 2028 5356 475f 4154  ='%s'" % (SVG_AT
-00044620: 5452 5f53 5452 4f4b 452c 2073 656c 662e  TR_STROKE, self.
-00044630: 7374 726f 6b65 2929 0d0a 2020 2020 2020  stroke))..      
-00044640: 2020 6966 2073 656c 662e 6669 6c6c 2069    if self.fill i
-00044650: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
-00044660: 2020 2020 2020 2020 2076 616c 7565 732e           values.
-00044670: 6170 7065 6e64 2822 2573 3d27 2573 2722  append("%s='%s'"
-00044680: 2025 2028 5356 475f 4154 5452 5f46 494c   % (SVG_ATTR_FIL
-00044690: 4c2c 2073 656c 662e 6669 6c6c 2929 0d0a  L, self.fill))..
-000446a0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-000446b0: 7374 726f 6b65 5f77 6964 7468 2069 7320  stroke_width is 
-000446c0: 6e6f 7420 4e6f 6e65 2061 6e64 2073 656c  not None and sel
-000446d0: 662e 7374 726f 6b65 5f77 6964 7468 2021  f.stroke_width !
-000446e0: 3d20 312e 303a 0d0a 2020 2020 2020 2020  = 1.0:..        
-000446f0: 2020 2020 7661 6c75 6573 2e61 7070 656e      values.appen
-00044700: 6428 2225 733d 2573 2220 2520 2853 5647  d("%s=%s" % (SVG
-00044710: 5f41 5454 525f 5354 524f 4b45 5f57 4944  _ATTR_STROKE_WID
-00044720: 5448 2c20 7374 7228 7365 6c66 2e73 7472  TH, str(self.str
-00044730: 6f6b 655f 7769 6474 6829 2929 0d0a 2020  oke_width)))..  
-00044740: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
-00044750: 662e 7472 616e 7366 6f72 6d2e 6973 5f69  f.transform.is_i
-00044760: 6465 6e74 6974 7928 293a 0d0a 2020 2020  dentity():..    
-00044770: 2020 2020 2020 2020 7661 6c75 6573 2e61          values.a
-00044780: 7070 656e 6428 2225 733d 2573 2220 2520  ppend("%s=%s" % 
-00044790: 2853 5647 5f41 5454 525f 5452 414e 5346  (SVG_ATTR_TRANSF
-000447a0: 4f52 4d2c 2072 6570 7228 7365 6c66 2e74  ORM, repr(self.t
-000447b0: 7261 6e73 666f 726d 2929 290d 0a20 2020  ransform)))..   
-000447c0: 2020 2020 2069 6620 7365 6c66 2e69 6420       if self.id 
-000447d0: 6973 206e 6f74 204e 6f6e 653a 0d0a 2020  is not None:..  
-000447e0: 2020 2020 2020 2020 2020 7661 6c75 6573            values
-000447f0: 2e61 7070 656e 6428 2225 733d 2725 7327  .append("%s='%s'
-00044800: 2220 2520 2853 5647 5f41 5454 525f 4944  " % (SVG_ATTR_ID
-00044810: 2c20 7365 6c66 2e69 6429 290d 0a20 2020  , self.id))..   
-00044820: 2020 2020 2072 6574 7572 6e20 2254 6578       return "Tex
-00044830: 7428 2573 2922 2025 2028 222c 2022 2e6a  t(%s)" % (", ".j
-00044840: 6f69 6e28 7661 6c75 6573 2929 0d0a 0d0a  oin(values))....
-00044850: 2020 2020 6465 6620 5f5f 7265 7072 5f5f      def __repr__
-00044860: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
-00044870: 2023 2043 616e 6e6f 7420 7573 6520 5356   # Cannot use SV
-00044880: 475f 4154 5452 5f46 4f4e 545f 2a20 6f72  G_ATTR_FONT_* or
-00044890: 2053 5647 5f41 5454 525f 5445 5854 5f41   SVG_ATTR_TEXT_A
-000448a0: 4e43 484f 5220 666f 7220 7265 7072 2062  NCHOR for repr b
-000448b0: 6563 6175 7365 2074 6865 7920 636f 6e74  ecause they cont
-000448c0: 6169 6e20 6879 7068 656e 730d 0a20 2020  ain hyphens..   
-000448d0: 2020 2020 2076 616c 7565 7320 3d20 6c69       values = li
-000448e0: 7374 2829 0d0a 2020 2020 2020 2020 7661  st()..        va
-000448f0: 6c75 6573 2e61 7070 656e 6428 2227 2573  lues.append("'%s
-00044900: 2722 2025 2073 656c 662e 7465 7874 290d  '" % self.text).
-00044910: 0a20 2020 2020 2020 2076 616c 7565 732e  .        values.
-00044920: 6170 7065 6e64 2822 666f 6e74 5f66 616d  append("font_fam
-00044930: 696c 793d 2725 7327 2220 2520 7365 6c66  ily='%s'" % self
-00044940: 2e66 6f6e 745f 6661 6d69 6c79 290d 0a20  .font_family).. 
-00044950: 2020 2020 2020 2069 6620 7365 6c66 2e66         if self.f
-00044960: 6f6e 745f 7374 796c 6520 213d 2022 6e6f  ont_style != "no
-00044970: 726d 616c 223a 0d0a 2020 2020 2020 2020  rmal":..        
-00044980: 2020 2020 7661 6c75 6573 2e61 7070 656e      values.appen
-00044990: 6428 2266 6f6e 745f 7374 796c 653d 2725  d("font_style='%
-000449a0: 7327 2220 2520 7365 6c66 2e66 6f6e 745f  s'" % self.font_
-000449b0: 7374 796c 6529 0d0a 2020 2020 2020 2020  style)..        
-000449c0: 6966 2073 656c 662e 666f 6e74 5f76 6172  if self.font_var
-000449d0: 6961 6e74 2021 3d20 226e 6f72 6d61 6c22  iant != "normal"
-000449e0: 3a0d 0a20 2020 2020 2020 2020 2020 2076  :..            v
-000449f0: 616c 7565 732e 6170 7065 6e64 2822 666f  alues.append("fo
-00044a00: 6e74 5f76 6172 6961 6e74 3d27 2573 2722  nt_variant='%s'"
-00044a10: 2025 2073 656c 662e 666f 6e74 5f76 6172   % self.font_var
-00044a20: 6961 6e74 290d 0a20 2020 2020 2020 2076  iant)..        v
-00044a30: 616c 7565 732e 6170 7065 6e64 2822 666f  alues.append("fo
-00044a40: 6e74 5f77 6569 6768 743d 2725 7327 2220  nt_weight='%s'" 
-00044a50: 2520 7374 7228 7365 6c66 2e66 6f6e 745f  % str(self.font_
-00044a60: 7765 6967 6874 2929 0d0a 2020 2020 2020  weight))..      
-00044a70: 2020 6966 2073 656c 662e 666f 6e74 5f73    if self.font_s
-00044a80: 7472 6574 6368 2021 3d20 226e 6f72 6d61  tretch != "norma
-00044a90: 6c22 3a0d 0a20 2020 2020 2020 2020 2020  l":..           
-00044aa0: 2076 616c 7565 732e 6170 7065 6e64 2822   values.append("
-00044ab0: 666f 6e74 5f73 7472 6574 6368 3d27 2573  font_stretch='%s
-00044ac0: 2722 2025 2073 656c 662e 666f 6e74 5f73  '" % self.font_s
-00044ad0: 7472 6574 6368 290d 0a20 2020 2020 2020  tretch)..       
-00044ae0: 2076 616c 7565 732e 6170 7065 6e64 2822   values.append("
-00044af0: 666f 6e74 5f73 697a 653d 2564 2220 2520  font_size=%d" % 
-00044b00: 7365 6c66 2e66 6f6e 745f 7369 7a65 290d  self.font_size).
-00044b10: 0a20 2020 2020 2020 2076 616c 7565 732e  .        values.
-00044b20: 6170 7065 6e64 2822 7465 7874 5f61 6e63  append("text_anc
-00044b30: 686f 723d 2725 7327 2220 2520 7365 6c66  hor='%s'" % self
-00044b40: 2e61 6e63 686f 7229 0d0a 2020 2020 2020  .anchor)..      
-00044b50: 2020 6966 2073 656c 662e 7820 213d 2030    if self.x != 0
-00044b60: 206f 7220 7365 6c66 2e79 2021 3d20 303a   or self.y != 0:
-00044b70: 0d0a 2020 2020 2020 2020 2020 2020 7661  ..            va
-00044b80: 6c75 6573 2e61 7070 656e 6428 2225 733d  lues.append("%s=
-00044b90: 2573 2220 2520 2853 5647 5f41 5454 525f  %s" % (SVG_ATTR_
-00044ba0: 582c 2073 656c 662e 7829 290d 0a20 2020  X, self.x))..   
-00044bb0: 2020 2020 2020 2020 2076 616c 7565 732e           values.
-00044bc0: 6170 7065 6e64 2822 2573 3d25 7322 2025  append("%s=%s" %
-00044bd0: 2028 5356 475f 4154 5452 5f59 2c20 7365   (SVG_ATTR_Y, se
-00044be0: 6c66 2e79 2929 0d0a 2020 2020 2020 2020  lf.y))..        
-00044bf0: 6966 2073 656c 662e 6478 2021 3d20 3020  if self.dx != 0 
-00044c00: 6f72 2073 656c 662e 6479 2021 3d20 303a  or self.dy != 0:
-00044c10: 0d0a 2020 2020 2020 2020 2020 2020 7661  ..            va
-00044c20: 6c75 6573 2e61 7070 656e 6428 2225 733d  lues.append("%s=
-00044c30: 2573 2220 2520 2853 5647 5f41 5454 525f  %s" % (SVG_ATTR_
-00044c40: 4458 2c20 7365 6c66 2e64 7829 290d 0a20  DX, self.dx)).. 
-00044c50: 2020 2020 2020 2020 2020 2076 616c 7565             value
-00044c60: 732e 6170 7065 6e64 2822 2573 3d25 7322  s.append("%s=%s"
-00044c70: 2025 2028 5356 475f 4154 5452 5f44 592c   % (SVG_ATTR_DY,
-00044c80: 2073 656c 662e 6479 2929 0d0a 2020 2020   self.dy))..    
-00044c90: 2020 2020 6966 2073 656c 662e 7374 726f      if self.stro
-00044ca0: 6b65 2069 7320 6e6f 7420 4e6f 6e65 3a0d  ke is not None:.
-00044cb0: 0a20 2020 2020 2020 2020 2020 2076 616c  .            val
-00044cc0: 7565 732e 6170 7065 6e64 2822 2573 3d27  ues.append("%s='
-00044cd0: 2573 2722 2025 2028 5356 475f 4154 5452  %s'" % (SVG_ATTR
-00044ce0: 5f53 5452 4f4b 452c 2073 656c 662e 7374  _STROKE, self.st
-00044cf0: 726f 6b65 2929 0d0a 2020 2020 2020 2020  roke))..        
-00044d00: 6966 2073 656c 662e 6669 6c6c 2069 7320  if self.fill is 
-00044d10: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
-00044d20: 2020 2020 2020 2076 616c 7565 732e 6170         values.ap
-00044d30: 7065 6e64 2822 2573 3d27 2573 2722 2025  pend("%s='%s'" %
-00044d40: 2028 5356 475f 4154 5452 5f46 494c 4c2c   (SVG_ATTR_FILL,
-00044d50: 2073 656c 662e 6669 6c6c 2929 0d0a 2020   self.fill))..  
-00044d60: 2020 2020 2020 6966 2073 656c 662e 7374        if self.st
-00044d70: 726f 6b65 5f77 6964 7468 2069 7320 6e6f  roke_width is no
-00044d80: 7420 4e6f 6e65 2061 6e64 2073 656c 662e  t None and self.
-00044d90: 7374 726f 6b65 5f77 6964 7468 2021 3d20  stroke_width != 
-00044da0: 312e 303a 0d0a 2020 2020 2020 2020 2020  1.0:..          
-00044db0: 2020 7661 6c75 6573 2e61 7070 656e 6428    values.append(
-00044dc0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00044dd0: 2020 2273 7472 6f6b 655f 7769 6474 683d    "stroke_width=
-00044de0: 2573 2220 2520 7374 7228 7365 6c66 2e73  %s" % str(self.s
-00044df0: 7472 6f6b 655f 7769 6474 6829 0d0a 2020  troke_width)..  
-00044e00: 2020 2020 2020 2020 2020 2920 2023 2043            )  # C
-00044e10: 616e 6e6f 7420 7573 6520 5356 475f 4154  annot use SVG_AT
-00044e20: 5452 5f53 5452 4f4b 455f 5749 4454 4820  TR_STROKE_WIDTH 
-00044e30: 666f 7220 7265 7072 2062 6563 6175 7365  for repr because
-00044e40: 2069 7420 636f 6e74 6169 6e73 2061 2068   it contains a h
-00044e50: 7970 6865 6e0d 0a20 2020 2020 2020 2069  yphen..        i
-00044e60: 6620 6e6f 7420 7365 6c66 2e74 7261 6e73  f not self.trans
-00044e70: 666f 726d 2e69 735f 6964 656e 7469 7479  form.is_identity
-00044e80: 2829 3a0d 0a20 2020 2020 2020 2020 2020  ():..           
-00044e90: 2076 616c 7565 732e 6170 7065 6e64 2822   values.append("
-00044ea0: 2573 3d25 7322 2025 2028 5356 475f 4154  %s=%s" % (SVG_AT
-00044eb0: 5452 5f54 5241 4e53 464f 524d 2c20 7265  TR_TRANSFORM, re
-00044ec0: 7072 2873 656c 662e 7472 616e 7366 6f72  pr(self.transfor
-00044ed0: 6d29 2929 0d0a 2020 2020 2020 2020 6966  m)))..        if
-00044ee0: 2073 656c 662e 6964 2069 7320 6e6f 7420   self.id is not 
-00044ef0: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
-00044f00: 2020 2076 616c 7565 732e 6170 7065 6e64     values.append
-00044f10: 2822 2573 3d27 2573 2722 2025 2028 5356  ("%s='%s'" % (SV
-00044f20: 475f 4154 5452 5f49 442c 2073 656c 662e  G_ATTR_ID, self.
-00044f30: 6964 2929 0d0a 2020 2020 2020 2020 7265  id))..        re
-00044f40: 7475 726e 2022 5465 7874 2825 7329 2220  turn "Text(%s)" 
-00044f50: 2520 2822 2c20 222e 6a6f 696e 2876 616c  % (", ".join(val
-00044f60: 7565 7329 290d 0a0d 0a20 2020 2064 6566  ues))....    def
-00044f70: 205f 5f65 715f 5f28 7365 6c66 2c20 6f74   __eq__(self, ot
-00044f80: 6865 7229 3a0d 0a20 2020 2020 2020 2069  her):..        i
-00044f90: 6620 6e6f 7420 6973 696e 7374 616e 6365  f not isinstance
-00044fa0: 286f 7468 6572 2c20 5465 7874 293a 0d0a  (other, Text):..
-00044fb0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00044fc0: 726e 204e 6f74 496d 706c 656d 656e 7465  rn NotImplemente
-00044fd0: 640d 0a20 2020 2020 2020 2069 6620 7365  d..        if se
-00044fe0: 6c66 2e74 6578 7420 213d 206f 7468 6572  lf.text != other
-00044ff0: 2e74 6578 743a 0d0a 2020 2020 2020 2020  .text:..        
-00045000: 2020 2020 7265 7475 726e 2046 616c 7365      return False
-00045010: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
-00045020: 662e 7769 6474 6820 213d 206f 7468 6572  f.width != other
-00045030: 2e77 6964 7468 3a0d 0a20 2020 2020 2020  .width:..       
-00045040: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
-00045050: 650d 0a20 2020 2020 2020 2069 6620 7365  e..        if se
-00045060: 6c66 2e68 6569 6768 7420 213d 206f 7468  lf.height != oth
-00045070: 6572 2e68 6569 6768 743a 0d0a 2020 2020  er.height:..    
-00045080: 2020 2020 2020 2020 7265 7475 726e 2046          return F
-00045090: 616c 7365 0d0a 2020 2020 2020 2020 6966  alse..        if
-000450a0: 2073 656c 662e 7820 213d 206f 7468 6572   self.x != other
-000450b0: 2e78 3a0d 0a20 2020 2020 2020 2020 2020  .x:..           
-000450c0: 2072 6574 7572 6e20 4661 6c73 650d 0a20   return False.. 
-000450d0: 2020 2020 2020 2069 6620 7365 6c66 2e79         if self.y
-000450e0: 2021 3d20 6f74 6865 722e 793a 0d0a 2020   != other.y:..  
-000450f0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00045100: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
-00045110: 6966 2073 656c 662e 6478 2021 3d20 6f74  if self.dx != ot
-00045120: 6865 722e 6478 3a0d 0a20 2020 2020 2020  her.dx:..       
-00045130: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
-00045140: 650d 0a20 2020 2020 2020 2069 6620 7365  e..        if se
-00045150: 6c66 2e64 7920 213d 206f 7468 6572 2e64  lf.dy != other.d
-00045160: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
-00045170: 7265 7475 726e 2046 616c 7365 0d0a 2020  return False..  
-00045180: 2020 2020 2020 6966 2073 656c 662e 616e        if self.an
-00045190: 6368 6f72 2021 3d20 6f74 6865 722e 616e  chor != other.an
-000451a0: 6368 6f72 3a0d 0a20 2020 2020 2020 2020  chor:..         
-000451b0: 2020 2072 6574 7572 6e20 4661 6c73 650d     return False.
-000451c0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-000451d0: 2e66 6f6e 745f 7374 796c 6520 213d 206f  .font_style != o
-000451e0: 7468 6572 2e66 6f6e 745f 7374 796c 653a  ther.font_style:
-000451f0: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
-00045200: 7475 726e 2046 616c 7365 0d0a 2020 2020  turn False..    
-00045210: 2020 2020 6966 2073 656c 662e 666f 6e74      if self.font
-00045220: 5f76 6172 6961 6e74 2021 3d20 6f74 6865  _variant != othe
-00045230: 722e 666f 6e74 5f76 6172 6961 6e74 3a0d  r.font_variant:.
-00045240: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00045250: 7572 6e20 4661 6c73 650d 0a20 2020 2020  urn False..     
-00045260: 2020 2069 6620 7365 6c66 2e66 6f6e 745f     if self.font_
-00045270: 7765 6967 6874 2021 3d20 6f74 6865 722e  weight != other.
-00045280: 666f 6e74 5f77 6569 6768 743a 0d0a 2020  font_weight:..  
-00045290: 2020 2020 2020 2020 2020 7265 7475 726e            return
-000452a0: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
-000452b0: 6966 2073 656c 662e 666f 6e74 5f73 7472  if self.font_str
-000452c0: 6574 6368 2021 3d20 6f74 6865 722e 666f  etch != other.fo
-000452d0: 6e74 5f73 7472 6574 6368 3a0d 0a20 2020  nt_stretch:..   
-000452e0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-000452f0: 4661 6c73 650d 0a20 2020 2020 2020 2069  False..        i
-00045300: 6620 7365 6c66 2e66 6f6e 745f 7369 7a65  f self.font_size
-00045310: 2021 3d20 6f74 6865 722e 666f 6e74 5f73   != other.font_s
-00045320: 697a 653a 0d0a 2020 2020 2020 2020 2020  ize:..          
-00045330: 2020 7265 7475 726e 2046 616c 7365 0d0a    return False..
-00045340: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00045350: 6c69 6e65 5f68 6569 6768 7420 213d 206f  line_height != o
-00045360: 7468 6572 2e6c 696e 655f 6865 6967 6874  ther.line_height
-00045370: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
-00045380: 6574 7572 6e20 4661 6c73 650d 0a20 2020  eturn False..   
-00045390: 2020 2020 2069 6620 7365 6c66 2e66 6f6e       if self.fon
-000453a0: 745f 6661 6d69 6c79 2021 3d20 6f74 6865  t_family != othe
-000453b0: 722e 666f 6e74 5f66 616d 696c 793a 0d0a  r.font_family:..
-000453c0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-000453d0: 726e 2046 616c 7365 0d0a 2020 2020 2020  rn False..      
-000453e0: 2020 6966 2073 656c 662e 666f 6e74 5f73    if self.font_s
-000453f0: 697a 6520 213d 206f 7468 6572 2e66 6f6e  ize != other.fon
-00045400: 745f 7369 7a65 3a0d 0a20 2020 2020 2020  t_size:..       
-00045410: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
-00045420: 650d 0a20 2020 2020 2020 2072 6574 7572  e..        retur
-00045430: 6e20 5472 7565 0d0a 0d0a 2020 2020 6465  n True....    de
-00045440: 6620 5f5f 6e65 5f5f 2873 656c 662c 206f  f __ne__(self, o
-00045450: 7468 6572 293a 0d0a 2020 2020 2020 2020  ther):..        
-00045460: 6966 206e 6f74 2069 7369 6e73 7461 6e63  if not isinstanc
-00045470: 6528 6f74 6865 722c 2054 6578 7429 3a0d  e(other, Text):.
-00045480: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00045490: 7572 6e20 4e6f 7449 6d70 6c65 6d65 6e74  urn NotImplement
-000454a0: 6564 0d0a 2020 2020 2020 2020 7265 7475  ed..        retu
-000454b0: 726e 206e 6f74 2073 656c 6620 3d3d 206f  rn not self == o
-000454c0: 7468 6572 0d0a 0d0a 2020 2020 6465 6620  ther....    def 
-000454d0: 7072 6f70 6572 7479 5f62 795f 6f62 6a65  property_by_obje
-000454e0: 6374 2873 656c 662c 2073 293a 0d0a 2020  ct(self, s):..  
-000454f0: 2020 2020 2020 5472 616e 7366 6f72 6d61        Transforma
-00045500: 626c 652e 7072 6f70 6572 7479 5f62 795f  ble.property_by_
-00045510: 6f62 6a65 6374 2873 656c 662c 2073 290d  object(self, s).
-00045520: 0a20 2020 2020 2020 2047 7261 7068 6963  .        Graphic
-00045530: 4f62 6a65 6374 2e70 726f 7065 7274 795f  Object.property_
-00045540: 6279 5f6f 626a 6563 7428 7365 6c66 2c20  by_object(self, 
-00045550: 7329 0d0a 2020 2020 2020 2020 5356 4745  s)..        SVGE
-00045560: 6c65 6d65 6e74 2e70 726f 7065 7274 795f  lement.property_
-00045570: 6279 5f6f 626a 6563 7428 7365 6c66 2c20  by_object(self, 
-00045580: 7329 0d0a 2020 2020 2020 2020 7365 6c66  s)..        self
-00045590: 2e74 6578 7420 3d20 732e 7465 7874 0d0a  .text = s.text..
-000455a0: 2020 2020 2020 2020 7365 6c66 2e78 203d          self.x =
-000455b0: 2073 2e78 0d0a 2020 2020 2020 2020 7365   s.x..        se
-000455c0: 6c66 2e79 203d 2073 2e79 0d0a 2020 2020  lf.y = s.y..    
-000455d0: 2020 2020 7365 6c66 2e77 6964 7468 203d      self.width =
-000455e0: 2073 2e77 6964 7468 0d0a 2020 2020 2020   s.width..      
-000455f0: 2020 7365 6c66 2e68 6569 6768 7420 3d20    self.height = 
-00045600: 732e 6865 6967 6874 0d0a 2020 2020 2020  s.height..      
-00045610: 2020 7365 6c66 2e64 7820 3d20 732e 6478    self.dx = s.dx
-00045620: 0d0a 2020 2020 2020 2020 7365 6c66 2e64  ..        self.d
-00045630: 7920 3d20 732e 6479 0d0a 2020 2020 2020  y = s.dy..      
-00045640: 2020 7365 6c66 2e61 6e63 686f 7220 3d20    self.anchor = 
-00045650: 732e 616e 6368 6f72 0d0a 2020 2020 2020  s.anchor..      
-00045660: 2020 7365 6c66 2e66 6f6e 745f 6661 6d69    self.font_fami
-00045670: 6c79 203d 2073 2e66 6f6e 745f 6661 6d69  ly = s.font_fami
-00045680: 6c79 0d0a 2020 2020 2020 2020 7365 6c66  ly..        self
-00045690: 2e66 6f6e 745f 7374 796c 6520 3d20 732e  .font_style = s.
-000456a0: 666f 6e74 5f73 7479 6c65 0d0a 2020 2020  font_style..    
-000456b0: 2020 2020 7365 6c66 2e66 6f6e 745f 7661      self.font_va
-000456c0: 7269 616e 7420 3d20 732e 666f 6e74 5f76  riant = s.font_v
-000456d0: 6172 6961 6e74 0d0a 2020 2020 2020 2020  ariant..        
-000456e0: 7365 6c66 2e66 6f6e 745f 7765 6967 6874  self.font_weight
-000456f0: 203d 2073 2e66 6f6e 745f 7765 6967 6874   = s.font_weight
-00045700: 0d0a 2020 2020 2020 2020 7365 6c66 2e66  ..        self.f
-00045710: 6f6e 745f 7374 7265 7463 6820 3d20 732e  ont_stretch = s.
-00045720: 666f 6e74 5f73 7472 6574 6368 0d0a 2020  font_stretch..  
-00045730: 2020 2020 2020 7365 6c66 2e66 6f6e 745f        self.font_
-00045740: 7369 7a65 203d 2073 2e66 6f6e 745f 7369  size = s.font_si
-00045750: 7a65 0d0a 2020 2020 2020 2020 7365 6c66  ze..        self
-00045760: 2e6c 696e 655f 6865 6967 6874 203d 2073  .line_height = s
-00045770: 2e6c 696e 655f 6865 6967 6874 0d0a 0d0a  .line_height....
-00045780: 2020 2020 6465 6620 7061 7273 655f 666f      def parse_fo
-00045790: 6e74 2873 656c 662c 2066 6f6e 7429 3a0d  nt(self, font):.
-000457a0: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
-000457b0: 2020 2020 2020 4353 5320 466f 6e74 7320        CSS Fonts 
-000457c0: 3320 6861 7320 6120 7368 6f72 7468 616e  3 has a shorthan
-000457d0: 6420 666f 6e74 2070 726f 7065 7274 7920  d font property 
-000457e0: 7768 6963 6820 7365 7276 6573 2074 6f20  which serves to 
-000457f0: 7072 6f76 6964 6520 6120 7369 6e67 6c65  provide a single
-00045800: 206c 6f63 6174 696f 6e20 746f 2064 6566   location to def
-00045810: 696e 653a 0d0a 2020 2020 2020 2020 6066  ine:..        `f
-00045820: 6f6e 742d 7374 796c 6560 2c20 6066 6f6e  ont-style`, `fon
-00045830: 742d 7661 7269 616e 7460 2c20 6066 6f6e  t-variant`, `fon
-00045840: 742d 7765 6967 6874 602c 2060 666f 6e74  t-weight`, `font
-00045850: 2d73 7472 6574 6368 602c 2060 666f 6e74  -stretch`, `font
-00045860: 2d73 697a 6560 2c20 606c 696e 652d 6865  -size`, `line-he
-00045870: 6967 6874 602c 2061 6e64 2060 666f 6e74  ight`, and `font
-00045880: 2d66 616d 696c 7960 0d0a 0d0a 2020 2020  -family`....    
-00045890: 2020 2020 666f 6e74 2d73 7479 6c65 3a20      font-style: 
-000458a0: 6e6f 726d 616c 207c 2069 7461 6c69 6320  normal | italic 
-000458b0: 7c20 6f62 6c69 7175 650d 0a20 2020 2020  | oblique..     
-000458c0: 2020 2066 6f6e 742d 7661 7269 616e 743a     font-variant:
-000458d0: 206e 6f72 6d61 6c20 7c20 736d 616c 6c2d   normal | small-
-000458e0: 6361 7073 0d0a 2020 2020 2020 2020 666f  caps..        fo
-000458f0: 6e74 2d77 6569 6768 743a 206e 6f72 6d61  nt-weight: norma
-00045900: 6c20 7c20 626f 6c64 207c 2062 6f6c 6465  l | bold | bolde
-00045910: 7220 7c20 6c69 6768 7465 7220 7c20 3130  r | lighter | 10
-00045920: 3020 7c20 3230 3020 7c20 3330 3020 7c20  0 | 200 | 300 | 
-00045930: 3430 3020 7c20 3530 3020 7c20 3630 3020  400 | 500 | 600 
-00045940: 7c20 3730 3020 7c20 3830 3020 7c20 3930  | 700 | 800 | 90
-00045950: 300d 0a20 2020 2020 2020 2066 6f6e 742d  0..        font-
-00045960: 7374 7265 7463 683a 206e 6f72 6d61 6c20  stretch: normal 
-00045970: 7c20 756c 7472 612d 636f 6e64 656e 7365  | ultra-condense
-00045980: 6420 7c20 6578 7472 612d 636f 6e64 656e  d | extra-conden
-00045990: 7365 6420 7c20 636f 6e64 656e 7365 6420  sed | condensed 
-000459a0: 7c20 7365 6d69 2d63 6f6e 6465 6e73 6564  | semi-condensed
-000459b0: 207c 2073 656d 692d 6578 7061 6e64 6564   | semi-expanded
-000459c0: 207c 2065 7870 616e 6465 6420 7c20 6578   | expanded | ex
-000459d0: 7472 612d 6578 7061 6e64 6564 207c 2075  tra-expanded | u
-000459e0: 6c74 7261 2d65 7870 616e 6465 640d 0a20  ltra-expanded.. 
-000459f0: 2020 2020 2020 2066 6f6e 742d 7369 7a65         font-size
-00045a00: 3a20 3c61 6273 6f6c 7574 652d 7369 7a65  : <absolute-size
-00045a10: 3e20 7c20 3c72 656c 6174 6976 652d 7369  > | <relative-si
-00045a20: 7a65 3e20 7c20 3c6c 656e 6774 682d 7065  ze> | <length-pe
-00045a30: 7263 656e 7461 6765 3e0d 0a20 2020 2020  rcentage>..     
-00045a40: 2020 206c 696e 652d 6865 6967 6874 3a20     line-height: 
-00045a50: 272f 2720 3c60 6c69 6e65 2d68 6569 6768  '/' <`line-heigh
-00045a60: 7460 3e0d 0a20 2020 2020 2020 2066 6f6e  t`>..        fon
-00045a70: 742d 6661 6d69 6c79 3a20 5b20 3c66 616d  t-family: [ <fam
-00045a80: 696c 792d 6e61 6d65 3e20 7c20 3c67 656e  ily-name> | <gen
-00045a90: 6572 6963 2d66 616d 696c 793e 205d 2023  eric-family> ] #
-00045aa0: 0d0a 2020 2020 2020 2020 6765 6e65 7269  ..        generi
-00045ab0: 632d 6661 6d69 6c79 3a20 2060 7365 7269  c-family:  `seri
-00045ac0: 6660 2c20 6073 616e 732d 7365 7269 6660  f`, `sans-serif`
-00045ad0: 2c20 6063 7572 7369 7665 602c 2060 6661  , `cursive`, `fa
-00045ae0: 6e74 6173 7960 2c20 616e 6420 606d 6f6e  ntasy`, and `mon
-00045af0: 6f73 7061 6365 600d 0a20 2020 2020 2020  ospace`..       
-00045b00: 2022 2222 0d0a 2020 2020 2020 2020 2320   """..        # 
-00045b10: 6874 7470 733a 2f2f 7777 772e 7733 2e6f  https://www.w3.o
-00045b20: 7267 2f54 522f 6373 732d 666f 6e74 732d  rg/TR/css-fonts-
-00045b30: 332f 2366 6f6e 742d 7072 6f70 0d0a 2020  3/#font-prop..  
-00045b40: 2020 2020 2020 6d61 7463 6820 3d20 5245        match = RE
-00045b50: 4745 585f 4353 535f 464f 4e54 2e6d 6174  GEX_CSS_FONT.mat
-00045b60: 6368 2866 6f6e 7429 0d0a 2020 2020 2020  ch(font)..      
-00045b70: 2020 6966 206e 6f74 206d 6174 6368 3a0d    if not match:.
-00045b80: 0a20 2020 2020 2020 2020 2020 2023 2054  .            # T
-00045b90: 6869 7320 6973 206e 6f74 2061 2071 7561  his is not a qua
-00045ba0: 6c69 6669 6564 2073 686f 7274 6861 6e64  lified shorthand
-00045bb0: 2066 6f6e 742e 0d0a 2020 2020 2020 2020   font...        
-00045bc0: 2020 2020 7265 7475 726e 0d0a 2020 2020      return..    
-00045bd0: 2020 2020 7365 6c66 2e66 6f6e 745f 7374      self.font_st
-00045be0: 796c 6520 3d20 6d61 7463 682e 6772 6f75  yle = match.grou
-00045bf0: 7028 3129 0d0a 2020 2020 2020 2020 6966  p(1)..        if
-00045c00: 2073 656c 662e 666f 6e74 5f73 7479 6c65   self.font_style
-00045c10: 2069 7320 4e6f 6e65 3a0d 0a20 2020 2020   is None:..     
-00045c20: 2020 2020 2020 2073 656c 662e 666f 6e74         self.font
-00045c30: 5f73 7479 6c65 203d 2022 6e6f 726d 616c  _style = "normal
-00045c40: 220d 0a0d 0a20 2020 2020 2020 2073 656c  "....        sel
-00045c50: 662e 666f 6e74 5f76 6172 6961 6e74 203d  f.font_variant =
-00045c60: 206d 6174 6368 2e67 726f 7570 2832 290d   match.group(2).
-00045c70: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-00045c80: 2e66 6f6e 745f 7661 7269 616e 7420 6973  .font_variant is
-00045c90: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
-00045ca0: 2020 2020 7365 6c66 2e66 6f6e 745f 7661      self.font_va
-00045cb0: 7269 616e 7420 3d20 226e 6f72 6d61 6c22  riant = "normal"
-00045cc0: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
-00045cd0: 2e66 6f6e 745f 7765 6967 6874 203d 206d  .font_weight = m
-00045ce0: 6174 6368 2e67 726f 7570 2833 290d 0a20  atch.group(3).. 
-00045cf0: 2020 2020 2020 2069 6620 7365 6c66 2e66         if self.f
-00045d00: 6f6e 745f 7765 6967 6874 2069 7320 4e6f  ont_weight is No
-00045d10: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
-00045d20: 2073 656c 662e 666f 6e74 5f77 6569 6768   self.font_weigh
-00045d30: 7420 3d20 226e 6f72 6d61 6c22 0d0a 0d0a  t = "normal"....
-00045d40: 2020 2020 2020 2020 7365 6c66 2e66 6f6e          self.fon
-00045d50: 745f 7374 7265 7463 6820 3d20 6d61 7463  t_stretch = matc
-00045d60: 682e 6772 6f75 7028 3429 0d0a 2020 2020  h.group(4)..    
-00045d70: 2020 2020 6966 2073 656c 662e 666f 6e74      if self.font
-00045d80: 5f73 7472 6574 6368 2069 7320 4e6f 6e65  _stretch is None
-00045d90: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
-00045da0: 656c 662e 666f 6e74 5f73 7472 6574 6368  elf.font_stretch
-00045db0: 203d 2022 6e6f 726d 616c 220d 0a0d 0a20   = "normal".... 
-00045dc0: 2020 2020 2020 2073 656c 662e 666f 6e74         self.font
-00045dd0: 5f73 697a 6520 3d20 6d61 7463 682e 6772  _size = match.gr
-00045de0: 6f75 7028 3529 0d0a 2020 2020 2020 2020  oup(5)..        
-00045df0: 6966 2073 656c 662e 666f 6e74 5f73 697a  if self.font_siz
-00045e00: 6520 6973 204e 6f6e 653a 0d0a 2020 2020  e is None:..    
-00045e10: 2020 2020 2020 2020 7365 6c66 2e66 6f6e          self.fon
-00045e20: 745f 7369 7a65 203d 2022 3132 7074 220d  t_size = "12pt".
-00045e30: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-00045e40: 2e66 6f6e 745f 7369 7a65 3a0d 0a20 2020  .font_size:..   
-00045e50: 2020 2020 2020 2020 2073 697a 6520 3d20           size = 
-00045e60: 7365 6c66 2e66 6f6e 745f 7369 7a65 0d0a  self.font_size..
-00045e70: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00045e80: 2e66 6f6e 745f 7369 7a65 203d 204c 656e  .font_size = Len
-00045e90: 6774 6828 7365 6c66 2e66 6f6e 745f 7369  gth(self.font_si
-00045ea0: 7a65 290d 0a20 2020 2020 2020 2020 2020  ze)..           
-00045eb0: 2074 7279 3a0d 0a20 2020 2020 2020 2020   try:..         
-00045ec0: 2020 2020 2020 2073 656c 662e 666f 6e74         self.font
-00045ed0: 5f73 697a 6520 3d20 4c65 6e67 7468 2873  _size = Length(s
-00045ee0: 656c 662e 666f 6e74 5f73 697a 6529 2e76  elf.font_size).v
-00045ef0: 616c 7565 2829 0d0a 2020 2020 2020 2020  alue()..        
-00045f00: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00045f10: 666f 6e74 5f73 697a 6520 3d3d 2030 3a0d  font_size == 0:.
-00045f20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00045f30: 2020 2020 2073 656c 662e 666f 6e74 5f73       self.font_s
-00045f40: 697a 6520 3d20 7369 7a65 0d0a 2020 2020  ize = size..    
-00045f50: 2020 2020 2020 2020 6578 6365 7074 2056          except V
-00045f60: 616c 7565 4572 726f 723a 0d0a 2020 2020  alueError:..    
-00045f70: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00045f80: 2e66 6f6e 745f 7369 7a65 203d 2073 697a  .font_size = siz
-00045f90: 650d 0a0d 0a20 2020 2020 2020 2073 656c  e....        sel
-00045fa0: 662e 6c69 6e65 5f68 6569 6768 7420 3d20  f.line_height = 
-00045fb0: 6d61 7463 682e 6772 6f75 7028 3629 0d0a  match.group(6)..
-00045fc0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00045fd0: 6c69 6e65 5f68 6569 6768 7420 6973 204e  line_height is N
-00045fe0: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
-00045ff0: 2020 7365 6c66 2e6c 696e 655f 6865 6967    self.line_heig
-00046000: 6874 203d 2022 3132 7074 220d 0a20 2020  ht = "12pt"..   
-00046010: 2020 2020 2069 6620 7365 6c66 2e6c 696e       if self.lin
-00046020: 655f 6865 6967 6874 3a0d 0a20 2020 2020  e_height:..     
-00046030: 2020 2020 2020 2068 6569 6768 7420 3d20         height = 
-00046040: 7365 6c66 2e6c 696e 655f 6865 6967 6874  self.line_height
-00046050: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00046060: 6c66 2e6c 696e 655f 6865 6967 6874 203d  lf.line_height =
-00046070: 204c 656e 6774 6828 7365 6c66 2e6c 696e   Length(self.lin
-00046080: 655f 6865 6967 6874 290d 0a20 2020 2020  e_height)..     
-00046090: 2020 2020 2020 2074 7279 3a0d 0a20 2020         try:..   
-000460a0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-000460b0: 662e 6c69 6e65 5f68 6569 6768 7420 3d20  f.line_height = 
-000460c0: 4c65 6e67 7468 280d 0a20 2020 2020 2020  Length(..       
-000460d0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-000460e0: 662e 6c69 6e65 5f68 6569 6768 742c 2072  f.line_height, r
-000460f0: 656c 6174 6976 655f 6c65 6e67 7468 3d73  elative_length=s
-00046100: 656c 662e 666f 6e74 5f73 697a 650d 0a20  elf.font_size.. 
-00046110: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00046120: 2e76 616c 7565 2829 0d0a 2020 2020 2020  .value()..      
-00046130: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-00046140: 662e 6c69 6e65 5f68 6569 6768 7420 3d3d  f.line_height ==
-00046150: 2030 3a0d 0a20 2020 2020 2020 2020 2020   0:..           
-00046160: 2020 2020 2020 2020 2073 656c 662e 6c69           self.li
-00046170: 6e65 5f68 6569 6768 7420 3d20 6865 6967  ne_height = heig
-00046180: 6874 0d0a 2020 2020 2020 2020 2020 2020  ht..            
-00046190: 6578 6365 7074 2056 616c 7565 4572 726f  except ValueErro
-000461a0: 723a 0d0a 2020 2020 2020 2020 2020 2020  r:..            
-000461b0: 2020 2020 7365 6c66 2e6c 696e 655f 6865      self.line_he
-000461c0: 6967 6874 203d 2068 6569 6768 740d 0a0d  ight = height...
-000461d0: 0a20 2020 2020 2020 2073 656c 662e 666f  .        self.fo
-000461e0: 6e74 5f66 616d 696c 7920 3d20 6d61 7463  nt_family = matc
-000461f0: 682e 6772 6f75 7028 3729 0d0a 0d0a 2020  h.group(7)....  
-00046200: 2020 4070 726f 7065 7274 790d 0a20 2020    @property..   
-00046210: 2064 6566 2066 6f6e 745f 6c69 7374 2873   def font_list(s
-00046220: 656c 6629 3a0d 0a20 2020 2020 2020 2072  elf):..        r
-00046230: 6574 7572 6e20 5b0d 0a20 2020 2020 2020  eturn [..       
-00046240: 2020 2020 2066 616d 696c 795b 313a 2d31       family[1:-1
-00046250: 5d20 6966 2066 616d 696c 792e 7374 6172  ] if family.star
-00046260: 7473 7769 7468 2827 2227 2920 6f72 2066  tswith('"') or f
-00046270: 616d 696c 792e 7374 6172 7473 7769 7468  amily.startswith
-00046280: 2822 2722 2920 656c 7365 2066 616d 696c  ("'") else famil
-00046290: 790d 0a20 2020 2020 2020 2020 2020 2066  y..            f
-000462a0: 6f72 2066 616d 696c 7920 696e 2052 4547  or family in REG
-000462b0: 4558 5f43 5353 5f46 4f4e 545f 4641 4d49  EX_CSS_FONT_FAMI
-000462c0: 4c59 2e66 696e 6461 6c6c 2873 656c 662e  LY.findall(self.
-000462d0: 666f 6e74 5f66 616d 696c 7929 0d0a 2020  font_family)..  
-000462e0: 2020 2020 2020 5d0d 0a0d 0a20 2020 2040        ]....    @
-000462f0: 7072 6f70 6572 7479 0d0a 2020 2020 6465  property..    de
-00046300: 6620 7765 6967 6874 2873 656c 6629 3a0d  f weight(self):.
-00046310: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
-00046320: 2020 2020 2020 5468 6973 2064 6f65 7320        This does 
-00046330: 6e6f 7420 636f 7272 6563 746c 7920 7061  not correctly pa
-00046340: 7273 6520 7765 6967 6874 7320 666f 7220  rse weights for 
-00046350: 626f 6c64 6572 206f 7220 6c69 6768 7465  bolder or lighte
-00046360: 722e 2054 686f 7365 2061 7265 2072 656c  r. Those are rel
-00046370: 6174 6976 6520 746f 2074 6865 2070 7265  ative to the pre
-00046380: 7669 6f75 7320 7365 740d 0a20 2020 2020  vious set..     
-00046390: 2020 2066 6f6e 742d 7765 6967 6874 2061     font-weight a
-000463a0: 6e64 2074 6861 7420 6973 2067 656e 6572  nd that is gener
-000463b0: 616c 6c79 2075 6e6b 6e6f 776e 2069 6e20  ally unknown in 
-000463c0: 7468 6973 2063 6f6e 7465 7874 2e0d 0a20  this context... 
-000463d0: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
-000463e0: 2020 2020 6966 2073 656c 662e 666f 6e74      if self.font
-000463f0: 5f77 6569 6768 7420 3d3d 2022 626f 6c64  _weight == "bold
-00046400: 223a 0d0a 2020 2020 2020 2020 2020 2020  ":..            
-00046410: 7265 7475 726e 2037 3030 0d0a 2020 2020  return 700..    
-00046420: 2020 2020 6966 2073 656c 662e 666f 6e74      if self.font
-00046430: 5f77 6569 6768 7420 3d3d 2022 6e6f 726d  _weight == "norm
-00046440: 616c 223a 0d0a 2020 2020 2020 2020 2020  al":..          
-00046450: 2020 7265 7475 726e 2034 3030 0d0a 2020    return 400..  
-00046460: 2020 2020 2020 7472 793a 0d0a 2020 2020        try:..    
-00046470: 2020 2020 2020 2020 7265 7475 726e 2069          return i
-00046480: 6e74 2873 656c 662e 666f 6e74 5f77 6569  nt(self.font_wei
-00046490: 6768 7429 0d0a 2020 2020 2020 2020 6578  ght)..        ex
-000464a0: 6365 7074 2056 616c 7565 4572 726f 723a  cept ValueError:
-000464b0: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
-000464c0: 7475 726e 2034 3030 0d0a 0d0a 2020 2020  turn 400....    
-000464d0: 4070 726f 7065 7274 790d 0a20 2020 2064  @property..    d
-000464e0: 6566 2066 6f6e 745f 6661 6365 2873 656c  ef font_face(sel
-000464f0: 6629 3a0d 0a20 2020 2020 2020 2022 2222  f):..        """
-00046500: 0d0a 2020 2020 2020 2020 4465 7072 6563  ..        Deprec
-00046510: 6174 6564 2046 6f6e 7466 6163 652e 0d0a  ated Fontface...
-00046520: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
-00046530: 2020 2020 2072 6574 7572 6e20 2222 0d0a       return ""..
-00046540: 0d0a 2020 2020 6465 6620 7072 6f70 6572  ..    def proper
-00046550: 7479 5f62 795f 7661 6c75 6573 2873 656c  ty_by_values(sel
-00046560: 662c 2076 616c 7565 7329 3a0d 0a20 2020  f, values):..   
-00046570: 2020 2020 2054 7261 6e73 666f 726d 6162       Transformab
-00046580: 6c65 2e70 726f 7065 7274 795f 6279 5f76  le.property_by_v
-00046590: 616c 7565 7328 7365 6c66 2c20 7661 6c75  alues(self, valu
-000465a0: 6573 290d 0a20 2020 2020 2020 2047 7261  es)..        Gra
-000465b0: 7068 6963 4f62 6a65 6374 2e70 726f 7065  phicObject.prope
-000465c0: 7274 795f 6279 5f76 616c 7565 7328 7365  rty_by_values(se
-000465d0: 6c66 2c20 7661 6c75 6573 290d 0a20 2020  lf, values)..   
-000465e0: 2020 2020 2053 5647 456c 656d 656e 742e       SVGElement.
-000465f0: 7072 6f70 6572 7479 5f62 795f 7661 6c75  property_by_valu
-00046600: 6573 2873 656c 662c 2076 616c 7565 7329  es(self, values)
-00046610: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
-00046620: 2e66 6f6e 745f 6661 6d69 6c79 203d 2076  .font_family = v
-00046630: 616c 7565 732e 6765 7428 2266 6f6e 745f  alues.get("font_
-00046640: 6661 6d69 6c79 222c 2073 656c 662e 666f  family", self.fo
-00046650: 6e74 5f66 616d 696c 7929 0d0a 2020 2020  nt_family)..    
-00046660: 2020 2020 7365 6c66 2e66 6f6e 745f 6661      self.font_fa
-00046670: 6d69 6c79 203d 2076 616c 7565 732e 6765  mily = values.ge
-00046680: 7428 5356 475f 4154 5452 5f46 4f4e 545f  t(SVG_ATTR_FONT_
-00046690: 4641 4d49 4c59 2c20 7365 6c66 2e66 6f6e  FAMILY, self.fon
-000466a0: 745f 6661 6d69 6c79 290d 0a0d 0a20 2020  t_family)....   
-000466b0: 2020 2020 2073 656c 662e 666f 6e74 5f73       self.font_s
-000466c0: 7479 6c65 203d 2076 616c 7565 732e 6765  tyle = values.ge
-000466d0: 7428 2266 6f6e 745f 7374 796c 6522 2c20  t("font_style", 
-000466e0: 7365 6c66 2e66 6f6e 745f 7374 796c 6529  self.font_style)
-000466f0: 0d0a 2020 2020 2020 2020 7365 6c66 2e66  ..        self.f
-00046700: 6f6e 745f 7374 796c 6520 3d20 7661 6c75  ont_style = valu
-00046710: 6573 2e67 6574 2853 5647 5f41 5454 525f  es.get(SVG_ATTR_
-00046720: 464f 4e54 5f53 5459 4c45 2c20 7365 6c66  FONT_STYLE, self
-00046730: 2e66 6f6e 745f 6661 6d69 6c79 290d 0a0d  .font_family)...
-00046740: 0a20 2020 2020 2020 2073 656c 662e 666f  .        self.fo
-00046750: 6e74 5f76 6172 6961 6e74 203d 2076 616c  nt_variant = val
-00046760: 7565 732e 6765 7428 2266 6f6e 745f 7661  ues.get("font_va
-00046770: 7269 616e 7422 2c20 7365 6c66 2e66 6f6e  riant", self.fon
-00046780: 745f 7661 7269 616e 7429 0d0a 2020 2020  t_variant)..    
-00046790: 2020 2020 7365 6c66 2e66 6f6e 745f 7661      self.font_va
-000467a0: 7269 616e 7420 3d20 7661 6c75 6573 2e67  riant = values.g
-000467b0: 6574 2853 5647 5f41 5454 525f 464f 4e54  et(SVG_ATTR_FONT
-000467c0: 5f56 4152 4941 4e54 2c20 7365 6c66 2e66  _VARIANT, self.f
-000467d0: 6f6e 745f 7661 7269 616e 7429 0d0a 0d0a  ont_variant)....
-000467e0: 2020 2020 2020 2020 7365 6c66 2e66 6f6e          self.fon
-000467f0: 745f 7765 6967 6874 203d 2076 616c 7565  t_weight = value
-00046800: 732e 6765 7428 2266 6f6e 745f 7765 6967  s.get("font_weig
-00046810: 6874 222c 2073 656c 662e 666f 6e74 5f77  ht", self.font_w
-00046820: 6569 6768 7429 0d0a 2020 2020 2020 2020  eight)..        
-00046830: 7365 6c66 2e66 6f6e 745f 7765 6967 6874  self.font_weight
-00046840: 203d 2076 616c 7565 732e 6765 7428 5356   = values.get(SV
-00046850: 475f 4154 5452 5f46 4f4e 545f 5745 4947  G_ATTR_FONT_WEIG
-00046860: 4854 2c20 7365 6c66 2e66 6f6e 745f 7765  HT, self.font_we
-00046870: 6967 6874 290d 0a20 2020 2020 2020 2074  ight)..        t
-00046880: 7279 3a0d 0a20 2020 2020 2020 2020 2020  ry:..           
-00046890: 2073 656c 662e 666f 6e74 5f77 6569 6768   self.font_weigh
-000468a0: 7420 3d20 696e 7428 7365 6c66 2e66 6f6e  t = int(self.fon
-000468b0: 745f 7765 6967 6874 290d 0a20 2020 2020  t_weight)..     
-000468c0: 2020 2065 7863 6570 7420 5661 6c75 6545     except ValueE
-000468d0: 7272 6f72 3a0d 0a20 2020 2020 2020 2020  rror:..         
-000468e0: 2020 2070 6173 730d 0a0d 0a20 2020 2020     pass....     
-000468f0: 2020 2073 656c 662e 666f 6e74 5f73 7472     self.font_str
-00046900: 6574 6368 203d 2076 616c 7565 732e 6765  etch = values.ge
-00046910: 7428 2266 6f6e 745f 7374 7265 7463 6822  t("font_stretch"
-00046920: 2c20 7365 6c66 2e66 6f6e 745f 7374 7265  , self.font_stre
-00046930: 7463 6829 0d0a 2020 2020 2020 2020 7365  tch)..        se
-00046940: 6c66 2e66 6f6e 745f 7374 7265 7463 6820  lf.font_stretch 
-00046950: 3d20 7661 6c75 6573 2e67 6574 2853 5647  = values.get(SVG
-00046960: 5f41 5454 525f 464f 4e54 5f53 5452 4554  _ATTR_FONT_STRET
-00046970: 4348 2c20 7365 6c66 2e66 6f6e 745f 7374  CH, self.font_st
-00046980: 7265 7463 6829 0d0a 0d0a 2020 2020 2020  retch)....      
-00046990: 2020 7365 6c66 2e66 6f6e 745f 7369 7a65    self.font_size
-000469a0: 203d 204c 656e 6774 6828 7661 6c75 6573   = Length(values
-000469b0: 2e67 6574 2822 666f 6e74 5f73 697a 6522  .get("font_size"
-000469c0: 2c20 7365 6c66 2e66 6f6e 745f 7369 7a65  , self.font_size
-000469d0: 2929 2e76 616c 7565 2829 0d0a 2020 2020  )).value()..    
-000469e0: 2020 2020 7365 6c66 2e66 6f6e 745f 7369      self.font_si
-000469f0: 7a65 203d 204c 656e 6774 6828 7661 6c75  ze = Length(valu
-00046a00: 6573 2e67 6574 2853 5647 5f41 5454 525f  es.get(SVG_ATTR_
-00046a10: 464f 4e54 5f53 495a 452c 2073 656c 662e  FONT_SIZE, self.
-00046a20: 666f 6e74 5f73 697a 6529 292e 7661 6c75  font_size)).valu
-00046a30: 6528 290d 0a0d 0a20 2020 2020 2020 2073  e()....        s
-00046a40: 656c 662e 616e 6368 6f72 203d 2076 616c  elf.anchor = val
-00046a50: 7565 732e 6765 7428 2274 6578 745f 616e  ues.get("text_an
-00046a60: 6368 6f72 222c 2073 656c 662e 616e 6368  chor", self.anch
-00046a70: 6f72 290d 0a20 2020 2020 2020 2073 656c  or)..        sel
-00046a80: 662e 616e 6368 6f72 203d 2076 616c 7565  f.anchor = value
-00046a90: 732e 6765 7428 5356 475f 4154 5452 5f54  s.get(SVG_ATTR_T
-00046aa0: 4558 545f 414e 4348 4f52 2c20 7365 6c66  EXT_ANCHOR, self
-00046ab0: 2e61 6e63 686f 7229 0d0a 0d0a 2020 2020  .anchor)....    
-00046ac0: 2020 2020 666f 6e74 203d 2076 616c 7565      font = value
-00046ad0: 732e 6765 7428 5356 475f 4154 5452 5f46  s.get(SVG_ATTR_F
-00046ae0: 4f4e 542c 204e 6f6e 6529 0d0a 2020 2020  ONT, None)..    
-00046af0: 2020 2020 6966 2066 6f6e 7420 6973 206e      if font is n
-00046b00: 6f74 204e 6f6e 653a 0d0a 2020 2020 2020  ot None:..      
-00046b10: 2020 2020 2020 7365 6c66 2e70 6172 7365        self.parse
-00046b20: 5f66 6f6e 7428 666f 6e74 290d 0a0d 0a20  _font(font).... 
-00046b30: 2020 2020 2020 2073 656c 662e 7465 7874         self.text
-00046b40: 203d 2076 616c 7565 732e 6765 7428 5356   = values.get(SV
-00046b50: 475f 5441 475f 5445 5854 2c20 7365 6c66  G_TAG_TEXT, self
-00046b60: 2e74 6578 7429 0d0a 2020 2020 2020 2020  .text)..        
-00046b70: 7365 6c66 2e78 203d 204c 656e 6774 6828  self.x = Length(
-00046b80: 7661 6c75 6573 2e67 6574 2853 5647 5f41  values.get(SVG_A
-00046b90: 5454 525f 582c 2073 656c 662e 7829 292e  TTR_X, self.x)).
-00046ba0: 7661 6c75 6528 290d 0a20 2020 2020 2020  value()..       
-00046bb0: 2073 656c 662e 7920 3d20 4c65 6e67 7468   self.y = Length
-00046bc0: 2876 616c 7565 732e 6765 7428 5356 475f  (values.get(SVG_
-00046bd0: 4154 5452 5f59 2c20 7365 6c66 2e79 2929  ATTR_Y, self.y))
-00046be0: 2e76 616c 7565 2829 0d0a 2020 2020 2020  .value()..      
-00046bf0: 2020 7365 6c66 2e64 7820 3d20 4c65 6e67    self.dx = Leng
-00046c00: 7468 2876 616c 7565 732e 6765 7428 5356  th(values.get(SV
-00046c10: 475f 4154 5452 5f44 582c 2073 656c 662e  G_ATTR_DX, self.
-00046c20: 6478 2929 2e76 616c 7565 2829 0d0a 2020  dx)).value()..  
-00046c30: 2020 2020 2020 7365 6c66 2e64 7920 3d20        self.dy = 
-00046c40: 4c65 6e67 7468 2876 616c 7565 732e 6765  Length(values.ge
-00046c50: 7428 5356 475f 4154 5452 5f44 592c 2073  t(SVG_ATTR_DY, s
-00046c60: 656c 662e 6479 2929 2e76 616c 7565 2829  elf.dy)).value()
-00046c70: 0d0a 0d0a 2020 2020 6465 6620 7265 6966  ....    def reif
-00046c80: 7928 7365 6c66 293a 0d0a 2020 2020 2020  y(self):..      
-00046c90: 2020 4772 6170 6869 634f 626a 6563 742e    GraphicObject.
-00046ca0: 7265 6966 7928 7365 6c66 290d 0a20 2020  reify(self)..   
-00046cb0: 2020 2020 2054 7261 6e73 666f 726d 6162       Transformab
-00046cc0: 6c65 2e72 6569 6679 2873 656c 6629 0d0a  le.reify(self)..
-00046cd0: 0d0a 2020 2020 6465 6620 7265 6e64 6572  ..    def render
-00046ce0: 2873 656c 662c 202a 2a6b 7761 7267 7329  (self, **kwargs)
-00046cf0: 3a0d 0a20 2020 2020 2020 2047 7261 7068  :..        Graph
-00046d00: 6963 4f62 6a65 6374 2e72 656e 6465 7228  icObject.render(
-00046d10: 7365 6c66 2c20 2a2a 6b77 6172 6773 290d  self, **kwargs).
-00046d20: 0a20 2020 2020 2020 2054 7261 6e73 666f  .        Transfo
-00046d30: 726d 6162 6c65 2e72 656e 6465 7228 7365  rmable.render(se
-00046d40: 6c66 2c20 2a2a 6b77 6172 6773 290d 0a20  lf, **kwargs).. 
-00046d50: 2020 2020 2020 2077 6964 7468 203d 206b         width = k
-00046d60: 7761 7267 732e 6765 7428 2277 6964 7468  wargs.get("width
-00046d70: 222c 206b 7761 7267 732e 6765 7428 2272  ", kwargs.get("r
-00046d80: 656c 6174 6976 655f 6c65 6e67 7468 2229  elative_length")
-00046d90: 290d 0a20 2020 2020 2020 2068 6569 6768  )..        heigh
-00046da0: 7420 3d20 6b77 6172 6773 2e67 6574 2822  t = kwargs.get("
-00046db0: 6865 6967 6874 222c 206b 7761 7267 732e  height", kwargs.
-00046dc0: 6765 7428 2272 656c 6174 6976 655f 6c65  get("relative_le
-00046dd0: 6e67 7468 2229 290d 0a20 2020 2020 2020  ngth"))..       
-00046de0: 2074 7279 3a0d 0a20 2020 2020 2020 2020   try:..         
-00046df0: 2020 2064 656c 206b 7761 7267 735b 2272     del kwargs["r
-00046e00: 656c 6174 6976 655f 6c65 6e67 7468 225d  elative_length"]
-00046e10: 0d0a 2020 2020 2020 2020 6578 6365 7074  ..        except
-00046e20: 204b 6579 4572 726f 723a 0d0a 2020 2020   KeyError:..    
-00046e30: 2020 2020 2020 2020 7061 7373 0d0a 2020          pass..  
-00046e40: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-00046e50: 6e63 6528 7365 6c66 2e78 2c20 4c65 6e67  nce(self.x, Leng
-00046e60: 7468 293a 0d0a 2020 2020 2020 2020 2020  th):..          
-00046e70: 2020 7365 6c66 2e78 203d 2073 656c 662e    self.x = self.
-00046e80: 782e 7661 6c75 6528 7265 6c61 7469 7665  x.value(relative
-00046e90: 5f6c 656e 6774 683d 7769 6474 682c 202a  _length=width, *
-00046ea0: 2a6b 7761 7267 7329 0d0a 2020 2020 2020  *kwargs)..      
-00046eb0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-00046ec0: 7365 6c66 2e79 2c20 4c65 6e67 7468 293a  self.y, Length):
-00046ed0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00046ee0: 6c66 2e79 203d 2073 656c 662e 792e 7661  lf.y = self.y.va
-00046ef0: 6c75 6528 7265 6c61 7469 7665 5f6c 656e  lue(relative_len
-00046f00: 6774 683d 6865 6967 6874 2c20 2a2a 6b77  gth=height, **kw
-00046f10: 6172 6773 290d 0a20 2020 2020 2020 2069  args)..        i
-00046f20: 6620 6973 696e 7374 616e 6365 2873 656c  f isinstance(sel
-00046f30: 662e 6478 2c20 4c65 6e67 7468 293a 0d0a  f.dx, Length):..
-00046f40: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00046f50: 2e64 7820 3d20 7365 6c66 2e64 782e 7661  .dx = self.dx.va
-00046f60: 6c75 6528 7265 6c61 7469 7665 5f6c 656e  lue(relative_len
-00046f70: 6774 683d 7769 6474 682c 202a 2a6b 7761  gth=width, **kwa
-00046f80: 7267 7329 0d0a 2020 2020 2020 2020 6966  rgs)..        if
-00046f90: 2069 7369 6e73 7461 6e63 6528 7365 6c66   isinstance(self
-00046fa0: 2e64 792c 204c 656e 6774 6829 3a0d 0a20  .dy, Length):.. 
-00046fb0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00046fc0: 6479 203d 2073 656c 662e 6479 2e76 616c  dy = self.dy.val
-00046fd0: 7565 2872 656c 6174 6976 655f 6c65 6e67  ue(relative_leng
-00046fe0: 7468 3d68 6569 6768 742c 202a 2a6b 7761  th=height, **kwa
-00046ff0: 7267 7329 0d0a 2020 2020 2020 2020 7265  rgs)..        re
-00047000: 7475 726e 2073 656c 660d 0a0d 0a20 2020  turn self....   
-00047010: 2064 6566 205f 5f63 6f70 795f 5f28 7365   def __copy__(se
-00047020: 6c66 293a 0d0a 2020 2020 2020 2020 7265  lf):..        re
-00047030: 7475 726e 2054 6578 7428 7365 6c66 290d  turn Text(self).
-00047040: 0a0d 0a20 2020 2064 6566 2062 626f 7828  ...    def bbox(
-00047050: 7365 6c66 2c20 7472 616e 7366 6f72 6d65  self, transforme
-00047060: 643d 5472 7565 2c20 7769 7468 5f73 7472  d=True, with_str
-00047070: 6f6b 653d 4661 6c73 6529 3a0d 0a20 2020  oke=False):..   
-00047080: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
-00047090: 2020 4765 7420 7468 6520 626f 756e 6469    Get the boundi
-000470a0: 6e67 2062 6f78 2066 6f72 2074 6865 2067  ng box for the g
-000470b0: 6976 656e 2074 6578 7420 6f62 6a65 6374  iven text object
-000470c0: 2e0d 0a0d 0a20 2020 2020 2020 203a 7061  .....        :pa
-000470d0: 7261 6d20 7472 616e 7366 6f72 6d65 643a  ram transformed:
-000470e0: 2077 6865 7468 6572 2074 6869 7320 6973   whether this is
-000470f0: 2074 6865 2074 7261 6e73 666f 726d 6564   the transformed
-00047100: 2062 6f75 6e64 7320 6f72 2064 6566 6175   bounds or defau
-00047110: 6c74 2e0d 0a20 2020 2020 2020 203a 7061  lt...        :pa
-00047120: 7261 6d20 7769 7468 5f73 7472 6f6b 653a  ram with_stroke:
-00047130: 2073 686f 756c 6420 7468 6520 7374 726f   should the stro
-00047140: 6b65 2d77 6964 7468 2062 6520 696e 636c  ke-width be incl
-00047150: 7564 6564 2069 6e20 7468 6520 626f 756e  uded in the boun
-00047160: 6473 2e0d 0a20 2020 2020 2020 203a 7265  ds...        :re
-00047170: 7475 726e 3a20 626f 756e 6469 6e67 2062  turn: bounding b
-00047180: 6f78 206f 6620 7468 6520 6769 7665 6e20  ox of the given 
-00047190: 656c 656d 656e 740d 0a20 2020 2020 2020  element..       
-000471a0: 2022 2222 0d0a 2020 2020 2020 2020 6966   """..        if
-000471b0: 2073 656c 662e 7061 7468 2069 7320 6e6f   self.path is no
-000471c0: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
-000471d0: 2020 2020 2072 6574 7572 6e20 2873 656c       return (sel
-000471e0: 662e 7061 7468 202a 2073 656c 662e 7472  f.path * self.tr
-000471f0: 616e 7366 6f72 6d29 2e62 626f 7828 0d0a  ansform).bbox(..
-00047200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047210: 7472 616e 7366 6f72 6d65 643d 5472 7565  transformed=True
-00047220: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00047230: 2020 2077 6974 685f 7374 726f 6b65 3d77     with_stroke=w
-00047240: 6974 685f 7374 726f 6b65 2c0d 0a20 2020  ith_stroke,..   
-00047250: 2020 2020 2020 2020 2029 0d0a 0d0a 2020           )....  
-00047260: 2020 2020 2020 7769 6474 6820 3d20 7365        width = se
-00047270: 6c66 2e77 6964 7468 0d0a 2020 2020 2020  lf.width..      
-00047280: 2020 6865 6967 6874 203d 2073 656c 662e    height = self.
-00047290: 6865 6967 6874 0d0a 2020 2020 2020 2020  height..        
-000472a0: 786d 696e 203d 2073 656c 662e 780d 0a20  xmin = self.x.. 
-000472b0: 2020 2020 2020 2079 6d69 6e20 3d20 7365         ymin = se
-000472c0: 6c66 2e79 202d 2068 6569 6768 740d 0a20  lf.y - height.. 
-000472d0: 2020 2020 2020 2078 6d61 7820 3d20 7365         xmax = se
-000472e0: 6c66 2e78 202b 2077 6964 7468 0d0a 2020  lf.x + width..  
-000472f0: 2020 2020 2020 796d 6178 203d 2073 656c        ymax = sel
-00047300: 662e 790d 0a0d 0a20 2020 2020 2020 2069  f.y....        i
-00047310: 6620 6e6f 7420 6861 7361 7474 7228 7365  f not hasattr(se
-00047320: 6c66 2c20 2261 6e63 686f 7222 2920 6f72  lf, "anchor") or
-00047330: 2073 656c 662e 616e 6368 6f72 203d 3d20   self.anchor == 
-00047340: 2273 7461 7274 223a 0d0a 2020 2020 2020  "start":..      
-00047350: 2020 2020 2020 7061 7373 0d0a 2020 2020        pass..    
-00047360: 2020 2020 656c 6966 2073 656c 662e 616e      elif self.an
-00047370: 6368 6f72 203d 3d20 226d 6964 646c 6522  chor == "middle"
-00047380: 3a0d 0a20 2020 2020 2020 2020 2020 2078  :..            x
-00047390: 6d69 6e20 2d3d 2077 6964 7468 202f 2032  min -= width / 2
-000473a0: 0d0a 2020 2020 2020 2020 2020 2020 786d  ..            xm
-000473b0: 6178 202d 3d20 7769 6474 6820 2f20 320d  ax -= width / 2.
-000473c0: 0a20 2020 2020 2020 2065 6c69 6620 7365  .        elif se
-000473d0: 6c66 2e61 6e63 686f 7220 3d3d 2022 656e  lf.anchor == "en
-000473e0: 6422 3a0d 0a20 2020 2020 2020 2020 2020  d":..           
-000473f0: 2078 6d69 6e20 2d3d 2077 6964 7468 0d0a   xmin -= width..
-00047400: 2020 2020 2020 2020 2020 2020 786d 6178              xmax
-00047410: 202d 3d20 7769 6474 680d 0a20 2020 2020   -= width..     
-00047420: 2020 2069 6620 7472 616e 7366 6f72 6d65     if transforme
-00047430: 643a 0d0a 2020 2020 2020 2020 2020 2020  d:..            
-00047440: 7030 203d 2073 656c 662e 7472 616e 7366  p0 = self.transf
-00047450: 6f72 6d2e 7472 616e 7366 6f72 6d5f 706f  orm.transform_po
-00047460: 696e 7428 5b78 6d69 6e2c 2079 6d69 6e5d  int([xmin, ymin]
-00047470: 290d 0a20 2020 2020 2020 2020 2020 2070  )..            p
-00047480: 3120 3d20 7365 6c66 2e74 7261 6e73 666f  1 = self.transfo
-00047490: 726d 2e74 7261 6e73 666f 726d 5f70 6f69  rm.transform_poi
-000474a0: 6e74 285b 786d 696e 2c20 796d 6178 5d29  nt([xmin, ymax])
-000474b0: 0d0a 2020 2020 2020 2020 2020 2020 7032  ..            p2
-000474c0: 203d 2073 656c 662e 7472 616e 7366 6f72   = self.transfor
-000474d0: 6d2e 7472 616e 7366 6f72 6d5f 706f 696e  m.transform_poin
-000474e0: 7428 5b78 6d61 782c 2079 6d69 6e5d 290d  t([xmax, ymin]).
-000474f0: 0a20 2020 2020 2020 2020 2020 2070 3320  .            p3 
-00047500: 3d20 7365 6c66 2e74 7261 6e73 666f 726d  = self.transform
-00047510: 2e74 7261 6e73 666f 726d 5f70 6f69 6e74  .transform_point
-00047520: 285b 786d 6178 2c20 796d 6178 5d29 0d0a  ([xmax, ymax])..
-00047530: 2020 2020 2020 2020 2020 2020 786d 696e              xmin
-00047540: 203d 206d 696e 2870 305b 305d 2c20 7031   = min(p0[0], p1
-00047550: 5b30 5d2c 2070 325b 305d 2c20 7033 5b30  [0], p2[0], p3[0
-00047560: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
-00047570: 796d 696e 203d 206d 696e 2870 305b 315d  ymin = min(p0[1]
-00047580: 2c20 7031 5b31 5d2c 2070 325b 315d 2c20  , p1[1], p2[1], 
-00047590: 7033 5b31 5d29 0d0a 2020 2020 2020 2020  p3[1])..        
-000475a0: 2020 2020 786d 6178 203d 206d 6178 2870      xmax = max(p
-000475b0: 305b 305d 2c20 7031 5b30 5d2c 2070 325b  0[0], p1[0], p2[
-000475c0: 305d 2c20 7033 5b30 5d29 0d0a 2020 2020  0], p3[0])..    
-000475d0: 2020 2020 2020 2020 796d 6178 203d 206d          ymax = m
-000475e0: 6178 2870 305b 315d 2c20 7031 5b31 5d2c  ax(p0[1], p1[1],
-000475f0: 2070 325b 315d 2c20 7033 5b31 5d29 0d0a   p2[1], p3[1])..
-00047600: 0d0a 2020 2020 2020 2020 6966 2028 0d0a  ..        if (..
-00047610: 2020 2020 2020 2020 2020 2020 7769 7468              with
-00047620: 5f73 7472 6f6b 650d 0a20 2020 2020 2020  _stroke..       
-00047630: 2020 2020 2061 6e64 2073 656c 662e 7374       and self.st
-00047640: 726f 6b65 5f77 6964 7468 2069 7320 6e6f  roke_width is no
-00047650: 7420 4e6f 6e65 0d0a 2020 2020 2020 2020  t None..        
-00047660: 2020 2020 616e 6420 6e6f 7420 2873 656c      and not (sel
-00047670: 662e 7374 726f 6b65 2069 7320 4e6f 6e65  f.stroke is None
-00047680: 206f 7220 7365 6c66 2e73 7472 6f6b 652e   or self.stroke.
-00047690: 7661 6c75 6520 6973 204e 6f6e 6529 0d0a  value is None)..
-000476a0: 2020 2020 2020 2020 293a 0d0a 2020 2020          ):..    
-000476b0: 2020 2020 2020 2020 6966 2074 7261 6e73          if trans
-000476c0: 666f 726d 6564 3a0d 0a20 2020 2020 2020  formed:..       
-000476d0: 2020 2020 2020 2020 2064 656c 7461 203d           delta =
-000476e0: 2066 6c6f 6174 2873 656c 662e 696d 706c   float(self.impl
-000476f0: 6963 6974 5f73 7472 6f6b 655f 7769 6474  icit_stroke_widt
-00047700: 6829 202f 2032 2e30 0d0a 2020 2020 2020  h) / 2.0..      
-00047710: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-00047720: 2020 2020 2020 2020 2020 2020 2064 656c               del
-00047730: 7461 203d 2066 6c6f 6174 2873 656c 662e  ta = float(self.
-00047740: 7374 726f 6b65 5f77 6964 7468 2920 2f20  stroke_width) / 
-00047750: 322e 300d 0a20 2020 2020 2020 2065 6c73  2.0..        els
-00047760: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00047770: 6465 6c74 6120 3d20 302e 300d 0a0d 0a20  delta = 0.0.... 
-00047780: 2020 2020 2020 2072 6574 7572 6e20 280d         return (.
-00047790: 0a20 2020 2020 2020 2020 2020 2078 6d69  .            xmi
-000477a0: 6e20 2d20 6465 6c74 612c 0d0a 2020 2020  n - delta,..    
-000477b0: 2020 2020 2020 2020 796d 696e 202d 2064          ymin - d
-000477c0: 656c 7461 2c0d 0a20 2020 2020 2020 2020  elta,..         
-000477d0: 2020 2078 6d61 7820 2b20 6465 6c74 612c     xmax + delta,
-000477e0: 0d0a 2020 2020 2020 2020 2020 2020 796d  ..            ym
-000477f0: 6178 202b 2064 656c 7461 2c0d 0a20 2020  ax + delta,..   
-00047800: 2020 2020 2029 0d0a 0d0a 0d0a 5356 4754       )......SVGT
-00047810: 6578 7420 3d20 5465 7874 0d0a 0d0a 0d0a  ext = Text......
-00047820: 636c 6173 7320 496d 6167 6528 5356 4745  class Image(SVGE
-00047830: 6c65 6d65 6e74 2c20 4772 6170 6869 634f  lement, GraphicO
-00047840: 626a 6563 742c 2054 7261 6e73 666f 726d  bject, Transform
-00047850: 6162 6c65 293a 0d0a 2020 2020 2222 220d  able):..    """.
-00047860: 0a20 2020 2053 5647 2049 6d61 6765 7320  .    SVG Images 
-00047870: 6172 6520 6465 6669 6e65 6420 696e 2053  are defined in S
-00047880: 5647 2032 2e30 2031 322e 330d 0a0d 0a20  VG 2.0 12.3.... 
-00047890: 2020 2054 6869 7320 636c 6173 7320 6973     This class is
-000478a0: 2063 616c 6c65 6420 5356 4720 496d 6167   called SVG Imag
-000478b0: 6520 7261 7468 6572 2074 6861 6e20 696d  e rather than im
-000478c0: 6167 6520 6173 2061 2067 7561 7264 2061  age as a guard a
-000478d0: 6761 696e 7374 206d 616e 7920 496d 6167  gainst many Imag
-000478e0: 6520 6f62 6a65 6374 730d 0a20 2020 2077  e objects..    w
-000478f0: 6869 6368 2061 7265 2071 7569 7465 2075  hich are quite u
-00047900: 7365 6675 6c20 616e 6420 776f 756c 6420  seful and would 
-00047910: 6265 2069 6465 616c 2066 6f72 2072 6561  be ideal for rea
-00047920: 6469 6e67 2074 6865 206c 696e 6b65 6420  ding the linked 
-00047930: 6f72 2063 6f6e 7461 696e 6564 2064 6174  or contained dat
-00047940: 612e 0d0a 2020 2020 2222 220d 0a0d 0a20  a...    """.... 
-00047950: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
-00047960: 7365 6c66 2c20 2a61 7267 732c 202a 2a6b  self, *args, **k
-00047970: 7761 7267 7329 3a0d 0a20 2020 2020 2020  wargs):..       
-00047980: 2073 656c 662e 7572 6c20 3d20 4e6f 6e65   self.url = None
-00047990: 0d0a 2020 2020 2020 2020 7365 6c66 2e64  ..        self.d
-000479a0: 6174 6120 3d20 4e6f 6e65 0d0a 2020 2020  ata = None..    
-000479b0: 2020 2020 7365 6c66 2e6d 6564 6961 5f74      self.media_t
-000479c0: 7970 6520 3d20 4e6f 6e65 0d0a 2020 2020  ype = None..    
-000479d0: 2020 2020 7365 6c66 2e76 6965 7762 6f78      self.viewbox
-000479e0: 203d 204e 6f6e 650d 0a20 2020 2020 2020   = None..       
-000479f0: 2073 656c 662e 7072 6573 6572 7665 5f61   self.preserve_a
-00047a00: 7370 6563 745f 7261 7469 6f20 3d20 4e6f  spect_ratio = No
-00047a10: 6e65 0d0a 2020 2020 2020 2020 7365 6c66  ne..        self
-00047a20: 2e78 203d 204e 6f6e 650d 0a20 2020 2020  .x = None..     
-00047a30: 2020 2073 656c 662e 7920 3d20 4e6f 6e65     self.y = None
-00047a40: 0d0a 2020 2020 2020 2020 7365 6c66 2e77  ..        self.w
-00047a50: 6964 7468 203d 204e 6f6e 650d 0a20 2020  idth = None..   
-00047a60: 2020 2020 2073 656c 662e 6865 6967 6874       self.height
-00047a70: 203d 204e 6f6e 650d 0a0d 0a20 2020 2020   = None....     
-00047a80: 2020 2073 656c 662e 696d 6167 6520 3d20     self.image = 
-00047a90: 4e6f 6e65 0d0a 2020 2020 2020 2020 7365  None..        se
-00047aa0: 6c66 2e69 6d61 6765 5f77 6964 7468 203d  lf.image_width =
-00047ab0: 204e 6f6e 650d 0a20 2020 2020 2020 2073   None..        s
-00047ac0: 656c 662e 696d 6167 655f 6865 6967 6874  elf.image_height
-00047ad0: 203d 204e 6f6e 650d 0a20 2020 2020 2020   = None..       
-00047ae0: 2054 7261 6e73 666f 726d 6162 6c65 2e5f   Transformable._
-00047af0: 5f69 6e69 745f 5f28 7365 6c66 2c20 2a61  _init__(self, *a
-00047b00: 7267 732c 202a 2a6b 7761 7267 7329 0d0a  rgs, **kwargs)..
-00047b10: 2020 2020 2020 2020 4772 6170 6869 634f          GraphicO
-00047b20: 626a 6563 742e 5f5f 696e 6974 5f5f 2873  bject.__init__(s
-00047b30: 656c 662c 202a 6172 6773 2c20 2a2a 6b77  elf, *args, **kw
-00047b40: 6172 6773 290d 0a20 2020 2020 2020 2053  args)..        S
-00047b50: 5647 456c 656d 656e 742e 5f5f 696e 6974  VGElement.__init
-00047b60: 5f5f 280d 0a20 2020 2020 2020 2020 2020  __(..           
-00047b70: 2073 656c 662c 202a 6172 6773 2c20 2a2a   self, *args, **
-00047b80: 6b77 6172 6773 0d0a 2020 2020 2020 2020  kwargs..        
-00047b90: 2920 2023 2044 6174 6175 726c 2072 6571  )  # Dataurl req
-00047ba0: 7569 7265 7320 7468 6973 2062 6520 7072  uires this be pr
-00047bb0: 6f63 6573 7365 6420 6669 7273 742e 0d0a  ocessed first...
-00047bc0: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
-00047bd0: 662e 7572 6c20 6973 206e 6f74 204e 6f6e  f.url is not Non
-00047be0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00047bf0: 6d61 7463 6820 3d20 5245 4745 585f 4441  match = REGEX_DA
-00047c00: 5441 5f55 524c 2e6d 6174 6368 2873 656c  TA_URL.match(sel
-00047c10: 662e 7572 6c29 0d0a 2020 2020 2020 2020  f.url)..        
-00047c20: 2020 2020 6966 206d 6174 6368 3a0d 0a20      if match:.. 
-00047c30: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00047c40: 2044 6174 6120 5552 4c0d 0a20 2020 2020   Data URL..     
-00047c50: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00047c60: 6d65 6469 615f 7479 7065 203d 206d 6174  media_type = mat
-00047c70: 6368 2e67 726f 7570 2831 292e 7370 6c69  ch.group(1).spli
-00047c80: 7428 223b 2229 0d0a 2020 2020 2020 2020  t(";")..        
-00047c90: 2020 2020 2020 2020 7365 6c66 2e64 6174          self.dat
-00047ca0: 6120 3d20 6d61 7463 682e 6772 6f75 7028  a = match.group(
-00047cb0: 3229 0d0a 2020 2020 2020 2020 2020 2020  2)..            
-00047cc0: 2020 2020 6966 2022 6261 7365 3634 2220      if "base64" 
-00047cd0: 696e 2073 656c 662e 6d65 6469 615f 7479  in self.media_ty
-00047ce0: 7065 3a0d 0a20 2020 2020 2020 2020 2020  pe:..           
-00047cf0: 2020 2020 2020 2020 2066 726f 6d20 6261           from ba
-00047d00: 7365 3634 2069 6d70 6f72 7420 6236 3464  se64 import b64d
-00047d10: 6563 6f64 650d 0a0d 0a20 2020 2020 2020  ecode....       
-00047d20: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00047d30: 662e 6461 7461 203d 2062 3634 6465 636f  f.data = b64deco
-00047d40: 6465 2873 656c 662e 6461 7461 290d 0a20  de(self.data).. 
-00047d50: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00047d60: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-00047d70: 2020 2020 2020 2020 2020 6672 6f6d 2075            from u
-00047d80: 726c 6c69 622e 7061 7273 6520 696d 706f  rllib.parse impo
-00047d90: 7274 2075 6e71 756f 7465 5f74 6f5f 6279  rt unquote_to_by
-00047da0: 7465 730d 0a0d 0a20 2020 2020 2020 2020  tes....         
-00047db0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00047dc0: 6461 7461 203d 2075 6e71 756f 7465 5f74  data = unquote_t
-00047dd0: 6f5f 6279 7465 7328 7365 6c66 2e64 6174  o_bytes(self.dat
-00047de0: 6129 0d0a 0d0a 2020 2020 6465 6620 5f5f  a)....    def __
-00047df0: 7265 7072 5f5f 2873 656c 6629 3a0d 0a20  repr__(self):.. 
-00047e00: 2020 2020 2020 2076 616c 7565 7320 3d20         values = 
-00047e10: 5b5d 0d0a 2020 2020 2020 2020 6966 2073  []..        if s
-00047e20: 656c 662e 7820 213d 2030 3a0d 0a20 2020  elf.x != 0:..   
-00047e30: 2020 2020 2020 2020 2076 616c 7565 732e           values.
-00047e40: 6170 7065 6e64 2822 2573 3d25 7322 2025  append("%s=%s" %
-00047e50: 2028 5356 475f 4154 5452 5f58 2c20 4c65   (SVG_ATTR_X, Le
-00047e60: 6e67 7468 2e73 7472 2873 656c 662e 7829  ngth.str(self.x)
-00047e70: 2929 0d0a 2020 2020 2020 2020 6966 2073  ))..        if s
-00047e80: 656c 662e 7920 213d 2030 3a0d 0a20 2020  elf.y != 0:..   
-00047e90: 2020 2020 2020 2020 2076 616c 7565 732e           values.
-00047ea0: 6170 7065 6e64 2822 2573 3d25 7322 2025  append("%s=%s" %
-00047eb0: 2028 5356 475f 4154 5452 5f59 2c20 4c65   (SVG_ATTR_Y, Le
-00047ec0: 6e67 7468 2e73 7472 2873 656c 662e 7929  ngth.str(self.y)
-00047ed0: 2929 0d0a 2020 2020 2020 2020 6966 2073  ))..        if s
-00047ee0: 656c 662e 7769 6474 6820 213d 2022 3130  elf.width != "10
-00047ef0: 3025 223a 0d0a 2020 2020 2020 2020 2020  0%":..          
-00047f00: 2020 7661 6c75 6573 2e61 7070 656e 6428    values.append(
-00047f10: 2225 733d 2573 2220 2520 2853 5647 5f41  "%s=%s" % (SVG_A
-00047f20: 5454 525f 5749 4454 482c 204c 656e 6774  TTR_WIDTH, Lengt
-00047f30: 682e 7374 7228 7365 6c66 2e77 6964 7468  h.str(self.width
-00047f40: 2929 290d 0a20 2020 2020 2020 2069 6620  )))..        if 
-00047f50: 7365 6c66 2e68 6569 6768 7420 213d 2022  self.height != "
-00047f60: 3130 3025 223a 0d0a 2020 2020 2020 2020  100%":..        
-00047f70: 2020 2020 7661 6c75 6573 2e61 7070 656e      values.appen
-00047f80: 6428 2225 733d 2573 2220 2520 2853 5647  d("%s=%s" % (SVG
-00047f90: 5f41 5454 525f 4845 4947 4854 2c20 4c65  _ATTR_HEIGHT, Le
-00047fa0: 6e67 7468 2e73 7472 2873 656c 662e 6865  ngth.str(self.he
-00047fb0: 6967 6874 2929 290d 0a20 2020 2020 2020  ight)))..       
-00047fc0: 2069 6620 7365 6c66 2e70 7265 7365 7276   if self.preserv
-00047fd0: 655f 6173 7065 6374 5f72 6174 696f 2069  e_aspect_ratio i
-00047fe0: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
-00047ff0: 2020 2020 2020 2020 2076 616c 7565 732e           values.
-00048000: 6170 7065 6e64 280d 0a20 2020 2020 2020  append(..       
-00048010: 2020 2020 2020 2020 2022 2573 3d25 7322           "%s=%s"
-00048020: 2025 2028 5356 475f 4154 5452 5f50 5245   % (SVG_ATTR_PRE
-00048030: 5345 5256 4541 5350 4543 5452 4154 494f  SERVEASPECTRATIO
-00048040: 2c20 7365 6c66 2e70 7265 7365 7276 655f  , self.preserve_
-00048050: 6173 7065 6374 5f72 6174 696f 290d 0a20  aspect_ratio).. 
-00048060: 2020 2020 2020 2020 2020 2029 0d0a 2020             )..  
-00048070: 2020 2020 2020 6966 2073 656c 662e 7669        if self.vi
-00048080: 6577 626f 7820 6973 206e 6f74 204e 6f6e  ewbox is not Non
-00048090: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-000480a0: 7661 6c75 6573 2e61 7070 656e 6428 2225  values.append("%
-000480b0: 733d 2725 7327 2220 2520 2853 5647 5f41  s='%s'" % (SVG_A
-000480c0: 5454 525f 5649 4557 424f 582c 2073 7472  TTR_VIEWBOX, str
-000480d0: 2873 656c 662e 7669 6577 626f 7829 2929  (self.viewbox)))
-000480e0: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
-000480f0: 662e 7572 6c20 6973 206e 6f74 204e 6f6e  f.url is not Non
-00048100: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00048110: 7661 6c75 6573 2e61 7070 656e 6428 2225  values.append("%
-00048120: 733d 2725 7327 2220 2520 2853 5647 5f48  s='%s'" % (SVG_H
-00048130: 5245 462c 2073 656c 662e 7572 6c29 290d  REF, self.url)).
-00048140: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-00048150: 7365 6c66 2e74 7261 6e73 666f 726d 2e69  self.transform.i
-00048160: 735f 6964 656e 7469 7479 2829 3a0d 0a20  s_identity():.. 
-00048170: 2020 2020 2020 2020 2020 2076 616c 7565             value
-00048180: 732e 6170 7065 6e64 2822 7472 616e 7366  s.append("transf
-00048190: 6f72 6d3d 2573 2220 2520 7265 7072 2873  orm=%s" % repr(s
-000481a0: 656c 662e 7472 616e 7366 6f72 6d29 290d  elf.transform)).
-000481b0: 0a20 2020 2020 2020 2070 6172 616d 7320  .        params 
-000481c0: 3d20 222c 2022 2e6a 6f69 6e28 7661 6c75  = ", ".join(valu
-000481d0: 6573 290d 0a20 2020 2020 2020 2072 6574  es)..        ret
-000481e0: 7572 6e20 2249 6d61 6765 2825 7329 2220  urn "Image(%s)" 
-000481f0: 2520 7061 7261 6d73 0d0a 0d0a 2020 2020  % params....    
-00048200: 6465 6620 5f5f 6571 5f5f 2873 656c 662c  def __eq__(self,
-00048210: 206f 7468 6572 293a 0d0a 2020 2020 2020   other):..      
-00048220: 2020 6966 206e 6f74 2069 7369 6e73 7461    if not isinsta
-00048230: 6e63 6528 6f74 6865 722c 2049 6d61 6765  nce(other, Image
-00048240: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00048250: 7265 7475 726e 204e 6f74 496d 706c 656d  return NotImplem
-00048260: 656e 7465 640d 0a20 2020 2020 2020 2069  ented..        i
-00048270: 6620 7365 6c66 2e75 726c 2021 3d20 6f74  f self.url != ot
-00048280: 6865 722e 7572 6c3a 0d0a 2020 2020 2020  her.url:..      
-00048290: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
-000482a0: 7365 0d0a 2020 2020 2020 2020 6966 2073  se..        if s
-000482b0: 656c 662e 6461 7461 2021 3d20 6f74 6865  elf.data != othe
-000482c0: 722e 6461 7461 3a0d 0a20 2020 2020 2020  r.data:..       
-000482d0: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
-000482e0: 650d 0a20 2020 2020 2020 2069 6620 7365  e..        if se
-000482f0: 6c66 2e77 6964 7468 2021 3d20 6f74 6865  lf.width != othe
-00048300: 722e 7769 6474 683a 0d0a 2020 2020 2020  r.width:..      
-00048310: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
-00048320: 7365 0d0a 2020 2020 2020 2020 6966 2073  se..        if s
-00048330: 656c 662e 6865 6967 6874 2021 3d20 6f74  elf.height != ot
-00048340: 6865 722e 6865 6967 6874 3a0d 0a20 2020  her.height:..   
-00048350: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00048360: 4661 6c73 650d 0a20 2020 2020 2020 2069  False..        i
-00048370: 6620 7365 6c66 2e78 2021 3d20 6f74 6865  f self.x != othe
-00048380: 722e 783a 0d0a 2020 2020 2020 2020 2020  r.x:..          
-00048390: 2020 7265 7475 726e 2046 616c 7365 0d0a    return False..
-000483a0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-000483b0: 7920 213d 206f 7468 6572 2e79 3a0d 0a20  y != other.y:.. 
-000483c0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-000483d0: 6e20 4661 6c73 650d 0a20 2020 2020 2020  n False..       
-000483e0: 2069 6620 7365 6c66 2e69 6d61 6765 2021   if self.image !
-000483f0: 3d20 6f74 6865 722e 696d 6167 653a 0d0a  = other.image:..
-00048400: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00048410: 726e 2046 616c 7365 0d0a 2020 2020 2020  rn False..      
-00048420: 2020 6966 2073 656c 662e 7669 6577 626f    if self.viewbo
-00048430: 7820 213d 206f 7468 6572 2e76 6965 7762  x != other.viewb
-00048440: 6f78 3a0d 0a20 2020 2020 2020 2020 2020  ox:..           
-00048450: 2072 6574 7572 6e20 4661 6c73 650d 0a20   return False.. 
-00048460: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-00048470: 6c66 2e70 7265 7365 7276 655f 6173 7065  lf.preserve_aspe
-00048480: 6374 5f72 6174 696f 203d 3d20 6f74 6865  ct_ratio == othe
-00048490: 722e 7072 6573 6572 7665 5f61 7370 6563  r.preserve_aspec
-000484a0: 745f 7261 7469 6f0d 0a0d 0a20 2020 2064  t_ratio....    d
-000484b0: 6566 205f 5f6e 655f 5f28 7365 6c66 2c20  ef __ne__(self, 
-000484c0: 6f74 6865 7229 3a0d 0a20 2020 2020 2020  other):..       
-000484d0: 2069 6620 6e6f 7420 6973 696e 7374 616e   if not isinstan
-000484e0: 6365 286f 7468 6572 2c20 496d 6167 6529  ce(other, Image)
-000484f0: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
-00048500: 6574 7572 6e20 4e6f 7449 6d70 6c65 6d65  eturn NotImpleme
-00048510: 6e74 6564 0d0a 2020 2020 2020 2020 7265  nted..        re
-00048520: 7475 726e 206e 6f74 2073 656c 6620 3d3d  turn not self ==
-00048530: 206f 7468 6572 0d0a 0d0a 2020 2020 6465   other....    de
-00048540: 6620 7072 6f70 6572 7479 5f62 795f 6f62  f property_by_ob
-00048550: 6a65 6374 2873 656c 662c 2073 293a 0d0a  ject(self, s):..
-00048560: 2020 2020 2020 2020 5356 4745 6c65 6d65          SVGEleme
-00048570: 6e74 2e70 726f 7065 7274 795f 6279 5f6f  nt.property_by_o
-00048580: 626a 6563 7428 7365 6c66 2c20 7329 0d0a  bject(self, s)..
-00048590: 2020 2020 2020 2020 5472 616e 7366 6f72          Transfor
-000485a0: 6d61 626c 652e 7072 6f70 6572 7479 5f62  mable.property_b
-000485b0: 795f 6f62 6a65 6374 2873 656c 662c 2073  y_object(self, s
-000485c0: 290d 0a20 2020 2020 2020 2047 7261 7068  )..        Graph
-000485d0: 6963 4f62 6a65 6374 2e70 726f 7065 7274  icObject.propert
-000485e0: 795f 6279 5f6f 626a 6563 7428 7365 6c66  y_by_object(self
-000485f0: 2c20 7329 0d0a 2020 2020 2020 2020 7365  , s)..        se
-00048600: 6c66 2e75 726c 203d 2073 2e75 726c 0d0a  lf.url = s.url..
-00048610: 2020 2020 2020 2020 7365 6c66 2e64 6174          self.dat
-00048620: 6120 3d20 732e 6461 7461 0d0a 2020 2020  a = s.data..    
-00048630: 2020 2020 7365 6c66 2e76 6965 7762 6f78      self.viewbox
-00048640: 203d 2073 2e76 6965 7762 6f78 0d0a 2020   = s.viewbox..  
-00048650: 2020 2020 2020 7365 6c66 2e70 7265 7365        self.prese
-00048660: 7276 655f 6173 7065 6374 5f72 6174 696f  rve_aspect_ratio
-00048670: 203d 2073 2e70 7265 7365 7276 655f 6173   = s.preserve_as
-00048680: 7065 6374 5f72 6174 696f 0d0a 0d0a 2020  pect_ratio....  
-00048690: 2020 2020 2020 7365 6c66 2e78 203d 2073        self.x = s
-000486a0: 2e78 0d0a 2020 2020 2020 2020 7365 6c66  .x..        self
-000486b0: 2e79 203d 2073 2e79 0d0a 2020 2020 2020  .y = s.y..      
-000486c0: 2020 7365 6c66 2e77 6964 7468 203d 2073    self.width = s
-000486d0: 2e77 6964 7468 0d0a 2020 2020 2020 2020  .width..        
-000486e0: 7365 6c66 2e68 6569 6768 7420 3d20 732e  self.height = s.
-000486f0: 6865 6967 6874 0d0a 0d0a 2020 2020 2020  height....      
-00048700: 2020 7365 6c66 2e69 6d61 6765 203d 2073    self.image = s
-00048710: 2e69 6d61 6765 0d0a 2020 2020 2020 2020  .image..        
-00048720: 7365 6c66 2e69 6d61 6765 5f77 6964 7468  self.image_width
-00048730: 203d 2073 2e69 6d61 6765 5f77 6964 7468   = s.image_width
-00048740: 0d0a 2020 2020 2020 2020 7365 6c66 2e69  ..        self.i
-00048750: 6d61 6765 5f68 6569 6768 7420 3d20 732e  mage_height = s.
-00048760: 696d 6167 655f 6865 6967 6874 0d0a 0d0a  image_height....
-00048770: 2020 2020 6465 6620 7072 6f70 6572 7479      def property
-00048780: 5f62 795f 7661 6c75 6573 2873 656c 662c  _by_values(self,
-00048790: 2076 616c 7565 7329 3a0d 0a20 2020 2020   values):..     
-000487a0: 2020 2053 5647 456c 656d 656e 742e 7072     SVGElement.pr
-000487b0: 6f70 6572 7479 5f62 795f 7661 6c75 6573  operty_by_values
-000487c0: 2873 656c 662c 2076 616c 7565 7329 0d0a  (self, values)..
-000487d0: 2020 2020 2020 2020 5472 616e 7366 6f72          Transfor
-000487e0: 6d61 626c 652e 7072 6f70 6572 7479 5f62  mable.property_b
-000487f0: 795f 7661 6c75 6573 2873 656c 662c 2076  y_values(self, v
-00048800: 616c 7565 7329 0d0a 2020 2020 2020 2020  alues)..        
-00048810: 4772 6170 6869 634f 626a 6563 742e 7072  GraphicObject.pr
-00048820: 6f70 6572 7479 5f62 795f 7661 6c75 6573  operty_by_values
-00048830: 2873 656c 662c 2076 616c 7565 7329 0d0a  (self, values)..
-00048840: 2020 2020 2020 2020 6966 2058 4c49 4e4b          if XLINK
-00048850: 5f48 5245 4620 696e 2076 616c 7565 733a  _HREF in values:
-00048860: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00048870: 6c66 2e75 726c 203d 2076 616c 7565 735b  lf.url = values[
-00048880: 584c 494e 4b5f 4852 4546 5d0d 0a20 2020  XLINK_HREF]..   
-00048890: 2020 2020 2065 6c69 6620 5356 475f 4852       elif SVG_HR
-000488a0: 4546 2069 6e20 7661 6c75 6573 3a0d 0a20  EF in values:.. 
-000488b0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000488c0: 7572 6c20 3d20 7661 6c75 6573 5b53 5647  url = values[SVG
-000488d0: 5f48 5245 465d 0d0a 2020 2020 2020 2020  _HREF]..        
-000488e0: 7669 6577 626f 7820 3d20 7661 6c75 6573  viewbox = values
-000488f0: 2e67 6574 2853 5647 5f41 5454 525f 5649  .get(SVG_ATTR_VI
-00048900: 4557 424f 5829 0d0a 2020 2020 2020 2020  EWBOX)..        
-00048910: 6966 2076 6965 7762 6f78 2069 7320 6e6f  if viewbox is no
-00048920: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
-00048930: 2020 2020 2073 656c 662e 7669 6577 626f       self.viewbo
-00048940: 7820 3d20 5669 6577 626f 7828 7669 6577  x = Viewbox(view
-00048950: 626f 7829 0d0a 2020 2020 2020 2020 6966  box)..        if
-00048960: 2053 5647 5f41 5454 525f 5052 4553 4552   SVG_ATTR_PRESER
-00048970: 5645 4153 5045 4354 5241 5449 4f20 696e  VEASPECTRATIO in
-00048980: 2076 616c 7565 733a 0d0a 2020 2020 2020   values:..      
-00048990: 2020 2020 2020 7365 6c66 2e70 7265 7365        self.prese
-000489a0: 7276 655f 6173 7065 6374 5f72 6174 696f  rve_aspect_ratio
-000489b0: 203d 2076 616c 7565 735b 5356 475f 4154   = values[SVG_AT
-000489c0: 5452 5f50 5245 5345 5256 4541 5350 4543  TR_PRESERVEASPEC
-000489d0: 5452 4154 494f 5d0d 0a20 2020 2020 2020  TRATIO]..       
-000489e0: 2073 656c 662e 7820 3d20 4c65 6e67 7468   self.x = Length
-000489f0: 2876 616c 7565 732e 6765 7428 5356 475f  (values.get(SVG_
-00048a00: 4154 5452 5f58 2c20 3029 292e 7661 6c75  ATTR_X, 0)).valu
-00048a10: 6528 290d 0a20 2020 2020 2020 2073 656c  e()..        sel
-00048a20: 662e 7920 3d20 4c65 6e67 7468 2876 616c  f.y = Length(val
-00048a30: 7565 732e 6765 7428 5356 475f 4154 5452  ues.get(SVG_ATTR
-00048a40: 5f59 2c20 3029 292e 7661 6c75 6528 290d  _Y, 0)).value().
-00048a50: 0a20 2020 2020 2020 2073 656c 662e 7769  .        self.wi
-00048a60: 6474 6820 3d20 4c65 6e67 7468 2876 616c  dth = Length(val
-00048a70: 7565 732e 6765 7428 5356 475f 4154 5452  ues.get(SVG_ATTR
-00048a80: 5f57 4944 5448 2c20 2231 3030 2522 2929  _WIDTH, "100%"))
-00048a90: 2e76 616c 7565 2829 0d0a 2020 2020 2020  .value()..      
-00048aa0: 2020 7365 6c66 2e68 6569 6768 7420 3d20    self.height = 
-00048ab0: 4c65 6e67 7468 2876 616c 7565 732e 6765  Length(values.ge
-00048ac0: 7428 5356 475f 4154 5452 5f48 4549 4748  t(SVG_ATTR_HEIGH
-00048ad0: 542c 2022 3130 3025 2229 292e 7661 6c75  T, "100%")).valu
-00048ae0: 6528 290d 0a20 2020 2020 2020 2069 6620  e()..        if 
-00048af0: 2269 6d61 6765 2220 696e 2076 616c 7565  "image" in value
-00048b00: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
-00048b10: 7365 6c66 2e69 6d61 6765 203d 2076 616c  self.image = val
-00048b20: 7565 735b 2269 6d61 6765 225d 0d0a 2020  ues["image"]..  
-00048b30: 2020 2020 2020 2020 2020 7365 6c66 2e69            self.i
-00048b40: 6d61 6765 5f77 6964 7468 2c20 7365 6c66  mage_width, self
-00048b50: 2e69 6d61 6765 5f68 6569 6768 7420 3d20  .image_height = 
-00048b60: 7365 6c66 2e69 6d61 6765 2e73 697a 650d  self.image.size.
-00048b70: 0a0d 0a20 2020 2064 6566 2072 656e 6465  ...    def rende
-00048b80: 7228 7365 6c66 2c20 2a2a 6b77 6172 6773  r(self, **kwargs
-00048b90: 293a 0d0a 2020 2020 2020 2020 4772 6170  ):..        Grap
-00048ba0: 6869 634f 626a 6563 742e 7265 6e64 6572  hicObject.render
-00048bb0: 2873 656c 662c 202a 2a6b 7761 7267 7329  (self, **kwargs)
-00048bc0: 0d0a 2020 2020 2020 2020 5472 616e 7366  ..        Transf
-00048bd0: 6f72 6d61 626c 652e 7265 6e64 6572 2873  ormable.render(s
-00048be0: 656c 662c 202a 2a6b 7761 7267 7329 0d0a  elf, **kwargs)..
-00048bf0: 2020 2020 2020 2020 5356 4745 6c65 6d65          SVGEleme
-00048c00: 6e74 2e72 656e 6465 7228 7365 6c66 2c20  nt.render(self, 
-00048c10: 2a2a 6b77 6172 6773 290d 0a20 2020 2020  **kwargs)..     
-00048c20: 2020 2077 6964 7468 203d 206b 7761 7267     width = kwarg
-00048c30: 732e 6765 7428 2277 6964 7468 222c 206b  s.get("width", k
-00048c40: 7761 7267 732e 6765 7428 2272 656c 6174  wargs.get("relat
-00048c50: 6976 655f 6c65 6e67 7468 2229 290d 0a20  ive_length")).. 
-00048c60: 2020 2020 2020 2068 6569 6768 7420 3d20         height = 
-00048c70: 6b77 6172 6773 2e67 6574 2822 6865 6967  kwargs.get("heig
-00048c80: 6874 222c 206b 7761 7267 732e 6765 7428  ht", kwargs.get(
-00048c90: 2272 656c 6174 6976 655f 6c65 6e67 7468  "relative_length
-00048ca0: 2229 290d 0a20 2020 2020 2020 2074 7279  "))..        try
-00048cb0: 3a0d 0a20 2020 2020 2020 2020 2020 2064  :..            d
-00048cc0: 656c 206b 7761 7267 735b 2272 656c 6174  el kwargs["relat
-00048cd0: 6976 655f 6c65 6e67 7468 225d 0d0a 2020  ive_length"]..  
-00048ce0: 2020 2020 2020 6578 6365 7074 204b 6579        except Key
-00048cf0: 4572 726f 723a 0d0a 2020 2020 2020 2020  Error:..        
-00048d00: 2020 2020 7061 7373 0d0a 2020 2020 2020      pass..      
-00048d10: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-00048d20: 7365 6c66 2e78 2c20 4c65 6e67 7468 293a  self.x, Length):
-00048d30: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00048d40: 6c66 2e78 203d 2073 656c 662e 782e 7661  lf.x = self.x.va
-00048d50: 6c75 6528 7265 6c61 7469 7665 5f6c 656e  lue(relative_len
-00048d60: 6774 683d 7769 6474 682c 202a 2a6b 7761  gth=width, **kwa
-00048d70: 7267 7329 0d0a 2020 2020 2020 2020 6966  rgs)..        if
-00048d80: 2069 7369 6e73 7461 6e63 6528 7365 6c66   isinstance(self
-00048d90: 2e79 2c20 4c65 6e67 7468 293a 0d0a 2020  .y, Length):..  
-00048da0: 2020 2020 2020 2020 2020 7365 6c66 2e79            self.y
-00048db0: 203d 2073 656c 662e 792e 7661 6c75 6528   = self.y.value(
-00048dc0: 7265 6c61 7469 7665 5f6c 656e 6774 683d  relative_length=
-00048dd0: 6865 6967 6874 2c20 2a2a 6b77 6172 6773  height, **kwargs
-00048de0: 290d 0a20 2020 2020 2020 2069 6620 6973  )..        if is
-00048df0: 696e 7374 616e 6365 2873 656c 662e 7769  instance(self.wi
-00048e00: 6474 682c 204c 656e 6774 6829 3a0d 0a20  dth, Length):.. 
-00048e10: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00048e20: 7769 6474 6820 3d20 7365 6c66 2e77 6964  width = self.wid
-00048e30: 7468 2e76 616c 7565 2872 656c 6174 6976  th.value(relativ
-00048e40: 655f 6c65 6e67 7468 3d77 6964 7468 2c20  e_length=width, 
-00048e50: 2a2a 6b77 6172 6773 290d 0a20 2020 2020  **kwargs)..     
-00048e60: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-00048e70: 2873 656c 662e 6865 6967 6874 2c20 4c65  (self.height, Le
-00048e80: 6e67 7468 293a 0d0a 2020 2020 2020 2020  ngth):..        
-00048e90: 2020 2020 7365 6c66 2e68 6569 6768 7420      self.height 
-00048ea0: 3d20 7365 6c66 2e68 6569 6768 742e 7661  = self.height.va
-00048eb0: 6c75 6528 7265 6c61 7469 7665 5f6c 656e  lue(relative_len
-00048ec0: 6774 683d 6865 6967 6874 2c20 2a2a 6b77  gth=height, **kw
-00048ed0: 6172 6773 290d 0a20 2020 2020 2020 2072  args)..        r
-00048ee0: 6574 7572 6e20 7365 6c66 0d0a 0d0a 2020  eturn self....  
-00048ef0: 2020 6465 6620 5f5f 636f 7079 5f5f 2873    def __copy__(s
-00048f00: 656c 6629 3a0d 0a20 2020 2020 2020 2022  elf):..        "
-00048f10: 2222 0d0a 2020 2020 2020 2020 436f 7079  ""..        Copy
-00048f20: 206f 6620 496d 6167 652e 2054 6869 7320   of Image. This 
-00048f30: 7769 6c6c 206e 6f74 2063 6f70 7920 7468  will not copy th
-00048f40: 6520 2e69 6d61 6765 2073 7562 6f62 6a65  e .image subobje
-00048f50: 6374 2069 6e20 6120 6465 6570 206d 616e  ct in a deep man
-00048f60: 6e65 720d 0a20 2020 2020 2020 2073 696e  ner..        sin
-00048f70: 6365 2069 7427 7320 6f70 7469 6f6e 616c  ce it's optional
-00048f80: 2074 6861 7420 7468 6174 206f 626a 6563   that that objec
-00048f90: 7420 7769 6c6c 2065 7869 7374 206f 7220  t will exist or 
-00048fa0: 6e6f 742e 2041 7320 7375 6368 2069 6620  not. As such if 
-00048fb0: 7573 696e 6720 5049 4c20 6974 2077 6f75  using PIL it wou
-00048fc0: 6c64 0d0a 2020 2020 2020 2020 6265 2072  ld..        be r
-00048fd0: 6571 7569 7265 6420 746f 2065 6974 6865  equired to eithe
-00048fe0: 7220 7361 7920 7365 6c66 2e69 6d61 6765  r say self.image
-00048ff0: 203d 2073 656c 662e 696d 6167 652e 636f   = self.image.co
-00049000: 7079 2829 206f 7220 6361 6c6c 202e 6c6f  py() or call .lo
-00049010: 6164 2829 2061 6761 696e 2e0d 0a20 2020  ad() again...   
-00049020: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
-00049030: 2020 7265 7475 726e 2049 6d61 6765 2873    return Image(s
-00049040: 656c 6629 0d0a 0d0a 2020 2020 4070 726f  elf)....    @pro
-00049050: 7065 7274 790d 0a20 2020 2064 6566 2076  perty..    def v
-00049060: 6965 7762 6f78 5f74 7261 6e73 666f 726d  iewbox_transform
-00049070: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
-00049080: 2069 6620 7365 6c66 2e76 6965 7762 6f78   if self.viewbox
-00049090: 2069 7320 4e6f 6e65 3a0d 0a20 2020 2020   is None:..     
-000490a0: 2020 2020 2020 2072 6574 7572 6e20 2222         return ""
-000490b0: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-000490c0: 2073 656c 662e 7669 6577 626f 782e 7472   self.viewbox.tr
-000490d0: 616e 7366 6f72 6d28 7365 6c66 290d 0a0d  ansform(self)...
-000490e0: 0a20 2020 2064 6566 206c 6f61 6428 7365  .    def load(se
-000490f0: 6c66 2c20 6469 7265 6374 6f72 793d 4e6f  lf, directory=No
-00049100: 6e65 293a 0d0a 2020 2020 2020 2020 7472  ne):..        tr
-00049110: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
-00049120: 6672 6f6d 2050 494c 2069 6d70 6f72 7420  from PIL import 
-00049130: 496d 6167 6520 6173 2050 494c 496d 6167  Image as PILImag
-00049140: 650d 0a0d 0a20 2020 2020 2020 2020 2020  e....           
-00049150: 2069 6620 7365 6c66 2e64 6174 6120 6973   if self.data is
-00049160: 206e 6f74 204e 6f6e 653a 0d0a 2020 2020   not None:..    
-00049170: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00049180: 2e6c 6f61 645f 6461 7461 2829 0d0a 2020  .load_data()..  
-00049190: 2020 2020 2020 2020 2020 656c 6966 2073            elif s
-000491a0: 656c 662e 7572 6c20 6973 206e 6f74 204e  elf.url is not N
-000491b0: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
-000491c0: 2020 2020 2020 7365 6c66 2e6c 6f61 645f        self.load_
-000491d0: 6669 6c65 2864 6972 6563 746f 7279 290d  file(directory).
-000491e0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-000491f0: 662e 7365 745f 7661 6c75 6573 5f62 795f  f.set_values_by_
-00049200: 696d 6167 6528 290d 0a20 2020 2020 2020  image()..       
-00049210: 2065 7863 6570 7420 496d 706f 7274 4572   except ImportEr
-00049220: 726f 723a 0d0a 2020 2020 2020 2020 2020  ror:..          
-00049230: 2020 7061 7373 0d0a 0d0a 2020 2020 6465    pass....    de
-00049240: 6620 6c6f 6164 5f64 6174 6128 7365 6c66  f load_data(self
-00049250: 293a 0d0a 2020 2020 2020 2020 7472 793a  ):..        try:
-00049260: 0d0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-00049270: 5468 6973 2063 6f64 6520 7769 6c6c 206e  This code will n
-00049280: 6f74 2061 6374 6976 6174 6520 7769 7468  ot activate with
-00049290: 6f75 7420 5049 4c2f 5069 6c6c 6f77 2069  out PIL/Pillow i
-000492a0: 6e73 7461 6c6c 6564 2e0d 0a20 2020 2020  nstalled...     
-000492b0: 2020 2020 2020 2066 726f 6d20 5049 4c20         from PIL 
-000492c0: 696d 706f 7274 2049 6d61 6765 2061 7320  import Image as 
-000492d0: 5049 4c49 6d61 6765 0d0a 0d0a 2020 2020  PILImage....    
-000492e0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-000492f0: 6461 7461 2069 7320 6e6f 7420 4e6f 6e65  data is not None
-00049300: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00049310: 2020 2066 726f 6d20 696f 2069 6d70 6f72     from io impor
-00049320: 7420 4279 7465 7349 4f0d 0a0d 0a20 2020  t BytesIO....   
-00049330: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00049340: 662e 696d 6167 6520 3d20 5049 4c49 6d61  f.image = PILIma
-00049350: 6765 2e6f 7065 6e28 4279 7465 7349 4f28  ge.open(BytesIO(
-00049360: 7365 6c66 2e64 6174 6129 290d 0a20 2020  self.data))..   
-00049370: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
-00049380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049390: 7265 7475 726e 0d0a 2020 2020 2020 2020  return..        
-000493a0: 6578 6365 7074 2049 6d70 6f72 7445 7272  except ImportErr
-000493b0: 6f72 3a0d 0a20 2020 2020 2020 2020 2020  or:..           
-000493c0: 2023 2050 494c 2f50 696c 6c6f 7720 6e6f   # PIL/Pillow no
-000493d0: 7420 666f 756e 642c 2064 6563 6f64 696e  t found, decodin
-000493e0: 6720 6461 7461 2069 7320 6d6f 7374 2077  g data is most w
-000493f0: 6520 6361 6e20 646f 2e0d 0a20 2020 2020  e can do...     
-00049400: 2020 2020 2020 2070 6173 730d 0a0d 0a20         pass.... 
-00049410: 2020 2064 6566 206c 6f61 645f 6669 6c65     def load_file
-00049420: 2873 656c 662c 2064 6972 6563 746f 7279  (self, directory
-00049430: 293a 0d0a 2020 2020 2020 2020 7472 793a  ):..        try:
-00049440: 0d0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-00049450: 5468 6973 2063 6f64 6520 7769 6c6c 206e  This code will n
-00049460: 6f74 2061 6374 6976 6174 6520 7769 7468  ot activate with
-00049470: 6f75 7420 5049 4c2f 5069 6c6c 6f77 2069  out PIL/Pillow i
-00049480: 6e73 7461 6c6c 6564 2e0d 0a20 2020 2020  nstalled...     
-00049490: 2020 2020 2020 2066 726f 6d20 5049 4c20         from PIL 
-000494a0: 696d 706f 7274 2049 6d61 6765 2061 7320  import Image as 
-000494b0: 5049 4c49 6d61 6765 0d0a 0d0a 2020 2020  PILImage....    
-000494c0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-000494d0: 7572 6c20 6973 206e 6f74 204e 6f6e 653a  url is not None:
-000494e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000494f0: 2020 7472 793a 0d0a 2020 2020 2020 2020    try:..        
-00049500: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00049510: 2e69 6d61 6765 203d 2050 494c 496d 6167  .image = PILImag
-00049520: 652e 6f70 656e 2873 656c 662e 7572 6c29  e.open(self.url)
-00049530: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00049540: 2020 6578 6365 7074 2049 4f45 7272 6f72    except IOError
-00049550: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00049560: 2020 2020 2020 2074 7279 3a0d 0a20 2020         try:..   
-00049570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049580: 2020 2020 2069 6620 6469 7265 6374 6f72       if director
-00049590: 7920 6973 206e 6f74 204e 6f6e 653a 0d0a  y is not None:..
-000495a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000495b0: 2020 2020 2020 2020 2020 2020 6672 6f6d              from
-000495c0: 206f 732e 7061 7468 2069 6d70 6f72 7420   os.path import 
-000495d0: 6a6f 696e 0d0a 0d0a 2020 2020 2020 2020  join....        
-000495e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000495f0: 2020 2020 7265 6c70 6174 6820 3d20 6a6f      relpath = jo
-00049600: 696e 2864 6972 6563 746f 7279 2c20 7365  in(directory, se
-00049610: 6c66 2e75 726c 290d 0a20 2020 2020 2020  lf.url)..       
-00049620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049630: 2020 2020 2073 656c 662e 696d 6167 6520       self.image 
-00049640: 3d20 5049 4c49 6d61 6765 2e6f 7065 6e28  = PILImage.open(
-00049650: 7265 6c70 6174 6829 0d0a 2020 2020 2020  relpath)..      
-00049660: 2020 2020 2020 2020 2020 2020 2020 6578                ex
-00049670: 6365 7074 2049 4f45 7272 6f72 3a0d 0a20  cept IOError:.. 
-00049680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049690: 2020 2020 2020 2072 6574 7572 6e0d 0a20         return.. 
-000496a0: 2020 2020 2020 2065 7863 6570 7420 496d         except Im
-000496b0: 706f 7274 4572 726f 723a 0d0a 2020 2020  portError:..    
-000496c0: 2020 2020 2020 2020 2320 5049 4c2f 5069          # PIL/Pi
-000496d0: 6c6c 6f77 206e 6f74 2066 6f75 6e64 2c20  llow not found, 
-000496e0: 6465 636f 6469 6e67 2064 6174 6120 6973  decoding data is
-000496f0: 206d 6f73 7420 7765 2063 616e 2064 6f2e   most we can do.
-00049700: 0d0a 2020 2020 2020 2020 2020 2020 7061  ..            pa
-00049710: 7373 0d0a 0d0a 2020 2020 6465 6620 7365  ss....    def se
-00049720: 745f 7661 6c75 6573 5f62 795f 696d 6167  t_values_by_imag
-00049730: 6528 7365 6c66 293a 0d0a 2020 2020 2020  e(self):..      
-00049740: 2020 6966 2073 656c 662e 696d 6167 6520    if self.image 
-00049750: 6973 204e 6f6e 653a 0d0a 2020 2020 2020  is None:..      
-00049760: 2020 2020 2020 7265 7475 726e 2020 2320        return  # 
-00049770: 4e6f 2069 6d61 6765 2074 6f20 7365 7420  No image to set 
-00049780: 7661 6c75 6573 2062 792e 0d0a 2020 2020  values by...    
-00049790: 2020 2020 7365 6c66 2e69 6d61 6765 5f77      self.image_w
-000497a0: 6964 7468 203d 2073 656c 662e 696d 6167  idth = self.imag
-000497b0: 652e 7769 6474 680d 0a20 2020 2020 2020  e.width..       
-000497c0: 2073 656c 662e 696d 6167 655f 6865 6967   self.image_heig
-000497d0: 6874 203d 2073 656c 662e 696d 6167 652e  ht = self.image.
-000497e0: 6865 6967 6874 0d0a 2020 2020 2020 2020  height..        
-000497f0: 7365 6c66 2e76 6965 7762 6f78 203d 2056  self.viewbox = V
-00049800: 6965 7762 6f78 280d 0a20 2020 2020 2020  iewbox(..       
-00049810: 2020 2020 2022 3020 3020 2564 2025 6422       "0 0 %d %d"
-00049820: 2025 2028 7365 6c66 2e69 6d61 6765 5f77   % (self.image_w
-00049830: 6964 7468 2c20 7365 6c66 2e69 6d61 6765  idth, self.image
-00049840: 5f68 6569 6768 7429 2c0d 0a20 2020 2020  _height),..     
-00049850: 2020 2020 2020 2073 656c 662e 7072 6573         self.pres
-00049860: 6572 7665 5f61 7370 6563 745f 7261 7469  erve_aspect_rati
-00049870: 6f2c 0d0a 2020 2020 2020 2020 290d 0a20  o,..        ).. 
-00049880: 2020 2020 2020 2073 656c 662e 7265 6e64         self.rend
-00049890: 6572 2877 6964 7468 3d73 656c 662e 696d  er(width=self.im
-000498a0: 6167 655f 7769 6474 682c 2068 6569 6768  age_width, heigh
-000498b0: 743d 7365 6c66 2e69 6d61 6765 5f68 6569  t=self.image_hei
-000498c0: 6768 7429 0d0a 2020 2020 2020 2020 7365  ght)..        se
-000498d0: 6c66 2e74 7261 6e73 666f 726d 203d 204d  lf.transform = M
-000498e0: 6174 7269 7828 7365 6c66 2e76 6965 7762  atrix(self.viewb
-000498f0: 6f78 5f74 7261 6e73 666f 726d 2920 2a20  ox_transform) * 
-00049900: 7365 6c66 2e74 7261 6e73 666f 726d 0d0a  self.transform..
-00049910: 0d0a 2020 2020 6465 6620 6262 6f78 2873  ..    def bbox(s
-00049920: 656c 662c 2074 7261 6e73 666f 726d 6564  elf, transformed
-00049930: 3d54 7275 652c 2077 6974 685f 7374 726f  =True, with_stro
-00049940: 6b65 3d46 616c 7365 293a 0d0a 2020 2020  ke=False):..    
-00049950: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
-00049960: 2047 6574 2074 6865 2062 6f75 6e64 696e   Get the boundin
-00049970: 6720 626f 7820 666f 7220 7468 6520 6769  g box for the gi
-00049980: 7665 6e20 696d 6167 6520 6f62 6a65 6374  ven image object
-00049990: 0d0a 0d0a 2020 2020 2020 2020 3a70 6172  ....        :par
-000499a0: 616d 2074 7261 6e73 666f 726d 6564 3a20  am transformed: 
-000499b0: 7768 6574 6865 7220 7468 6973 2069 7320  whether this is 
-000499c0: 7468 6520 7472 616e 7366 6f72 6d65 6420  the transformed 
-000499d0: 626f 756e 6473 206f 7220 6465 6661 756c  bounds or defaul
-000499e0: 742e 0d0a 2020 2020 2020 2020 3a70 6172  t...        :par
-000499f0: 616d 2077 6974 685f 7374 726f 6b65 3a20  am with_stroke: 
-00049a00: 5468 6572 6520 6973 206e 6f20 7374 726f  There is no stro
-00049a10: 6b65 2066 6f72 2061 6e20 696d 6167 6520  ke for an image 
-00049a20: 736f 2077 6974 685f 7374 726f 6b65 2069  so with_stroke i
-00049a30: 7320 6967 6e6f 7265 640d 0a20 2020 2020  s ignored..     
-00049a40: 2020 203a 7265 7475 726e 3a20 626f 756e     :return: boun
-00049a50: 6469 6e67 2062 6f78 206f 6620 7468 6520  ding box of the 
-00049a60: 6769 7665 6e20 656c 656d 656e 740d 0a20  given element.. 
-00049a70: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
-00049a80: 2020 2020 6966 2073 656c 662e 696d 6167      if self.imag
-00049a90: 655f 7769 6474 6820 6973 204e 6f6e 6520  e_width is None 
-00049aa0: 6f72 2073 656c 662e 696d 6167 655f 6865  or self.image_he
-00049ab0: 6967 6874 2069 7320 4e6f 6e65 3a0d 0a20  ight is None:.. 
-00049ac0: 2020 2020 2020 2020 2020 2070 203d 2050             p = P
-00049ad0: 6f69 6e74 2830 2c20 3029 0d0a 2020 2020  oint(0, 0)..    
-00049ae0: 2020 2020 2020 2020 7020 2a3d 2073 656c          p *= sel
-00049af0: 662e 7472 616e 7366 6f72 6d0d 0a20 2020  f.transform..   
-00049b00: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00049b10: 702e 782c 2070 2e79 2c20 702e 782c 2070  p.x, p.y, p.x, p
-00049b20: 2e79 0d0a 2020 2020 2020 2020 7769 6474  .y..        widt
-00049b30: 6820 3d20 7365 6c66 2e69 6d61 6765 5f77  h = self.image_w
-00049b40: 6964 7468 0d0a 2020 2020 2020 2020 6865  idth..        he
-00049b50: 6967 6874 203d 2073 656c 662e 696d 6167  ight = self.imag
-00049b60: 655f 6865 6967 6874 0d0a 0d0a 2020 2020  e_height....    
-00049b70: 2020 2020 6966 2074 7261 6e73 666f 726d      if transform
-00049b80: 6564 3a0d 0a20 2020 2020 2020 2020 2020  ed:..           
-00049b90: 2070 203d 2028 0d0a 2020 2020 2020 2020   p = (..        
-00049ba0: 2020 2020 2020 2020 506f 696e 7428 302c          Point(0,
-00049bb0: 2030 2920 2a20 7365 6c66 2e74 7261 6e73   0) * self.trans
-00049bc0: 666f 726d 2c0d 0a20 2020 2020 2020 2020  form,..         
-00049bd0: 2020 2020 2020 2050 6f69 6e74 2877 6964         Point(wid
-00049be0: 7468 2c20 3029 202a 2073 656c 662e 7472  th, 0) * self.tr
-00049bf0: 616e 7366 6f72 6d2c 0d0a 2020 2020 2020  ansform,..      
-00049c00: 2020 2020 2020 2020 2020 506f 696e 7428            Point(
-00049c10: 7769 6474 682c 2068 6569 6768 7429 202a  width, height) *
-00049c20: 2073 656c 662e 7472 616e 7366 6f72 6d2c   self.transform,
-00049c30: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00049c40: 2020 506f 696e 7428 302c 2068 6569 6768    Point(0, heigh
-00049c50: 7429 202a 2073 656c 662e 7472 616e 7366  t) * self.transf
-00049c60: 6f72 6d2c 0d0a 2020 2020 2020 2020 2020  orm,..          
-00049c70: 2020 290d 0a20 2020 2020 2020 2065 6c73    )..        els
-00049c80: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00049c90: 7020 3d20 2850 6f69 6e74 2830 2c20 3029  p = (Point(0, 0)
-00049ca0: 2c20 506f 696e 7428 7769 6474 682c 2030  , Point(width, 0
-00049cb0: 292c 2050 6f69 6e74 2877 6964 7468 2c20  ), Point(width, 
-00049cc0: 6865 6967 6874 292c 2050 6f69 6e74 2830  height), Point(0
-00049cd0: 2c20 6865 6967 6874 2929 0d0a 2020 2020  , height))..    
-00049ce0: 2020 2020 785f 7661 6c73 203d 206c 6973      x_vals = lis
-00049cf0: 7428 732e 7820 666f 7220 7320 696e 2070  t(s.x for s in p
-00049d00: 290d 0a20 2020 2020 2020 2079 5f76 616c  )..        y_val
-00049d10: 7320 3d20 6c69 7374 2873 2e79 2066 6f72  s = list(s.y for
-00049d20: 2073 2069 6e20 7029 0d0a 2020 2020 2020   s in p)..      
-00049d30: 2020 6d69 6e5f 7820 3d20 6d69 6e28 785f    min_x = min(x_
-00049d40: 7661 6c73 290d 0a20 2020 2020 2020 206d  vals)..        m
-00049d50: 696e 5f79 203d 206d 696e 2879 5f76 616c  in_y = min(y_val
-00049d60: 7329 0d0a 2020 2020 2020 2020 6d61 785f  s)..        max_
-00049d70: 7820 3d20 6d61 7828 785f 7661 6c73 290d  x = max(x_vals).
-00049d80: 0a20 2020 2020 2020 206d 6178 5f79 203d  .        max_y =
-00049d90: 206d 6178 2879 5f76 616c 7329 0d0a 2020   max(y_vals)..  
-00049da0: 2020 2020 2020 7265 7475 726e 206d 696e        return min
-00049db0: 5f78 2c20 6d69 6e5f 792c 206d 6178 5f78  _x, min_y, max_x
-00049dc0: 2c20 6d61 785f 790d 0a0d 0a0d 0a53 5647  , max_y......SVG
-00049dd0: 496d 6167 6520 3d20 496d 6167 650d 0a0d  Image = Image...
-00049de0: 0a0d 0a63 6c61 7373 2044 6573 6328 5356  ...class Desc(SV
-00049df0: 4745 6c65 6d65 6e74 293a 0d0a 2020 2020  GElement):..    
-00049e00: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
-00049e10: 662c 202a 6172 6773 2c20 2a2a 7661 6c75  f, *args, **valu
-00049e20: 6573 293a 0d0a 2020 2020 2020 2020 7365  es):..        se
-00049e30: 6c66 2e64 6573 6320 3d20 4e6f 6e65 0d0a  lf.desc = None..
-00049e40: 2020 2020 2020 2020 6966 2076 616c 7565          if value
-00049e50: 7320 6973 204e 6f6e 653a 0d0a 2020 2020  s is None:..    
-00049e60: 2020 2020 2020 2020 7661 6c75 6573 203d          values =
-00049e70: 2064 6963 7428 290d 0a20 2020 2020 2020   dict()..       
-00049e80: 2053 5647 456c 656d 656e 742e 5f5f 696e   SVGElement.__in
-00049e90: 6974 5f5f 2873 656c 662c 202a 6172 6773  it__(self, *args
-00049ea0: 2c20 2a2a 7661 6c75 6573 290d 0a0d 0a20  , **values).... 
-00049eb0: 2020 2064 6566 205f 5f65 715f 5f28 7365     def __eq__(se
-00049ec0: 6c66 2c20 6f74 6865 7229 3a0d 0a20 2020  lf, other):..   
-00049ed0: 2020 2020 2069 6620 6e6f 7420 6973 696e       if not isin
-00049ee0: 7374 616e 6365 286f 7468 6572 2c20 4465  stance(other, De
-00049ef0: 7363 293a 0d0a 2020 2020 2020 2020 2020  sc):..          
-00049f00: 2020 7265 7475 726e 2046 616c 7365 0d0a    return False..
-00049f10: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00049f20: 656c 662e 6465 7363 203d 3d20 6f74 6865  elf.desc == othe
-00049f30: 722e 6465 7363 0d0a 0d0a 2020 2020 6465  r.desc....    de
-00049f40: 6620 5f5f 7265 7072 5f5f 2873 656c 6629  f __repr__(self)
-00049f50: 3a0d 0a20 2020 2020 2020 2072 6574 7572  :..        retur
-00049f60: 6e20 2225 7328 2725 7327 2922 2025 2028  n "%s('%s')" % (
-00049f70: 7365 6c66 2e5f 5f63 6c61 7373 5f5f 2e5f  self.__class__._
-00049f80: 5f6e 616d 655f 5f2c 2073 656c 662e 6465  _name__, self.de
-00049f90: 7363 290d 0a0d 0a20 2020 2064 6566 2070  sc)....    def p
-00049fa0: 726f 7065 7274 795f 6279 5f61 7267 7328  roperty_by_args(
-00049fb0: 7365 6c66 2c20 2a61 7267 7329 3a0d 0a20  self, *args):.. 
-00049fc0: 2020 2020 2020 2069 6620 6c65 6e28 6172         if len(ar
-00049fd0: 6773 2920 3d3d 2031 3a0d 0a20 2020 2020  gs) == 1:..     
-00049fe0: 2020 2020 2020 2073 656c 662e 6465 7363         self.desc
-00049ff0: 203d 2061 7267 735b 305d 0d0a 0d0a 2020   = args[0]....  
-0004a000: 2020 6465 6620 7072 6f70 6572 7479 5f62    def property_b
-0004a010: 795f 6f62 6a65 6374 2873 656c 662c 206f  y_object(self, o
-0004a020: 626a 293a 0d0a 2020 2020 2020 2020 5356  bj):..        SV
-0004a030: 4745 6c65 6d65 6e74 2e70 726f 7065 7274  GElement.propert
-0004a040: 795f 6279 5f6f 626a 6563 7428 7365 6c66  y_by_object(self
-0004a050: 2c20 6f62 6a29 0d0a 2020 2020 2020 2020  , obj)..        
-0004a060: 7365 6c66 2e64 6573 6320 3d20 6f62 6a2e  self.desc = obj.
-0004a070: 6465 7363 0d0a 0d0a 2020 2020 6465 6620  desc....    def 
-0004a080: 7072 6f70 6572 7479 5f62 795f 7661 6c75  property_by_valu
-0004a090: 6573 2873 656c 662c 2076 616c 7565 7329  es(self, values)
-0004a0a0: 3a0d 0a20 2020 2020 2020 2053 5647 456c  :..        SVGEl
-0004a0b0: 656d 656e 742e 7072 6f70 6572 7479 5f62  ement.property_b
-0004a0c0: 795f 7661 6c75 6573 2873 656c 662c 2076  y_values(self, v
-0004a0d0: 616c 7565 7329 0d0a 2020 2020 2020 2020  alues)..        
-0004a0e0: 6966 2053 5647 5f54 4147 5f44 4553 4320  if SVG_TAG_DESC 
-0004a0f0: 696e 2076 616c 7565 733a 0d0a 2020 2020  in values:..    
-0004a100: 2020 2020 2020 2020 7365 6c66 2e64 6573          self.des
-0004a110: 6320 3d20 7661 6c75 6573 5b53 5647 5f54  c = values[SVG_T
-0004a120: 4147 5f44 4553 435d 0d0a 0d0a 0d0a 5356  AG_DESC]......SV
-0004a130: 4744 6573 6320 3d20 4465 7363 0d0a 0d0a  GDesc = Desc....
-0004a140: 0d0a 636c 6173 7320 5469 746c 6528 5356  ..class Title(SV
-0004a150: 4745 6c65 6d65 6e74 293a 0d0a 2020 2020  GElement):..    
-0004a160: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
-0004a170: 662c 202a 6172 6773 2c20 2a2a 7661 6c75  f, *args, **valu
-0004a180: 6573 293a 0d0a 2020 2020 2020 2020 7365  es):..        se
-0004a190: 6c66 2e74 6974 6c65 203d 204e 6f6e 650d  lf.title = None.
-0004a1a0: 0a20 2020 2020 2020 2069 6620 7661 6c75  .        if valu
-0004a1b0: 6573 2069 7320 4e6f 6e65 3a0d 0a20 2020  es is None:..   
-0004a1c0: 2020 2020 2020 2020 2076 616c 7565 7320           values 
-0004a1d0: 3d20 6469 6374 2829 0d0a 2020 2020 2020  = dict()..      
-0004a1e0: 2020 5356 4745 6c65 6d65 6e74 2e5f 5f69    SVGElement.__i
-0004a1f0: 6e69 745f 5f28 7365 6c66 2c20 2a61 7267  nit__(self, *arg
-0004a200: 732c 202a 2a76 616c 7565 7329 0d0a 0d0a  s, **values)....
-0004a210: 2020 2020 6465 6620 5f5f 6571 5f5f 2873      def __eq__(s
-0004a220: 656c 662c 206f 7468 6572 293a 0d0a 2020  elf, other):..  
-0004a230: 2020 2020 2020 6966 206e 6f74 2069 7369        if not isi
-0004a240: 6e73 7461 6e63 6528 6f74 6865 722c 2054  nstance(other, T
-0004a250: 6974 6c65 293a 0d0a 2020 2020 2020 2020  itle):..        
-0004a260: 2020 2020 7265 7475 726e 2046 616c 7365      return False
-0004a270: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-0004a280: 2073 656c 662e 7469 746c 6520 3d3d 206f   self.title == o
-0004a290: 7468 6572 2e74 6974 6c65 0d0a 0d0a 2020  ther.title....  
-0004a2a0: 2020 6465 6620 5f5f 7265 7072 5f5f 2873    def __repr__(s
-0004a2b0: 656c 6629 3a0d 0a20 2020 2020 2020 2072  elf):..        r
-0004a2c0: 6574 7572 6e20 2225 7328 2725 7327 2922  eturn "%s('%s')"
-0004a2d0: 2025 2028 7365 6c66 2e5f 5f63 6c61 7373   % (self.__class
-0004a2e0: 5f5f 2e5f 5f6e 616d 655f 5f2c 2073 656c  __.__name__, sel
-0004a2f0: 662e 7469 746c 6529 0d0a 0d0a 2020 2020  f.title)....    
-0004a300: 6465 6620 7072 6f70 6572 7479 5f62 795f  def property_by_
-0004a310: 6172 6773 2873 656c 662c 202a 6172 6773  args(self, *args
-0004a320: 293a 0d0a 2020 2020 2020 2020 6966 206c  ):..        if l
-0004a330: 656e 2861 7267 7329 203d 3d20 313a 0d0a  en(args) == 1:..
-0004a340: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0004a350: 2e74 6974 6c65 203d 2061 7267 735b 305d  .title = args[0]
-0004a360: 0d0a 0d0a 2020 2020 6465 6620 7072 6f70  ....    def prop
-0004a370: 6572 7479 5f62 795f 6f62 6a65 6374 2873  erty_by_object(s
-0004a380: 656c 662c 206f 626a 293a 0d0a 2020 2020  elf, obj):..    
-0004a390: 2020 2020 5356 4745 6c65 6d65 6e74 2e70      SVGElement.p
-0004a3a0: 726f 7065 7274 795f 6279 5f6f 626a 6563  roperty_by_objec
-0004a3b0: 7428 7365 6c66 2c20 6f62 6a29 0d0a 2020  t(self, obj)..  
-0004a3c0: 2020 2020 2020 7365 6c66 2e74 6974 6c65        self.title
-0004a3d0: 203d 206f 626a 2e74 6974 6c65 0d0a 0d0a   = obj.title....
-0004a3e0: 2020 2020 6465 6620 7072 6f70 6572 7479      def property
-0004a3f0: 5f62 795f 7661 6c75 6573 2873 656c 662c  _by_values(self,
-0004a400: 2076 616c 7565 7329 3a0d 0a20 2020 2020   values):..     
-0004a410: 2020 2053 5647 456c 656d 656e 742e 7072     SVGElement.pr
-0004a420: 6f70 6572 7479 5f62 795f 7661 6c75 6573  operty_by_values
-0004a430: 2873 656c 662c 2076 616c 7565 7329 0d0a  (self, values)..
-0004a440: 2020 2020 2020 2020 6966 2053 5647 5f54          if SVG_T
-0004a450: 4147 5f54 4954 4c45 2069 6e20 7661 6c75  AG_TITLE in valu
-0004a460: 6573 3a0d 0a20 2020 2020 2020 2020 2020  es:..           
-0004a470: 2073 656c 662e 7469 746c 6520 3d20 7661   self.title = va
-0004a480: 6c75 6573 5b53 5647 5f54 4147 5f54 4954  lues[SVG_TAG_TIT
-0004a490: 4c45 5d0d 0a0d 0a0d 0a63 6c61 7373 2053  LE]......class S
-0004a4a0: 5647 2847 726f 7570 293a 0d0a 2020 2020  VG(Group):..    
-0004a4b0: 2222 220d 0a20 2020 2053 5647 2044 6f63  """..    SVG Doc
-0004a4c0: 756d 656e 7420 616e 6420 5061 7273 696e  ument and Parsin
-0004a4d0: 672e 0d0a 0d0a 2020 2020 5356 4720 6973  g.....    SVG is
-0004a4e0: 2074 6865 2053 5647 206d 6169 6e20 6f62   the SVG main ob
-0004a4f0: 6a65 6374 2061 6e64 2061 6c73 6f20 7468  ject and also th
-0004a500: 6520 656d 6265 6464 6564 2053 5647 7320  e embedded SVGs 
-0004a510: 7769 7468 696e 2069 742e 2049 7427 7320  within it. It's 
-0004a520: 6120 7375 6274 7970 6520 6f66 2047 726f  a subtype of Gro
-0004a530: 7570 2e20 5468 6520 5356 4720 6861 7320  up. The SVG has 
-0004a540: 6120 7669 6577 626f 782c 0d0a 2020 2020  a viewbox,..    
-0004a550: 616e 6420 7061 7273 696e 6720 6d65 7468  and parsing meth
-0004a560: 6f64 7320 7768 6963 6820 6361 6e20 6265  ods which can be
-0004a570: 2075 7365 6420 6966 2067 6976 656e 2061   used if given a
-0004a580: 2073 7472 6561 6d2c 2070 6174 682c 206f   stream, path, o
-0004a590: 7220 7376 6720 7374 7269 6e67 2e0d 0a20  r svg string... 
-0004a5a0: 2020 2022 2222 0d0a 0d0a 2020 2020 6465     """....    de
-0004a5b0: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
-0004a5c0: 202a 6172 6773 2c20 2a2a 6b77 6172 6773   *args, **kwargs
-0004a5d0: 293a 0d0a 2020 2020 2020 2020 7365 6c66  ):..        self
-0004a5e0: 2e6f 626a 6563 7473 203d 207b 7d0d 0a20  .objects = {}.. 
-0004a5f0: 2020 2020 2020 2073 656c 662e 7820 3d20         self.x = 
-0004a600: 4e6f 6e65 0d0a 2020 2020 2020 2020 7365  None..        se
-0004a610: 6c66 2e79 203d 204e 6f6e 650d 0a20 2020  lf.y = None..   
-0004a620: 2020 2020 2073 656c 662e 7769 6474 6820       self.width 
-0004a630: 3d20 4e6f 6e65 0d0a 2020 2020 2020 2020  = None..        
-0004a640: 7365 6c66 2e68 6569 6768 7420 3d20 4e6f  self.height = No
-0004a650: 6e65 0d0a 2020 2020 2020 2020 7365 6c66  ne..        self
-0004a660: 2e76 6965 7762 6f78 203d 204e 6f6e 650d  .viewbox = None.
-0004a670: 0a20 2020 2020 2020 2047 726f 7570 2e5f  .        Group._
-0004a680: 5f69 6e69 745f 5f28 7365 6c66 2c20 2a61  _init__(self, *a
-0004a690: 7267 732c 202a 2a6b 7761 7267 7329 0d0a  rgs, **kwargs)..
-0004a6a0: 0d0a 2020 2020 4070 726f 7065 7274 790d  ..    @property.
-0004a6b0: 0a20 2020 2064 6566 2069 6d70 6c69 6369  .    def implici
-0004a6c0: 745f 706f 7369 7469 6f6e 2873 656c 6629  t_position(self)
-0004a6d0: 3a0d 0a20 2020 2020 2020 2069 6620 6e6f  :..        if no
-0004a6e0: 7420 7365 6c66 2e61 7070 6c79 3a0d 0a20  t self.apply:.. 
-0004a6f0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0004a700: 6e20 506f 696e 7428 7365 6c66 2e78 2c20  n Point(self.x, 
-0004a710: 7365 6c66 2e79 290d 0a20 2020 2020 2020  self.y)..       
-0004a720: 2070 6f69 6e74 203d 2050 6f69 6e74 2873   point = Point(s
-0004a730: 656c 662e 782c 2073 656c 662e 7929 0d0a  elf.x, self.y)..
-0004a740: 2020 2020 2020 2020 706f 696e 7420 2a3d          point *=
-0004a750: 2073 656c 662e 7472 616e 7366 6f72 6d0d   self.transform.
-0004a760: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0004a770: 706f 696e 740d 0a0d 0a20 2020 2040 7072  point....    @pr
-0004a780: 6f70 6572 7479 0d0a 2020 2020 6465 6620  operty..    def 
-0004a790: 696d 706c 6963 6974 5f78 2873 656c 6629  implicit_x(self)
-0004a7a0: 3a0d 0a20 2020 2020 2020 2069 6620 6e6f  :..        if no
-0004a7b0: 7420 7365 6c66 2e61 7070 6c79 3a0d 0a20  t self.apply:.. 
-0004a7c0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0004a7d0: 6e20 7365 6c66 2e78 0d0a 2020 2020 2020  n self.x..      
-0004a7e0: 2020 7265 7475 726e 2073 656c 662e 696d    return self.im
-0004a7f0: 706c 6963 6974 5f70 6f73 6974 696f 6e5b  plicit_position[
-0004a800: 305d 0d0a 0d0a 2020 2020 4070 726f 7065  0]....    @prope
-0004a810: 7274 790d 0a20 2020 2064 6566 2069 6d70  rty..    def imp
-0004a820: 6c69 6369 745f 7928 7365 6c66 293a 0d0a  licit_y(self):..
-0004a830: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
-0004a840: 656c 662e 6170 706c 793a 0d0a 2020 2020  elf.apply:..    
-0004a850: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-0004a860: 656c 662e 790d 0a20 2020 2020 2020 2072  elf.y..        r
-0004a870: 6574 7572 6e20 7365 6c66 2e69 6d70 6c69  eturn self.impli
-0004a880: 6369 745f 706f 7369 7469 6f6e 5b31 5d0d  cit_position[1].
-0004a890: 0a0d 0a20 2020 2040 7072 6f70 6572 7479  ...    @property
-0004a8a0: 0d0a 2020 2020 6465 6620 696d 706c 6963  ..    def implic
-0004a8b0: 6974 5f77 6964 7468 2873 656c 6629 3a0d  it_width(self):.
-0004a8c0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-0004a8d0: 7365 6c66 2e61 7070 6c79 3a0d 0a20 2020  self.apply:..   
-0004a8e0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0004a8f0: 7365 6c66 2e77 6964 7468 0d0a 2020 2020  self.width..    
-0004a900: 2020 2020 7020 3d20 506f 696e 7428 7365      p = Point(se
-0004a910: 6c66 2e77 6964 7468 2c20 3029 0d0a 2020  lf.width, 0)..  
-0004a920: 2020 2020 2020 7020 2a3d 2073 656c 662e        p *= self.
-0004a930: 7472 616e 7366 6f72 6d0d 0a20 2020 2020  transform..     
-0004a940: 2020 206f 7269 6769 6e20 3d20 506f 696e     origin = Poin
-0004a950: 7428 302c 2030 290d 0a20 2020 2020 2020  t(0, 0)..       
-0004a960: 206f 7269 6769 6e20 2a3d 2073 656c 662e   origin *= self.
-0004a970: 7472 616e 7366 6f72 6d0d 0a20 2020 2020  transform..     
-0004a980: 2020 2072 6574 7572 6e20 6f72 6967 696e     return origin
-0004a990: 2e64 6973 7461 6e63 655f 746f 2870 290d  .distance_to(p).
-0004a9a0: 0a0d 0a20 2020 2040 7072 6f70 6572 7479  ...    @property
-0004a9b0: 0d0a 2020 2020 6465 6620 696d 706c 6963  ..    def implic
-0004a9c0: 6974 5f68 6569 6768 7428 7365 6c66 293a  it_height(self):
-0004a9d0: 0d0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
-0004a9e0: 2073 656c 662e 6170 706c 793a 0d0a 2020   self.apply:..  
-0004a9f0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0004aa00: 2073 656c 662e 6865 6967 6874 0d0a 2020   self.height..  
-0004aa10: 2020 2020 2020 7020 3d20 506f 696e 7428        p = Point(
-0004aa20: 302c 2073 656c 662e 6865 6967 6874 290d  0, self.height).
-0004aa30: 0a20 2020 2020 2020 2070 202a 3d20 7365  .        p *= se
-0004aa40: 6c66 2e74 7261 6e73 666f 726d 0d0a 2020  lf.transform..  
-0004aa50: 2020 2020 2020 6f72 6967 696e 203d 2050        origin = P
-0004aa60: 6f69 6e74 2830 2c20 3029 0d0a 2020 2020  oint(0, 0)..    
-0004aa70: 2020 2020 6f72 6967 696e 202a 3d20 7365      origin *= se
-0004aa80: 6c66 2e74 7261 6e73 666f 726d 0d0a 2020  lf.transform..  
-0004aa90: 2020 2020 2020 7265 7475 726e 206f 7269        return ori
-0004aaa0: 6769 6e2e 6469 7374 616e 6365 5f74 6f28  gin.distance_to(
-0004aab0: 7029 0d0a 0d0a 2020 2020 6465 6620 7072  p)....    def pr
-0004aac0: 6f70 6572 7479 5f62 795f 6f62 6a65 6374  operty_by_object
-0004aad0: 2873 656c 662c 2073 293a 0d0a 2020 2020  (self, s):..    
-0004aae0: 2020 2020 4772 6f75 702e 7072 6f70 6572      Group.proper
-0004aaf0: 7479 5f62 795f 6f62 6a65 6374 2873 656c  ty_by_object(sel
-0004ab00: 662c 2073 290d 0a20 2020 2020 2020 2073  f, s)..        s
-0004ab10: 656c 662e 7820 3d20 732e 780d 0a20 2020  elf.x = s.x..   
-0004ab20: 2020 2020 2073 656c 662e 7920 3d20 732e       self.y = s.
-0004ab30: 790d 0a20 2020 2020 2020 2073 656c 662e  y..        self.
-0004ab40: 7769 6474 6820 3d20 732e 7769 6474 680d  width = s.width.
-0004ab50: 0a20 2020 2020 2020 2073 656c 662e 6865  .        self.he
-0004ab60: 6967 6874 203d 2073 2e68 6569 6768 740d  ight = s.height.
-0004ab70: 0a20 2020 2020 2020 2073 656c 662e 7669  .        self.vi
-0004ab80: 6577 626f 7820 3d20 5669 6577 626f 7828  ewbox = Viewbox(
-0004ab90: 732e 7669 6577 626f 7829 2069 6620 732e  s.viewbox) if s.
-0004aba0: 7669 6577 626f 7820 6973 206e 6f74 204e  viewbox is not N
-0004abb0: 6f6e 6520 656c 7365 204e 6f6e 650d 0a0d  one else None...
-0004abc0: 0a20 2020 2064 6566 2070 726f 7065 7274  .    def propert
-0004abd0: 795f 6279 5f76 616c 7565 7328 7365 6c66  y_by_values(self
-0004abe0: 2c20 7661 6c75 6573 293a 0d0a 2020 2020  , values):..    
-0004abf0: 2020 2020 4772 6f75 702e 7072 6f70 6572      Group.proper
-0004ac00: 7479 5f62 795f 7661 6c75 6573 2873 656c  ty_by_values(sel
-0004ac10: 662c 2076 616c 7565 7329 0d0a 2020 2020  f, values)..    
-0004ac20: 2020 2020 7365 6c66 2e78 203d 204c 656e      self.x = Len
-0004ac30: 6774 6828 7661 6c75 6573 2e67 6574 2853  gth(values.get(S
-0004ac40: 5647 5f41 5454 525f 582c 2030 2929 2e76  VG_ATTR_X, 0)).v
-0004ac50: 616c 7565 2829 0d0a 2020 2020 2020 2020  alue()..        
-0004ac60: 7365 6c66 2e79 203d 204c 656e 6774 6828  self.y = Length(
-0004ac70: 7661 6c75 6573 2e67 6574 2853 5647 5f41  values.get(SVG_A
-0004ac80: 5454 525f 592c 2030 2929 2e76 616c 7565  TTR_Y, 0)).value
-0004ac90: 2829 0d0a 2020 2020 2020 2020 7365 6c66  ()..        self
-0004aca0: 2e77 6964 7468 203d 204c 656e 6774 6828  .width = Length(
-0004acb0: 7661 6c75 6573 2e67 6574 2853 5647 5f41  values.get(SVG_A
-0004acc0: 5454 525f 5749 4454 482c 2022 3130 3025  TTR_WIDTH, "100%
-0004acd0: 2229 292e 7661 6c75 6528 290d 0a20 2020  ")).value()..   
-0004ace0: 2020 2020 2073 656c 662e 6865 6967 6874       self.height
-0004acf0: 203d 204c 656e 6774 6828 7661 6c75 6573   = Length(values
-0004ad00: 2e67 6574 2853 5647 5f41 5454 525f 4845  .get(SVG_ATTR_HE
-0004ad10: 4947 4854 2c20 2231 3030 2522 2929 2e76  IGHT, "100%")).v
-0004ad20: 616c 7565 2829 0d0a 2020 2020 2020 2020  alue()..        
-0004ad30: 7669 6577 626f 7820 3d20 7661 6c75 6573  viewbox = values
-0004ad40: 2e67 6574 2853 5647 5f41 5454 525f 5649  .get(SVG_ATTR_VI
-0004ad50: 4557 424f 5829 0d0a 2020 2020 2020 2020  EWBOX)..        
-0004ad60: 7061 7220 3d20 7661 6c75 6573 2e67 6574  par = values.get
-0004ad70: 2853 5647 5f41 5454 525f 5052 4553 4552  (SVG_ATTR_PRESER
-0004ad80: 5645 4153 5045 4354 5241 5449 4f29 0d0a  VEASPECTRATIO)..
-0004ad90: 2020 2020 2020 2020 7365 6c66 2e76 6965          self.vie
-0004ada0: 7762 6f78 203d 2056 6965 7762 6f78 2876  wbox = Viewbox(v
-0004adb0: 6965 7762 6f78 2c20 7061 7229 2069 6620  iewbox, par) if 
-0004adc0: 7669 6577 626f 7820 6973 206e 6f74 204e  viewbox is not N
-0004add0: 6f6e 6520 656c 7365 204e 6f6e 650d 0a0d  one else None...
-0004ade0: 0a20 2020 2064 6566 2067 6574 5f65 6c65  .    def get_ele
-0004adf0: 6d65 6e74 5f62 795f 6964 2873 656c 662c  ment_by_id(self,
-0004ae00: 2069 6429 3a0d 0a20 2020 2020 2020 2072   id):..        r
-0004ae10: 6574 7572 6e20 7365 6c66 2e6f 626a 6563  eturn self.objec
-0004ae20: 7473 2e67 6574 2869 6429 0d0a 0d0a 2020  ts.get(id)....  
-0004ae30: 2020 6465 6620 6765 745f 656c 656d 656e    def get_elemen
-0004ae40: 745f 6279 5f75 726c 2873 656c 662c 2075  t_by_url(self, u
-0004ae50: 726c 293a 0d0a 2020 2020 2020 2020 666f  rl):..        fo
-0004ae60: 7220 5f69 6420 696e 2052 4547 4558 5f49  r _id in REGEX_I
-0004ae70: 5249 2e66 696e 6461 6c6c 2875 726c 293a  RI.findall(url):
-0004ae80: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
-0004ae90: 7475 726e 2073 656c 662e 6765 745f 656c  turn self.get_el
-0004aea0: 656d 656e 745f 6279 5f69 6428 5f69 6429  ement_by_id(_id)
-0004aeb0: 0d0a 0d0a 2020 2020 6465 6620 7265 6e64  ....    def rend
-0004aec0: 6572 2873 656c 662c 202a 2a6b 7761 7267  er(self, **kwarg
-0004aed0: 7329 3a0d 0a20 2020 2020 2020 2047 726f  s):..        Gro
-0004aee0: 7570 2e72 656e 6465 7228 7365 6c66 2c20  up.render(self, 
-0004aef0: 2a2a 6b77 6172 6773 290d 0a20 2020 2020  **kwargs)..     
-0004af00: 2020 2077 6964 7468 203d 206b 7761 7267     width = kwarg
-0004af10: 732e 6765 7428 2277 6964 7468 222c 206b  s.get("width", k
-0004af20: 7761 7267 732e 6765 7428 2272 656c 6174  wargs.get("relat
-0004af30: 6976 655f 6c65 6e67 7468 2229 290d 0a20  ive_length")).. 
-0004af40: 2020 2020 2020 2068 6569 6768 7420 3d20         height = 
-0004af50: 6b77 6172 6773 2e67 6574 2822 6865 6967  kwargs.get("heig
-0004af60: 6874 222c 206b 7761 7267 732e 6765 7428  ht", kwargs.get(
-0004af70: 2272 656c 6174 6976 655f 6c65 6e67 7468  "relative_length
-0004af80: 2229 290d 0a20 2020 2020 2020 2074 7279  "))..        try
-0004af90: 3a0d 0a20 2020 2020 2020 2020 2020 2064  :..            d
-0004afa0: 656c 206b 7761 7267 735b 2272 656c 6174  el kwargs["relat
-0004afb0: 6976 655f 6c65 6e67 7468 225d 0d0a 2020  ive_length"]..  
-0004afc0: 2020 2020 2020 6578 6365 7074 204b 6579        except Key
-0004afd0: 4572 726f 723a 0d0a 2020 2020 2020 2020  Error:..        
-0004afe0: 2020 2020 7061 7373 0d0a 2020 2020 2020      pass..      
-0004aff0: 2020 7365 6c66 2e77 6964 7468 203d 204c    self.width = L
-0004b000: 656e 6774 6828 7365 6c66 2e77 6964 7468  ength(self.width
-0004b010: 292e 7661 6c75 6528 7265 6c61 7469 7665  ).value(relative
-0004b020: 5f6c 656e 6774 683d 7769 6474 682c 202a  _length=width, *
-0004b030: 2a6b 7761 7267 7329 0d0a 2020 2020 2020  *kwargs)..      
-0004b040: 2020 7365 6c66 2e68 6569 6768 7420 3d20    self.height = 
-0004b050: 4c65 6e67 7468 2873 656c 662e 6865 6967  Length(self.heig
-0004b060: 6874 292e 7661 6c75 6528 7265 6c61 7469  ht).value(relati
-0004b070: 7665 5f6c 656e 6774 683d 6865 6967 6874  ve_length=height
-0004b080: 2c20 2a2a 6b77 6172 6773 290d 0a20 2020  , **kwargs)..   
-0004b090: 2020 2020 2073 656c 662e 7820 3d20 4c65       self.x = Le
-0004b0a0: 6e67 7468 2873 656c 662e 7829 2e76 616c  ngth(self.x).val
-0004b0b0: 7565 2872 656c 6174 6976 655f 6c65 6e67  ue(relative_leng
-0004b0c0: 7468 3d77 6964 7468 2c20 2a2a 6b77 6172  th=width, **kwar
-0004b0d0: 6773 290d 0a20 2020 2020 2020 2073 656c  gs)..        sel
-0004b0e0: 662e 7920 3d20 4c65 6e67 7468 2873 656c  f.y = Length(sel
-0004b0f0: 662e 7929 2e76 616c 7565 2872 656c 6174  f.y).value(relat
-0004b100: 6976 655f 6c65 6e67 7468 3d68 6569 6768  ive_length=heigh
-0004b110: 742c 202a 2a6b 7761 7267 7329 0d0a 0d0a  t, **kwargs)....
-0004b120: 2020 2020 6465 6620 656c 656d 656e 7473      def elements
-0004b130: 2873 656c 662c 2063 6f6e 6469 7469 6f6e  (self, condition
-0004b140: 616c 3d4e 6f6e 6529 3a0d 0a20 2020 2020  al=None):..     
-0004b150: 2020 2069 6620 636f 6e64 6974 696f 6e61     if conditiona
-0004b160: 6c20 6973 204e 6f6e 6520 6f72 2063 6f6e  l is None or con
-0004b170: 6469 7469 6f6e 616c 2873 656c 6629 3a0d  ditional(self):.
-0004b180: 0a20 2020 2020 2020 2020 2020 2079 6965  .            yie
-0004b190: 6c64 2073 656c 660d 0a20 2020 2020 2020  ld self..       
-0004b1a0: 2066 6f72 2071 2069 6e20 7365 6c66 2e73   for q in self.s
-0004b1b0: 656c 6563 7428 636f 6e64 6974 696f 6e61  elect(conditiona
-0004b1c0: 6c29 3a0d 0a20 2020 2020 2020 2020 2020  l):..           
-0004b1d0: 2079 6965 6c64 2071 0d0a 0d0a 2020 2020   yield q....    
-0004b1e0: 4070 726f 7065 7274 790d 0a20 2020 2064  @property..    d
-0004b1f0: 6566 2076 6965 7762 6f78 5f74 7261 6e73  ef viewbox_trans
-0004b200: 666f 726d 2873 656c 6629 3a0d 0a20 2020  form(self):..   
-0004b210: 2020 2020 2069 6620 7365 6c66 2e76 6965       if self.vie
-0004b220: 7762 6f78 2069 7320 4e6f 6e65 3a0d 0a20  wbox is None:.. 
-0004b230: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0004b240: 6e20 2222 0d0a 2020 2020 2020 2020 7265  n ""..        re
-0004b250: 7475 726e 2073 656c 662e 7669 6577 626f  turn self.viewbo
-0004b260: 782e 7472 616e 7366 6f72 6d28 7365 6c66  x.transform(self
-0004b270: 290d 0a0d 0a20 2020 2040 7374 6174 6963  )....    @static
-0004b280: 6d65 7468 6f64 0d0a 2020 2020 6465 6620  method..    def 
-0004b290: 5f75 7365 5f73 7472 7563 7475 7265 5f70  _use_structure_p
-0004b2a0: 6172 7365 2873 6f75 7263 6529 3a0d 0a20  arse(source):.. 
-0004b2b0: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
-0004b2c0: 2020 2020 5356 4720 7374 7275 6374 7572      SVG structur
-0004b2d0: 6520 7061 7373 3a20 7061 7273 6573 2074  e pass: parses t
-0004b2e0: 6865 2073 7667 2066 696c 6520 7375 6368  he svg file such
-0004b2f0: 2074 6861 7420 6974 2063 7265 6174 6573   that it creates
-0004b300: 2074 6865 2073 7472 7563 7475 7265 2069   the structure i
-0004b310: 6d70 6c69 6564 2062 7920 7265 7573 6564  mplied by reused
-0004b320: 206f 626a 6563 7473 2069 6e20 610d 0a20   objects in a.. 
-0004b330: 2020 2020 2020 2067 656e 6572 616c 697a         generaliz
-0004b340: 6564 2063 6f6e 7465 7874 2e20 4f62 6a65  ed context. Obje
-0004b350: 6374 7320 6964 7320 6172 6520 7265 6164  cts ids are read
-0004b360: 2061 6e64 2070 7574 2069 6e74 6f20 616e   and put into an
-0004b370: 2075 6e70 6172 7365 6420 7368 6164 6f77   unparsed shadow
-0004b380: 2074 7265 652e 203c 7573 653e 206f 626a   tree. <use> obj
-0004b390: 6563 7473 2073 6561 6d6c 6573 736c 7920  ects seamlessly 
-0004b3a0: 636f 6e74 6169 6e0d 0a20 2020 2020 2020  contain..       
-0004b3b0: 2074 6865 6972 2064 6566 696e 6974 696f   their definitio
-0004b3c0: 6e73 2e0d 0a20 2020 2020 2020 2022 2222  ns...        """
-0004b3d0: 0d0a 2020 2020 2020 2020 6576 656e 745f  ..        event_
-0004b3e0: 6465 6673 203d 207b 7d0d 0a20 2020 2020  defs = {}..     
-0004b3f0: 2020 2070 6172 656e 7420 3d20 4e6f 6e65     parent = None
-0004b400: 2020 2320 4465 6669 6e65 2052 6f6f 7420    # Define Root 
-0004b410: 4e6f 6465 2e0d 0a20 2020 2020 2020 2063  Node...        c
-0004b420: 6869 6c64 7265 6e20 3d20 6c69 7374 2829  hildren = list()
-0004b430: 0d0a 0d0a 2020 2020 2020 2020 2320 5072  ....        # Pr
-0004b440: 6570 726f 6365 7373 2069 7465 7270 6172  eprocess iterpar
-0004b450: 7365 2074 7265 652e 2053 746f 7265 2061  se tree. Store a
-0004b460: 6c6c 2065 7665 6e74 732e 2052 6566 6572  ll events. Refer
-0004b470: 656e 6365 2061 6c6c 2074 6167 732e 0d0a  ence all tags...
-0004b480: 2020 2020 2020 2020 666f 7220 6576 656e          for even
-0004b490: 742c 2065 6c65 6d20 696e 2069 7465 7270  t, elem in iterp
-0004b4a0: 6172 7365 2873 6f75 7263 652c 2065 7665  arse(source, eve
-0004b4b0: 6e74 733d 2822 7374 6172 7422 2c20 2265  nts=("start", "e
-0004b4c0: 6e64 222c 2022 7374 6172 742d 6e73 2229  nd", "start-ns")
-0004b4d0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-0004b4e0: 6966 2065 7665 6e74 203d 3d20 2273 7461  if event == "sta
-0004b4f0: 7274 223a 0d0a 2020 2020 2020 2020 2020  rt":..          
-0004b500: 2020 2020 2020 7369 626c 696e 6773 203d        siblings =
-0004b510: 2063 6869 6c64 7265 6e20 2023 2050 6172   children  # Par
-0004b520: 656e 7427 7320 6368 696c 6472 656e 2061  ent's children a
-0004b530: 7265 206e 6f77 206d 7920 7369 626c 696e  re now my siblin
-0004b540: 6773 2e0d 0a20 2020 2020 2020 2020 2020  gs...           
-0004b550: 2020 2020 2070 6172 656e 7420 3d20 2870       parent = (p
-0004b560: 6172 656e 742c 2063 6869 6c64 7265 6e29  arent, children)
-0004b570: 2020 2320 7061 7265 6e74 2069 7320 6e6f    # parent is no
-0004b580: 7720 7072 6576 696f 7573 206e 6f64 6520  w previous node 
-0004b590: 636f 6e74 6578 740d 0a20 2020 2020 2020  context..       
-0004b5a0: 2020 2020 2020 2020 2063 6869 6c64 7265           childre
-0004b5b0: 6e20 3d20 6c69 7374 2829 2020 2320 6e65  n = list()  # ne
-0004b5c0: 7720 6e6f 6465 2068 6173 206e 6f20 6368  w node has no ch
-0004b5d0: 696c 6472 656e 2e0d 0a20 2020 2020 2020  ildren...       
-0004b5e0: 2020 2020 2020 2020 206e 6f64 6520 3d20           node = 
-0004b5f0: 2865 6c65 6d2c 2063 6869 6c64 7265 6e29  (elem, children)
-0004b600: 2020 2320 6465 6669 6e65 2074 6869 7320    # define this 
-0004b610: 6e6f 6465 2e0d 0a20 2020 2020 2020 2020  node...         
-0004b620: 2020 2020 2020 2073 6962 6c69 6e67 732e         siblings.
-0004b630: 6170 7065 6e64 286e 6f64 6529 2020 2320  append(node)  # 
-0004b640: 7369 626c 696e 6773 206e 6f77 2069 6e63  siblings now inc
-0004b650: 6c75 6465 7320 7468 6973 206e 6f64 652e  ludes this node.
-0004b660: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0004b670: 2020 6174 7472 6962 7574 6573 203d 2065    attributes = e
-0004b680: 6c65 6d2e 6174 7472 6962 0d0a 2020 2020  lem.attrib..    
-0004b690: 2020 2020 2020 2020 2020 2020 6966 2053              if S
-0004b6a0: 5647 5f41 5454 525f 4944 2069 6e20 6174  VG_ATTR_ID in at
-0004b6b0: 7472 6962 7574 6573 3a20 2023 2049 6620  tributes:  # If 
-0004b6c0: 7765 2068 6176 6520 616e 2049 442c 2077  we have an ID, w
-0004b6d0: 6520 7361 7665 2074 6865 206e 6f64 652e  e save the node.
-0004b6e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0004b6f0: 2020 2020 2020 6576 656e 745f 6465 6673        event_defs
-0004b700: 5b0d 0a20 2020 2020 2020 2020 2020 2020  [..             
-0004b710: 2020 2020 2020 2020 2020 2061 7474 7269             attri
-0004b720: 6275 7465 735b 5356 475f 4154 5452 5f49  butes[SVG_ATTR_I
-0004b730: 445d 0d0a 2020 2020 2020 2020 2020 2020  D]..            
-0004b740: 2020 2020 2020 2020 5d20 3d20 6e6f 6465          ] = node
-0004b750: 2020 2320 7374 6f72 6520 6e6f 6465 2076    # store node v
-0004b760: 616c 7565 2069 6e20 6465 6673 2e0d 0a20  alue in defs... 
-0004b770: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-0004b780: 6576 656e 7420 3d3d 2022 656e 6422 3a0d  event == "end":.
-0004b790: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004b7a0: 2070 6172 656e 742c 2063 6869 6c64 7265   parent, childre
-0004b7b0: 6e20 3d20 7061 7265 6e74 0d0a 2020 2020  n = parent..    
-0004b7c0: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-0004b7d0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0004b7e0: 6869 6c64 7265 6e2e 6170 7065 6e64 2828  hildren.append((
-0004b7f0: 656c 656d 2c20 4e6f 6e65 2929 0d0a 2020  elem, None))..  
-0004b800: 2020 2020 2020 6e6f 6465 7320 3d20 6368        nodes = ch
-0004b810: 696c 6472 656e 0d0a 0d0a 2020 2020 2020  ildren....      
-0004b820: 2020 2320 456e 6420 7072 6570 726f 6365    # End preproce
-0004b830: 7373 0d0a 0d0a 2020 2020 2020 2020 2320  ss....        # 
-0004b840: 5365 6d69 7061 7273 6520 7468 6520 6e6f  Semiparse the no
-0004b850: 6465 732e 2041 6c6c 206e 6f64 6573 2061  des. All nodes a
-0004b860: 7265 2067 6976 656e 2069 6e20 6974 6572  re given in iter
-0004b870: 7061 7273 6520 6f72 6465 7269 6e67 2077  parse ordering w
-0004b880: 6974 6820 7374 6172 742d 6e73 2c20 7374  ith start-ns, st
-0004b890: 6172 742c 2061 6e64 2065 6e64 2e0d 0a20  art, and end... 
-0004b8a0: 2020 2020 2020 2023 2055 7365 2076 616c         # Use val
-0004b8b0: 7565 7320 6172 6520 696e 6c69 6e65 642e  ues are inlined.
-0004b8c0: 0d0a 2020 2020 2020 2020 6465 6620 7365  ..        def se
-0004b8d0: 6d69 7061 7273 6528 6e6f 6465 7329 3a0d  miparse(nodes):.
-0004b8e0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-0004b8f0: 2065 6c65 6d2c 2063 6869 6c64 7265 6e20   elem, children 
-0004b900: 696e 206e 6f64 6573 3a0d 0a20 2020 2020  in nodes:..     
-0004b910: 2020 2020 2020 2020 2020 2069 6620 6368             if ch
-0004b920: 696c 6472 656e 2069 7320 4e6f 6e65 3a0d  ildren is None:.
-0004b930: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004b940: 2020 2020 2079 6965 6c64 204e 6f6e 652c       yield None,
-0004b950: 2022 7374 6172 742d 6e73 222c 2065 6c65   "start-ns", ele
-0004b960: 6d0d 0a20 2020 2020 2020 2020 2020 2020  m..             
-0004b970: 2020 2020 2020 2063 6f6e 7469 6e75 650d         continue.
-0004b980: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004b990: 2074 6167 203d 2065 6c65 6d2e 7461 670d   tag = elem.tag.
-0004b9a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004b9b0: 2069 6620 7461 672e 7374 6172 7473 7769   if tag.startswi
-0004b9c0: 7468 2822 7b68 7474 703a 2f2f 7777 772e  th("{http://www.
-0004b9d0: 7733 2e6f 7267 2f32 3030 302f 7376 6722  w3.org/2000/svg"
-0004b9e0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-0004b9f0: 2020 2020 2020 2020 7461 6720 3d20 7461          tag = ta
-0004ba00: 675b 3238 3a5d 2020 2320 5265 6d6f 7669  g[28:]  # Removi
-0004ba10: 6e67 206e 616d 6573 7061 6365 2e20 6874  ng namespace. ht
-0004ba20: 7470 3a2f 2f77 7777 2e77 332e 6f72 672f  tp://www.w3.org/
-0004ba30: 3230 3030 2f73 7667 3a0d 0a20 2020 2020  2000/svg:..     
-0004ba40: 2020 2020 2020 2020 2020 2079 6965 6c64             yield
-0004ba50: 2074 6167 2c20 2273 7461 7274 222c 2065   tag, "start", e
-0004ba60: 6c65 6d0d 0a20 2020 2020 2020 2020 2020  lem..           
-0004ba70: 2020 2020 2079 6965 6c64 2066 726f 6d20       yield from 
-0004ba80: 7365 6d69 7061 7273 6528 6368 696c 6472  semiparse(childr
-0004ba90: 656e 290d 0a20 2020 2020 2020 2020 2020  en)..           
-0004baa0: 2020 2020 2069 6620 5356 475f 5441 475f       if SVG_TAG_
-0004bab0: 5553 4520 3d3d 2074 6167 3a0d 0a20 2020  USE == tag:..   
-0004bac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004bad0: 2075 726c 203d 204e 6f6e 650d 0a20 2020   url = None..   
-0004bae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004baf0: 2073 656d 6961 7474 7220 3d20 656c 656d   semiattr = elem
-0004bb00: 2e61 7474 7269 620d 0a20 2020 2020 2020  .attrib..       
-0004bb10: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0004bb20: 584c 494e 4b5f 4852 4546 2069 6e20 7365  XLINK_HREF in se
-0004bb30: 6d69 6174 7472 3a0d 0a20 2020 2020 2020  miattr:..       
-0004bb40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004bb50: 2075 726c 203d 2073 656d 6961 7474 725b   url = semiattr[
-0004bb60: 584c 494e 4b5f 4852 4546 5d0d 0a20 2020  XLINK_HREF]..   
-0004bb70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004bb80: 2069 6620 5356 475f 4852 4546 2069 6e20   if SVG_HREF in 
-0004bb90: 7365 6d69 6174 7472 3a0d 0a20 2020 2020  semiattr:..     
-0004bba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004bbb0: 2020 2075 726c 203d 2073 656d 6961 7474     url = semiatt
-0004bbc0: 725b 5356 475f 4852 4546 5d0d 0a20 2020  r[SVG_HREF]..   
-0004bbd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004bbe0: 2069 6620 7572 6c20 6973 206e 6f74 204e   if url is not N
-0004bbf0: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
-0004bc00: 2020 2020 2020 2020 2020 2020 2020 7472                tr
-0004bc10: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
-0004bc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004bc30: 7969 656c 6420 6672 6f6d 2073 656d 6970  yield from semip
-0004bc40: 6172 7365 285b 6576 656e 745f 6465 6673  arse([event_defs
-0004bc50: 5b75 726c 5b31 3a5d 5d5d 290d 0a20 2020  [url[1:]]])..   
-0004bc60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004bc70: 2020 2020 2065 7863 6570 7420 4b65 7945       except KeyE
-0004bc80: 7272 6f72 3a0d 0a20 2020 2020 2020 2020  rror:..         
-0004bc90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004bca0: 2020 2070 6173 7320 2023 2046 6169 6c65     pass  # Faile
-0004bcb0: 6420 746f 2066 696e 6420 6c69 6e6b 2e0d  d to find link..
-0004bcc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004bcd0: 2079 6965 6c64 2074 6167 2c20 2265 6e64   yield tag, "end
-0004bce0: 222c 2065 6c65 6d0d 0a0d 0a20 2020 2020  ", elem....     
-0004bcf0: 2020 2079 6965 6c64 2066 726f 6d20 7365     yield from se
-0004bd00: 6d69 7061 7273 6528 6e6f 6465 7329 0d0a  miparse(nodes)..
-0004bd10: 0d0a 2020 2020 4073 7461 7469 636d 6574  ..    @staticmet
-0004bd20: 686f 640d 0a20 2020 2064 6566 2070 6172  hod..    def par
-0004bd30: 7365 280d 0a20 2020 2020 2020 2073 6f75  se(..        sou
-0004bd40: 7263 652c 0d0a 2020 2020 2020 2020 7265  rce,..        re
-0004bd50: 6966 793d 5472 7565 2c0d 0a20 2020 2020  ify=True,..     
-0004bd60: 2020 2070 7069 3d44 4546 4155 4c54 5f50     ppi=DEFAULT_P
-0004bd70: 5049 2c0d 0a20 2020 2020 2020 2077 6964  PI,..        wid
-0004bd80: 7468 3d4e 6f6e 652c 0d0a 2020 2020 2020  th=None,..      
-0004bd90: 2020 6865 6967 6874 3d4e 6f6e 652c 0d0a    height=None,..
-0004bda0: 2020 2020 2020 2020 636f 6c6f 723d 2262          color="b
-0004bdb0: 6c61 636b 222c 0d0a 2020 2020 2020 2020  lack",..        
-0004bdc0: 7472 616e 7366 6f72 6d3d 4e6f 6e65 2c0d  transform=None,.
-0004bdd0: 0a20 2020 2020 2020 2063 6f6e 7465 7874  .        context
-0004bde0: 3d4e 6f6e 652c 0d0a 2020 2020 2020 2020  =None,..        
-0004bdf0: 7061 7273 655f 6469 7370 6c61 795f 6e6f  parse_display_no
-0004be00: 6e65 3d46 616c 7365 2c0d 0a20 2020 2029  ne=False,..    )
-0004be10: 3a0d 0a20 2020 2020 2020 2022 2222 0d0a  :..        """..
-0004be20: 2020 2020 2020 2020 5061 7273 6573 2074          Parses t
-0004be30: 6865 2053 5647 2066 696c 652e 2041 6c6c  he SVG file. All
-0004be40: 2061 7474 7269 6275 7465 7320 6172 6520   attributes are 
-0004be50: 7468 696e 6773 2077 6869 6368 2074 6865  things which the
-0004be60: 2053 5647 2064 6f63 756d 656e 7420 6974   SVG document it
-0004be70: 7365 6c66 2063 6f75 6c64 206e 6f74 2062  self could not b
-0004be80: 6520 6177 6172 6520 6f66 2c20 7375 6368  e aware of, such
-0004be90: 2061 730d 0a20 2020 2020 2020 2074 6865   as..        the
-0004bea0: 2072 6561 6c20 7369 7a65 206f 6620 7069   real size of pi
-0004beb0: 7865 6c73 2061 6e64 2074 6865 2073 697a  xels and the siz
-0004bec0: 6520 6f66 2074 6865 2076 6965 7770 6f72  e of the viewpor
-0004bed0: 7420 2861 7320 6f70 706f 7365 6420 746f  t (as opposed to
-0004bee0: 2074 6865 2076 6965 7762 6f78 292e 0d0a   the viewbox)...
-0004bef0: 0d0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-0004bf00: 2073 6f75 7263 653a 2053 6f75 7263 6520   source: Source 
-0004bf10: 7376 6720 6669 6c65 206f 7220 7374 7265  svg file or stre
-0004bf20: 616d 2e0d 0a20 2020 2020 2020 203a 7061  am...        :pa
-0004bf30: 7261 6d20 7265 6966 793a 2053 686f 756c  ram reify: Shoul
-0004bf40: 6420 7468 6520 4765 6f6d 6574 7279 2073  d the Geometry s
-0004bf50: 697a 6564 206f 7220 6861 7665 206c 617a  ized or have laz
-0004bf60: 7920 6d61 7472 6963 6573 2e0d 0a20 2020  y matrices...   
-0004bf70: 2020 2020 203a 7061 7261 6d20 7070 693a       :param ppi:
-0004bf80: 2048 6f77 206d 616e 7920 7068 7973 6963   How many physic
-0004bf90: 616c 2070 6978 656c 7320 7065 7220 696e  al pixels per in
-0004bfa0: 6368 2061 7265 2074 6865 7265 2069 6e20  ch are there in 
-0004bfb0: 7468 6973 2076 6965 772e 0d0a 2020 2020  this view...    
-0004bfc0: 2020 2020 3a70 6172 616d 2077 6964 7468      :param width
-0004bfd0: 3a20 5468 6520 7068 7973 6963 616c 2077  : The physical w
-0004bfe0: 6964 7468 206f 6620 7468 6520 7669 6577  idth of the view
-0004bff0: 706f 7274 0d0a 2020 2020 2020 2020 3a70  port..        :p
-0004c000: 6172 616d 2068 6569 6768 743a 2054 6865  aram height: The
-0004c010: 2070 6879 7369 6361 6c20 6865 6967 6874   physical height
-0004c020: 206f 6620 7468 6520 7669 6577 706f 7274   of the viewport
-0004c030: 0d0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-0004c040: 2063 6f6c 6f72 3a20 7468 6520 6063 7572   color: the `cur
-0004c050: 7265 6e74 436f 6c6f 7260 2076 616c 7565  rentColor` value
-0004c060: 2066 726f 6d20 6f75 7473 6964 6520 7468   from outside th
-0004c070: 6520 6375 7272 656e 7420 7363 6f70 652e  e current scope.
-0004c080: 0d0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-0004c090: 2074 7261 6e73 666f 726d 3a20 416e 7920   transform: Any 
-0004c0a0: 7265 7175 6972 6564 2074 7261 6e73 666f  required transfo
-0004c0b0: 726d 6174 696f 6e73 2074 6f20 6265 2070  rmations to be p
-0004c0c0: 7265 2d61 7070 6c69 6564 2074 6f20 7468  re-applied to th
-0004c0d0: 6973 2064 6f63 756d 656e 740d 0a20 2020  is document..   
-0004c0e0: 2020 2020 203a 7061 7261 6d20 636f 6e74       :param cont
-0004c0f0: 6578 743a 2041 6e79 2065 7869 7374 696e  ext: Any existin
-0004c100: 6720 646f 6375 6d65 6e74 2063 6f6e 7465  g document conte
-0004c110: 7874 2e0d 0a20 2020 2020 2020 203a 7061  xt...        :pa
-0004c120: 7261 6d20 7061 7273 655f 6469 7370 6c61  ram parse_displa
-0004c130: 795f 6e6f 6e65 3a20 5061 7273 6520 6469  y_none: Parse di
-0004c140: 7370 6c61 795f 6e6f 6e65 2076 616c 7565  splay_none value
-0004c150: 7320 616e 7977 6179 2e0d 0a20 2020 2020  s anyway...     
-0004c160: 2020 203a 7265 7475 726e 3a0d 0a20 2020     :return:..   
-0004c170: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
-0004c180: 2020 7573 6520 3d20 300d 0a20 2020 2020    use = 0..     
-0004c190: 2020 2063 6c69 7020 3d20 300d 0a20 2020     clip = 0..   
-0004c1a0: 2020 2020 2072 6f6f 7420 3d20 636f 6e74       root = cont
-0004c1b0: 6578 740d 0a20 2020 2020 2020 2073 7479  ext..        sty
-0004c1c0: 6c65 7320 3d20 7b7d 0d0a 2020 2020 2020  les = {}..      
-0004c1d0: 2020 7374 6163 6b20 3d20 5b5d 0d0a 0d0a    stack = []....
-0004c1e0: 2020 2020 2020 2020 7661 6c75 6573 203d          values =
-0004c1f0: 207b 0d0a 2020 2020 2020 2020 2020 2020   {..            
-0004c200: 5356 475f 4154 5452 5f43 4f4c 4f52 3a20  SVG_ATTR_COLOR: 
-0004c210: 636f 6c6f 722c 0d0a 2020 2020 2020 2020  color,..        
-0004c220: 2020 2020 5356 475f 4154 5452 5f46 494c      SVG_ATTR_FIL
-0004c230: 4c3a 2022 626c 6163 6b22 2c0d 0a20 2020  L: "black",..   
-0004c240: 2020 2020 2020 2020 2053 5647 5f41 5454           SVG_ATT
-0004c250: 525f 5354 524f 4b45 3a20 226e 6f6e 6522  R_STROKE: "none"
-0004c260: 2c0d 0a20 2020 2020 2020 207d 0d0a 0d0a  ,..        }....
-0004c270: 2020 2020 2020 2020 6966 2074 7261 6e73          if trans
-0004c280: 666f 726d 2069 7320 6e6f 7420 4e6f 6e65  form is not None
-0004c290: 3a0d 0a20 2020 2020 2020 2020 2020 2076  :..            v
-0004c2a0: 616c 7565 735b 5356 475f 4154 5452 5f54  alues[SVG_ATTR_T
-0004c2b0: 5241 4e53 464f 524d 5d20 3d20 7472 616e  RANSFORM] = tran
-0004c2c0: 7366 6f72 6d0d 0a0d 0a20 2020 2020 2020  sform....       
-0004c2d0: 2066 6f72 2074 6167 2c20 6576 656e 742c   for tag, event,
-0004c2e0: 2065 6c65 6d20 696e 2053 5647 2e5f 7573   elem in SVG._us
-0004c2f0: 655f 7374 7275 6374 7572 655f 7061 7273  e_structure_pars
-0004c300: 6528 736f 7572 6365 293a 0d0a 2020 2020  e(source):..    
-0004c310: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
-0004c320: 2020 2020 2020 2020 2053 5647 2065 6c65           SVG ele
-0004c330: 6d65 6e74 2070 6172 7369 6e67 2070 6172  ment parsing par
-0004c340: 7365 7320 7468 6520 6a6f 6220 636f 6d70  ses the job comp
-0004c350: 696c 696e 6720 616e 7920 7061 7273 6564  iling any parsed
-0004c360: 2065 6c65 6d65 6e74 7320 696e 746f 2074   elements into t
-0004c370: 6865 6972 2063 6f6d 7069 6c65 6420 6f62  heir compiled ob
-0004c380: 6a65 6374 2066 6f72 6d73 2e0d 0a20 2020  ject forms...   
-0004c390: 2020 2020 2020 2020 2022 2222 0d0a 2020           """..  
-0004c3a0: 2020 2020 2020 2020 2020 6966 2065 7665            if eve
-0004c3b0: 6e74 203d 3d20 2273 7461 7274 223a 0d0a  nt == "start":..
-0004c3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c3d0: 7374 6163 6b2e 6170 7065 6e64 2828 636f  stack.append((co
-0004c3e0: 6e74 6578 742c 2076 616c 7565 7329 290d  ntext, values)).
-0004c3f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004c400: 2069 6620 280d 0a20 2020 2020 2020 2020   if (..         
-0004c410: 2020 2020 2020 2020 2020 206e 6f74 2070             not p
-0004c420: 6172 7365 5f64 6973 706c 6179 5f6e 6f6e  arse_display_non
-0004c430: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
-0004c440: 2020 2020 2020 2061 6e64 2053 5647 5f41         and SVG_A
-0004c450: 5454 525f 4449 5350 4c41 5920 696e 2076  TTR_DISPLAY in v
-0004c460: 616c 7565 730d 0a20 2020 2020 2020 2020  alues..         
-0004c470: 2020 2020 2020 2020 2020 2061 6e64 2076             and v
-0004c480: 616c 7565 735b 5356 475f 4154 5452 5f44  alues[SVG_ATTR_D
-0004c490: 4953 504c 4159 5d2e 6c6f 7765 7228 2920  ISPLAY].lower() 
-0004c4a0: 3d3d 2053 5647 5f56 414c 5545 5f4e 4f4e  == SVG_VALUE_NON
-0004c4b0: 450d 0a20 2020 2020 2020 2020 2020 2020  E..             
-0004c4c0: 2020 2029 3a0d 0a20 2020 2020 2020 2020     ):..         
-0004c4d0: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
-0004c4e0: 6e75 6520 2023 2056 616c 7565 7320 6861  nue  # Values ha
-0004c4f0: 7320 6120 6469 7370 6c61 793d 6e6f 6e65  s a display=none
-0004c500: 2e20 446f 206e 6f74 2072 656e 6465 7220  . Do not render 
-0004c510: 616e 7974 6869 6e67 2e20 4e6f 2053 6861  anything. No Sha
-0004c520: 646f 7720 446f 6d2e 0d0a 2020 2020 2020  dow Dom...      
-0004c530: 2020 2020 2020 2020 2020 6375 7272 656e            curren
-0004c540: 745f 7661 6c75 6573 203d 2076 616c 7565  t_values = value
-0004c550: 730d 0a20 2020 2020 2020 2020 2020 2020  s..             
-0004c560: 2020 2076 616c 7565 7320 3d20 7b7d 0d0a     values = {}..
-0004c570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c580: 7661 6c75 6573 2e75 7064 6174 6528 6375  values.update(cu
-0004c590: 7272 656e 745f 7661 6c75 6573 2920 2023  rrent_values)  #
-0004c5a0: 2063 6f70 7920 6f66 2064 6963 7469 6f6e   copy of diction
-0004c5b0: 6172 790d 0a0d 0a20 2020 2020 2020 2020  ary....         
-0004c5c0: 2020 2020 2020 2023 204e 6f6e 2d70 726f         # Non-pro
-0004c5d0: 7061 6761 7469 6e67 2076 616c 7565 732e  pagating values.
-0004c5e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0004c5f0: 2020 6966 2053 5647 5f41 5454 525f 5052    if SVG_ATTR_PR
-0004c600: 4553 4552 5645 4153 5045 4354 5241 5449  ESERVEASPECTRATI
-0004c610: 4f20 696e 2076 616c 7565 733a 0d0a 2020  O in values:..  
-0004c620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c630: 2020 6465 6c20 7661 6c75 6573 5b53 5647    del values[SVG
-0004c640: 5f41 5454 525f 5052 4553 4552 5645 4153  _ATTR_PRESERVEAS
-0004c650: 5045 4354 5241 5449 4f5d 0d0a 2020 2020  PECTRATIO]..    
-0004c660: 2020 2020 2020 2020 2020 2020 6966 2053              if S
-0004c670: 5647 5f41 5454 525f 5649 4557 424f 5820  VG_ATTR_VIEWBOX 
-0004c680: 696e 2076 616c 7565 733a 0d0a 2020 2020  in values:..    
-0004c690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c6a0: 6465 6c20 7661 6c75 6573 5b53 5647 5f41  del values[SVG_A
-0004c6b0: 5454 525f 5649 4557 424f 585d 0d0a 2020  TTR_VIEWBOX]..  
-0004c6c0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0004c6d0: 2053 5647 5f41 5454 525f 4944 2069 6e20   SVG_ATTR_ID in 
-0004c6e0: 7661 6c75 6573 3a0d 0a20 2020 2020 2020  values:..       
-0004c6f0: 2020 2020 2020 2020 2020 2020 2064 656c               del
-0004c700: 2076 616c 7565 735b 5356 475f 4154 5452   values[SVG_ATTR
-0004c710: 5f49 445d 0d0a 2020 2020 2020 2020 2020  _ID]..          
-0004c720: 2020 2020 2020 6966 2053 5647 5f41 5454        if SVG_ATT
-0004c730: 525f 434c 4153 5320 696e 2076 616c 7565  R_CLASS in value
-0004c740: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
-0004c750: 2020 2020 2020 2020 6465 6c20 7661 6c75          del valu
-0004c760: 6573 5b53 5647 5f41 5454 525f 434c 4153  es[SVG_ATTR_CLAS
-0004c770: 535d 0d0a 2020 2020 2020 2020 2020 2020  S]..            
-0004c780: 2020 2020 6966 2053 5647 5f41 5454 525f      if SVG_ATTR_
-0004c790: 434c 4950 5f50 4154 4820 696e 2076 616c  CLIP_PATH in val
-0004c7a0: 7565 733a 0d0a 2020 2020 2020 2020 2020  ues:..          
-0004c7b0: 2020 2020 2020 2020 2020 6465 6c20 7661            del va
-0004c7c0: 6c75 6573 5b53 5647 5f41 5454 525f 434c  lues[SVG_ATTR_CL
-0004c7d0: 4950 5f50 4154 485d 0d0a 0d0a 2020 2020  IP_PATH]....    
-0004c7e0: 2020 2020 2020 2020 2020 2020 6174 7472              attr
-0004c7f0: 6962 7574 6573 203d 2064 6963 7428 656c  ibutes = dict(el
-0004c800: 656d 2e61 7474 7269 6229 2020 2320 7072  em.attrib)  # pr
-0004c810: 696f 7269 7479 3b20 6c6f 7765 7374 0d0a  iority; lowest..
-0004c820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c830: 6174 7472 6962 7574 6573 5b53 5647 5f41  attributes[SVG_A
-0004c840: 5454 525f 5441 475d 203d 2074 6167 0d0a  TTR_TAG] = tag..
-0004c850: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0004c860: 2020 2320 5370 6c69 7420 616e 7920 5374    # Split any St
-0004c870: 796c 6520 626c 6f63 6b20 656c 656d 656e  yle block elemen
-0004c880: 7473 2069 6e74 6f20 7061 7274 733b 2070  ts into parts; p
-0004c890: 7269 6f72 6974 7920 6d65 6469 756d 0d0a  riority medium..
-0004c8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c8b0: 7374 796c 6520 3d20 2222 0d0a 2020 2020  style = ""..    
-0004c8c0: 2020 2020 2020 2020 2020 2020 6966 2022              if "
-0004c8d0: 2a22 2069 6e20 7374 796c 6573 3a20 2023  *" in styles:  #
-0004c8e0: 2053 656c 6563 7420 616c 6c2e 0d0a 2020   Select all...  
-0004c8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c900: 2020 7374 796c 6520 2b3d 2073 7479 6c65    style += style
-0004c910: 735b 222a 225d 0d0a 2020 2020 2020 2020  s["*"]..        
-0004c920: 2020 2020 2020 2020 6966 2074 6167 2069          if tag i
-0004c930: 6e20 7374 796c 6573 3a20 2023 2073 656c  n styles:  # sel
-0004c940: 6563 746f 7220 7479 7065 0d0a 2020 2020  ector type..    
-0004c950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c960: 7374 796c 6520 2b3d 2073 7479 6c65 735b  style += styles[
-0004c970: 7461 675d 0d0a 2020 2020 2020 2020 2020  tag]..          
-0004c980: 2020 2020 2020 6966 2053 5647 5f41 5454        if SVG_ATT
-0004c990: 525f 4944 2069 6e20 6174 7472 6962 7574  R_ID in attribut
-0004c9a0: 6573 3a20 2023 2053 656c 6563 746f 7220  es:  # Selector 
-0004c9b0: 6964 2023 6964 0d0a 2020 2020 2020 2020  id #id..        
-0004c9c0: 2020 2020 2020 2020 2020 2020 7376 675f              svg_
-0004c9d0: 6964 203d 2061 7474 7269 6275 7465 735b  id = attributes[
-0004c9e0: 5356 475f 4154 5452 5f49 445d 0d0a 2020  SVG_ATTR_ID]..  
-0004c9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ca00: 2020 6373 735f 7461 6720 3d20 2223 2573    css_tag = "#%s
-0004ca10: 2220 2520 7376 675f 6964 0d0a 2020 2020  " % svg_id..    
-0004ca20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ca30: 6966 2063 7373 5f74 6167 2069 6e20 7374  if css_tag in st
-0004ca40: 796c 6573 3a0d 0a20 2020 2020 2020 2020  yles:..         
-0004ca50: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0004ca60: 6620 6c65 6e28 7374 796c 6529 2021 3d20  f len(style) != 
-0004ca70: 303a 0d0a 2020 2020 2020 2020 2020 2020  0:..            
-0004ca80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ca90: 7374 796c 6520 2b3d 2022 3b22 0d0a 2020  style += ";"..  
-0004caa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004cab0: 2020 2020 2020 7374 796c 6520 2b3d 2073        style += s
-0004cac0: 7479 6c65 735b 6373 735f 7461 675d 0d0a  tyles[css_tag]..
-0004cad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004cae0: 6966 2053 5647 5f41 5454 525f 434c 4153  if SVG_ATTR_CLAS
-0004caf0: 5320 696e 2061 7474 7269 6275 7465 733a  S in attributes:
-0004cb00: 2020 2320 5365 6c65 6374 6f72 2063 6c61    # Selector cla
-0004cb10: 7373 202e 636c 6173 730d 0a20 2020 2020  ss .class..     
-0004cb20: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0004cb30: 6f72 2073 7667 5f63 6c61 7373 2069 6e20  or svg_class in 
-0004cb40: 6174 7472 6962 7574 6573 5b53 5647 5f41  attributes[SVG_A
-0004cb50: 5454 525f 434c 4153 535d 2e73 706c 6974  TTR_CLASS].split
-0004cb60: 2822 2022 293a 0d0a 2020 2020 2020 2020  (" "):..        
-0004cb70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004cb80: 6373 735f 7461 6720 3d20 222e 2573 2220  css_tag = ".%s" 
-0004cb90: 2520 7376 675f 636c 6173 730d 0a20 2020  % svg_class..   
-0004cba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004cbb0: 2020 2020 2069 6620 6373 735f 7461 6720       if css_tag 
-0004cbc0: 696e 2073 7479 6c65 733a 0d0a 2020 2020  in styles:..    
-0004cbd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004cbe0: 2020 2020 2020 2020 6966 206c 656e 2873          if len(s
-0004cbf0: 7479 6c65 2920 213d 2030 3a0d 0a20 2020  tyle) != 0:..   
-0004cc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004cc10: 2020 2020 2020 2020 2020 2020 2073 7479               sty
-0004cc20: 6c65 202b 3d20 223b 220d 0a20 2020 2020  le += ";"..     
-0004cc30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004cc40: 2020 2020 2020 2073 7479 6c65 202b 3d20         style += 
-0004cc50: 7374 796c 6573 5b63 7373 5f74 6167 5d0d  styles[css_tag].
-0004cc60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004cc70: 2020 2020 2020 2020 2063 7373 5f74 6167           css_tag
-0004cc80: 203d 2022 2573 2e25 7322 2025 2028 0d0a   = "%s.%s" % (..
-0004cc90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004cca0: 2020 2020 2020 2020 2020 2020 7461 672c              tag,
-0004ccb0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0004ccc0: 2020 2020 2020 2020 2020 2020 2020 7376                sv
-0004ccd0: 675f 636c 6173 732c 0d0a 2020 2020 2020  g_class,..      
-0004cce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ccf0: 2020 2920 2023 2053 656c 6563 746f 7220    )  # Selector 
-0004cd00: 7479 7065 2f63 6c61 7373 2074 7970 652e  type/class type.
-0004cd10: 636c 6173 730d 0a20 2020 2020 2020 2020  class..         
-0004cd20: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0004cd30: 6620 6373 735f 7461 6720 696e 2073 7479  f css_tag in sty
-0004cd40: 6c65 733a 0d0a 2020 2020 2020 2020 2020  les:..          
-0004cd50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004cd60: 2020 6966 206c 656e 2873 7479 6c65 2920    if len(style) 
-0004cd70: 213d 2030 3a0d 0a20 2020 2020 2020 2020  != 0:..         
-0004cd80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004cd90: 2020 2020 2020 2073 7479 6c65 202b 3d20         style += 
-0004cda0: 223b 220d 0a20 2020 2020 2020 2020 2020  ";"..           
-0004cdb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004cdc0: 2073 7479 6c65 202b 3d20 7374 796c 6573   style += styles
-0004cdd0: 5b63 7373 5f74 6167 5d0d 0a20 2020 2020  [css_tag]..     
-0004cde0: 2020 2020 2020 2020 2020 2023 2053 706c             # Spl
-0004cdf0: 6974 2073 7479 6c65 2065 6c65 6d65 6e74  it style element
-0004ce00: 2069 6e74 6f20 7061 7274 733b 2070 7269   into parts; pri
-0004ce10: 6f72 6974 7920 6869 6768 6573 740d 0a20  ority highest.. 
-0004ce20: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0004ce30: 6620 5356 475f 4154 5452 5f53 5459 4c45  f SVG_ATTR_STYLE
-0004ce40: 2069 6e20 6174 7472 6962 7574 6573 3a0d   in attributes:.
-0004ce50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004ce60: 2020 2020 2069 6620 6c65 6e28 7374 796c       if len(styl
-0004ce70: 6529 2021 3d20 303a 0d0a 2020 2020 2020  e) != 0:..      
-0004ce80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ce90: 2020 7374 796c 6520 2b3d 2022 3b22 0d0a    style += ";"..
-0004cea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ceb0: 2020 2020 7374 796c 6520 2b3d 2061 7474      style += att
-0004cec0: 7269 6275 7465 735b 5356 475f 4154 5452  ributes[SVG_ATTR
-0004ced0: 5f53 5459 4c45 5d0d 0a0d 0a20 2020 2020  _STYLE]....     
-0004cee0: 2020 2020 2020 2020 2020 2023 2050 726f             # Pro
-0004cef0: 6365 7373 2073 7479 6c65 2074 6167 206c  cess style tag l
-0004cf00: 6566 7420 746f 2072 6967 6874 2e0d 0a20  eft to right... 
-0004cf10: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0004cf20: 6f72 2065 7175 6174 6520 696e 2073 7479  or equate in sty
-0004cf30: 6c65 2e73 706c 6974 2822 3b22 293a 0d0a  le.split(";"):..
-0004cf40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004cf50: 2020 2020 6571 7561 6c5f 6974 656d 203d      equal_item =
-0004cf60: 2065 7175 6174 652e 7370 6c69 7428 223a   equate.split(":
-0004cf70: 2229 0d0a 2020 2020 2020 2020 2020 2020  ")..            
-0004cf80: 2020 2020 2020 2020 6966 206c 656e 2865          if len(e
-0004cf90: 7175 616c 5f69 7465 6d29 203d 3d20 323a  qual_item) == 2:
-0004cfa0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0004cfb0: 2020 2020 2020 2020 2020 6b65 7920 3d20            key = 
-0004cfc0: 7374 7228 6571 7561 6c5f 6974 656d 5b30  str(equal_item[0
-0004cfd0: 5d29 2e73 7472 6970 2829 0d0a 2020 2020  ]).strip()..    
-0004cfe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004cff0: 2020 2020 7661 6c75 6520 3d20 7374 7228      value = str(
-0004d000: 6571 7561 6c5f 6974 656d 5b31 5d29 2e73  equal_item[1]).s
-0004d010: 7472 6970 2829 0d0a 2020 2020 2020 2020  trip()..        
-0004d020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d030: 6174 7472 6962 7574 6573 5b6b 6579 5d20  attributes[key] 
-0004d040: 3d20 7661 6c75 650d 0a20 2020 2020 2020  = value..       
-0004d050: 2020 2020 2020 2020 2069 6620 280d 0a20           if (.. 
+0002c310: 7263 206c 656e 6774 682e 202e 6c65 6e67  rc length. .leng
+0002c320: 7468 2829 2064 656c 6567 6174 6573 2074  th() delegates t
+0002c330: 6f20 6865 7265 2061 6e64 206f 6e20 6661  o here and on fa
+0002c340: 696c 7572 6520 7573 6573 2074 6865 0d0a  ilure uses the..
+0002c350: 2020 2020 2020 2020 6661 6c6c 6261 636b          fallback
+0002c360: 206d 6574 686f 642e 2222 220d 0a20 2020   method."""..   
+0002c370: 2020 2020 2066 726f 6d20 7363 6970 792e       from scipy.
+0002c380: 7370 6563 6961 6c20 696d 706f 7274 2065  special import e
+0002c390: 6c6c 6970 6569 6e63 0d0a 0d0a 2020 2020  llipeinc....    
+0002c3a0: 2020 2020 6120 3d20 7365 6c66 2e72 780d      a = self.rx.
+0002c3b0: 0a20 2020 2020 2020 2062 203d 2073 656c  .        b = sel
+0002c3c0: 662e 7279 0d0a 2020 2020 2020 2020 6164  f.ry..        ad
+0002c3d0: 6220 3d20 6120 2f20 620d 0a20 2020 2020  b = a / b..     
+0002c3e0: 2020 206d 203d 2031 202d 2061 6462 202a     m = 1 - adb *
+0002c3f0: 2061 6462 0d0a 2020 2020 2020 2020 7068   adb..        ph
+0002c400: 6920 3d20 7365 6c66 2e67 6574 5f73 7461  i = self.get_sta
+0002c410: 7274 5f74 2829 0d0a 2020 2020 2020 2020  rt_t()..        
+0002c420: 6431 203d 2065 6c6c 6970 6569 6e63 2870  d1 = ellipeinc(p
+0002c430: 6869 2c20 6d29 0d0a 2020 2020 2020 2020  hi, m)..        
+0002c440: 7068 6920 3d20 7068 6920 2b20 7365 6c66  phi = phi + self
+0002c450: 2e73 7765 6570 0d0a 2020 2020 2020 2020  .sweep..        
+0002c460: 6432 203d 2065 6c6c 6970 6569 6e63 2870  d2 = ellipeinc(p
+0002c470: 6869 2c20 6d29 0d0a 2020 2020 2020 2020  hi, m)..        
+0002c480: 7265 7475 726e 2062 202a 2061 6273 2864  return b * abs(d
+0002c490: 3220 2d20 6431 290d 0a0d 0a20 2020 2064  2 - d1)....    d
+0002c4a0: 6566 206c 656e 6774 6828 7365 6c66 2c20  ef length(self, 
+0002c4b0: 6572 726f 723d 4552 524f 522c 206d 696e  error=ERROR, min
+0002c4c0: 5f64 6570 7468 3d4d 494e 5f44 4550 5448  _depth=MIN_DEPTH
+0002c4d0: 293a 0d0a 2020 2020 2020 2020 2222 2254  ):..        """T
+0002c4e0: 6865 206c 656e 6774 6820 6f66 2061 6e20  he length of an 
+0002c4f0: 656c 6c69 7074 6963 616c 2061 7263 2073  elliptical arc s
+0002c500: 6567 6d65 6e74 2072 6571 7569 7265 7320  egment requires 
+0002c510: 6e75 6d65 7269 6361 6c0d 0a20 2020 2020  numerical..     
+0002c520: 2020 2069 6e74 6567 7261 7469 6f6e 2c20     integration, 
+0002c530: 616e 6420 696e 2074 6861 7420 6361 7365  and in that case
+0002c540: 2069 7427 7320 7369 6d70 6c65 7220 746f   it's simpler to
+0002c550: 206a 7573 7420 646f 2061 2067 656f 6d65   just do a geome
+0002c560: 7472 6963 0d0a 2020 2020 2020 2020 6170  tric..        ap
+0002c570: 7072 6f78 696d 6174 696f 6e2c 2061 7320  proximation, as 
+0002c580: 666f 7220 6375 6269 6320 42e9 7a69 6572  for cubic B.zier
+0002c590: 2063 7572 7665 732e 0d0a 2020 2020 2020   curves...      
+0002c5a0: 2020 2222 220d 0a20 2020 2020 2020 2069    """..        i
+0002c5b0: 6620 7365 6c66 2e73 7765 6570 203d 3d20  f self.sweep == 
+0002c5c0: 303a 0d0a 2020 2020 2020 2020 2020 2020  0:..            
+0002c5d0: 7265 7475 726e 2030 0d0a 2020 2020 2020  return 0..      
+0002c5e0: 2020 6966 2073 656c 662e 7374 6172 7420    if self.start 
+0002c5f0: 3d3d 2073 656c 662e 656e 6420 616e 6420  == self.end and 
+0002c600: 7365 6c66 2e73 7765 6570 203d 3d20 303a  self.sweep == 0:
+0002c610: 0d0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+0002c620: 5468 6973 2069 7320 6571 7569 7661 6c65  This is equivale
+0002c630: 6e74 206f 6620 6f6d 6974 7469 6e67 2074  nt of omitting t
+0002c640: 6865 2073 6567 6d65 6e74 0d0a 2020 2020  he segment..    
+0002c650: 2020 2020 2020 2020 7265 7475 726e 2030          return 0
+0002c660: 0d0a 2020 2020 2020 2020 6120 3d20 7365  ..        a = se
+0002c670: 6c66 2e72 780d 0a20 2020 2020 2020 2062  lf.rx..        b
+0002c680: 203d 2073 656c 662e 7279 0d0a 2020 2020   = self.ry..    
+0002c690: 2020 2020 6420 3d20 6162 7328 6120 2d20      d = abs(a - 
+0002c6a0: 6229 0d0a 0d0a 2020 2020 2020 2020 6966  b)....        if
+0002c6b0: 2064 203c 2045 5252 4f52 3a20 2023 2054   d < ERROR:  # T
+0002c6c0: 6869 7320 6973 2061 2063 6972 636c 652e  his is a circle.
+0002c6d0: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+0002c6e0: 7475 726e 2061 6273 2873 656c 662e 7278  turn abs(self.rx
+0002c6f0: 202a 2073 656c 662e 7377 6565 7029 0d0a   * self.sweep)..
+0002c700: 2020 2020 2020 2020 7472 793a 0d0a 2020          try:..  
+0002c710: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0002c720: 2073 656c 662e 5f65 7861 6374 5f6c 656e   self._exact_len
+0002c730: 6774 6828 290d 0a20 2020 2020 2020 2065  gth()..        e
+0002c740: 7863 6570 743a 2020 2320 4661 6c6c 6261  xcept:  # Fallba
+0002c750: 636b 206f 6e20 616e 7920 6661 696c 7572  ck on any failur
+0002c760: 650d 0a20 2020 2020 2020 2020 2020 2072  e..            r
+0002c770: 6574 7572 6e20 7365 6c66 2e5f 6c69 6e65  eturn self._line
+0002c780: 5f6c 656e 6774 6828 6572 726f 723d 6572  _length(error=er
+0002c790: 726f 722c 206d 696e 5f64 6570 7468 3d6d  ror, min_depth=m
+0002c7a0: 696e 5f64 6570 7468 290d 0a0d 0a20 2020  in_depth)....   
+0002c7b0: 2064 6566 205f 7376 675f 636f 6d70 6c65   def _svg_comple
+0002c7c0: 785f 7061 7261 6d65 7465 7269 7a65 280d  x_parameterize(.
+0002c7d0: 0a20 2020 2020 2020 2073 656c 662c 2073  .        self, s
+0002c7e0: 7461 7274 2c20 7261 6469 7573 2c20 726f  tart, radius, ro
+0002c7f0: 7461 7469 6f6e 2c20 6172 635f 666c 6167  tation, arc_flag
+0002c800: 2c20 7377 6565 705f 666c 6167 2c20 656e  , sweep_flag, en
+0002c810: 640d 0a20 2020 2029 3a0d 0a20 2020 2020  d..    ):..     
+0002c820: 2020 2022 2222 5061 7261 6d65 7465 7269     """Parameteri
+0002c830: 7a61 7469 6f6e 2077 6974 6820 636f 6d70  zation with comp
+0002c840: 6c65 7820 7261 6469 7573 2061 6e64 2068  lex radius and h
+0002c850: 6176 696e 6720 726f 7461 7469 6f6e 2066  aving rotation f
+0002c860: 6163 746f 7273 2e22 2222 0d0a 2020 2020  actors."""..    
+0002c870: 2020 2020 7365 6c66 2e5f 7376 675f 7061      self._svg_pa
+0002c880: 7261 6d65 7465 7269 7a65 280d 0a20 2020  rameterize(..   
+0002c890: 2020 2020 2020 2020 2050 6f69 6e74 2873           Point(s
+0002c8a0: 7461 7274 292c 0d0a 2020 2020 2020 2020  tart),..        
+0002c8b0: 2020 2020 7261 6469 7573 2e72 6561 6c2c      radius.real,
+0002c8c0: 0d0a 2020 2020 2020 2020 2020 2020 7261  ..            ra
+0002c8d0: 6469 7573 2e69 6d61 672c 0d0a 2020 2020  dius.imag,..    
+0002c8e0: 2020 2020 2020 2020 726f 7461 7469 6f6e          rotation
+0002c8f0: 2c0d 0a20 2020 2020 2020 2020 2020 2061  ,..            a
+0002c900: 7263 5f66 6c61 672c 0d0a 2020 2020 2020  rc_flag,..      
+0002c910: 2020 2020 2020 7377 6565 705f 666c 6167        sweep_flag
+0002c920: 2c0d 0a20 2020 2020 2020 2020 2020 2050  ,..            P
+0002c930: 6f69 6e74 2865 6e64 292c 0d0a 2020 2020  oint(end),..    
+0002c940: 2020 2020 290d 0a0d 0a20 2020 2064 6566      )....    def
+0002c950: 205f 7376 675f 7061 7261 6d65 7465 7269   _svg_parameteri
+0002c960: 7a65 280d 0a20 2020 2020 2020 2073 656c  ze(..        sel
+0002c970: 662c 2073 7461 7274 2c20 7278 2c20 7279  f, start, rx, ry
+0002c980: 2c20 726f 7461 7469 6f6e 2c20 6c61 7267  , rotation, larg
+0002c990: 655f 6172 635f 666c 6167 2c20 7377 6565  e_arc_flag, swee
+0002c9a0: 705f 666c 6167 2c20 656e 640d 0a20 2020  p_flag, end..   
+0002c9b0: 2029 3a0d 0a20 2020 2020 2020 2022 2222   ):..        """
+0002c9c0: 436f 6e76 6572 7369 6f6e 2066 726f 6d20  Conversion from 
+0002c9d0: 7376 6720 7061 7261 6d65 7465 7269 7a61  svg parameteriza
+0002c9e0: 7469 6f6e 2c20 6f75 7220 6368 6f73 656e  tion, our chosen
+0002c9f0: 206e 6174 6976 6520 6e61 7469 7665 2066   native native f
+0002ca00: 6f72 6d2e 0d0a 2020 2020 2020 2020 6874  orm...        ht
+0002ca10: 7470 3a2f 2f77 7777 2e77 332e 6f72 672f  tp://www.w3.org/
+0002ca20: 5452 2f53 5647 2f69 6d70 6c6e 6f74 652e  TR/SVG/implnote.
+0002ca30: 6874 6d6c 2341 7263 496d 706c 656d 656e  html#ArcImplemen
+0002ca40: 7461 7469 6f6e 4e6f 7465 7322 2222 0d0a  tationNotes"""..
+0002ca50: 0d0a 2020 2020 2020 2020 6c61 7267 655f  ..        large_
+0002ca60: 6172 635f 666c 6167 203d 2062 6f6f 6c28  arc_flag = bool(
+0002ca70: 6c61 7267 655f 6172 635f 666c 6167 290d  large_arc_flag).
+0002ca80: 0a20 2020 2020 2020 2073 7765 6570 5f66  .        sweep_f
+0002ca90: 6c61 6720 3d20 626f 6f6c 2873 7765 6570  lag = bool(sweep
+0002caa0: 5f66 6c61 6729 0d0a 2020 2020 2020 2020  _flag)..        
+0002cab0: 7374 6172 7420 3d20 506f 696e 7428 7374  start = Point(st
+0002cac0: 6172 7429 0d0a 2020 2020 2020 2020 7365  art)..        se
+0002cad0: 6c66 2e73 7461 7274 203d 2073 7461 7274  lf.start = start
+0002cae0: 0d0a 2020 2020 2020 2020 656e 6420 3d20  ..        end = 
+0002caf0: 506f 696e 7428 656e 6429 0d0a 2020 2020  Point(end)..    
+0002cb00: 2020 2020 7365 6c66 2e65 6e64 203d 2065      self.end = e
+0002cb10: 6e64 0d0a 2020 2020 2020 2020 6966 2073  nd..        if s
+0002cb20: 7461 7274 203d 3d20 656e 6420 6f72 2072  tart == end or r
+0002cb30: 7820 3d3d 2030 206f 7220 7279 203d 3d20  x == 0 or ry == 
+0002cb40: 303a 0d0a 2020 2020 2020 2020 2020 2020  0:..            
+0002cb50: 2320 4966 2073 7461 7274 2069 7320 6571  # If start is eq
+0002cb60: 7561 6c20 746f 2065 6e64 2c20 7468 6572  ual to end, ther
+0002cb70: 6520 6172 6520 696e 6669 6e69 7465 206e  e are infinite n
+0002cb80: 756d 6265 7220 6f66 2063 6972 636c 6573  umber of circles
+0002cb90: 2073 6f20 7468 6573 6520 766f 6964 206f   so these void o
+0002cba0: 7574 2e0d 0a20 2020 2020 2020 2020 2020  ut...           
+0002cbb0: 2023 2057 6520 7374 696c 6c20 7065 726d   # We still perm
+0002cbc0: 6974 2074 6869 7320 6b69 6e64 206f 6620  it this kind of 
+0002cbd0: 6172 632c 2062 7574 2053 5647 2070 6172  arc, but SVG par
+0002cbe0: 616d 6574 6572 697a 6174 696f 6e20 6361  ameterization ca
+0002cbf0: 6e6e 6f74 2062 6520 7573 6564 2074 6f20  nnot be used to 
+0002cc00: 6163 6869 6576 6520 6974 2e0d 0a20 2020  achieve it...   
+0002cc10: 2020 2020 2020 2020 2073 656c 662e 7377           self.sw
+0002cc20: 6565 7020 3d20 300d 0a20 2020 2020 2020  eep = 0..       
+0002cc30: 2020 2020 2073 656c 662e 7072 7820 3d20       self.prx = 
+0002cc40: 506f 696e 7428 7374 6172 7429 0d0a 2020  Point(start)..  
+0002cc50: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+0002cc60: 7279 203d 2050 6f69 6e74 2873 7461 7274  ry = Point(start
+0002cc70: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
+0002cc80: 656c 662e 6365 6e74 6572 203d 2050 6f69  elf.center = Poi
+0002cc90: 6e74 2873 7461 7274 290d 0a20 2020 2020  nt(start)..     
+0002cca0: 2020 2020 2020 2072 6574 7572 6e0d 0a20         return.. 
+0002ccb0: 2020 2020 2020 2063 6f73 7220 3d20 636f         cosr = co
+0002ccc0: 7328 7261 6469 616e 7328 726f 7461 7469  s(radians(rotati
+0002ccd0: 6f6e 2929 0d0a 2020 2020 2020 2020 7369  on))..        si
+0002cce0: 6e72 203d 2073 696e 2872 6164 6961 6e73  nr = sin(radians
+0002ccf0: 2872 6f74 6174 696f 6e29 290d 0a20 2020  (rotation))..   
+0002cd00: 2020 2020 2064 7820 3d20 2873 7461 7274       dx = (start
+0002cd10: 2e72 6561 6c20 2d20 656e 642e 7265 616c  .real - end.real
+0002cd20: 2920 2f20 320d 0a20 2020 2020 2020 2064  ) / 2..        d
+0002cd30: 7920 3d20 2873 7461 7274 2e69 6d61 6720  y = (start.imag 
+0002cd40: 2d20 656e 642e 696d 6167 2920 2f20 320d  - end.imag) / 2.
+0002cd50: 0a20 2020 2020 2020 2078 3170 7269 6d20  .        x1prim 
+0002cd60: 3d20 636f 7372 202a 2064 7820 2b20 7369  = cosr * dx + si
+0002cd70: 6e72 202a 2064 790d 0a20 2020 2020 2020  nr * dy..       
+0002cd80: 2078 3170 7269 6d5f 7371 203d 2078 3170   x1prim_sq = x1p
+0002cd90: 7269 6d20 2a20 7831 7072 696d 0d0a 2020  rim * x1prim..  
+0002cda0: 2020 2020 2020 7931 7072 696d 203d 202d        y1prim = -
+0002cdb0: 7369 6e72 202a 2064 7820 2b20 636f 7372  sinr * dx + cosr
+0002cdc0: 202a 2064 790d 0a20 2020 2020 2020 2079   * dy..        y
+0002cdd0: 3170 7269 6d5f 7371 203d 2079 3170 7269  1prim_sq = y1pri
+0002cde0: 6d20 2a20 7931 7072 696d 0d0a 0d0a 2020  m * y1prim....  
+0002cdf0: 2020 2020 2020 7278 5f73 7120 3d20 7278        rx_sq = rx
+0002ce00: 202a 2072 780d 0a20 2020 2020 2020 2072   * rx..        r
+0002ce10: 795f 7371 203d 2072 7920 2a20 7279 0d0a  y_sq = ry * ry..
+0002ce20: 0d0a 2020 2020 2020 2020 2320 436f 7272  ..        # Corr
+0002ce30: 6563 7420 6f75 7420 6f66 2072 616e 6765  ect out of range
+0002ce40: 2072 6164 6969 0d0a 2020 2020 2020 2020   radii..        
+0002ce50: 7261 6469 7573 5f63 6865 636b 203d 2028  radius_check = (
+0002ce60: 7831 7072 696d 5f73 7120 2f20 7278 5f73  x1prim_sq / rx_s
+0002ce70: 7129 202b 2028 7931 7072 696d 5f73 7120  q) + (y1prim_sq 
+0002ce80: 2f20 7279 5f73 7129 0d0a 2020 2020 2020  / ry_sq)..      
+0002ce90: 2020 6966 2072 6164 6975 735f 6368 6563    if radius_chec
+0002cea0: 6b20 3e20 313a 0d0a 2020 2020 2020 2020  k > 1:..        
+0002ceb0: 2020 2020 7278 202a 3d20 7371 7274 2872      rx *= sqrt(r
+0002cec0: 6164 6975 735f 6368 6563 6b29 0d0a 2020  adius_check)..  
+0002ced0: 2020 2020 2020 2020 2020 7279 202a 3d20            ry *= 
+0002cee0: 7371 7274 2872 6164 6975 735f 6368 6563  sqrt(radius_chec
+0002cef0: 6b29 0d0a 2020 2020 2020 2020 2020 2020  k)..            
+0002cf00: 7278 5f73 7120 3d20 7278 202a 2072 780d  rx_sq = rx * rx.
+0002cf10: 0a20 2020 2020 2020 2020 2020 2072 795f  .            ry_
+0002cf20: 7371 203d 2072 7920 2a20 7279 0d0a 0d0a  sq = ry * ry....
+0002cf30: 2020 2020 2020 2020 7431 203d 2072 785f          t1 = rx_
+0002cf40: 7371 202a 2079 3170 7269 6d5f 7371 0d0a  sq * y1prim_sq..
+0002cf50: 2020 2020 2020 2020 7432 203d 2072 795f          t2 = ry_
+0002cf60: 7371 202a 2078 3170 7269 6d5f 7371 0d0a  sq * x1prim_sq..
+0002cf70: 2020 2020 2020 2020 6320 3d20 7371 7274          c = sqrt
+0002cf80: 2861 6273 2828 7278 5f73 7120 2a20 7279  (abs((rx_sq * ry
+0002cf90: 5f73 7120 2d20 7431 202d 2074 3229 202f  _sq - t1 - t2) /
+0002cfa0: 2028 7431 202b 2074 3229 2929 0d0a 0d0a   (t1 + t2)))....
+0002cfb0: 2020 2020 2020 2020 6966 206c 6172 6765          if large
+0002cfc0: 5f61 7263 5f66 6c61 6720 3d3d 2073 7765  _arc_flag == swe
+0002cfd0: 6570 5f66 6c61 673a 0d0a 2020 2020 2020  ep_flag:..      
+0002cfe0: 2020 2020 2020 6320 3d20 2d63 0d0a 2020        c = -c..  
+0002cff0: 2020 2020 2020 6378 7072 696d 203d 2063        cxprim = c
+0002d000: 202a 2072 7820 2a20 7931 7072 696d 202f   * rx * y1prim /
+0002d010: 2072 790d 0a20 2020 2020 2020 2063 7970   ry..        cyp
+0002d020: 7269 6d20 3d20 2d63 202a 2072 7920 2a20  rim = -c * ry * 
+0002d030: 7831 7072 696d 202f 2072 780d 0a0d 0a20  x1prim / rx.... 
+0002d040: 2020 2020 2020 2063 656e 7465 7220 3d20         center = 
+0002d050: 506f 696e 7428 0d0a 2020 2020 2020 2020  Point(..        
+0002d060: 2020 2020 2863 6f73 7220 2a20 6378 7072      (cosr * cxpr
+0002d070: 696d 202d 2073 696e 7220 2a20 6379 7072  im - sinr * cypr
+0002d080: 696d 2920 2b20 2828 7374 6172 742e 7265  im) + ((start.re
+0002d090: 616c 202b 2065 6e64 2e72 6561 6c29 202f  al + end.real) /
+0002d0a0: 2032 292c 0d0a 2020 2020 2020 2020 2020   2),..          
+0002d0b0: 2020 2873 696e 7220 2a20 6378 7072 696d    (sinr * cxprim
+0002d0c0: 202b 2063 6f73 7220 2a20 6379 7072 696d   + cosr * cyprim
+0002d0d0: 2920 2b20 2828 7374 6172 742e 696d 6167  ) + ((start.imag
+0002d0e0: 202b 2065 6e64 2e69 6d61 6729 202f 2032   + end.imag) / 2
+0002d0f0: 292c 0d0a 2020 2020 2020 2020 290d 0a0d  ),..        )...
+0002d100: 0a20 2020 2020 2020 2075 7820 3d20 2878  .        ux = (x
+0002d110: 3170 7269 6d20 2d20 6378 7072 696d 2920  1prim - cxprim) 
+0002d120: 2f20 7278 0d0a 2020 2020 2020 2020 7579  / rx..        uy
+0002d130: 203d 2028 7931 7072 696d 202d 2063 7970   = (y1prim - cyp
+0002d140: 7269 6d29 202f 2072 790d 0a20 2020 2020  rim) / ry..     
+0002d150: 2020 2076 7820 3d20 282d 7831 7072 696d     vx = (-x1prim
+0002d160: 202d 2063 7870 7269 6d29 202f 2072 780d   - cxprim) / rx.
+0002d170: 0a20 2020 2020 2020 2076 7920 3d20 282d  .        vy = (-
+0002d180: 7931 7072 696d 202d 2063 7970 7269 6d29  y1prim - cyprim)
+0002d190: 202f 2072 790d 0a20 2020 2020 2020 206e   / ry..        n
+0002d1a0: 203d 2073 7172 7428 7578 202a 2075 7820   = sqrt(ux * ux 
+0002d1b0: 2b20 7579 202a 2075 7929 0d0a 2020 2020  + uy * uy)..    
+0002d1c0: 2020 2020 7020 3d20 7578 0d0a 2020 2020      p = ux..    
+0002d1d0: 2020 2020 2320 7468 6574 6120 3d20 6465      # theta = de
+0002d1e0: 6772 6565 7328 6163 6f73 2870 202f 206e  grees(acos(p / n
+0002d1f0: 2929 0d0a 2020 2020 2020 2020 2320 6966  ))..        # if
+0002d200: 2075 7920 3c20 303a 0d0a 2020 2020 2020   uy < 0:..      
+0002d210: 2020 2320 2020 2020 7468 6574 6120 3d20    #     theta = 
+0002d220: 2d74 6865 7461 0d0a 2020 2020 2020 2020  -theta..        
+0002d230: 2320 7468 6574 6120 3d20 7468 6574 6120  # theta = theta 
+0002d240: 2520 3336 300d 0a0d 0a20 2020 2020 2020  % 360....       
+0002d250: 206e 203d 2073 7172 7428 2875 7820 2a20   n = sqrt((ux * 
+0002d260: 7578 202b 2075 7920 2a20 7579 2920 2a20  ux + uy * uy) * 
+0002d270: 2876 7820 2a20 7678 202b 2076 7920 2a20  (vx * vx + vy * 
+0002d280: 7679 2929 0d0a 2020 2020 2020 2020 7020  vy))..        p 
+0002d290: 3d20 7578 202a 2076 7820 2b20 7579 202a  = ux * vx + uy *
+0002d2a0: 2076 790d 0a20 2020 2020 2020 2064 203d   vy..        d =
+0002d2b0: 2070 202f 206e 0d0a 2020 2020 2020 2020   p / n..        
+0002d2c0: 2320 496e 2063 6572 7461 696e 2063 6173  # In certain cas
+0002d2d0: 6573 2074 6865 2061 626f 7665 2063 616c  es the above cal
+0002d2e0: 6375 6c61 7469 6f6e 2063 616e 2074 6872  culation can thr
+0002d2f0: 6f75 6768 2069 6e61 6363 7572 6163 6965  ough inaccuracie
+0002d300: 730d 0a20 2020 2020 2020 2023 2062 6563  s..        # bec
+0002d310: 6f6d 6520 6a75 7374 2073 6c69 6768 746c  ome just slightl
+0002d320: 7920 6f75 7420 6f66 2072 616e 6765 2c20  y out of range, 
+0002d330: 6620 6578 202d 312e 3030 3030 3030 3030  f ex -1.00000000
+0002d340: 3030 3030 3030 3032 2e0d 0a20 2020 2020  00000002...     
+0002d350: 2020 2069 6620 6420 3e20 312e 303a 0d0a     if d > 1.0:..
+0002d360: 2020 2020 2020 2020 2020 2020 6420 3d20              d = 
+0002d370: 312e 300d 0a20 2020 2020 2020 2065 6c69  1.0..        eli
+0002d380: 6620 6420 3c20 2d31 2e30 3a0d 0a20 2020  f d < -1.0:..   
+0002d390: 2020 2020 2020 2020 2064 203d 202d 312e           d = -1.
+0002d3a0: 300d 0a20 2020 2020 2020 2064 656c 7461  0..        delta
+0002d3b0: 203d 2064 6567 7265 6573 2861 636f 7328   = degrees(acos(
+0002d3c0: 6429 290d 0a20 2020 2020 2020 2069 6620  d))..        if 
+0002d3d0: 2875 7820 2a20 7679 202d 2075 7920 2a20  (ux * vy - uy * 
+0002d3e0: 7678 2920 3c20 303a 0d0a 2020 2020 2020  vx) < 0:..      
+0002d3f0: 2020 2020 2020 6465 6c74 6120 3d20 2d64        delta = -d
+0002d400: 656c 7461 0d0a 2020 2020 2020 2020 6465  elta..        de
+0002d410: 6c74 6120 3d20 6465 6c74 6120 2520 3336  lta = delta % 36
+0002d420: 300d 0a20 2020 2020 2020 2069 6620 6e6f  0..        if no
+0002d430: 7420 7377 6565 705f 666c 6167 3a0d 0a20  t sweep_flag:.. 
+0002d440: 2020 2020 2020 2020 2020 2064 656c 7461             delta
+0002d450: 202d 3d20 3336 300d 0a20 2020 2020 2020   -= 360..       
+0002d460: 2023 2062 7569 6c74 2070 6172 616d 6574   # built paramet
+0002d470: 6572 732c 2064 656c 7461 2c20 7468 6574  ers, delta, thet
+0002d480: 612c 2063 656e 7465 720d 0a0d 0a20 2020  a, center....   
+0002d490: 2020 2020 2072 6f74 6174 655f 6d61 7472       rotate_matr
+0002d4a0: 6978 203d 204d 6174 7269 7828 290d 0a20  ix = Matrix().. 
+0002d4b0: 2020 2020 2020 2072 6f74 6174 655f 6d61         rotate_ma
+0002d4c0: 7472 6978 2e70 6f73 745f 726f 7461 7465  trix.post_rotate
+0002d4d0: 280d 0a20 2020 2020 2020 2020 2020 2041  (..            A
+0002d4e0: 6e67 6c65 2e64 6567 7265 6573 2872 6f74  ngle.degrees(rot
+0002d4f0: 6174 696f 6e29 2e61 735f 7261 6469 616e  ation).as_radian
+0002d500: 732c 2063 656e 7465 722e 782c 2063 656e  s, center.x, cen
+0002d510: 7465 722e 790d 0a20 2020 2020 2020 2029  ter.y..        )
+0002d520: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
+0002d530: 2e63 656e 7465 7220 3d20 6365 6e74 6572  .center = center
+0002d540: 0d0a 2020 2020 2020 2020 7365 6c66 2e70  ..        self.p
+0002d550: 7278 203d 2050 6f69 6e74 2863 656e 7465  rx = Point(cente
+0002d560: 722e 7820 2b20 7278 2c20 6365 6e74 6572  r.x + rx, center
+0002d570: 2e79 290d 0a20 2020 2020 2020 2073 656c  .y)..        sel
+0002d580: 662e 7072 7920 3d20 506f 696e 7428 6365  f.pry = Point(ce
+0002d590: 6e74 6572 2e78 2c20 6365 6e74 6572 2e79  nter.x, center.y
+0002d5a0: 202b 2072 7929 0d0a 0d0a 2020 2020 2020   + ry)....      
+0002d5b0: 2020 7365 6c66 2e70 7278 2e6d 6174 7269    self.prx.matri
+0002d5c0: 785f 7472 616e 7366 6f72 6d28 726f 7461  x_transform(rota
+0002d5d0: 7465 5f6d 6174 7269 7829 0d0a 2020 2020  te_matrix)..    
+0002d5e0: 2020 2020 7365 6c66 2e70 7279 2e6d 6174      self.pry.mat
+0002d5f0: 7269 785f 7472 616e 7366 6f72 6d28 726f  rix_transform(ro
+0002d600: 7461 7465 5f6d 6174 7269 7829 0d0a 2020  tate_matrix)..  
+0002d610: 2020 2020 2020 7365 6c66 2e73 7765 6570        self.sweep
+0002d620: 203d 2041 6e67 6c65 2e64 6567 7265 6573   = Angle.degrees
+0002d630: 2864 656c 7461 292e 6173 5f72 6164 6961  (delta).as_radia
+0002d640: 6e73 0d0a 0d0a 2020 2020 6465 6620 6173  ns....    def as
+0002d650: 5f71 7561 645f 6375 7276 6573 2873 656c  _quad_curves(sel
+0002d660: 662c 2061 7263 5f72 6571 7569 7265 643d  f, arc_required=
+0002d670: 4e6f 6e65 293a 0d0a 2020 2020 2020 2020  None):..        
+0002d680: 6966 2061 7263 5f72 6571 7569 7265 6420  if arc_required 
+0002d690: 6973 204e 6f6e 653a 0d0a 2020 2020 2020  is None:..      
+0002d6a0: 2020 2020 2020 7377 6565 705f 6c69 6d69        sweep_limi
+0002d6b0: 7420 3d20 7461 7520 2f20 3132 2e30 0d0a  t = tau / 12.0..
+0002d6c0: 2020 2020 2020 2020 2020 2020 6172 635f              arc_
+0002d6d0: 7265 7175 6972 6564 203d 2069 6e74 2863  required = int(c
+0002d6e0: 6569 6c28 6162 7328 7365 6c66 2e73 7765  eil(abs(self.swe
+0002d6f0: 6570 2920 2f20 7377 6565 705f 6c69 6d69  ep) / sweep_limi
+0002d700: 7429 290d 0a20 2020 2020 2020 2069 6620  t))..        if 
+0002d710: 6172 635f 7265 7175 6972 6564 203d 3d20  arc_required == 
+0002d720: 303a 0d0a 2020 2020 2020 2020 2020 2020  0:..            
+0002d730: 7265 7475 726e 0d0a 2020 2020 2020 2020  return..        
+0002d740: 745f 736c 6963 6520 3d20 7365 6c66 2e73  t_slice = self.s
+0002d750: 7765 6570 202f 2066 6c6f 6174 2861 7263  weep / float(arc
+0002d760: 5f72 6571 7569 7265 6429 0d0a 0d0a 2020  _required)....  
+0002d770: 2020 2020 2020 6375 7272 656e 745f 7420        current_t 
+0002d780: 3d20 7365 6c66 2e67 6574 5f73 7461 7274  = self.get_start
+0002d790: 5f74 2829 0d0a 2020 2020 2020 2020 705f  _t()..        p_
+0002d7a0: 7374 6172 7420 3d20 7365 6c66 2e73 7461  start = self.sta
+0002d7b0: 7274 0d0a 0d0a 2020 2020 2020 2020 7468  rt....        th
+0002d7c0: 6574 6120 3d20 7365 6c66 2e67 6574 5f72  eta = self.get_r
+0002d7d0: 6f74 6174 696f 6e28 290d 0a20 2020 2020  otation()..     
+0002d7e0: 2020 2063 6f73 5f74 6865 7461 203d 2063     cos_theta = c
+0002d7f0: 6f73 2874 6865 7461 290d 0a20 2020 2020  os(theta)..     
+0002d800: 2020 2073 696e 5f74 6865 7461 203d 2073     sin_theta = s
+0002d810: 696e 2874 6865 7461 290d 0a0d 0a20 2020  in(theta)....   
+0002d820: 2020 2020 2061 203d 2073 656c 662e 7278       a = self.rx
+0002d830: 0d0a 2020 2020 2020 2020 6220 3d20 7365  ..        b = se
+0002d840: 6c66 2e72 790d 0a20 2020 2020 2020 2063  lf.ry..        c
+0002d850: 7820 3d20 7365 6c66 2e63 656e 7465 722e  x = self.center.
+0002d860: 780d 0a20 2020 2020 2020 2063 7920 3d20  x..        cy = 
+0002d870: 7365 6c66 2e63 656e 7465 722e 790d 0a0d  self.center.y...
+0002d880: 0a20 2020 2020 2020 2066 6f72 2069 2069  .        for i i
+0002d890: 6e20 7261 6e67 6528 302c 2061 7263 5f72  n range(0, arc_r
+0002d8a0: 6571 7569 7265 6429 3a0d 0a20 2020 2020  equired):..     
+0002d8b0: 2020 2020 2020 206e 6578 745f 7420 3d20         next_t = 
+0002d8c0: 6375 7272 656e 745f 7420 2b20 745f 736c  current_t + t_sl
+0002d8d0: 6963 650d 0a20 2020 2020 2020 2020 2020  ice..           
+0002d8e0: 206d 6964 5f74 203d 2028 6e65 7874 5f74   mid_t = (next_t
+0002d8f0: 202b 2063 7572 7265 6e74 5f74 2920 2f20   + current_t) / 
+0002d900: 320d 0a20 2020 2020 2020 2020 2020 2070  2..            p
+0002d910: 5f65 6e64 203d 2073 656c 662e 706f 696e  _end = self.poin
+0002d920: 745f 6174 5f74 286e 6578 745f 7429 0d0a  t_at_t(next_t)..
+0002d930: 2020 2020 2020 2020 2020 2020 6966 2069              if i
+0002d940: 203d 3d20 6172 635f 7265 7175 6972 6564   == arc_required
+0002d950: 202d 2031 3a0d 0a20 2020 2020 2020 2020   - 1:..         
+0002d960: 2020 2020 2020 2070 5f65 6e64 203d 2073         p_end = s
+0002d970: 656c 662e 656e 640d 0a20 2020 2020 2020  elf.end..       
+0002d980: 2020 2020 2063 6f73 5f6d 6964 5f74 203d       cos_mid_t =
+0002d990: 2063 6f73 286d 6964 5f74 290d 0a20 2020   cos(mid_t)..   
+0002d9a0: 2020 2020 2020 2020 2073 696e 5f6d 6964           sin_mid
+0002d9b0: 5f74 203d 2073 696e 286d 6964 5f74 290d  _t = sin(mid_t).
+0002d9c0: 0a20 2020 2020 2020 2020 2020 2061 6c70  .            alp
+0002d9d0: 6861 203d 2028 342e 3020 2d20 636f 7328  ha = (4.0 - cos(
+0002d9e0: 745f 736c 6963 6529 2920 2f20 332e 300d  t_slice)) / 3.0.
+0002d9f0: 0a20 2020 2020 2020 2020 2020 2070 7820  .            px 
+0002da00: 3d20 6378 202b 2061 6c70 6861 202a 2028  = cx + alpha * (
+0002da10: 6120 2a20 636f 735f 6d69 645f 7420 2a20  a * cos_mid_t * 
+0002da20: 636f 735f 7468 6574 6120 2d20 6220 2a20  cos_theta - b * 
+0002da30: 7369 6e5f 6d69 645f 7420 2a20 7369 6e5f  sin_mid_t * sin_
+0002da40: 7468 6574 6129 0d0a 2020 2020 2020 2020  theta)..        
+0002da50: 2020 2020 7079 203d 2063 7920 2b20 616c      py = cy + al
+0002da60: 7068 6120 2a20 2861 202a 2063 6f73 5f6d  pha * (a * cos_m
+0002da70: 6964 5f74 202a 2073 696e 5f74 6865 7461  id_t * sin_theta
+0002da80: 202b 2062 202a 2073 696e 5f6d 6964 5f74   + b * sin_mid_t
+0002da90: 202a 2063 6f73 5f74 6865 7461 290d 0a20   * cos_theta).. 
+0002daa0: 2020 2020 2020 2020 2020 2079 6965 6c64             yield
+0002dab0: 2051 7561 6472 6174 6963 4265 7a69 6572   QuadraticBezier
+0002dac0: 2870 5f73 7461 7274 2c20 2870 782c 2070  (p_start, (px, p
+0002dad0: 7929 2c20 705f 656e 6429 0d0a 2020 2020  y), p_end)..    
+0002dae0: 2020 2020 2020 2020 705f 7374 6172 7420          p_start 
+0002daf0: 3d20 705f 656e 640d 0a20 2020 2020 2020  = p_end..       
+0002db00: 2020 2020 2063 7572 7265 6e74 5f74 203d       current_t =
+0002db10: 206e 6578 745f 740d 0a0d 0a20 2020 2064   next_t....    d
+0002db20: 6566 2061 735f 6375 6269 635f 6375 7276  ef as_cubic_curv
+0002db30: 6573 2873 656c 662c 2061 7263 5f72 6571  es(self, arc_req
+0002db40: 7569 7265 643d 4e6f 6e65 293a 0d0a 2020  uired=None):..  
+0002db50: 2020 2020 2020 6966 2061 7263 5f72 6571        if arc_req
+0002db60: 7569 7265 6420 6973 204e 6f6e 653a 0d0a  uired is None:..
+0002db70: 2020 2020 2020 2020 2020 2020 7377 6565              swee
+0002db80: 705f 6c69 6d69 7420 3d20 7461 7520 2f20  p_limit = tau / 
+0002db90: 3132 2e30 0d0a 2020 2020 2020 2020 2020  12.0..          
+0002dba0: 2020 6172 635f 7265 7175 6972 6564 203d    arc_required =
+0002dbb0: 2069 6e74 2863 6569 6c28 6162 7328 7365   int(ceil(abs(se
+0002dbc0: 6c66 2e73 7765 6570 2920 2f20 7377 6565  lf.sweep) / swee
+0002dbd0: 705f 6c69 6d69 7429 290d 0a20 2020 2020  p_limit))..     
+0002dbe0: 2020 2069 6620 6172 635f 7265 7175 6972     if arc_requir
+0002dbf0: 6564 203d 3d20 303a 0d0a 2020 2020 2020  ed == 0:..      
+0002dc00: 2020 2020 2020 7265 7475 726e 0d0a 2020        return..  
+0002dc10: 2020 2020 2020 745f 736c 6963 6520 3d20        t_slice = 
+0002dc20: 7365 6c66 2e73 7765 6570 202f 2066 6c6f  self.sweep / flo
+0002dc30: 6174 2861 7263 5f72 6571 7569 7265 6429  at(arc_required)
+0002dc40: 0d0a 0d0a 2020 2020 2020 2020 7468 6574  ....        thet
+0002dc50: 6120 3d20 7365 6c66 2e67 6574 5f72 6f74  a = self.get_rot
+0002dc60: 6174 696f 6e28 290d 0a20 2020 2020 2020  ation()..       
+0002dc70: 2072 7820 3d20 7365 6c66 2e72 780d 0a20   rx = self.rx.. 
+0002dc80: 2020 2020 2020 2072 7920 3d20 7365 6c66         ry = self
+0002dc90: 2e72 790d 0a20 2020 2020 2020 2070 5f73  .ry..        p_s
+0002dca0: 7461 7274 203d 2073 656c 662e 7374 6172  tart = self.star
+0002dcb0: 740d 0a20 2020 2020 2020 2063 7572 7265  t..        curre
+0002dcc0: 6e74 5f74 203d 2073 656c 662e 6765 745f  nt_t = self.get_
+0002dcd0: 7374 6172 745f 7428 290d 0a20 2020 2020  start_t()..     
+0002dce0: 2020 2078 3020 3d20 7365 6c66 2e63 656e     x0 = self.cen
+0002dcf0: 7465 722e 780d 0a20 2020 2020 2020 2079  ter.x..        y
+0002dd00: 3020 3d20 7365 6c66 2e63 656e 7465 722e  0 = self.center.
+0002dd10: 790d 0a20 2020 2020 2020 2063 6f73 5f74  y..        cos_t
+0002dd20: 6865 7461 203d 2063 6f73 2874 6865 7461  heta = cos(theta
+0002dd30: 290d 0a20 2020 2020 2020 2073 696e 5f74  )..        sin_t
+0002dd40: 6865 7461 203d 2073 696e 2874 6865 7461  heta = sin(theta
+0002dd50: 290d 0a0d 0a20 2020 2020 2020 2066 6f72  )....        for
+0002dd60: 2069 2069 6e20 7261 6e67 6528 302c 2061   i in range(0, a
+0002dd70: 7263 5f72 6571 7569 7265 6429 3a0d 0a20  rc_required):.. 
+0002dd80: 2020 2020 2020 2020 2020 206e 6578 745f             next_
+0002dd90: 7420 3d20 6375 7272 656e 745f 7420 2b20  t = current_t + 
+0002dda0: 745f 736c 6963 650d 0a0d 0a20 2020 2020  t_slice....     
+0002ddb0: 2020 2020 2020 2061 6c70 6861 203d 2073         alpha = s
+0002ddc0: 696e 2874 5f73 6c69 6365 2920 2a20 2873  in(t_slice) * (s
+0002ddd0: 7172 7428 3420 2b20 3320 2a20 706f 7728  qrt(4 + 3 * pow(
+0002dde0: 7461 6e28 745f 736c 6963 6520 2f20 322e  tan(t_slice / 2.
+0002ddf0: 3029 2c20 3229 2920 2d20 3129 202f 2033  0), 2)) - 1) / 3
+0002de00: 2e30 0d0a 0d0a 2020 2020 2020 2020 2020  .0....          
+0002de10: 2020 636f 735f 7374 6172 745f 7420 3d20    cos_start_t = 
+0002de20: 636f 7328 6375 7272 656e 745f 7429 0d0a  cos(current_t)..
+0002de30: 2020 2020 2020 2020 2020 2020 7369 6e5f              sin_
+0002de40: 7374 6172 745f 7420 3d20 7369 6e28 6375  start_t = sin(cu
+0002de50: 7272 656e 745f 7429 0d0a 0d0a 2020 2020  rrent_t)....    
+0002de60: 2020 2020 2020 2020 6550 7269 6d65 6e31          ePrimen1
+0002de70: 7820 3d20 2d72 7820 2a20 636f 735f 7468  x = -rx * cos_th
+0002de80: 6574 6120 2a20 7369 6e5f 7374 6172 745f  eta * sin_start_
+0002de90: 7420 2d20 7279 202a 2073 696e 5f74 6865  t - ry * sin_the
+0002dea0: 7461 202a 2063 6f73 5f73 7461 7274 5f74  ta * cos_start_t
+0002deb0: 0d0a 2020 2020 2020 2020 2020 2020 6550  ..            eP
+0002dec0: 7269 6d65 6e31 7920 3d20 2d72 7820 2a20  rimen1y = -rx * 
+0002ded0: 7369 6e5f 7468 6574 6120 2a20 7369 6e5f  sin_theta * sin_
+0002dee0: 7374 6172 745f 7420 2b20 7279 202a 2063  start_t + ry * c
+0002def0: 6f73 5f74 6865 7461 202a 2063 6f73 5f73  os_theta * cos_s
+0002df00: 7461 7274 5f74 0d0a 0d0a 2020 2020 2020  tart_t....      
+0002df10: 2020 2020 2020 636f 735f 656e 645f 7420        cos_end_t 
+0002df20: 3d20 636f 7328 6e65 7874 5f74 290d 0a20  = cos(next_t).. 
+0002df30: 2020 2020 2020 2020 2020 2073 696e 5f65             sin_e
+0002df40: 6e64 5f74 203d 2073 696e 286e 6578 745f  nd_t = sin(next_
+0002df50: 7429 0d0a 0d0a 2020 2020 2020 2020 2020  t)....          
+0002df60: 2020 7032 456e 3278 203d 2078 3020 2b20    p2En2x = x0 + 
+0002df70: 7278 202a 2063 6f73 5f65 6e64 5f74 202a  rx * cos_end_t *
+0002df80: 2063 6f73 5f74 6865 7461 202d 2072 7920   cos_theta - ry 
+0002df90: 2a20 7369 6e5f 656e 645f 7420 2a20 7369  * sin_end_t * si
+0002dfa0: 6e5f 7468 6574 610d 0a20 2020 2020 2020  n_theta..       
+0002dfb0: 2020 2020 2070 3245 6e32 7920 3d20 7930       p2En2y = y0
+0002dfc0: 202b 2072 7820 2a20 636f 735f 656e 645f   + rx * cos_end_
+0002dfd0: 7420 2a20 7369 6e5f 7468 6574 6120 2b20  t * sin_theta + 
+0002dfe0: 7279 202a 2073 696e 5f65 6e64 5f74 202a  ry * sin_end_t *
+0002dff0: 2063 6f73 5f74 6865 7461 0d0a 2020 2020   cos_theta..    
+0002e000: 2020 2020 2020 2020 705f 656e 6420 3d20          p_end = 
+0002e010: 2870 3245 6e32 782c 2070 3245 6e32 7929  (p2En2x, p2En2y)
+0002e020: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+0002e030: 2069 203d 3d20 6172 635f 7265 7175 6972   i == arc_requir
+0002e040: 6564 202d 2031 3a0d 0a20 2020 2020 2020  ed - 1:..       
+0002e050: 2020 2020 2020 2020 2070 5f65 6e64 203d           p_end =
+0002e060: 2073 656c 662e 656e 640d 0a0d 0a20 2020   self.end....   
+0002e070: 2020 2020 2020 2020 2065 5072 696d 656e           ePrimen
+0002e080: 3278 203d 202d 7278 202a 2063 6f73 5f74  2x = -rx * cos_t
+0002e090: 6865 7461 202a 2073 696e 5f65 6e64 5f74  heta * sin_end_t
+0002e0a0: 202d 2072 7920 2a20 7369 6e5f 7468 6574   - ry * sin_thet
+0002e0b0: 6120 2a20 636f 735f 656e 645f 740d 0a20  a * cos_end_t.. 
+0002e0c0: 2020 2020 2020 2020 2020 2065 5072 696d             ePrim
+0002e0d0: 656e 3279 203d 202d 7278 202a 2073 696e  en2y = -rx * sin
+0002e0e0: 5f74 6865 7461 202a 2073 696e 5f65 6e64  _theta * sin_end
+0002e0f0: 5f74 202b 2072 7920 2a20 636f 735f 7468  _t + ry * cos_th
+0002e100: 6574 6120 2a20 636f 735f 656e 645f 740d  eta * cos_end_t.
+0002e110: 0a0d 0a20 2020 2020 2020 2020 2020 2070  ...            p
+0002e120: 5f63 3120 3d20 2870 5f73 7461 7274 5b30  _c1 = (p_start[0
+0002e130: 5d20 2b20 616c 7068 6120 2a20 6550 7269  ] + alpha * ePri
+0002e140: 6d65 6e31 782c 2070 5f73 7461 7274 5b31  men1x, p_start[1
+0002e150: 5d20 2b20 616c 7068 6120 2a20 6550 7269  ] + alpha * ePri
+0002e160: 6d65 6e31 7929 0d0a 2020 2020 2020 2020  men1y)..        
+0002e170: 2020 2020 705f 6332 203d 2028 705f 656e      p_c2 = (p_en
+0002e180: 645b 305d 202d 2061 6c70 6861 202a 2065  d[0] - alpha * e
+0002e190: 5072 696d 656e 3278 2c20 705f 656e 645b  Primen2x, p_end[
+0002e1a0: 315d 202d 2061 6c70 6861 202a 2065 5072  1] - alpha * ePr
+0002e1b0: 696d 656e 3279 290d 0a0d 0a20 2020 2020  imen2y)....     
+0002e1c0: 2020 2020 2020 2079 6965 6c64 2043 7562         yield Cub
+0002e1d0: 6963 4265 7a69 6572 2870 5f73 7461 7274  icBezier(p_start
+0002e1e0: 2c20 705f 6331 2c20 705f 6332 2c20 705f  , p_c1, p_c2, p_
+0002e1f0: 656e 6429 0d0a 2020 2020 2020 2020 2020  end)..          
+0002e200: 2020 705f 7374 6172 7420 3d20 506f 696e    p_start = Poin
+0002e210: 7428 705f 656e 6429 0d0a 2020 2020 2020  t(p_end)..      
+0002e220: 2020 2020 2020 6375 7272 656e 745f 7420        current_t 
+0002e230: 3d20 6e65 7874 5f74 0d0a 0d0a 2020 2020  = next_t....    
+0002e240: 6465 6620 6973 5f63 6972 6375 6c61 7228  def is_circular(
+0002e250: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
+0002e260: 6120 3d20 7365 6c66 2e72 780d 0a20 2020  a = self.rx..   
+0002e270: 2020 2020 2062 203d 2073 656c 662e 7279       b = self.ry
+0002e280: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+0002e290: 2061 203d 3d20 620d 0a0d 0a20 2020 2040   a == b....    @
+0002e2a0: 7072 6f70 6572 7479 0d0a 2020 2020 6465  property..    de
+0002e2b0: 6620 7261 6469 7573 2873 656c 6629 3a0d  f radius(self):.
+0002e2c0: 0a20 2020 2020 2020 2022 2222 4c65 6761  .        """Lega
+0002e2d0: 6379 2063 6f6d 706c 6578 2072 6164 6975  cy complex radiu
+0002e2e0: 7320 7072 6f70 6572 7479 0d0a 0d0a 2020  s property....  
+0002e2f0: 2020 2020 2020 506f 696e 7420 7769 6c6c        Point will
+0002e300: 2077 6f72 6b20 6c69 6b65 2061 2063 6f6d   work like a com
+0002e310: 706c 6578 2066 6f72 206c 6567 6163 7920  plex for legacy 
+0002e320: 7265 6173 6f6e 732e 0d0a 2020 2020 2020  reasons...      
+0002e330: 2020 2222 220d 0a20 2020 2020 2020 2072    """..        r
+0002e340: 6574 7572 6e20 506f 696e 7428 7365 6c66  eturn Point(self
+0002e350: 2e72 782c 2073 656c 662e 7279 290d 0a0d  .rx, self.ry)...
+0002e360: 0a20 2020 2040 7072 6f70 6572 7479 0d0a  .    @property..
+0002e370: 2020 2020 6465 6620 7278 2873 656c 6629      def rx(self)
+0002e380: 3a0d 0a20 2020 2020 2020 2072 6574 7572  :..        retur
+0002e390: 6e20 506f 696e 742e 6469 7374 616e 6365  n Point.distance
+0002e3a0: 2873 656c 662e 6365 6e74 6572 2c20 7365  (self.center, se
+0002e3b0: 6c66 2e70 7278 290d 0a0d 0a20 2020 2040  lf.prx)....    @
+0002e3c0: 7072 6f70 6572 7479 0d0a 2020 2020 6465  property..    de
+0002e3d0: 6620 7279 2873 656c 6629 3a0d 0a20 2020  f ry(self):..   
+0002e3e0: 2020 2020 2072 6574 7572 6e20 506f 696e       return Poin
+0002e3f0: 742e 6469 7374 616e 6365 2873 656c 662e  t.distance(self.
+0002e400: 6365 6e74 6572 2c20 7365 6c66 2e70 7279  center, self.pry
+0002e410: 290d 0a0d 0a20 2020 2064 6566 2067 6574  )....    def get
+0002e420: 5f72 6f74 6174 696f 6e28 7365 6c66 293a  _rotation(self):
+0002e430: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+0002e440: 2050 6f69 6e74 2e61 6e67 6c65 2873 656c   Point.angle(sel
+0002e450: 662e 6365 6e74 6572 2c20 7365 6c66 2e70  f.center, self.p
+0002e460: 7278 290d 0a0d 0a20 2020 2064 6566 2067  rx)....    def g
+0002e470: 6574 5f73 7461 7274 5f61 6e67 6c65 2873  et_start_angle(s
+0002e480: 656c 6629 3a0d 0a20 2020 2020 2020 2022  elf):..        "
+0002e490: 2222 0d0a 2020 2020 2020 2020 3a72 6574  ""..        :ret
+0002e4a0: 7572 6e3a 2041 6e67 6c65 2066 726f 6d20  urn: Angle from 
+0002e4b0: 7468 6520 6365 6e74 6572 2070 6f69 6e74  the center point
+0002e4c0: 2074 6f20 7374 6172 7420 706f 696e 742e   to start point.
+0002e4d0: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
+0002e4e0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+0002e4f0: 6c66 2e61 6e67 6c65 5f61 745f 706f 696e  lf.angle_at_poin
+0002e500: 7428 7365 6c66 2e73 7461 7274 290d 0a0d  t(self.start)...
+0002e510: 0a20 2020 2064 6566 2067 6574 5f65 6e64  .    def get_end
+0002e520: 5f61 6e67 6c65 2873 656c 6629 3a0d 0a20  _angle(self):.. 
+0002e530: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
+0002e540: 2020 2020 3a72 6574 7572 6e3a 2041 6e67      :return: Ang
+0002e550: 6c65 2066 726f 6d20 7468 6520 6365 6e74  le from the cent
+0002e560: 6572 2070 6f69 6e74 2074 6f20 656e 6420  er point to end 
+0002e570: 706f 696e 742e 0d0a 2020 2020 2020 2020  point...        
+0002e580: 2222 220d 0a20 2020 2020 2020 2072 6574  """..        ret
+0002e590: 7572 6e20 7365 6c66 2e61 6e67 6c65 5f61  urn self.angle_a
+0002e5a0: 745f 706f 696e 7428 7365 6c66 2e65 6e64  t_point(self.end
+0002e5b0: 290d 0a0d 0a20 2020 2064 6566 2067 6574  )....    def get
+0002e5c0: 5f73 7461 7274 5f74 2873 656c 6629 3a0d  _start_t(self):.
+0002e5d0: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
+0002e5e0: 2020 2020 2020 7374 6172 7420 7420 7661        start t va
+0002e5f0: 6c75 6520 696e 2074 6865 2065 6c6c 6970  lue in the ellip
+0002e600: 7365 2e0d 0a0d 0a20 2020 2020 2020 203a  se.....        :
+0002e610: 7265 7475 726e 3a20 7420 7061 7261 6d65  return: t parame
+0002e620: 7465 7220 6f66 2073 7461 7274 2070 6f69  ter of start poi
+0002e630: 6e74 2e0d 0a20 2020 2020 2020 2022 2222  nt...        """
+0002e640: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+0002e650: 2073 656c 662e 745f 6174 5f70 6f69 6e74   self.t_at_point
+0002e660: 2873 656c 662e 706f 696e 745f 6174 5f61  (self.point_at_a
+0002e670: 6e67 6c65 2873 656c 662e 6765 745f 7374  ngle(self.get_st
+0002e680: 6172 745f 616e 676c 6528 2929 290d 0a0d  art_angle()))...
+0002e690: 0a20 2020 2064 6566 2067 6574 5f65 6e64  .    def get_end
+0002e6a0: 5f74 2873 656c 6629 3a0d 0a20 2020 2020  _t(self):..     
+0002e6b0: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
+0002e6c0: 656e 6420 7420 7661 6c75 6520 696e 2074  end t value in t
+0002e6d0: 6865 2065 6c6c 6970 7365 2e0d 0a0d 0a20  he ellipse..... 
+0002e6e0: 2020 2020 2020 203a 7265 7475 726e 3a20         :return: 
+0002e6f0: 7420 7061 7261 6d65 7465 7220 6f66 2073  t parameter of s
+0002e700: 7461 7274 2070 6f69 6e74 2e0d 0a20 2020  tart point...   
+0002e710: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
+0002e720: 2020 7265 7475 726e 2073 656c 662e 745f    return self.t_
+0002e730: 6174 5f70 6f69 6e74 2873 656c 662e 706f  at_point(self.po
+0002e740: 696e 745f 6174 5f61 6e67 6c65 2873 656c  int_at_angle(sel
+0002e750: 662e 6765 745f 656e 645f 616e 676c 6528  f.get_end_angle(
+0002e760: 2929 290d 0a0d 0a20 2020 2064 6566 2070  )))....    def p
+0002e770: 6f69 6e74 5f61 745f 616e 676c 6528 7365  oint_at_angle(se
+0002e780: 6c66 2c20 616e 676c 6529 3a0d 0a20 2020  lf, angle):..   
+0002e790: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
+0002e7a0: 2020 6669 6e64 2074 6865 2070 6f69 6e74    find the point
+0002e7b0: 206f 6e20 7468 6520 656c 6c69 7073 6520   on the ellipse 
+0002e7c0: 6672 6f6d 2074 6865 2063 656e 7465 7220  from the center 
+0002e7d0: 6174 2074 6865 2067 6976 656e 2061 6e67  at the given ang
+0002e7e0: 6c65 2e0d 0a20 2020 2020 2020 204e 6f74  le...        Not
+0002e7f0: 653a 2046 6f72 206e 6f6e 2d63 6972 6375  e: For non-circu
+0002e800: 6c61 7220 6172 6373 2074 6869 7320 6973  lar arcs this is
+0002e810: 2064 6966 6665 7265 6e74 2074 6861 6e20   different than 
+0002e820: 706f 696e 7428 7429 2e0d 0a0d 0a20 2020  point(t).....   
+0002e830: 2020 2020 203a 7061 7261 6d20 616e 676c       :param angl
+0002e840: 653a 2061 6e67 6c65 2066 726f 6d20 6365  e: angle from ce
+0002e850: 6e74 6572 2074 6f20 6669 6e64 2070 6f69  nter to find poi
+0002e860: 6e74 0d0a 2020 2020 2020 2020 3a72 6574  nt..        :ret
+0002e870: 7572 6e3a 2070 6f69 6e74 2066 6f75 6e64  urn: point found
+0002e880: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
+0002e890: 2020 2020 2020 2061 6e67 6c65 202d 3d20         angle -= 
+0002e8a0: 7365 6c66 2e67 6574 5f72 6f74 6174 696f  self.get_rotatio
+0002e8b0: 6e28 290d 0a20 2020 2020 2020 2061 203d  n()..        a =
+0002e8c0: 2073 656c 662e 7278 0d0a 2020 2020 2020   self.rx..      
+0002e8d0: 2020 6220 3d20 7365 6c66 2e72 790d 0a20    b = self.ry.. 
+0002e8e0: 2020 2020 2020 2069 6620 6120 3d3d 2062         if a == b
+0002e8f0: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
+0002e900: 6574 7572 6e20 7365 6c66 2e70 6f69 6e74  eturn self.point
+0002e910: 5f61 745f 7428 616e 676c 6529 0d0a 2020  _at_t(angle)..  
+0002e920: 2020 2020 2020 7420 3d20 6174 616e 3228        t = atan2(
+0002e930: 6120 2a20 7461 6e28 616e 676c 6529 2c20  a * tan(angle), 
+0002e940: 6229 0d0a 2020 2020 2020 2020 7461 755f  b)..        tau_
+0002e950: 315f 3420 3d20 7461 7520 2f20 342e 300d  1_4 = tau / 4.0.
+0002e960: 0a20 2020 2020 2020 2074 6175 5f33 5f34  .        tau_3_4
+0002e970: 203d 2033 202a 2074 6175 5f31 5f34 0d0a   = 3 * tau_1_4..
+0002e980: 2020 2020 2020 2020 6966 2074 6175 5f33          if tau_3
+0002e990: 5f34 203e 3d20 6162 7328 616e 676c 6529  _4 >= abs(angle)
+0002e9a0: 2025 2074 6175 203e 2074 6175 5f31 5f34   % tau > tau_1_4
+0002e9b0: 3a0d 0a20 2020 2020 2020 2020 2020 2074  :..            t
+0002e9c0: 202b 3d20 7461 7520 2f20 322e 300d 0a20   += tau / 2.0.. 
+0002e9d0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+0002e9e0: 6c66 2e70 6f69 6e74 5f61 745f 7428 7429  lf.point_at_t(t)
+0002e9f0: 0d0a 0d0a 2020 2020 6465 6620 616e 676c  ....    def angl
+0002ea00: 655f 6174 5f70 6f69 6e74 2873 656c 662c  e_at_point(self,
+0002ea10: 2070 293a 0d0a 2020 2020 2020 2020 2222   p):..        ""
+0002ea20: 220d 0a20 2020 2020 2020 2066 696e 6420  "..        find 
+0002ea30: 7468 6520 616e 676c 6520 746f 2074 6865  the angle to the
+0002ea40: 2070 6f69 6e74 2e0d 0a0d 0a20 2020 2020   point.....     
+0002ea50: 2020 203a 7061 7261 6d20 703a 2070 6f69     :param p: poi
+0002ea60: 6e74 0d0a 2020 2020 2020 2020 3a72 6574  nt..        :ret
+0002ea70: 7572 6e3a 2061 6e67 6c65 2074 6f20 6769  urn: angle to gi
+0002ea80: 7665 6e20 706f 696e 742e 0d0a 2020 2020  ven point...    
+0002ea90: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
+0002eaa0: 2072 6574 7572 6e20 7365 6c66 2e63 656e   return self.cen
+0002eab0: 7465 722e 616e 676c 655f 746f 2870 290d  ter.angle_to(p).
+0002eac0: 0a0d 0a20 2020 2064 6566 2074 5f61 745f  ...    def t_at_
+0002ead0: 706f 696e 7428 7365 6c66 2c20 7029 3a0d  point(self, p):.
+0002eae0: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
+0002eaf0: 2020 2020 2020 6669 6e64 2074 6865 2074        find the t
+0002eb00: 2070 6172 616d 6574 6572 2074 6f20 6174   parameter to at
+0002eb10: 2074 6865 2070 6f69 6e74 2e0d 0a0d 0a20   the point..... 
+0002eb20: 2020 2020 2020 203a 7061 7261 6d20 703a         :param p:
+0002eb30: 2070 6f69 6e74 0d0a 2020 2020 2020 2020   point..        
+0002eb40: 3a72 6574 7572 6e3a 2074 2070 6172 616d  :return: t param
+0002eb50: 6574 6572 2074 6f20 7468 6520 6769 7665  eter to the give
+0002eb60: 6e20 706f 696e 742e 0d0a 2020 2020 2020  n point...      
+0002eb70: 2020 2222 220d 0a20 2020 2020 2020 2061    """..        a
+0002eb80: 6e67 6c65 203d 2073 656c 662e 616e 676c  ngle = self.angl
+0002eb90: 655f 6174 5f70 6f69 6e74 2870 290d 0a20  e_at_point(p).. 
+0002eba0: 2020 2020 2020 2061 6e67 6c65 202d 3d20         angle -= 
+0002ebb0: 7365 6c66 2e67 6574 5f72 6f74 6174 696f  self.get_rotatio
+0002ebc0: 6e28 290d 0a20 2020 2020 2020 2061 203d  n()..        a =
+0002ebd0: 2073 656c 662e 7278 0d0a 2020 2020 2020   self.rx..      
+0002ebe0: 2020 6220 3d20 7365 6c66 2e72 790d 0a20    b = self.ry.. 
+0002ebf0: 2020 2020 2020 2074 203d 2061 7461 6e32         t = atan2
+0002ec00: 2861 202a 2074 616e 2861 6e67 6c65 292c  (a * tan(angle),
+0002ec10: 2062 290d 0a20 2020 2020 2020 2074 6175   b)..        tau
+0002ec20: 5f31 5f34 203d 2074 6175 202f 2034 2e30  _1_4 = tau / 4.0
+0002ec30: 0d0a 2020 2020 2020 2020 7461 755f 335f  ..        tau_3_
+0002ec40: 3420 3d20 3320 2a20 7461 755f 315f 340d  4 = 3 * tau_1_4.
+0002ec50: 0a20 2020 2020 2020 2069 6620 7461 755f  .        if tau_
+0002ec60: 335f 3420 3e3d 2061 6273 2861 6e67 6c65  3_4 >= abs(angle
+0002ec70: 2920 2520 7461 7520 3e20 7461 755f 315f  ) % tau > tau_1_
+0002ec80: 343a 0d0a 2020 2020 2020 2020 2020 2020  4:..            
+0002ec90: 7420 2b3d 2074 6175 202f 2032 2e30 0d0a  t += tau / 2.0..
+0002eca0: 2020 2020 2020 2020 7265 7475 726e 2074          return t
+0002ecb0: 0d0a 0d0a 2020 2020 6465 6620 706f 696e  ....    def poin
+0002ecc0: 745f 6174 5f74 2873 656c 662c 2074 293a  t_at_t(self, t):
+0002ecd0: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
+0002ece0: 2020 2020 2020 2066 696e 6420 7468 6520         find the 
+0002ecf0: 706f 696e 7420 7468 6174 2063 6f72 7265  point that corre
+0002ed00: 7370 6f6e 6473 2074 6f20 6769 7665 6e20  sponds to given 
+0002ed10: 7661 6c75 6520 742e 0d0a 2020 2020 2020  value t...      
+0002ed20: 2020 5768 6572 6520 743d 3020 6973 2074    Where t=0 is t
+0002ed30: 6865 2066 6972 7374 2070 6f69 6e74 2061  he first point a
+0002ed40: 6e64 2074 3d74 6175 2069 7320 7468 6520  nd t=tau is the 
+0002ed50: 6669 6e61 6c20 706f 696e 742e 0d0a 0d0a  final point.....
+0002ed60: 2020 2020 2020 2020 496e 2074 6865 2063          In the c
+0002ed70: 6173 6520 6f66 2061 2063 6972 636c 653a  ase of a circle:
+0002ed80: 2074 203d 2061 6e67 6c65 2e0d 0a0d 0a20   t = angle..... 
+0002ed90: 2020 2020 2020 203a 7061 7261 6d20 743a         :param t:
+0002eda0: 0d0a 2020 2020 2020 2020 3a72 6574 7572  ..        :retur
+0002edb0: 6e3a 0d0a 2020 2020 2020 2020 2222 220d  n:..        """.
+0002edc0: 0a20 2020 2020 2020 2072 6f74 6174 696f  .        rotatio
+0002edd0: 6e20 3d20 7365 6c66 2e67 6574 5f72 6f74  n = self.get_rot
+0002ede0: 6174 696f 6e28 290d 0a20 2020 2020 2020  ation()..       
+0002edf0: 2061 203d 2073 656c 662e 7278 0d0a 2020   a = self.rx..  
+0002ee00: 2020 2020 2020 6220 3d20 7365 6c66 2e72        b = self.r
+0002ee10: 790d 0a20 2020 2020 2020 2063 7820 3d20  y..        cx = 
+0002ee20: 7365 6c66 2e63 656e 7465 722e 780d 0a20  self.center.x.. 
+0002ee30: 2020 2020 2020 2063 7920 3d20 7365 6c66         cy = self
+0002ee40: 2e63 656e 7465 722e 790d 0a20 2020 2020  .center.y..     
+0002ee50: 2020 2063 6f73 5f72 6f74 203d 2063 6f73     cos_rot = cos
+0002ee60: 2872 6f74 6174 696f 6e29 0d0a 2020 2020  (rotation)..    
+0002ee70: 2020 2020 7369 6e5f 726f 7420 3d20 7369      sin_rot = si
+0002ee80: 6e28 726f 7461 7469 6f6e 290d 0a20 2020  n(rotation)..   
+0002ee90: 2020 2020 2063 6f73 5f74 203d 2063 6f73       cos_t = cos
+0002eea0: 2874 290d 0a20 2020 2020 2020 2073 696e  (t)..        sin
+0002eeb0: 5f74 203d 2073 696e 2874 290d 0a20 2020  _t = sin(t)..   
+0002eec0: 2020 2020 2070 7820 3d20 6378 202b 2061       px = cx + a
+0002eed0: 202a 2063 6f73 5f74 202a 2063 6f73 5f72   * cos_t * cos_r
+0002eee0: 6f74 202d 2062 202a 2073 696e 5f74 202a  ot - b * sin_t *
+0002eef0: 2073 696e 5f72 6f74 0d0a 2020 2020 2020   sin_rot..      
+0002ef00: 2020 7079 203d 2063 7920 2b20 6120 2a20    py = cy + a * 
+0002ef10: 636f 735f 7420 2a20 7369 6e5f 726f 7420  cos_t * sin_rot 
+0002ef20: 2b20 6220 2a20 7369 6e5f 7420 2a20 636f  + b * sin_t * co
+0002ef30: 735f 726f 740d 0a20 2020 2020 2020 2072  s_rot..        r
+0002ef40: 6574 7572 6e20 506f 696e 7428 7078 2c20  eturn Point(px, 
+0002ef50: 7079 290d 0a0d 0a20 2020 2064 6566 2067  py)....    def g
+0002ef60: 6574 5f65 6c6c 6970 7365 2873 656c 6629  et_ellipse(self)
+0002ef70: 3a0d 0a20 2020 2020 2020 2072 6574 7572  :..        retur
+0002ef80: 6e20 456c 6c69 7073 6528 7365 6c66 2e63  n Ellipse(self.c
+0002ef90: 656e 7465 722c 2073 656c 662e 7278 2c20  enter, self.rx, 
+0002efa0: 7365 6c66 2e72 792c 2073 656c 662e 6765  self.ry, self.ge
+0002efb0: 745f 726f 7461 7469 6f6e 2829 290d 0a0d  t_rotation())...
+0002efc0: 0a20 2020 2064 6566 2062 626f 7828 7365  .    def bbox(se
+0002efd0: 6c66 293a 0d0a 2020 2020 2020 2020 2222  lf):..        ""
+0002efe0: 2246 696e 6420 7468 6520 626f 756e 6469  "Find the boundi
+0002eff0: 6e67 2062 6f78 206f 6620 6120 6172 632e  ng box of a arc.
+0002f000: 0d0a 2020 2020 2020 2020 436f 6465 2066  ..        Code f
+0002f010: 726f 6d3a 2068 7474 7073 3a2f 2f67 6974  rom: https://git
+0002f020: 6875 622e 636f 6d2f 6d61 7468 616e 6479  hub.com/mathandy
+0002f030: 2f73 7667 7061 7468 746f 6f6c 730d 0a20  /svgpathtools.. 
+0002f040: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
+0002f050: 2020 2020 6966 2073 656c 662e 7377 6565      if self.swee
+0002f060: 7020 3d3d 2030 3a0d 0a20 2020 2020 2020  p == 0:..       
+0002f070: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+0002f080: 2e73 7461 7274 2e78 2c20 7365 6c66 2e73  .start.x, self.s
+0002f090: 7461 7274 2e79 2c20 7365 6c66 2e65 6e64  tart.y, self.end
+0002f0a0: 2e78 2c20 7365 6c66 2e65 6e64 2e79 0d0a  .x, self.end.y..
+0002f0b0: 2020 2020 2020 2020 7068 6920 3d20 7365          phi = se
+0002f0c0: 6c66 2e67 6574 5f72 6f74 6174 696f 6e28  lf.get_rotation(
+0002f0d0: 292e 6173 5f72 6164 6961 6e73 0d0a 2020  ).as_radians..  
+0002f0e0: 2020 2020 2020 6966 2063 6f73 2870 6869        if cos(phi
+0002f0f0: 2920 3d3d 2030 3a0d 0a20 2020 2020 2020  ) == 0:..       
+0002f100: 2020 2020 2061 7461 6e5f 7820 3d20 7461       atan_x = ta
+0002f110: 7520 2f20 342e 300d 0a20 2020 2020 2020  u / 4.0..       
+0002f120: 2020 2020 2061 7461 6e5f 7920 3d20 300d       atan_y = 0.
+0002f130: 0a20 2020 2020 2020 2065 6c69 6620 7369  .        elif si
+0002f140: 6e28 7068 6929 203d 3d20 303a 0d0a 2020  n(phi) == 0:..  
+0002f150: 2020 2020 2020 2020 2020 6174 616e 5f78            atan_x
+0002f160: 203d 2030 0d0a 2020 2020 2020 2020 2020   = 0..          
+0002f170: 2020 6174 616e 5f79 203d 2074 6175 202f    atan_y = tau /
+0002f180: 2034 2e30 0d0a 2020 2020 2020 2020 656c   4.0..        el
+0002f190: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+0002f1a0: 2072 782c 2072 7920 3d20 7365 6c66 2e72   rx, ry = self.r
+0002f1b0: 782c 2073 656c 662e 7279 0d0a 2020 2020  x, self.ry..    
+0002f1c0: 2020 2020 2020 2020 6174 616e 5f78 203d          atan_x =
+0002f1d0: 2061 7461 6e28 2d28 7279 202f 2072 7829   atan(-(ry / rx)
+0002f1e0: 202a 2074 616e 2870 6869 2929 0d0a 2020   * tan(phi))..  
+0002f1f0: 2020 2020 2020 2020 2020 6174 616e 5f79            atan_y
+0002f200: 203d 2061 7461 6e28 2872 7920 2f20 7278   = atan((ry / rx
+0002f210: 2920 2f20 7461 6e28 7068 6929 290d 0a0d  ) / tan(phi))...
+0002f220: 0a20 2020 2020 2020 2064 6566 2061 6e67  .        def ang
+0002f230: 6c65 5f69 6e76 2861 6e67 2c20 6b29 3a20  le_inv(ang, k): 
+0002f240: 2023 2069 6e76 6572 7365 206f 6620 616e   # inverse of an
+0002f250: 676c 6520 6672 6f6d 2041 7263 2e64 6572  gle from Arc.der
+0002f260: 6976 6174 6976 6528 290d 0a20 2020 2020  ivative()..     
+0002f270: 2020 2020 2020 2072 6574 7572 6e20 2828         return ((
+0002f280: 616e 6720 2b20 2874 6175 202f 2032 2e30  ang + (tau / 2.0
+0002f290: 2920 2a20 6b29 202a 2028 3336 3020 2f20  ) * k) * (360 / 
+0002f2a0: 7461 7529 202d 2073 656c 662e 7468 6574  tau) - self.thet
+0002f2b0: 6129 202f 2073 656c 662e 6465 6c74 610d  a) / self.delta.
+0002f2c0: 0a0d 0a20 2020 2020 2020 2078 7472 656d  ...        xtrem
+0002f2d0: 6120 3d20 5b73 656c 662e 7374 6172 742e  a = [self.start.
+0002f2e0: 782c 2073 656c 662e 656e 642e 785d 0d0a  x, self.end.x]..
+0002f2f0: 2020 2020 2020 2020 7974 7265 6d61 203d          ytrema =
+0002f300: 205b 7365 6c66 2e73 7461 7274 2e79 2c20   [self.start.y, 
+0002f310: 7365 6c66 2e65 6e64 2e79 5d0d 0a0d 0a20  self.end.y].... 
+0002f320: 2020 2020 2020 2066 6f72 206b 2069 6e20         for k in 
+0002f330: 7261 6e67 6528 2d34 2c20 3529 3a0d 0a20  range(-4, 5):.. 
+0002f340: 2020 2020 2020 2020 2020 2074 7820 3d20             tx = 
+0002f350: 616e 676c 655f 696e 7628 6174 616e 5f78  angle_inv(atan_x
+0002f360: 2c20 6b29 0d0a 2020 2020 2020 2020 2020  , k)..          
+0002f370: 2020 7479 203d 2061 6e67 6c65 5f69 6e76    ty = angle_inv
+0002f380: 2861 7461 6e5f 792c 206b 290d 0a20 2020  (atan_y, k)..   
+0002f390: 2020 2020 2020 2020 2069 6620 3020 3c3d           if 0 <=
+0002f3a0: 2074 7820 3c3d 2031 3a0d 0a20 2020 2020   tx <= 1:..     
+0002f3b0: 2020 2020 2020 2020 2020 2078 7472 656d             xtrem
+0002f3c0: 612e 6170 7065 6e64 2873 656c 662e 706f  a.append(self.po
+0002f3d0: 696e 7428 7478 292e 7829 0d0a 2020 2020  int(tx).x)..    
+0002f3e0: 2020 2020 2020 2020 6966 2030 203c 3d20          if 0 <= 
+0002f3f0: 7479 203c 3d20 313a 0d0a 2020 2020 2020  ty <= 1:..      
+0002f400: 2020 2020 2020 2020 2020 7974 7265 6d61            ytrema
+0002f410: 2e61 7070 656e 6428 7365 6c66 2e70 6f69  .append(self.poi
+0002f420: 6e74 2874 7929 2e79 290d 0a0d 0a20 2020  nt(ty).y)....   
+0002f430: 2020 2020 2072 6574 7572 6e20 6d69 6e28       return min(
+0002f440: 7874 7265 6d61 292c 206d 696e 2879 7472  xtrema), min(ytr
+0002f450: 656d 6129 2c20 6d61 7828 7874 7265 6d61  ema), max(xtrema
+0002f460: 292c 206d 6178 2879 7472 656d 6129 0d0a  ), max(ytrema)..
+0002f470: 0d0a 2020 2020 6465 6620 6428 7365 6c66  ..    def d(self
+0002f480: 2c20 6375 7272 656e 745f 706f 696e 743d  , current_point=
+0002f490: 4e6f 6e65 2c20 7265 6c61 7469 7665 3d4e  None, relative=N
+0002f4a0: 6f6e 652c 2073 6d6f 6f74 683d 4e6f 6e65  one, smooth=None
+0002f4b0: 293a 0d0a 2020 2020 2020 2020 6966 2028  ):..        if (
+0002f4c0: 0d0a 2020 2020 2020 2020 2020 2020 6375  ..            cu
+0002f4d0: 7272 656e 745f 706f 696e 7420 6973 204e  rrent_point is N
+0002f4e0: 6f6e 650d 0a20 2020 2020 2020 2020 2020  one..           
+0002f4f0: 206f 7220 2872 656c 6174 6976 6520 6973   or (relative is
+0002f500: 204e 6f6e 6520 616e 6420 7365 6c66 2e72   None and self.r
+0002f510: 656c 6174 6976 6529 0d0a 2020 2020 2020  elative)..      
+0002f520: 2020 2020 2020 6f72 2028 7265 6c61 7469        or (relati
+0002f530: 7665 2069 7320 6e6f 7420 4e6f 6e65 2061  ve is not None a
+0002f540: 6e64 206e 6f74 2072 656c 6174 6976 6529  nd not relative)
+0002f550: 0d0a 2020 2020 2020 2020 293a 0d0a 2020  ..        ):..  
+0002f560: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0002f570: 2022 4120 2547 2c25 4720 2547 2025 642c   "A %G,%G %G %d,
+0002f580: 2564 2025 7322 2025 2028 0d0a 2020 2020  %d %s" % (..    
+0002f590: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0002f5a0: 2e72 782c 0d0a 2020 2020 2020 2020 2020  .rx,..          
+0002f5b0: 2020 2020 2020 7365 6c66 2e72 792c 0d0a        self.ry,..
+0002f5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f5d0: 7365 6c66 2e67 6574 5f72 6f74 6174 696f  self.get_rotatio
+0002f5e0: 6e28 292e 6173 5f64 6567 7265 6573 2c0d  n().as_degrees,.
+0002f5f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002f600: 2069 6e74 2861 6273 2873 656c 662e 7377   int(abs(self.sw
+0002f610: 6565 7029 203e 2028 7461 7520 2f20 322e  eep) > (tau / 2.
+0002f620: 3029 292c 0d0a 2020 2020 2020 2020 2020  0)),..          
+0002f630: 2020 2020 2020 696e 7428 7365 6c66 2e73        int(self.s
+0002f640: 7765 6570 203e 3d20 3029 2c0d 0a20 2020  weep >= 0),..   
+0002f650: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0002f660: 662e 656e 642c 0d0a 2020 2020 2020 2020  f.end,..        
+0002f670: 2020 2020 290d 0a20 2020 2020 2020 2065      )..        e
+0002f680: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+0002f690: 2020 7265 7475 726e 2022 6120 2547 2c25    return "a %G,%
+0002f6a0: 4720 2547 2025 642c 2564 2025 7322 2025  G %G %d,%d %s" %
+0002f6b0: 2028 0d0a 2020 2020 2020 2020 2020 2020   (..            
+0002f6c0: 2020 2020 7365 6c66 2e72 782c 0d0a 2020      self.rx,..  
+0002f6d0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0002f6e0: 6c66 2e72 792c 0d0a 2020 2020 2020 2020  lf.ry,..        
+0002f6f0: 2020 2020 2020 2020 7365 6c66 2e67 6574          self.get
+0002f700: 5f72 6f74 6174 696f 6e28 292e 6173 5f64  _rotation().as_d
+0002f710: 6567 7265 6573 2c0d 0a20 2020 2020 2020  egrees,..       
+0002f720: 2020 2020 2020 2020 2069 6e74 2861 6273           int(abs
+0002f730: 2873 656c 662e 7377 6565 7029 203e 2028  (self.sweep) > (
+0002f740: 7461 7520 2f20 322e 3029 292c 0d0a 2020  tau / 2.0)),..  
+0002f750: 2020 2020 2020 2020 2020 2020 2020 696e                in
+0002f760: 7428 7365 6c66 2e73 7765 6570 203e 3d20  t(self.sweep >= 
+0002f770: 3029 2c0d 0a20 2020 2020 2020 2020 2020  0),..           
+0002f780: 2020 2020 2073 656c 662e 656e 6420 2d20       self.end - 
+0002f790: 6375 7272 656e 745f 706f 696e 742c 0d0a  current_point,..
+0002f7a0: 2020 2020 2020 2020 2020 2020 290d 0a0d              )...
+0002f7b0: 0a0d 0a63 6c61 7373 2050 6174 6828 5368  ...class Path(Sh
+0002f7c0: 6170 652c 204d 7574 6162 6c65 5365 7175  ape, MutableSequ
+0002f7d0: 656e 6365 293a 0d0a 2020 2020 2222 220d  ence):..    """.
+0002f7e0: 0a20 2020 2041 2050 6174 6820 6973 2061  .    A Path is a
+0002f7f0: 204d 7574 6162 6c65 2073 6571 7565 6e63   Mutable sequenc
+0002f800: 6520 6f66 2070 6174 6820 7365 676d 656e  e of path segmen
+0002f810: 7473 0d0a 0d0a 2020 2020 4974 2069 7320  ts....    It is 
+0002f820: 6120 6765 6e65 7261 6c69 7a65 6420 7368  a generalized sh
+0002f830: 6170 6520 7768 6963 6820 6361 6e20 6d61  ape which can ma
+0002f840: 7020 6f75 7420 616c 6c20 7468 6520 6f74  p out all the ot
+0002f850: 6865 7220 7368 6170 6573 2e0d 0a0d 0a20  her shapes..... 
+0002f860: 2020 2045 6163 6820 5061 7468 5365 676d     Each PathSegm
+0002f870: 656e 7420 6f62 6a65 6374 206d 6170 7320  ent object maps 
+0002f880: 6120 7061 7274 6963 756c 6172 2063 6f6d  a particular com
+0002f890: 6d61 6e64 2e20 4561 6368 206f 6e65 2065  mand. Each one e
+0002f8a0: 7869 7374 7320 6f6e 6c79 206f 6e63 6520  xists only once 
+0002f8b0: 696e 2065 6163 6820 7061 7468 2061 6e64  in each path and
+0002f8c0: 2065 7665 7279 2070 6f69 6e74 2063 6f6e   every point con
+0002f8d0: 7461 696e 6564 0d0a 2020 2020 7769 7468  tained..    with
+0002f8e0: 696e 2074 6865 206f 626a 6563 7420 6973  in the object is
+0002f8f0: 2061 6c73 6f20 756e 6971 7565 2e20 5765   also unique. We
+0002f900: 2061 7474 656d 7074 2074 6f20 696e 7465   attempt to inte
+0002f910: 726e 616c 6c79 206d 6169 6e74 6169 6e20  rnally maintain 
+0002f920: 736f 6d65 2076 616c 6964 6974 792e 2045  some validity. E
+0002f930: 6163 6820 656e 6420 706f 696e 7420 7368  ach end point sh
+0002f940: 6f75 6c64 206c 696e 6b0d 0a20 2020 2074  ould link..    t
+0002f950: 6f20 7468 6520 666f 6c6c 6f77 696e 6720  o the following 
+0002f960: 7365 676d 656e 7473 2073 7461 7274 2070  segments start p
+0002f970: 6f69 6e74 2e20 416e 6420 6561 6368 2063  oint. And each c
+0002f980: 6c6f 7365 2070 6f69 6e74 2073 686f 756c  lose point shoul
+0002f990: 6420 636f 6e6e 6563 7420 6672 6f6d 2074  d connect from t
+0002f9a0: 6865 2070 7265 6365 6469 6e67 2073 6567  he preceding seg
+0002f9b0: 6d65 6e74 7320 656e 6470 6f69 6e74 2074  ments endpoint t
+0002f9c0: 6f0d 0a20 2020 2074 6865 206c 6173 7420  o..    the last 
+0002f9d0: 4d6f 7665 2063 6f6d 6d61 6e64 2e0d 0a0d  Move command....
+0002f9e0: 0a20 2020 2054 6865 7365 2061 7265 2073  .    These are s
+0002f9f0: 6f66 7420 6368 6563 6b73 206d 6164 6520  oft checks made 
+0002fa00: 6f6e 6c79 2061 7420 7468 6520 7469 6d65  only at the time
+0002fa10: 206f 6620 6164 6469 7469 6f6e 2061 6e64   of addition and
+0002fa20: 2073 6f6d 6520 6d61 6e69 7075 6c61 7469   some manipulati
+0002fa30: 6f6e 732e 204d 6f64 6966 7969 6e67 2074  ons. Modifying t
+0002fa40: 6865 2070 6f69 6e74 7320 6f66 2074 6865  he points of the
+0002fa50: 2073 6567 6d65 6e74 730d 0a20 2020 2063   segments..    c
+0002fa60: 616e 2061 6e64 2077 696c 6c20 6361 7573  an and will caus
+0002fa70: 6520 7061 7468 2069 6e76 616c 6964 6974  e path invalidit
+0002fa80: 792e 2053 6f6d 6520 5356 4720 696e 7661  y. Some SVG inva
+0002fa90: 6c69 6420 6f70 6572 6174 696f 6e73 2061  lid operations a
+0002faa0: 7265 2070 6572 6d69 7474 6564 2073 7563  re permitted suc
+0002fab0: 6820 6173 2061 7263 7320 6c6f 6e67 6572  h as arcs longer
+0002fac0: 2074 6861 6e20 7461 7520 7261 6469 616e   than tau radian
+0002fad0: 730d 0a20 2020 206f 7220 6265 6769 6e6e  s..    or beginn
+0002fae0: 696e 6720 7365 7175 656e 6365 7320 7769  ing sequences wi
+0002faf0: 7468 6f75 7420 6120 6d6f 7665 2e20 5468  thout a move. Th
+0002fb00: 6520 6578 7065 6374 6174 696f 6e20 6973  e expectation is
+0002fb10: 2074 6861 7420 7468 6573 6520 7769 6c6c   that these will
+0002fb20: 2065 7665 6e74 7561 6c6c 7920 6265 2075   eventually be u
+0002fb30: 7365 6420 6173 2070 6172 7420 6f66 2061  sed as part of a
+0002fb40: 2076 616c 6964 2070 6174 680d 0a20 2020   valid path..   
+0002fb50: 2073 6f20 7468 6573 6520 6672 6167 6d65   so these fragme
+0002fb60: 6e74 2070 6174 6873 2061 7265 2070 6572  nt paths are per
+0002fb70: 6d69 7474 6564 2e20 496e 2073 6f6d 6520  mitted. In some 
+0002fb80: 6361 7365 7320 7468 6573 6520 696e 7661  cases these inva
+0002fb90: 6c69 6420 7061 7468 7320 7769 6c6c 2073  lid paths will s
+0002fba0: 7469 6c6c 2068 6176 6520 636f 6e73 6973  till have consis
+0002fbb0: 7465 6e74 2070 6174 685f 6420 7661 6c75  tent path_d valu
+0002fbc0: 6573 2c0d 0a20 2020 2069 6e20 6f74 6865  es,..    in othe
+0002fbd0: 7220 6361 7365 732c 2074 6865 7265 2077  r cases, there w
+0002fbe0: 696c 6c20 6265 206e 6f20 7661 6c69 6420  ill be no valid 
+0002fbf0: 6d65 7468 6f64 7320 746f 2072 6570 726f  methods to repro
+0002fc00: 6475 6365 2074 6865 7365 2e0d 0a0d 0a20  duce these..... 
+0002fc10: 2020 2049 6e73 7461 6e74 6961 7469 6f6e     Instantiation
+0002fc20: 2066 6f72 6d61 7473 3a0d 0a0d 0a20 2020   formats:....   
+0002fc30: 2050 6174 6828 2264 2d73 7472 696e 6722   Path("d-string"
+0002fc40: 2c20 6b65 7977 6f72 6473 290d 0a20 2020  , keywords)..   
+0002fc50: 2050 6174 6828 7061 7468 7365 676d 656e   Path(pathsegmen
+0002fc60: 7431 2c2e 2e2e 290d 0a20 2020 2050 6174  t1,...)..    Pat
+0002fc70: 6828 643d 2264 2d73 7472 696e 6722 2c20  h(d="d-string", 
+0002fc80: 6f74 6865 7220 6b65 7977 6f72 6473 290d  other keywords).
+0002fc90: 0a20 2020 2022 2222 0d0a 0d0a 2020 2020  .    """....    
+0002fca0: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
+0002fcb0: 662c 202a 6172 6773 2c20 2a2a 6b77 6172  f, *args, **kwar
+0002fcc0: 6773 293a 0d0a 2020 2020 2020 2020 5368  gs):..        Sh
+0002fcd0: 6170 652e 5f5f 696e 6974 5f5f 2873 656c  ape.__init__(sel
+0002fce0: 662c 202a 6172 6773 2c20 2a2a 6b77 6172  f, *args, **kwar
+0002fcf0: 6773 290d 0a20 2020 2020 2020 2073 656c  gs)..        sel
+0002fd00: 662e 5f6c 656e 6774 6820 3d20 4e6f 6e65  f._length = None
+0002fd10: 0d0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
+0002fd20: 6c65 6e67 7468 7320 3d20 4e6f 6e65 0d0a  lengths = None..
+0002fd30: 2020 2020 2020 2020 7365 6c66 2e5f 7365          self._se
+0002fd40: 676d 656e 7473 203d 206c 6973 7428 290d  gments = list().
+0002fd50: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
+0002fd60: 6172 6773 2920 213d 2031 3a0d 0a20 2020  args) != 1:..   
+0002fd70: 2020 2020 2020 2020 2066 6f72 2073 6567           for seg
+0002fd80: 6d65 6e74 2069 6e20 6172 6773 3a0d 0a20  ment in args:.. 
+0002fd90: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0002fda0: 6620 6e6f 7420 6973 696e 7374 616e 6365  f not isinstance
+0002fdb0: 2873 6567 6d65 6e74 2c20 5061 7468 5365  (segment, PathSe
+0002fdc0: 676d 656e 7429 3a0d 0a20 2020 2020 2020  gment):..       
+0002fdd0: 2020 2020 2020 2020 2020 2020 2072 6169               rai
+0002fde0: 7365 2056 616c 7565 4572 726f 7228 0d0a  se ValueError(..
+0002fdf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002fe00: 2020 2020 2020 2020 224f 626a 6563 7420          "Object 
+0002fe10: 6e6f 7420 5061 7468 5365 676d 656e 7420  not PathSegment 
+0002fe20: 7768 656e 2069 6e73 7461 6e74 6961 7469  when instantiati
+0002fe30: 6e67 2061 2050 6174 683a 2025 7322 0d0a  ng a Path: %s"..
+0002fe40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002fe50: 2020 2020 2020 2020 2520 7365 676d 656e          % segmen
+0002fe60: 742e 5f5f 636c 6173 735f 5f2e 5f5f 6e61  t.__class__.__na
+0002fe70: 6d65 5f5f 0d0a 2020 2020 2020 2020 2020  me__..          
+0002fe80: 2020 2020 2020 2020 2020 290d 0a20 2020            )..   
+0002fe90: 2020 2020 2020 2020 2073 656c 662e 5f73           self._s
+0002fea0: 6567 6d65 6e74 732e 6578 7465 6e64 2861  egments.extend(a
+0002feb0: 7267 7329 0d0a 2020 2020 2020 2020 656c  rgs)..        el
+0002fec0: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+0002fed0: 2073 203d 2061 7267 735b 305d 0d0a 2020   s = args[0]..  
+0002fee0: 2020 2020 2020 2020 2020 6966 2069 7369            if isi
+0002fef0: 6e73 7461 6e63 6528 732c 2053 7562 7061  nstance(s, Subpa
+0002ff00: 7468 293a 0d0a 2020 2020 2020 2020 2020  th):..          
+0002ff10: 2020 2020 2020 7365 6c66 2e5f 7365 676d        self._segm
+0002ff20: 656e 7473 2e65 7874 656e 6428 732e 7365  ents.extend(s.se
+0002ff30: 676d 656e 7473 2874 7261 6e73 666f 726d  gments(transform
+0002ff40: 6564 3d46 616c 7365 2929 0d0a 2020 2020  ed=False))..    
+0002ff50: 2020 2020 2020 2020 2020 2020 5368 6170              Shap
+0002ff60: 652e 5f5f 696e 6974 5f5f 2873 656c 662c  e.__init__(self,
+0002ff70: 2073 2e5f 7061 7468 290d 0a20 2020 2020   s._path)..     
+0002ff80: 2020 2020 2020 2065 6c69 6620 6973 696e         elif isin
+0002ff90: 7374 616e 6365 2873 2c20 5368 6170 6529  stance(s, Shape)
+0002ffa0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0002ffb0: 2020 2073 656c 662e 5f73 6567 6d65 6e74     self._segment
+0002ffc0: 732e 6578 7465 6e64 2873 2e73 6567 6d65  s.extend(s.segme
+0002ffd0: 6e74 7328 7472 616e 7366 6f72 6d65 643d  nts(transformed=
+0002ffe0: 4661 6c73 6529 290d 0a20 2020 2020 2020  False))..       
+0002fff0: 2020 2020 2065 6c69 6620 6973 696e 7374       elif isinst
+00030000: 616e 6365 2873 2c20 7374 7229 3a0d 0a20  ance(s, str):.. 
+00030010: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00030020: 656c 662e 5f73 6567 6d65 6e74 7320 3d20  elf._segments = 
+00030030: 6c69 7374 2829 0d0a 2020 2020 2020 2020  list()..        
+00030040: 2020 2020 2020 2020 7365 6c66 2e70 6172          self.par
+00030050: 7365 2873 290d 0a20 2020 2020 2020 2020  se(s)..         
+00030060: 2020 2065 6c69 6620 6973 696e 7374 616e     elif isinstan
+00030070: 6365 2873 2c20 7475 706c 6529 3a0d 0a20  ce(s, tuple):.. 
+00030080: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00030090: 2057 6520 6861 7665 206e 6f20 6775 6172   We have no guar
+000300a0: 616e 7465 6520 6f66 2074 6865 2076 616c  antee of the val
+000300b0: 6964 6974 7920 6f66 2074 6865 2073 6f75  idity of the sou
+000300c0: 7263 6520 6461 7461 0d0a 2020 2020 2020  rce data..      
+000300d0: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+000300e0: 7365 676d 656e 7473 2e65 7874 656e 6428  segments.extend(
+000300f0: 7329 0d0a 2020 2020 2020 2020 2020 2020  s)..            
+00030100: 2020 2020 7365 6c66 2e76 616c 6964 6174      self.validat
+00030110: 655f 636f 6e6e 6563 7469 6f6e 7328 290d  e_connections().
+00030120: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
+00030130: 6620 6973 696e 7374 616e 6365 2873 2c20  f isinstance(s, 
+00030140: 6c69 7374 293a 0d0a 2020 2020 2020 2020  list):..        
+00030150: 2020 2020 2020 2020 2320 5765 2068 6176          # We hav
+00030160: 6520 6e6f 2067 7561 7261 6e74 6565 206f  e no guarantee o
+00030170: 6620 7468 6520 7661 6c69 6469 7479 206f  f the validity o
+00030180: 6620 7468 6520 736f 7572 6365 2064 6174  f the source dat
+00030190: 610d 0a20 2020 2020 2020 2020 2020 2020  a..             
+000301a0: 2020 2073 656c 662e 5f73 6567 6d65 6e74     self._segment
+000301b0: 732e 6578 7465 6e64 2873 290d 0a20 2020  s.extend(s)..   
+000301c0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+000301d0: 662e 7661 6c69 6461 7465 5f63 6f6e 6e65  f.validate_conne
+000301e0: 6374 696f 6e73 2829 0d0a 2020 2020 2020  ctions()..      
+000301f0: 2020 2020 2020 656c 6966 2069 7369 6e73        elif isins
+00030200: 7461 6e63 6528 732c 2050 6174 6853 6567  tance(s, PathSeg
+00030210: 6d65 6e74 293a 0d0a 2020 2020 2020 2020  ment):..        
+00030220: 2020 2020 2020 2020 7365 6c66 2e5f 7365          self._se
+00030230: 676d 656e 7473 2e61 7070 656e 6428 7329  gments.append(s)
+00030240: 0d0a 2020 2020 2020 2020 6966 2053 5647  ..        if SVG
+00030250: 5f41 5454 525f 4441 5441 2069 6e20 7365  _ATTR_DATA in se
+00030260: 6c66 2e76 616c 7565 733a 0d0a 2020 2020  lf.values:..    
+00030270: 2020 2020 2020 2020 2320 4e6f 7420 7375          # Not su
+00030280: 7265 2077 6861 7420 7468 6520 7075 7270  re what the purp
+00030290: 6f73 6520 6f66 2070 6174 6864 5f6c 6f61  ose of pathd_loa
+000302a0: 6465 6420 6973 2e0d 0a20 2020 2020 2020  ded is...       
+000302b0: 2020 2020 2023 2049 7420 6973 206f 6e6c       # It is onl
+000302c0: 7920 7365 7420 616e 6420 6368 6563 6b65  y set and checke
+000302d0: 6420 6865 7265 2061 6e64 2079 6f75 2063  d here and you c
+000302e0: 616e 6e6f 7420 6861 7665 2022 6422 2061  annot have "d" a
+000302f0: 7474 7269 6275 7465 206d 6f72 6520 7468  ttribute more th
+00030300: 616e 206f 6e63 6520 616e 7977 6179 0d0a  an once anyway..
+00030310: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+00030320: 6f74 2073 656c 662e 7661 6c75 6573 2e67  ot self.values.g
+00030330: 6574 2822 7061 7468 645f 6c6f 6164 6564  et("pathd_loaded
+00030340: 222c 2046 616c 7365 293a 0d0a 2020 2020  ", False):..    
+00030350: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00030360: 2e70 6172 7365 2873 656c 662e 7661 6c75  .parse(self.valu
+00030370: 6573 5b53 5647 5f41 5454 525f 4441 5441  es[SVG_ATTR_DATA
+00030380: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
+00030390: 2020 2020 7365 6c66 2e76 616c 7565 735b      self.values[
+000303a0: 2270 6174 6864 5f6c 6f61 6465 6422 5d20  "pathd_loaded"] 
+000303b0: 3d20 5472 7565 0d0a 0d0a 2020 2020 6465  = True....    de
+000303c0: 6620 5f5f 636f 7079 5f5f 2873 656c 6629  f __copy__(self)
+000303d0: 3a0d 0a20 2020 2020 2020 2070 6174 6820  :..        path 
+000303e0: 3d20 5061 7468 2873 656c 6629 0d0a 2020  = Path(self)..  
+000303f0: 2020 2020 2020 7365 6773 203d 2070 6174        segs = pat
+00030400: 682e 5f73 6567 6d65 6e74 730d 0a20 2020  h._segments..   
+00030410: 2020 2020 2066 6f72 2069 2069 6e20 7261       for i in ra
+00030420: 6e67 6528 302c 206c 656e 2873 6567 7329  nge(0, len(segs)
+00030430: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00030440: 7365 6773 5b69 5d20 3d20 636f 7079 2873  segs[i] = copy(s
+00030450: 6567 735b 695d 290d 0a20 2020 2020 2020  egs[i])..       
+00030460: 2072 6574 7572 6e20 7061 7468 0d0a 0d0a   return path....
+00030470: 2020 2020 6465 6620 5f5f 6765 7469 7465      def __getite
+00030480: 6d5f 5f28 7365 6c66 2c20 696e 6465 7829  m__(self, index)
+00030490: 3a0d 0a20 2020 2020 2020 2072 6574 7572  :..        retur
+000304a0: 6e20 7365 6c66 2e5f 7365 676d 656e 7473  n self._segments
+000304b0: 5b69 6e64 6578 5d0d 0a0d 0a20 2020 2064  [index]....    d
+000304c0: 6566 205f 7661 6c69 6461 7465 5f73 7562  ef _validate_sub
+000304d0: 7061 7468 2873 656c 662c 2069 6e64 6578  path(self, index
+000304e0: 293a 0d0a 2020 2020 2020 2020 2222 2265  ):..        """e
+000304f0: 6e73 7572 6520 7468 6520 7375 6270 6174  nsure the subpat
+00030500: 6820 636f 6e74 6169 6e69 6e67 2074 6869  h containing thi
+00030510: 7320 696e 6465 7820 6973 2076 616c 6964  s index is valid
+00030520: 2e22 2222 0d0a 2020 2020 2020 2020 6966  ."""..        if
+00030530: 2069 6e64 6578 203c 2030 206f 7220 696e   index < 0 or in
+00030540: 6465 7820 2b20 3120 3e3d 206c 656e 2873  dex + 1 >= len(s
+00030550: 656c 662e 5f73 6567 6d65 6e74 7329 3a0d  elf._segments):.
+00030560: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00030570: 7572 6e20 2023 2054 6869 7320 636f 6e6e  urn  # This conn
+00030580: 6563 7469 6f6e 2064 6f65 736e 2774 2065  ection doesn't e
+00030590: 7869 7374 2e0d 0a20 2020 2020 2020 2066  xist...        f
+000305a0: 6f72 206a 2069 6e20 7261 6e67 6528 696e  or j in range(in
+000305b0: 6465 782c 206c 656e 2873 656c 662e 5f73  dex, len(self._s
+000305c0: 6567 6d65 6e74 7329 293a 0d0a 2020 2020  egments)):..    
+000305d0: 2020 2020 2020 2020 636c 6f73 655f 7365          close_se
+000305e0: 6172 6368 203d 2073 656c 662e 5f73 6567  arch = self._seg
+000305f0: 6d65 6e74 735b 6a5d 0d0a 2020 2020 2020  ments[j]..      
+00030600: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+00030610: 6e63 6528 636c 6f73 655f 7365 6172 6368  nce(close_search
+00030620: 2c20 4d6f 7665 293a 0d0a 2020 2020 2020  , Move):..      
+00030630: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00030640: 2020 2320 4e6f 7420 6120 636c 6f73 6564    # Not a closed
+00030650: 2070 6174 682c 2073 7562 7061 7468 2069   path, subpath i
+00030660: 7320 7661 6c69 642e 0d0a 2020 2020 2020  s valid...      
+00030670: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+00030680: 6e63 6528 636c 6f73 655f 7365 6172 6368  nce(close_search
+00030690: 2c20 436c 6f73 6529 3a0d 0a20 2020 2020  , Close):..     
+000306a0: 2020 2020 2020 2020 2020 2066 6f72 206b             for k
+000306b0: 2069 6e20 7261 6e67 6528 696e 6465 782c   in range(index,
+000306c0: 202d 312c 202d 3129 3a0d 0a20 2020 2020   -1, -1):..     
+000306d0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+000306e0: 6f76 655f 7365 6172 6368 203d 2073 656c  ove_search = sel
+000306f0: 662e 5f73 6567 6d65 6e74 735b 6b5d 0d0a  f._segments[k]..
+00030700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030710: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+00030720: 6528 6d6f 7665 5f73 6561 7263 682c 204d  e(move_search, M
+00030730: 6f76 6529 3a0d 0a20 2020 2020 2020 2020  ove):..         
+00030740: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00030750: 656c 662e 5f73 6567 6d65 6e74 735b 6a5d  elf._segments[j]
+00030760: 2e65 6e64 203d 2050 6f69 6e74 286d 6f76  .end = Point(mov
+00030770: 655f 7365 6172 6368 2e65 6e64 290d 0a20  e_search.end).. 
+00030780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030790: 2020 2020 2020 2072 6574 7572 6e0d 0a20         return.. 
+000307a0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000307b0: 656c 662e 5f73 6567 6d65 6e74 735b 6a5d  elf._segments[j]
+000307c0: 2e65 6e64 203d 2050 6f69 6e74 2873 656c  .end = Point(sel
+000307d0: 662e 5f73 6567 6d65 6e74 735b 305d 2e65  f._segments[0].e
+000307e0: 6e64 290d 0a20 2020 2020 2020 2020 2020  nd)..           
+000307f0: 2020 2020 2072 6574 7572 6e0d 0a0d 0a20       return.... 
+00030800: 2020 2064 6566 205f 7661 6c69 6461 7465     def _validate
+00030810: 5f6d 6f76 6528 7365 6c66 2c20 696e 6465  _move(self, inde
+00030820: 7829 3a0d 0a20 2020 2020 2020 2022 2222  x):..        """
+00030830: 656e 7375 7265 2074 6865 206e 6578 7420  ensure the next 
+00030840: 636c 6f73 6564 2070 6f69 6e74 2066 726f  closed point fro
+00030850: 6d20 7468 6973 2069 6e64 6578 2070 6f69  m this index poi
+00030860: 6e74 7320 746f 2061 2076 616c 6964 206c  nts to a valid l
+00030870: 6f63 6174 696f 6e2e 2222 220d 0a20 2020  ocation."""..   
+00030880: 2020 2020 2066 6f72 2069 2069 6e20 7261       for i in ra
+00030890: 6e67 6528 696e 6465 7820 2b20 312c 206c  nge(index + 1, l
+000308a0: 656e 2873 656c 662e 5f73 6567 6d65 6e74  en(self._segment
+000308b0: 7329 293a 0d0a 2020 2020 2020 2020 2020  s)):..          
+000308c0: 2020 7365 676d 656e 7420 3d20 7365 6c66    segment = self
+000308d0: 2e5f 7365 676d 656e 7473 5b69 5d0d 0a20  ._segments[i].. 
+000308e0: 2020 2020 2020 2020 2020 2069 6620 6973             if is
+000308f0: 696e 7374 616e 6365 2873 6567 6d65 6e74  instance(segment
+00030900: 2c20 4d6f 7665 293a 0d0a 2020 2020 2020  , Move):..      
+00030910: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00030920: 2020 2320 4e6f 7420 6120 636c 6f73 6564    # Not a closed
+00030930: 2070 6174 682c 2074 6865 206d 6f76 6520   path, the move 
+00030940: 6973 2076 616c 6964 2e0d 0a20 2020 2020  is valid...     
+00030950: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
+00030960: 616e 6365 2873 6567 6d65 6e74 2c20 436c  ance(segment, Cl
+00030970: 6f73 6529 3a0d 0a20 2020 2020 2020 2020  ose):..         
+00030980: 2020 2020 2020 2073 6567 6d65 6e74 2e65         segment.e
+00030990: 6e64 203d 2050 6f69 6e74 2873 656c 662e  nd = Point(self.
+000309a0: 5f73 6567 6d65 6e74 735b 696e 6465 785d  _segments[index]
+000309b0: 2e65 6e64 290d 0a20 2020 2020 2020 2020  .end)..         
+000309c0: 2020 2020 2020 2072 6574 7572 6e0d 0a0d         return...
+000309d0: 0a20 2020 2064 6566 205f 7661 6c69 6461  .    def _valida
+000309e0: 7465 5f63 6c6f 7365 2873 656c 662c 2069  te_close(self, i
+000309f0: 6e64 6578 293a 0d0a 2020 2020 2020 2020  ndex):..        
+00030a00: 2222 2265 6e73 7572 6520 7468 6520 636c  """ensure the cl
+00030a10: 6f73 6520 656c 656d 656e 7420 6174 2074  ose element at t
+00030a20: 6869 7320 706f 7369 7469 6f6e 2063 6f72  his position cor
+00030a30: 7265 6374 6c79 206c 696e 6b73 2074 6f20  rectly links to 
+00030a40: 7468 6520 7072 6576 696f 7573 206d 6f76  the previous mov
+00030a50: 6522 2222 0d0a 2020 2020 2020 2020 666f  e"""..        fo
+00030a60: 7220 6920 696e 2072 616e 6765 2869 6e64  r i in range(ind
+00030a70: 6578 2c20 2d31 2c20 2d31 293a 0d0a 2020  ex, -1, -1):..  
+00030a80: 2020 2020 2020 2020 2020 7365 676d 656e            segmen
+00030a90: 7420 3d20 7365 6c66 2e5f 7365 676d 656e  t = self._segmen
+00030aa0: 7473 5b69 5d0d 0a20 2020 2020 2020 2020  ts[i]..         
+00030ab0: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+00030ac0: 2873 6567 6d65 6e74 2c20 4d6f 7665 293a  (segment, Move):
+00030ad0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00030ae0: 2020 7365 6c66 2e5f 7365 676d 656e 7473    self._segments
+00030af0: 5b69 6e64 6578 5d2e 656e 6420 3d20 506f  [index].end = Po
+00030b00: 696e 7428 7365 676d 656e 742e 656e 6429  int(segment.end)
+00030b10: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00030b20: 2020 7265 7475 726e 0d0a 2020 2020 2020    return..      
+00030b30: 2020 7365 6c66 2e5f 7365 676d 656e 7473    self._segments
+00030b40: 5b69 6e64 6578 5d2e 656e 6420 3d20 280d  [index].end = (.
+00030b50: 0a20 2020 2020 2020 2020 2020 2050 6f69  .            Poi
+00030b60: 6e74 2873 656c 662e 5f73 6567 6d65 6e74  nt(self._segment
+00030b70: 735b 305d 2e65 6e64 2920 6966 2073 656c  s[0].end) if sel
+00030b80: 662e 5f73 6567 6d65 6e74 735b 305d 2e65  f._segments[0].e
+00030b90: 6e64 2069 7320 6e6f 7420 4e6f 6e65 2065  nd is not None e
+00030ba0: 6c73 6520 4e6f 6e65 0d0a 2020 2020 2020  lse None..      
+00030bb0: 2020 290d 0a20 2020 2020 2020 2023 2049    )..        # I
+00030bc0: 6620 6d6f 7665 2069 7320 6e65 7665 7220  f move is never 
+00030bd0: 666f 756e 642c 206a 7573 7420 7468 6520  found, just the 
+00030be0: 656e 6420 706f 696e 7420 6f66 2074 6865  end point of the
+00030bf0: 2066 6972 7374 2065 6c65 6d65 6e74 2e20   first element. 
+00030c00: 556e 6c65 7373 2074 6861 7427 7320 6e6f  Unless that's no
+00030c10: 7420 6120 7468 696e 672e 0d0a 0d0a 2020  t a thing.....  
+00030c20: 2020 6465 6620 5f76 616c 6964 6174 655f    def _validate_
+00030c30: 636f 6e6e 6563 7469 6f6e 2873 656c 662c  connection(self,
+00030c40: 2069 6e64 6578 2c20 7072 6566 6572 5f73   index, prefer_s
+00030c50: 6563 6f6e 643d 4661 6c73 6529 3a0d 0a20  econd=False):.. 
+00030c60: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
+00030c70: 2020 2020 5661 6c69 6461 7465 7320 7468      Validates th
+00030c80: 6520 636f 6e6e 6563 7469 6f6e 2061 7420  e connection at 
+00030c90: 7468 6520 696e 6465 782e 0d0a 2020 2020  the index...    
+00030ca0: 2020 2020 436f 6e6e 6563 7469 6f6e 2030      Connection 0
+00030cb0: 2069 7320 7468 6520 636f 6e6e 6563 7469   is the connecti
+00030cc0: 6f6e 2062 6574 7765 656e 2067 6574 6974  on between getit
+00030cd0: 656d 2830 2920 616e 6420 6765 7469 7465  em(0) and getite
+00030ce0: 6d28 3129 0d0a 0d0a 2020 2020 2020 2020  m(1)....        
+00030cf0: 7072 6566 6572 5f73 6563 6f6e 6420 6973  prefer_second is
+00030d00: 2066 6f72 2074 686f 7365 2063 6173 6573   for those cases
+00030d10: 2077 6865 7265 2066 6169 6c69 6e67 2074   where failing t
+00030d20: 6865 2063 6f6e 6e65 6374 696f 6e20 7265  he connection re
+00030d30: 7175 6972 6573 2072 6570 6c61 6369 6e67  quires replacing
+00030d40: 0d0a 2020 2020 2020 2020 6120 6578 6973  ..        a exis
+00030d50: 7469 6e67 2076 616c 7565 2e20 4974 2077  ting value. It w
+00030d60: 696c 6c20 7072 6566 6572 2074 6865 2061  ill prefer the a
+00030d70: 7574 686f 7269 7479 206f 6620 7269 6768  uthority of righ
+00030d80: 7420 7369 6465 2c20 7365 636f 6e64 2076  t side, second v
+00030d90: 616c 7565 2e0d 0a20 2020 2020 2020 2022  alue...        "
+00030da0: 2222 0d0a 2020 2020 2020 2020 6966 2069  ""..        if i
+00030db0: 6e64 6578 203c 2030 206f 7220 696e 6465  ndex < 0 or inde
+00030dc0: 7820 2b20 3120 3e3d 206c 656e 2873 656c  x + 1 >= len(sel
+00030dd0: 662e 5f73 6567 6d65 6e74 7329 3a0d 0a20  f._segments):.. 
+00030de0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00030df0: 6e20 2023 2054 6869 7320 636f 6e6e 6563  n  # This connec
+00030e00: 7469 6f6e 2064 6f65 736e 2774 2065 7869  tion doesn't exi
+00030e10: 7374 2e0d 0a20 2020 2020 2020 2066 6972  st...        fir
+00030e20: 7374 203d 2073 656c 662e 5f73 6567 6d65  st = self._segme
+00030e30: 6e74 735b 696e 6465 785d 0d0a 2020 2020  nts[index]..    
+00030e40: 2020 2020 7365 636f 6e64 203d 2073 656c      second = sel
+00030e50: 662e 5f73 6567 6d65 6e74 735b 696e 6465  f._segments[inde
+00030e60: 7820 2b20 315d 0d0a 2020 2020 2020 2020  x + 1]..        
+00030e70: 6966 2066 6972 7374 2e65 6e64 2069 7320  if first.end is 
+00030e80: 6e6f 7420 4e6f 6e65 2061 6e64 2073 6563  not None and sec
+00030e90: 6f6e 642e 7374 6172 7420 6973 204e 6f6e  ond.start is Non
+00030ea0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00030eb0: 7365 636f 6e64 2e73 7461 7274 203d 2050  second.start = P
+00030ec0: 6f69 6e74 2866 6972 7374 2e65 6e64 290d  oint(first.end).
+00030ed0: 0a20 2020 2020 2020 2065 6c69 6620 6669  .        elif fi
+00030ee0: 7273 742e 656e 6420 6973 204e 6f6e 6520  rst.end is None 
+00030ef0: 616e 6420 7365 636f 6e64 2e73 7461 7274  and second.start
+00030f00: 2069 7320 6e6f 7420 4e6f 6e65 3a0d 0a20   is not None:.. 
+00030f10: 2020 2020 2020 2020 2020 2066 6972 7374             first
+00030f20: 2e65 6e64 203d 2050 6f69 6e74 2873 6563  .end = Point(sec
+00030f30: 6f6e 642e 7374 6172 7429 0d0a 2020 2020  ond.start)..    
+00030f40: 2020 2020 656c 6966 2066 6972 7374 2e65      elif first.e
+00030f50: 6e64 2021 3d20 7365 636f 6e64 2e73 7461  nd != second.sta
+00030f60: 7274 3a0d 0a20 2020 2020 2020 2020 2020  rt:..           
+00030f70: 2023 2054 6865 2074 776f 2076 616c 7565   # The two value
+00030f80: 7320 6578 6973 7420 6275 7420 6172 6520  s exist but are 
+00030f90: 6e6f 7420 6571 7561 6c2e 204f 6e65 206d  not equal. One m
+00030fa0: 7573 7420 7265 706c 6163 6520 7468 6520  ust replace the 
+00030fb0: 6f74 6865 722e 0d0a 2020 2020 2020 2020  other...        
+00030fc0: 2020 2020 6966 2070 7265 6665 725f 7365      if prefer_se
+00030fd0: 636f 6e64 3a0d 0a20 2020 2020 2020 2020  cond:..         
+00030fe0: 2020 2020 2020 2066 6972 7374 2e65 6e64         first.end
+00030ff0: 203d 2050 6f69 6e74 2873 6563 6f6e 642e   = Point(second.
+00031000: 7374 6172 7429 0d0a 2020 2020 2020 2020  start)..        
+00031010: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
+00031020: 2020 2020 2020 2020 2020 2073 6563 6f6e             secon
+00031030: 642e 7374 6172 7420 3d20 506f 696e 7428  d.start = Point(
+00031040: 6669 7273 742e 656e 6429 0d0a 0d0a 2020  first.end)....  
+00031050: 2020 6465 6620 5f5f 7365 7469 7465 6d5f    def __setitem_
+00031060: 5f28 7365 6c66 2c20 696e 6465 782c 206e  _(self, index, n
+00031070: 6577 5f65 6c65 6d65 6e74 293a 0d0a 2020  ew_element):..  
+00031080: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+00031090: 6e63 6528 6e65 775f 656c 656d 656e 742c  nce(new_element,
+000310a0: 2073 7472 293a 0d0a 2020 2020 2020 2020   str):..        
+000310b0: 2020 2020 6e65 775f 656c 656d 656e 7420      new_element 
+000310c0: 3d20 5061 7468 286e 6577 5f65 6c65 6d65  = Path(new_eleme
+000310d0: 6e74 290d 0a20 2020 2020 2020 2020 2020  nt)..           
+000310e0: 2069 6620 6c65 6e28 6e65 775f 656c 656d   if len(new_elem
+000310f0: 656e 7429 203d 3d20 303a 0d0a 2020 2020  ent) == 0:..    
+00031100: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00031110: 726e 0d0a 2020 2020 2020 2020 2020 2020  rn..            
+00031120: 6e65 775f 656c 656d 656e 7420 3d20 6e65  new_element = ne
+00031130: 775f 656c 656d 656e 742e 7365 676d 656e  w_element.segmen
+00031140: 7473 2829 0d0a 2020 2020 2020 2020 2020  ts()..          
+00031150: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+00031160: 696e 6465 782c 2069 6e74 293a 0d0a 2020  index, int):..  
+00031170: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00031180: 206c 656e 286e 6577 5f65 6c65 6d65 6e74   len(new_element
+00031190: 2920 3e20 313a 0d0a 2020 2020 2020 2020  ) > 1:..        
+000311a0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+000311b0: 6520 5661 6c75 6545 7272 6f72 2020 2320  e ValueError  # 
+000311c0: 4361 6e6e 6f74 2069 6e73 6572 7420 6d75  Cannot insert mu
+000311d0: 6c74 6970 6c65 2069 7465 6d73 2069 6e74  ltiple items int
+000311e0: 6f20 6120 7369 6e67 6c65 2073 7061 6365  o a single space
+000311f0: 2e20 5265 7175 6972 6573 2073 6c69 6365  . Requires slice
+00031200: 2e0d 0a20 2020 2020 2020 2020 2020 2020  ...             
+00031210: 2020 206e 6577 5f65 6c65 6d65 6e74 203d     new_element =
+00031220: 206e 6577 5f65 6c65 6d65 6e74 5b30 5d0d   new_element[0].
+00031230: 0a20 2020 2020 2020 2073 656c 662e 5f73  .        self._s
+00031240: 6567 6d65 6e74 735b 696e 6465 785d 203d  egments[index] =
+00031250: 206e 6577 5f65 6c65 6d65 6e74 0d0a 2020   new_element..  
+00031260: 2020 2020 2020 7365 6c66 2e5f 6c65 6e67        self._leng
+00031270: 7468 203d 204e 6f6e 650d 0a20 2020 2020  th = None..     
+00031280: 2020 2073 656c 662e 5f6c 656e 6774 6873     self._lengths
+00031290: 203d 204e 6f6e 650d 0a20 2020 2020 2020   = None..       
+000312a0: 2069 6620 6973 696e 7374 616e 6365 2869   if isinstance(i
+000312b0: 6e64 6578 2c20 736c 6963 6529 3a0d 0a20  ndex, slice):.. 
+000312c0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000312d0: 7661 6c69 6461 7465 5f63 6f6e 6e65 6374  validate_connect
+000312e0: 696f 6e73 2829 0d0a 2020 2020 2020 2020  ions()..        
+000312f0: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+00031300: 2020 2073 656c 662e 5f76 616c 6964 6174     self._validat
+00031310: 655f 636f 6e6e 6563 7469 6f6e 2869 6e64  e_connection(ind
+00031320: 6578 202d 2031 290d 0a20 2020 2020 2020  ex - 1)..       
+00031330: 2020 2020 2073 656c 662e 5f76 616c 6964       self._valid
+00031340: 6174 655f 636f 6e6e 6563 7469 6f6e 2869  ate_connection(i
+00031350: 6e64 6578 290d 0a20 2020 2020 2020 2020  ndex)..         
+00031360: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+00031370: 286e 6577 5f65 6c65 6d65 6e74 2c20 4d6f  (new_element, Mo
+00031380: 7665 293a 0d0a 2020 2020 2020 2020 2020  ve):..          
+00031390: 2020 2020 2020 7365 6c66 2e5f 7661 6c69        self._vali
+000313a0: 6461 7465 5f6d 6f76 6528 696e 6465 7829  date_move(index)
+000313b0: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+000313c0: 2069 7369 6e73 7461 6e63 6528 6e65 775f   isinstance(new_
+000313d0: 656c 656d 656e 742c 2043 6c6f 7365 293a  element, Close):
+000313e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000313f0: 2020 7365 6c66 2e5f 7661 6c69 6461 7465    self._validate
+00031400: 5f63 6c6f 7365 2869 6e64 6578 290d 0a0d  _close(index)...
+00031410: 0a20 2020 2064 6566 205f 5f64 656c 6974  .    def __delit
+00031420: 656d 5f5f 2873 656c 662c 2069 6e64 6578  em__(self, index
+00031430: 293a 0d0a 2020 2020 2020 2020 6f72 6967  ):..        orig
+00031440: 696e 616c 5f65 6c65 6d65 6e74 203d 2073  inal_element = s
+00031450: 656c 662e 5f73 6567 6d65 6e74 735b 696e  elf._segments[in
+00031460: 6465 785d 0d0a 2020 2020 2020 2020 6465  dex]..        de
+00031470: 6c20 7365 6c66 2e5f 7365 676d 656e 7473  l self._segments
+00031480: 5b69 6e64 6578 5d0d 0a20 2020 2020 2020  [index]..       
+00031490: 2073 656c 662e 5f6c 656e 6774 6820 3d20   self._length = 
+000314a0: 4e6f 6e65 0d0a 2020 2020 2020 2020 6966  None..        if
+000314b0: 2069 7369 6e73 7461 6e63 6528 696e 6465   isinstance(inde
+000314c0: 782c 2073 6c69 6365 293a 0d0a 2020 2020  x, slice):..    
+000314d0: 2020 2020 2020 2020 7365 6c66 2e76 616c          self.val
+000314e0: 6964 6174 655f 636f 6e6e 6563 7469 6f6e  idate_connection
+000314f0: 7328 290d 0a20 2020 2020 2020 2065 6c73  s()..        els
+00031500: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00031510: 7365 6c66 2e5f 7661 6c69 6461 7465 5f63  self._validate_c
+00031520: 6f6e 6e65 6374 696f 6e28 696e 6465 7820  onnection(index 
+00031530: 2d20 3129 0d0a 2020 2020 2020 2020 2020  - 1)..          
+00031540: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+00031550: 6f72 6967 696e 616c 5f65 6c65 6d65 6e74  original_element
+00031560: 2c20 2843 6c6f 7365 2c20 4d6f 7665 2929  , (Close, Move))
+00031570: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00031580: 2020 2073 656c 662e 5f76 616c 6964 6174     self._validat
+00031590: 655f 7375 6270 6174 6828 696e 6465 7829  e_subpath(index)
+000315a0: 0d0a 0d0a 2020 2020 6465 6620 5f5f 6961  ....    def __ia
+000315b0: 6464 5f5f 2873 656c 662c 206f 7468 6572  dd__(self, other
+000315c0: 293a 0d0a 2020 2020 2020 2020 6966 2069  ):..        if i
+000315d0: 7369 6e73 7461 6e63 6528 6f74 6865 722c  sinstance(other,
+000315e0: 2073 7472 293a 0d0a 2020 2020 2020 2020   str):..        
+000315f0: 2020 2020 7365 6c66 2e70 6172 7365 286f      self.parse(o
+00031600: 7468 6572 290d 0a20 2020 2020 2020 2065  ther)..        e
+00031610: 6c69 6620 6973 696e 7374 616e 6365 286f  lif isinstance(o
+00031620: 7468 6572 2c20 2850 6174 682c 2053 7562  ther, (Path, Sub
+00031630: 7061 7468 2929 3a0d 0a20 2020 2020 2020  path)):..       
+00031640: 2020 2020 2073 656c 662e 6578 7465 6e64       self.extend
+00031650: 286d 6170 2863 6f70 792c 206c 6973 7428  (map(copy, list(
+00031660: 6f74 6865 7229 2929 0d0a 2020 2020 2020  other)))..      
+00031670: 2020 656c 6966 2069 7369 6e73 7461 6e63    elif isinstanc
+00031680: 6528 6f74 6865 722c 2053 6861 7065 293a  e(other, Shape):
+00031690: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+000316a0: 6c66 2e70 6172 7365 286f 7468 6572 2e64  lf.parse(other.d
+000316b0: 2829 290d 0a20 2020 2020 2020 2065 6c69  ())..        eli
+000316c0: 6620 6973 696e 7374 616e 6365 286f 7468  f isinstance(oth
+000316d0: 6572 2c20 5061 7468 5365 676d 656e 7429  er, PathSegment)
+000316e0: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
+000316f0: 656c 662e 6170 7065 6e64 286f 7468 6572  elf.append(other
+00031700: 290d 0a20 2020 2020 2020 2065 6c73 653a  )..        else:
+00031710: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+00031720: 7475 726e 204e 6f74 496d 706c 656d 656e  turn NotImplemen
+00031730: 7465 640d 0a20 2020 2020 2020 2072 6574  ted..        ret
+00031740: 7572 6e20 7365 6c66 0d0a 0d0a 2020 2020  urn self....    
+00031750: 6465 6620 5f5f 6164 645f 5f28 7365 6c66  def __add__(self
+00031760: 2c20 6f74 6865 7229 3a0d 0a20 2020 2020  , other):..     
+00031770: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+00031780: 286f 7468 6572 2c20 2873 7472 2c20 5061  (other, (str, Pa
+00031790: 7468 2c20 5375 6270 6174 682c 2053 6861  th, Subpath, Sha
+000317a0: 7065 2c20 5061 7468 5365 676d 656e 7429  pe, PathSegment)
+000317b0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+000317c0: 6e20 3d20 636f 7079 2873 656c 6629 0d0a  n = copy(self)..
+000317d0: 2020 2020 2020 2020 2020 2020 6e20 2b3d              n +=
+000317e0: 206f 7468 6572 0d0a 2020 2020 2020 2020   other..        
+000317f0: 2020 2020 7265 7475 726e 206e 0d0a 2020      return n..  
+00031800: 2020 2020 2020 7265 7475 726e 204e 6f74        return Not
+00031810: 496d 706c 656d 656e 7465 640d 0a0d 0a20  Implemented.... 
+00031820: 2020 2064 6566 205f 5f72 6164 645f 5f28     def __radd__(
+00031830: 7365 6c66 2c20 6f74 6865 7229 3a0d 0a20  self, other):.. 
+00031840: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
+00031850: 616e 6365 286f 7468 6572 2c20 7374 7229  ance(other, str)
+00031860: 3a0d 0a20 2020 2020 2020 2020 2020 2070  :..            p
+00031870: 6174 6820 3d20 5061 7468 286f 7468 6572  ath = Path(other
+00031880: 290d 0a20 2020 2020 2020 2020 2020 2070  )..            p
+00031890: 6174 682e 6578 7465 6e64 286d 6170 2863  ath.extend(map(c
+000318a0: 6f70 792c 2073 656c 662e 5f73 6567 6d65  opy, self._segme
+000318b0: 6e74 7329 290d 0a20 2020 2020 2020 2020  nts))..         
+000318c0: 2020 2072 6574 7572 6e20 7061 7468 0d0a     return path..
+000318d0: 2020 2020 2020 2020 656c 6966 2069 7369          elif isi
+000318e0: 6e73 7461 6e63 6528 6f74 6865 722c 2050  nstance(other, P
+000318f0: 6174 6853 6567 6d65 6e74 293a 0d0a 2020  athSegment):..  
+00031900: 2020 2020 2020 2020 2020 7061 7468 203d            path =
+00031910: 2063 6f70 7928 7365 6c66 290d 0a20 2020   copy(self)..   
+00031920: 2020 2020 2020 2020 2070 6174 682e 696e           path.in
+00031930: 7365 7274 2830 2c20 6f74 6865 7229 0d0a  sert(0, other)..
+00031940: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00031950: 726e 2070 6174 680d 0a20 2020 2020 2020  rn path..       
+00031960: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+00031970: 2020 2020 7265 7475 726e 204e 6f74 496d      return NotIm
+00031980: 706c 656d 656e 7465 640d 0a0d 0a20 2020  plemented....   
+00031990: 2064 6566 205f 5f6c 656e 5f5f 2873 656c   def __len__(sel
+000319a0: 6629 3a0d 0a20 2020 2020 2020 2072 6574  f):..        ret
+000319b0: 7572 6e20 6c65 6e28 7365 6c66 2e5f 7365  urn len(self._se
+000319c0: 676d 656e 7473 290d 0a0d 0a20 2020 2064  gments)....    d
+000319d0: 6566 205f 5f73 7472 5f5f 2873 656c 6629  ef __str__(self)
+000319e0: 3a0d 0a20 2020 2020 2020 2072 6574 7572  :..        retur
+000319f0: 6e20 7365 6c66 2e64 2829 0d0a 0d0a 2020  n self.d()....  
+00031a00: 2020 6465 6620 5f5f 7265 7072 5f5f 2873    def __repr__(s
+00031a10: 656c 6629 3a0d 0a20 2020 2020 2020 2076  elf):..        v
+00031a20: 616c 7565 7320 3d20 5b5d 0d0a 2020 2020  alues = []..    
+00031a30: 2020 2020 6966 206c 656e 2873 656c 6629      if len(self)
+00031a40: 203e 2030 3a0d 0a20 2020 2020 2020 2020   > 0:..         
+00031a50: 2020 2076 616c 7565 732e 6170 7065 6e64     values.append
+00031a60: 2822 2c20 222e 6a6f 696e 2872 6570 7228  (", ".join(repr(
+00031a70: 7829 2066 6f72 2078 2069 6e20 7365 6c66  x) for x in self
+00031a80: 2e5f 7365 676d 656e 7473 2929 0d0a 2020  ._segments))..  
+00031a90: 2020 2020 2020 7365 6c66 2e5f 7265 7072        self._repr
+00031aa0: 5f73 6861 7065 2876 616c 7565 7329 0d0a  _shape(values)..
+00031ab0: 2020 2020 2020 2020 7061 7261 6d73 203d          params =
+00031ac0: 2022 2c20 222e 6a6f 696e 2876 616c 7565   ", ".join(value
+00031ad0: 7329 0d0a 2020 2020 2020 2020 7265 7475  s)..        retu
+00031ae0: 726e 2022 2573 2825 7329 2220 2520 2873  rn "%s(%s)" % (s
+00031af0: 656c 662e 5f5f 636c 6173 735f 5f2e 5f5f  elf.__class__.__
+00031b00: 6e61 6d65 5f5f 2c20 7061 7261 6d73 290d  name__, params).
+00031b10: 0a0d 0a20 2020 2064 6566 205f 5f65 715f  ...    def __eq_
+00031b20: 5f28 7365 6c66 2c20 6f74 6865 7229 3a0d  _(self, other):.
+00031b30: 0a20 2020 2020 2020 2069 6620 6973 696e  .        if isin
+00031b40: 7374 616e 6365 286f 7468 6572 2c20 7374  stance(other, st
+00031b50: 7229 3a0d 0a20 2020 2020 2020 2020 2020  r):..           
+00031b60: 2072 6574 7572 6e20 7365 6c66 2e5f 5f65   return self.__e
+00031b70: 715f 5f28 5061 7468 286f 7468 6572 2929  q__(Path(other))
+00031b80: 0d0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
+00031b90: 2069 7369 6e73 7461 6e63 6528 6f74 6865   isinstance(othe
+00031ba0: 722c 2050 6174 6829 3a0d 0a20 2020 2020  r, Path):..     
+00031bb0: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
+00031bc0: 7449 6d70 6c65 6d65 6e74 6564 0d0a 2020  tImplemented..  
+00031bd0: 2020 2020 2020 6966 206c 656e 2873 656c        if len(sel
+00031be0: 6629 2021 3d20 6c65 6e28 6f74 6865 7229  f) != len(other)
+00031bf0: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
+00031c00: 6574 7572 6e20 4661 6c73 650d 0a20 2020  eturn False..   
+00031c10: 2020 2020 2070 203d 2061 6273 2873 656c       p = abs(sel
+00031c20: 6629 0d0a 2020 2020 2020 2020 7120 3d20  f)..        q = 
+00031c30: 6162 7328 6f74 6865 7229 0d0a 2020 2020  abs(other)..    
+00031c40: 2020 2020 666f 7220 732c 206f 2069 6e20      for s, o in 
+00031c50: 7a69 7028 712e 5f73 6567 6d65 6e74 732c  zip(q._segments,
+00031c60: 2070 2e5f 7365 676d 656e 7473 293a 0d0a   p._segments):..
+00031c70: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+00031c80: 6f74 2073 203d 3d20 6f3a 0d0a 2020 2020  ot s == o:..    
+00031c90: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00031ca0: 726e 2046 616c 7365 0d0a 2020 2020 2020  rn False..      
+00031cb0: 2020 6966 2070 2e73 7472 6f6b 655f 7769    if p.stroke_wi
+00031cc0: 6474 6820 213d 2071 2e73 7472 6f6b 655f  dth != q.stroke_
+00031cd0: 7769 6474 683a 0d0a 2020 2020 2020 2020  width:..        
+00031ce0: 2020 2020 7265 7475 726e 2046 616c 7365      return False
+00031cf0: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00031d00: 2054 7275 650d 0a0d 0a20 2020 2064 6566   True....    def
+00031d10: 205f 5f6e 655f 5f28 7365 6c66 2c20 6f74   __ne__(self, ot
+00031d20: 6865 7229 3a0d 0a20 2020 2020 2020 2069  her):..        i
+00031d30: 6620 6e6f 7420 6973 696e 7374 616e 6365  f not isinstance
+00031d40: 286f 7468 6572 2c20 2850 6174 682c 2073  (other, (Path, s
+00031d50: 7472 2929 3a0d 0a20 2020 2020 2020 2020  tr)):..         
+00031d60: 2020 2072 6574 7572 6e20 4e6f 7449 6d70     return NotImp
+00031d70: 6c65 6d65 6e74 6564 0d0a 2020 2020 2020  lemented..      
+00031d80: 2020 7265 7475 726e 206e 6f74 2073 656c    return not sel
+00031d90: 6620 3d3d 206f 7468 6572 0d0a 0d0a 2020  f == other....  
+00031da0: 2020 6465 6620 7061 7273 6528 7365 6c66    def parse(self
+00031db0: 2c20 7061 7468 6465 6629 3a0d 0a20 2020  , pathdef):..   
+00031dc0: 2020 2020 2022 2222 5061 7273 6573 2074       """Parses t
+00031dd0: 6865 2053 5647 2070 6174 682e 2222 220d  he SVG path.""".
+00031de0: 0a20 2020 2020 2020 2074 6f6b 656e 7320  .        tokens 
+00031df0: 3d20 5356 474c 6578 6963 616c 5061 7273  = SVGLexicalPars
+00031e00: 6572 2829 0d0a 2020 2020 2020 2020 746f  er()..        to
+00031e10: 6b65 6e73 2e70 6172 7365 2873 656c 662c  kens.parse(self,
+00031e20: 2070 6174 6864 6566 290d 0a0d 0a20 2020   pathdef)....   
+00031e30: 2064 6566 2076 616c 6964 6174 655f 636f   def validate_co
+00031e40: 6e6e 6563 7469 6f6e 7328 7365 6c66 293a  nnections(self):
+00031e50: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
+00031e60: 2020 2020 2020 2046 6f72 6365 2076 616c         Force val
+00031e70: 6964 6174 6520 616c 6c20 636f 6e6e 6563  idate all connec
+00031e80: 7469 6f6e 732e 0d0a 0d0a 2020 2020 2020  tions.....      
+00031e90: 2020 5468 6973 2077 696c 6c20 7363 616e    This will scan
+00031ea0: 2070 6174 6820 636f 6e6e 6563 7469 6f6e   path connection
+00031eb0: 7320 616e 6420 6c69 6e6b 2061 6e79 2061  s and link any a
+00031ec0: 646a 6163 656e 7420 656c 656d 656e 7473  djacent elements
+00031ed0: 2074 6f67 6574 6865 7220 6279 2072 6570   together by rep
+00031ee0: 6c61 6369 6e67 2061 6e79 204e 6f6e 6520  lacing any None 
+00031ef0: 706f 696e 7473 206f 7220 6361 7573 696e  points or causin
+00031f00: 670d 0a20 2020 2020 2020 2074 6865 2073  g..        the s
+00031f10: 7461 7274 2070 6f73 6974 696f 6e20 6f66  tart position of
+00031f20: 2074 6865 206e 6578 7420 656c 656d 656e   the next elemen
+00031f30: 7420 746f 2065 7175 616c 2074 6865 2065  t to equal the e
+00031f40: 6e64 2070 6f73 6974 696f 6e20 6f66 2074  nd position of t
+00031f50: 6865 2070 7265 7669 6f75 732e 2054 6869  he previous. Thi
+00031f60: 7320 7368 6f75 6c64 206f 6e6c 7920 6265  s should only be
+00031f70: 206e 6565 6465 640d 0a20 2020 2020 2020   needed..       
+00031f80: 2077 6865 6e20 636f 6d62 696e 696e 6720   when combining 
+00031f90: 7061 7468 7320 616e 6420 656c 656d 656e  paths and elemen
+00031fa0: 7473 2074 6f67 6574 6865 722e 2043 6c6f  ts together. Clo
+00031fb0: 7365 2065 6c65 6d65 6e74 7320 6172 6520  se elements are 
+00031fc0: 616c 7761 7973 2063 6f6e 6e65 6374 6564  always connected
+00031fd0: 2074 6f20 7468 6520 6c61 7374 204d 6f76   to the last Mov
+00031fe0: 6520 656c 656d 656e 7420 6f72 2074 6f0d  e element or to.
+00031ff0: 0a20 2020 2020 2020 2074 6865 2065 6e64  .        the end
+00032000: 2070 6f73 6974 696f 6e20 6f66 2074 6865   position of the
+00032010: 2066 6972 7374 2065 6c65 6d65 6e74 2069   first element i
+00032020: 6e20 7468 6520 6c69 7374 2e20 5468 6520  n the list. The 
+00032030: 7374 6172 7420 656c 656d 656e 7420 6f66  start element of
+00032040: 2074 6865 2066 6972 7374 2073 6567 6d65   the first segme
+00032050: 6e74 206d 6179 206f 7220 6d61 7920 6e6f  nt may or may no
+00032060: 7420 6265 0d0a 2020 2020 2020 2020 4e6f  t be..        No
+00032070: 6e65 2e0d 0a20 2020 2020 2020 2022 2222  ne...        """
+00032080: 0d0a 2020 2020 2020 2020 7a70 6f69 6e74  ..        zpoint
+00032090: 203d 204e 6f6e 650d 0a20 2020 2020 2020   = None..       
+000320a0: 206c 6173 745f 7365 676d 656e 7420 3d20   last_segment = 
+000320b0: 4e6f 6e65 0d0a 2020 2020 2020 2020 666f  None..        fo
+000320c0: 7220 7365 676d 656e 7420 696e 2073 656c  r segment in sel
+000320d0: 662e 5f73 6567 6d65 6e74 733a 0d0a 2020  f._segments:..  
+000320e0: 2020 2020 2020 2020 2020 6966 207a 706f            if zpo
+000320f0: 696e 7420 6973 204e 6f6e 6520 6f72 2069  int is None or i
+00032100: 7369 6e73 7461 6e63 6528 7365 676d 656e  sinstance(segmen
+00032110: 742c 204d 6f76 6529 3a0d 0a20 2020 2020  t, Move):..     
+00032120: 2020 2020 2020 2020 2020 207a 706f 696e             zpoin
+00032130: 7420 3d20 7365 676d 656e 742e 656e 640d  t = segment.end.
+00032140: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00032150: 6c61 7374 5f73 6567 6d65 6e74 2069 7320  last_segment is 
+00032160: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
+00032170: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+00032180: 676d 656e 742e 7374 6172 7420 6973 204e  gment.start is N
+00032190: 6f6e 6520 616e 6420 6c61 7374 5f73 6567  one and last_seg
+000321a0: 6d65 6e74 2e65 6e64 2069 7320 6e6f 7420  ment.end is not 
+000321b0: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
+000321c0: 2020 2020 2020 2020 2020 2073 6567 6d65             segme
+000321d0: 6e74 2e73 7461 7274 203d 2050 6f69 6e74  nt.start = Point
+000321e0: 286c 6173 745f 7365 676d 656e 742e 656e  (last_segment.en
+000321f0: 6429 0d0a 2020 2020 2020 2020 2020 2020  d)..            
+00032200: 2020 2020 656c 6966 206c 6173 745f 7365      elif last_se
+00032210: 676d 656e 742e 656e 6420 6973 204e 6f6e  gment.end is Non
+00032220: 6520 616e 6420 7365 676d 656e 742e 7374  e and segment.st
+00032230: 6172 7420 6973 206e 6f74 204e 6f6e 653a  art is not None:
+00032240: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00032250: 2020 2020 2020 6c61 7374 5f73 6567 6d65        last_segme
+00032260: 6e74 2e65 6e64 203d 2050 6f69 6e74 2873  nt.end = Point(s
+00032270: 6567 6d65 6e74 2e73 7461 7274 290d 0a20  egment.start).. 
+00032280: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00032290: 6c69 6620 6c61 7374 5f73 6567 6d65 6e74  lif last_segment
+000322a0: 2e65 6e64 2021 3d20 7365 676d 656e 742e  .end != segment.
+000322b0: 7374 6172 743a 0d0a 2020 2020 2020 2020  start:..        
+000322c0: 2020 2020 2020 2020 2020 2020 7365 676d              segm
+000322d0: 656e 742e 7374 6172 7420 3d20 506f 696e  ent.start = Poin
+000322e0: 7428 6c61 7374 5f73 6567 6d65 6e74 2e65  t(last_segment.e
+000322f0: 6e64 290d 0a20 2020 2020 2020 2020 2020  nd)..           
+00032300: 2069 6620 280d 0a20 2020 2020 2020 2020   if (..         
+00032310: 2020 2020 2020 2069 7369 6e73 7461 6e63         isinstanc
+00032320: 6528 7365 676d 656e 742c 2043 6c6f 7365  e(segment, Close
+00032330: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00032340: 2020 2061 6e64 207a 706f 696e 7420 6973     and zpoint is
+00032350: 206e 6f74 204e 6f6e 650d 0a20 2020 2020   not None..     
+00032360: 2020 2020 2020 2020 2020 2061 6e64 2073             and s
+00032370: 6567 6d65 6e74 2e65 6e64 2021 3d20 7a70  egment.end != zp
+00032380: 6f69 6e74 0d0a 2020 2020 2020 2020 2020  oint..          
+00032390: 2020 293a 0d0a 2020 2020 2020 2020 2020    ):..          
+000323a0: 2020 2020 2020 7365 676d 656e 742e 656e        segment.en
+000323b0: 6420 3d20 506f 696e 7428 7a70 6f69 6e74  d = Point(zpoint
+000323c0: 290d 0a20 2020 2020 2020 2020 2020 206c  )..            l
+000323d0: 6173 745f 7365 676d 656e 7420 3d20 7365  ast_segment = se
+000323e0: 676d 656e 740d 0a0d 0a20 2020 2064 6566  gment....    def
+000323f0: 205f 6973 5f76 616c 6964 2873 656c 6629   _is_valid(self)
+00032400: 3a0d 0a20 2020 2020 2020 2022 2222 0d0a  :..        """..
+00032410: 2020 2020 2020 2020 4368 6563 6b73 2076          Checks v
+00032420: 616c 6964 6174 696f 6e20 6f66 2061 6c6c  alidation of all
+00032430: 2063 6f6e 6e65 6374 696f 6e73 2e0d 0a0d   connections....
+00032440: 0a20 2020 2020 2020 2050 6174 6873 2061  .        Paths a
+00032450: 7265 2076 616c 6964 2069 6620 616c 6c20  re valid if all 
+00032460: 656e 6420 706f 696e 7473 206d 6174 6368  end points match
+00032470: 2074 6865 2073 7461 7274 206f 6620 7468   the start of th
+00032480: 6520 6e65 7874 2070 6f69 6e74 2061 6e64  e next point and
+00032490: 2061 6c6c 2063 6c6f 7365 0d0a 2020 2020   all close..    
+000324a0: 2020 2020 636f 6d6d 616e 6473 2072 6574      commands ret
+000324b0: 7572 6e20 746f 2074 6865 206c 6173 7420  urn to the last 
+000324c0: 7661 6c69 6420 6d6f 7665 2063 6f6d 6d61  valid move comma
+000324d0: 6e64 2e0d 0a0d 0a20 2020 2020 2020 2054  nd.....        T
+000324e0: 6869 7320 646f 6573 206e 6f74 2063 6865  his does not che
+000324f0: 636b 2066 6f72 2069 6e63 6f6e 6772 7565  ck for incongrue
+00032500: 6e74 2070 6174 6820 7661 6c69 6469 7479  nt path validity
+00032510: 2e20 5061 7468 2066 7261 676d 656e 7473  . Path fragments
+00032520: 2077 6974 686f 7574 2069 6e69 7469 616c   without initial
+00032530: 206d 6f76 6573 0d0a 2020 2020 2020 2020   moves..        
+00032540: 646f 7562 6c65 2063 6c6f 7365 6420 7061  double closed pa
+00032550: 7468 732c 206d 6179 2061 6c6c 2070 6173  ths, may all pas
+00032560: 7320 7468 6973 2063 6865 636b 2e0d 0a20  s this check... 
+00032570: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
+00032580: 2020 2020 7a70 6f69 6e74 203d 204e 6f6e      zpoint = Non
+00032590: 650d 0a20 2020 2020 2020 206c 6173 745f  e..        last_
+000325a0: 7365 676d 656e 7420 3d20 4e6f 6e65 0d0a  segment = None..
+000325b0: 2020 2020 2020 2020 666f 7220 7365 676d          for segm
+000325c0: 656e 7420 696e 2073 656c 662e 5f73 6567  ent in self._seg
+000325d0: 6d65 6e74 733a 0d0a 2020 2020 2020 2020  ments:..        
+000325e0: 2020 2020 6966 207a 706f 696e 7420 6973      if zpoint is
+000325f0: 204e 6f6e 6520 6f72 2069 7369 6e73 7461   None or isinsta
+00032600: 6e63 6528 7365 676d 656e 742c 204d 6f76  nce(segment, Mov
+00032610: 6529 3a0d 0a20 2020 2020 2020 2020 2020  e):..           
+00032620: 2020 2020 207a 706f 696e 7420 3d20 7365       zpoint = se
+00032630: 676d 656e 742e 656e 640d 0a20 2020 2020  gment.end..     
+00032640: 2020 2020 2020 2069 6620 6c61 7374 5f73         if last_s
+00032650: 6567 6d65 6e74 2069 7320 6e6f 7420 4e6f  egment is not No
+00032660: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
+00032670: 2020 2020 2069 6620 7365 676d 656e 742e       if segment.
+00032680: 7374 6172 7420 6973 204e 6f6e 653a 0d0a  start is None:..
+00032690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000326a0: 2020 2020 7265 7475 726e 2046 616c 7365      return False
+000326b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000326c0: 2020 656c 6966 206c 6173 745f 7365 676d    elif last_segm
+000326d0: 656e 742e 656e 6420 6973 204e 6f6e 653a  ent.end is None:
+000326e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000326f0: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
+00032700: 7365 0d0a 2020 2020 2020 2020 2020 2020  se..            
+00032710: 2020 2020 656c 6966 206c 6173 745f 7365      elif last_se
+00032720: 676d 656e 742e 656e 6420 213d 2073 6567  gment.end != seg
+00032730: 6d65 6e74 2e73 7461 7274 3a0d 0a20 2020  ment.start:..   
+00032740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032750: 2072 6574 7572 6e20 4661 6c73 650d 0a20   return False.. 
+00032760: 2020 2020 2020 2020 2020 2069 6620 280d             if (.
+00032770: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00032780: 2069 7369 6e73 7461 6e63 6528 7365 676d   isinstance(segm
+00032790: 656e 742c 2043 6c6f 7365 290d 0a20 2020  ent, Close)..   
+000327a0: 2020 2020 2020 2020 2020 2020 2061 6e64               and
+000327b0: 207a 706f 696e 7420 6973 206e 6f74 204e   zpoint is not N
+000327c0: 6f6e 650d 0a20 2020 2020 2020 2020 2020  one..           
+000327d0: 2020 2020 2061 6e64 2073 6567 6d65 6e74       and segment
+000327e0: 2e65 6e64 2021 3d20 7a70 6f69 6e74 0d0a  .end != zpoint..
+000327f0: 2020 2020 2020 2020 2020 2020 293a 0d0a              ):..
+00032800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032810: 7265 7475 726e 2046 616c 7365 0d0a 2020  return False..  
+00032820: 2020 2020 2020 2020 2020 6c61 7374 5f73            last_s
+00032830: 6567 6d65 6e74 203d 2073 6567 6d65 6e74  egment = segment
+00032840: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00032850: 2054 7275 650d 0a0d 0a20 2020 2040 7072   True....    @pr
+00032860: 6f70 6572 7479 0d0a 2020 2020 6465 6620  operty..    def 
+00032870: 6669 7273 745f 706f 696e 7428 7365 6c66  first_point(self
+00032880: 293a 0d0a 2020 2020 2020 2020 2222 2246  ):..        """F
+00032890: 6972 7374 2070 6f69 6e74 2061 6c6f 6e67  irst point along
+000328a0: 2074 6865 2050 6174 682e 2054 6869 7320   the Path. This 
+000328b0: 6973 2074 6865 2073 7461 7274 2070 6f69  is the start poi
+000328c0: 6e74 206f 6620 7468 6520 6669 7273 7420  nt of the first 
+000328d0: 7365 676d 656e 7420 756e 6c65 7373 2069  segment unless i
+000328e0: 7420 7374 6172 7473 0d0a 2020 2020 2020  t starts..      
+000328f0: 2020 7769 7468 2061 204d 6f76 6520 636f    with a Move co
+00032900: 6d6d 616e 6420 7769 7468 2061 204e 6f6e  mmand with a Non
+00032910: 6520 7374 6172 7420 696e 2077 6869 6368  e start in which
+00032920: 2063 6173 6520 6669 7273 7420 706f 696e   case first poin
+00032930: 7420 6973 2074 6861 7420 4d6f 7665 2773  t is that Move's
+00032940: 2064 6573 7469 6e61 7469 6f6e 2e22 2222   destination."""
+00032950: 0d0a 2020 2020 2020 2020 6966 206c 656e  ..        if len
+00032960: 2873 656c 662e 5f73 6567 6d65 6e74 7329  (self._segments)
+00032970: 203d 3d20 303a 0d0a 2020 2020 2020 2020   == 0:..        
+00032980: 2020 2020 7265 7475 726e 204e 6f6e 650d      return None.
+00032990: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+000329a0: 2e5f 7365 676d 656e 7473 5b30 5d2e 7374  ._segments[0].st
+000329b0: 6172 7420 6973 206e 6f74 204e 6f6e 653a  art is not None:
+000329c0: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+000329d0: 7475 726e 2050 6f69 6e74 2873 656c 662e  turn Point(self.
+000329e0: 5f73 6567 6d65 6e74 735b 305d 2e73 7461  _segments[0].sta
+000329f0: 7274 290d 0a20 2020 2020 2020 2072 6574  rt)..        ret
+00032a00: 7572 6e20 280d 0a20 2020 2020 2020 2020  urn (..         
+00032a10: 2020 2050 6f69 6e74 2873 656c 662e 5f73     Point(self._s
+00032a20: 6567 6d65 6e74 735b 305d 2e65 6e64 2920  egments[0].end) 
+00032a30: 6966 2073 656c 662e 5f73 6567 6d65 6e74  if self._segment
+00032a40: 735b 305d 2e65 6e64 2069 7320 6e6f 7420  s[0].end is not 
+00032a50: 4e6f 6e65 2065 6c73 6520 4e6f 6e65 0d0a  None else None..
+00032a60: 2020 2020 2020 2020 290d 0a0d 0a20 2020          )....   
+00032a70: 2040 7072 6f70 6572 7479 0d0a 2020 2020   @property..    
+00032a80: 6465 6620 6375 7272 656e 745f 706f 696e  def current_poin
+00032a90: 7428 7365 6c66 293a 0d0a 2020 2020 2020  t(self):..      
+00032aa0: 2020 6966 206c 656e 2873 656c 662e 5f73    if len(self._s
+00032ab0: 6567 6d65 6e74 7329 203d 3d20 303a 0d0a  egments) == 0:..
+00032ac0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00032ad0: 726e 204e 6f6e 650d 0a20 2020 2020 2020  rn None..       
+00032ae0: 2072 6574 7572 6e20 280d 0a20 2020 2020   return (..     
+00032af0: 2020 2020 2020 2050 6f69 6e74 2873 656c         Point(sel
+00032b00: 662e 5f73 6567 6d65 6e74 735b 2d31 5d2e  f._segments[-1].
+00032b10: 656e 6429 0d0a 2020 2020 2020 2020 2020  end)..          
+00032b20: 2020 6966 2073 656c 662e 5f73 6567 6d65    if self._segme
+00032b30: 6e74 735b 2d31 5d2e 656e 6420 6973 206e  nts[-1].end is n
+00032b40: 6f74 204e 6f6e 650d 0a20 2020 2020 2020  ot None..       
+00032b50: 2020 2020 2065 6c73 6520 4e6f 6e65 0d0a       else None..
+00032b60: 2020 2020 2020 2020 290d 0a0d 0a20 2020          )....   
+00032b70: 2040 7072 6f70 6572 7479 0d0a 2020 2020   @property..    
+00032b80: 6465 6620 7a5f 706f 696e 7428 7365 6c66  def z_point(self
+00032b90: 293a 0d0a 2020 2020 2020 2020 2222 220d  ):..        """.
+00032ba0: 0a20 2020 2020 2020 205a 2069 7320 7468  .        Z is th
+00032bb0: 6520 6465 7374 696e 6174 696f 6e20 6f66  e destination of
+00032bc0: 2074 6865 206c 6173 7420 4d6f 7665 2e20   the last Move. 
+00032bd0: 4974 2063 616e 206d 6561 6e2c 2062 7574  It can mean, but
+00032be0: 2064 6f65 736e 2774 206e 6563 6573 7361   doesn't necessa
+00032bf0: 7269 6c79 206d 6561 6e20 7468 6520 6669  rily mean the fi
+00032c00: 7273 745f 706f 696e 7420 696e 2074 6865  rst_point in the
+00032c10: 2070 6174 682e 0d0a 2020 2020 2020 2020   path...        
+00032c20: 5468 6973 2062 6568 6176 696f 7220 6f66  This behavior of
+00032c30: 205a 2069 7320 6465 6669 6e65 6420 696e   Z is defined in
+00032c40: 2073 7667 2073 7065 633a 0d0a 2020 2020   svg spec:..    
+00032c50: 2020 2020 6874 7470 3a2f 2f77 7777 2e77      http://www.w
+00032c60: 332e 6f72 672f 5452 2f53 5647 2f70 6174  3.org/TR/SVG/pat
+00032c70: 6873 2e68 746d 6c23 5061 7468 4461 7461  hs.html#PathData
+00032c80: 436c 6f73 6550 6174 6843 6f6d 6d61 6e64  ClosePathCommand
+00032c90: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
+00032ca0: 2020 2020 2020 2065 6e64 5f70 6f73 203d         end_pos =
+00032cb0: 204e 6f6e 650d 0a20 2020 2020 2020 2066   None..        f
+00032cc0: 6f72 2073 6567 6d65 6e74 2069 6e20 7265  or segment in re
+00032cd0: 7665 7273 6564 2873 656c 662e 5f73 6567  versed(self._seg
+00032ce0: 6d65 6e74 7329 3a0d 0a20 2020 2020 2020  ments):..       
+00032cf0: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
+00032d00: 6365 2873 6567 6d65 6e74 2c20 4d6f 7665  ce(segment, Move
+00032d10: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00032d20: 2020 2020 656e 645f 706f 7320 3d20 7365      end_pos = se
+00032d30: 676d 656e 742e 656e 640d 0a20 2020 2020  gment.end..     
+00032d40: 2020 2020 2020 2020 2020 2062 7265 616b             break
+00032d50: 0d0a 2020 2020 2020 2020 6966 2065 6e64  ..        if end
+00032d60: 5f70 6f73 2069 7320 4e6f 6e65 3a0d 0a20  _pos is None:.. 
+00032d70: 2020 2020 2020 2020 2020 2074 7279 3a0d             try:.
+00032d80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00032d90: 2065 6e64 5f70 6f73 203d 2073 656c 662e   end_pos = self.
+00032da0: 5f73 6567 6d65 6e74 735b 305d 2e65 6e64  _segments[0].end
+00032db0: 0d0a 2020 2020 2020 2020 2020 2020 6578  ..            ex
+00032dc0: 6365 7074 2049 6e64 6578 4572 726f 723a  cept IndexError:
+00032dd0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00032de0: 2020 7061 7373 2020 2320 656e 7469 7265    pass  # entire
+00032df0: 2070 6174 6820 6973 2022 7a22 2e0d 0a20   path is "z"... 
+00032e00: 2020 2020 2020 2072 6574 7572 6e20 656e         return en
+00032e10: 645f 706f 730d 0a0d 0a20 2020 2040 7072  d_pos....    @pr
+00032e20: 6f70 6572 7479 0d0a 2020 2020 6465 6620  operty..    def 
+00032e30: 736d 6f6f 7468 5f70 6f69 6e74 2873 656c  smooth_point(sel
+00032e40: 6629 3a0d 0a20 2020 2020 2020 2022 2222  f):..        """
+00032e50: 5265 7475 726e 7320 7468 6520 736d 6f6f  Returns the smoo
+00032e60: 7468 696e 6720 636f 6e74 726f 6c20 706f  thing control po
+00032e70: 696e 7420 666f 7220 7468 6520 736d 6f6f  int for the smoo
+00032e80: 7468 2063 6f6d 6d61 6e64 732e 0d0a 2020  th commands...  
+00032e90: 2020 2020 2020 496e 2072 6567 6172 6420        In regard 
+00032ea0: 746f 2074 6865 2053 5647 2073 7461 6e64  to the SVG stand
+00032eb0: 6172 6420 6966 2074 6865 206c 6173 7420  ard if the last 
+00032ec0: 636f 6d6d 616e 6420 7761 7320 6120 6375  command was a cu
+00032ed0: 7276 6520 7468 6520 736d 6f6f 7468 0d0a  rve the smooth..
+00032ee0: 2020 2020 2020 2020 636f 6e74 726f 6c20          control 
+00032ef0: 706f 696e 7420 6973 2074 6865 2072 6566  point is the ref
+00032f00: 6c65 6374 696f 6e20 6f66 2074 6865 2070  lection of the p
+00032f10: 7265 7669 6f75 7320 636f 6e74 726f 6c20  revious control 
+00032f20: 706f 696e 742e 0d0a 0d0a 2020 2020 2020  point.....      
+00032f30: 2020 4966 2074 6865 206c 6173 7420 636f    If the last co
+00032f40: 6d6d 616e 6420 7761 7320 6e6f 7420 6120  mmand was not a 
+00032f50: 6375 7276 652c 2074 6865 2073 6d6f 6f74  curve, the smoot
+00032f60: 685f 706f 696e 7420 6973 2063 6f69 6e63  h_point is coinc
+00032f70: 6964 656e 7420 7769 7468 2074 6865 2063  ident with the c
+00032f80: 7572 7265 6e74 2e0d 0a20 2020 2020 2020  urrent...       
+00032f90: 2068 7474 7073 3a2f 2f77 7777 2e77 332e   https://www.w3.
+00032fa0: 6f72 672f 5452 2f53 5647 2f70 6174 6873  org/TR/SVG/paths
+00032fb0: 2e68 746d 6c23 5061 7468 4461 7461 4375  .html#PathDataCu
+00032fc0: 6269 6342 657a 6965 7243 6f6d 6d61 6e64  bicBezierCommand
+00032fd0: 730d 0a20 2020 2020 2020 2022 2222 0d0a  s..        """..
+00032fe0: 0d0a 2020 2020 2020 2020 6966 206c 656e  ..        if len
+00032ff0: 2873 656c 662e 5f73 6567 6d65 6e74 7329  (self._segments)
+00033000: 203d 3d20 303a 0d0a 2020 2020 2020 2020   == 0:..        
+00033010: 2020 2020 7265 7475 726e 204e 6f6e 650d      return None.
+00033020: 0a20 2020 2020 2020 2073 7461 7274 5f70  .        start_p
+00033030: 6f73 203d 2073 656c 662e 6375 7272 656e  os = self.curren
+00033040: 745f 706f 696e 740d 0a20 2020 2020 2020  t_point..       
+00033050: 206c 6173 745f 7365 676d 656e 7420 3d20   last_segment = 
+00033060: 7365 6c66 2e5f 7365 676d 656e 7473 5b2d  self._segments[-
+00033070: 315d 0d0a 2020 2020 2020 2020 6966 2069  1]..        if i
+00033080: 7369 6e73 7461 6e63 6528 6c61 7374 5f73  sinstance(last_s
+00033090: 6567 6d65 6e74 2c20 5175 6164 7261 7469  egment, Quadrati
+000330a0: 6342 657a 6965 7229 3a0d 0a20 2020 2020  cBezier):..     
+000330b0: 2020 2020 2020 2070 7265 7669 6f75 735f         previous_
+000330c0: 636f 6e74 726f 6c20 3d20 6c61 7374 5f73  control = last_s
+000330d0: 6567 6d65 6e74 2e63 6f6e 7472 6f6c 0d0a  egment.control..
+000330e0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+000330f0: 726e 2070 7265 7669 6f75 735f 636f 6e74  rn previous_cont
+00033100: 726f 6c2e 7265 666c 6563 7465 645f 6163  rol.reflected_ac
+00033110: 726f 7373 2873 7461 7274 5f70 6f73 290d  ross(start_pos).
+00033120: 0a20 2020 2020 2020 2065 6c69 6620 6973  .        elif is
+00033130: 696e 7374 616e 6365 286c 6173 745f 7365  instance(last_se
+00033140: 676d 656e 742c 2043 7562 6963 4265 7a69  gment, CubicBezi
+00033150: 6572 293a 0d0a 2020 2020 2020 2020 2020  er):..          
+00033160: 2020 7072 6576 696f 7573 5f63 6f6e 7472    previous_contr
+00033170: 6f6c 203d 206c 6173 745f 7365 676d 656e  ol = last_segmen
+00033180: 742e 636f 6e74 726f 6c32 0d0a 2020 2020  t.control2..    
+00033190: 2020 2020 2020 2020 7265 7475 726e 2070          return p
+000331a0: 7265 7669 6f75 735f 636f 6e74 726f 6c2e  revious_control.
+000331b0: 7265 666c 6563 7465 645f 6163 726f 7373  reflected_across
+000331c0: 2873 7461 7274 5f70 6f73 290d 0a20 2020  (start_pos)..   
+000331d0: 2020 2020 2072 6574 7572 6e20 7374 6172       return star
+000331e0: 745f 706f 730d 0a0d 0a20 2020 2064 6566  t_pos....    def
+000331f0: 2073 7461 7274 2873 656c 6629 3a0d 0a20   start(self):.. 
+00033200: 2020 2020 2020 2070 6173 730d 0a0d 0a20         pass.... 
+00033210: 2020 2064 6566 2065 6e64 2873 656c 6629     def end(self)
+00033220: 3a0d 0a20 2020 2020 2020 2070 6173 730d  :..        pass.
+00033230: 0a0d 0a20 2020 2064 6566 206d 6f76 6528  ...    def move(
+00033240: 7365 6c66 2c20 2a70 6f69 6e74 732c 2072  self, *points, r
+00033250: 656c 6174 6976 653d 4661 6c73 652c 202a  elative=False, *
+00033260: 2a6b 7761 7267 7329 3a0d 0a20 2020 2020  *kwargs):..     
+00033270: 2020 2073 7461 7274 5f70 6f73 203d 2073     start_pos = s
+00033280: 656c 662e 6375 7272 656e 745f 706f 696e  elf.current_poin
+00033290: 740d 0a20 2020 2020 2020 2065 6e64 5f70  t..        end_p
+000332a0: 6f73 203d 2070 6f69 6e74 735b 305d 0d0a  os = points[0]..
+000332b0: 2020 2020 2020 2020 6966 2065 6e64 5f70          if end_p
+000332c0: 6f73 2069 6e20 2822 7a22 2c20 225a 2229  os in ("z", "Z")
+000332d0: 3a0d 0a20 2020 2020 2020 2020 2020 2065  :..            e
+000332e0: 6e64 5f70 6f73 203d 2073 656c 662e 7a5f  nd_pos = self.z_
+000332f0: 706f 696e 740d 0a20 2020 2020 2020 2073  point..        s
+00033300: 656c 662e 6170 7065 6e64 284d 6f76 6528  elf.append(Move(
+00033310: 7374 6172 745f 706f 732c 2065 6e64 5f70  start_pos, end_p
+00033320: 6f73 2c20 7265 6c61 7469 7665 3d72 656c  os, relative=rel
+00033330: 6174 6976 6529 290d 0a20 2020 2020 2020  ative))..       
+00033340: 2069 6620 6c65 6e28 706f 696e 7473 2920   if len(points) 
+00033350: 3e20 313a 0d0a 2020 2020 2020 2020 2020  > 1:..          
+00033360: 2020 7365 6c66 2e6c 696e 6528 2a70 6f69    self.line(*poi
+00033370: 6e74 735b 313a 5d2c 2072 656c 6174 6976  nts[1:], relativ
+00033380: 653d 7265 6c61 7469 7665 290d 0a20 2020  e=relative)..   
+00033390: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+000333a0: 0d0a 0d0a 2020 2020 6465 6620 6c69 6e65  ....    def line
+000333b0: 2873 656c 662c 202a 706f 696e 7473 2c20  (self, *points, 
+000333c0: 7265 6c61 7469 7665 3d46 616c 7365 2c20  relative=False, 
+000333d0: 2a2a 6b77 6172 6773 293a 0d0a 2020 2020  **kwargs):..    
+000333e0: 2020 2020 666f 7220 696e 6465 7820 696e      for index in
+000333f0: 2072 616e 6765 286c 656e 2870 6f69 6e74   range(len(point
+00033400: 7329 293a 0d0a 2020 2020 2020 2020 2020  s)):..          
+00033410: 2020 7374 6172 745f 706f 7320 3d20 7365    start_pos = se
+00033420: 6c66 2e63 7572 7265 6e74 5f70 6f69 6e74  lf.current_point
+00033430: 0d0a 2020 2020 2020 2020 2020 2020 656e  ..            en
+00033440: 645f 706f 7320 3d20 706f 696e 7473 5b69  d_pos = points[i
+00033450: 6e64 6578 5d0d 0a20 2020 2020 2020 2020  ndex]..         
+00033460: 2020 2069 6620 656e 645f 706f 7320 696e     if end_pos in
+00033470: 2028 227a 222c 2022 5a22 293a 0d0a 2020   ("z", "Z"):..  
+00033480: 2020 2020 2020 2020 2020 2020 2020 656e                en
+00033490: 645f 706f 7320 3d20 7365 6c66 2e7a 5f70  d_pos = self.z_p
+000334a0: 6f69 6e74 0d0a 2020 2020 2020 2020 2020  oint..          
+000334b0: 2020 7365 6c66 2e61 7070 656e 6428 4c69    self.append(Li
+000334c0: 6e65 2873 7461 7274 5f70 6f73 2c20 656e  ne(start_pos, en
+000334d0: 645f 706f 732c 2072 656c 6174 6976 653d  d_pos, relative=
+000334e0: 7265 6c61 7469 7665 2929 0d0a 2020 2020  relative))..    
+000334f0: 2020 2020 7265 7475 726e 2073 656c 660d      return self.
+00033500: 0a0d 0a20 2020 2064 6566 2076 6572 7469  ...    def verti
+00033510: 6361 6c28 7365 6c66 2c20 2a79 5f70 6f69  cal(self, *y_poi
+00033520: 6e74 732c 2072 656c 6174 6976 653d 4661  nts, relative=Fa
+00033530: 6c73 652c 202a 2a6b 7761 7267 7329 3a0d  lse, **kwargs):.
+00033540: 0a20 2020 2020 2020 2066 6f72 2069 6e64  .        for ind
+00033550: 6578 2069 6e20 7261 6e67 6528 6c65 6e28  ex in range(len(
+00033560: 795f 706f 696e 7473 2929 3a0d 0a20 2020  y_points)):..   
+00033570: 2020 2020 2020 2020 2073 7461 7274 5f70           start_p
+00033580: 6f73 203d 2073 656c 662e 6375 7272 656e  os = self.curren
+00033590: 745f 706f 696e 740d 0a20 2020 2020 2020  t_point..       
+000335a0: 2020 2020 2069 6620 7265 6c61 7469 7665       if relative
+000335b0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+000335c0: 2020 2073 656c 662e 6170 7065 6e64 280d     self.append(.
+000335d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000335e0: 2020 2020 204c 696e 6528 0d0a 2020 2020       Line(..    
+000335f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033600: 2020 2020 7374 6172 745f 706f 732c 0d0a      start_pos,..
+00033610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033620: 2020 2020 2020 2020 506f 696e 7428 7374          Point(st
+00033630: 6172 745f 706f 732e 782c 2073 7461 7274  art_pos.x, start
+00033640: 5f70 6f73 2e79 202b 2079 5f70 6f69 6e74  _pos.y + y_point
+00033650: 735b 696e 6465 785d 292c 0d0a 2020 2020  s[index]),..    
+00033660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033670: 2020 2020 7265 6c61 7469 7665 3d72 656c      relative=rel
+00033680: 6174 6976 652c 0d0a 2020 2020 2020 2020  ative,..        
+00033690: 2020 2020 2020 2020 2020 2020 290d 0a20              ).. 
+000336a0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+000336b0: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
+000336c0: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+000336d0: 2020 2020 2073 656c 662e 6170 7065 6e64       self.append
+000336e0: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
+000336f0: 2020 2020 2020 204c 696e 6528 0d0a 2020         Line(..  
+00033700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033710: 2020 2020 2020 7374 6172 745f 706f 732c        start_pos,
+00033720: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00033730: 2020 2020 2020 2020 2020 506f 696e 7428            Point(
+00033740: 7374 6172 745f 706f 732e 782c 2079 5f70  start_pos.x, y_p
+00033750: 6f69 6e74 735b 696e 6465 785d 292c 0d0a  oints[index]),..
+00033760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033770: 2020 2020 2020 2020 7265 6c61 7469 7665          relative
+00033780: 3d72 656c 6174 6976 652c 0d0a 2020 2020  =relative,..    
+00033790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000337a0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+000337b0: 2020 2029 0d0a 2020 2020 2020 2020 7265     )..        re
+000337c0: 7475 726e 2073 656c 660d 0a0d 0a20 2020  turn self....   
+000337d0: 2064 6566 2068 6f72 697a 6f6e 7461 6c28   def horizontal(
+000337e0: 7365 6c66 2c20 2a78 5f70 6f69 6e74 732c  self, *x_points,
+000337f0: 2072 656c 6174 6976 653d 4661 6c73 652c   relative=False,
+00033800: 202a 2a6b 7761 7267 7329 3a0d 0a20 2020   **kwargs):..   
+00033810: 2020 2020 2066 6f72 2069 6e64 6578 2069       for index i
+00033820: 6e20 7261 6e67 6528 6c65 6e28 785f 706f  n range(len(x_po
+00033830: 696e 7473 2929 3a0d 0a20 2020 2020 2020  ints)):..       
+00033840: 2020 2020 2073 7461 7274 5f70 6f73 203d       start_pos =
+00033850: 2073 656c 662e 6375 7272 656e 745f 706f   self.current_po
+00033860: 696e 740d 0a20 2020 2020 2020 2020 2020  int..           
+00033870: 2069 6620 7265 6c61 7469 7665 3a0d 0a20   if relative:.. 
+00033880: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00033890: 656c 662e 6170 7065 6e64 280d 0a20 2020  elf.append(..   
+000338a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000338b0: 204c 696e 6528 0d0a 2020 2020 2020 2020   Line(..        
+000338c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000338d0: 7374 6172 745f 706f 732c 0d0a 2020 2020  start_pos,..    
+000338e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000338f0: 2020 2020 506f 696e 7428 7374 6172 745f      Point(start_
+00033900: 706f 732e 7820 2b20 785f 706f 696e 7473  pos.x + x_points
+00033910: 5b69 6e64 6578 5d2c 2073 7461 7274 5f70  [index], start_p
+00033920: 6f73 2e79 292c 0d0a 2020 2020 2020 2020  os.y),..        
+00033930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033940: 7265 6c61 7469 7665 3d72 656c 6174 6976  relative=relativ
+00033950: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
+00033960: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
+00033970: 2020 2020 2020 2020 2020 2029 0d0a 2020             )..  
+00033980: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
+00033990: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000339a0: 2073 656c 662e 6170 7065 6e64 280d 0a20   self.append(.. 
+000339b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000339c0: 2020 204c 696e 6528 0d0a 2020 2020 2020     Line(..      
+000339d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000339e0: 2020 7374 6172 745f 706f 732c 0d0a 2020    start_pos,..  
+000339f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033a00: 2020 2020 2020 506f 696e 7428 785f 706f        Point(x_po
+00033a10: 696e 7473 5b69 6e64 6578 5d2c 2073 7461  ints[index], sta
+00033a20: 7274 5f70 6f73 2e79 292c 0d0a 2020 2020  rt_pos.y),..    
+00033a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033a40: 2020 2020 7265 6c61 7469 7665 3d72 656c      relative=rel
+00033a50: 6174 6976 652c 0d0a 2020 2020 2020 2020  ative,..        
+00033a60: 2020 2020 2020 2020 2020 2020 290d 0a20              ).. 
+00033a70: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00033a80: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00033a90: 2073 656c 660d 0a0d 0a20 2020 2064 6566   self....    def
+00033aa0: 2073 6d6f 6f74 685f 7175 6164 2873 656c   smooth_quad(sel
+00033ab0: 662c 202a 706f 696e 7473 2c20 7265 6c61  f, *points, rela
+00033ac0: 7469 7665 3d46 616c 7365 2c20 2a2a 6b77  tive=False, **kw
+00033ad0: 6172 6773 293a 0d0a 2020 2020 2020 2020  args):..        
+00033ae0: 2222 2253 6d6f 6f74 6820 6375 7276 652e  """Smooth curve.
+00033af0: 2046 6972 7374 2063 6f6e 7472 6f6c 2070   First control p
+00033b00: 6f69 6e74 2069 7320 7468 6520 2272 6566  oint is the "ref
+00033b10: 6c65 6374 696f 6e22 206f 660d 0a20 2020  lection" of..   
+00033b20: 2020 2020 2074 6865 2073 6563 6f6e 6420       the second 
+00033b30: 636f 6e74 726f 6c20 706f 696e 7420 696e  control point in
+00033b40: 2074 6865 2070 7265 7669 6f75 7320 7061   the previous pa
+00033b50: 7468 2e22 2222 0d0a 2020 2020 2020 2020  th."""..        
+00033b60: 666f 7220 696e 6465 7820 696e 2072 616e  for index in ran
+00033b70: 6765 286c 656e 2870 6f69 6e74 7329 293a  ge(len(points)):
+00033b80: 0d0a 2020 2020 2020 2020 2020 2020 7374  ..            st
+00033b90: 6172 745f 706f 7320 3d20 7365 6c66 2e63  art_pos = self.c
+00033ba0: 7572 7265 6e74 5f70 6f69 6e74 0d0a 2020  urrent_point..  
+00033bb0: 2020 2020 2020 2020 2020 636f 6e74 726f            contro
+00033bc0: 6c31 203d 2073 656c 662e 736d 6f6f 7468  l1 = self.smooth
+00033bd0: 5f70 6f69 6e74 0d0a 2020 2020 2020 2020  _point..        
+00033be0: 2020 2020 656e 645f 706f 7320 3d20 706f      end_pos = po
+00033bf0: 696e 7473 5b69 6e64 6578 5d0d 0a20 2020  ints[index]..   
+00033c00: 2020 2020 2020 2020 2069 6620 656e 645f           if end_
+00033c10: 706f 7320 696e 2028 227a 222c 2022 5a22  pos in ("z", "Z"
+00033c20: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00033c30: 2020 2020 656e 645f 706f 7320 3d20 7365      end_pos = se
+00033c40: 6c66 2e7a 5f70 6f69 6e74 0d0a 2020 2020  lf.z_point..    
+00033c50: 2020 2020 2020 2020 7365 6c66 2e61 7070          self.app
+00033c60: 656e 6428 0d0a 2020 2020 2020 2020 2020  end(..          
+00033c70: 2020 2020 2020 5175 6164 7261 7469 6342        QuadraticB
+00033c80: 657a 6965 7228 0d0a 2020 2020 2020 2020  ezier(..        
+00033c90: 2020 2020 2020 2020 2020 2020 7374 6172              star
+00033ca0: 745f 706f 732c 2063 6f6e 7472 6f6c 312c  t_pos, control1,
+00033cb0: 2065 6e64 5f70 6f73 2c20 7265 6c61 7469   end_pos, relati
+00033cc0: 7665 3d72 656c 6174 6976 652c 2073 6d6f  ve=relative, smo
+00033cd0: 6f74 683d 5472 7565 0d0a 2020 2020 2020  oth=True..      
+00033ce0: 2020 2020 2020 2020 2020 290d 0a20 2020            )..   
+00033cf0: 2020 2020 2020 2020 2029 0d0a 2020 2020           )..    
+00033d00: 2020 2020 7265 7475 726e 2073 656c 660d      return self.
+00033d10: 0a0d 0a20 2020 2064 6566 2071 7561 6428  ...    def quad(
+00033d20: 7365 6c66 2c20 2a70 6f69 6e74 732c 2072  self, *points, r
+00033d30: 656c 6174 6976 653d 4661 6c73 652c 202a  elative=False, *
+00033d40: 2a6b 7761 7267 7329 3a0d 0a20 2020 2020  *kwargs):..     
+00033d50: 2020 2066 6f72 2069 6e64 6578 2069 6e20     for index in 
+00033d60: 7261 6e67 6528 302c 206c 656e 2870 6f69  range(0, len(poi
+00033d70: 6e74 7329 2c20 3229 3a0d 0a20 2020 2020  nts), 2):..     
+00033d80: 2020 2020 2020 2073 7461 7274 5f70 6f73         start_pos
+00033d90: 203d 2073 656c 662e 6375 7272 656e 745f   = self.current_
+00033da0: 706f 696e 740d 0a20 2020 2020 2020 2020  point..         
+00033db0: 2020 2063 6f6e 7472 6f6c 203d 2070 6f69     control = poi
+00033dc0: 6e74 735b 696e 6465 785d 0d0a 2020 2020  nts[index]..    
+00033dd0: 2020 2020 2020 2020 6966 2063 6f6e 7472          if contr
+00033de0: 6f6c 2069 6e20 2822 7a22 2c20 225a 2229  ol in ("z", "Z")
+00033df0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00033e00: 2020 2063 6f6e 7472 6f6c 203d 2073 656c     control = sel
+00033e10: 662e 7a5f 706f 696e 740d 0a20 2020 2020  f.z_point..     
+00033e20: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00033e30: 6170 7065 6e64 280d 0a20 2020 2020 2020  append(..       
+00033e40: 2020 2020 2020 2020 2020 2020 2051 7561               Qua
+00033e50: 6472 6174 6963 4265 7a69 6572 280d 0a20  draticBezier(.. 
+00033e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033e70: 2020 2020 2020 2073 7461 7274 5f70 6f73         start_pos
+00033e80: 2c20 636f 6e74 726f 6c2c 2063 6f6e 7472  , control, contr
+00033e90: 6f6c 2c20 7265 6c61 7469 7665 3d72 656c  ol, relative=rel
+00033ea0: 6174 6976 652c 2073 6d6f 6f74 683d 4661  ative, smooth=Fa
+00033eb0: 6c73 650d 0a20 2020 2020 2020 2020 2020  lse..           
+00033ec0: 2020 2020 2020 2020 2029 0d0a 2020 2020           )..    
+00033ed0: 2020 2020 2020 2020 2020 2020 290d 0a20              ).. 
+00033ee0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00033ef0: 6574 7572 6e20 7365 6c66 0d0a 2020 2020  eturn self..    
+00033f00: 2020 2020 2020 2020 656e 645f 706f 7320          end_pos 
+00033f10: 3d20 706f 696e 7473 5b69 6e64 6578 202b  = points[index +
+00033f20: 2031 5d0d 0a20 2020 2020 2020 2020 2020   1]..           
+00033f30: 2069 6620 656e 645f 706f 7320 696e 2028   if end_pos in (
+00033f40: 227a 222c 2022 5a22 293a 0d0a 2020 2020  "z", "Z"):..    
+00033f50: 2020 2020 2020 2020 2020 2020 656e 645f              end_
+00033f60: 706f 7320 3d20 7365 6c66 2e7a 5f70 6f69  pos = self.z_poi
+00033f70: 6e74 0d0a 2020 2020 2020 2020 2020 2020  nt..            
+00033f80: 7365 6c66 2e61 7070 656e 6428 0d0a 2020  self.append(..  
+00033f90: 2020 2020 2020 2020 2020 2020 2020 5175                Qu
+00033fa0: 6164 7261 7469 6342 657a 6965 7228 0d0a  adraticBezier(..
+00033fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033fc0: 2020 2020 7374 6172 745f 706f 732c 2063      start_pos, c
+00033fd0: 6f6e 7472 6f6c 2c20 656e 645f 706f 732c  ontrol, end_pos,
+00033fe0: 2072 656c 6174 6976 653d 7265 6c61 7469   relative=relati
+00033ff0: 7665 2c20 736d 6f6f 7468 3d46 616c 7365  ve, smooth=False
+00034000: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00034010: 2020 290d 0a20 2020 2020 2020 2020 2020    )..           
+00034020: 2029 0d0a 2020 2020 2020 2020 7265 7475   )..        retu
+00034030: 726e 2073 656c 660d 0a0d 0a20 2020 2064  rn self....    d
+00034040: 6566 2073 6d6f 6f74 685f 6375 6269 6328  ef smooth_cubic(
+00034050: 7365 6c66 2c20 2a70 6f69 6e74 732c 2072  self, *points, r
+00034060: 656c 6174 6976 653d 4661 6c73 652c 202a  elative=False, *
+00034070: 2a6b 7761 7267 7329 3a0d 0a20 2020 2020  *kwargs):..     
+00034080: 2020 2022 2222 536d 6f6f 7468 2063 7572     """Smooth cur
+00034090: 7665 2e20 4669 7273 7420 636f 6e74 726f  ve. First contro
+000340a0: 6c20 706f 696e 7420 6973 2074 6865 2022  l point is the "
+000340b0: 7265 666c 6563 7469 6f6e 2220 6f66 0d0a  reflection" of..
+000340c0: 2020 2020 2020 2020 7468 6520 7365 636f          the seco
+000340d0: 6e64 2063 6f6e 7472 6f6c 2070 6f69 6e74  nd control point
+000340e0: 2069 6e20 7468 6520 7072 6576 696f 7573   in the previous
+000340f0: 2070 6174 682e 2222 220d 0a20 2020 2020   path."""..     
+00034100: 2020 2066 6f72 2069 6e64 6578 2069 6e20     for index in 
+00034110: 7261 6e67 6528 302c 206c 656e 2870 6f69  range(0, len(poi
+00034120: 6e74 7329 2c20 3229 3a0d 0a20 2020 2020  nts), 2):..     
+00034130: 2020 2020 2020 2073 7461 7274 5f70 6f73         start_pos
+00034140: 203d 2073 656c 662e 6375 7272 656e 745f   = self.current_
+00034150: 706f 696e 740d 0a20 2020 2020 2020 2020  point..         
+00034160: 2020 2063 6f6e 7472 6f6c 3120 3d20 7365     control1 = se
+00034170: 6c66 2e73 6d6f 6f74 685f 706f 696e 740d  lf.smooth_point.
+00034180: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
+00034190: 7472 6f6c 3220 3d20 706f 696e 7473 5b69  trol2 = points[i
+000341a0: 6e64 6578 5d0d 0a0d 0a20 2020 2020 2020  ndex]....       
+000341b0: 2020 2020 2069 6620 636f 6e74 726f 6c32       if control2
+000341c0: 2069 6e20 2822 7a22 2c20 225a 2229 3a0d   in ("z", "Z"):.
+000341d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000341e0: 2063 6f6e 7472 6f6c 3220 3d20 7365 6c66   control2 = self
+000341f0: 2e7a 5f70 6f69 6e74 0d0a 2020 2020 2020  .z_point..      
+00034200: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00034210: 7070 656e 6428 0d0a 2020 2020 2020 2020  ppend(..        
+00034220: 2020 2020 2020 2020 2020 2020 4375 6269              Cubi
+00034230: 6342 657a 6965 7228 0d0a 2020 2020 2020  cBezier(..      
+00034240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034250: 2020 7374 6172 745f 706f 732c 0d0a 2020    start_pos,..  
+00034260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034270: 2020 2020 2020 636f 6e74 726f 6c31 2c0d        control1,.
+00034280: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00034290: 2020 2020 2020 2020 2063 6f6e 7472 6f6c           control
+000342a0: 322c 0d0a 2020 2020 2020 2020 2020 2020  2,..            
+000342b0: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+000342c0: 726f 6c32 2c0d 0a20 2020 2020 2020 2020  rol2,..         
+000342d0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+000342e0: 656c 6174 6976 653d 7265 6c61 7469 7665  elative=relative
+000342f0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00034300: 2020 2020 2020 2020 2020 2073 6d6f 6f74             smoot
+00034310: 683d 5472 7565 2c0d 0a20 2020 2020 2020  h=True,..       
+00034320: 2020 2020 2020 2020 2020 2020 2029 0d0a               )..
+00034330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034340: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00034350: 2020 2072 6574 7572 6e20 7365 6c66 0d0a     return self..
+00034360: 2020 2020 2020 2020 2020 2020 656e 645f              end_
+00034370: 706f 7320 3d20 706f 696e 7473 5b69 6e64  pos = points[ind
+00034380: 6578 202b 2031 5d0d 0a20 2020 2020 2020  ex + 1]..       
+00034390: 2020 2020 2069 6620 656e 645f 706f 7320       if end_pos 
+000343a0: 696e 2028 227a 222c 2022 5a22 293a 0d0a  in ("z", "Z"):..
+000343b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000343c0: 656e 645f 706f 7320 3d20 7365 6c66 2e7a  end_pos = self.z
+000343d0: 5f70 6f69 6e74 0d0a 2020 2020 2020 2020  _point..        
+000343e0: 2020 2020 7365 6c66 2e61 7070 656e 6428      self.append(
+000343f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00034400: 2020 4375 6269 6342 657a 6965 7228 0d0a    CubicBezier(..
+00034410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034420: 2020 2020 7374 6172 745f 706f 732c 0d0a      start_pos,..
+00034430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034440: 2020 2020 636f 6e74 726f 6c31 2c0d 0a20      control1,.. 
+00034450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034460: 2020 2063 6f6e 7472 6f6c 322c 0d0a 2020     control2,..  
+00034470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034480: 2020 656e 645f 706f 732c 0d0a 2020 2020    end_pos,..    
+00034490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000344a0: 7265 6c61 7469 7665 3d72 656c 6174 6976  relative=relativ
+000344b0: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
+000344c0: 2020 2020 2020 2020 736d 6f6f 7468 3d54          smooth=T
+000344d0: 7275 652c 0d0a 2020 2020 2020 2020 2020  rue,..          
+000344e0: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
+000344f0: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
+00034500: 7265 7475 726e 2073 656c 660d 0a0d 0a20  return self.... 
+00034510: 2020 2064 6566 2063 7562 6963 2873 656c     def cubic(sel
+00034520: 662c 202a 706f 696e 7473 2c20 7265 6c61  f, *points, rela
+00034530: 7469 7665 3d46 616c 7365 2c20 2a2a 6b77  tive=False, **kw
+00034540: 6172 6773 293a 0d0a 2020 2020 2020 2020  args):..        
+00034550: 666f 7220 696e 6465 7820 696e 2072 616e  for index in ran
+00034560: 6765 2830 2c20 6c65 6e28 706f 696e 7473  ge(0, len(points
+00034570: 292c 2033 293a 0d0a 2020 2020 2020 2020  ), 3):..        
+00034580: 2020 2020 7374 6172 745f 706f 7320 3d20      start_pos = 
+00034590: 7365 6c66 2e63 7572 7265 6e74 5f70 6f69  self.current_poi
+000345a0: 6e74 0d0a 2020 2020 2020 2020 2020 2020  nt..            
+000345b0: 636f 6e74 726f 6c31 203d 2070 6f69 6e74  control1 = point
+000345c0: 735b 696e 6465 785d 0d0a 2020 2020 2020  s[index]..      
+000345d0: 2020 2020 2020 6966 2063 6f6e 7472 6f6c        if control
+000345e0: 3120 696e 2028 227a 222c 2022 5a22 293a  1 in ("z", "Z"):
+000345f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00034600: 2020 636f 6e74 726f 6c31 203d 2073 656c    control1 = sel
+00034610: 662e 7a5f 706f 696e 740d 0a20 2020 2020  f.z_point..     
+00034620: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00034630: 6170 7065 6e64 280d 0a20 2020 2020 2020  append(..       
+00034640: 2020 2020 2020 2020 2020 2020 2043 7562               Cub
+00034650: 6963 4265 7a69 6572 280d 0a20 2020 2020  icBezier(..     
+00034660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034670: 2020 2073 7461 7274 5f70 6f73 2c0d 0a20     start_pos,.. 
+00034680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034690: 2020 2020 2020 2063 6f6e 7472 6f6c 312c         control1,
+000346a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000346b0: 2020 2020 2020 2020 2020 636f 6e74 726f            contro
+000346c0: 6c31 2c0d 0a20 2020 2020 2020 2020 2020  l1,..           
+000346d0: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+000346e0: 7472 6f6c 312c 0d0a 2020 2020 2020 2020  trol1,..        
+000346f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034700: 7265 6c61 7469 7665 3d72 656c 6174 6976  relative=relativ
+00034710: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
+00034720: 2020 2020 2020 2020 2020 2020 736d 6f6f              smoo
+00034730: 7468 3d54 7275 652c 0d0a 2020 2020 2020  th=True,..      
+00034740: 2020 2020 2020 2020 2020 2020 2020 290d                ).
+00034750: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00034760: 2029 0d0a 2020 2020 2020 2020 2020 2020   )..            
+00034770: 2020 2020 7265 7475 726e 2073 656c 660d      return self.
+00034780: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
+00034790: 7472 6f6c 3220 3d20 706f 696e 7473 5b69  trol2 = points[i
+000347a0: 6e64 6578 202b 2031 5d0d 0a20 2020 2020  ndex + 1]..     
+000347b0: 2020 2020 2020 2069 6620 636f 6e74 726f         if contro
+000347c0: 6c32 2069 6e20 2822 7a22 2c20 225a 2229  l2 in ("z", "Z")
+000347d0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+000347e0: 2020 2063 6f6e 7472 6f6c 3220 3d20 7365     control2 = se
+000347f0: 6c66 2e7a 5f70 6f69 6e74 0d0a 2020 2020  lf.z_point..    
+00034800: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00034810: 2e61 7070 656e 6428 0d0a 2020 2020 2020  .append(..      
+00034820: 2020 2020 2020 2020 2020 2020 2020 4375                Cu
+00034830: 6269 6342 657a 6965 7228 0d0a 2020 2020  bicBezier(..    
+00034840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034850: 2020 2020 7374 6172 745f 706f 732c 0d0a      start_pos,..
+00034860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034870: 2020 2020 2020 2020 636f 6e74 726f 6c31          control1
+00034880: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00034890: 2020 2020 2020 2020 2020 2063 6f6e 7472             contr
+000348a0: 6f6c 322c 0d0a 2020 2020 2020 2020 2020  ol2,..          
+000348b0: 2020 2020 2020 2020 2020 2020 2020 636f                co
+000348c0: 6e74 726f 6c32 2c0d 0a20 2020 2020 2020  ntrol2,..       
+000348d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000348e0: 2072 656c 6174 6976 653d 7265 6c61 7469   relative=relati
+000348f0: 7665 2c0d 0a20 2020 2020 2020 2020 2020  ve,..           
+00034900: 2020 2020 2020 2020 2020 2020 2073 6d6f               smo
+00034910: 6f74 683d 5472 7565 2c0d 0a20 2020 2020  oth=True,..     
+00034920: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00034930: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00034940: 2020 290d 0a20 2020 2020 2020 2020 2020    )..           
+00034950: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00034960: 0d0a 2020 2020 2020 2020 2020 2020 656e  ..            en
+00034970: 645f 706f 7320 3d20 706f 696e 7473 5b69  d_pos = points[i
+00034980: 6e64 6578 202b 2032 5d0d 0a20 2020 2020  ndex + 2]..     
+00034990: 2020 2020 2020 2069 6620 656e 645f 706f         if end_po
+000349a0: 7320 696e 2028 227a 222c 2022 5a22 293a  s in ("z", "Z"):
+000349b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000349c0: 2020 656e 645f 706f 7320 3d20 7365 6c66    end_pos = self
+000349d0: 2e7a 5f70 6f69 6e74 0d0a 2020 2020 2020  .z_point..      
+000349e0: 2020 2020 2020 7365 6c66 2e61 7070 656e        self.appen
+000349f0: 6428 0d0a 2020 2020 2020 2020 2020 2020  d(..            
+00034a00: 2020 2020 4375 6269 6342 657a 6965 7228      CubicBezier(
+00034a10: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00034a20: 2020 2020 2020 7374 6172 745f 706f 732c        start_pos,
+00034a30: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00034a40: 2020 2020 2020 636f 6e74 726f 6c31 2c0d        control1,.
+00034a50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00034a60: 2020 2020 2063 6f6e 7472 6f6c 322c 0d0a       control2,..
+00034a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034a80: 2020 2020 656e 645f 706f 732c 0d0a 2020      end_pos,..  
+00034a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034aa0: 2020 7265 6c61 7469 7665 3d72 656c 6174    relative=relat
+00034ab0: 6976 652c 0d0a 2020 2020 2020 2020 2020  ive,..          
+00034ac0: 2020 2020 2020 2020 2020 736d 6f6f 7468            smooth
+00034ad0: 3d46 616c 7365 2c0d 0a20 2020 2020 2020  =False,..       
+00034ae0: 2020 2020 2020 2020 2029 0d0a 2020 2020           )..    
+00034af0: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
+00034b00: 2020 2072 6574 7572 6e20 7365 6c66 0d0a     return self..
+00034b10: 0d0a 2020 2020 6465 6620 6172 6328 7365  ..    def arc(se
+00034b20: 6c66 2c20 2a61 7263 5f61 7267 732c 2072  lf, *arc_args, r
+00034b30: 656c 6174 6976 653d 4661 6c73 652c 202a  elative=False, *
+00034b40: 2a6b 7761 7267 7329 3a0d 0a20 2020 2020  *kwargs):..     
+00034b50: 2020 2066 6f72 2069 6e64 6578 2069 6e20     for index in 
+00034b60: 7261 6e67 6528 302c 206c 656e 2861 7263  range(0, len(arc
+00034b70: 5f61 7267 7329 2c20 3629 3a0d 0a20 2020  _args), 6):..   
+00034b80: 2020 2020 2020 2020 2073 7461 7274 5f70           start_p
+00034b90: 6f73 203d 2073 656c 662e 6375 7272 656e  os = self.curren
+00034ba0: 745f 706f 696e 740d 0a20 2020 2020 2020  t_point..       
+00034bb0: 2020 2020 2072 7820 3d20 6172 635f 6172       rx = arc_ar
+00034bc0: 6773 5b69 6e64 6578 5d0d 0a20 2020 2020  gs[index]..     
+00034bd0: 2020 2020 2020 2072 7920 3d20 6172 635f         ry = arc_
+00034be0: 6172 6773 5b69 6e64 6578 202b 2031 5d0d  args[index + 1].
+00034bf0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00034c00: 7278 203c 2030 3a0d 0a20 2020 2020 2020  rx < 0:..       
+00034c10: 2020 2020 2020 2020 2072 7820 3d20 6162           rx = ab
+00034c20: 7328 7278 290d 0a20 2020 2020 2020 2020  s(rx)..         
+00034c30: 2020 2069 6620 7279 203c 2030 3a0d 0a20     if ry < 0:.. 
+00034c40: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00034c50: 7920 3d20 6162 7328 7279 290d 0a20 2020  y = abs(ry)..   
+00034c60: 2020 2020 2020 2020 2072 6f74 6174 696f           rotatio
+00034c70: 6e20 3d20 6172 635f 6172 6773 5b69 6e64  n = arc_args[ind
+00034c80: 6578 202b 2032 5d0d 0a20 2020 2020 2020  ex + 2]..       
+00034c90: 2020 2020 2061 7263 203d 2061 7263 5f61       arc = arc_a
+00034ca0: 7267 735b 696e 6465 7820 2b20 335d 0d0a  rgs[index + 3]..
+00034cb0: 2020 2020 2020 2020 2020 2020 7377 6565              swee
+00034cc0: 7020 3d20 6172 635f 6172 6773 5b69 6e64  p = arc_args[ind
+00034cd0: 6578 202b 2034 5d0d 0a20 2020 2020 2020  ex + 4]..       
+00034ce0: 2020 2020 2065 6e64 5f70 6f73 203d 2061       end_pos = a
+00034cf0: 7263 5f61 7267 735b 696e 6465 7820 2b20  rc_args[index + 
+00034d00: 355d 0d0a 2020 2020 2020 2020 2020 2020  5]..            
+00034d10: 6966 2065 6e64 5f70 6f73 2069 6e20 2822  if end_pos in ("
+00034d20: 7a22 2c20 225a 2229 3a0d 0a20 2020 2020  z", "Z"):..     
+00034d30: 2020 2020 2020 2020 2020 2065 6e64 5f70             end_p
+00034d40: 6f73 203d 2073 656c 662e 7a5f 706f 696e  os = self.z_poin
+00034d50: 740d 0a20 2020 2020 2020 2020 2020 2073  t..            s
+00034d60: 656c 662e 6170 7065 6e64 280d 0a20 2020  elf.append(..   
+00034d70: 2020 2020 2020 2020 2020 2020 2041 7263               Arc
+00034d80: 2873 7461 7274 5f70 6f73 2c20 7278 2c20  (start_pos, rx, 
+00034d90: 7279 2c20 726f 7461 7469 6f6e 2c20 6172  ry, rotation, ar
+00034da0: 632c 2073 7765 6570 2c20 656e 645f 706f  c, sweep, end_po
+00034db0: 732c 2072 656c 6174 6976 653d 7265 6c61  s, relative=rela
+00034dc0: 7469 7665 290d 0a20 2020 2020 2020 2020  tive)..         
+00034dd0: 2020 2029 0d0a 2020 2020 2020 2020 7265     )..        re
+00034de0: 7475 726e 2073 656c 660d 0a0d 0a20 2020  turn self....   
+00034df0: 2064 6566 2063 6c6f 7365 6428 7365 6c66   def closed(self
+00034e00: 2c20 7265 6c61 7469 7665 3d46 616c 7365  , relative=False
+00034e10: 293a 0d0a 2020 2020 2020 2020 7374 6172  ):..        star
+00034e20: 745f 706f 7320 3d20 7365 6c66 2e63 7572  t_pos = self.cur
+00034e30: 7265 6e74 5f70 6f69 6e74 0d0a 2020 2020  rent_point..    
+00034e40: 2020 2020 656e 645f 706f 7320 3d20 7365      end_pos = se
+00034e50: 6c66 2e7a 5f70 6f69 6e74 0d0a 2020 2020  lf.z_point..    
+00034e60: 2020 2020 7365 676d 656e 7420 3d20 436c      segment = Cl
+00034e70: 6f73 6528 7374 6172 745f 706f 732c 2065  ose(start_pos, e
+00034e80: 6e64 5f70 6f73 290d 0a20 2020 2020 2020  nd_pos)..       
+00034e90: 2073 6567 6d65 6e74 2e72 656c 6174 6976   segment.relativ
+00034ea0: 6520 3d20 7265 6c61 7469 7665 0d0a 2020  e = relative..  
+00034eb0: 2020 2020 2020 7365 6c66 2e61 7070 656e        self.appen
+00034ec0: 6428 7365 676d 656e 7429 0d0a 2020 2020  d(segment)..    
+00034ed0: 2020 2020 7265 7475 726e 2073 656c 660d      return self.
+00034ee0: 0a0d 0a20 2020 2064 6566 2061 7070 656e  ...    def appen
+00034ef0: 6428 7365 6c66 2c20 7661 6c75 6529 3a0d  d(self, value):.
+00034f00: 0a20 2020 2020 2020 2069 6620 6973 696e  .        if isin
+00034f10: 7374 616e 6365 2876 616c 7565 2c20 7374  stance(value, st
+00034f20: 7229 3a0d 0a20 2020 2020 2020 2020 2020  r):..           
+00034f30: 2076 616c 7565 203d 2050 6174 6828 7661   value = Path(va
+00034f40: 6c75 6529 0d0a 2020 2020 2020 2020 2020  lue)..          
+00034f50: 2020 6966 206c 656e 2876 616c 7565 2920    if len(value) 
+00034f60: 3d3d 2030 3a0d 0a20 2020 2020 2020 2020  == 0:..         
+00034f70: 2020 2020 2020 2072 6574 7572 6e0d 0a20         return.. 
+00034f80: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
+00034f90: 6e28 7661 6c75 6529 203e 2031 3a0d 0a20  n(value) > 1:.. 
+00034fa0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00034fb0: 656c 662e 6578 7465 6e64 2876 616c 7565  elf.extend(value
+00034fc0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00034fd0: 2020 2072 6574 7572 6e0d 0a20 2020 2020     return..     
+00034fe0: 2020 2020 2020 2076 616c 7565 203d 2076         value = v
+00034ff0: 616c 7565 5b30 5d0d 0a20 2020 2020 2020  alue[0]..       
+00035000: 2073 656c 662e 5f6c 656e 6774 6820 3d20   self._length = 
+00035010: 4e6f 6e65 0d0a 2020 2020 2020 2020 696e  None..        in
+00035020: 6465 7820 3d20 6c65 6e28 7365 6c66 2e5f  dex = len(self._
+00035030: 7365 676d 656e 7473 2920 2d20 310d 0a20  segments) - 1.. 
+00035040: 2020 2020 2020 2073 656c 662e 5f73 6567         self._seg
+00035050: 6d65 6e74 732e 6170 7065 6e64 2876 616c  ments.append(val
+00035060: 7565 290d 0a20 2020 2020 2020 2073 656c  ue)..        sel
+00035070: 662e 5f76 616c 6964 6174 655f 636f 6e6e  f._validate_conn
+00035080: 6563 7469 6f6e 2869 6e64 6578 290d 0a20  ection(index).. 
+00035090: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
+000350a0: 616e 6365 2876 616c 7565 2c20 436c 6f73  ance(value, Clos
+000350b0: 6529 3a0d 0a20 2020 2020 2020 2020 2020  e):..           
+000350c0: 2073 656c 662e 5f76 616c 6964 6174 655f   self._validate_
+000350d0: 636c 6f73 6528 696e 6465 7820 2b20 3129  close(index + 1)
+000350e0: 0d0a 0d0a 2020 2020 6465 6620 696e 7365  ....    def inse
+000350f0: 7274 2873 656c 662c 2069 6e64 6578 2c20  rt(self, index, 
+00035100: 7661 6c75 6529 3a0d 0a20 2020 2020 2020  value):..       
+00035110: 2069 6620 6973 696e 7374 616e 6365 2876   if isinstance(v
+00035120: 616c 7565 2c20 7374 7229 3a0d 0a20 2020  alue, str):..   
+00035130: 2020 2020 2020 2020 2076 616c 7565 203d           value =
+00035140: 2050 6174 6828 7661 6c75 6529 0d0a 2020   Path(value)..  
+00035150: 2020 2020 2020 2020 2020 6966 206c 656e            if len
+00035160: 2876 616c 7565 2920 3d3d 2030 3a0d 0a20  (value) == 0:.. 
+00035170: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00035180: 6574 7572 6e0d 0a20 2020 2020 2020 2020  eturn..         
+00035190: 2020 2076 616c 7565 203d 2076 616c 7565     value = value
+000351a0: 5b30 5d0d 0a20 2020 2020 2020 2073 656c  [0]..        sel
+000351b0: 662e 5f6c 656e 6774 6820 3d20 4e6f 6e65  f._length = None
+000351c0: 0d0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
+000351d0: 7365 676d 656e 7473 2e69 6e73 6572 7428  segments.insert(
+000351e0: 696e 6465 782c 2076 616c 7565 290d 0a20  index, value).. 
+000351f0: 2020 2020 2020 2073 656c 662e 5f76 616c         self._val
+00035200: 6964 6174 655f 636f 6e6e 6563 7469 6f6e  idate_connection
+00035210: 2869 6e64 6578 202d 2031 290d 0a20 2020  (index - 1)..   
+00035220: 2020 2020 2073 656c 662e 5f76 616c 6964       self._valid
+00035230: 6174 655f 636f 6e6e 6563 7469 6f6e 2869  ate_connection(i
+00035240: 6e64 6578 290d 0a20 2020 2020 2020 2069  ndex)..        i
+00035250: 6620 6973 696e 7374 616e 6365 2876 616c  f isinstance(val
+00035260: 7565 2c20 4d6f 7665 293a 0d0a 2020 2020  ue, Move):..    
+00035270: 2020 2020 2020 2020 7365 6c66 2e5f 7661          self._va
+00035280: 6c69 6461 7465 5f6d 6f76 6528 696e 6465  lidate_move(inde
+00035290: 7829 0d0a 2020 2020 2020 2020 6966 2069  x)..        if i
+000352a0: 7369 6e73 7461 6e63 6528 7661 6c75 652c  sinstance(value,
+000352b0: 2043 6c6f 7365 293a 0d0a 2020 2020 2020   Close):..      
+000352c0: 2020 2020 2020 7365 6c66 2e5f 7661 6c69        self._vali
+000352d0: 6461 7465 5f63 6c6f 7365 2869 6e64 6578  date_close(index
+000352e0: 290d 0a0d 0a20 2020 2064 6566 2065 7874  )....    def ext
+000352f0: 656e 6428 7365 6c66 2c20 6974 6572 6162  end(self, iterab
+00035300: 6c65 293a 0d0a 2020 2020 2020 2020 6966  le):..        if
+00035310: 2069 7369 6e73 7461 6e63 6528 6974 6572   isinstance(iter
+00035320: 6162 6c65 2c20 7374 7229 3a0d 0a20 2020  able, str):..   
+00035330: 2020 2020 2020 2020 2069 7465 7261 626c           iterabl
+00035340: 6520 3d20 5061 7468 2869 7465 7261 626c  e = Path(iterabl
+00035350: 6529 0d0a 2020 2020 2020 2020 7365 6c66  e)..        self
+00035360: 2e5f 6c65 6e67 7468 203d 204e 6f6e 650d  ._length = None.
+00035370: 0a20 2020 2020 2020 2069 6e64 6578 203d  .        index =
+00035380: 206c 656e 2873 656c 662e 5f73 6567 6d65   len(self._segme
+00035390: 6e74 7329 202d 2031 0d0a 2020 2020 2020  nts) - 1..      
+000353a0: 2020 7365 6c66 2e5f 7365 676d 656e 7473    self._segments
+000353b0: 2e65 7874 656e 6428 6974 6572 6162 6c65  .extend(iterable
+000353c0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+000353d0: 5f76 616c 6964 6174 655f 636f 6e6e 6563  _validate_connec
+000353e0: 7469 6f6e 2869 6e64 6578 290d 0a20 2020  tion(index)..   
+000353f0: 2020 2020 2073 656c 662e 5f76 616c 6964       self._valid
+00035400: 6174 655f 7375 6270 6174 6828 696e 6465  ate_subpath(inde
+00035410: 7829 0d0a 0d0a 2020 2020 6465 6620 6469  x)....    def di
+00035420: 7265 6374 5f63 6c6f 7365 2873 656c 6629  rect_close(self)
+00035430: 3a0d 0a20 2020 2020 2020 2022 2222 466f  :..        """Fo
+00035440: 7263 6573 2063 6c6f 7365 206f 7065 7261  rces close opera
+00035450: 7469 6f6e 7320 746f 2062 6520 7a65 726f  tions to be zero
+00035460: 206c 656e 6774 6820 6279 2069 6e74 726f   length by intro
+00035470: 6475 6369 6e67 2061 2064 6972 6563 740d  ducing a direct.
+00035480: 0a20 2020 2020 2020 206c 696e 6520 746f  .        line to
+00035490: 206f 7065 7261 7469 6f6e 206a 7573 7420   operation just 
+000354a0: 6265 666f 7265 2061 6e79 206e 6f6e 2d7a  before any non-z
+000354b0: 6572 6f20 6c65 6e67 7468 2063 6c6f 7365  ero length close
+000354c0: 2e0d 0a0d 0a20 2020 2020 2020 2054 6869  .....        Thi
+000354d0: 7320 6973 2068 656c 7066 756c 2062 6563  s is helpful bec
+000354e0: 6175 7365 2066 6f72 2073 6f6d 6520 6f70  ause for some op
+000354f0: 6572 6174 696f 6e73 206c 696b 6520 7265  erations like re
+00035500: 7665 7273 6528 2920 6265 6361 7573 6520  verse() because 
+00035510: 7468 650d 0a20 2020 2020 2020 2063 6c6f  the..        clo
+00035520: 7365 206d 7573 7420 6c6f 6361 7465 6420  se must located 
+00035530: 6174 2074 6865 2076 6572 7920 656e 6420  at the very end 
+00035540: 6f66 2074 6865 2070 6174 6820 7365 7175  of the path sequ
+00035550: 656e 6365 2e20 4275 742c 2069 6620 6974  ence. But, if it
+00035560: 2773 0d0a 2020 2020 2020 2020 696e 2065  's..        in e
+00035570: 6666 6563 7420 6120 6c69 6e65 2d74 6f20  ffect a line-to 
+00035580: 616e 6420 636c 6f73 652c 2074 6865 206c  and close, the l
+00035590: 696e 652d 746f 2077 6f75 6c64 206e 6565  ine-to would nee
+000355a0: 6420 746f 2073 7461 7274 2074 6865 2073  d to start the s
+000355b0: 6571 7565 6e63 652e 0d0a 0d0a 2020 2020  equence.....    
+000355c0: 2020 2020 4275 742c 2066 6f72 2073 6f6d      But, for som
+000355d0: 6520 6f70 6572 6174 696f 6e73 2074 6869  e operations thi
+000355e0: 7320 776f 6e27 7420 6d61 7474 6572 2073  s won't matter s
+000355f0: 696e 6365 2069 7420 7769 6c6c 2073 7469  ince it will sti
+00035600: 6c6c 2072 6573 756c 7420 696e 0d0a 2020  ll result in..  
+00035610: 2020 2020 2020 6120 636c 6f73 6564 2073        a closed s
+00035620: 6861 7065 2077 6974 6820 7265 7665 7273  hape with revers
+00035630: 6564 206f 7264 6572 696e 672e 2042 7574  ed ordering. But
+00035640: 2c20 6966 2074 6865 2066 696e 616c 2070  , if the final p
+00035650: 6f69 6e74 2069 6e20 7468 650d 0a20 2020  oint in the..   
+00035660: 2020 2020 2073 6571 7565 6e63 6520 6d75       sequence mu
+00035670: 7374 2065 7861 6374 6c79 2073 7769 7463  st exactly switc
+00035680: 6820 7769 7468 2074 6865 2066 6972 7374  h with the first
+00035690: 2070 6f69 6e74 2069 6e20 7468 6520 7365   point in the se
+000356a0: 7175 656e 6365 2e20 5468 650d 0a20 2020  quence. The..   
+000356b0: 2020 2020 2063 6c6f 7365 2073 6567 6d65       close segme
+000356c0: 6e74 7320 6d75 7374 2062 6520 6469 7265  nts must be dire
+000356d0: 6374 2061 6e64 207a 6572 6f20 6c65 6e67  ct and zero leng
+000356e0: 7468 2e0d 0a20 2020 2020 2020 2022 2222  th...        """
+000356f0: 0d0a 2020 2020 2020 2020 6966 206c 656e  ..        if len
+00035700: 2873 656c 662e 5f73 6567 6d65 6e74 7329  (self._segments)
+00035710: 203d 3d20 303a 0d0a 2020 2020 2020 2020   == 0:..        
+00035720: 2020 2020 7265 7475 726e 0d0a 2020 2020      return..    
+00035730: 2020 2020 666f 7220 6920 696e 2072 616e      for i in ran
+00035740: 6765 286c 656e 2873 656c 662e 5f73 6567  ge(len(self._seg
+00035750: 6d65 6e74 7329 202d 2031 2c20 2d31 2c20  ments) - 1, -1, 
+00035760: 2d31 293a 0d0a 2020 2020 2020 2020 2020  -1):..          
+00035770: 2020 7365 676d 656e 7420 3d20 7365 6c66    segment = self
+00035780: 2e5f 7365 676d 656e 7473 5b69 5d0d 0a20  ._segments[i].. 
+00035790: 2020 2020 2020 2020 2020 2069 6620 6973             if is
+000357a0: 696e 7374 616e 6365 2873 6567 6d65 6e74  instance(segment
+000357b0: 2c20 436c 6f73 6529 3a0d 0a20 2020 2020  , Close):..     
+000357c0: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+000357d0: 676d 656e 742e 6c65 6e67 7468 2829 2021  gment.length() !
+000357e0: 3d20 303a 0d0a 2020 2020 2020 2020 2020  = 0:..          
+000357f0: 2020 2020 2020 2020 2020 6c69 6e65 203d            line =
+00035800: 204c 696e 6528 7365 676d 656e 742e 7374   Line(segment.st
+00035810: 6172 742c 2073 6567 6d65 6e74 2e65 6e64  art, segment.end
+00035820: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00035830: 2020 2020 2020 2073 6567 6d65 6e74 2e73         segment.s
+00035840: 7461 7274 203d 2050 6f69 6e74 2873 6567  tart = Point(seg
+00035850: 6d65 6e74 2e65 6e64 290d 0a20 2020 2020  ment.end)..     
+00035860: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00035870: 656c 662e 696e 7365 7274 2869 2c20 6c69  elf.insert(i, li
+00035880: 6e65 290d 0a20 2020 2020 2020 2072 6574  ne)..        ret
+00035890: 7572 6e20 7365 6c66 0d0a 0d0a 2020 2020  urn self....    
+000358a0: 6465 6620 7265 7665 7273 6528 7365 6c66  def reverse(self
+000358b0: 293a 0d0a 2020 2020 2020 2020 6966 206c  ):..        if l
+000358c0: 656e 2873 656c 662e 5f73 6567 6d65 6e74  en(self._segment
+000358d0: 7329 203d 3d20 303a 0d0a 2020 2020 2020  s) == 0:..      
+000358e0: 2020 2020 2020 7265 7475 726e 0d0a 2020        return..  
+000358f0: 2020 2020 2020 7072 6570 6f69 6e74 203d        prepoint =
+00035900: 2073 656c 662e 5f73 6567 6d65 6e74 735b   self._segments[
+00035910: 305d 2e73 7461 7274 0d0a 2020 2020 2020  0].start..      
+00035920: 2020 7365 6c66 2e5f 7365 676d 656e 7473    self._segments
+00035930: 5b30 5d2e 7374 6172 7420 3d20 4e6f 6e65  [0].start = None
+00035940: 0d0a 2020 2020 2020 2020 7020 3d20 5061  ..        p = Pa
+00035950: 7468 2829 0d0a 2020 2020 2020 2020 7375  th()..        su
+00035960: 6270 6174 6873 203d 206c 6973 7428 7365  bpaths = list(se
+00035970: 6c66 2e61 735f 7375 6270 6174 6873 2829  lf.as_subpaths()
+00035980: 290d 0a20 2020 2020 2020 2066 6f72 2073  )..        for s
+00035990: 7562 7061 7468 2069 6e20 7375 6270 6174  ubpath in subpat
+000359a0: 6873 3a0d 0a20 2020 2020 2020 2020 2020  hs:..           
+000359b0: 2073 7562 7061 7468 2e72 6576 6572 7365   subpath.reverse
+000359c0: 2829 0d0a 2020 2020 2020 2020 666f 7220  ()..        for 
+000359d0: 7375 6270 6174 6820 696e 2072 6576 6572  subpath in rever
+000359e0: 7365 6428 7375 6270 6174 6873 293a 0d0a  sed(subpaths):..
+000359f0: 2020 2020 2020 2020 2020 2020 7020 2b3d              p +=
+00035a00: 2073 7562 7061 7468 0d0a 2020 2020 2020   subpath..      
+00035a10: 2020 7365 6c66 2e5f 7365 676d 656e 7473    self._segments
+00035a20: 203d 2070 2e5f 7365 676d 656e 7473 0d0a   = p._segments..
+00035a30: 2020 2020 2020 2020 7365 6c66 2e5f 7365          self._se
+00035a40: 676d 656e 7473 5b30 5d2e 7374 6172 7420  gments[0].start 
+00035a50: 3d20 7072 6570 6f69 6e74 0d0a 2020 2020  = prepoint..    
+00035a60: 2020 2020 7265 7475 726e 2073 656c 660d      return self.
+00035a70: 0a0d 0a20 2020 2064 6566 2073 7562 7061  ...    def subpa
+00035a80: 7468 2873 656c 662c 2069 6e64 6578 293a  th(self, index):
+00035a90: 0d0a 2020 2020 2020 2020 7375 6270 6174  ..        subpat
+00035aa0: 6873 203d 206c 6973 7428 7365 6c66 2e61  hs = list(self.a
+00035ab0: 735f 7375 6270 6174 6873 2829 290d 0a20  s_subpaths()).. 
+00035ac0: 2020 2020 2020 2072 6574 7572 6e20 7375         return su
+00035ad0: 6270 6174 6873 5b69 6e64 6578 5d0d 0a0d  bpaths[index]...
+00035ae0: 0a20 2020 2064 6566 2063 6f75 6e74 5f73  .    def count_s
+00035af0: 7562 7061 7468 7328 7365 6c66 293a 0d0a  ubpaths(self):..
+00035b00: 2020 2020 2020 2020 7375 6270 6174 6873          subpaths
+00035b10: 203d 206c 6973 7428 7365 6c66 2e61 735f   = list(self.as_
+00035b20: 7375 6270 6174 6873 2829 290d 0a20 2020  subpaths())..   
+00035b30: 2020 2020 2072 6574 7572 6e20 6c65 6e28       return len(
+00035b40: 7375 6270 6174 6873 290d 0a0d 0a20 2020  subpaths)....   
+00035b50: 2064 6566 2061 735f 7375 6270 6174 6873   def as_subpaths
+00035b60: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
+00035b70: 2073 7461 7274 203d 2030 0d0a 2020 2020   start = 0..    
+00035b80: 2020 2020 666f 7220 6375 7272 656e 742c      for current,
+00035b90: 2073 6567 2069 6e20 656e 756d 6572 6174   seg in enumerat
+00035ba0: 6528 7365 6c66 293a 0d0a 2020 2020 2020  e(self):..      
+00035bb0: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+00035bc0: 6e63 6528 7365 672c 204d 6f76 6529 3a0d  nce(seg, Move):.
+00035bd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00035be0: 2069 6620 6375 7272 656e 7420 213d 2073   if current != s
+00035bf0: 7461 7274 3a0d 0a20 2020 2020 2020 2020  tart:..         
+00035c00: 2020 2020 2020 2020 2020 2079 6965 6c64             yield
+00035c10: 2053 7562 7061 7468 2873 656c 662c 2073   Subpath(self, s
+00035c20: 7461 7274 2c20 6375 7272 656e 7420 2d20  tart, current - 
+00035c30: 3129 0d0a 2020 2020 2020 2020 2020 2020  1)..            
+00035c40: 2020 2020 2020 2020 7374 6172 7420 3d20          start = 
+00035c50: 6375 7272 656e 740d 0a20 2020 2020 2020  current..       
+00035c60: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
+00035c70: 6365 2873 6567 2c20 436c 6f73 6529 3a0d  ce(seg, Close):.
+00035c80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00035c90: 2079 6965 6c64 2053 7562 7061 7468 2873   yield Subpath(s
+00035ca0: 656c 662c 2073 7461 7274 2c20 6375 7272  elf, start, curr
+00035cb0: 656e 7429 0d0a 2020 2020 2020 2020 2020  ent)..          
+00035cc0: 2020 2020 2020 7374 6172 7420 3d20 6375        start = cu
+00035cd0: 7272 656e 7420 2b20 310d 0a20 2020 2020  rrent + 1..     
+00035ce0: 2020 2069 6620 7374 6172 7420 213d 206c     if start != l
+00035cf0: 656e 2873 656c 6629 3a0d 0a20 2020 2020  en(self):..     
+00035d00: 2020 2020 2020 2079 6965 6c64 2053 7562         yield Sub
+00035d10: 7061 7468 2873 656c 662c 2073 7461 7274  path(self, start
+00035d20: 2c20 6c65 6e28 7365 6c66 2920 2d20 3129  , len(self) - 1)
+00035d30: 0d0a 0d0a 2020 2020 6465 6620 6173 5f70  ....    def as_p
+00035d40: 6f69 6e74 7328 7365 6c66 293a 0d0a 2020  oints(self):..  
+00035d50: 2020 2020 2020 2222 2252 6574 7572 6e73        """Returns
+00035d60: 2074 6865 206c 6973 7420 6f66 2064 6566   the list of def
+00035d70: 696e 696e 6720 706f 696e 7473 2077 6974  ining points wit
+00035d80: 6869 6e20 7061 7468 2222 220d 0a20 2020  hin path"""..   
+00035d90: 2020 2020 2066 6f72 2073 6567 2069 6e20       for seg in 
+00035da0: 7365 6c66 3a0d 0a20 2020 2020 2020 2020  self:..         
+00035db0: 2020 2066 6f72 2070 2069 6e20 7365 673a     for p in seg:
+00035dc0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00035dd0: 2020 6966 206e 6f74 2069 7369 6e73 7461    if not isinsta
+00035de0: 6e63 6528 702c 2050 6f69 6e74 293a 0d0a  nce(p, Point):..
+00035df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00035e00: 2020 2020 7969 656c 6420 506f 696e 7428      yield Point(
+00035e10: 7029 0d0a 2020 2020 2020 2020 2020 2020  p)..            
+00035e20: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
+00035e30: 2020 2020 2020 2020 2020 2020 2020 2079                 y
+00035e40: 6965 6c64 2070 0d0a 0d0a 2020 2020 6465  ield p....    de
+00035e50: 6620 7265 6966 7928 7365 6c66 293a 0d0a  f reify(self):..
+00035e60: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
+00035e70: 2020 2020 2052 6561 6c69 7a65 7320 7468       Realizes th
+00035e80: 6520 7472 616e 7366 6f72 6d20 746f 2074  e transform to t
+00035e90: 6865 2073 6861 7065 2070 726f 7065 7274  he shape propert
+00035ea0: 6965 732e 0d0a 0d0a 2020 2020 2020 2020  ies.....        
+00035eb0: 5061 7468 206f 626a 6563 7473 2072 6569  Path objects rei
+00035ec0: 6679 2070 6572 6665 6374 6c79 2e0d 0a20  fy perfectly... 
+00035ed0: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
+00035ee0: 2020 2020 4772 6170 6869 634f 626a 6563      GraphicObjec
+00035ef0: 742e 7265 6966 7928 7365 6c66 290d 0a20  t.reify(self).. 
+00035f00: 2020 2020 2020 2054 7261 6e73 666f 726d         Transform
+00035f10: 6162 6c65 2e72 6569 6679 2873 656c 6629  able.reify(self)
+00035f20: 0d0a 2020 2020 2020 2020 6966 2069 7369  ..        if isi
+00035f30: 6e73 7461 6e63 6528 7365 6c66 2e74 7261  nstance(self.tra
+00035f40: 6e73 666f 726d 2c20 4d61 7472 6978 293a  nsform, Matrix):
+00035f50: 0d0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
+00035f60: 7220 6520 696e 2073 656c 662e 5f73 6567  r e in self._seg
+00035f70: 6d65 6e74 733a 0d0a 2020 2020 2020 2020  ments:..        
+00035f80: 2020 2020 2020 2020 6520 2a3d 2073 656c          e *= sel
+00035f90: 662e 7472 616e 7366 6f72 6d0d 0a20 2020  f.transform..   
+00035fa0: 2020 2020 2073 656c 662e 7472 616e 7366       self.transf
+00035fb0: 6f72 6d2e 7265 7365 7428 290d 0a20 2020  orm.reset()..   
+00035fc0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00035fd0: 0d0a 0d0a 2020 2020 4073 7461 7469 636d  ....    @staticm
+00035fe0: 6574 686f 640d 0a20 2020 2064 6566 2073  ethod..    def s
+00035ff0: 7667 5f64 2873 6567 6d65 6e74 732c 2072  vg_d(segments, r
+00036000: 656c 6174 6976 653d 4e6f 6e65 2c20 736d  elative=None, sm
+00036010: 6f6f 7468 3d4e 6f6e 6529 3a0d 0a20 2020  ooth=None):..   
+00036020: 2020 2020 2069 6620 6c65 6e28 7365 676d       if len(segm
+00036030: 656e 7473 2920 3d3d 2030 3a0d 0a20 2020  ents) == 0:..   
+00036040: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00036050: 2222 0d0a 2020 2020 2020 2020 7061 7274  ""..        part
+00036060: 7320 3d20 5b5d 0d0a 2020 2020 2020 2020  s = []..        
+00036070: 7072 6576 696f 7573 5f73 6567 6d65 6e74  previous_segment
+00036080: 203d 204e 6f6e 650d 0a20 2020 2020 2020   = None..       
+00036090: 2070 203d 2050 6f69 6e74 2830 290d 0a20   p = Point(0).. 
+000360a0: 2020 2020 2020 2069 6620 736d 6f6f 7468         if smooth
+000360b0: 2069 7320 4e6f 6e65 3a0d 0a20 2020 2020   is None:..     
+000360c0: 2020 2020 2020 206f 7665 7272 6964 655f         override_
+000360d0: 736d 6f6f 7468 203d 2046 616c 7365 0d0a  smooth = False..
+000360e0: 2020 2020 2020 2020 2020 2020 736d 6f6f              smoo
+000360f0: 7468 5f73 6574 5f76 616c 7565 203d 2054  th_set_value = T
+00036100: 7275 650d 0a20 2020 2020 2020 2065 6c73  rue..        els
+00036110: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00036120: 6f76 6572 7269 6465 5f73 6d6f 6f74 6820  override_smooth 
+00036130: 3d20 5472 7565 0d0a 2020 2020 2020 2020  = True..        
+00036140: 2020 2020 736d 6f6f 7468 5f73 6574 5f76      smooth_set_v
+00036150: 616c 7565 203d 2062 6f6f 6c28 736d 6f6f  alue = bool(smoo
+00036160: 7468 290d 0a20 2020 2020 2020 2069 6620  th)..        if 
+00036170: 7265 6c61 7469 7665 2069 7320 6e6f 7420  relative is not 
+00036180: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
+00036190: 2020 2066 6f72 2073 6567 6d65 6e74 2069     for segment i
+000361a0: 6e20 7365 676d 656e 7473 3a0d 0a20 2020  n segments:..   
+000361b0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+000361c0: 6973 696e 7374 616e 6365 2873 6567 6d65  isinstance(segme
+000361d0: 6e74 2c20 284d 6f76 652c 204c 696e 652c  nt, (Move, Line,
+000361e0: 2041 7263 2c20 436c 6f73 6529 293a 0d0a   Arc, Close)):..
+000361f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00036200: 2020 2020 7061 7274 732e 6170 7065 6e64      parts.append
+00036210: 2873 6567 6d65 6e74 2e64 2870 2c20 7265  (segment.d(p, re
+00036220: 6c61 7469 7665 3d72 656c 6174 6976 6529  lative=relative)
+00036230: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00036240: 2020 2065 6c69 6620 6973 696e 7374 616e     elif isinstan
+00036250: 6365 2873 6567 6d65 6e74 2c20 2843 7562  ce(segment, (Cub
+00036260: 6963 4265 7a69 6572 2c20 5175 6164 7261  icBezier, Quadra
+00036270: 7469 6342 657a 6965 7229 293a 0d0a 2020  ticBezier)):..  
+00036280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00036290: 2020 6966 2028 6f76 6572 7269 6465 5f73    if (override_s
+000362a0: 6d6f 6f74 6820 616e 6420 736d 6f6f 7468  mooth and smooth
+000362b0: 5f73 6574 5f76 616c 7565 2920 6f72 2028  _set_value) or (
+000362c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000362d0: 2020 2020 2020 2020 2020 6e6f 7420 6f76            not ov
+000362e0: 6572 7269 6465 5f73 6d6f 6f74 6820 616e  erride_smooth an
+000362f0: 6420 7365 676d 656e 742e 736d 6f6f 7468  d segment.smooth
+00036300: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00036310: 2020 2020 2020 293a 0d0a 2020 2020 2020        ):..      
+00036320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00036330: 2020 7061 7274 732e 6170 7065 6e64 280d    parts.append(.
+00036340: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00036350: 2020 2020 2020 2020 2020 2020 2073 6567               seg
+00036360: 6d65 6e74 2e64 280d 0a20 2020 2020 2020  ment.d(..       
+00036370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00036380: 2020 2020 2020 2020 2070 2c0d 0a20 2020           p,..   
+00036390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000363a0: 2020 2020 2020 2020 2020 2020 2072 656c               rel
+000363b0: 6174 6976 653d 7265 6c61 7469 7665 2c0d  ative=relative,.
+000363c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000363d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000363e0: 2073 6d6f 6f74 683d 7365 676d 656e 742e   smooth=segment.
+000363f0: 6973 5f73 6d6f 6f74 685f 6672 6f6d 2870  is_smooth_from(p
+00036400: 7265 7669 6f75 735f 7365 676d 656e 7429  revious_segment)
+00036410: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00036420: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00036430: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00036440: 2020 2020 2020 2020 2020 290d 0a20 2020            )..   
+00036450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00036460: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+00036470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00036480: 7061 7274 732e 6170 7065 6e64 2873 6567  parts.append(seg
+00036490: 6d65 6e74 2e64 2870 2c20 7265 6c61 7469  ment.d(p, relati
+000364a0: 7665 3d72 656c 6174 6976 652c 2073 6d6f  ve=relative, smo
+000364b0: 6f74 683d 4661 6c73 6529 290d 0a20 2020  oth=False))..   
+000364c0: 2020 2020 2020 2020 2020 2020 2070 7265               pre
+000364d0: 7669 6f75 735f 7365 676d 656e 7420 3d20  vious_segment = 
+000364e0: 7365 676d 656e 740d 0a20 2020 2020 2020  segment..       
+000364f0: 2020 2020 2020 2020 2070 203d 2070 7265           p = pre
+00036500: 7669 6f75 735f 7365 676d 656e 742e 656e  vious_segment.en
+00036510: 640d 0a20 2020 2020 2020 2065 6c73 653a  d..        else:
+00036520: 0d0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
+00036530: 7220 7365 676d 656e 7420 696e 2073 6567  r segment in seg
+00036540: 6d65 6e74 733a 0d0a 2020 2020 2020 2020  ments:..        
+00036550: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+00036560: 7461 6e63 6528 7365 676d 656e 742c 2028  tance(segment, (
+00036570: 4d6f 7665 2c20 4c69 6e65 2c20 4172 632c  Move, Line, Arc,
+00036580: 2043 6c6f 7365 2929 3a0d 0a20 2020 2020   Close)):..     
+00036590: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+000365a0: 6172 7473 2e61 7070 656e 6428 7365 676d  arts.append(segm
+000365b0: 656e 742e 6428 702c 2072 656c 6174 6976  ent.d(p, relativ
+000365c0: 653d 7365 676d 656e 742e 7265 6c61 7469  e=segment.relati
+000365d0: 7665 2929 0d0a 2020 2020 2020 2020 2020  ve))..          
+000365e0: 2020 2020 2020 656c 6966 2069 7369 6e73        elif isins
+000365f0: 7461 6e63 6528 7365 676d 656e 742c 2028  tance(segment, (
+00036600: 4375 6269 6342 657a 6965 722c 2051 7561  CubicBezier, Qua
+00036610: 6472 6174 6963 4265 7a69 6572 2929 3a0d  draticBezier)):.
+00036620: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00036630: 2020 2020 2069 6620 286f 7665 7272 6964       if (overrid
+00036640: 655f 736d 6f6f 7468 2061 6e64 2073 6d6f  e_smooth and smo
+00036650: 6f74 685f 7365 745f 7661 6c75 6529 206f  oth_set_value) o
+00036660: 7220 280d 0a20 2020 2020 2020 2020 2020  r (..           
+00036670: 2020 2020 2020 2020 2020 2020 206e 6f74               not
+00036680: 206f 7665 7272 6964 655f 736d 6f6f 7468   override_smooth
+00036690: 2061 6e64 2073 6567 6d65 6e74 2e73 6d6f   and segment.smo
+000366a0: 6f74 680d 0a20 2020 2020 2020 2020 2020  oth..           
+000366b0: 2020 2020 2020 2020 2029 3a0d 0a20 2020           ):..   
+000366c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000366d0: 2020 2020 2070 6172 7473 2e61 7070 656e       parts.appen
+000366e0: 6428 0d0a 2020 2020 2020 2020 2020 2020  d(..            
+000366f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00036700: 7365 676d 656e 742e 6428 0d0a 2020 2020  segment.d(..    
+00036710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00036720: 2020 2020 2020 2020 2020 2020 702c 0d0a              p,..
+00036730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00036740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00036750: 7265 6c61 7469 7665 3d73 6567 6d65 6e74  relative=segment
+00036760: 2e72 656c 6174 6976 652c 0d0a 2020 2020  .relative,..    
+00036770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00036780: 2020 2020 2020 2020 2020 2020 736d 6f6f              smoo
+00036790: 7468 3d73 6567 6d65 6e74 2e69 735f 736d  th=segment.is_sm
+000367a0: 6f6f 7468 5f66 726f 6d28 7072 6576 696f  ooth_from(previo
+000367b0: 7573 5f73 6567 6d65 6e74 292c 0d0a 2020  us_segment),..  
+000367c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000367d0: 2020 2020 2020 2020 2020 290d 0a20 2020            )..   
+000367e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000367f0: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
+00036800: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00036810: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00036820: 2020 2020 2020 2020 2020 2070 6172 7473             parts
+00036830: 2e61 7070 656e 6428 0d0a 2020 2020 2020  .append(..      
+00036840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00036850: 2020 2020 2020 7365 676d 656e 742e 6428        segment.d(
+00036860: 702c 2072 656c 6174 6976 653d 7365 676d  p, relative=segm
+00036870: 656e 742e 7265 6c61 7469 7665 2c20 736d  ent.relative, sm
+00036880: 6f6f 7468 3d46 616c 7365 290d 0a20 2020  ooth=False)..   
+00036890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000368a0: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
+000368b0: 2020 2020 2020 2020 7072 6576 696f 7573          previous
+000368c0: 5f73 6567 6d65 6e74 203d 2073 6567 6d65  _segment = segme
+000368d0: 6e74 0d0a 2020 2020 2020 2020 2020 2020  nt..            
+000368e0: 2020 2020 7020 3d20 7072 6576 696f 7573      p = previous
+000368f0: 5f73 6567 6d65 6e74 2e65 6e64 0d0a 2020  _segment.end..  
+00036900: 2020 2020 2020 7265 7475 726e 2022 2022        return " "
+00036910: 2e6a 6f69 6e28 7061 7274 7329 0d0a 0d0a  .join(parts)....
+00036920: 2020 2020 6465 6620 6428 7365 6c66 2c20      def d(self, 
+00036930: 7265 6c61 7469 7665 3d4e 6f6e 652c 2074  relative=None, t
+00036940: 7261 6e73 666f 726d 6564 3d54 7275 652c  ransformed=True,
+00036950: 2073 6d6f 6f74 683d 4e6f 6e65 293a 0d0a   smooth=None):..
+00036960: 2020 2020 2020 2020 7061 7468 203d 2073          path = s
+00036970: 656c 660d 0a20 2020 2020 2020 2069 6620  elf..        if 
+00036980: 7472 616e 7366 6f72 6d65 643a 0d0a 2020  transformed:..  
+00036990: 2020 2020 2020 2020 2020 7061 7468 203d            path =
+000369a0: 2061 6273 2870 6174 6829 0d0a 2020 2020   abs(path)..    
+000369b0: 2020 2020 7265 7475 726e 2050 6174 682e      return Path.
+000369c0: 7376 675f 6428 7061 7468 2e5f 7365 676d  svg_d(path._segm
+000369d0: 656e 7473 2c20 7265 6c61 7469 7665 3d72  ents, relative=r
+000369e0: 656c 6174 6976 652c 2073 6d6f 6f74 683d  elative, smooth=
+000369f0: 736d 6f6f 7468 290d 0a0d 0a20 2020 2064  smooth)....    d
+00036a00: 6566 2073 6567 6d65 6e74 7328 7365 6c66  ef segments(self
+00036a10: 2c20 7472 616e 7366 6f72 6d65 643d 5472  , transformed=Tr
+00036a20: 7565 293a 0d0a 2020 2020 2020 2020 6966  ue):..        if
+00036a30: 2074 7261 6e73 666f 726d 6564 2061 6e64   transformed and
+00036a40: 206e 6f74 2073 656c 662e 7472 616e 7366   not self.transf
+00036a50: 6f72 6d2e 6973 5f69 6465 6e74 6974 7928  orm.is_identity(
+00036a60: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00036a70: 7265 7475 726e 205b 7320 2a20 7365 6c66  return [s * self
+00036a80: 2e74 7261 6e73 666f 726d 2066 6f72 2073  .transform for s
+00036a90: 2069 6e20 7365 6c66 2e5f 7365 676d 656e   in self._segmen
+00036aa0: 7473 5d0d 0a20 2020 2020 2020 2072 6574  ts]..        ret
+00036ab0: 7572 6e20 7365 6c66 2e5f 7365 676d 656e  urn self._segmen
+00036ac0: 7473 0d0a 0d0a 2020 2020 6465 6620 6170  ts....    def ap
+00036ad0: 7072 6f78 696d 6174 655f 6172 6373 5f77  proximate_arcs_w
+00036ae0: 6974 685f 6375 6269 6373 2873 656c 662c  ith_cubics(self,
+00036af0: 2065 7272 6f72 3d30 2e31 293a 0d0a 2020   error=0.1):..  
+00036b00: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
+00036b10: 2020 2049 7465 7261 7465 7320 7468 726f     Iterates thro
+00036b20: 7567 6820 7468 6973 2070 6174 6820 616e  ugh this path an
+00036b30: 6420 7265 706c 6163 6573 2061 6e79 2041  d replaces any A
+00036b40: 7263 7320 7769 7468 2063 7562 6963 2042  rcs with cubic B
+00036b50: e97a 6965 7220 6375 7276 6573 2e0d 0a20  .zier curves... 
+00036b60: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
+00036b70: 2020 2020 7377 6565 705f 6c69 6d69 7420      sweep_limit 
+00036b80: 3d20 7461 7520 2a20 6572 726f 720d 0a20  = tau * error.. 
+00036b90: 2020 2020 2020 2066 6f72 2073 2069 6e20         for s in 
+00036ba0: 7261 6e67 6528 6c65 6e28 7365 6c66 2920  range(len(self) 
+00036bb0: 2d20 312c 202d 312c 202d 3129 3a0d 0a20  - 1, -1, -1):.. 
+00036bc0: 2020 2020 2020 2020 2020 2073 6567 6d65             segme
+00036bd0: 6e74 203d 2073 656c 665b 735d 0d0a 2020  nt = self[s]..  
+00036be0: 2020 2020 2020 2020 2020 6966 2069 7369            if isi
+00036bf0: 6e73 7461 6e63 6528 7365 676d 656e 742c  nstance(segment,
+00036c00: 2041 7263 293a 0d0a 2020 2020 2020 2020   Arc):..        
+00036c10: 2020 2020 2020 2020 6172 635f 7265 7175          arc_requ
+00036c20: 6972 6564 203d 2069 6e74 2863 6569 6c28  ired = int(ceil(
+00036c30: 6162 7328 7365 676d 656e 742e 7377 6565  abs(segment.swee
+00036c40: 7029 202f 2073 7765 6570 5f6c 696d 6974  p) / sweep_limit
+00036c50: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
+00036c60: 2020 2020 7365 6c66 5b73 203a 2073 202b      self[s : s +
+00036c70: 2031 5d20 3d20 6c69 7374 2873 6567 6d65   1] = list(segme
+00036c80: 6e74 2e61 735f 6375 6269 635f 6375 7276  nt.as_cubic_curv
+00036c90: 6573 2861 7263 5f72 6571 7569 7265 6429  es(arc_required)
+00036ca0: 290d 0a0d 0a20 2020 2064 6566 2061 7070  )....    def app
+00036cb0: 726f 7869 6d61 7465 5f61 7263 735f 7769  roximate_arcs_wi
+00036cc0: 7468 5f71 7561 6473 2873 656c 662c 2065  th_quads(self, e
+00036cd0: 7272 6f72 3d30 2e31 293a 0d0a 2020 2020  rror=0.1):..    
+00036ce0: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
+00036cf0: 2049 7465 7261 7465 7320 7468 726f 7567   Iterates throug
+00036d00: 6820 7468 6973 2070 6174 6820 616e 6420  h this path and 
+00036d10: 7265 706c 6163 6573 2061 6e79 2041 7263  replaces any Arc
+00036d20: 7320 7769 7468 2071 7561 6472 6174 6963  s with quadratic
+00036d30: 2042 e97a 6965 7220 6375 7276 6573 2e0d   B.zier curves..
+00036d40: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
+00036d50: 2020 2020 2020 7377 6565 705f 6c69 6d69        sweep_limi
+00036d60: 7420 3d20 7461 7520 2a20 6572 726f 720d  t = tau * error.
+00036d70: 0a20 2020 2020 2020 2066 6f72 2073 2069  .        for s i
+00036d80: 6e20 7261 6e67 6528 6c65 6e28 7365 6c66  n range(len(self
+00036d90: 2920 2d20 312c 202d 312c 202d 3129 3a0d  ) - 1, -1, -1):.
+00036da0: 0a20 2020 2020 2020 2020 2020 2073 6567  .            seg
+00036db0: 6d65 6e74 203d 2073 656c 665b 735d 0d0a  ment = self[s]..
+00036dc0: 2020 2020 2020 2020 2020 2020 6966 2069              if i
+00036dd0: 7369 6e73 7461 6e63 6528 7365 676d 656e  sinstance(segmen
+00036de0: 742c 2041 7263 293a 0d0a 2020 2020 2020  t, Arc):..      
+00036df0: 2020 2020 2020 2020 2020 6172 635f 7265            arc_re
+00036e00: 7175 6972 6564 203d 2069 6e74 2863 6569  quired = int(cei
+00036e10: 6c28 6162 7328 7365 676d 656e 742e 7377  l(abs(segment.sw
+00036e20: 6565 7029 202f 2073 7765 6570 5f6c 696d  eep) / sweep_lim
+00036e30: 6974 2929 0d0a 2020 2020 2020 2020 2020  it))..          
+00036e40: 2020 2020 2020 7365 6c66 5b73 203a 2073        self[s : s
+00036e50: 202b 2031 5d20 3d20 6c69 7374 2873 6567   + 1] = list(seg
+00036e60: 6d65 6e74 2e61 735f 7175 6164 5f63 7572  ment.as_quad_cur
+00036e70: 7665 7328 6172 635f 7265 7175 6972 6564  ves(arc_required
+00036e80: 2929 0d0a 0d0a 2020 2020 6465 6620 6170  ))....    def ap
+00036e90: 7072 6f78 696d 6174 655f 6265 7a69 6572  proximate_bezier
+00036ea0: 5f77 6974 685f 6369 7263 756c 6172 5f61  _with_circular_a
+00036eb0: 7263 7328 7365 6c66 2c20 6572 726f 723d  rcs(self, error=
+00036ec0: 302e 3031 293a 0d0a 2020 2020 2020 2020  0.01):..        
+00036ed0: 2222 220d 0a20 2020 2020 2020 2049 7465  """..        Ite
+00036ee0: 7261 7465 7320 7468 726f 7567 6820 7468  rates through th
+00036ef0: 6973 2070 6174 6820 616e 6420 7265 706c  is path and repl
+00036f00: 6163 6573 2061 6e79 2042 e97a 6965 7220  aces any B.zier 
+00036f10: 6375 7276 6573 2077 6974 6820 6369 7263  curves with circ
+00036f20: 756c 6172 2061 7263 732e 0d0a 2020 2020  ular arcs...    
+00036f30: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
+00036f40: 2066 6f72 2073 2069 6e20 7261 6e67 6528   for s in range(
+00036f50: 6c65 6e28 7365 6c66 2920 2d20 312c 202d  len(self) - 1, -
+00036f60: 312c 202d 3129 3a0d 0a20 2020 2020 2020  1, -1):..       
+00036f70: 2020 2020 2073 6567 6d65 6e74 203d 2073       segment = s
+00036f80: 656c 665b 735d 0d0a 2020 2020 2020 2020  elf[s]..        
+00036f90: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+00036fa0: 6528 7365 676d 656e 742c 2028 5175 6164  e(segment, (Quad
+00036fb0: 7261 7469 6342 657a 6965 722c 2043 7562  raticBezier, Cub
+00036fc0: 6963 4265 7a69 6572 2929 3a0d 0a20 2020  icBezier)):..   
+00036fd0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00036fe0: 665b 7320 3a20 7320 2b20 315d 203d 206c  f[s : s + 1] = l
+00036ff0: 6973 7428 7365 676d 656e 742e 6173 5f63  ist(segment.as_c
+00037000: 6972 6375 6c61 725f 6172 6373 2865 7272  ircular_arcs(err
+00037010: 6f72 3d65 7272 6f72 2929 0d0a 0d0a 0d0a  or=error))......
+00037020: 636c 6173 7320 5265 6374 2853 6861 7065  class Rect(Shape
+00037030: 293a 0d0a 2020 2020 2222 220d 0a20 2020  ):..    """..   
+00037040: 2053 5647 2052 6563 7420 7368 6170 6573   SVG Rect shapes
+00037050: 2061 7265 2064 6566 696e 6564 2069 6e20   are defined in 
+00037060: 5356 4732 2031 302e 320d 0a20 2020 2068  SVG2 10.2..    h
+00037070: 7474 7073 3a2f 2f77 7777 2e77 332e 6f72  ttps://www.w3.or
+00037080: 672f 5452 2f53 5647 322f 7368 6170 6573  g/TR/SVG2/shapes
+00037090: 2e68 746d 6c23 5265 6374 456c 656d 656e  .html#RectElemen
+000370a0: 740d 0a0d 0a20 2020 2054 6865 7365 2068  t....    These h
+000370b0: 6176 6520 6765 6f6d 6574 7269 6320 7072  ave geometric pr
+000370c0: 6f70 6572 7469 6573 2078 2c20 792c 2077  operties x, y, w
+000370d0: 6964 7468 2c20 6865 6967 6874 2c20 7278  idth, height, rx
+000370e0: 2c20 7279 0d0a 2020 2020 4765 6f6d 6574  , ry..    Geomet
+000370f0: 7269 6320 7072 6f70 6572 7469 6573 2063  ric properties c
+00037100: 616e 2062 6520 4c65 6e67 7468 2076 616c  an be Length val
+00037110: 7565 732e 0d0a 0d0a 2020 2020 5265 6374  ues.....    Rect
+00037120: 2878 2c20 792c 2077 6964 7468 2c20 6865  (x, y, width, he
+00037130: 6967 6874 290d 0a20 2020 2052 6563 7428  ight)..    Rect(
+00037140: 782c 2079 2c20 7769 6474 682c 2068 6569  x, y, width, hei
+00037150: 6768 742c 2072 782c 2072 7929 0d0a 2020  ght, rx, ry)..  
+00037160: 2020 5265 6374 2878 2c20 792c 2077 6964    Rect(x, y, wid
+00037170: 7468 2c20 6865 6967 6874 2c20 7278 2c20  th, height, rx, 
+00037180: 7279 2c20 6d61 7472 6978 290d 0a20 2020  ry, matrix)..   
+00037190: 2052 6563 7428 782c 2079 2c20 7769 6474   Rect(x, y, widt
+000371a0: 682c 2068 6569 6768 742c 2072 782c 2072  h, height, rx, r
+000371b0: 792c 206d 6174 7269 782c 2073 7472 6f6b  y, matrix, strok
+000371c0: 652c 2066 696c 6c29 0d0a 0d0a 2020 2020  e, fill)....    
+000371d0: 5265 6374 2864 6963 7429 3a20 6469 6374  Rect(dict): dict
+000371e0: 696f 6e61 7279 2076 616c 7565 7320 7265  ionary values re
+000371f0: 6164 2066 726f 6d20 7376 672e 0d0a 0d0a  ad from svg.....
+00037200: 2020 2020 2222 220d 0a0d 0a20 2020 2064      """....    d
+00037210: 6566 205f 5f69 6e69 745f 5f28 7365 6c66  ef __init__(self
+00037220: 2c20 2a61 7267 732c 202a 2a6b 7761 7267  , *args, **kwarg
+00037230: 7329 3a0d 0a20 2020 2020 2020 2073 656c  s):..        sel
+00037240: 662e 7820 3d20 4e6f 6e65 0d0a 2020 2020  f.x = None..    
+00037250: 2020 2020 7365 6c66 2e79 203d 204e 6f6e      self.y = Non
+00037260: 650d 0a20 2020 2020 2020 2073 656c 662e  e..        self.
+00037270: 7769 6474 6820 3d20 4e6f 6e65 0d0a 2020  width = None..  
+00037280: 2020 2020 2020 7365 6c66 2e68 6569 6768        self.heigh
+00037290: 7420 3d20 4e6f 6e65 0d0a 2020 2020 2020  t = None..      
+000372a0: 2020 7365 6c66 2e72 7820 3d20 4e6f 6e65    self.rx = None
+000372b0: 0d0a 2020 2020 2020 2020 7365 6c66 2e72  ..        self.r
+000372c0: 7920 3d20 4e6f 6e65 0d0a 2020 2020 2020  y = None..      
+000372d0: 2020 5368 6170 652e 5f5f 696e 6974 5f5f    Shape.__init__
+000372e0: 2873 656c 662c 202a 6172 6773 2c20 2a2a  (self, *args, **
+000372f0: 6b77 6172 6773 290d 0a20 2020 2020 2020  kwargs)..       
+00037300: 2073 656c 662e 5f76 616c 6964 6174 655f   self._validate_
+00037310: 7265 6374 2829 0d0a 0d0a 2020 2020 6465  rect()....    de
+00037320: 6620 7072 6f70 6572 7479 5f62 795f 6f62  f property_by_ob
+00037330: 6a65 6374 2873 656c 662c 2073 293a 0d0a  ject(self, s):..
+00037340: 2020 2020 2020 2020 5368 6170 652e 7072          Shape.pr
+00037350: 6f70 6572 7479 5f62 795f 6f62 6a65 6374  operty_by_object
+00037360: 2873 656c 662c 2073 290d 0a20 2020 2020  (self, s)..     
+00037370: 2020 2073 656c 662e 7820 3d20 732e 780d     self.x = s.x.
+00037380: 0a20 2020 2020 2020 2073 656c 662e 7920  .        self.y 
+00037390: 3d20 732e 790d 0a20 2020 2020 2020 2073  = s.y..        s
+000373a0: 656c 662e 7769 6474 6820 3d20 732e 7769  elf.width = s.wi
+000373b0: 6474 680d 0a20 2020 2020 2020 2073 656c  dth..        sel
+000373c0: 662e 6865 6967 6874 203d 2073 2e68 6569  f.height = s.hei
+000373d0: 6768 740d 0a20 2020 2020 2020 2073 656c  ght..        sel
+000373e0: 662e 7278 203d 2073 2e72 780d 0a20 2020  f.rx = s.rx..   
+000373f0: 2020 2020 2073 656c 662e 7279 203d 2073       self.ry = s
+00037400: 2e72 790d 0a20 2020 2020 2020 2073 656c  .ry..        sel
+00037410: 662e 5f76 616c 6964 6174 655f 7265 6374  f._validate_rect
+00037420: 2829 0d0a 0d0a 2020 2020 6465 6620 7072  ()....    def pr
+00037430: 6f70 6572 7479 5f62 795f 7661 6c75 6573  operty_by_values
+00037440: 2873 656c 662c 2076 616c 7565 7329 3a0d  (self, values):.
+00037450: 0a20 2020 2020 2020 2053 6861 7065 2e70  .        Shape.p
+00037460: 726f 7065 7274 795f 6279 5f76 616c 7565  roperty_by_value
+00037470: 7328 7365 6c66 2c20 7661 6c75 6573 290d  s(self, values).
+00037480: 0a20 2020 2020 2020 2073 656c 662e 7820  .        self.x 
+00037490: 3d20 4c65 6e67 7468 2876 616c 7565 732e  = Length(values.
+000374a0: 6765 7428 5356 475f 4154 5452 5f58 2c20  get(SVG_ATTR_X, 
+000374b0: 3029 292e 7661 6c75 6528 290d 0a20 2020  0)).value()..   
+000374c0: 2020 2020 2073 656c 662e 7920 3d20 4c65       self.y = Le
+000374d0: 6e67 7468 2876 616c 7565 732e 6765 7428  ngth(values.get(
+000374e0: 5356 475f 4154 5452 5f59 2c20 3029 292e  SVG_ATTR_Y, 0)).
+000374f0: 7661 6c75 6528 290d 0a20 2020 2020 2020  value()..       
+00037500: 2073 656c 662e 7769 6474 6820 3d20 4c65   self.width = Le
+00037510: 6e67 7468 2876 616c 7565 732e 6765 7428  ngth(values.get(
+00037520: 5356 475f 4154 5452 5f57 4944 5448 2c20  SVG_ATTR_WIDTH, 
+00037530: 3129 292e 7661 6c75 6528 290d 0a20 2020  1)).value()..   
+00037540: 2020 2020 2073 656c 662e 6865 6967 6874       self.height
+00037550: 203d 204c 656e 6774 6828 7661 6c75 6573   = Length(values
+00037560: 2e67 6574 2853 5647 5f41 5454 525f 4845  .get(SVG_ATTR_HE
+00037570: 4947 4854 2c20 3129 292e 7661 6c75 6528  IGHT, 1)).value(
+00037580: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00037590: 7278 203d 204c 656e 6774 6828 7661 6c75  rx = Length(valu
+000375a0: 6573 2e67 6574 2853 5647 5f41 5454 525f  es.get(SVG_ATTR_
+000375b0: 5241 4449 5553 5f58 2c20 4e6f 6e65 2929  RADIUS_X, None))
+000375c0: 2e76 616c 7565 2829 0d0a 2020 2020 2020  .value()..      
+000375d0: 2020 7365 6c66 2e72 7920 3d20 4c65 6e67    self.ry = Leng
+000375e0: 7468 2876 616c 7565 732e 6765 7428 5356  th(values.get(SV
+000375f0: 475f 4154 5452 5f52 4144 4955 535f 592c  G_ATTR_RADIUS_Y,
+00037600: 204e 6f6e 6529 292e 7661 6c75 6528 290d   None)).value().
+00037610: 0a0d 0a20 2020 2064 6566 2070 726f 7065  ...    def prope
+00037620: 7274 795f 6279 5f61 7267 7328 7365 6c66  rty_by_args(self
+00037630: 2c20 2a61 7267 7329 3a0d 0a20 2020 2020  , *args):..     
+00037640: 2020 2061 7267 5f6c 656e 6774 6820 3d20     arg_length = 
+00037650: 6c65 6e28 6172 6773 290d 0a20 2020 2020  len(args)..     
+00037660: 2020 2069 6620 6172 675f 6c65 6e67 7468     if arg_length
+00037670: 203e 3d20 313a 0d0a 2020 2020 2020 2020   >= 1:..        
+00037680: 2020 2020 7365 6c66 2e78 203d 204c 656e      self.x = Len
+00037690: 6774 6828 6172 6773 5b30 5d29 2e76 616c  gth(args[0]).val
+000376a0: 7565 2829 0d0a 2020 2020 2020 2020 6966  ue()..        if
+000376b0: 2061 7267 5f6c 656e 6774 6820 3e3d 2032   arg_length >= 2
+000376c0: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
+000376d0: 656c 662e 7920 3d20 4c65 6e67 7468 2861  elf.y = Length(a
+000376e0: 7267 735b 315d 292e 7661 6c75 6528 290d  rgs[1]).value().
+000376f0: 0a20 2020 2020 2020 2069 6620 6172 675f  .        if arg_
+00037700: 6c65 6e67 7468 203e 3d20 333a 0d0a 2020  length >= 3:..  
+00037710: 2020 2020 2020 2020 2020 7365 6c66 2e77            self.w
+00037720: 6964 7468 203d 204c 656e 6774 6828 6172  idth = Length(ar
+00037730: 6773 5b32 5d29 2e76 616c 7565 2829 0d0a  gs[2]).value()..
+00037740: 2020 2020 2020 2020 6966 2061 7267 5f6c          if arg_l
+00037750: 656e 6774 6820 3e3d 2034 3a0d 0a20 2020  ength >= 4:..   
+00037760: 2020 2020 2020 2020 2073 656c 662e 6865           self.he
+00037770: 6967 6874 203d 204c 656e 6774 6828 6172  ight = Length(ar
+00037780: 6773 5b33 5d29 2e76 616c 7565 2829 0d0a  gs[3]).value()..
+00037790: 2020 2020 2020 2020 6966 2061 7267 5f6c          if arg_l
+000377a0: 656e 6774 6820 3e3d 2035 3a0d 0a20 2020  ength >= 5:..   
+000377b0: 2020 2020 2020 2020 2073 656c 662e 7278           self.rx
+000377c0: 203d 204c 656e 6774 6828 6172 6773 5b34   = Length(args[4
+000377d0: 5d29 2e76 616c 7565 2829 0d0a 2020 2020  ]).value()..    
+000377e0: 2020 2020 6966 2061 7267 5f6c 656e 6774      if arg_lengt
+000377f0: 6820 3e3d 2036 3a0d 0a20 2020 2020 2020  h >= 6:..       
+00037800: 2020 2020 2073 656c 662e 7279 203d 204c       self.ry = L
+00037810: 656e 6774 6828 6172 6773 5b35 5d29 2e76  ength(args[5]).v
+00037820: 616c 7565 2829 0d0a 2020 2020 2020 2020  alue()..        
+00037830: 6966 2061 7267 5f6c 656e 6774 6820 3e3d  if arg_length >=
+00037840: 2037 3a0d 0a20 2020 2020 2020 2020 2020   7:..           
+00037850: 2073 656c 662e 5f69 6e69 745f 7368 6170   self._init_shap
+00037860: 6528 2a61 7267 735b 363a 5d29 0d0a 0d0a  e(*args[6:])....
+00037870: 2020 2020 6465 6620 5f76 616c 6964 6174      def _validat
+00037880: 655f 7265 6374 2873 656c 6629 3a0d 0a20  e_rect(self):.. 
+00037890: 2020 2020 2020 2022 2222 4e6f 6e65 2069         """None i
+000378a0: 7320 2761 7574 6f27 2066 6f72 2076 616c  s 'auto' for val
+000378b0: 7565 732e 2222 220d 0a20 2020 2020 2020  ues."""..       
+000378c0: 2072 7820 3d20 7365 6c66 2e72 780d 0a20   rx = self.rx.. 
+000378d0: 2020 2020 2020 2072 7920 3d20 7365 6c66         ry = self
+000378e0: 2e72 790d 0a20 2020 2020 2020 2069 6620  .ry..        if 
+000378f0: 7278 2069 7320 4e6f 6e65 2061 6e64 2072  rx is None and r
+00037900: 7920 6973 204e 6f6e 653a 0d0a 2020 2020  y is None:..    
+00037910: 2020 2020 2020 2020 7278 203d 2072 7920          rx = ry 
+00037920: 3d20 300d 0a20 2020 2020 2020 2069 6620  = 0..        if 
+00037930: 7278 2069 7320 6e6f 7420 4e6f 6e65 2061  rx is not None a
+00037940: 6e64 2072 7920 6973 204e 6f6e 653a 0d0a  nd ry is None:..
+00037950: 2020 2020 2020 2020 2020 2020 7278 203d              rx =
+00037960: 204c 656e 6774 6828 7278 292e 7661 6c75   Length(rx).valu
+00037970: 6528 7265 6c61 7469 7665 5f6c 656e 6774  e(relative_lengt
+00037980: 683d 7365 6c66 2e77 6964 7468 290d 0a20  h=self.width).. 
+00037990: 2020 2020 2020 2020 2020 2072 7920 3d20             ry = 
+000379a0: 7278 0d0a 2020 2020 2020 2020 656c 6966  rx..        elif
+000379b0: 2072 7920 6973 206e 6f74 204e 6f6e 6520   ry is not None 
+000379c0: 616e 6420 7278 2069 7320 4e6f 6e65 3a0d  and rx is None:.
+000379d0: 0a20 2020 2020 2020 2020 2020 2072 7920  .            ry 
+000379e0: 3d20 4c65 6e67 7468 2872 7929 2e76 616c  = Length(ry).val
+000379f0: 7565 2872 656c 6174 6976 655f 6c65 6e67  ue(relative_leng
+00037a00: 7468 3d73 656c 662e 6865 6967 6874 290d  th=self.height).
+00037a10: 0a20 2020 2020 2020 2020 2020 2072 7820  .            rx 
+00037a20: 3d20 7279 0d0a 2020 2020 2020 2020 656c  = ry..        el
+00037a30: 6966 2072 7820 6973 206e 6f74 204e 6f6e  if rx is not Non
+00037a40: 6520 616e 6420 7279 2069 7320 6e6f 7420  e and ry is not 
+00037a50: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
+00037a60: 2020 2072 7820 3d20 4c65 6e67 7468 2872     rx = Length(r
+00037a70: 7829 2e76 616c 7565 2872 656c 6174 6976  x).value(relativ
+00037a80: 655f 6c65 6e67 7468 3d73 656c 662e 7769  e_length=self.wi
+00037a90: 6474 6829 0d0a 2020 2020 2020 2020 2020  dth)..          
+00037aa0: 2020 7279 203d 204c 656e 6774 6828 7279    ry = Length(ry
+00037ab0: 292e 7661 6c75 6528 7265 6c61 7469 7665  ).value(relative
+00037ac0: 5f6c 656e 6774 683d 7365 6c66 2e68 6569  _length=self.hei
+00037ad0: 6768 7429 0d0a 2020 2020 2020 2020 6966  ght)..        if
+00037ae0: 2072 7820 3d3d 2030 206f 7220 7279 203d   rx == 0 or ry =
+00037af0: 3d20 303a 0d0a 2020 2020 2020 2020 2020  = 0:..          
+00037b00: 2020 7278 203d 2072 7920 3d20 300d 0a20    rx = ry = 0.. 
+00037b10: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+00037b20: 2020 2020 2020 2020 2020 7472 793a 0d0a            try:..
+00037b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00037b40: 7278 203d 206d 696e 2872 782c 2073 656c  rx = min(rx, sel
+00037b50: 662e 7769 6474 6820 2f20 322e 3029 0d0a  f.width / 2.0)..
+00037b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00037b70: 7279 203d 206d 696e 2872 792c 2073 656c  ry = min(ry, sel
+00037b80: 662e 6865 6967 6874 202f 2032 2e30 290d  f.height / 2.0).
+00037b90: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
+00037ba0: 6570 7420 5661 6c75 6545 7272 6f72 3a0d  ept ValueError:.
+00037bb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00037bc0: 2070 6173 7320 2023 2049 6620 7769 6474   pass  # If widt
+00037bd0: 6820 6973 2069 6e20 696e 6368 6573 2061  h is in inches a
+00037be0: 6e64 2072 7820 6973 2069 6e20 756e 6974  nd rx is in unit
+00037bf0: 732c 2074 6869 7320 6973 2075 6e73 6f6c  s, this is unsol
+00037c00: 7661 626c 6520 7769 7468 6f75 7420 6b6e  vable without kn
+00037c10: 6f77 696e 6720 7468 6520 7070 690d 0a20  owing the ppi.. 
+00037c20: 2020 2020 2020 2073 656c 662e 7278 203d         self.rx =
+00037c30: 2072 780d 0a20 2020 2020 2020 2073 656c   rx..        sel
+00037c40: 662e 7279 203d 2072 790d 0a0d 0a20 2020  f.ry = ry....   
+00037c50: 2064 6566 205f 6174 7472 7328 7365 6c66   def _attrs(self
+00037c60: 2c20 7661 6c75 6573 293a 0d0a 2020 2020  , values):..    
+00037c70: 2020 2020 6966 2073 656c 662e 7820 213d      if self.x !=
+00037c80: 2030 3a0d 0a20 2020 2020 2020 2020 2020   0:..           
+00037c90: 2076 616c 7565 732e 6170 7065 6e64 2822   values.append("
+00037ca0: 2573 3d25 7322 2025 2028 5356 475f 4154  %s=%s" % (SVG_AT
+00037cb0: 5452 5f58 2c20 4c65 6e67 7468 2e73 7472  TR_X, Length.str
+00037cc0: 2873 656c 662e 7829 2929 0d0a 2020 2020  (self.x)))..    
+00037cd0: 2020 2020 6966 2073 656c 662e 7920 213d      if self.y !=
+00037ce0: 2030 3a0d 0a20 2020 2020 2020 2020 2020   0:..           
+00037cf0: 2076 616c 7565 732e 6170 7065 6e64 2822   values.append("
+00037d00: 2573 3d25 7322 2025 2028 5356 475f 4154  %s=%s" % (SVG_AT
+00037d10: 5452 5f59 2c20 4c65 6e67 7468 2e73 7472  TR_Y, Length.str
+00037d20: 2873 656c 662e 7929 2929 0d0a 2020 2020  (self.y)))..    
+00037d30: 2020 2020 6966 2073 656c 662e 7769 6474      if self.widt
+00037d40: 6820 213d 2030 3a0d 0a20 2020 2020 2020  h != 0:..       
+00037d50: 2020 2020 2076 616c 7565 732e 6170 7065       values.appe
+00037d60: 6e64 2822 2573 3d25 7322 2025 2028 5356  nd("%s=%s" % (SV
+00037d70: 475f 4154 5452 5f57 4944 5448 2c20 4c65  G_ATTR_WIDTH, Le
+00037d80: 6e67 7468 2e73 7472 2873 656c 662e 7769  ngth.str(self.wi
+00037d90: 6474 6829 2929 0d0a 2020 2020 2020 2020  dth)))..        
+00037da0: 6966 2073 656c 662e 6865 6967 6874 2021  if self.height !
+00037db0: 3d20 303a 0d0a 2020 2020 2020 2020 2020  = 0:..          
+00037dc0: 2020 7661 6c75 6573 2e61 7070 656e 6428    values.append(
+00037dd0: 2225 733d 2573 2220 2520 2853 5647 5f41  "%s=%s" % (SVG_A
+00037de0: 5454 525f 4845 4947 4854 2c20 4c65 6e67  TTR_HEIGHT, Leng
+00037df0: 7468 2e73 7472 2873 656c 662e 6865 6967  th.str(self.heig
+00037e00: 6874 2929 290d 0a20 2020 2020 2020 2069  ht)))..        i
+00037e10: 6620 7365 6c66 2e72 7820 213d 2030 3a0d  f self.rx != 0:.
+00037e20: 0a20 2020 2020 2020 2020 2020 2076 616c  .            val
+00037e30: 7565 732e 6170 7065 6e64 2822 2573 3d25  ues.append("%s=%
+00037e40: 7322 2025 2028 5356 475f 4154 5452 5f52  s" % (SVG_ATTR_R
+00037e50: 4144 4955 535f 582c 204c 656e 6774 682e  ADIUS_X, Length.
+00037e60: 7374 7228 7365 6c66 2e72 7829 2929 0d0a  str(self.rx)))..
+00037e70: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00037e80: 7279 2021 3d20 303a 0d0a 2020 2020 2020  ry != 0:..      
+00037e90: 2020 2020 2020 7661 6c75 6573 2e61 7070        values.app
+00037ea0: 656e 6428 2225 733d 2573 2220 2520 2853  end("%s=%s" % (S
+00037eb0: 5647 5f41 5454 525f 5241 4449 5553 5f59  VG_ATTR_RADIUS_Y
+00037ec0: 2c20 4c65 6e67 7468 2e73 7472 2873 656c  , Length.str(sel
+00037ed0: 662e 7279 2929 290d 0a0d 0a20 2020 2064  f.ry)))....    d
+00037ee0: 6566 205f 5f72 6570 725f 5f28 7365 6c66  ef __repr__(self
+00037ef0: 293a 0d0a 2020 2020 2020 2020 7661 6c75  ):..        valu
+00037f00: 6573 203d 205b 5d0d 0a20 2020 2020 2020  es = []..       
+00037f10: 2073 656c 662e 5f61 7474 7273 2876 616c   self._attrs(val
+00037f20: 7565 7329 0d0a 2020 2020 2020 2020 7365  ues)..        se
+00037f30: 6c66 2e5f 7265 7072 5f73 6861 7065 2876  lf._repr_shape(v
+00037f40: 616c 7565 7329 0d0a 2020 2020 2020 2020  alues)..        
+00037f50: 7061 7261 6d73 203d 2022 2c20 222e 6a6f  params = ", ".jo
+00037f60: 696e 2876 616c 7565 7329 0d0a 2020 2020  in(values)..    
+00037f70: 2020 2020 7265 7475 726e 2022 5265 6374      return "Rect
+00037f80: 2825 7329 2220 2520 7061 7261 6d73 0d0a  (%s)" % params..
+00037f90: 0d0a 2020 2020 6465 6620 5f5f 7374 725f  ..    def __str_
+00037fa0: 5f28 7365 6c66 293a 0d0a 2020 2020 2020  _(self):..      
+00037fb0: 2020 7661 6c75 6573 203d 205b 5d0d 0a20    values = [].. 
+00037fc0: 2020 2020 2020 2073 656c 662e 5f61 7474         self._att
+00037fd0: 7273 2876 616c 7565 7329 0d0a 2020 2020  rs(values)..    
+00037fe0: 2020 2020 7365 6c66 2e5f 7374 725f 7368      self._str_sh
+00037ff0: 6170 6528 7661 6c75 6573 290d 0a20 2020  ape(values)..   
+00038000: 2020 2020 2070 6172 616d 7320 3d20 222c       params = ",
+00038010: 2022 2e6a 6f69 6e28 7661 6c75 6573 290d   ".join(values).
+00038020: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00038030: 2252 6563 7428 2573 2922 2025 2070 6172  "Rect(%s)" % par
+00038040: 616d 730d 0a0d 0a20 2020 2064 6566 205f  ams....    def _
+00038050: 5f63 6f70 795f 5f28 7365 6c66 293a 0d0a  _copy__(self):..
+00038060: 2020 2020 2020 2020 7265 7475 726e 2052          return R
+00038070: 6563 7428 7365 6c66 290d 0a0d 0a20 2020  ect(self)....   
+00038080: 2040 7072 6f70 6572 7479 0d0a 2020 2020   @property..    
+00038090: 6465 6620 696d 706c 6963 6974 5f70 6f73  def implicit_pos
+000380a0: 6974 696f 6e28 7365 6c66 293a 0d0a 2020  ition(self):..  
+000380b0: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
+000380c0: 662e 6170 706c 793a 0d0a 2020 2020 2020  f.apply:..      
+000380d0: 2020 2020 2020 7265 7475 726e 2050 6f69        return Poi
+000380e0: 6e74 2873 656c 662e 782c 2073 656c 662e  nt(self.x, self.
+000380f0: 7929 0d0a 2020 2020 2020 2020 706f 696e  y)..        poin
+00038100: 7420 3d20 506f 696e 7428 7365 6c66 2e78  t = Point(self.x
+00038110: 2c20 7365 6c66 2e79 290d 0a20 2020 2020  , self.y)..     
+00038120: 2020 2070 6f69 6e74 202a 3d20 7365 6c66     point *= self
+00038130: 2e74 7261 6e73 666f 726d 0d0a 2020 2020  .transform..    
+00038140: 2020 2020 7265 7475 726e 2070 6f69 6e74      return point
+00038150: 0d0a 0d0a 2020 2020 4070 726f 7065 7274  ....    @propert
+00038160: 790d 0a20 2020 2064 6566 2069 6d70 6c69  y..    def impli
+00038170: 6369 745f 7828 7365 6c66 293a 0d0a 2020  cit_x(self):..  
+00038180: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
+00038190: 662e 6170 706c 793a 0d0a 2020 2020 2020  f.apply:..      
+000381a0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+000381b0: 662e 780d 0a20 2020 2020 2020 2072 6574  f.x..        ret
+000381c0: 7572 6e20 7365 6c66 2e69 6d70 6c69 6369  urn self.implici
+000381d0: 745f 706f 7369 7469 6f6e 5b30 5d0d 0a0d  t_position[0]...
+000381e0: 0a20 2020 2040 7072 6f70 6572 7479 0d0a  .    @property..
+000381f0: 2020 2020 6465 6620 696d 706c 6963 6974      def implicit
+00038200: 5f79 2873 656c 6629 3a0d 0a20 2020 2020  _y(self):..     
+00038210: 2020 2069 6620 6e6f 7420 7365 6c66 2e61     if not self.a
+00038220: 7070 6c79 3a0d 0a20 2020 2020 2020 2020  pply:..         
+00038230: 2020 2072 6574 7572 6e20 7365 6c66 2e79     return self.y
+00038240: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00038250: 2073 656c 662e 696d 706c 6963 6974 5f70   self.implicit_p
+00038260: 6f73 6974 696f 6e5b 315d 0d0a 0d0a 2020  osition[1]....  
+00038270: 2020 4070 726f 7065 7274 790d 0a20 2020    @property..   
+00038280: 2064 6566 2069 6d70 6c69 6369 745f 7769   def implicit_wi
+00038290: 6474 6828 7365 6c66 293a 0d0a 2020 2020  dth(self):..    
+000382a0: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
+000382b0: 6170 706c 793a 0d0a 2020 2020 2020 2020  apply:..        
+000382c0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+000382d0: 7769 6474 680d 0a20 2020 2020 2020 2070  width..        p
+000382e0: 203d 2050 6f69 6e74 2873 656c 662e 7769   = Point(self.wi
+000382f0: 6474 682c 2030 290d 0a20 2020 2020 2020  dth, 0)..       
+00038300: 2070 202a 3d20 7365 6c66 2e74 7261 6e73   p *= self.trans
+00038310: 666f 726d 0d0a 2020 2020 2020 2020 6f72  form..        or
+00038320: 6967 696e 203d 2050 6f69 6e74 2830 2c20  igin = Point(0, 
+00038330: 3029 0d0a 2020 2020 2020 2020 6f72 6967  0)..        orig
+00038340: 696e 202a 3d20 7365 6c66 2e74 7261 6e73  in *= self.trans
+00038350: 666f 726d 0d0a 2020 2020 2020 2020 7265  form..        re
+00038360: 7475 726e 206f 7269 6769 6e2e 6469 7374  turn origin.dist
+00038370: 616e 6365 5f74 6f28 7029 0d0a 0d0a 2020  ance_to(p)....  
+00038380: 2020 4070 726f 7065 7274 790d 0a20 2020    @property..   
+00038390: 2064 6566 2069 6d70 6c69 6369 745f 6865   def implicit_he
+000383a0: 6967 6874 2873 656c 6629 3a0d 0a20 2020  ight(self):..   
+000383b0: 2020 2020 2069 6620 6e6f 7420 7365 6c66       if not self
+000383c0: 2e61 7070 6c79 3a0d 0a20 2020 2020 2020  .apply:..       
+000383d0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+000383e0: 2e68 6569 6768 740d 0a20 2020 2020 2020  .height..       
+000383f0: 2070 203d 2050 6f69 6e74 2830 2c20 7365   p = Point(0, se
+00038400: 6c66 2e68 6569 6768 7429 0d0a 2020 2020  lf.height)..    
+00038410: 2020 2020 7020 2a3d 2073 656c 662e 7472      p *= self.tr
+00038420: 616e 7366 6f72 6d0d 0a20 2020 2020 2020  ansform..       
+00038430: 206f 7269 6769 6e20 3d20 506f 696e 7428   origin = Point(
+00038440: 302c 2030 290d 0a20 2020 2020 2020 206f  0, 0)..        o
+00038450: 7269 6769 6e20 2a3d 2073 656c 662e 7472  rigin *= self.tr
+00038460: 616e 7366 6f72 6d0d 0a20 2020 2020 2020  ansform..       
+00038470: 2072 6574 7572 6e20 6f72 6967 696e 2e64   return origin.d
+00038480: 6973 7461 6e63 655f 746f 2870 290d 0a0d  istance_to(p)...
+00038490: 0a20 2020 2040 7072 6f70 6572 7479 0d0a  .    @property..
+000384a0: 2020 2020 6465 6620 696d 706c 6963 6974      def implicit
+000384b0: 5f72 7828 7365 6c66 293a 0d0a 2020 2020  _rx(self):..    
+000384c0: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
+000384d0: 6170 706c 793a 0d0a 2020 2020 2020 2020  apply:..        
+000384e0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+000384f0: 7278 0d0a 2020 2020 2020 2020 7020 3d20  rx..        p = 
+00038500: 506f 696e 7428 7365 6c66 2e72 782c 2030  Point(self.rx, 0
+00038510: 290d 0a20 2020 2020 2020 2070 202a 3d20  )..        p *= 
+00038520: 7365 6c66 2e74 7261 6e73 666f 726d 0d0a  self.transform..
+00038530: 2020 2020 2020 2020 6f72 6967 696e 203d          origin =
+00038540: 2050 6f69 6e74 2830 2c20 3029 0d0a 2020   Point(0, 0)..  
+00038550: 2020 2020 2020 6f72 6967 696e 202a 3d20        origin *= 
+00038560: 7365 6c66 2e74 7261 6e73 666f 726d 0d0a  self.transform..
+00038570: 2020 2020 2020 2020 7265 7475 726e 206f          return o
+00038580: 7269 6769 6e2e 6469 7374 616e 6365 5f74  rigin.distance_t
+00038590: 6f28 7029 0d0a 0d0a 2020 2020 4070 726f  o(p)....    @pro
+000385a0: 7065 7274 790d 0a20 2020 2064 6566 2069  perty..    def i
+000385b0: 6d70 6c69 6369 745f 7279 2873 656c 6629  mplicit_ry(self)
+000385c0: 3a0d 0a20 2020 2020 2020 2069 6620 6e6f  :..        if no
+000385d0: 7420 7365 6c66 2e61 7070 6c79 3a0d 0a20  t self.apply:.. 
+000385e0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+000385f0: 6e20 7365 6c66 2e72 790d 0a20 2020 2020  n self.ry..     
+00038600: 2020 2070 203d 2050 6f69 6e74 2830 2c20     p = Point(0, 
+00038610: 7365 6c66 2e72 7929 0d0a 2020 2020 2020  self.ry)..      
+00038620: 2020 7020 2a3d 2073 656c 662e 7472 616e    p *= self.tran
+00038630: 7366 6f72 6d0d 0a20 2020 2020 2020 206f  sform..        o
+00038640: 7269 6769 6e20 3d20 506f 696e 7428 302c  rigin = Point(0,
+00038650: 2030 290d 0a20 2020 2020 2020 206f 7269   0)..        ori
+00038660: 6769 6e20 2a3d 2073 656c 662e 7472 616e  gin *= self.tran
+00038670: 7366 6f72 6d0d 0a20 2020 2020 2020 2072  sform..        r
+00038680: 6574 7572 6e20 6f72 6967 696e 2e64 6973  eturn origin.dis
+00038690: 7461 6e63 655f 746f 2870 290d 0a0d 0a20  tance_to(p).... 
+000386a0: 2020 2064 6566 2073 6567 6d65 6e74 7328     def segments(
+000386b0: 7365 6c66 2c20 7472 616e 7366 6f72 6d65  self, transforme
+000386c0: 643d 5472 7565 293a 0d0a 2020 2020 2020  d=True):..      
+000386d0: 2020 2222 220d 0a20 2020 2020 2020 2052    """..        R
+000386e0: 6563 7420 6465 636f 6d70 6f73 6974 696f  ect decompositio
+000386f0: 6e20 6973 2067 6976 656e 2069 6e20 5356  n is given in SV
+00038700: 4720 322e 3020 3130 2e32 0d0a 0d0a 2020  G 2.0 10.2....  
+00038710: 2020 2020 2020 5265 6374 3a0d 0a20 2020        Rect:..   
+00038720: 2020 2020 202a 2070 6572 666f 726d 2061       * perform a
+00038730: 6e20 6162 736f 6c75 7465 206d 6f76 6574  n absolute movet
+00038740: 6f20 6f70 6572 6174 696f 6e20 746f 206c  o operation to l
+00038750: 6f63 6174 696f 6e20 2878 2c79 293b 0d0a  ocation (x,y);..
+00038760: 2020 2020 2020 2020 2a20 7065 7266 6f72          * perfor
+00038770: 6d20 616e 2061 6273 6f6c 7574 6520 686f  m an absolute ho
+00038780: 7269 7a6f 6e74 616c 206c 696e 6574 6f20  rizontal lineto 
+00038790: 7769 7468 2070 6172 616d 6574 6572 2078  with parameter x
+000387a0: 2b77 6964 7468 3b0d 0a20 2020 2020 2020  +width;..       
+000387b0: 202a 2070 6572 666f 726d 2061 6e20 6162   * perform an ab
+000387c0: 736f 6c75 7465 2076 6572 7469 6361 6c20  solute vertical 
+000387d0: 6c69 6e65 746f 2070 6172 616d 6574 6572  lineto parameter
+000387e0: 2079 2b68 6569 6768 743b 0d0a 2020 2020   y+height;..    
+000387f0: 2020 2020 2a20 7065 7266 6f72 6d20 616e      * perform an
+00038800: 2061 6273 6f6c 7574 6520 686f 7269 7a6f   absolute horizo
+00038810: 6e74 616c 206c 696e 6574 6f20 7061 7261  ntal lineto para
+00038820: 6d65 7465 7220 783b 0d0a 2020 2020 2020  meter x;..      
+00038830: 2020 2a20 2820 636c 6f73 6520 7468 6520    * ( close the 
+00038840: 7061 7468 290d 0a0d 0a20 2020 2020 2020  path)....       
+00038850: 2052 6f75 6e64 6564 2052 6563 743a 0d0a   Rounded Rect:..
+00038860: 2020 2020 2020 2020 7278 2061 6e64 2072          rx and r
+00038870: 7920 6172 6520 7573 6564 2061 7320 7468  y are used as th
+00038880: 6520 6571 7569 7661 6c65 6e74 2070 6172  e equivalent par
+00038890: 616d 6574 6572 7320 746f 2074 6865 2065  ameters to the e
+000388a0: 6c6c 6970 7469 6361 6c20 6172 6320 636f  lliptical arc co
+000388b0: 6d6d 616e 642c 0d0a 2020 2020 2020 2020  mmand,..        
+000388c0: 7468 6520 782d 6178 6973 2d72 6f74 6174  the x-axis-rotat
+000388d0: 696f 6e20 616e 6420 6c61 7267 652d 6172  ion and large-ar
+000388e0: 632d 666c 6167 2061 7265 2073 6574 2074  c-flag are set t
+000388f0: 6f20 7a65 726f 2c20 7468 6520 7377 6565  o zero, the swee
+00038900: 702d 666c 6167 2069 7320 7365 7420 746f  p-flag is set to
+00038910: 206f 6e65 0d0a 0d0a 2020 2020 2020 2020   one....        
+00038920: 2a20 7065 7266 6f72 6d20 616e 2061 6273  * perform an abs
+00038930: 6f6c 7574 6520 6d6f 7665 746f 206f 7065  olute moveto ope
+00038940: 7261 7469 6f6e 2074 6f20 6c6f 6361 7469  ration to locati
+00038950: 6f6e 2028 782b 7278 2c79 293b 0d0a 2020  on (x+rx,y);..  
+00038960: 2020 2020 2020 2a20 7065 7266 6f72 6d20        * perform 
+00038970: 616e 2061 6273 6f6c 7574 6520 686f 7269  an absolute hori
+00038980: 7a6f 6e74 616c 206c 696e 6574 6f20 7769  zontal lineto wi
+00038990: 7468 2070 6172 616d 6574 6572 2078 2b77  th parameter x+w
+000389a0: 6964 7468 2d72 783b 0d0a 2020 2020 2020  idth-rx;..      
+000389b0: 2020 2a20 7065 7266 6f72 6d20 616e 2061    * perform an a
+000389c0: 6273 6f6c 7574 6520 656c 6c69 7074 6963  bsolute elliptic
+000389d0: 616c 2061 7263 206f 7065 7261 7469 6f6e  al arc operation
+000389e0: 2074 6f20 636f 6f72 6469 6e61 7465 2028   to coordinate (
+000389f0: 782b 7769 6474 682c 792b 7279 290d 0a20  x+width,y+ry).. 
+00038a00: 2020 2020 2020 202a 2070 6572 666f 726d         * perform
+00038a10: 2061 6e20 6162 736f 6c75 7465 2076 6572   an absolute ver
+00038a20: 7469 6361 6c20 6c69 6e65 746f 2070 6172  tical lineto par
+00038a30: 616d 6574 6572 2079 2b68 6569 6768 742d  ameter y+height-
+00038a40: 7279 3b0d 0a20 2020 2020 2020 202a 2070  ry;..        * p
+00038a50: 6572 666f 726d 2061 6e20 6162 736f 6c75  erform an absolu
+00038a60: 7465 2065 6c6c 6970 7469 6361 6c20 6172  te elliptical ar
+00038a70: 6320 6f70 6572 6174 696f 6e20 746f 2063  c operation to c
+00038a80: 6f6f 7264 696e 6174 6520 2878 2b77 6964  oordinate (x+wid
+00038a90: 7468 2d72 782c 792b 6865 6967 6874 290d  th-rx,y+height).
+00038aa0: 0a20 2020 2020 2020 202a 2070 6572 666f  .        * perfo
+00038ab0: 726d 2061 6e20 6162 736f 6c75 7465 2068  rm an absolute h
+00038ac0: 6f72 697a 6f6e 7461 6c20 6c69 6e65 746f  orizontal lineto
+00038ad0: 2070 6172 616d 6574 6572 2078 2b72 783b   parameter x+rx;
+00038ae0: 0d0a 2020 2020 2020 2020 2a20 7065 7266  ..        * perf
+00038af0: 6f72 6d20 616e 2061 6273 6f6c 7574 6520  orm an absolute 
+00038b00: 656c 6c69 7074 6963 616c 2061 7263 206f  elliptical arc o
+00038b10: 7065 7261 7469 6f6e 2074 6f20 636f 6f72  peration to coor
+00038b20: 6469 6e61 7465 2028 782c 792b 6865 6967  dinate (x,y+heig
+00038b30: 6874 2d72 7929 0d0a 2020 2020 2020 2020  ht-ry)..        
+00038b40: 2a20 7065 7266 6f72 6d20 616e 2061 6273  * perform an abs
+00038b50: 6f6c 7574 6520 7665 7274 6963 616c 206c  olute vertical l
+00038b60: 696e 6574 6f20 7061 7261 6d65 7465 7220  ineto parameter 
+00038b70: 792b 7279 0d0a 2020 2020 2020 2020 2a20  y+ry..        * 
+00038b80: 7065 7266 6f72 6d20 616e 2061 6273 6f6c  perform an absol
+00038b90: 7574 6520 656c 6c69 7074 6963 616c 2061  ute elliptical a
+00038ba0: 7263 206f 7065 7261 7469 6f6e 2077 6974  rc operation wit
+00038bb0: 6820 6120 7365 676d 656e 742d 636f 6d70  h a segment-comp
+00038bc0: 6c65 7469 6e67 2063 6c6f 7365 2070 6174  leting close pat
+00038bd0: 6820 6f70 6572 6174 696f 6e0d 0a0d 0a20  h operation.... 
+00038be0: 2020 2020 2020 203a 7061 7261 6d20 7472         :param tr
+00038bf0: 616e 7366 6f72 6d65 643a 2070 726f 7669  ansformed: provi
+00038c00: 6465 2074 6865 2072 6569 6669 6564 2076  de the reified v
+00038c10: 6572 7369 6f6e 2e0d 0a20 2020 2020 2020  ersion...       
+00038c20: 203a 7265 7475 726e 3a20 7061 7468 5f64   :return: path_d
+00038c30: 206f 6620 7368 6170 652e 0d0a 2020 2020   of shape...    
+00038c40: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
+00038c50: 2073 636f 6f70 6564 203d 2046 616c 7365   scooped = False
+00038c60: 0d0a 2020 2020 2020 2020 7820 3d20 7365  ..        x = se
+00038c70: 6c66 2e78 0d0a 2020 2020 2020 2020 7920  lf.x..        y 
+00038c80: 3d20 7365 6c66 2e79 0d0a 2020 2020 2020  = self.y..      
+00038c90: 2020 7769 6474 6820 3d20 7365 6c66 2e77    width = self.w
+00038ca0: 6964 7468 0d0a 2020 2020 2020 2020 6865  idth..        he
+00038cb0: 6967 6874 203d 2073 656c 662e 6865 6967  ight = self.heig
+00038cc0: 6874 0d0a 2020 2020 2020 2020 6966 2073  ht..        if s
+00038cd0: 656c 662e 6973 5f64 6567 656e 6572 6174  elf.is_degenerat
+00038ce0: 6528 293a 0d0a 2020 2020 2020 2020 2020  e():..          
+00038cf0: 2020 7265 7475 726e 2028 2920 2023 2061    return ()  # a
+00038d00: 2063 6f6d 7075 7465 6420 7661 6c75 6520   computed value 
+00038d10: 6f66 207a 6572 6f20 666f 7220 6569 7468  of zero for eith
+00038d20: 6572 2064 696d 656e 7369 6f6e 2064 6973  er dimension dis
+00038d30: 6162 6c65 7320 7265 6e64 6572 696e 672e  ables rendering.
+00038d40: 0d0a 2020 2020 2020 2020 7278 203d 2073  ..        rx = s
+00038d50: 656c 662e 7278 0d0a 2020 2020 2020 2020  elf.rx..        
+00038d60: 7279 203d 2073 656c 662e 7279 0d0a 2020  ry = self.ry..  
+00038d70: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
+00038d80: 662e 5f73 7472 6963 743a 0d0a 2020 2020  f._strict:..    
+00038d90: 2020 2020 2020 2020 6966 2072 7820 3c20          if rx < 
+00038da0: 3020 3c20 7769 6474 6820 616e 6420 7279  0 < width and ry
+00038db0: 203c 2030 203c 2068 6569 6768 743a 0d0a   < 0 < height:..
+00038dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038dd0: 7363 6f6f 7065 6420 3d20 5472 7565 0d0a  scooped = True..
+00038de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038df0: 7278 203d 2061 6273 2872 7829 0d0a 2020  rx = abs(rx)..  
+00038e00: 2020 2020 2020 2020 2020 2020 2020 7279                ry
+00038e10: 203d 2061 6273 2872 7929 0d0a 2020 2020   = abs(ry)..    
+00038e20: 2020 2020 6966 2072 7820 3c20 3020 3c20      if rx < 0 < 
+00038e30: 7769 6474 6820 6f72 2072 7920 3c20 3020  width or ry < 0 
+00038e40: 3c20 6865 6967 6874 3a0d 0a20 2020 2020  < height:..     
+00038e50: 2020 2020 2020 2072 7820 3d20 300d 0a20         rx = 0.. 
+00038e60: 2020 2020 2020 2020 2020 2072 7920 3d20             ry = 
+00038e70: 300d 0a20 2020 2020 2020 2069 6620 7278  0..        if rx
+00038e80: 203d 3d20 7279 203d 3d20 303a 0d0a 2020   == ry == 0:..  
+00038e90: 2020 2020 2020 2020 2020 7365 676d 656e            segmen
+00038ea0: 7473 203d 2028 0d0a 2020 2020 2020 2020  ts = (..        
+00038eb0: 2020 2020 2020 2020 4d6f 7665 284e 6f6e          Move(Non
+00038ec0: 652c 2028 782c 2079 2929 2c0d 0a20 2020  e, (x, y)),..   
+00038ed0: 2020 2020 2020 2020 2020 2020 204c 696e               Lin
+00038ee0: 6528 2878 2c20 7929 2c20 2878 202b 2077  e((x, y), (x + w
+00038ef0: 6964 7468 2c20 7929 292c 0d0a 2020 2020  idth, y)),..    
+00038f00: 2020 2020 2020 2020 2020 2020 4c69 6e65              Line
+00038f10: 2828 7820 2b20 7769 6474 682c 2079 292c  ((x + width, y),
+00038f20: 2028 7820 2b20 7769 6474 682c 2079 202b   (x + width, y +
+00038f30: 2068 6569 6768 7429 292c 0d0a 2020 2020   height)),..    
+00038f40: 2020 2020 2020 2020 2020 2020 4c69 6e65              Line
+00038f50: 2828 7820 2b20 7769 6474 682c 2079 202b  ((x + width, y +
+00038f60: 2068 6569 6768 7429 2c20 2878 2c20 7920   height), (x, y 
+00038f70: 2b20 6865 6967 6874 2929 2c0d 0a20 2020  + height)),..   
+00038f80: 2020 2020 2020 2020 2020 2020 2043 6c6f               Clo
+00038f90: 7365 2828 782c 2079 202b 2068 6569 6768  se((x, y + heigh
+00038fa0: 7429 2c20 2878 2c20 7929 292c 0d0a 2020  t), (x, y)),..  
+00038fb0: 2020 2020 2020 2020 2020 290d 0a20 2020            )..   
+00038fc0: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+00038fd0: 2020 2020 2020 2020 7365 676d 656e 7473          segments
+00038fe0: 203d 2028 0d0a 2020 2020 2020 2020 2020   = (..          
+00038ff0: 2020 2020 2020 4d6f 7665 284e 6f6e 652c        Move(None,
+00039000: 2028 7820 2b20 7278 2c20 7929 292c 0d0a   (x + rx, y)),..
+00039010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00039020: 4c69 6e65 2828 7820 2b20 7278 2c20 7929  Line((x + rx, y)
+00039030: 2c20 2878 202b 2077 6964 7468 202d 2072  , (x + width - r
+00039040: 782c 2079 2929 2c0d 0a20 2020 2020 2020  x, y)),..       
+00039050: 2020 2020 2020 2020 2041 7263 280d 0a20           Arc(.. 
+00039060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00039070: 2020 2028 7820 2b20 7769 6474 6820 2d20     (x + width - 
+00039080: 7278 2c20 7929 2c0d 0a20 2020 2020 2020  rx, y),..       
+00039090: 2020 2020 2020 2020 2020 2020 2028 7820               (x 
+000390a0: 2b20 7769 6474 682c 2079 202b 2072 7929  + width, y + ry)
+000390b0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+000390c0: 2020 2020 2020 2072 783d 7278 2c0d 0a20         rx=rx,.. 
+000390d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000390e0: 2020 2072 793d 7279 2c0d 0a20 2020 2020     ry=ry,..     
+000390f0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00039100: 636f 6f70 6564 3d73 636f 6f70 6564 2c0d  cooped=scooped,.
+00039110: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00039120: 2029 2c0d 0a20 2020 2020 2020 2020 2020   ),..           
+00039130: 2020 2020 204c 696e 6528 2878 202b 2077       Line((x + w
+00039140: 6964 7468 2c20 7920 2b20 7279 292c 2028  idth, y + ry), (
+00039150: 7820 2b20 7769 6474 682c 2079 202b 2068  x + width, y + h
+00039160: 6569 6768 7420 2d20 7279 2929 2c0d 0a20  eight - ry)),.. 
+00039170: 2020 2020 2020 2020 2020 2020 2020 2041                 A
+00039180: 7263 280d 0a20 2020 2020 2020 2020 2020  rc(..           
+00039190: 2020 2020 2020 2020 2028 7820 2b20 7769           (x + wi
+000391a0: 6474 682c 2079 202b 2068 6569 6768 7420  dth, y + height 
+000391b0: 2d20 7279 292c 0d0a 2020 2020 2020 2020  - ry),..        
+000391c0: 2020 2020 2020 2020 2020 2020 2878 202b              (x +
+000391d0: 2077 6964 7468 202d 2072 782c 2079 202b   width - rx, y +
+000391e0: 2068 6569 6768 7429 2c0d 0a20 2020 2020   height),..     
+000391f0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00039200: 783d 7278 2c0d 0a20 2020 2020 2020 2020  x=rx,..         
+00039210: 2020 2020 2020 2020 2020 2072 793d 7279             ry=ry
+00039220: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00039230: 2020 2020 2020 2073 636f 6f70 6564 3d73         scooped=s
+00039240: 636f 6f70 6564 2c0d 0a20 2020 2020 2020  cooped,..       
+00039250: 2020 2020 2020 2020 2029 2c0d 0a20 2020           ),..   
+00039260: 2020 2020 2020 2020 2020 2020 204c 696e               Lin
+00039270: 6528 2878 202b 2077 6964 7468 202d 2072  e((x + width - r
+00039280: 782c 2079 202b 2068 6569 6768 7429 2c20  x, y + height), 
+00039290: 2878 202b 2072 782c 2079 202b 2068 6569  (x + rx, y + hei
+000392a0: 6768 7429 292c 0d0a 2020 2020 2020 2020  ght)),..        
+000392b0: 2020 2020 2020 2020 4172 6328 0d0a 2020          Arc(..  
+000392c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000392d0: 2020 2878 202b 2072 782c 2079 202b 2068    (x + rx, y + h
+000392e0: 6569 6768 7429 2c0d 0a20 2020 2020 2020  eight),..       
+000392f0: 2020 2020 2020 2020 2020 2020 2028 782c               (x,
+00039300: 2079 202b 2068 6569 6768 7420 2d20 7279   y + height - ry
+00039310: 292c 0d0a 2020 2020 2020 2020 2020 2020  ),..            
+00039320: 2020 2020 2020 2020 7278 3d72 782c 0d0a          rx=rx,..
+00039330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00039340: 2020 2020 7279 3d72 792c 0d0a 2020 2020      ry=ry,..    
+00039350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00039360: 7363 6f6f 7065 643d 7363 6f6f 7065 642c  scooped=scooped,
+00039370: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00039380: 2020 292c 0d0a 2020 2020 2020 2020 2020    ),..          
+00039390: 2020 2020 2020 4c69 6e65 2828 782c 2079        Line((x, y
+000393a0: 202b 2068 6569 6768 7420 2d20 7279 292c   + height - ry),
+000393b0: 2028 782c 2079 202b 2072 7929 292c 0d0a   (x, y + ry)),..
+000393c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000393d0: 4172 6328 2878 2c20 7920 2b20 7279 292c  Arc((x, y + ry),
+000393e0: 2028 7820 2b20 7278 2c20 7929 2c20 7278   (x + rx, y), rx
+000393f0: 3d72 782c 2072 793d 7279 2c20 7363 6f6f  =rx, ry=ry, scoo
+00039400: 7065 643d 7363 6f6f 7065 6429 2c0d 0a20  ped=scooped),.. 
+00039410: 2020 2020 2020 2020 2020 2020 2020 2043                 C
+00039420: 6c6f 7365 2828 7820 2b20 7278 2c20 7929  lose((x + rx, y)
+00039430: 2c20 2878 202b 2072 782c 2079 2929 2c0d  , (x + rx, y)),.
+00039440: 0a20 2020 2020 2020 2020 2020 2029 0d0a  .            )..
+00039450: 2020 2020 2020 2020 6966 206e 6f74 2074          if not t
+00039460: 7261 6e73 666f 726d 6564 206f 7220 7365  ransformed or se
+00039470: 6c66 2e74 7261 6e73 666f 726d 2e69 735f  lf.transform.is_
+00039480: 6964 656e 7469 7479 2829 3a0d 0a20 2020  identity():..   
+00039490: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+000394a0: 7365 676d 656e 7473 0d0a 2020 2020 2020  segments..      
+000394b0: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+000394c0: 2020 2020 2072 6574 7572 6e20 5b73 202a       return [s *
+000394d0: 2073 656c 662e 7472 616e 7366 6f72 6d20   self.transform 
+000394e0: 666f 7220 7320 696e 2073 6567 6d65 6e74  for s in segment
+000394f0: 735d 0d0a 0d0a 2020 2020 6465 6620 7265  s]....    def re
+00039500: 6966 7928 7365 6c66 293a 0d0a 2020 2020  ify(self):..    
+00039510: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
+00039520: 2052 6561 6c69 7a65 7320 7468 6520 7472   Realizes the tr
+00039530: 616e 7366 6f72 6d20 746f 2074 6865 2073  ansform to the s
+00039540: 6861 7065 2070 726f 7065 7274 6965 732e  hape properties.
+00039550: 0d0a 0d0a 2020 2020 2020 2020 4966 2074  ....        If t
+00039560: 6865 2072 6561 6c69 7a65 6420 7368 6170  he realized shap
+00039570: 6520 6361 6e20 6265 2070 726f 7065 726c  e can be properl
+00039580: 7920 7265 7072 6573 656e 7465 6420 6173  y represented as
+00039590: 2061 2072 6563 7461 6e67 6c65 2077 6974   a rectangle wit
+000395a0: 6820 616e 2069 6465 6e74 6974 7920 6d61  h an identity ma
+000395b0: 7472 6978 0d0a 2020 2020 2020 2020 6974  trix..        it
+000395c0: 2077 696c 6c20 6265 2c20 6f74 6865 7277   will be, otherw
+000395d0: 6973 6520 7468 6520 7072 6f70 6572 7469  ise the properti
+000395e0: 6573 2077 696c 6c20 6170 7072 6f78 696d  es will approxim
+000395f0: 6174 6520 7468 6520 696d 706c 6965 6420  ate the implied 
+00039600: 7661 6c75 6573 2e0d 0a0d 0a20 2020 2020  values.....     
+00039610: 2020 2053 6b65 7765 6420 616e 6420 526f     Skewed and Ro
+00039620: 7461 7465 6420 7265 6374 616e 676c 6573  tated rectangles
+00039630: 2063 616e 6e6f 7420 6265 2072 6569 6669   cannot be reifi
+00039640: 6564 2e0d 0a20 2020 2020 2020 2022 2222  ed...        """
+00039650: 0d0a 2020 2020 2020 2020 7363 616c 655f  ..        scale_
+00039660: 7820 3d20 7365 6c66 2e74 7261 6e73 666f  x = self.transfo
+00039670: 726d 2e76 616c 7565 5f73 6361 6c65 5f78  rm.value_scale_x
+00039680: 2829 0d0a 2020 2020 2020 2020 7363 616c  ()..        scal
+00039690: 655f 7920 3d20 7365 6c66 2e74 7261 6e73  e_y = self.trans
+000396a0: 666f 726d 2e76 616c 7565 5f73 6361 6c65  form.value_scale
+000396b0: 5f79 2829 0d0a 2020 2020 2020 2020 6966  _y()..        if
+000396c0: 2073 6361 6c65 5f78 202a 2073 6361 6c65   scale_x * scale
+000396d0: 5f79 203c 2030 3a0d 0a20 2020 2020 2020  _y < 0:..       
+000396e0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+000396f0: 2020 2320 4e6f 2072 6569 6669 6361 7469    # No reificati
+00039700: 6f6e 206f 6620 6e65 6761 7469 7665 2076  on of negative v
+00039710: 616c 7565 732c 2067 6976 6573 206e 6567  alues, gives neg
+00039720: 6174 6976 6520 6469 6d73 2e0d 0a20 2020  ative dims...   
+00039730: 2020 2020 2074 7261 6e73 6c61 7465 5f78       translate_x
+00039740: 203d 2073 656c 662e 7472 616e 7366 6f72   = self.transfor
+00039750: 6d2e 7661 6c75 655f 7472 616e 735f 7828  m.value_trans_x(
+00039760: 290d 0a20 2020 2020 2020 2074 7261 6e73  )..        trans
+00039770: 6c61 7465 5f79 203d 2073 656c 662e 7472  late_y = self.tr
+00039780: 616e 7366 6f72 6d2e 7661 6c75 655f 7472  ansform.value_tr
+00039790: 616e 735f 7928 290d 0a20 2020 2020 2020  ans_y()..       
+000397a0: 2069 6620 280d 0a20 2020 2020 2020 2020   if (..         
+000397b0: 2020 2073 656c 662e 7472 616e 7366 6f72     self.transfor
+000397c0: 6d2e 7661 6c75 655f 736b 6577 5f78 2829  m.value_skew_x()
+000397d0: 203d 3d20 300d 0a20 2020 2020 2020 2020   == 0..         
+000397e0: 2020 2061 6e64 2073 656c 662e 7472 616e     and self.tran
+000397f0: 7366 6f72 6d2e 7661 6c75 655f 736b 6577  sform.value_skew
+00039800: 5f79 2829 203d 3d20 300d 0a20 2020 2020  _y() == 0..     
+00039810: 2020 2020 2020 2061 6e64 2073 6361 6c65         and scale
+00039820: 5f78 2021 3d20 300d 0a20 2020 2020 2020  _x != 0..       
+00039830: 2020 2020 2061 6e64 2073 6361 6c65 5f79       and scale_y
+00039840: 2021 3d20 300d 0a20 2020 2020 2020 2029   != 0..        )
+00039850: 3a0d 0a20 2020 2020 2020 2020 2020 2047  :..            G
+00039860: 7261 7068 6963 4f62 6a65 6374 2e72 6569  raphicObject.rei
+00039870: 6679 2873 656c 6629 0d0a 2020 2020 2020  fy(self)..      
+00039880: 2020 2020 2020 5472 616e 7366 6f72 6d61        Transforma
+00039890: 626c 652e 7265 6966 7928 7365 6c66 290d  ble.reify(self).
+000398a0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+000398b0: 662e 7820 2a3d 2073 6361 6c65 5f78 0d0a  f.x *= scale_x..
+000398c0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000398d0: 2e79 202a 3d20 7363 616c 655f 790d 0a20  .y *= scale_y.. 
+000398e0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000398f0: 7820 2b3d 2074 7261 6e73 6c61 7465 5f78  x += translate_x
+00039900: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00039910: 6c66 2e79 202b 3d20 7472 616e 736c 6174  lf.y += translat
+00039920: 655f 790d 0a20 2020 2020 2020 2020 2020  e_y..           
+00039930: 2073 656c 662e 7472 616e 7366 6f72 6d20   self.transform 
+00039940: 2a3d 204d 6174 7269 782e 7472 616e 736c  *= Matrix.transl
+00039950: 6174 6528 2d74 7261 6e73 6c61 7465 5f78  ate(-translate_x
+00039960: 2c20 2d74 7261 6e73 6c61 7465 5f79 290d  , -translate_y).
+00039970: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00039980: 662e 7278 203d 2073 6361 6c65 5f78 202a  f.rx = scale_x *
+00039990: 2073 656c 662e 7278 0d0a 2020 2020 2020   self.rx..      
+000399a0: 2020 2020 2020 7365 6c66 2e72 7920 3d20        self.ry = 
+000399b0: 7363 616c 655f 7920 2a20 7365 6c66 2e72  scale_y * self.r
+000399c0: 790d 0a20 2020 2020 2020 2020 2020 2073  y..            s
+000399d0: 656c 662e 7769 6474 6820 3d20 7363 616c  elf.width = scal
+000399e0: 655f 7820 2a20 7365 6c66 2e77 6964 7468  e_x * self.width
+000399f0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00039a00: 6c66 2e68 6569 6768 7420 3d20 7363 616c  lf.height = scal
+00039a10: 655f 7920 2a20 7365 6c66 2e68 6569 6768  e_y * self.heigh
+00039a20: 740d 0a20 2020 2020 2020 2020 2020 2073  t..            s
+00039a30: 656c 662e 7472 616e 7366 6f72 6d20 2a3d  elf.transform *=
+00039a40: 204d 6174 7269 782e 7363 616c 6528 312e   Matrix.scale(1.
+00039a50: 3020 2f20 7363 616c 655f 782c 2031 2e30  0 / scale_x, 1.0
+00039a60: 202f 2073 6361 6c65 5f79 290d 0a20 2020   / scale_y)..   
+00039a70: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00039a80: 0d0a 0d0a 2020 2020 6465 6620 7265 6e64  ....    def rend
+00039a90: 6572 2873 656c 662c 202a 2a6b 7761 7267  er(self, **kwarg
+00039aa0: 7329 3a0d 0a20 2020 2020 2020 2053 6861  s):..        Sha
+00039ab0: 7065 2e72 656e 6465 7228 7365 6c66 2c20  pe.render(self, 
+00039ac0: 2a2a 6b77 6172 6773 290d 0a20 2020 2020  **kwargs)..     
+00039ad0: 2020 2077 6964 7468 203d 206b 7761 7267     width = kwarg
+00039ae0: 732e 6765 7428 2277 6964 7468 222c 206b  s.get("width", k
+00039af0: 7761 7267 732e 6765 7428 2272 656c 6174  wargs.get("relat
+00039b00: 6976 655f 6c65 6e67 7468 2229 290d 0a20  ive_length")).. 
+00039b10: 2020 2020 2020 2068 6569 6768 7420 3d20         height = 
+00039b20: 6b77 6172 6773 2e67 6574 2822 6865 6967  kwargs.get("heig
+00039b30: 6874 222c 206b 7761 7267 732e 6765 7428  ht", kwargs.get(
+00039b40: 2272 656c 6174 6976 655f 6c65 6e67 7468  "relative_length
+00039b50: 2229 290d 0a20 2020 2020 2020 2074 7279  "))..        try
+00039b60: 3a0d 0a20 2020 2020 2020 2020 2020 2064  :..            d
+00039b70: 656c 206b 7761 7267 735b 2272 656c 6174  el kwargs["relat
+00039b80: 6976 655f 6c65 6e67 7468 225d 0d0a 2020  ive_length"]..  
+00039b90: 2020 2020 2020 6578 6365 7074 204b 6579        except Key
+00039ba0: 4572 726f 723a 0d0a 2020 2020 2020 2020  Error:..        
+00039bb0: 2020 2020 7061 7373 0d0a 2020 2020 2020      pass..      
+00039bc0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+00039bd0: 7365 6c66 2e78 2c20 4c65 6e67 7468 293a  self.x, Length):
+00039be0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00039bf0: 6c66 2e78 203d 2073 656c 662e 782e 7661  lf.x = self.x.va
+00039c00: 6c75 6528 7265 6c61 7469 7665 5f6c 656e  lue(relative_len
+00039c10: 6774 683d 7769 6474 682c 202a 2a6b 7761  gth=width, **kwa
+00039c20: 7267 7329 0d0a 2020 2020 2020 2020 6966  rgs)..        if
+00039c30: 2069 7369 6e73 7461 6e63 6528 7365 6c66   isinstance(self
+00039c40: 2e79 2c20 4c65 6e67 7468 293a 0d0a 2020  .y, Length):..  
+00039c50: 2020 2020 2020 2020 2020 7365 6c66 2e79            self.y
+00039c60: 203d 2073 656c 662e 792e 7661 6c75 6528   = self.y.value(
+00039c70: 7265 6c61 7469 7665 5f6c 656e 6774 683d  relative_length=
+00039c80: 6865 6967 6874 2c20 2a2a 6b77 6172 6773  height, **kwargs
+00039c90: 290d 0a20 2020 2020 2020 2069 6620 6973  )..        if is
+00039ca0: 696e 7374 616e 6365 2873 656c 662e 7769  instance(self.wi
+00039cb0: 6474 682c 204c 656e 6774 6829 3a0d 0a20  dth, Length):.. 
+00039cc0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00039cd0: 7769 6474 6820 3d20 7365 6c66 2e77 6964  width = self.wid
+00039ce0: 7468 2e76 616c 7565 2872 656c 6174 6976  th.value(relativ
+00039cf0: 655f 6c65 6e67 7468 3d77 6964 7468 2c20  e_length=width, 
+00039d00: 2a2a 6b77 6172 6773 290d 0a20 2020 2020  **kwargs)..     
+00039d10: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+00039d20: 2873 656c 662e 6865 6967 6874 2c20 4c65  (self.height, Le
+00039d30: 6e67 7468 293a 0d0a 2020 2020 2020 2020  ngth):..        
+00039d40: 2020 2020 7365 6c66 2e68 6569 6768 7420      self.height 
+00039d50: 3d20 7365 6c66 2e68 6569 6768 742e 7661  = self.height.va
+00039d60: 6c75 6528 7265 6c61 7469 7665 5f6c 656e  lue(relative_len
+00039d70: 6774 683d 6865 6967 6874 2c20 2a2a 6b77  gth=height, **kw
+00039d80: 6172 6773 290d 0a20 2020 2020 2020 2069  args)..        i
+00039d90: 6620 6973 696e 7374 616e 6365 2873 656c  f isinstance(sel
+00039da0: 662e 7278 2c20 4c65 6e67 7468 293a 0d0a  f.rx, Length):..
+00039db0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00039dc0: 2e72 7820 3d20 7365 6c66 2e72 782e 7661  .rx = self.rx.va
+00039dd0: 6c75 6528 7265 6c61 7469 7665 5f6c 656e  lue(relative_len
+00039de0: 6774 683d 7769 6474 682c 202a 2a6b 7761  gth=width, **kwa
+00039df0: 7267 7329 0d0a 2020 2020 2020 2020 6966  rgs)..        if
+00039e00: 2069 7369 6e73 7461 6e63 6528 7365 6c66   isinstance(self
+00039e10: 2e72 792c 204c 656e 6774 6829 3a0d 0a20  .ry, Length):.. 
+00039e20: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00039e30: 7279 203d 2073 656c 662e 7279 2e76 616c  ry = self.ry.val
+00039e40: 7565 2872 656c 6174 6976 655f 6c65 6e67  ue(relative_leng
+00039e50: 7468 3d68 6569 6768 742c 202a 2a6b 7761  th=height, **kwa
+00039e60: 7267 7329 0d0a 2020 2020 2020 2020 7265  rgs)..        re
+00039e70: 7475 726e 2073 656c 660d 0a0d 0a20 2020  turn self....   
+00039e80: 2064 6566 2069 735f 6465 6765 6e65 7261   def is_degenera
+00039e90: 7465 2873 656c 6629 3a0d 0a20 2020 2020  te(self):..     
+00039ea0: 2020 2072 6574 7572 6e20 280d 0a20 2020     return (..   
+00039eb0: 2020 2020 2020 2020 2073 656c 662e 7769           self.wi
+00039ec0: 6474 6820 3d3d 2030 0d0a 2020 2020 2020  dth == 0..      
+00039ed0: 2020 2020 2020 6f72 2073 656c 662e 6865        or self.he
+00039ee0: 6967 6874 203d 3d20 300d 0a20 2020 2020  ight == 0..     
+00039ef0: 2020 2020 2020 206f 7220 7365 6c66 2e77         or self.w
+00039f00: 6964 7468 2069 7320 4e6f 6e65 0d0a 2020  idth is None..  
+00039f10: 2020 2020 2020 2020 2020 6f72 2073 656c            or sel
+00039f20: 662e 6865 6967 6874 2069 7320 4e6f 6e65  f.height is None
+00039f30: 0d0a 2020 2020 2020 2020 290d 0a0d 0a0d  ..        ).....
+00039f40: 0a63 6c61 7373 205f 526f 756e 6453 6861  .class _RoundSha
+00039f50: 7065 2853 6861 7065 293a 0d0a 2020 2020  pe(Shape):..    
+00039f60: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
+00039f70: 662c 202a 6172 6773 2c20 2a2a 6b77 6172  f, *args, **kwar
+00039f80: 6773 293a 0d0a 2020 2020 2020 2020 7365  gs):..        se
+00039f90: 6c66 2e63 7820 3d20 4e6f 6e65 0d0a 2020  lf.cx = None..  
+00039fa0: 2020 2020 2020 7365 6c66 2e63 7920 3d20        self.cy = 
+00039fb0: 4e6f 6e65 0d0a 2020 2020 2020 2020 7365  None..        se
+00039fc0: 6c66 2e72 7820 3d20 4e6f 6e65 0d0a 2020  lf.rx = None..  
+00039fd0: 2020 2020 2020 7365 6c66 2e72 7920 3d20        self.ry = 
+00039fe0: 4e6f 6e65 0d0a 2020 2020 2020 2020 5368  None..        Sh
+00039ff0: 6170 652e 5f5f 696e 6974 5f5f 2873 656c  ape.__init__(sel
+0003a000: 662c 202a 6172 6773 2c20 2a2a 6b77 6172  f, *args, **kwar
+0003a010: 6773 290d 0a0d 0a20 2020 2064 6566 2070  gs)....    def p
+0003a020: 726f 7065 7274 795f 6279 5f6f 626a 6563  roperty_by_objec
+0003a030: 7428 7365 6c66 2c20 7329 3a0d 0a20 2020  t(self, s):..   
+0003a040: 2020 2020 2053 6861 7065 2e70 726f 7065       Shape.prope
+0003a050: 7274 795f 6279 5f6f 626a 6563 7428 7365  rty_by_object(se
+0003a060: 6c66 2c20 7329 0d0a 2020 2020 2020 2020  lf, s)..        
+0003a070: 7365 6c66 2e63 7820 3d20 732e 6378 0d0a  self.cx = s.cx..
+0003a080: 2020 2020 2020 2020 7365 6c66 2e63 7920          self.cy 
+0003a090: 3d20 732e 6379 0d0a 2020 2020 2020 2020  = s.cy..        
+0003a0a0: 7365 6c66 2e72 7820 3d20 732e 7278 0d0a  self.rx = s.rx..
+0003a0b0: 2020 2020 2020 2020 7365 6c66 2e72 7920          self.ry 
+0003a0c0: 3d20 732e 7279 0d0a 0d0a 2020 2020 6465  = s.ry....    de
+0003a0d0: 6620 7072 6f70 6572 7479 5f62 795f 7661  f property_by_va
+0003a0e0: 6c75 6573 2873 656c 662c 2076 616c 7565  lues(self, value
+0003a0f0: 7329 3a0d 0a20 2020 2020 2020 2053 6861  s):..        Sha
+0003a100: 7065 2e70 726f 7065 7274 795f 6279 5f76  pe.property_by_v
+0003a110: 616c 7565 7328 7365 6c66 2c20 7661 6c75  alues(self, valu
+0003a120: 6573 290d 0a20 2020 2020 2020 2073 656c  es)..        sel
+0003a130: 662e 6378 203d 204c 656e 6774 6828 7661  f.cx = Length(va
+0003a140: 6c75 6573 2e67 6574 2853 5647 5f41 5454  lues.get(SVG_ATT
+0003a150: 525f 4345 4e54 4552 5f58 2929 2e76 616c  R_CENTER_X)).val
+0003a160: 7565 2829 0d0a 2020 2020 2020 2020 7365  ue()..        se
+0003a170: 6c66 2e63 7920 3d20 4c65 6e67 7468 2876  lf.cy = Length(v
+0003a180: 616c 7565 732e 6765 7428 5356 475f 4154  alues.get(SVG_AT
+0003a190: 5452 5f43 454e 5445 525f 5929 292e 7661  TR_CENTER_Y)).va
+0003a1a0: 6c75 6528 290d 0a20 2020 2020 2020 2073  lue()..        s
+0003a1b0: 656c 662e 7278 203d 204c 656e 6774 6828  elf.rx = Length(
+0003a1c0: 7661 6c75 6573 2e67 6574 2853 5647 5f41  values.get(SVG_A
+0003a1d0: 5454 525f 5241 4449 5553 5f58 2929 2e76  TTR_RADIUS_X)).v
+0003a1e0: 616c 7565 2829 0d0a 2020 2020 2020 2020  alue()..        
+0003a1f0: 7365 6c66 2e72 7920 3d20 4c65 6e67 7468  self.ry = Length
+0003a200: 2876 616c 7565 732e 6765 7428 5356 475f  (values.get(SVG_
+0003a210: 4154 5452 5f52 4144 4955 535f 5929 292e  ATTR_RADIUS_Y)).
+0003a220: 7661 6c75 6528 290d 0a20 2020 2020 2020  value()..       
+0003a230: 2072 203d 204c 656e 6774 6828 7661 6c75   r = Length(valu
+0003a240: 6573 2e67 6574 2853 5647 5f41 5454 525f  es.get(SVG_ATTR_
+0003a250: 5241 4449 5553 2c20 4e6f 6e65 2929 2e76  RADIUS, None)).v
+0003a260: 616c 7565 2829 0d0a 2020 2020 2020 2020  alue()..        
+0003a270: 6966 2072 2069 7320 6e6f 7420 4e6f 6e65  if r is not None
+0003a280: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
+0003a290: 656c 662e 7278 203d 2072 0d0a 2020 2020  elf.rx = r..    
+0003a2a0: 2020 2020 2020 2020 7365 6c66 2e72 7920          self.ry 
+0003a2b0: 3d20 720d 0a20 2020 2020 2020 2065 6c73  = r..        els
+0003a2c0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+0003a2d0: 6966 2073 656c 662e 7278 2069 7320 4e6f  if self.rx is No
+0003a2e0: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
+0003a2f0: 2020 2020 2073 656c 662e 7278 203d 2031       self.rx = 1
+0003a300: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+0003a310: 2073 656c 662e 7279 2069 7320 4e6f 6e65   self.ry is None
+0003a320: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0003a330: 2020 2073 656c 662e 7279 203d 2031 0d0a     self.ry = 1..
+0003a340: 2020 2020 2020 2020 6365 6e74 6572 203d          center =
+0003a350: 2076 616c 7565 732e 6765 7428 2263 656e   values.get("cen
+0003a360: 7465 7222 2c20 4e6f 6e65 290d 0a20 2020  ter", None)..   
+0003a370: 2020 2020 2069 6620 6365 6e74 6572 2069       if center i
+0003a380: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
+0003a390: 2020 2020 2020 2020 2073 656c 662e 6378           self.cx
+0003a3a0: 2c20 7365 6c66 2e63 7920 3d20 506f 696e  , self.cy = Poin
+0003a3b0: 7428 6365 6e74 6572 290d 0a0d 0a20 2020  t(center)....   
+0003a3c0: 2020 2020 2069 6620 7365 6c66 2e63 7820       if self.cx 
+0003a3d0: 6973 204e 6f6e 653a 0d0a 2020 2020 2020  is None:..      
+0003a3e0: 2020 2020 2020 7365 6c66 2e63 7820 3d20        self.cx = 
+0003a3f0: 300d 0a20 2020 2020 2020 2069 6620 7365  0..        if se
+0003a400: 6c66 2e63 7920 6973 204e 6f6e 653a 0d0a  lf.cy is None:..
+0003a410: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0003a420: 2e63 7920 3d20 300d 0a0d 0a20 2020 2064  .cy = 0....    d
+0003a430: 6566 2070 726f 7065 7274 795f 6279 5f61  ef property_by_a
+0003a440: 7267 7328 7365 6c66 2c20 2a61 7267 7329  rgs(self, *args)
+0003a450: 3a0d 0a20 2020 2020 2020 2061 7267 5f6c  :..        arg_l
+0003a460: 656e 6774 6820 3d20 6c65 6e28 6172 6773  ength = len(args
+0003a470: 290d 0a20 2020 2020 2020 2069 6620 6172  )..        if ar
+0003a480: 675f 6c65 6e67 7468 203e 3d20 313a 0d0a  g_length >= 1:..
+0003a490: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0003a4a0: 2e63 7820 3d20 4c65 6e67 7468 2861 7267  .cx = Length(arg
+0003a4b0: 735b 305d 292e 7661 6c75 6528 290d 0a20  s[0]).value().. 
+0003a4c0: 2020 2020 2020 2069 6620 6172 675f 6c65         if arg_le
+0003a4d0: 6e67 7468 203e 3d20 323a 0d0a 2020 2020  ngth >= 2:..    
+0003a4e0: 2020 2020 2020 2020 7365 6c66 2e63 7920          self.cy 
+0003a4f0: 3d20 4c65 6e67 7468 2861 7267 735b 315d  = Length(args[1]
+0003a500: 292e 7661 6c75 6528 290d 0a20 2020 2020  ).value()..     
+0003a510: 2020 2069 6620 6172 675f 6c65 6e67 7468     if arg_length
+0003a520: 203e 3d20 333a 0d0a 2020 2020 2020 2020   >= 3:..        
+0003a530: 2020 2020 7365 6c66 2e72 7820 3d20 4c65      self.rx = Le
+0003a540: 6e67 7468 2861 7267 735b 325d 292e 7661  ngth(args[2]).va
+0003a550: 6c75 6528 290d 0a20 2020 2020 2020 2020  lue()..         
+0003a560: 2020 2069 6620 6172 675f 6c65 6e67 7468     if arg_length
+0003a570: 203e 3d20 343a 0d0a 2020 2020 2020 2020   >= 4:..        
+0003a580: 2020 2020 2020 2020 7365 6c66 2e72 7920          self.ry 
+0003a590: 3d20 4c65 6e67 7468 2861 7267 735b 335d  = Length(args[3]
+0003a5a0: 292e 7661 6c75 6528 290d 0a20 2020 2020  ).value()..     
+0003a5b0: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+0003a5c0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0003a5d0: 6c66 2e72 7920 3d20 7365 6c66 2e72 780d  lf.ry = self.rx.
+0003a5e0: 0a20 2020 2020 2020 2069 6620 6172 675f  .        if arg_
+0003a5f0: 6c65 6e67 7468 203e 3d20 353a 0d0a 2020  length >= 5:..  
+0003a600: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+0003a610: 696e 6974 5f73 6861 7065 282a 6172 6773  init_shape(*args
+0003a620: 5b34 3a5d 290d 0a0d 0a20 2020 2064 6566  [4:])....    def
+0003a630: 205f 6174 7472 7328 7365 6c66 2c20 7661   _attrs(self, va
+0003a640: 6c75 6573 293a 0d0a 2020 2020 2020 2020  lues):..        
+0003a650: 6966 2073 656c 662e 6378 2069 7320 6e6f  if self.cx is no
+0003a660: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
+0003a670: 2020 2020 2076 616c 7565 732e 6170 7065       values.appe
+0003a680: 6e64 2822 2573 3d25 7322 2025 2028 5356  nd("%s=%s" % (SV
+0003a690: 475f 4154 5452 5f43 454e 5445 525f 582c  G_ATTR_CENTER_X,
+0003a6a0: 204c 656e 6774 682e 7374 7228 7365 6c66   Length.str(self
+0003a6b0: 2e63 7829 2929 0d0a 2020 2020 2020 2020  .cx)))..        
+0003a6c0: 6966 2073 656c 662e 6379 2069 7320 6e6f  if self.cy is no
+0003a6d0: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
+0003a6e0: 2020 2020 2076 616c 7565 732e 6170 7065       values.appe
+0003a6f0: 6e64 2822 2573 3d25 7322 2025 2028 5356  nd("%s=%s" % (SV
+0003a700: 475f 4154 5452 5f43 454e 5445 525f 592c  G_ATTR_CENTER_Y,
+0003a710: 204c 656e 6774 682e 7374 7228 7365 6c66   Length.str(self
+0003a720: 2e63 7929 2929 0d0a 2020 2020 2020 2020  .cy)))..        
+0003a730: 6966 2073 656c 662e 7278 203d 3d20 7365  if self.rx == se
+0003a740: 6c66 2e72 7920 6f72 2073 656c 662e 7279  lf.ry or self.ry
+0003a750: 2069 7320 4e6f 6e65 3a0d 0a20 2020 2020   is None:..     
+0003a760: 2020 2020 2020 2076 616c 7565 732e 6170         values.ap
+0003a770: 7065 6e64 2822 2573 3d25 7322 2025 2028  pend("%s=%s" % (
+0003a780: 5356 475f 4154 5452 5f52 4144 4955 532c  SVG_ATTR_RADIUS,
+0003a790: 204c 656e 6774 682e 7374 7228 7365 6c66   Length.str(self
+0003a7a0: 2e72 7829 2929 0d0a 2020 2020 2020 2020  .rx)))..        
+0003a7b0: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+0003a7c0: 2020 2076 616c 7565 732e 6170 7065 6e64     values.append
+0003a7d0: 2822 2573 3d25 7322 2025 2028 5356 475f  ("%s=%s" % (SVG_
+0003a7e0: 4154 5452 5f52 4144 4955 535f 582c 204c  ATTR_RADIUS_X, L
+0003a7f0: 656e 6774 682e 7374 7228 7365 6c66 2e72  ength.str(self.r
+0003a800: 7829 2929 0d0a 2020 2020 2020 2020 2020  x)))..          
+0003a810: 2020 7661 6c75 6573 2e61 7070 656e 6428    values.append(
+0003a820: 2225 733d 2573 2220 2520 2853 5647 5f41  "%s=%s" % (SVG_A
+0003a830: 5454 525f 5241 4449 5553 5f59 2c20 4c65  TTR_RADIUS_Y, Le
+0003a840: 6e67 7468 2e73 7472 2873 656c 662e 7279  ngth.str(self.ry
+0003a850: 2929 290d 0a0d 0a20 2020 2064 6566 205f  )))....    def _
+0003a860: 5f72 6570 725f 5f28 7365 6c66 293a 0d0a  _repr__(self):..
+0003a870: 2020 2020 2020 2020 7661 6c75 6573 203d          values =
+0003a880: 205b 5d0d 0a20 2020 2020 2020 2073 656c   []..        sel
+0003a890: 662e 5f61 7474 7273 2876 616c 7565 7329  f._attrs(values)
+0003a8a0: 0d0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
+0003a8b0: 7265 7072 5f73 6861 7065 2876 616c 7565  repr_shape(value
+0003a8c0: 7329 0d0a 2020 2020 2020 2020 7061 7261  s)..        para
+0003a8d0: 6d73 203d 2022 2c20 222e 6a6f 696e 2876  ms = ", ".join(v
+0003a8e0: 616c 7565 7329 0d0a 2020 2020 2020 2020  alues)..        
+0003a8f0: 7265 7475 726e 2022 2573 2825 7329 2220  return "%s(%s)" 
+0003a900: 2520 2873 656c 662e 5f5f 636c 6173 735f  % (self.__class_
+0003a910: 5f2e 5f5f 6e61 6d65 5f5f 2c20 7061 7261  _.__name__, para
+0003a920: 6d73 290d 0a0d 0a20 2020 2064 6566 205f  ms)....    def _
+0003a930: 5f73 7472 5f5f 2873 656c 6629 3a0d 0a20  _str__(self):.. 
+0003a940: 2020 2020 2020 2076 616c 7565 7320 3d20         values = 
+0003a950: 5b5d 0d0a 2020 2020 2020 2020 7365 6c66  []..        self
+0003a960: 2e5f 6174 7472 7328 7661 6c75 6573 290d  ._attrs(values).
+0003a970: 0a20 2020 2020 2020 2073 656c 662e 5f73  .        self._s
+0003a980: 7472 5f73 6861 7065 2876 616c 7565 7329  tr_shape(values)
+0003a990: 0d0a 2020 2020 2020 2020 7061 7261 6d73  ..        params
+0003a9a0: 203d 2022 2c20 222e 6a6f 696e 2876 616c   = ", ".join(val
+0003a9b0: 7565 7329 0d0a 2020 2020 2020 2020 7265  ues)..        re
+0003a9c0: 7475 726e 2022 2573 2825 7329 2220 2520  turn "%s(%s)" % 
+0003a9d0: 2873 656c 662e 5f5f 636c 6173 735f 5f2e  (self.__class__.
+0003a9e0: 5f5f 6e61 6d65 5f5f 2c20 7061 7261 6d73  __name__, params
+0003a9f0: 290d 0a0d 0a20 2020 2040 7072 6f70 6572  )....    @proper
+0003aa00: 7479 0d0a 2020 2020 6465 6620 696d 706c  ty..    def impl
+0003aa10: 6963 6974 5f72 7828 7365 6c66 293a 0d0a  icit_rx(self):..
+0003aa20: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
+0003aa30: 656c 662e 6170 706c 793a 0d0a 2020 2020  elf.apply:..    
+0003aa40: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+0003aa50: 656c 662e 7278 0d0a 2020 2020 2020 2020  elf.rx..        
+0003aa60: 7072 7820 3d20 506f 696e 7428 7365 6c66  prx = Point(self
+0003aa70: 2e72 782c 2030 290d 0a20 2020 2020 2020  .rx, 0)..       
+0003aa80: 2070 7278 202a 3d20 7365 6c66 2e74 7261   prx *= self.tra
+0003aa90: 6e73 666f 726d 0d0a 2020 2020 2020 2020  nsform..        
+0003aaa0: 6f72 6967 696e 203d 2050 6f69 6e74 2830  origin = Point(0
+0003aab0: 2c20 3029 0d0a 2020 2020 2020 2020 6f72  , 0)..        or
+0003aac0: 6967 696e 202a 3d20 7365 6c66 2e74 7261  igin *= self.tra
+0003aad0: 6e73 666f 726d 0d0a 2020 2020 2020 2020  nsform..        
+0003aae0: 7265 7475 726e 206f 7269 6769 6e2e 6469  return origin.di
+0003aaf0: 7374 616e 6365 5f74 6f28 7072 7829 0d0a  stance_to(prx)..
+0003ab00: 0d0a 2020 2020 4070 726f 7065 7274 790d  ..    @property.
+0003ab10: 0a20 2020 2064 6566 2069 6d70 6c69 6369  .    def implici
+0003ab20: 745f 7279 2873 656c 6629 3a0d 0a20 2020  t_ry(self):..   
+0003ab30: 2020 2020 2069 6620 6e6f 7420 7365 6c66       if not self
+0003ab40: 2e61 7070 6c79 3a0d 0a20 2020 2020 2020  .apply:..       
+0003ab50: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+0003ab60: 2e72 790d 0a20 2020 2020 2020 2070 7279  .ry..        pry
+0003ab70: 203d 2050 6f69 6e74 2830 2c20 7365 6c66   = Point(0, self
+0003ab80: 2e72 7929 0d0a 2020 2020 2020 2020 7072  .ry)..        pr
+0003ab90: 7920 2a3d 2073 656c 662e 7472 616e 7366  y *= self.transf
+0003aba0: 6f72 6d0d 0a20 2020 2020 2020 206f 7269  orm..        ori
+0003abb0: 6769 6e20 3d20 506f 696e 7428 302c 2030  gin = Point(0, 0
+0003abc0: 290d 0a20 2020 2020 2020 206f 7269 6769  )..        origi
+0003abd0: 6e20 2a3d 2073 656c 662e 7472 616e 7366  n *= self.transf
+0003abe0: 6f72 6d0d 0a20 2020 2020 2020 2072 6574  orm..        ret
+0003abf0: 7572 6e20 6f72 6967 696e 2e64 6973 7461  urn origin.dista
+0003ac00: 6e63 655f 746f 2870 7279 290d 0a0d 0a20  nce_to(pry).... 
+0003ac10: 2020 2069 6d70 6c69 6369 745f 7220 3d20     implicit_r = 
+0003ac20: 696d 706c 6963 6974 5f72 780d 0a0d 0a20  implicit_rx.... 
+0003ac30: 2020 2040 7072 6f70 6572 7479 0d0a 2020     @property..  
+0003ac40: 2020 6465 6620 696d 706c 6963 6974 5f63    def implicit_c
+0003ac50: 656e 7465 7228 7365 6c66 293a 0d0a 2020  enter(self):..  
+0003ac60: 2020 2020 2020 6365 6e74 6572 203d 2050        center = P
+0003ac70: 6f69 6e74 2873 656c 662e 6378 2c20 7365  oint(self.cx, se
+0003ac80: 6c66 2e63 7929 0d0a 2020 2020 2020 2020  lf.cy)..        
+0003ac90: 6966 206e 6f74 2073 656c 662e 6170 706c  if not self.appl
+0003aca0: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
+0003acb0: 7265 7475 726e 2063 656e 7465 720d 0a20  return center.. 
+0003acc0: 2020 2020 2020 2063 656e 7465 7220 2a3d         center *=
+0003acd0: 2073 656c 662e 7472 616e 7366 6f72 6d0d   self.transform.
+0003ace0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0003acf0: 6365 6e74 6572 0d0a 0d0a 2020 2020 6465  center....    de
+0003ad00: 6620 7365 676d 656e 7473 2873 656c 662c  f segments(self,
+0003ad10: 2074 7261 6e73 666f 726d 6564 3d54 7275   transformed=Tru
+0003ad20: 6529 3a0d 0a20 2020 2020 2020 2022 2222  e):..        """
+0003ad30: 0d0a 2020 2020 2020 2020 5356 4720 7061  ..        SVG pa
+0003ad40: 7468 2064 6563 6f6d 706f 7369 7469 6f6e  th decomposition
+0003ad50: 2069 7320 6769 7665 6e20 696e 2053 5647   is given in SVG
+0003ad60: 2032 2e30 2031 302e 332c 2031 302e 342e   2.0 10.3, 10.4.
+0003ad70: 0d0a 0d0a 2020 2020 2020 2020 4120 6d6f  ....        A mo
+0003ad80: 7665 2d74 6f20 636f 6d6d 616e 6420 746f  ve-to command to
+0003ad90: 2074 6865 2070 6f69 6e74 2063 782b 7278   the point cx+rx
+0003ada0: 2c63 793b 0d0a 2020 2020 2020 2020 6172  ,cy;..        ar
+0003adb0: 6320 746f 2063 782c 6379 2b72 793b 0d0a  c to cx,cy+ry;..
+0003adc0: 2020 2020 2020 2020 6172 6320 746f 2063          arc to c
+0003add0: 782d 7278 2c63 793b 0d0a 2020 2020 2020  x-rx,cy;..      
+0003ade0: 2020 6172 6320 746f 2063 782c 6379 2d72    arc to cx,cy-r
+0003adf0: 793b 0d0a 2020 2020 2020 2020 6172 6320  y;..        arc 
+0003ae00: 7769 7468 2061 2073 6567 6d65 6e74 2d63  with a segment-c
+0003ae10: 6f6d 706c 6574 696e 6720 636c 6f73 6520  ompleting close 
+0003ae20: 7061 7468 206f 7065 7261 7469 6f6e 2e0d  path operation..
+0003ae30: 0a0d 0a20 2020 2020 2020 2043 6f6e 7665  ...        Conve
+0003ae40: 7274 7320 7468 6520 7061 7261 6d65 7465  rts the paramete
+0003ae50: 7273 2066 726f 6d20 616e 2065 6c6c 6970  rs from an ellip
+0003ae60: 7365 206f 7220 6120 6369 7263 6c65 2074  se or a circle t
+0003ae70: 6f20 6120 7374 7269 6e67 2066 6f72 2061  o a string for a
+0003ae80: 0d0a 2020 2020 2020 2020 5061 7468 206f  ..        Path o
+0003ae90: 626a 6563 7420 642d 6174 7472 6962 7574  bject d-attribut
+0003aea0: 6522 2222 0d0a 2020 2020 2020 2020 6f72  e"""..        or
+0003aeb0: 6967 696e 616c 203d 2073 656c 662e 6170  iginal = self.ap
+0003aec0: 706c 790d 0a20 2020 2020 2020 2073 656c  ply..        sel
+0003aed0: 662e 6170 706c 7920 3d20 7472 616e 7366  f.apply = transf
+0003aee0: 6f72 6d65 640d 0a20 2020 2020 2020 2070  ormed..        p
+0003aef0: 6174 6820 3d20 5061 7468 2829 0d0a 2020  ath = Path()..  
+0003af00: 2020 2020 2020 7374 6570 7320 3d20 340d        steps = 4.
+0003af10: 0a20 2020 2020 2020 2073 7465 705f 7369  .        step_si
+0003af20: 7a65 203d 2074 6175 202f 2073 7465 7073  ze = tau / steps
+0003af30: 0d0a 2020 2020 2020 2020 6966 2028 0d0a  ..        if (..
+0003af40: 2020 2020 2020 2020 2020 2020 7472 616e              tran
+0003af50: 7366 6f72 6d65 640d 0a20 2020 2020 2020  sformed..       
+0003af60: 2020 2020 2061 6e64 2073 656c 662e 7472       and self.tr
+0003af70: 616e 7366 6f72 6d2e 7661 6c75 655f 7363  ansform.value_sc
+0003af80: 616c 655f 7828 2920 2a20 7365 6c66 2e74  ale_x() * self.t
+0003af90: 7261 6e73 666f 726d 2e76 616c 7565 5f73  ransform.value_s
+0003afa0: 6361 6c65 5f79 2829 203c 2030 0d0a 2020  cale_y() < 0..  
+0003afb0: 2020 2020 2020 293a 0d0a 2020 2020 2020        ):..      
+0003afc0: 2020 2020 2020 7374 6570 5f73 697a 6520        step_size 
+0003afd0: 3d20 2d73 7465 705f 7369 7a65 0d0a 2020  = -step_size..  
+0003afe0: 2020 2020 2020 745f 7374 6172 7420 3d20        t_start = 
+0003aff0: 300d 0a20 2020 2020 2020 2074 5f65 6e64  0..        t_end
+0003b000: 203d 2073 7465 705f 7369 7a65 0d0a 2020   = step_size..  
+0003b010: 2020 2020 2020 2320 7a65 726f 2066 6f72        # zero for
+0003b020: 2065 6974 6865 7220 6469 6d65 6e73 696f   either dimensio
+0003b030: 6e2c 206f 7220 6120 636f 6d70 7574 6564  n, or a computed
+0003b040: 2076 616c 7565 206f 6620 6175 746f 2066   value of auto f
+0003b050: 6f72 2062 6f74 6820 6469 6d65 6e73 696f  or both dimensio
+0003b060: 6e73 2c20 6469 7361 626c 6573 2072 656e  ns, disables ren
+0003b070: 6465 7269 6e67 206f 6620 7468 6520 656c  dering of the el
+0003b080: 656d 656e 742e 0d0a 2020 2020 2020 2020  ement...        
+0003b090: 7278 203d 2073 656c 662e 696d 706c 6963  rx = self.implic
+0003b0a0: 6974 5f72 780d 0a20 2020 2020 2020 2072  it_rx..        r
+0003b0b0: 7920 3d20 7365 6c66 2e69 6d70 6c69 6369  y = self.implici
+0003b0c0: 745f 7279 0d0a 2020 2020 2020 2020 6966  t_ry..        if
+0003b0d0: 2073 656c 662e 6973 5f64 6567 656e 6572   self.is_degener
+0003b0e0: 6174 6528 293a 0d0a 2020 2020 2020 2020  ate():..        
+0003b0f0: 2020 2020 7265 7475 726e 2028 290d 0a20      return ().. 
+0003b100: 2020 2020 2020 2063 656e 7465 7220 3d20         center = 
+0003b110: 7365 6c66 2e69 6d70 6c69 6369 745f 6365  self.implicit_ce
+0003b120: 6e74 6572 0d0a 2020 2020 2020 2020 7061  nter..        pa
+0003b130: 7468 2e6d 6f76 6528 2873 656c 662e 706f  th.move((self.po
+0003b140: 696e 745f 6174 5f74 2830 2929 290d 0a20  int_at_t(0))).. 
+0003b150: 2020 2020 2020 2066 6f72 2069 2069 6e20         for i in 
+0003b160: 7261 6e67 6528 7374 6570 7329 3a0d 0a20  range(steps):.. 
+0003b170: 2020 2020 2020 2020 2020 2070 6174 6820             path 
+0003b180: 2b3d 2041 7263 280d 0a20 2020 2020 2020  += Arc(..       
+0003b190: 2020 2020 2020 2020 2073 656c 662e 706f           self.po
+0003b1a0: 696e 745f 6174 5f74 2874 5f73 7461 7274  int_at_t(t_start
+0003b1b0: 292c 0d0a 2020 2020 2020 2020 2020 2020  ),..            
+0003b1c0: 2020 2020 7365 6c66 2e70 6f69 6e74 5f61      self.point_a
+0003b1d0: 745f 7428 745f 656e 6429 2c0d 0a20 2020  t_t(t_end),..   
+0003b1e0: 2020 2020 2020 2020 2020 2020 2063 656e               cen
+0003b1f0: 7465 722c 0d0a 2020 2020 2020 2020 2020  ter,..          
+0003b200: 2020 2020 2020 7278 3d72 782c 0d0a 2020        rx=rx,..  
+0003b210: 2020 2020 2020 2020 2020 2020 2020 7279                ry
+0003b220: 3d72 792c 0d0a 2020 2020 2020 2020 2020  =ry,..          
+0003b230: 2020 2020 2020 726f 7461 7469 6f6e 3d73        rotation=s
+0003b240: 656c 662e 726f 7461 7469 6f6e 2c0d 0a20  elf.rotation,.. 
+0003b250: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0003b260: 7765 6570 3d73 7465 705f 7369 7a65 2c0d  weep=step_size,.
+0003b270: 0a20 2020 2020 2020 2020 2020 2029 0d0a  .            )..
+0003b280: 2020 2020 2020 2020 2020 2020 745f 7374              t_st
+0003b290: 6172 7420 3d20 745f 656e 640d 0a20 2020  art = t_end..   
+0003b2a0: 2020 2020 2020 2020 2074 5f65 6e64 202b           t_end +
+0003b2b0: 3d20 7374 6570 5f73 697a 650d 0a20 2020  = step_size..   
+0003b2c0: 2020 2020 2070 6174 682e 636c 6f73 6564       path.closed
+0003b2d0: 2829 0d0a 2020 2020 2020 2020 7365 6c66  ()..        self
+0003b2e0: 2e61 7070 6c79 203d 206f 7269 6769 6e61  .apply = origina
+0003b2f0: 6c0d 0a20 2020 2020 2020 2072 6574 7572  l..        retur
+0003b300: 6e20 7061 7468 2e73 6567 6d65 6e74 7328  n path.segments(
+0003b310: 7472 616e 7366 6f72 6d65 6429 0d0a 0d0a  transformed)....
+0003b320: 2020 2020 6465 6620 7265 6966 7928 7365      def reify(se
+0003b330: 6c66 293a 0d0a 2020 2020 2020 2020 2222  lf):..        ""
+0003b340: 220d 0a20 2020 2020 2020 2052 6561 6c69  "..        Reali
+0003b350: 7a65 7320 7468 6520 7472 616e 7366 6f72  zes the transfor
+0003b360: 6d20 746f 2074 6865 2073 6861 7065 2070  m to the shape p
+0003b370: 726f 7065 7274 6965 732e 0d0a 0d0a 2020  roperties.....  
+0003b380: 2020 2020 2020 536b 6577 6564 2061 6e64        Skewed and
+0003b390: 2052 6f74 6174 6564 2072 6f75 6e64 7368   Rotated roundsh
+0003b3a0: 6170 6573 2063 616e 6e6f 7420 6265 2072  apes cannot be r
+0003b3b0: 6569 6669 6564 2e0d 0a20 2020 2020 2020  eified...       
+0003b3c0: 2022 2222 0d0a 2020 2020 2020 2020 7363   """..        sc
+0003b3d0: 616c 655f 7820 3d20 7365 6c66 2e74 7261  ale_x = self.tra
+0003b3e0: 6e73 666f 726d 2e76 616c 7565 5f73 6361  nsform.value_sca
+0003b3f0: 6c65 5f78 2829 0d0a 2020 2020 2020 2020  le_x()..        
+0003b400: 7363 616c 655f 7920 3d20 7365 6c66 2e74  scale_y = self.t
+0003b410: 7261 6e73 666f 726d 2e76 616c 7565 5f73  ransform.value_s
+0003b420: 6361 6c65 5f79 2829 0d0a 2020 2020 2020  cale_y()..      
+0003b430: 2020 6966 2073 6361 6c65 5f79 202a 2073    if scale_y * s
+0003b440: 6361 6c65 5f78 203c 2030 3a0d 0a20 2020  cale_x < 0:..   
+0003b450: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0003b460: 7365 6c66 2020 2320 4e6f 2072 6569 6669  self  # No reifi
+0003b470: 6361 7469 6f6e 206f 6620 666c 6970 7065  cation of flippe
+0003b480: 6420 7661 6c75 6573 2e0d 0a20 2020 2020  d values...     
+0003b490: 2020 2074 7261 6e73 6c61 7465 5f78 203d     translate_x =
+0003b4a0: 2073 656c 662e 7472 616e 7366 6f72 6d2e   self.transform.
+0003b4b0: 7661 6c75 655f 7472 616e 735f 7828 290d  value_trans_x().
+0003b4c0: 0a20 2020 2020 2020 2074 7261 6e73 6c61  .        transla
+0003b4d0: 7465 5f79 203d 2073 656c 662e 7472 616e  te_y = self.tran
+0003b4e0: 7366 6f72 6d2e 7661 6c75 655f 7472 616e  sform.value_tran
+0003b4f0: 735f 7928 290d 0a20 2020 2020 2020 2069  s_y()..        i
+0003b500: 6620 280d 0a20 2020 2020 2020 2020 2020  f (..           
+0003b510: 2073 656c 662e 7472 616e 7366 6f72 6d2e   self.transform.
+0003b520: 7661 6c75 655f 736b 6577 5f78 2829 203d  value_skew_x() =
+0003b530: 3d20 300d 0a20 2020 2020 2020 2020 2020  = 0..           
+0003b540: 2061 6e64 2073 656c 662e 7472 616e 7366   and self.transf
+0003b550: 6f72 6d2e 7661 6c75 655f 736b 6577 5f79  orm.value_skew_y
+0003b560: 2829 203d 3d20 300d 0a20 2020 2020 2020  () == 0..       
+0003b570: 2020 2020 2061 6e64 2073 6361 6c65 5f78       and scale_x
+0003b580: 2021 3d20 300d 0a20 2020 2020 2020 2020   != 0..         
+0003b590: 2020 2061 6e64 2073 6361 6c65 5f79 2021     and scale_y !
+0003b5a0: 3d20 300d 0a20 2020 2020 2020 2029 3a0d  = 0..        ):.
+0003b5b0: 0a20 2020 2020 2020 2020 2020 2047 7261  .            Gra
+0003b5c0: 7068 6963 4f62 6a65 6374 2e72 6569 6679  phicObject.reify
+0003b5d0: 2873 656c 6629 0d0a 2020 2020 2020 2020  (self)..        
+0003b5e0: 2020 2020 5472 616e 7366 6f72 6d61 626c      Transformabl
+0003b5f0: 652e 7265 6966 7928 7365 6c66 290d 0a20  e.reify(self).. 
+0003b600: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0003b610: 6378 202a 3d20 7363 616c 655f 780d 0a20  cx *= scale_x.. 
+0003b620: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0003b630: 6379 202a 3d20 7363 616c 655f 790d 0a20  cy *= scale_y.. 
+0003b640: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0003b650: 6378 202b 3d20 7472 616e 736c 6174 655f  cx += translate_
+0003b660: 780d 0a20 2020 2020 2020 2020 2020 2073  x..            s
+0003b670: 656c 662e 6379 202b 3d20 7472 616e 736c  elf.cy += transl
+0003b680: 6174 655f 790d 0a20 2020 2020 2020 2020  ate_y..         
+0003b690: 2020 2073 656c 662e 7472 616e 7366 6f72     self.transfor
+0003b6a0: 6d20 2a3d 204d 6174 7269 782e 7472 616e  m *= Matrix.tran
+0003b6b0: 736c 6174 6528 2d74 7261 6e73 6c61 7465  slate(-translate
+0003b6c0: 5f78 2c20 2d74 7261 6e73 6c61 7465 5f79  _x, -translate_y
+0003b6d0: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
+0003b6e0: 656c 662e 7278 203d 2073 6361 6c65 5f78  elf.rx = scale_x
+0003b6f0: 202a 2073 656c 662e 7278 0d0a 2020 2020   * self.rx..    
+0003b700: 2020 2020 2020 2020 7365 6c66 2e72 7920          self.ry 
+0003b710: 3d20 7363 616c 655f 7920 2a20 7365 6c66  = scale_y * self
+0003b720: 2e72 790d 0a20 2020 2020 2020 2020 2020  .ry..           
+0003b730: 2073 656c 662e 7472 616e 7366 6f72 6d20   self.transform 
+0003b740: 2a3d 204d 6174 7269 782e 7363 616c 6528  *= Matrix.scale(
+0003b750: 312e 3020 2f20 7363 616c 655f 782c 2031  1.0 / scale_x, 1
+0003b760: 2e30 202f 2073 6361 6c65 5f79 290d 0a20  .0 / scale_y).. 
+0003b770: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+0003b780: 6c66 0d0a 0d0a 2020 2020 6465 6620 7265  lf....    def re
+0003b790: 6e64 6572 2873 656c 662c 202a 2a6b 7761  nder(self, **kwa
+0003b7a0: 7267 7329 3a0d 0a20 2020 2020 2020 2053  rgs):..        S
+0003b7b0: 6861 7065 2e72 656e 6465 7228 7365 6c66  hape.render(self
+0003b7c0: 2c20 2a2a 6b77 6172 6773 290d 0a20 2020  , **kwargs)..   
+0003b7d0: 2020 2020 2077 6964 7468 203d 206b 7761       width = kwa
+0003b7e0: 7267 732e 6765 7428 2277 6964 7468 222c  rgs.get("width",
+0003b7f0: 206b 7761 7267 732e 6765 7428 2272 656c   kwargs.get("rel
+0003b800: 6174 6976 655f 6c65 6e67 7468 2229 290d  ative_length")).
+0003b810: 0a20 2020 2020 2020 2068 6569 6768 7420  .        height 
+0003b820: 3d20 6b77 6172 6773 2e67 6574 2822 6865  = kwargs.get("he
+0003b830: 6967 6874 222c 206b 7761 7267 732e 6765  ight", kwargs.ge
+0003b840: 7428 2272 656c 6174 6976 655f 6c65 6e67  t("relative_leng
+0003b850: 7468 2229 290d 0a20 2020 2020 2020 2074  th"))..        t
+0003b860: 7279 3a0d 0a20 2020 2020 2020 2020 2020  ry:..           
+0003b870: 2064 656c 206b 7761 7267 735b 2272 656c   del kwargs["rel
+0003b880: 6174 6976 655f 6c65 6e67 7468 225d 0d0a  ative_length"]..
+0003b890: 2020 2020 2020 2020 6578 6365 7074 204b          except K
+0003b8a0: 6579 4572 726f 723a 0d0a 2020 2020 2020  eyError:..      
+0003b8b0: 2020 2020 2020 7061 7373 0d0a 2020 2020        pass..    
+0003b8c0: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+0003b8d0: 6528 7365 6c66 2e63 782c 204c 656e 6774  e(self.cx, Lengt
+0003b8e0: 6829 3a0d 0a20 2020 2020 2020 2020 2020  h):..           
+0003b8f0: 2073 656c 662e 6378 203d 2073 656c 662e   self.cx = self.
+0003b900: 6378 2e76 616c 7565 2872 656c 6174 6976  cx.value(relativ
+0003b910: 655f 6c65 6e67 7468 3d77 6964 7468 2c20  e_length=width, 
+0003b920: 2a2a 6b77 6172 6773 290d 0a20 2020 2020  **kwargs)..     
+0003b930: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+0003b940: 2873 656c 662e 6379 2c20 4c65 6e67 7468  (self.cy, Length
+0003b950: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+0003b960: 7365 6c66 2e63 7920 3d20 7365 6c66 2e63  self.cy = self.c
+0003b970: 792e 7661 6c75 6528 7265 6c61 7469 7665  y.value(relative
+0003b980: 5f6c 656e 6774 683d 6865 6967 6874 2c20  _length=height, 
+0003b990: 2a2a 6b77 6172 6773 290d 0a20 2020 2020  **kwargs)..     
+0003b9a0: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+0003b9b0: 2873 656c 662e 7278 2c20 4c65 6e67 7468  (self.rx, Length
+0003b9c0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+0003b9d0: 7365 6c66 2e72 7820 3d20 7365 6c66 2e72  self.rx = self.r
+0003b9e0: 782e 7661 6c75 6528 7265 6c61 7469 7665  x.value(relative
+0003b9f0: 5f6c 656e 6774 683d 7769 6474 682c 202a  _length=width, *
+0003ba00: 2a6b 7761 7267 7329 0d0a 2020 2020 2020  *kwargs)..      
+0003ba10: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+0003ba20: 7365 6c66 2e72 792c 204c 656e 6774 6829  self.ry, Length)
+0003ba30: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
+0003ba40: 656c 662e 7279 203d 2073 656c 662e 7279  elf.ry = self.ry
+0003ba50: 2e76 616c 7565 2872 656c 6174 6976 655f  .value(relative_
+0003ba60: 6c65 6e67 7468 3d68 6569 6768 742c 202a  length=height, *
+0003ba70: 2a6b 7761 7267 7329 0d0a 2020 2020 2020  *kwargs)..      
+0003ba80: 2020 7265 7475 726e 2073 656c 660d 0a0d    return self...
+0003ba90: 0a20 2020 2064 6566 2069 735f 6465 6765  .    def is_dege
+0003baa0: 6e65 7261 7465 2873 656c 6629 3a0d 0a20  nerate(self):.. 
+0003bab0: 2020 2020 2020 2072 7820 3d20 7365 6c66         rx = self
+0003bac0: 2e69 6d70 6c69 6369 745f 7278 0d0a 2020  .implicit_rx..  
+0003bad0: 2020 2020 2020 7279 203d 2073 656c 662e        ry = self.
+0003bae0: 696d 706c 6963 6974 5f72 790d 0a20 2020  implicit_ry..   
+0003baf0: 2020 2020 2072 6574 7572 6e20 7278 203d       return rx =
+0003bb00: 3d20 3020 6f72 2072 7920 3d3d 2030 0d0a  = 0 or ry == 0..
+0003bb10: 0d0a 2020 2020 6465 6620 756e 6974 5f6d  ..    def unit_m
+0003bb20: 6174 7269 7828 7365 6c66 293a 0d0a 2020  atrix(self):..  
+0003bb30: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
+0003bb40: 2020 2072 6574 7572 6e20 7468 6520 756e     return the un
+0003bb50: 6974 206d 6174 7269 7820 7768 6963 6820  it matrix which 
+0003bb60: 636f 756c 6420 776f 756c 6420 7472 616e  could would tran
+0003bb70: 7366 6f72 6d20 7468 6520 756e 6974 2063  sform the unit c
+0003bb80: 6972 636c 6520 696e 746f 2074 6869 7320  ircle into this 
+0003bb90: 656c 6c69 7073 652e 0d0a 0d0a 2020 2020  ellipse.....    
+0003bba0: 2020 2020 4f6e 6520 6f66 2074 6865 2076      One of the v
+0003bbb0: 616c 6964 2070 6172 616d 6574 6572 697a  alid parameteriz
+0003bbc0: 6174 696f 6e73 2066 6f72 2065 6c6c 6970  ations for ellip
+0003bbd0: 7365 7320 6973 2074 6861 7420 7468 6579  ses is that they
+0003bbe0: 2061 7265 2061 6c6c 2061 6666 696e 6520   are all affine 
+0003bbf0: 7472 616e 7366 6f72 6d73 206f 6620 7468  transforms of th
+0003bc00: 6520 756e 6974 2063 6972 636c 652e 0d0a  e unit circle...
+0003bc10: 2020 2020 2020 2020 5468 6973 2070 726f          This pro
+0003bc20: 7669 6465 7320 6578 6163 746c 7920 7375  vides exactly su
+0003bc30: 6368 2061 206d 6174 7269 782e 0d0a 0d0a  ch a matrix.....
+0003bc40: 2020 2020 2020 2020 3a72 6574 7572 6e3a          :return:
+0003bc50: 206d 6174 7269 780d 0a20 2020 2020 2020   matrix..       
+0003bc60: 2022 2222 0d0a 2020 2020 2020 2020 6d20   """..        m 
+0003bc70: 3d20 4d61 7472 6978 2829 0d0a 2020 2020  = Matrix()..    
+0003bc80: 2020 2020 6d2e 706f 7374 5f73 6361 6c65      m.post_scale
+0003bc90: 2873 656c 662e 696d 706c 6963 6974 5f72  (self.implicit_r
+0003bca0: 782c 2073 656c 662e 696d 706c 6963 6974  x, self.implicit
+0003bcb0: 5f72 7929 0d0a 2020 2020 2020 2020 6d2e  _ry)..        m.
+0003bcc0: 706f 7374 5f72 6f74 6174 6528 7365 6c66  post_rotate(self
+0003bcd0: 2e72 6f74 6174 696f 6e29 0d0a 2020 2020  .rotation)..    
+0003bce0: 2020 2020 6365 6e74 6572 203d 2073 656c      center = sel
+0003bcf0: 662e 696d 706c 6963 6974 5f63 656e 7465  f.implicit_cente
+0003bd00: 720d 0a20 2020 2020 2020 206d 2e70 6f73  r..        m.pos
+0003bd10: 745f 7472 616e 736c 6174 6528 6365 6e74  t_translate(cent
+0003bd20: 6572 2e78 2c20 6365 6e74 6572 2e79 290d  er.x, center.y).
+0003bd30: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0003bd40: 6d0d 0a0d 0a20 2020 2064 6566 2061 7263  m....    def arc
+0003bd50: 5f74 2873 656c 662c 2074 302c 2074 3129  _t(self, t0, t1)
+0003bd60: 3a0d 0a20 2020 2020 2020 2022 2222 0d0a  :..        """..
+0003bd70: 2020 2020 2020 2020 7265 7475 726e 2074          return t
+0003bd80: 6865 2061 7263 2066 6f75 6e64 2062 6574  he arc found bet
+0003bd90: 7765 656e 2074 6865 2067 6976 656e 2076  ween the given v
+0003bda0: 616c 7565 7320 6f66 2074 206f 6e20 7468  alues of t on th
+0003bdb0: 6520 656c 6c69 7073 652e 0d0a 0d0a 2020  e ellipse.....  
+0003bdc0: 2020 2020 2020 3a70 6172 616d 2074 303a        :param t0:
+0003bdd0: 2074 2073 7461 7274 0d0a 2020 2020 2020   t start..      
+0003bde0: 2020 3a70 6172 616d 2074 313a 2074 2065    :param t1: t e
+0003bdf0: 6e64 0d0a 2020 2020 2020 2020 3a72 6574  nd..        :ret
+0003be00: 7572 6e3a 2061 7263 0d0a 2020 2020 2020  urn: arc..      
+0003be10: 2020 2222 220d 0a20 2020 2020 2020 2072    """..        r
+0003be20: 6574 7572 6e20 4172 6328 0d0a 2020 2020  eturn Arc(..    
+0003be30: 2020 2020 2020 2020 7365 6c66 2e70 6f69          self.poi
+0003be40: 6e74 5f61 745f 7428 7430 292c 0d0a 2020  nt_at_t(t0),..  
+0003be50: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+0003be60: 6f69 6e74 5f61 745f 7428 7431 292c 0d0a  oint_at_t(t1),..
+0003be70: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0003be80: 2e69 6d70 6c69 6369 745f 6365 6e74 6572  .implicit_center
+0003be90: 2c0d 0a20 2020 2020 2020 2020 2020 2072  ,..            r
+0003bea0: 783d 7365 6c66 2e69 6d70 6c69 6369 745f  x=self.implicit_
+0003beb0: 7278 2c0d 0a20 2020 2020 2020 2020 2020  rx,..           
+0003bec0: 2072 793d 7365 6c66 2e69 6d70 6c69 6369   ry=self.implici
+0003bed0: 745f 7279 2c0d 0a20 2020 2020 2020 2020  t_ry,..         
+0003bee0: 2020 2072 6f74 6174 696f 6e3d 7365 6c66     rotation=self
+0003bef0: 2e72 6f74 6174 696f 6e2c 0d0a 2020 2020  .rotation,..    
+0003bf00: 2020 2020 2020 2020 7377 6565 703d 7431          sweep=t1
+0003bf10: 202d 2074 302c 0d0a 2020 2020 2020 2020   - t0,..        
+0003bf20: 290d 0a0d 0a20 2020 2064 6566 2061 7263  )....    def arc
+0003bf30: 5f61 6e67 6c65 2873 656c 662c 2061 302c  _angle(self, a0,
+0003bf40: 2061 312c 2063 6377 3d4e 6f6e 6529 3a0d   a1, ccw=None):.
+0003bf50: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
+0003bf60: 2020 2020 2020 7265 7475 726e 2074 6865        return the
+0003bf70: 2061 7263 2066 6f75 6e64 2062 6574 7765   arc found betwe
+0003bf80: 656e 2074 6865 2067 6976 656e 2061 6e67  en the given ang
+0003bf90: 6c65 7320 6f6e 2074 6865 2065 6c6c 6970  les on the ellip
+0003bfa0: 7365 2e0d 0a0d 0a20 2020 2020 2020 203a  se.....        :
+0003bfb0: 7061 7261 6d20 6130 3a20 7374 6172 7420  param a0: start 
+0003bfc0: 616e 676c 650d 0a20 2020 2020 2020 203a  angle..        :
+0003bfd0: 7061 7261 6d20 6131 3a20 656e 6420 616e  param a1: end an
+0003bfe0: 676c 650d 0a20 2020 2020 2020 203a 7061  gle..        :pa
+0003bff0: 7261 6d20 6363 773a 206f 7074 696f 6e61  ram ccw: optiona
+0003c000: 6c20 666c 6167 2074 6f20 666f 7263 6520  l flag to force 
+0003c010: 636c 6f63 6b77 6973 6520 6f72 2063 6f75  clockwise or cou
+0003c020: 6e74 6572 2d63 6c6f 636b 7769 7365 2061  nter-clockwise a
+0003c030: 7263 2d61 6e67 6c65 732c 2064 6566 6175  rc-angles, defau
+0003c040: 6c74 2069 7320 736d 616c 6c65 7220 616e  lt is smaller an
+0003c050: 676c 650d 0a20 2020 2020 2020 203a 7265  gle..        :re
+0003c060: 7475 726e 3a20 6172 630d 0a20 2020 2020  turn: arc..     
+0003c070: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
+0003c080: 6966 2063 6377 2069 7320 4e6f 6e65 3a0d  if ccw is None:.
+0003c090: 0a20 2020 2020 2020 2020 2020 2063 6377  .            ccw
+0003c0a0: 203d 2061 3020 3e20 6131 0d0a 2020 2020   = a0 > a1..    
+0003c0b0: 2020 2020 7265 7475 726e 2041 7263 280d      return Arc(.
+0003c0c0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0003c0d0: 662e 706f 696e 745f 6174 5f61 6e67 6c65  f.point_at_angle
+0003c0e0: 2861 3029 2c0d 0a20 2020 2020 2020 2020  (a0),..         
+0003c0f0: 2020 2073 656c 662e 706f 696e 745f 6174     self.point_at
+0003c100: 5f61 6e67 6c65 2861 3129 2c0d 0a20 2020  _angle(a1),..   
+0003c110: 2020 2020 2020 2020 2073 656c 662e 696d           self.im
+0003c120: 706c 6963 6974 5f63 656e 7465 722c 0d0a  plicit_center,..
+0003c130: 2020 2020 2020 2020 2020 2020 7278 3d73              rx=s
+0003c140: 656c 662e 696d 706c 6963 6974 5f72 782c  elf.implicit_rx,
+0003c150: 0d0a 2020 2020 2020 2020 2020 2020 7279  ..            ry
+0003c160: 3d73 656c 662e 696d 706c 6963 6974 5f72  =self.implicit_r
+0003c170: 792c 0d0a 2020 2020 2020 2020 2020 2020  y,..            
+0003c180: 726f 7461 7469 6f6e 3d73 656c 662e 726f  rotation=self.ro
+0003c190: 7461 7469 6f6e 2c0d 0a20 2020 2020 2020  tation,..       
+0003c1a0: 2020 2020 2063 6377 3d63 6377 2c0d 0a20       ccw=ccw,.. 
+0003c1b0: 2020 2020 2020 2029 0d0a 0d0a 2020 2020         )....    
+0003c1c0: 6465 6620 706f 696e 745f 6174 5f61 6e67  def point_at_ang
+0003c1d0: 6c65 2873 656c 662c 2061 6e67 6c65 293a  le(self, angle):
+0003c1e0: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
+0003c1f0: 2020 2020 2020 2066 696e 6420 7468 6520         find the 
+0003c200: 706f 696e 7420 6f6e 2074 6865 2065 6c6c  point on the ell
+0003c210: 6970 7365 2066 726f 6d20 7468 6520 6365  ipse from the ce
+0003c220: 6e74 6572 2061 7420 7468 6520 6769 7665  nter at the give
+0003c230: 6e20 616e 676c 652e 0d0a 2020 2020 2020  n angle...      
+0003c240: 2020 4e6f 7465 3a20 466f 7220 6e6f 6e2d    Note: For non-
+0003c250: 6369 7263 756c 6172 2061 7263 7320 7468  circular arcs th
+0003c260: 6973 2069 7320 6469 6666 6572 656e 7420  is is different 
+0003c270: 7468 616e 2070 6f69 6e74 2874 292e 0d0a  than point(t)...
+0003c280: 0d0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+0003c290: 2061 6e67 6c65 3a20 616e 676c 6520 6672   angle: angle fr
+0003c2a0: 6f6d 2063 656e 7465 7220 746f 2066 696e  om center to fin
+0003c2b0: 6420 706f 696e 740d 0a20 2020 2020 2020  d point..       
+0003c2c0: 203a 7265 7475 726e 3a20 706f 696e 7420   :return: point 
+0003c2d0: 666f 756e 640d 0a20 2020 2020 2020 2022  found..        "
+0003c2e0: 2222 0d0a 2020 2020 2020 2020 6120 3d20  ""..        a = 
+0003c2f0: 7365 6c66 2e69 6d70 6c69 6369 745f 7278  self.implicit_rx
+0003c300: 0d0a 2020 2020 2020 2020 6220 3d20 7365  ..        b = se
+0003c310: 6c66 2e69 6d70 6c69 6369 745f 7279 0d0a  lf.implicit_ry..
+0003c320: 2020 2020 2020 2020 6966 2061 203d 3d20          if a == 
+0003c330: 623a 0d0a 2020 2020 2020 2020 2020 2020  b:..            
+0003c340: 7265 7475 726e 2073 656c 662e 706f 696e  return self.poin
+0003c350: 745f 6174 5f74 2861 6e67 6c65 290d 0a20  t_at_t(angle).. 
+0003c360: 2020 2020 2020 2061 6e67 6c65 202d 3d20         angle -= 
+0003c370: 7365 6c66 2e72 6f74 6174 696f 6e0d 0a20  self.rotation.. 
+0003c380: 2020 2020 2020 2074 203d 2061 7461 6e32         t = atan2
+0003c390: 2861 202a 2074 616e 2861 6e67 6c65 292c  (a * tan(angle),
+0003c3a0: 2062 290d 0a20 2020 2020 2020 2074 6175   b)..        tau
+0003c3b0: 5f31 5f34 203d 2074 6175 202f 2034 2e30  _1_4 = tau / 4.0
+0003c3c0: 0d0a 2020 2020 2020 2020 7461 755f 335f  ..        tau_3_
+0003c3d0: 3420 3d20 3320 2a20 7461 755f 315f 340d  4 = 3 * tau_1_4.
+0003c3e0: 0a20 2020 2020 2020 2069 6620 7461 755f  .        if tau_
+0003c3f0: 335f 3420 3e3d 2061 6273 2861 6e67 6c65  3_4 >= abs(angle
+0003c400: 2920 2520 7461 7520 3e20 7461 755f 315f  ) % tau > tau_1_
+0003c410: 343a 0d0a 2020 2020 2020 2020 2020 2020  4:..            
+0003c420: 7420 2b3d 2074 6175 202f 2032 2e30 0d0a  t += tau / 2.0..
+0003c430: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+0003c440: 656c 662e 706f 696e 745f 6174 5f74 2874  elf.point_at_t(t
+0003c450: 290d 0a0d 0a20 2020 2064 6566 2061 6e67  )....    def ang
+0003c460: 6c65 5f61 745f 706f 696e 7428 7365 6c66  le_at_point(self
+0003c470: 2c20 7029 3a0d 0a20 2020 2020 2020 2022  , p):..        "
+0003c480: 2222 0d0a 2020 2020 2020 2020 6669 6e64  ""..        find
+0003c490: 2074 6865 2061 6e67 6c65 2074 6f20 7468   the angle to th
+0003c4a0: 6520 706f 696e 742e 0d0a 0d0a 2020 2020  e point.....    
+0003c4b0: 2020 2020 3a70 6172 616d 2070 3a20 706f      :param p: po
+0003c4c0: 696e 740d 0a20 2020 2020 2020 203a 7265  int..        :re
+0003c4d0: 7475 726e 3a20 616e 676c 6520 746f 2067  turn: angle to g
+0003c4e0: 6976 656e 2070 6f69 6e74 2e0d 0a20 2020  iven point...   
+0003c4f0: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
+0003c500: 2020 6966 2073 656c 662e 6170 706c 7920    if self.apply 
+0003c510: 616e 6420 6e6f 7420 7365 6c66 2e74 7261  and not self.tra
+0003c520: 6e73 666f 726d 2e69 735f 6964 656e 7469  nsform.is_identi
+0003c530: 7479 2829 3a0d 0a20 2020 2020 2020 2020  ty():..         
+0003c540: 2020 2072 6574 7572 6e20 7365 6c66 2e69     return self.i
+0003c550: 6d70 6c69 6369 745f 6365 6e74 6572 2e61  mplicit_center.a
+0003c560: 6e67 6c65 5f74 6f28 7029 0d0a 2020 2020  ngle_to(p)..    
+0003c570: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
+0003c580: 2020 2020 2020 2063 656e 7465 7220 3d20         center = 
+0003c590: 506f 696e 7428 7365 6c66 2e63 782c 2073  Point(self.cx, s
+0003c5a0: 656c 662e 6379 290d 0a20 2020 2020 2020  elf.cy)..       
+0003c5b0: 2020 2020 2072 6574 7572 6e20 6365 6e74       return cent
+0003c5c0: 6572 2e61 6e67 6c65 5f74 6f28 7029 0d0a  er.angle_to(p)..
+0003c5d0: 0d0a 2020 2020 6465 6620 745f 6174 5f70  ..    def t_at_p
+0003c5e0: 6f69 6e74 2873 656c 662c 2070 293a 0d0a  oint(self, p):..
+0003c5f0: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
+0003c600: 2020 2020 2066 696e 6420 7468 6520 7420       find the t 
+0003c610: 7061 7261 6d65 7465 7220 746f 2061 7420  parameter to at 
+0003c620: 7468 6520 706f 696e 742e 0d0a 0d0a 2020  the point.....  
+0003c630: 2020 2020 2020 3a70 6172 616d 2070 3a20        :param p: 
+0003c640: 706f 696e 740d 0a20 2020 2020 2020 203a  point..        :
+0003c650: 7265 7475 726e 3a20 7420 7061 7261 6d65  return: t parame
+0003c660: 7465 7220 746f 2074 6865 2067 6976 656e  ter to the given
+0003c670: 2070 6f69 6e74 2e0d 0a20 2020 2020 2020   point...       
+0003c680: 2022 2222 0d0a 2020 2020 2020 2020 616e   """..        an
+0003c690: 676c 6520 3d20 7365 6c66 2e61 6e67 6c65  gle = self.angle
+0003c6a0: 5f61 745f 706f 696e 7428 7029 0d0a 2020  _at_point(p)..  
+0003c6b0: 2020 2020 2020 616e 676c 6520 2d3d 2073        angle -= s
+0003c6c0: 656c 662e 726f 7461 7469 6f6e 0d0a 2020  elf.rotation..  
+0003c6d0: 2020 2020 2020 6120 3d20 7365 6c66 2e69        a = self.i
+0003c6e0: 6d70 6c69 6369 745f 7278 0d0a 2020 2020  mplicit_rx..    
+0003c6f0: 2020 2020 6220 3d20 7365 6c66 2e69 6d70      b = self.imp
+0003c700: 6c69 6369 745f 7279 0d0a 2020 2020 2020  licit_ry..      
+0003c710: 2020 7420 3d20 6174 616e 3228 6120 2a20    t = atan2(a * 
+0003c720: 7461 6e28 616e 676c 6529 2c20 6229 0d0a  tan(angle), b)..
+0003c730: 2020 2020 2020 2020 7461 755f 315f 3420          tau_1_4 
+0003c740: 3d20 7461 7520 2f20 342e 300d 0a20 2020  = tau / 4.0..   
+0003c750: 2020 2020 2074 6175 5f33 5f34 203d 2033       tau_3_4 = 3
+0003c760: 202a 2074 6175 5f31 5f34 0d0a 2020 2020   * tau_1_4..    
+0003c770: 2020 2020 6966 2074 6175 5f33 5f34 203e      if tau_3_4 >
+0003c780: 3d20 6162 7328 616e 676c 6529 2025 2074  = abs(angle) % t
+0003c790: 6175 203e 2074 6175 5f31 5f34 3a0d 0a20  au > tau_1_4:.. 
+0003c7a0: 2020 2020 2020 2020 2020 2074 202b 3d20             t += 
+0003c7b0: 7461 7520 2f20 322e 300d 0a20 2020 2020  tau / 2.0..     
+0003c7c0: 2020 2072 6574 7572 6e20 740d 0a0d 0a20     return t.... 
+0003c7d0: 2020 2064 6566 2070 6f69 6e74 5f61 745f     def point_at_
+0003c7e0: 7428 7365 6c66 2c20 7429 3a0d 0a20 2020  t(self, t):..   
+0003c7f0: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
+0003c800: 2020 6669 6e64 2074 6865 2070 6f69 6e74    find the point
+0003c810: 2074 6861 7420 636f 7272 6573 706f 6e64   that correspond
+0003c820: 7320 746f 2067 6976 656e 2076 616c 7565  s to given value
+0003c830: 2074 2e0d 0a20 2020 2020 2020 2057 6865   t...        Whe
+0003c840: 7265 2074 3d30 2069 7320 7468 6520 6669  re t=0 is the fi
+0003c850: 7273 7420 706f 696e 7420 616e 6420 743d  rst point and t=
+0003c860: 7461 7520 6973 2074 6865 2066 696e 616c  tau is the final
+0003c870: 2070 6f69 6e74 2e0d 0a0d 0a20 2020 2020   point.....     
+0003c880: 2020 2049 6e20 7468 6520 6361 7365 206f     In the case o
+0003c890: 6620 6120 6369 7263 6c65 3a20 7420 3d20  f a circle: t = 
+0003c8a0: 616e 676c 652e 0d0a 0d0a 2020 2020 2020  angle.....      
+0003c8b0: 2020 3a70 6172 616d 2074 3a0d 0a20 2020    :param t:..   
+0003c8c0: 2020 2020 203a 7265 7475 726e 3a0d 0a20       :return:.. 
+0003c8d0: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
+0003c8e0: 2020 2020 726f 7461 7469 6f6e 203d 2073      rotation = s
+0003c8f0: 656c 662e 726f 7461 7469 6f6e 0d0a 2020  elf.rotation..  
+0003c900: 2020 2020 2020 6120 3d20 7365 6c66 2e69        a = self.i
+0003c910: 6d70 6c69 6369 745f 7278 0d0a 2020 2020  mplicit_rx..    
+0003c920: 2020 2020 6220 3d20 7365 6c66 2e69 6d70      b = self.imp
+0003c930: 6c69 6369 745f 7279 0d0a 2020 2020 2020  licit_ry..      
+0003c940: 2020 6365 6e74 6572 203d 2073 656c 662e    center = self.
+0003c950: 696d 706c 6963 6974 5f63 656e 7465 720d  implicit_center.
+0003c960: 0a20 2020 2020 2020 2063 7820 3d20 6365  .        cx = ce
+0003c970: 6e74 6572 2e78 0d0a 2020 2020 2020 2020  nter.x..        
+0003c980: 6379 203d 2063 656e 7465 722e 790d 0a20  cy = center.y.. 
+0003c990: 2020 2020 2020 2063 6f73 5f74 6865 7461         cos_theta
+0003c9a0: 203d 2063 6f73 2872 6f74 6174 696f 6e29   = cos(rotation)
+0003c9b0: 0d0a 2020 2020 2020 2020 7369 6e5f 7468  ..        sin_th
+0003c9c0: 6574 6120 3d20 7369 6e28 726f 7461 7469  eta = sin(rotati
+0003c9d0: 6f6e 290d 0a20 2020 2020 2020 2063 6f73  on)..        cos
+0003c9e0: 5f74 203d 2063 6f73 2874 290d 0a20 2020  _t = cos(t)..   
+0003c9f0: 2020 2020 2073 696e 5f74 203d 2073 696e       sin_t = sin
+0003ca00: 2874 290d 0a20 2020 2020 2020 2070 7820  (t)..        px 
+0003ca10: 3d20 6378 202b 2061 202a 2063 6f73 5f74  = cx + a * cos_t
+0003ca20: 202a 2063 6f73 5f74 6865 7461 202d 2062   * cos_theta - b
+0003ca30: 202a 2073 696e 5f74 202a 2073 696e 5f74   * sin_t * sin_t
+0003ca40: 6865 7461 0d0a 2020 2020 2020 2020 7079  heta..        py
+0003ca50: 203d 2063 7920 2b20 6120 2a20 636f 735f   = cy + a * cos_
+0003ca60: 7420 2a20 7369 6e5f 7468 6574 6120 2b20  t * sin_theta + 
+0003ca70: 6220 2a20 7369 6e5f 7420 2a20 636f 735f  b * sin_t * cos_
+0003ca80: 7468 6574 610d 0a20 2020 2020 2020 2072  theta..        r
+0003ca90: 6574 7572 6e20 506f 696e 7428 7078 2c20  eturn Point(px, 
+0003caa0: 7079 290d 0a0d 0a20 2020 2064 6566 2070  py)....    def p
+0003cab0: 6f69 6e74 2873 656c 662c 2070 6f73 6974  oint(self, posit
+0003cac0: 696f 6e2c 2065 7272 6f72 3d45 5252 4f52  ion, error=ERROR
+0003cad0: 293a 0d0a 2020 2020 2020 2020 2222 220d  ):..        """.
+0003cae0: 0a20 2020 2020 2020 2066 696e 6420 7468  .        find th
+0003caf0: 6520 706f 696e 7420 7468 6174 2063 6f72  e point that cor
+0003cb00: 7265 7370 6f6e 6473 2074 6f20 6769 7665  responds to give
+0003cb10: 6e20 7661 6c75 6520 5b30 2c31 5d2e 0d0a  n value [0,1]...
+0003cb20: 2020 2020 2020 2020 5768 6572 6520 743d          Where t=
+0003cb30: 3020 6973 2074 6865 2066 6972 7374 2070  0 is the first p
+0003cb40: 6f69 6e74 2061 6e64 2074 3d31 2069 7320  oint and t=1 is 
+0003cb50: 7468 6520 6669 6e61 6c20 706f 696e 742e  the final point.
+0003cb60: 0d0a 0d0a 2020 2020 2020 2020 3a70 6172  ....        :par
+0003cb70: 616d 2070 6f73 6974 696f 6e3a 2070 6f73  am position: pos
+0003cb80: 6974 696f 6e20 7661 6c75 6520 6265 7477  ition value betw
+0003cb90: 6565 6e20 302c 3120 7768 6572 6520 7661  een 0,1 where va
+0003cba0: 6c75 6520 6571 7561 6c73 2074 6865 2061  lue equals the a
+0003cbb0: 6d6f 756e 7420 7468 726f 7567 6820 7468  mount through th
+0003cbc0: 6520 7368 6170 650d 0a20 2020 2020 2020  e shape..       
+0003cbd0: 203a 7061 7261 6d20 6572 726f 723a 2065   :param error: e
+0003cbe0: 7272 6f72 2070 6572 6d69 7474 6564 2069  rror permitted i
+0003cbf0: 6e20 6465 7465 726d 696e 696e 6720 706f  n determining po
+0003cc00: 696e 7420 7661 6c75 6520 2875 6e75 7365  int value (unuse
+0003cc10: 6420 666f 7220 7468 6973 2073 6861 7065  d for this shape
+0003cc20: 290d 0a20 2020 2020 2020 203a 7265 7475  )..        :retu
+0003cc30: 726e 3a20 706f 696e 7420 6174 2074 0d0a  rn: point at t..
+0003cc40: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
+0003cc50: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+0003cc60: 2e70 6f69 6e74 5f61 745f 7428 7461 7520  .point_at_t(tau 
+0003cc70: 2a20 706f 7369 7469 6f6e 290d 0a0d 0a20  * position).... 
+0003cc80: 2020 2064 6566 205f 7261 6d61 6e75 6a61     def _ramanuja
+0003cc90: 6e5f 6c65 6e67 7468 2873 656c 6629 3a0d  n_length(self):.
+0003cca0: 0a20 2020 2020 2020 2061 203d 2073 656c  .        a = sel
+0003ccb0: 662e 696d 706c 6963 6974 5f72 780d 0a20  f.implicit_rx.. 
+0003ccc0: 2020 2020 2020 2062 203d 2073 656c 662e         b = self.
+0003ccd0: 696d 706c 6963 6974 5f72 790d 0a20 2020  implicit_ry..   
+0003cce0: 2020 2020 2069 6620 6220 3e20 613a 0d0a       if b > a:..
+0003ccf0: 2020 2020 2020 2020 2020 2020 612c 2062              a, b
+0003cd00: 203d 2062 2c20 610d 0a20 2020 2020 2020   = b, a..       
+0003cd10: 2068 203d 2028 2861 202d 2062 2920 2a20   h = ((a - b) * 
+0003cd20: 2861 202d 2062 2929 202f 2028 2861 202b  (a - b)) / ((a +
+0003cd30: 2062 2920 2a20 2861 202b 2062 2929 0d0a   b) * (a + b))..
+0003cd40: 2020 2020 2020 2020 7265 7475 726e 2074          return t
+0003cd50: 6175 202f 2032 202a 2028 6120 2b20 6229  au / 2 * (a + b)
+0003cd60: 202a 2028 3120 2b20 2833 202a 2068 202f   * (1 + (3 * h /
+0003cd70: 2028 3130 202b 2073 7172 7428 3420 2d20   (10 + sqrt(4 - 
+0003cd80: 3320 2a20 6829 2929 290d 0a0d 0a0d 0a63  3 * h))))......c
+0003cd90: 6c61 7373 2045 6c6c 6970 7365 285f 526f  lass Ellipse(_Ro
+0003cda0: 756e 6453 6861 7065 293a 0d0a 2020 2020  undShape):..    
+0003cdb0: 2222 220d 0a20 2020 2053 5647 2045 6c6c  """..    SVG Ell
+0003cdc0: 6970 7365 2073 6861 7065 7320 6172 6520  ipse shapes are 
+0003cdd0: 6465 6669 6e65 6420 696e 2053 5647 3220  defined in SVG2 
+0003cde0: 3130 2e34 0d0a 2020 2020 6874 7470 733a  10.4..    https:
+0003cdf0: 2f2f 7777 772e 7733 2e6f 7267 2f54 522f  //www.w3.org/TR/
+0003ce00: 5356 4732 2f73 6861 7065 732e 6874 6d6c  SVG2/shapes.html
+0003ce10: 2345 6c6c 6970 7365 456c 656d 656e 740d  #EllipseElement.
+0003ce20: 0a0d 0a20 2020 2054 6865 7365 2068 6176  ...    These hav
+0003ce30: 6520 6765 6f6d 6574 7269 6320 7072 6f70  e geometric prop
+0003ce40: 6572 7469 6573 2063 782c 2063 792c 2072  erties cx, cy, r
+0003ce50: 782c 2072 790d 0a20 2020 2022 2222 0d0a  x, ry..    """..
+0003ce60: 0d0a 2020 2020 6465 6620 5f5f 696e 6974  ..    def __init
+0003ce70: 5f5f 2873 656c 662c 202a 6172 6773 2c20  __(self, *args, 
+0003ce80: 2a2a 6b77 6172 6773 293a 0d0a 2020 2020  **kwargs):..    
+0003ce90: 2020 2020 5f52 6f75 6e64 5368 6170 652e      _RoundShape.
+0003cea0: 5f5f 696e 6974 5f5f 2873 656c 662c 202a  __init__(self, *
+0003ceb0: 6172 6773 2c20 2a2a 6b77 6172 6773 290d  args, **kwargs).
+0003cec0: 0a0d 0a20 2020 2064 6566 205f 5f63 6f70  ...    def __cop
+0003ced0: 795f 5f28 7365 6c66 293a 0d0a 2020 2020  y__(self):..    
+0003cee0: 2020 2020 7265 7475 726e 2045 6c6c 6970      return Ellip
+0003cef0: 7365 2873 656c 6629 0d0a 0d0a 2020 2020  se(self)....    
+0003cf00: 6465 6620 5f6e 616d 6528 7365 6c66 293a  def _name(self):
+0003cf10: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+0003cf20: 2073 656c 662e 5f5f 636c 6173 735f 5f2e   self.__class__.
+0003cf30: 5f5f 6e61 6d65 5f5f 0d0a 0d0a 0d0a 636c  __name__......cl
+0003cf40: 6173 7320 4369 7263 6c65 285f 526f 756e  ass Circle(_Roun
+0003cf50: 6453 6861 7065 293a 0d0a 2020 2020 2222  dShape):..    ""
+0003cf60: 220d 0a20 2020 2053 5647 2043 6972 636c  "..    SVG Circl
+0003cf70: 6520 7368 6170 6573 2061 7265 2064 6566  e shapes are def
+0003cf80: 696e 6564 2069 6e20 5356 4732 2031 302e  ined in SVG2 10.
+0003cf90: 330d 0a20 2020 2068 7474 7073 3a2f 2f77  3..    https://w
+0003cfa0: 7777 2e77 332e 6f72 672f 5452 2f53 5647  ww.w3.org/TR/SVG
+0003cfb0: 322f 7368 6170 6573 2e68 746d 6c23 4369  2/shapes.html#Ci
+0003cfc0: 7263 6c65 456c 656d 656e 740d 0a0d 0a20  rcleElement.... 
+0003cfd0: 2020 2054 6865 7365 2068 6176 6520 6765     These have ge
+0003cfe0: 6f6d 6574 7269 6320 7072 6f70 6572 7469  ometric properti
+0003cff0: 6573 2063 782c 2063 792c 2072 0d0a 2020  es cx, cy, r..  
+0003d000: 2020 2222 220d 0a0d 0a20 2020 2064 6566    """....    def
+0003d010: 205f 5f69 6e69 745f 5f28 7365 6c66 2c20   __init__(self, 
+0003d020: 2a61 7267 732c 202a 2a6b 7761 7267 7329  *args, **kwargs)
+0003d030: 3a0d 0a20 2020 2020 2020 205f 526f 756e  :..        _Roun
+0003d040: 6453 6861 7065 2e5f 5f69 6e69 745f 5f28  dShape.__init__(
+0003d050: 7365 6c66 2c20 2a61 7267 732c 202a 2a6b  self, *args, **k
+0003d060: 7761 7267 7329 0d0a 0d0a 2020 2020 6465  wargs)....    de
+0003d070: 6620 5f5f 636f 7079 5f5f 2873 656c 6629  f __copy__(self)
+0003d080: 3a0d 0a20 2020 2020 2020 2072 6574 7572  :..        retur
+0003d090: 6e20 4369 7263 6c65 2873 656c 6629 0d0a  n Circle(self)..
+0003d0a0: 0d0a 2020 2020 6465 6620 5f6e 616d 6528  ..    def _name(
+0003d0b0: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
+0003d0c0: 7265 7475 726e 2073 656c 662e 5f5f 636c  return self.__cl
+0003d0d0: 6173 735f 5f2e 5f5f 6e61 6d65 5f5f 0d0a  ass__.__name__..
+0003d0e0: 0d0a 0d0a 636c 6173 7320 5369 6d70 6c65  ....class Simple
+0003d0f0: 4c69 6e65 2853 6861 7065 293a 0d0a 2020  Line(Shape):..  
+0003d100: 2020 2222 220d 0a20 2020 2053 5647 204c    """..    SVG L
+0003d110: 696e 6520 7368 6170 6573 2061 7265 2064  ine shapes are d
+0003d120: 6566 696e 6564 2069 6e20 5356 4732 2031  efined in SVG2 1
+0003d130: 302e 350d 0a20 2020 2068 7474 7073 3a2f  0.5..    https:/
+0003d140: 2f77 7777 2e77 332e 6f72 672f 5452 2f53  /www.w3.org/TR/S
+0003d150: 5647 322f 7368 6170 6573 2e68 746d 6c23  VG2/shapes.html#
+0003d160: 4c69 6e65 456c 656d 656e 740d 0a0d 0a20  LineElement.... 
+0003d170: 2020 2054 6865 7365 2068 6176 6520 6765     These have ge
+0003d180: 6f6d 6574 7269 6320 7072 6f70 6572 7469  ometric properti
+0003d190: 6573 2078 312c 2079 312c 2078 322c 2079  es x1, y1, x2, y
+0003d1a0: 320d 0a0d 0a20 2020 2054 6865 7365 2061  2....    These a
+0003d1b0: 7265 2063 616c 6c65 6420 4c69 6e65 2069  re called Line i
+0003d1c0: 6e20 5356 4720 6275 7420 7468 6174 206e  n SVG but that n
+0003d1d0: 616d 6520 6973 2061 6c72 6561 6479 2075  ame is already u
+0003d1e0: 7365 6420 666f 7220 4c69 6e65 2850 6174  sed for Line(Pat
+0003d1f0: 6853 6567 6d65 6e74 290d 0a20 2020 2022  hSegment)..    "
+0003d200: 2222 0d0a 0d0a 2020 2020 6465 6620 5f5f  ""....    def __
+0003d210: 696e 6974 5f5f 2873 656c 662c 202a 6172  init__(self, *ar
+0003d220: 6773 2c20 2a2a 6b77 6172 6773 293a 0d0a  gs, **kwargs):..
+0003d230: 2020 2020 2020 2020 7365 6c66 2e78 3120          self.x1 
+0003d240: 3d20 4e6f 6e65 0d0a 2020 2020 2020 2020  = None..        
+0003d250: 7365 6c66 2e79 3120 3d20 4e6f 6e65 0d0a  self.y1 = None..
+0003d260: 2020 2020 2020 2020 7365 6c66 2e78 3220          self.x2 
+0003d270: 3d20 4e6f 6e65 0d0a 2020 2020 2020 2020  = None..        
+0003d280: 7365 6c66 2e79 3220 3d20 4e6f 6e65 0d0a  self.y2 = None..
+0003d290: 2020 2020 2020 2020 5368 6170 652e 5f5f          Shape.__
+0003d2a0: 696e 6974 5f5f 2873 656c 662c 202a 6172  init__(self, *ar
+0003d2b0: 6773 2c20 2a2a 6b77 6172 6773 290d 0a0d  gs, **kwargs)...
+0003d2c0: 0a20 2020 2064 6566 2070 726f 7065 7274  .    def propert
+0003d2d0: 795f 6279 5f6f 626a 6563 7428 7365 6c66  y_by_object(self
+0003d2e0: 2c20 7329 3a0d 0a20 2020 2020 2020 2053  , s):..        S
+0003d2f0: 6861 7065 2e70 726f 7065 7274 795f 6279  hape.property_by
+0003d300: 5f6f 626a 6563 7428 7365 6c66 2c20 7329  _object(self, s)
+0003d310: 0d0a 2020 2020 2020 2020 7365 6c66 2e78  ..        self.x
+0003d320: 3120 3d20 732e 7831 0d0a 2020 2020 2020  1 = s.x1..      
+0003d330: 2020 7365 6c66 2e79 3120 3d20 732e 7931    self.y1 = s.y1
+0003d340: 0d0a 2020 2020 2020 2020 7365 6c66 2e78  ..        self.x
+0003d350: 3220 3d20 732e 7832 0d0a 2020 2020 2020  2 = s.x2..      
+0003d360: 2020 7365 6c66 2e79 3220 3d20 732e 7932    self.y2 = s.y2
+0003d370: 0d0a 0d0a 2020 2020 6465 6620 7072 6f70  ....    def prop
+0003d380: 6572 7479 5f62 795f 7661 6c75 6573 2873  erty_by_values(s
+0003d390: 656c 662c 2076 616c 7565 7329 3a0d 0a20  elf, values):.. 
+0003d3a0: 2020 2020 2020 2053 6861 7065 2e70 726f         Shape.pro
+0003d3b0: 7065 7274 795f 6279 5f76 616c 7565 7328  perty_by_values(
+0003d3c0: 7365 6c66 2c20 7661 6c75 6573 290d 0a20  self, values).. 
+0003d3d0: 2020 2020 2020 2073 656c 662e 7831 203d         self.x1 =
+0003d3e0: 204c 656e 6774 6828 7661 6c75 6573 2e67   Length(values.g
+0003d3f0: 6574 2853 5647 5f41 5454 525f 5831 2c20  et(SVG_ATTR_X1, 
+0003d400: 3029 292e 7661 6c75 6528 290d 0a20 2020  0)).value()..   
+0003d410: 2020 2020 2073 656c 662e 7931 203d 204c       self.y1 = L
+0003d420: 656e 6774 6828 7661 6c75 6573 2e67 6574  ength(values.get
+0003d430: 2853 5647 5f41 5454 525f 5931 2c20 3029  (SVG_ATTR_Y1, 0)
+0003d440: 292e 7661 6c75 6528 290d 0a20 2020 2020  ).value()..     
+0003d450: 2020 2073 656c 662e 7832 203d 204c 656e     self.x2 = Len
+0003d460: 6774 6828 7661 6c75 6573 2e67 6574 2853  gth(values.get(S
+0003d470: 5647 5f41 5454 525f 5832 2c20 3029 292e  VG_ATTR_X2, 0)).
+0003d480: 7661 6c75 6528 290d 0a20 2020 2020 2020  value()..       
+0003d490: 2073 656c 662e 7932 203d 204c 656e 6774   self.y2 = Lengt
+0003d4a0: 6828 7661 6c75 6573 2e67 6574 2853 5647  h(values.get(SVG
+0003d4b0: 5f41 5454 525f 5932 2c20 3029 292e 7661  _ATTR_Y2, 0)).va
+0003d4c0: 6c75 6528 290d 0a0d 0a20 2020 2064 6566  lue()....    def
+0003d4d0: 2070 726f 7065 7274 795f 6279 5f61 7267   property_by_arg
+0003d4e0: 7328 7365 6c66 2c20 2a61 7267 7329 3a0d  s(self, *args):.
+0003d4f0: 0a20 2020 2020 2020 2061 7267 5f6c 656e  .        arg_len
+0003d500: 6774 6820 3d20 6c65 6e28 6172 6773 290d  gth = len(args).
+0003d510: 0a20 2020 2020 2020 2069 6620 6172 675f  .        if arg_
+0003d520: 6c65 6e67 7468 203e 3d20 313a 0d0a 2020  length >= 1:..  
+0003d530: 2020 2020 2020 2020 2020 7365 6c66 2e78            self.x
+0003d540: 3120 3d20 4c65 6e67 7468 2861 7267 735b  1 = Length(args[
+0003d550: 305d 292e 7661 6c75 6528 290d 0a20 2020  0]).value()..   
+0003d560: 2020 2020 2069 6620 6172 675f 6c65 6e67       if arg_leng
+0003d570: 7468 203e 3d20 323a 0d0a 2020 2020 2020  th >= 2:..      
+0003d580: 2020 2020 2020 7365 6c66 2e79 3120 3d20        self.y1 = 
+0003d590: 4c65 6e67 7468 2861 7267 735b 315d 292e  Length(args[1]).
+0003d5a0: 7661 6c75 6528 290d 0a20 2020 2020 2020  value()..       
+0003d5b0: 2069 6620 6172 675f 6c65 6e67 7468 203e   if arg_length >
+0003d5c0: 3d20 333a 0d0a 2020 2020 2020 2020 2020  = 3:..          
+0003d5d0: 2020 7365 6c66 2e78 3220 3d20 4c65 6e67    self.x2 = Leng
+0003d5e0: 7468 2861 7267 735b 325d 292e 7661 6c75  th(args[2]).valu
+0003d5f0: 6528 290d 0a20 2020 2020 2020 2069 6620  e()..        if 
+0003d600: 6172 675f 6c65 6e67 7468 203e 3d20 343a  arg_length >= 4:
+0003d610: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+0003d620: 6c66 2e79 3220 3d20 4c65 6e67 7468 2861  lf.y2 = Length(a
+0003d630: 7267 735b 335d 292e 7661 6c75 6528 290d  rgs[3]).value().
+0003d640: 0a20 2020 2020 2020 2073 656c 662e 5f69  .        self._i
+0003d650: 6e69 745f 7368 6170 6528 2a61 7267 735b  nit_shape(*args[
+0003d660: 343a 5d29 0d0a 0d0a 2020 2020 6465 6620  4:])....    def 
+0003d670: 5f61 7474 7273 2873 656c 662c 2076 616c  _attrs(self, val
+0003d680: 7565 7329 3a0d 0a20 2020 2020 2020 2069  ues):..        i
+0003d690: 6620 7365 6c66 2e78 3120 6973 206e 6f74  f self.x1 is not
+0003d6a0: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+0003d6b0: 2020 2020 7661 6c75 6573 2e61 7070 656e      values.appen
+0003d6c0: 6428 2225 733d 2573 2220 2520 2853 5647  d("%s=%s" % (SVG
+0003d6d0: 5f41 5454 525f 5831 2c20 7374 7228 7365  _ATTR_X1, str(se
+0003d6e0: 6c66 2e78 3129 2929 0d0a 2020 2020 2020  lf.x1)))..      
+0003d6f0: 2020 6966 2073 656c 662e 7931 2069 7320    if self.y1 is 
+0003d700: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
+0003d710: 2020 2020 2020 2076 616c 7565 732e 6170         values.ap
+0003d720: 7065 6e64 2822 2573 3d25 7322 2025 2028  pend("%s=%s" % (
+0003d730: 5356 475f 4154 5452 5f59 312c 2073 7472  SVG_ATTR_Y1, str
+0003d740: 2873 656c 662e 7931 2929 290d 0a20 2020  (self.y1)))..   
+0003d750: 2020 2020 2069 6620 7365 6c66 2e78 3220       if self.x2 
+0003d760: 6973 206e 6f74 204e 6f6e 653a 0d0a 2020  is not None:..  
+0003d770: 2020 2020 2020 2020 2020 7661 6c75 6573            values
+0003d780: 2e61 7070 656e 6428 2225 733d 2573 2220  .append("%s=%s" 
+0003d790: 2520 2853 5647 5f41 5454 525f 5832 2c20  % (SVG_ATTR_X2, 
+0003d7a0: 7374 7228 7365 6c66 2e78 3229 2929 0d0a  str(self.x2)))..
+0003d7b0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+0003d7c0: 7932 2069 7320 6e6f 7420 4e6f 6e65 3a0d  y2 is not None:.
+0003d7d0: 0a20 2020 2020 2020 2020 2020 2076 616c  .            val
+0003d7e0: 7565 732e 6170 7065 6e64 2822 2573 3d25  ues.append("%s=%
+0003d7f0: 7322 2025 2028 5356 475f 4154 5452 5f59  s" % (SVG_ATTR_Y
+0003d800: 322c 2073 7472 2873 656c 662e 7932 2929  2, str(self.y2))
+0003d810: 290d 0a0d 0a20 2020 2064 6566 205f 5f72  )....    def __r
+0003d820: 6570 725f 5f28 7365 6c66 293a 0d0a 2020  epr__(self):..  
+0003d830: 2020 2020 2020 7661 6c75 6573 203d 205b        values = [
+0003d840: 5d0d 0a20 2020 2020 2020 2073 656c 662e  ]..        self.
+0003d850: 5f61 7474 7273 2876 616c 7565 7329 0d0a  _attrs(values)..
+0003d860: 2020 2020 2020 2020 7365 6c66 2e5f 7265          self._re
+0003d870: 7072 5f73 6861 7065 2876 616c 7565 7329  pr_shape(values)
+0003d880: 0d0a 2020 2020 2020 2020 7061 7261 6d73  ..        params
+0003d890: 203d 2022 2c20 222e 6a6f 696e 2876 616c   = ", ".join(val
+0003d8a0: 7565 7329 0d0a 2020 2020 2020 2020 7265  ues)..        re
+0003d8b0: 7475 726e 2022 5369 6d70 6c65 4c69 6e65  turn "SimpleLine
+0003d8c0: 2825 7329 2220 2520 7061 7261 6d73 0d0a  (%s)" % params..
+0003d8d0: 0d0a 2020 2020 6465 6620 5f5f 7374 725f  ..    def __str_
+0003d8e0: 5f28 7365 6c66 293a 0d0a 2020 2020 2020  _(self):..      
+0003d8f0: 2020 7661 6c75 6573 203d 205b 5d0d 0a20    values = [].. 
+0003d900: 2020 2020 2020 2073 656c 662e 5f61 7474         self._att
+0003d910: 7273 2876 616c 7565 7329 0d0a 2020 2020  rs(values)..    
+0003d920: 2020 2020 7365 6c66 2e5f 7374 725f 7368      self._str_sh
+0003d930: 6170 6528 7661 6c75 6573 290d 0a20 2020  ape(values)..   
+0003d940: 2020 2020 2070 6172 616d 7320 3d20 222c       params = ",
+0003d950: 2022 2e6a 6f69 6e28 7661 6c75 6573 290d   ".join(values).
+0003d960: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0003d970: 2253 696d 706c 654c 696e 6528 2573 2922  "SimpleLine(%s)"
+0003d980: 2025 2070 6172 616d 730d 0a0d 0a20 2020   % params....   
+0003d990: 2064 6566 205f 5f63 6f70 795f 5f28 7365   def __copy__(se
+0003d9a0: 6c66 293a 0d0a 2020 2020 2020 2020 7265  lf):..        re
+0003d9b0: 7475 726e 2053 696d 706c 654c 696e 6528  turn SimpleLine(
+0003d9c0: 7365 6c66 290d 0a0d 0a20 2020 2040 7072  self)....    @pr
+0003d9d0: 6f70 6572 7479 0d0a 2020 2020 6465 6620  operty..    def 
+0003d9e0: 696d 706c 6963 6974 5f78 3128 7365 6c66  implicit_x1(self
+0003d9f0: 293a 0d0a 2020 2020 2020 2020 706f 696e  ):..        poin
+0003da00: 7420 3d20 506f 696e 7428 7365 6c66 2e78  t = Point(self.x
+0003da10: 312c 2073 656c 662e 7931 290d 0a20 2020  1, self.y1)..   
+0003da20: 2020 2020 2070 6f69 6e74 202a 3d20 7365       point *= se
+0003da30: 6c66 2e74 7261 6e73 666f 726d 0d0a 2020  lf.transform..  
+0003da40: 2020 2020 2020 7265 7475 726e 2070 6f69        return poi
+0003da50: 6e74 2e78 0d0a 0d0a 2020 2020 4070 726f  nt.x....    @pro
+0003da60: 7065 7274 790d 0a20 2020 2064 6566 2069  perty..    def i
+0003da70: 6d70 6c69 6369 745f 7931 2873 656c 6629  mplicit_y1(self)
+0003da80: 3a0d 0a20 2020 2020 2020 2070 6f69 6e74  :..        point
+0003da90: 203d 2050 6f69 6e74 2873 656c 662e 7831   = Point(self.x1
+0003daa0: 2c20 7365 6c66 2e79 3129 0d0a 2020 2020  , self.y1)..    
+0003dab0: 2020 2020 706f 696e 7420 2a3d 2073 656c      point *= sel
+0003dac0: 662e 7472 616e 7366 6f72 6d0d 0a20 2020  f.transform..   
+0003dad0: 2020 2020 2072 6574 7572 6e20 706f 696e       return poin
+0003dae0: 742e 790d 0a0d 0a20 2020 2040 7072 6f70  t.y....    @prop
+0003daf0: 6572 7479 0d0a 2020 2020 6465 6620 696d  erty..    def im
+0003db00: 706c 6963 6974 5f78 3228 7365 6c66 293a  plicit_x2(self):
+0003db10: 0d0a 2020 2020 2020 2020 706f 696e 7420  ..        point 
+0003db20: 3d20 506f 696e 7428 7365 6c66 2e78 322c  = Point(self.x2,
+0003db30: 2073 656c 662e 7932 290d 0a20 2020 2020   self.y2)..     
+0003db40: 2020 2070 6f69 6e74 202a 3d20 7365 6c66     point *= self
+0003db50: 2e74 7261 6e73 666f 726d 0d0a 2020 2020  .transform..    
+0003db60: 2020 2020 7265 7475 726e 2070 6f69 6e74      return point
+0003db70: 2e78 0d0a 0d0a 2020 2020 4070 726f 7065  .x....    @prope
+0003db80: 7274 790d 0a20 2020 2064 6566 2069 6d70  rty..    def imp
+0003db90: 6c69 6369 745f 7932 2873 656c 6629 3a0d  licit_y2(self):.
+0003dba0: 0a20 2020 2020 2020 2070 6f69 6e74 203d  .        point =
+0003dbb0: 2050 6f69 6e74 2873 656c 662e 7832 2c20   Point(self.x2, 
+0003dbc0: 7365 6c66 2e79 3229 0d0a 2020 2020 2020  self.y2)..      
+0003dbd0: 2020 706f 696e 7420 2a3d 2073 656c 662e    point *= self.
+0003dbe0: 7472 616e 7366 6f72 6d0d 0a20 2020 2020  transform..     
+0003dbf0: 2020 2072 6574 7572 6e20 706f 696e 742e     return point.
+0003dc00: 790d 0a0d 0a20 2020 2064 6566 2073 6567  y....    def seg
+0003dc10: 6d65 6e74 7328 7365 6c66 2c20 7472 616e  ments(self, tran
+0003dc20: 7366 6f72 6d65 643d 5472 7565 293a 0d0a  sformed=True):..
+0003dc30: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
+0003dc40: 2020 2020 2053 5647 2070 6174 6820 6465       SVG path de
+0003dc50: 636f 6d70 6f73 6974 696f 6e20 6973 2067  composition is g
+0003dc60: 6976 656e 2069 6e20 5356 4720 322e 3020  iven in SVG 2.0 
+0003dc70: 3130 2e35 2e0d 0a0d 0a20 2020 2020 2020  10.5.....       
+0003dc80: 2070 6572 666f 726d 2061 6e20 6162 736f   perform an abso
+0003dc90: 6c75 7465 206d 6f76 6574 6f20 6f70 6572  lute moveto oper
+0003dca0: 6174 696f 6e20 746f 2061 6273 6f6c 7574  ation to absolut
+0003dcb0: 6520 6c6f 6361 7469 6f6e 2028 7831 2c79  e location (x1,y
+0003dcc0: 3129 0d0a 2020 2020 2020 2020 7065 7266  1)..        perf
+0003dcd0: 6f72 6d20 616e 2061 6273 6f6c 7574 6520  orm an absolute 
+0003dce0: 6c69 6e65 746f 206f 7065 7261 7469 6f6e  lineto operation
+0003dcf0: 2074 6f20 6162 736f 6c75 7465 206c 6f63   to absolute loc
+0003dd00: 6174 696f 6e20 2878 322c 7932 290d 0a0d  ation (x2,y2)...
+0003dd10: 0a20 2020 2020 2020 203a 7265 7475 726e  .        :return
+0003dd20: 7320 5061 7468 5f64 2070 6174 6820 666f  s Path_d path fo
+0003dd30: 7220 6c69 6e65 2e0d 0a20 2020 2020 2020  r line...       
+0003dd40: 2022 2222 0d0a 0d0a 2020 2020 2020 2020   """....        
+0003dd50: 7374 6172 7420 3d20 506f 696e 7428 7365  start = Point(se
+0003dd60: 6c66 2e78 312c 2073 656c 662e 7931 290d  lf.x1, self.y1).
+0003dd70: 0a20 2020 2020 2020 2065 6e64 203d 2050  .        end = P
+0003dd80: 6f69 6e74 2873 656c 662e 7832 2c20 7365  oint(self.x2, se
+0003dd90: 6c66 2e79 3229 0d0a 2020 2020 2020 2020  lf.y2)..        
+0003dda0: 6966 2074 7261 6e73 666f 726d 6564 3a0d  if transformed:.
+0003ddb0: 0a20 2020 2020 2020 2020 2020 2073 7461  .            sta
+0003ddc0: 7274 202a 3d20 7365 6c66 2e74 7261 6e73  rt *= self.trans
+0003ddd0: 666f 726d 0d0a 2020 2020 2020 2020 2020  form..          
+0003dde0: 2020 656e 6420 2a3d 2073 656c 662e 7472    end *= self.tr
+0003ddf0: 616e 7366 6f72 6d0d 0a20 2020 2020 2020  ansform..       
+0003de00: 2072 6574 7572 6e20 4d6f 7665 284e 6f6e   return Move(Non
+0003de10: 652c 2073 7461 7274 292c 204c 696e 6528  e, start), Line(
+0003de20: 7374 6172 742c 2065 6e64 290d 0a0d 0a20  start, end).... 
+0003de30: 2020 2064 6566 2072 6569 6679 2873 656c     def reify(sel
+0003de40: 6629 3a0d 0a20 2020 2020 2020 2022 2222  f):..        """
+0003de50: 0d0a 2020 2020 2020 2020 5265 616c 697a  ..        Realiz
+0003de60: 6573 2074 6865 2074 7261 6e73 666f 726d  es the transform
+0003de70: 2074 6f20 7468 6520 7368 6170 6520 7072   to the shape pr
+0003de80: 6f70 6572 7469 6573 2e0d 0a0d 0a20 2020  operties.....   
+0003de90: 2020 2020 2053 696d 706c 654c 696e 6573       SimpleLines
+0003dea0: 2061 7265 2070 6572 6665 6374 6c79 2072   are perfectly r
+0003deb0: 6569 6669 6564 2e0d 0a20 2020 2020 2020  eified...       
+0003dec0: 2022 2222 0d0a 2020 2020 2020 2020 4772   """..        Gr
+0003ded0: 6170 6869 634f 626a 6563 742e 7265 6966  aphicObject.reif
+0003dee0: 7928 7365 6c66 290d 0a20 2020 2020 2020  y(self)..       
+0003def0: 2054 7261 6e73 666f 726d 6162 6c65 2e72   Transformable.r
+0003df00: 6569 6679 2873 656c 6629 0d0a 2020 2020  eify(self)..    
+0003df10: 2020 2020 6d61 7472 6978 203d 2073 656c      matrix = sel
+0003df20: 662e 7472 616e 7366 6f72 6d0d 0a20 2020  f.transform..   
+0003df30: 2020 2020 2070 203d 2050 6f69 6e74 2873       p = Point(s
+0003df40: 656c 662e 7831 2c20 7365 6c66 2e79 3129  elf.x1, self.y1)
+0003df50: 0d0a 2020 2020 2020 2020 7020 2a3d 206d  ..        p *= m
+0003df60: 6174 7269 780d 0a20 2020 2020 2020 2073  atrix..        s
+0003df70: 656c 662e 7831 203d 2070 2e78 0d0a 2020  elf.x1 = p.x..  
+0003df80: 2020 2020 2020 7365 6c66 2e79 3120 3d20        self.y1 = 
+0003df90: 702e 790d 0a0d 0a20 2020 2020 2020 2070  p.y....        p
+0003dfa0: 203d 2050 6f69 6e74 2873 656c 662e 7832   = Point(self.x2
+0003dfb0: 2c20 7365 6c66 2e79 3229 0d0a 2020 2020  , self.y2)..    
+0003dfc0: 2020 2020 7020 2a3d 206d 6174 7269 780d      p *= matrix.
+0003dfd0: 0a20 2020 2020 2020 2073 656c 662e 7832  .        self.x2
+0003dfe0: 203d 2070 2e78 0d0a 2020 2020 2020 2020   = p.x..        
+0003dff0: 7365 6c66 2e79 3220 3d20 702e 790d 0a0d  self.y2 = p.y...
+0003e000: 0a20 2020 2020 2020 206d 6174 7269 782e  .        matrix.
+0003e010: 7265 7365 7428 290d 0a20 2020 2020 2020  reset()..       
+0003e020: 2072 6574 7572 6e20 7365 6c66 0d0a 0d0a   return self....
+0003e030: 2020 2020 6465 6620 7265 6e64 6572 2873      def render(s
+0003e040: 656c 662c 202a 2a6b 7761 7267 7329 3a0d  elf, **kwargs):.
+0003e050: 0a20 2020 2020 2020 2053 6861 7065 2e72  .        Shape.r
+0003e060: 656e 6465 7228 7365 6c66 2c20 2a2a 6b77  ender(self, **kw
+0003e070: 6172 6773 290d 0a20 2020 2020 2020 2077  args)..        w
+0003e080: 6964 7468 203d 206b 7761 7267 732e 6765  idth = kwargs.ge
+0003e090: 7428 2277 6964 7468 222c 206b 7761 7267  t("width", kwarg
+0003e0a0: 732e 6765 7428 2272 656c 6174 6976 655f  s.get("relative_
+0003e0b0: 6c65 6e67 7468 2229 290d 0a20 2020 2020  length"))..     
+0003e0c0: 2020 2068 6569 6768 7420 3d20 6b77 6172     height = kwar
+0003e0d0: 6773 2e67 6574 2822 6865 6967 6874 222c  gs.get("height",
+0003e0e0: 206b 7761 7267 732e 6765 7428 2272 656c   kwargs.get("rel
+0003e0f0: 6174 6976 655f 6c65 6e67 7468 2229 290d  ative_length")).
+0003e100: 0a20 2020 2020 2020 2074 7279 3a0d 0a20  .        try:.. 
+0003e110: 2020 2020 2020 2020 2020 2064 656c 206b             del k
+0003e120: 7761 7267 735b 2272 656c 6174 6976 655f  wargs["relative_
+0003e130: 6c65 6e67 7468 225d 0d0a 2020 2020 2020  length"]..      
+0003e140: 2020 6578 6365 7074 204b 6579 4572 726f    except KeyErro
+0003e150: 723a 0d0a 2020 2020 2020 2020 2020 2020  r:..            
+0003e160: 7061 7373 0d0a 2020 2020 2020 2020 6966  pass..        if
+0003e170: 2069 7369 6e73 7461 6e63 6528 7365 6c66   isinstance(self
+0003e180: 2e78 312c 204c 656e 6774 6829 3a0d 0a20  .x1, Length):.. 
+0003e190: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0003e1a0: 7831 203d 2073 656c 662e 7831 2e76 616c  x1 = self.x1.val
+0003e1b0: 7565 2872 656c 6174 6976 655f 6c65 6e67  ue(relative_leng
+0003e1c0: 7468 3d77 6964 7468 2c20 2a2a 6b77 6172  th=width, **kwar
+0003e1d0: 6773 290d 0a20 2020 2020 2020 2069 6620  gs)..        if 
+0003e1e0: 6973 696e 7374 616e 6365 2873 656c 662e  isinstance(self.
+0003e1f0: 7931 2c20 4c65 6e67 7468 293a 0d0a 2020  y1, Length):..  
+0003e200: 2020 2020 2020 2020 2020 7365 6c66 2e79            self.y
+0003e210: 3120 3d20 7365 6c66 2e79 312e 7661 6c75  1 = self.y1.valu
+0003e220: 6528 7265 6c61 7469 7665 5f6c 656e 6774  e(relative_lengt
+0003e230: 683d 6865 6967 6874 2c20 2a2a 6b77 6172  h=height, **kwar
+0003e240: 6773 290d 0a20 2020 2020 2020 2069 6620  gs)..        if 
+0003e250: 6973 696e 7374 616e 6365 2873 656c 662e  isinstance(self.
+0003e260: 7832 2c20 4c65 6e67 7468 293a 0d0a 2020  x2, Length):..  
+0003e270: 2020 2020 2020 2020 2020 7365 6c66 2e78            self.x
+0003e280: 3220 3d20 7365 6c66 2e78 322e 7661 6c75  2 = self.x2.valu
+0003e290: 6528 7265 6c61 7469 7665 5f6c 656e 6774  e(relative_lengt
+0003e2a0: 683d 7769 6474 682c 202a 2a6b 7761 7267  h=width, **kwarg
+0003e2b0: 7329 0d0a 2020 2020 2020 2020 6966 2069  s)..        if i
+0003e2c0: 7369 6e73 7461 6e63 6528 7365 6c66 2e79  sinstance(self.y
+0003e2d0: 322c 204c 656e 6774 6829 3a0d 0a20 2020  2, Length):..   
+0003e2e0: 2020 2020 2020 2020 2073 656c 662e 7932           self.y2
+0003e2f0: 203d 2073 656c 662e 7932 2e76 616c 7565   = self.y2.value
+0003e300: 2872 656c 6174 6976 655f 6c65 6e67 7468  (relative_length
+0003e310: 3d68 6569 6768 742c 202a 2a6b 7761 7267  =height, **kwarg
+0003e320: 7329 0d0a 2020 2020 2020 2020 7265 7475  s)..        retu
+0003e330: 726e 2073 656c 660d 0a0d 0a0d 0a63 6c61  rn self......cla
+0003e340: 7373 205f 506f 6c79 7368 6170 6528 5368  ss _Polyshape(Sh
+0003e350: 6170 6529 3a0d 0a20 2020 2022 2222 4261  ape):..    """Ba
+0003e360: 7365 2066 6f72 6d20 6f66 2050 6f6c 7967  se form of Polyg
+0003e370: 6f6e 2061 6e64 2050 6f6c 796c 696e 6520  on and Polyline 
+0003e380: 7369 6e63 6520 7468 6520 6f62 6a65 6374  since the object
+0003e390: 7320 6172 6520 6e65 6172 6c79 2074 6865  s are nearly the
+0003e3a0: 2073 616d 652e 2222 220d 0a0d 0a20 2020   same."""....   
+0003e3b0: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
+0003e3c0: 6c66 2c20 2a61 7267 732c 202a 2a6b 7761  lf, *args, **kwa
+0003e3d0: 7267 7329 3a0d 0a20 2020 2020 2020 2073  rgs):..        s
+0003e3e0: 656c 662e 706f 696e 7473 203d 206c 6973  elf.points = lis
+0003e3f0: 7428 290d 0a20 2020 2020 2020 2053 6861  t()..        Sha
+0003e400: 7065 2e5f 5f69 6e69 745f 5f28 7365 6c66  pe.__init__(self
+0003e410: 2c20 2a61 7267 732c 202a 2a6b 7761 7267  , *args, **kwarg
+0003e420: 7329 0d0a 0d0a 2020 2020 6465 6620 7072  s)....    def pr
+0003e430: 6f70 6572 7479 5f62 795f 6f62 6a65 6374  operty_by_object
+0003e440: 2873 656c 662c 2073 293a 0d0a 2020 2020  (self, s):..    
+0003e450: 2020 2020 5368 6170 652e 7072 6f70 6572      Shape.proper
+0003e460: 7479 5f62 795f 6f62 6a65 6374 2873 656c  ty_by_object(sel
+0003e470: 662c 2073 290d 0a20 2020 2020 2020 2073  f, s)..        s
+0003e480: 656c 662e 5f69 6e69 745f 706f 696e 7473  elf._init_points
+0003e490: 2873 2e70 6f69 6e74 7329 0d0a 0d0a 2020  (s.points)....  
+0003e4a0: 2020 6465 6620 7072 6f70 6572 7479 5f62    def property_b
+0003e4b0: 795f 7661 6c75 6573 2873 656c 662c 2076  y_values(self, v
+0003e4c0: 616c 7565 7329 3a0d 0a20 2020 2020 2020  alues):..       
+0003e4d0: 2053 6861 7065 2e70 726f 7065 7274 795f   Shape.property_
+0003e4e0: 6279 5f76 616c 7565 7328 7365 6c66 2c20  by_values(self, 
+0003e4f0: 7661 6c75 6573 290d 0a20 2020 2020 2020  values)..       
+0003e500: 2073 656c 662e 5f69 6e69 745f 706f 696e   self._init_poin
+0003e510: 7473 2876 616c 7565 7329 0d0a 0d0a 2020  ts(values)....  
+0003e520: 2020 6465 6620 7072 6f70 6572 7479 5f62    def property_b
+0003e530: 795f 6172 6773 2873 656c 662c 202a 6172  y_args(self, *ar
+0003e540: 6773 293a 0d0a 2020 2020 2020 2020 7365  gs):..        se
+0003e550: 6c66 2e5f 696e 6974 5f70 6f69 6e74 7328  lf._init_points(
+0003e560: 6172 6773 290d 0a0d 0a20 2020 2064 6566  args)....    def
+0003e570: 205f 696e 6974 5f70 6f69 6e74 7328 7365   _init_points(se
+0003e580: 6c66 2c20 706f 696e 7473 293a 0d0a 2020  lf, points):..  
+0003e590: 2020 2020 2020 6966 206c 656e 2873 656c        if len(sel
+0003e5a0: 662e 706f 696e 7473 2920 213d 2030 3a0d  f.points) != 0:.
+0003e5b0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0003e5c0: 7572 6e0d 0a20 2020 2020 2020 2069 6620  urn..        if 
+0003e5d0: 706f 696e 7473 2069 7320 4e6f 6e65 3a0d  points is None:.
+0003e5e0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0003e5f0: 662e 706f 696e 7473 203d 206c 6973 7428  f.points = list(
+0003e600: 290d 0a20 2020 2020 2020 2020 2020 2072  )..            r
+0003e610: 6574 7572 6e0d 0a20 2020 2020 2020 2069  eturn..        i
+0003e620: 6620 6973 696e 7374 616e 6365 2870 6f69  f isinstance(poi
+0003e630: 6e74 732c 2064 6963 7429 3a0d 0a20 2020  nts, dict):..   
+0003e640: 2020 2020 2020 2020 2069 6620 5356 475f           if SVG_
+0003e650: 4154 5452 5f50 4f49 4e54 5320 696e 2070  ATTR_POINTS in p
+0003e660: 6f69 6e74 733a 0d0a 2020 2020 2020 2020  oints:..        
+0003e670: 2020 2020 2020 2020 706f 696e 7473 203d          points =
+0003e680: 2070 6f69 6e74 735b 5356 475f 4154 5452   points[SVG_ATTR
+0003e690: 5f50 4f49 4e54 535d 0d0a 2020 2020 2020  _POINTS]..      
+0003e6a0: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+0003e6b0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0003e6c0: 662e 706f 696e 7473 203d 206c 6973 7428  f.points = list(
+0003e6d0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+0003e6e0: 2020 2072 6574 7572 6e0d 0a20 2020 2020     return..     
+0003e6f0: 2020 2074 7279 3a0d 0a20 2020 2020 2020     try:..       
+0003e700: 2020 2020 2069 6620 6c65 6e28 706f 696e       if len(poin
+0003e710: 7473 2920 3d3d 2031 2061 6e64 2069 7369  ts) == 1 and isi
+0003e720: 6e73 7461 6e63 6528 706f 696e 7473 5b30  nstance(points[0
+0003e730: 5d2c 2028 6c69 7374 2c20 7475 706c 652c  ], (list, tuple,
+0003e740: 2073 7472 2929 3a0d 0a20 2020 2020 2020   str)):..       
+0003e750: 2020 2020 2020 2020 2070 6f69 6e74 7320           points 
+0003e760: 3d20 706f 696e 7473 5b30 5d0d 0a20 2020  = points[0]..   
+0003e770: 2020 2020 2065 7863 6570 7420 5479 7065       except Type
+0003e780: 4572 726f 723a 0d0a 2020 2020 2020 2020  Error:..        
+0003e790: 2020 2020 7061 7373 0d0a 2020 2020 2020      pass..      
+0003e7a0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+0003e7b0: 706f 696e 7473 2c20 7374 7229 3a0d 0a20  points, str):.. 
+0003e7c0: 2020 2020 2020 2020 2020 2066 696e 6461             finda
+0003e7d0: 6c6c 203d 2052 4547 4558 5f43 4f4f 5244  ll = REGEX_COORD
+0003e7e0: 5f50 4149 522e 6669 6e64 616c 6c28 706f  _PAIR.findall(po
+0003e7f0: 696e 7473 290d 0a20 2020 2020 2020 2020  ints)..         
+0003e800: 2020 2073 656c 662e 706f 696e 7473 203d     self.points =
+0003e810: 205b 506f 696e 7428 666c 6f61 7428 6a29   [Point(float(j)
+0003e820: 2c20 666c 6f61 7428 6b29 2920 666f 7220  , float(k)) for 
+0003e830: 6a2c 206b 2069 6e20 6669 6e64 616c 6c5d  j, k in findall]
+0003e840: 0d0a 2020 2020 2020 2020 656c 6966 2069  ..        elif i
+0003e850: 7369 6e73 7461 6e63 6528 706f 696e 7473  sinstance(points
+0003e860: 2c20 286c 6973 742c 2074 7570 6c65 2929  , (list, tuple))
+0003e870: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
+0003e880: 6620 6c65 6e28 706f 696e 7473 2920 3d3d  f len(points) ==
+0003e890: 2030 3a0d 0a20 2020 2020 2020 2020 2020   0:..           
+0003e8a0: 2020 2020 2073 656c 662e 706f 696e 7473       self.points
+0003e8b0: 203d 206c 6973 7428 290d 0a20 2020 2020   = list()..     
+0003e8c0: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+0003e8d0: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+0003e8e0: 7273 745f 706f 696e 7420 3d20 706f 696e  rst_point = poin
+0003e8f0: 7473 5b30 5d0d 0a20 2020 2020 2020 2020  ts[0]..         
+0003e900: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
+0003e910: 616e 6365 2866 6972 7374 5f70 6f69 6e74  ance(first_point
+0003e920: 2c20 2866 6c6f 6174 2c20 696e 7429 293a  , (float, int)):
+0003e930: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0003e940: 2020 2020 2020 7365 6c66 2e70 6f69 6e74        self.point
+0003e950: 7320 3d20 6c69 7374 286d 6170 2850 6f69  s = list(map(Poi
+0003e960: 6e74 2c20 7a69 7028 2a5b 6974 6572 2870  nt, zip(*[iter(p
+0003e970: 6f69 6e74 7329 5d20 2a20 3229 2929 0d0a  oints)] * 2)))..
+0003e980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003e990: 656c 6966 2069 7369 6e73 7461 6e63 6528  elif isinstance(
+0003e9a0: 6669 7273 745f 706f 696e 742c 2028 6c69  first_point, (li
+0003e9b0: 7374 2c20 7475 706c 652c 2063 6f6d 706c  st, tuple, compl
+0003e9c0: 6578 2c20 7374 722c 2050 6f69 6e74 2929  ex, str, Point))
+0003e9d0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0003e9e0: 2020 2020 2020 2073 656c 662e 706f 696e         self.poin
+0003e9f0: 7473 203d 206c 6973 7428 6d61 7028 506f  ts = list(map(Po
+0003ea00: 696e 742c 2070 6f69 6e74 7329 290d 0a20  int, points)).. 
+0003ea10: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+0003ea20: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+0003ea30: 6f69 6e74 7320 3d20 6c69 7374 2829 0d0a  oints = list()..
+0003ea40: 0d0a 2020 2020 6465 6620 5f5f 7265 7072  ..    def __repr
+0003ea50: 5f5f 2873 656c 6629 3a0d 0a20 2020 2020  __(self):..     
+0003ea60: 2020 2076 616c 7565 7320 3d20 5b5d 0d0a     values = []..
+0003ea70: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+0003ea80: 706f 696e 7473 2069 7320 6e6f 7420 4e6f  points is not No
+0003ea90: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
+0003eaa0: 2073 203d 2022 2022 2e6a 6f69 6e28 6d61   s = " ".join(ma
+0003eab0: 7028 7374 722c 2073 656c 662e 706f 696e  p(str, self.poin
+0003eac0: 7473 2929 0d0a 2020 2020 2020 2020 2020  ts))..          
+0003ead0: 2020 7661 6c75 6573 2e61 7070 656e 6428    values.append(
+0003eae0: 2225 733d 2725 7327 2220 2520 2853 5647  "%s='%s'" % (SVG
+0003eaf0: 5f41 5454 525f 504f 494e 5453 2c20 7329  _ATTR_POINTS, s)
+0003eb00: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+0003eb10: 5f72 6570 725f 7368 6170 6528 7661 6c75  _repr_shape(valu
+0003eb20: 6573 290d 0a20 2020 2020 2020 2070 6172  es)..        par
+0003eb30: 616d 7320 3d20 222c 2022 2e6a 6f69 6e28  ams = ", ".join(
+0003eb40: 7661 6c75 6573 290d 0a20 2020 2020 2020  values)..       
+0003eb50: 2072 6574 7572 6e20 2225 7328 2573 2922   return "%s(%s)"
+0003eb60: 2025 2028 7365 6c66 2e5f 5f63 6c61 7373   % (self.__class
+0003eb70: 5f5f 2e5f 5f6e 616d 655f 5f2c 2070 6172  __.__name__, par
+0003eb80: 616d 7329 0d0a 0d0a 2020 2020 6465 6620  ams)....    def 
+0003eb90: 5f5f 7374 725f 5f28 7365 6c66 293a 0d0a  __str__(self):..
+0003eba0: 2020 2020 2020 2020 7661 6c75 6573 203d          values =
+0003ebb0: 205b 5d0d 0a20 2020 2020 2020 2069 6620   []..        if 
+0003ebc0: 7365 6c66 2e70 6f69 6e74 7320 6973 206e  self.points is n
+0003ebd0: 6f74 204e 6f6e 653a 0d0a 2020 2020 2020  ot None:..      
+0003ebe0: 2020 2020 2020 7320 3d20 2220 222e 6a6f        s = " ".jo
+0003ebf0: 696e 286d 6170 2873 7472 2c20 7365 6c66  in(map(str, self
+0003ec00: 2e70 6f69 6e74 7329 290d 0a20 2020 2020  .points))..     
+0003ec10: 2020 2020 2020 2076 616c 7565 732e 6170         values.ap
+0003ec20: 7065 6e64 2822 2573 3d27 2573 2722 2025  pend("%s='%s'" %
+0003ec30: 2028 5356 475f 4154 5452 5f50 4f49 4e54   (SVG_ATTR_POINT
+0003ec40: 532c 2073 2929 0d0a 2020 2020 2020 2020  S, s))..        
+0003ec50: 7365 6c66 2e5f 7374 725f 7368 6170 6528  self._str_shape(
+0003ec60: 7661 6c75 6573 290d 0a20 2020 2020 2020  values)..       
+0003ec70: 2070 6172 616d 7320 3d20 222c 2022 2e6a   params = ", ".j
+0003ec80: 6f69 6e28 7661 6c75 6573 290d 0a20 2020  oin(values)..   
+0003ec90: 2020 2020 2072 6574 7572 6e20 2225 7328       return "%s(
+0003eca0: 2573 2922 2025 2028 7365 6c66 2e5f 5f63  %s)" % (self.__c
+0003ecb0: 6c61 7373 5f5f 2e5f 5f6e 616d 655f 5f2c  lass__.__name__,
+0003ecc0: 2070 6172 616d 7329 0d0a 0d0a 2020 2020   params)....    
+0003ecd0: 6465 6620 5f5f 6c65 6e5f 5f28 7365 6c66  def __len__(self
+0003ece0: 293a 0d0a 2020 2020 2020 2020 7265 7475  ):..        retu
+0003ecf0: 726e 206c 656e 2873 656c 662e 706f 696e  rn len(self.poin
+0003ed00: 7473 290d 0a0d 0a20 2020 2064 6566 205f  ts)....    def _
+0003ed10: 5f67 6574 6974 656d 5f5f 2873 656c 662c  _getitem__(self,
+0003ed20: 2069 7465 6d29 3a0d 0a20 2020 2020 2020   item):..       
+0003ed30: 2072 6574 7572 6e20 7365 6c66 2e70 6f69   return self.poi
+0003ed40: 6e74 735b 6974 656d 5d0d 0a0d 0a20 2020  nts[item]....   
+0003ed50: 2064 6566 2073 6567 6d65 6e74 7328 7365   def segments(se
+0003ed60: 6c66 2c20 7472 616e 7366 6f72 6d65 643d  lf, transformed=
+0003ed70: 5472 7565 293a 0d0a 2020 2020 2020 2020  True):..        
+0003ed80: 2222 220d 0a20 2020 2020 2020 2050 6f6c  """..        Pol
+0003ed90: 796c 696e 6520 616e 6420 506f 6c79 676f  yline and Polygo
+0003eda0: 6e20 6465 636f 6d70 6f73 6974 696f 6e20  n decomposition 
+0003edb0: 6973 2067 6976 656e 2069 6e20 5356 4732  is given in SVG2
+0003edc0: 2e20 3130 2e36 2061 6e64 2031 302e 370d  . 10.6 and 10.7.
+0003edd0: 0a0d 0a20 2020 2020 2020 202a 2070 6572  ...        * per
+0003ede0: 666f 726d 2061 6e20 6162 736f 6c75 7465  form an absolute
+0003edf0: 206d 6f76 6574 6f20 6f70 6572 6174 696f   moveto operatio
+0003ee00: 6e20 746f 2074 6865 2066 6972 7374 2063  n to the first c
+0003ee10: 6f6f 7264 696e 6174 6520 7061 6972 2069  oordinate pair i
+0003ee20: 6e20 7468 6520 6c69 7374 206f 6620 706f  n the list of po
+0003ee30: 696e 7473 0d0a 2020 2020 2020 2020 2a20  ints..        * 
+0003ee40: 666f 7220 6561 6368 2073 7562 7365 7175  for each subsequ
+0003ee50: 656e 7420 636f 6f72 6469 6e61 7465 2070  ent coordinate p
+0003ee60: 6169 722c 2070 6572 666f 726d 2061 6e20  air, perform an 
+0003ee70: 6162 736f 6c75 7465 206c 696e 6574 6f20  absolute lineto 
+0003ee80: 6f70 6572 6174 696f 6e20 746f 2074 6861  operation to tha
+0003ee90: 7420 636f 6f72 6469 6e61 7465 2070 6169  t coordinate pai
+0003eea0: 722e 0d0a 2020 2020 2020 2020 2a20 2850  r...        * (P
+0003eeb0: 6f6c 7967 6f6e 2d6f 6e6c 7929 2070 6572  olygon-only) per
+0003eec0: 666f 726d 2061 2063 6c6f 7365 7061 7468  form a closepath
+0003eed0: 2063 6f6d 6d61 6e64 0d0a 0d0a 2020 2020   command....    
+0003eee0: 2020 2020 4e6f 7465 3a20 2046 6f72 2061      Note:  For a
+0003eef0: 2070 6f6c 7967 6f6e 2f70 6f6c 796c 696e   polygon/polylin
+0003ef00: 6520 6d61 6465 2066 726f 6d20 6e20 706f  e made from n po
+0003ef10: 696e 7473 2c20 7468 6520 7265 7375 6c74  ints, the result
+0003ef20: 696e 6720 7061 7468 2077 696c 6c0d 0a20  ing path will.. 
+0003ef30: 2020 2020 2020 2062 6520 636f 6d70 6f73         be compos
+0003ef40: 6564 206f 6620 6e20 6c69 6e65 7320 2865  ed of n lines (e
+0003ef50: 7665 6e20 6966 2073 6f6d 6520 6f66 2074  ven if some of t
+0003ef60: 6865 7365 206c 696e 6573 2068 6176 6520  hese lines have 
+0003ef70: 6c65 6e67 7468 207a 6572 6f29 2e0d 0a20  length zero)... 
+0003ef80: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
+0003ef90: 2020 2020 6966 2073 656c 662e 7472 616e      if self.tran
+0003efa0: 7366 6f72 6d2e 6973 5f69 6465 6e74 6974  sform.is_identit
+0003efb0: 7928 2920 6f72 206e 6f74 2074 7261 6e73  y() or not trans
+0003efc0: 666f 726d 6564 3a0d 0a20 2020 2020 2020  formed:..       
+0003efd0: 2020 2020 2070 6f69 6e74 7320 3d20 7365       points = se
+0003efe0: 6c66 2e70 6f69 6e74 730d 0a20 2020 2020  lf.points..     
+0003eff0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+0003f000: 2020 2020 2020 706f 696e 7473 203d 206c        points = l
+0003f010: 6973 7428 6d61 7028 7365 6c66 2e74 7261  ist(map(self.tra
+0003f020: 6e73 666f 726d 2e70 6f69 6e74 5f69 6e5f  nsform.point_in_
+0003f030: 6d61 7472 6978 5f73 7061 6365 2c20 7365  matrix_space, se
+0003f040: 6c66 2e70 6f69 6e74 7329 290d 0a20 2020  lf.points))..   
+0003f050: 2020 2020 2069 6620 7365 6c66 2e69 735f       if self.is_
+0003f060: 6465 6765 6e65 7261 7465 2829 3a0d 0a20  degenerate():.. 
+0003f070: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0003f080: 6e20 5b5d 0d0a 2020 2020 2020 2020 7365  n []..        se
+0003f090: 676d 656e 7473 203d 205b 4d6f 7665 284e  gments = [Move(N
+0003f0a0: 6f6e 652c 2070 6f69 6e74 735b 305d 295d  one, points[0])]
+0003f0b0: 0d0a 2020 2020 2020 2020 6c61 7374 203d  ..        last =
+0003f0c0: 2070 6f69 6e74 735b 305d 0d0a 2020 2020   points[0]..    
+0003f0d0: 2020 2020 666f 7220 6920 696e 2072 616e      for i in ran
+0003f0e0: 6765 2831 2c20 6c65 6e28 706f 696e 7473  ge(1, len(points
+0003f0f0: 2929 3a0d 0a20 2020 2020 2020 2020 2020  )):..           
+0003f100: 2063 7572 7265 6e74 203d 2070 6f69 6e74   current = point
+0003f110: 735b 695d 0d0a 2020 2020 2020 2020 2020  s[i]..          
+0003f120: 2020 7365 676d 656e 7473 2e61 7070 656e    segments.appen
+0003f130: 6428 4c69 6e65 286c 6173 742c 2063 7572  d(Line(last, cur
+0003f140: 7265 6e74 2929 0d0a 2020 2020 2020 2020  rent))..        
+0003f150: 2020 2020 6c61 7374 203d 2063 7572 7265      last = curre
+0003f160: 6e74 0d0a 2020 2020 2020 2020 6966 2069  nt..        if i
+0003f170: 7369 6e73 7461 6e63 6528 7365 6c66 2c20  sinstance(self, 
+0003f180: 506f 6c79 676f 6e29 3a0d 0a20 2020 2020  Polygon):..     
+0003f190: 2020 2020 2020 2073 6567 6d65 6e74 732e         segments.
+0003f1a0: 6170 7065 6e64 2843 6c6f 7365 286c 6173  append(Close(las
+0003f1b0: 742c 2070 6f69 6e74 735b 305d 2929 0d0a  t, points[0]))..
+0003f1c0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+0003f1d0: 6567 6d65 6e74 730d 0a0d 0a20 2020 2064  egments....    d
+0003f1e0: 6566 2072 6569 6679 2873 656c 6629 3a0d  ef reify(self):.
+0003f1f0: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
+0003f200: 2020 2020 2020 5265 616c 697a 6573 2074        Realizes t
+0003f210: 6865 2074 7261 6e73 666f 726d 2074 6f20  he transform to 
+0003f220: 7468 6520 7368 6170 6520 7072 6f70 6572  the shape proper
+0003f230: 7469 6573 2e0d 0a0d 0a20 2020 2020 2020  ties.....       
+0003f240: 2050 6f6c 7973 6861 7065 7320 6172 6520   Polyshapes are 
+0003f250: 7065 7266 6563 746c 7920 7265 6966 6965  perfectly reifie
+0003f260: 642e 0d0a 2020 2020 2020 2020 2222 220d  d...        """.
+0003f270: 0a20 2020 2020 2020 2047 7261 7068 6963  .        Graphic
+0003f280: 4f62 6a65 6374 2e72 6569 6679 2873 656c  Object.reify(sel
+0003f290: 6629 0d0a 2020 2020 2020 2020 5472 616e  f)..        Tran
+0003f2a0: 7366 6f72 6d61 626c 652e 7265 6966 7928  sformable.reify(
+0003f2b0: 7365 6c66 290d 0a20 2020 2020 2020 206d  self)..        m
+0003f2c0: 6174 7269 7820 3d20 7365 6c66 2e74 7261  atrix = self.tra
+0003f2d0: 6e73 666f 726d 0d0a 2020 2020 2020 2020  nsform..        
+0003f2e0: 666f 7220 7020 696e 2073 656c 663a 0d0a  for p in self:..
+0003f2f0: 2020 2020 2020 2020 2020 2020 7020 2a3d              p *=
+0003f300: 206d 6174 7269 780d 0a20 2020 2020 2020   matrix..       
+0003f310: 206d 6174 7269 782e 7265 7365 7428 290d   matrix.reset().
+0003f320: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0003f330: 7365 6c66 0d0a 0d0a 2020 2020 6465 6620  self....    def 
+0003f340: 6973 5f64 6567 656e 6572 6174 6528 7365  is_degenerate(se
+0003f350: 6c66 293a 0d0a 2020 2020 2020 2020 7265  lf):..        re
+0003f360: 7475 726e 206c 656e 2873 656c 662e 706f  turn len(self.po
+0003f370: 696e 7473 2920 3d3d 2030 0d0a 0d0a 0d0a  ints) == 0......
+0003f380: 636c 6173 7320 506f 6c79 6c69 6e65 285f  class Polyline(_
+0003f390: 506f 6c79 7368 6170 6529 3a0d 0a20 2020  Polyshape):..   
+0003f3a0: 2022 2222 0d0a 2020 2020 5356 4720 506f   """..    SVG Po
+0003f3b0: 6c79 6c69 6e65 2073 6861 7065 7320 6172  lyline shapes ar
+0003f3c0: 6520 6465 6669 6e65 6420 696e 2053 5647  e defined in SVG
+0003f3d0: 3220 3130 2e36 0d0a 2020 2020 6874 7470  2 10.6..    http
+0003f3e0: 733a 2f2f 7777 772e 7733 2e6f 7267 2f54  s://www.w3.org/T
+0003f3f0: 522f 5356 4732 2f73 6861 7065 732e 6874  R/SVG2/shapes.ht
+0003f400: 6d6c 2350 6f6c 796c 696e 6545 6c65 6d65  ml#PolylineEleme
+0003f410: 6e74 0d0a 0d0a 2020 2020 5468 6573 6520  nt....    These 
+0003f420: 6861 7665 2067 656f 6d65 7472 6963 2070  have geometric p
+0003f430: 726f 7065 7274 6965 7320 706f 696e 7473  roperties points
+0003f440: 0d0a 2020 2020 2222 220d 0a0d 0a20 2020  ..    """....   
+0003f450: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
+0003f460: 6c66 2c20 2a61 7267 732c 202a 2a6b 7761  lf, *args, **kwa
+0003f470: 7267 7329 3a0d 0a20 2020 2020 2020 205f  rgs):..        _
+0003f480: 506f 6c79 7368 6170 652e 5f5f 696e 6974  Polyshape.__init
+0003f490: 5f5f 2873 656c 662c 202a 6172 6773 2c20  __(self, *args, 
+0003f4a0: 2a2a 6b77 6172 6773 290d 0a0d 0a20 2020  **kwargs)....   
+0003f4b0: 2064 6566 205f 5f63 6f70 795f 5f28 7365   def __copy__(se
+0003f4c0: 6c66 293a 0d0a 2020 2020 2020 2020 7265  lf):..        re
+0003f4d0: 7475 726e 2050 6f6c 796c 696e 6528 7365  turn Polyline(se
+0003f4e0: 6c66 290d 0a0d 0a20 2020 2064 6566 205f  lf)....    def _
+0003f4f0: 6e61 6d65 2873 656c 6629 3a0d 0a20 2020  name(self):..   
+0003f500: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+0003f510: 2e5f 5f63 6c61 7373 5f5f 2e5f 5f6e 616d  .__class__.__nam
+0003f520: 655f 5f0d 0a0d 0a0d 0a63 6c61 7373 2050  e__......class P
+0003f530: 6f6c 7967 6f6e 285f 506f 6c79 7368 6170  olygon(_Polyshap
+0003f540: 6529 3a0d 0a20 2020 2022 2222 0d0a 2020  e):..    """..  
+0003f550: 2020 5356 4720 506f 6c79 676f 6e20 7368    SVG Polygon sh
+0003f560: 6170 6573 2061 7265 2064 6566 696e 6564  apes are defined
+0003f570: 2069 6e20 5356 4732 2031 302e 370d 0a20   in SVG2 10.7.. 
+0003f580: 2020 2068 7474 7073 3a2f 2f77 7777 2e77     https://www.w
+0003f590: 332e 6f72 672f 5452 2f53 5647 322f 7368  3.org/TR/SVG2/sh
+0003f5a0: 6170 6573 2e68 746d 6c23 506f 6c79 676f  apes.html#Polygo
+0003f5b0: 6e45 6c65 6d65 6e74 0d0a 0d0a 2020 2020  nElement....    
+0003f5c0: 5468 6573 6520 6861 7665 2067 656f 6d65  These have geome
+0003f5d0: 7472 6963 2070 726f 7065 7274 6965 7320  tric properties 
+0003f5e0: 706f 696e 7473 0d0a 2020 2020 2222 220d  points..    """.
+0003f5f0: 0a0d 0a20 2020 2064 6566 205f 5f69 6e69  ...    def __ini
+0003f600: 745f 5f28 7365 6c66 2c20 2a61 7267 732c  t__(self, *args,
+0003f610: 202a 2a6b 7761 7267 7329 3a0d 0a20 2020   **kwargs):..   
+0003f620: 2020 2020 205f 506f 6c79 7368 6170 652e       _Polyshape.
+0003f630: 5f5f 696e 6974 5f5f 2873 656c 662c 202a  __init__(self, *
+0003f640: 6172 6773 2c20 2a2a 6b77 6172 6773 290d  args, **kwargs).
+0003f650: 0a0d 0a20 2020 2064 6566 205f 5f63 6f70  ...    def __cop
+0003f660: 795f 5f28 7365 6c66 293a 0d0a 2020 2020  y__(self):..    
+0003f670: 2020 2020 7265 7475 726e 2050 6f6c 7967      return Polyg
+0003f680: 6f6e 2873 656c 6629 0d0a 0d0a 2020 2020  on(self)....    
+0003f690: 6465 6620 5f6e 616d 6528 7365 6c66 293a  def _name(self):
+0003f6a0: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+0003f6b0: 2073 656c 662e 5f5f 636c 6173 735f 5f2e   self.__class__.
+0003f6c0: 5f5f 6e61 6d65 5f5f 0d0a 0d0a 0d0a 636c  __name__......cl
+0003f6d0: 6173 7320 5375 6270 6174 683a 0d0a 2020  ass Subpath:..  
+0003f6e0: 2020 2222 220d 0a20 2020 2053 7562 7061    """..    Subpa
+0003f6f0: 7468 2069 7320 6120 5061 7468 2d62 6163  th is a Path-bac
+0003f700: 6b65 6420 7769 6e64 6f77 2069 6d70 6c65  ked window imple
+0003f710: 6d65 6e74 6174 696f 6e2e 2049 7420 646f  mentation. It do
+0003f720: 6573 206e 6f74 2073 746f 7265 2061 206c  es not store a l
+0003f730: 6973 7420 6f66 2073 6567 6d65 6e74 7320  ist of segments 
+0003f740: 6275 7420 7261 7468 6572 0d0a 2020 2020  but rather..    
+0003f750: 7374 6f72 6573 2061 2050 6174 682c 2073  stores a Path, s
+0003f760: 7461 7274 2070 6f73 6974 696f 6e2c 2065  tart position, e
+0003f770: 6e64 2070 6f73 6974 696f 6e2e 2057 6865  nd position. Whe
+0003f780: 6e20 6120 6675 6e63 7469 6f6e 2069 7320  n a function is 
+0003f790: 6361 6c6c 6564 206f 6e20 6120 7375 6270  called on a subp
+0003f7a0: 6174 682c 2074 6865 2072 6573 756c 7420  ath, the result 
+0003f7b0: 6f66 0d0a 2020 2020 7468 6f73 6520 6576  of..    those ev
+0003f7c0: 656e 7473 2069 7320 7065 7266 6f72 6d65  ents is performe
+0003f7d0: 6420 6f6e 2074 6865 2062 6163 6b69 6e67  d on the backing
+0003f7e0: 2050 6174 682e 2057 6865 6e20 7468 6520   Path. When the 
+0003f7f0: 6261 636b 696e 6720 5061 7468 2069 7320  backing Path is 
+0003f800: 6d6f 6469 6669 6564 2074 6865 2062 6568  modified the beh
+0003f810: 6176 696f 7220 6973 0d0a 2020 2020 756e  avior is..    un
+0003f820: 6465 6669 6e65 642e 2222 220d 0a0d 0a20  defined.""".... 
+0003f830: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
+0003f840: 7365 6c66 2c20 7061 7468 2c20 7374 6172  self, path, star
+0003f850: 742c 2065 6e64 293a 0d0a 2020 2020 2020  t, end):..      
+0003f860: 2020 7365 6c66 2e5f 7061 7468 203d 2070    self._path = p
+0003f870: 6174 680d 0a20 2020 2020 2020 2073 656c  ath..        sel
+0003f880: 662e 5f73 7461 7274 203d 2073 7461 7274  f._start = start
+0003f890: 0d0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
+0003f8a0: 656e 6420 3d20 656e 640d 0a0d 0a20 2020  end = end....   
+0003f8b0: 2064 6566 205f 5f63 6f70 795f 5f28 7365   def __copy__(se
+0003f8c0: 6c66 293a 0d0a 2020 2020 2020 2020 7265  lf):..        re
+0003f8d0: 7475 726e 2053 7562 7061 7468 2850 6174  turn Subpath(Pat
+0003f8e0: 6828 7365 6c66 2e5f 7061 7468 292c 2073  h(self._path), s
+0003f8f0: 656c 662e 5f73 7461 7274 2c20 7365 6c66  elf._start, self
+0003f900: 2e5f 656e 6429 0d0a 0d0a 2020 2020 6465  ._end)....    de
+0003f910: 6620 5f5f 6765 7469 7465 6d5f 5f28 7365  f __getitem__(se
+0003f920: 6c66 2c20 696e 6465 7829 3a0d 0a20 2020  lf, index):..   
+0003f930: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+0003f940: 2e5f 7061 7468 5b73 656c 662e 696e 6465  ._path[self.inde
+0003f950: 785f 746f 5f70 6174 685f 696e 6465 7828  x_to_path_index(
+0003f960: 696e 6465 7829 5d0d 0a0d 0a20 2020 2064  index)]....    d
+0003f970: 6566 205f 5f73 6574 6974 656d 5f5f 2873  ef __setitem__(s
+0003f980: 656c 662c 2069 6e64 6578 2c20 7661 6c75  elf, index, valu
+0003f990: 6529 3a0d 0a20 2020 2020 2020 2073 656c  e):..        sel
+0003f9a0: 662e 5f70 6174 685b 7365 6c66 2e69 6e64  f._path[self.ind
+0003f9b0: 6578 5f74 6f5f 7061 7468 5f69 6e64 6578  ex_to_path_index
+0003f9c0: 2869 6e64 6578 295d 203d 2076 616c 7565  (index)] = value
+0003f9d0: 0d0a 0d0a 2020 2020 6465 6620 5f5f 6465  ....    def __de
+0003f9e0: 6c69 7465 6d5f 5f28 7365 6c66 2c20 696e  litem__(self, in
+0003f9f0: 6465 7829 3a0d 0a20 2020 2020 2020 2064  dex):..        d
+0003fa00: 656c 2073 656c 662e 5f70 6174 685b 7365  el self._path[se
+0003fa10: 6c66 2e69 6e64 6578 5f74 6f5f 7061 7468  lf.index_to_path
+0003fa20: 5f69 6e64 6578 2869 6e64 6578 295d 0d0a  _index(index)]..
+0003fa30: 2020 2020 2020 2020 7365 6c66 2e5f 656e          self._en
+0003fa40: 6420 2d3d 2031 0d0a 0d0a 2020 2020 6465  d -= 1....    de
+0003fa50: 6620 5f5f 6961 6464 5f5f 2873 656c 662c  f __iadd__(self,
+0003fa60: 206f 7468 6572 293a 0d0a 2020 2020 2020   other):..      
+0003fa70: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+0003fa80: 6f74 6865 722c 2073 7472 293a 0d0a 2020  other, str):..  
+0003fa90: 2020 2020 2020 2020 2020 7020 3d20 5061            p = Pa
+0003faa0: 7468 286f 7468 6572 290d 0a20 2020 2020  th(other)..     
+0003fab0: 2020 2020 2020 2073 656c 662e 5f70 6174         self._pat
+0003fac0: 685b 7365 6c66 2e5f 656e 6420 3a20 7365  h[self._end : se
+0003fad0: 6c66 2e5f 656e 645d 203d 2070 0d0a 2020  lf._end] = p..  
+0003fae0: 2020 2020 2020 656c 6966 2069 7369 6e73        elif isins
+0003faf0: 7461 6e63 6528 6f74 6865 722c 2050 6174  tance(other, Pat
+0003fb00: 6829 3a0d 0a20 2020 2020 2020 2020 2020  h):..           
+0003fb10: 2070 203d 2063 6f70 7928 6f74 6865 7229   p = copy(other)
+0003fb20: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+0003fb30: 6c66 2e5f 7061 7468 5b73 656c 662e 5f65  lf._path[self._e
+0003fb40: 6e64 203a 2073 656c 662e 5f65 6e64 5d20  nd : self._end] 
+0003fb50: 3d20 700d 0a20 2020 2020 2020 2065 6c69  = p..        eli
+0003fb60: 6620 6973 696e 7374 616e 6365 286f 7468  f isinstance(oth
+0003fb70: 6572 2c20 5061 7468 5365 676d 656e 7429  er, PathSegment)
+0003fb80: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
+0003fb90: 656c 662e 5f70 6174 682e 696e 7365 7274  elf._path.insert
+0003fba0: 2873 656c 662e 5f65 6e64 2c20 6f74 6865  (self._end, othe
+0003fbb0: 7229 0d0a 2020 2020 2020 2020 656c 7365  r)..        else
+0003fbc0: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
+0003fbd0: 6574 7572 6e20 4e6f 7449 6d70 6c65 6d65  eturn NotImpleme
+0003fbe0: 6e74 6564 0d0a 2020 2020 2020 2020 7265  nted..        re
+0003fbf0: 7475 726e 2073 656c 660d 0a0d 0a20 2020  turn self....   
+0003fc00: 2064 6566 205f 5f61 6464 5f5f 2873 656c   def __add__(sel
+0003fc10: 662c 206f 7468 6572 293a 0d0a 2020 2020  f, other):..    
+0003fc20: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+0003fc30: 6528 6f74 6865 722c 2028 7374 722c 2050  e(other, (str, P
+0003fc40: 6174 682c 2050 6174 6853 6567 6d65 6e74  ath, PathSegment
+0003fc50: 2929 3a0d 0a20 2020 2020 2020 2020 2020  )):..           
+0003fc60: 206e 203d 2063 6f70 7928 7365 6c66 290d   n = copy(self).
+0003fc70: 0a20 2020 2020 2020 2020 2020 206e 202b  .            n +
+0003fc80: 3d20 6f74 6865 720d 0a20 2020 2020 2020  = other..       
+0003fc90: 2020 2020 2072 6574 7572 6e20 6e0d 0a20       return n.. 
+0003fca0: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
+0003fcb0: 7449 6d70 6c65 6d65 6e74 6564 0d0a 0d0a  tImplemented....
+0003fcc0: 2020 2020 6465 6620 5f5f 7261 6464 5f5f      def __radd__
+0003fcd0: 2873 656c 662c 206f 7468 6572 293a 0d0a  (self, other):..
+0003fce0: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+0003fcf0: 7461 6e63 6528 6f74 6865 722c 2073 7472  tance(other, str
+0003fd00: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+0003fd10: 7061 7468 203d 2050 6174 6828 6f74 6865  path = Path(othe
+0003fd20: 7229 0d0a 2020 2020 2020 2020 2020 2020  r)..            
+0003fd30: 7061 7468 2e65 7874 656e 6428 6d61 7028  path.extend(map(
+0003fd40: 636f 7079 2c20 7365 6c66 2e5f 7061 7468  copy, self._path
+0003fd50: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
+0003fd60: 7265 7475 726e 2070 6174 680d 0a20 2020  return path..   
+0003fd70: 2020 2020 2065 6c69 6620 6973 696e 7374       elif isinst
+0003fd80: 616e 6365 286f 7468 6572 2c20 5061 7468  ance(other, Path
+0003fd90: 5365 676d 656e 7429 3a0d 0a20 2020 2020  Segment):..     
+0003fda0: 2020 2020 2020 2070 6174 6820 3d20 5061         path = Pa
+0003fdb0: 7468 2873 656c 6629 0d0a 2020 2020 2020  th(self)..      
+0003fdc0: 2020 2020 2020 7061 7468 2e69 6e73 6572        path.inser
+0003fdd0: 7428 302c 206f 7468 6572 290d 0a20 2020  t(0, other)..   
+0003fde0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0003fdf0: 7061 7468 0d0a 2020 2020 2020 2020 656c  path..        el
+0003fe00: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+0003fe10: 2072 6574 7572 6e20 4e6f 7449 6d70 6c65   return NotImple
+0003fe20: 6d65 6e74 6564 0d0a 0d0a 2020 2020 6465  mented....    de
+0003fe30: 6620 5f5f 696d 756c 5f5f 2873 656c 662c  f __imul__(self,
+0003fe40: 206f 7468 6572 293a 0d0a 2020 2020 2020   other):..      
+0003fe50: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+0003fe60: 6f74 6865 722c 2073 7472 293a 0d0a 2020  other, str):..  
+0003fe70: 2020 2020 2020 2020 2020 6f74 6865 7220            other 
+0003fe80: 3d20 4d61 7472 6978 286f 7468 6572 290d  = Matrix(other).
+0003fe90: 0a20 2020 2020 2020 2069 6620 6973 696e  .        if isin
+0003fea0: 7374 616e 6365 286f 7468 6572 2c20 4d61  stance(other, Ma
+0003feb0: 7472 6978 293a 0d0a 2020 2020 2020 2020  trix):..        
+0003fec0: 2020 2020 666f 7220 6520 696e 2073 656c      for e in sel
+0003fed0: 663a 0d0a 2020 2020 2020 2020 2020 2020  f:..            
+0003fee0: 2020 2020 6520 2a3d 206f 7468 6572 0d0a      e *= other..
+0003fef0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+0003ff00: 656c 660d 0a0d 0a20 2020 2064 6566 205f  elf....    def _
+0003ff10: 5f6d 756c 5f5f 2873 656c 662c 206f 7468  _mul__(self, oth
+0003ff20: 6572 293a 0d0a 2020 2020 2020 2020 6966  er):..        if
+0003ff30: 2069 7369 6e73 7461 6e63 6528 6f74 6865   isinstance(othe
+0003ff40: 722c 2028 4d61 7472 6978 2c20 7374 7229  r, (Matrix, str)
+0003ff50: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+0003ff60: 6e20 3d20 636f 7079 2873 656c 6629 0d0a  n = copy(self)..
+0003ff70: 2020 2020 2020 2020 2020 2020 6e20 2a3d              n *=
+0003ff80: 206f 7468 6572 0d0a 2020 2020 2020 2020   other..        
+0003ff90: 2020 2020 7265 7475 726e 206e 0d0a 2020      return n..  
+0003ffa0: 2020 2020 2020 7265 7475 726e 204e 6f74        return Not
+0003ffb0: 496d 706c 656d 656e 7465 640d 0a0d 0a20  Implemented.... 
+0003ffc0: 2020 205f 5f72 6d75 6c5f 5f20 3d20 5f5f     __rmul__ = __
+0003ffd0: 6d75 6c5f 5f0d 0a0d 0a20 2020 2064 6566  mul__....    def
+0003ffe0: 205f 5f69 7465 725f 5f28 7365 6c66 293a   __iter__(self):
+0003fff0: 0d0a 2020 2020 2020 2020 636c 6173 7320  ..        class 
+00040000: 4974 6572 6174 6f72 3a0d 0a20 2020 2020  Iterator:..     
+00040010: 2020 2020 2020 2064 6566 205f 5f69 6e69         def __ini
+00040020: 745f 5f28 7365 6c66 2c20 7375 6270 6174  t__(self, subpat
+00040030: 6829 3a0d 0a20 2020 2020 2020 2020 2020  h):..           
+00040040: 2020 2020 2073 656c 662e 6e20 3d20 7375       self.n = su
+00040050: 6270 6174 682e 5f73 7461 7274 202d 2031  bpath._start - 1
+00040060: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00040070: 2020 7365 6c66 2e73 7562 7061 7468 203d    self.subpath =
+00040080: 2073 7562 7061 7468 0d0a 0d0a 2020 2020   subpath....    
+00040090: 2020 2020 2020 2020 6465 6620 5f5f 6e65          def __ne
+000400a0: 7874 5f5f 2873 656c 6629 3a0d 0a20 2020  xt__(self):..   
+000400b0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+000400c0: 662e 6e20 2b3d 2031 0d0a 2020 2020 2020  f.n += 1..      
+000400d0: 2020 2020 2020 2020 2020 7472 793a 0d0a            try:..
+000400e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000400f0: 2020 2020 6966 2073 656c 662e 6e20 3e20      if self.n > 
+00040100: 7365 6c66 2e73 7562 7061 7468 2e5f 656e  self.subpath._en
+00040110: 643a 0d0a 2020 2020 2020 2020 2020 2020  d:..            
+00040120: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00040130: 6520 5374 6f70 4974 6572 6174 696f 6e0d  e StopIteration.
+00040140: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00040150: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00040160: 2e73 7562 7061 7468 2e5f 7061 7468 5b73  .subpath._path[s
+00040170: 656c 662e 6e5d 0d0a 2020 2020 2020 2020  elf.n]..        
+00040180: 2020 2020 2020 2020 6578 6365 7074 2049          except I
+00040190: 6e64 6578 4572 726f 723a 0d0a 2020 2020  ndexError:..    
+000401a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000401b0: 7261 6973 6520 5374 6f70 4974 6572 6174  raise StopIterat
+000401c0: 696f 6e0d 0a0d 0a20 2020 2020 2020 2020  ion....         
+000401d0: 2020 206e 6578 7420 3d20 5f5f 6e65 7874     next = __next
+000401e0: 5f5f 0d0a 0d0a 2020 2020 2020 2020 7265  __....        re
+000401f0: 7475 726e 2049 7465 7261 746f 7228 7365  turn Iterator(se
+00040200: 6c66 290d 0a0d 0a20 2020 2064 6566 205f  lf)....    def _
+00040210: 5f6c 656e 5f5f 2873 656c 6629 3a0d 0a20  _len__(self):.. 
+00040220: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+00040230: 6c66 2e5f 656e 6420 2d20 7365 6c66 2e5f  lf._end - self._
+00040240: 7374 6172 7420 2b20 310d 0a0d 0a20 2020  start + 1....   
+00040250: 2064 6566 205f 5f73 7472 5f5f 2873 656c   def __str__(sel
+00040260: 6629 3a0d 0a20 2020 2020 2020 2072 6574  f):..        ret
+00040270: 7572 6e20 7365 6c66 2e64 2829 0d0a 0d0a  urn self.d()....
+00040280: 2020 2020 6465 6620 5f5f 7265 7072 5f5f      def __repr__
+00040290: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
+000402a0: 2072 6574 7572 6e20 2250 6174 6828 2573   return "Path(%s
+000402b0: 2922 2025 2028 222c 2022 2e6a 6f69 6e28  )" % (", ".join(
+000402c0: 7265 7072 2878 2920 666f 7220 7820 696e  repr(x) for x in
+000402d0: 2073 656c 6629 290d 0a0d 0a20 2020 2064   self))....    d
+000402e0: 6566 205f 5f65 715f 5f28 7365 6c66 2c20  ef __eq__(self, 
+000402f0: 6f74 6865 7229 3a0d 0a20 2020 2020 2020  other):..       
+00040300: 2069 6620 6973 696e 7374 616e 6365 286f   if isinstance(o
+00040310: 7468 6572 2c20 7374 7229 3a0d 0a20 2020  ther, str):..   
+00040320: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00040330: 7365 6c66 2e5f 5f65 715f 5f28 5061 7468  self.__eq__(Path
+00040340: 286f 7468 6572 2929 0d0a 2020 2020 2020  (other))..      
+00040350: 2020 6966 206e 6f74 2069 7369 6e73 7461    if not isinsta
+00040360: 6e63 6528 6f74 6865 722c 2028 5061 7468  nce(other, (Path
+00040370: 2c20 5375 6270 6174 6829 293a 0d0a 2020  , Subpath)):..  
+00040380: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00040390: 204e 6f74 496d 706c 656d 656e 7465 640d   NotImplemented.
+000403a0: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
+000403b0: 7365 6c66 2920 213d 206c 656e 286f 7468  self) != len(oth
+000403c0: 6572 293a 0d0a 2020 2020 2020 2020 2020  er):..          
+000403d0: 2020 7265 7475 726e 2046 616c 7365 0d0a    return False..
+000403e0: 2020 2020 2020 2020 666f 7220 732c 206f          for s, o
+000403f0: 2069 6e20 7a69 7028 7365 6c66 2c20 6f74   in zip(self, ot
+00040400: 6865 7229 3a0d 0a20 2020 2020 2020 2020  her):..         
+00040410: 2020 2069 6620 6e6f 7420 7320 3d3d 206f     if not s == o
+00040420: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00040430: 2020 2072 6574 7572 6e20 4661 6c73 650d     return False.
+00040440: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00040450: 5472 7565 0d0a 0d0a 2020 2020 6465 6620  True....    def 
+00040460: 5f5f 6e65 5f5f 2873 656c 662c 206f 7468  __ne__(self, oth
+00040470: 6572 293a 0d0a 2020 2020 2020 2020 6966  er):..        if
+00040480: 206e 6f74 2069 7369 6e73 7461 6e63 6528   not isinstance(
+00040490: 6f74 6865 722c 2028 5061 7468 2c20 5375  other, (Path, Su
+000404a0: 6270 6174 682c 2073 7472 2929 3a0d 0a20  bpath, str)):.. 
+000404b0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+000404c0: 6e20 4e6f 7449 6d70 6c65 6d65 6e74 6564  n NotImplemented
+000404d0: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+000404e0: 206e 6f74 2073 656c 6620 3d3d 206f 7468   not self == oth
+000404f0: 6572 0d0a 0d0a 2020 2020 6465 6620 7365  er....    def se
+00040500: 676d 656e 7473 2873 656c 662c 2074 7261  gments(self, tra
+00040510: 6e73 666f 726d 6564 3d54 7275 6529 3a0d  nsformed=True):.
+00040520: 0a20 2020 2020 2020 2070 6174 6820 3d20  .        path = 
+00040530: 7365 6c66 2e5f 7061 7468 0d0a 2020 2020  self._path..    
+00040540: 2020 2020 6966 2074 7261 6e73 666f 726d      if transform
+00040550: 6564 3a0d 0a20 2020 2020 2020 2020 2020  ed:..           
+00040560: 2072 6574 7572 6e20 5b0d 0a20 2020 2020   return [..     
+00040570: 2020 2020 2020 2020 2020 2073 202a 2070             s * p
+00040580: 6174 682e 7472 616e 7366 6f72 6d20 666f  ath.transform fo
+00040590: 7220 7320 696e 2070 6174 682e 5f73 6567  r s in path._seg
+000405a0: 6d65 6e74 735b 7365 6c66 2e5f 7374 6172  ments[self._star
+000405b0: 7420 3a20 7365 6c66 2e5f 656e 6420 2b20  t : self._end + 
+000405c0: 315d 0d0a 2020 2020 2020 2020 2020 2020  1]..            
+000405d0: 5d0d 0a20 2020 2020 2020 2072 6574 7572  ]..        retur
+000405e0: 6e20 7061 7468 2e5f 7365 676d 656e 7473  n path._segments
+000405f0: 5b73 656c 662e 5f73 7461 7274 203a 2073  [self._start : s
+00040600: 656c 662e 5f65 6e64 202b 2031 5d0d 0a0d  elf._end + 1]...
+00040610: 0a20 2020 2064 6566 205f 6e75 6d65 7269  .    def _numeri
+00040620: 635f 696e 6465 7828 7365 6c66 2c20 696e  c_index(self, in
+00040630: 6465 7829 3a0d 0a20 2020 2020 2020 2069  dex):..        i
+00040640: 6620 696e 6465 7820 3c20 303a 0d0a 2020  f index < 0:..  
+00040650: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00040660: 2073 656c 662e 5f65 6e64 202b 2069 6e64   self._end + ind
+00040670: 6578 202b 2031 0d0a 2020 2020 2020 2020  ex + 1..        
+00040680: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+00040690: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
+000406a0: 7374 6172 7420 2b20 696e 6465 780d 0a0d  start + index...
+000406b0: 0a20 2020 2064 6566 2069 6e64 6578 5f74  .    def index_t
+000406c0: 6f5f 7061 7468 5f69 6e64 6578 2873 656c  o_path_index(sel
+000406d0: 662c 2069 6e64 6578 293a 0d0a 2020 2020  f, index):..    
+000406e0: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+000406f0: 6528 696e 6465 782c 2073 6c69 6365 293a  e(index, slice):
+00040700: 0d0a 2020 2020 2020 2020 2020 2020 7374  ..            st
+00040710: 6172 7420 3d20 696e 6465 782e 7374 6172  art = index.star
+00040720: 740d 0a20 2020 2020 2020 2020 2020 2073  t..            s
+00040730: 746f 7020 3d20 696e 6465 782e 7374 6f70  top = index.stop
+00040740: 0d0a 2020 2020 2020 2020 2020 2020 7374  ..            st
+00040750: 6570 203d 2069 6e64 6578 2e73 7465 700d  ep = index.step.
+00040760: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00040770: 7374 6172 7420 6973 204e 6f6e 653a 0d0a  start is None:..
+00040780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040790: 7374 6172 7420 3d20 300d 0a20 2020 2020  start = 0..     
+000407a0: 2020 2020 2020 2073 7461 7274 203d 2073         start = s
+000407b0: 656c 662e 5f6e 756d 6572 6963 5f69 6e64  elf._numeric_ind
+000407c0: 6578 2873 7461 7274 290d 0a20 2020 2020  ex(start)..     
+000407d0: 2020 2020 2020 2069 6620 7374 6f70 2069         if stop i
+000407e0: 7320 4e6f 6e65 3a0d 0a20 2020 2020 2020  s None:..       
+000407f0: 2020 2020 2020 2020 2073 746f 7020 3d20           stop = 
+00040800: 6c65 6e28 7365 6c66 290d 0a20 2020 2020  len(self)..     
+00040810: 2020 2020 2020 2073 746f 7020 3d20 7365         stop = se
+00040820: 6c66 2e5f 6e75 6d65 7269 635f 696e 6465  lf._numeric_inde
+00040830: 7828 7374 6f70 290d 0a20 2020 2020 2020  x(stop)..       
+00040840: 2020 2020 2072 6574 7572 6e20 736c 6963       return slic
+00040850: 6528 7374 6172 742c 2073 746f 702c 2073  e(start, stop, s
+00040860: 7465 7029 0d0a 2020 2020 2020 2020 7265  tep)..        re
+00040870: 7475 726e 2073 656c 662e 5f6e 756d 6572  turn self._numer
+00040880: 6963 5f69 6e64 6578 2869 6e64 6578 290d  ic_index(index).
+00040890: 0a0d 0a20 2020 2064 6566 2062 626f 7828  ...    def bbox(
+000408a0: 7365 6c66 2c20 7472 616e 7366 6f72 6d65  self, transforme
+000408b0: 643d 5472 7565 2c20 7769 7468 5f73 7472  d=True, with_str
+000408c0: 6f6b 653d 4661 6c73 6529 3a0d 0a20 2020  oke=False):..   
+000408d0: 2020 2020 2022 2222 7265 7475 726e 7320       """returns 
+000408e0: 6120 626f 756e 6469 6e67 2062 6f78 2066  a bounding box f
+000408f0: 6f72 2074 6865 2073 7562 7061 7468 2222  or the subpath""
+00040900: 220d 0a20 2020 2020 2020 2069 6620 7472  "..        if tr
+00040910: 616e 7366 6f72 6d65 643a 0d0a 2020 2020  ansformed:..    
+00040920: 2020 2020 2020 2020 7265 7475 726e 2050          return P
+00040930: 6174 6828 7365 6c66 292e 6262 6f78 2874  ath(self).bbox(t
+00040940: 7261 6e73 666f 726d 6564 3d74 7261 6e73  ransformed=trans
+00040950: 666f 726d 6564 2c20 7769 7468 5f73 7472  formed, with_str
+00040960: 6f6b 653d 7769 7468 5f73 7472 6f6b 6529  oke=with_stroke)
+00040970: 0d0a 0d0a 2020 2020 2020 2020 7365 676d  ....        segm
+00040980: 656e 7473 203d 2073 656c 662e 5f70 6174  ents = self._pat
+00040990: 682e 5f73 6567 6d65 6e74 735b 7365 6c66  h._segments[self
+000409a0: 2e5f 7374 6172 7420 3a20 7365 6c66 2e5f  ._start : self._
+000409b0: 656e 6420 2b20 315d 0d0a 2020 2020 2020  end + 1]..      
+000409c0: 2020 6262 7320 3d20 5b73 6567 2e62 626f    bbs = [seg.bbo
+000409d0: 7828 2920 666f 7220 7365 6720 696e 2073  x() for seg in s
+000409e0: 6567 6d65 6e74 7320 6966 206e 6f74 2069  egments if not i
+000409f0: 7369 6e73 7461 6e63 6528 436c 6f73 652c  sinstance(Close,
+00040a00: 204d 6f76 6529 5d0d 0a20 2020 2020 2020   Move)]..       
+00040a10: 2074 7279 3a0d 0a20 2020 2020 2020 2020   try:..         
+00040a20: 2020 2078 6d69 6e73 2c20 796d 696e 732c     xmins, ymins,
+00040a30: 2078 6d61 7873 2c20 796d 6178 7320 3d20   xmaxs, ymaxs = 
+00040a40: 6c69 7374 287a 6970 282a 6262 7329 290d  list(zip(*bbs)).
+00040a50: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+00040a60: 5661 6c75 6545 7272 6f72 3a0d 0a20 2020  ValueError:..   
+00040a70: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00040a80: 4e6f 6e65 2020 2320 4e6f 2062 6f75 6e64  None  # No bound
+00040a90: 696e 6720 626f 7820 6974 656d 7320 6578  ing box items ex
+00040aa0: 6973 7465 642e 2053 6f20 6e6f 2062 6f75  isted. So no bou
+00040ab0: 6e64 696e 6720 626f 782e 0d0a 0d0a 2020  nding box.....  
+00040ac0: 2020 2020 2020 6966 2028 0d0a 2020 2020        if (..    
+00040ad0: 2020 2020 2020 2020 7769 7468 5f73 7472          with_str
+00040ae0: 6f6b 650d 0a20 2020 2020 2020 2020 2020  oke..           
+00040af0: 2061 6e64 2073 656c 662e 5f70 6174 682e   and self._path.
+00040b00: 7374 726f 6b65 5f77 6964 7468 2069 7320  stroke_width is 
+00040b10: 6e6f 7420 4e6f 6e65 0d0a 2020 2020 2020  not None..      
+00040b20: 2020 2020 2020 616e 6420 6e6f 7420 2873        and not (s
+00040b30: 656c 662e 5f70 6174 682e 7374 726f 6b65  elf._path.stroke
+00040b40: 2069 7320 4e6f 6e65 206f 7220 7365 6c66   is None or self
+00040b50: 2e5f 7061 7468 2e73 7472 6f6b 652e 7661  ._path.stroke.va
+00040b60: 6c75 6520 6973 204e 6f6e 6529 0d0a 2020  lue is None)..  
+00040b70: 2020 2020 2020 293a 0d0a 2020 2020 2020        ):..      
+00040b80: 2020 2020 2020 6465 6c74 6120 3d20 666c        delta = fl
+00040b90: 6f61 7428 7365 6c66 2e5f 7061 7468 2e73  oat(self._path.s
+00040ba0: 7472 6f6b 655f 7769 6474 6829 202f 2032  troke_width) / 2
+00040bb0: 2e30 0d0a 2020 2020 2020 2020 656c 7365  .0..        else
+00040bc0: 3a0d 0a20 2020 2020 2020 2020 2020 2064  :..            d
+00040bd0: 656c 7461 203d 2030 2e30 0d0a 0d0a 2020  elta = 0.0....  
+00040be0: 2020 2020 2020 7265 7475 726e 2028 0d0a        return (..
+00040bf0: 2020 2020 2020 2020 2020 2020 6d69 6e28              min(
+00040c00: 786d 696e 7329 202d 2064 656c 7461 2c0d  xmins) - delta,.
+00040c10: 0a20 2020 2020 2020 2020 2020 206d 696e  .            min
+00040c20: 2879 6d69 6e73 2920 2d20 6465 6c74 612c  (ymins) - delta,
+00040c30: 0d0a 2020 2020 2020 2020 2020 2020 6d61  ..            ma
+00040c40: 7828 786d 6178 7329 202b 2064 656c 7461  x(xmaxs) + delta
+00040c50: 2c0d 0a20 2020 2020 2020 2020 2020 206d  ,..            m
+00040c60: 6178 2879 6d61 7873 2920 2b20 6465 6c74  ax(ymaxs) + delt
+00040c70: 612c 0d0a 2020 2020 2020 2020 290d 0a0d  a,..        )...
+00040c80: 0a20 2020 2064 6566 2064 2873 656c 662c  .    def d(self,
+00040c90: 2072 656c 6174 6976 653d 4e6f 6e65 2c20   relative=None, 
+00040ca0: 736d 6f6f 7468 3d4e 6f6e 6529 3a0d 0a20  smooth=None):.. 
+00040cb0: 2020 2020 2020 2073 6567 6d65 6e74 7320         segments 
+00040cc0: 3d20 7365 6c66 2e5f 7061 7468 2e5f 7365  = self._path._se
+00040cd0: 676d 656e 7473 5b73 656c 662e 5f73 7461  gments[self._sta
+00040ce0: 7274 203a 2073 656c 662e 5f65 6e64 202b  rt : self._end +
+00040cf0: 2031 5d0d 0a20 2020 2020 2020 2072 6574   1]..        ret
+00040d00: 7572 6e20 5061 7468 2e73 7667 5f64 2873  urn Path.svg_d(s
+00040d10: 6567 6d65 6e74 732c 2072 656c 6174 6976  egments, relativ
+00040d20: 653d 7265 6c61 7469 7665 2c20 736d 6f6f  e=relative, smoo
+00040d30: 7468 3d4e 6f6e 6529 0d0a 0d0a 2020 2020  th=None)....    
+00040d40: 6465 6620 5f72 6576 6572 7365 5f73 6567  def _reverse_seg
+00040d50: 6d65 6e74 7328 7365 6c66 2c20 7374 6172  ments(self, star
+00040d60: 742c 2065 6e64 293a 0d0a 2020 2020 2020  t, end):..      
+00040d70: 2020 2222 2252 6576 6572 7365 7320 7365    """Reverses se
+00040d80: 676d 656e 7473 2062 6574 7765 656e 2074  gments between t
+00040d90: 6865 2067 6976 656e 2069 6e64 6578 6573  he given indexes
+00040da0: 2069 6e20 7468 6520 7375 6270 6174 6820   in the subpath 
+00040db0: 7370 6163 652e 2222 220d 0a20 2020 2020  space."""..     
+00040dc0: 2020 2073 6567 6d65 6e74 7320 3d20 7365     segments = se
+00040dd0: 6c66 2e5f 7061 7468 2e5f 7365 676d 656e  lf._path._segmen
+00040de0: 7473 2020 2320 6d75 7374 2061 766f 6964  ts  # must avoid
+00040df0: 2070 6174 6820 7661 6c69 6461 7469 6f6e   path validation
+00040e00: 2e0d 0a20 2020 2020 2020 2073 203d 2073  ...        s = s
+00040e10: 656c 662e 696e 6465 785f 746f 5f70 6174  elf.index_to_pat
+00040e20: 685f 696e 6465 7828 7374 6172 7429 0d0a  h_index(start)..
+00040e30: 2020 2020 2020 2020 6520 3d20 7365 6c66          e = self
+00040e40: 2e69 6e64 6578 5f74 6f5f 7061 7468 5f69  .index_to_path_i
+00040e50: 6e64 6578 2865 6e64 290d 0a20 2020 2020  ndex(end)..     
+00040e60: 2020 2077 6869 6c65 2073 203c 3d20 653a     while s <= e:
+00040e70: 0d0a 2020 2020 2020 2020 2020 2020 7374  ..            st
+00040e80: 6172 745f 7365 676d 656e 7420 3d20 7365  art_segment = se
+00040e90: 676d 656e 7473 5b73 5d0d 0a20 2020 2020  gments[s]..     
+00040ea0: 2020 2020 2020 2065 6e64 5f73 6567 6d65         end_segme
+00040eb0: 6e74 203d 2073 6567 6d65 6e74 735b 655d  nt = segments[e]
+00040ec0: 0d0a 2020 2020 2020 2020 2020 2020 7374  ..            st
+00040ed0: 6172 745f 7365 676d 656e 742e 7265 7665  art_segment.reve
+00040ee0: 7273 6528 290d 0a20 2020 2020 2020 2020  rse()..         
+00040ef0: 2020 2069 6620 7374 6172 745f 7365 676d     if start_segm
+00040f00: 656e 7420 6973 206e 6f74 2065 6e64 5f73  ent is not end_s
+00040f10: 6567 6d65 6e74 3a0d 0a20 2020 2020 2020  egment:..       
+00040f20: 2020 2020 2020 2020 2065 6e64 5f73 6567           end_seg
+00040f30: 6d65 6e74 2e72 6576 6572 7365 2829 0d0a  ment.reverse()..
+00040f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040f50: 7365 676d 656e 7473 5b73 5d20 3d20 656e  segments[s] = en
+00040f60: 645f 7365 676d 656e 740d 0a20 2020 2020  d_segment..     
+00040f70: 2020 2020 2020 2020 2020 2073 6567 6d65             segme
+00040f80: 6e74 735b 655d 203d 2073 7461 7274 5f73  nts[e] = start_s
+00040f90: 6567 6d65 6e74 0d0a 2020 2020 2020 2020  egment..        
+00040fa0: 2020 2020 7320 2b3d 2031 0d0a 2020 2020      s += 1..    
+00040fb0: 2020 2020 2020 2020 6520 2d3d 2031 0d0a          e -= 1..
+00040fc0: 2020 2020 2020 2020 7374 6172 7420 3d20          start = 
+00040fd0: 7365 6c66 2e69 6e64 6578 5f74 6f5f 7061  self.index_to_pa
+00040fe0: 7468 5f69 6e64 6578 2873 7461 7274 290d  th_index(start).
+00040ff0: 0a20 2020 2020 2020 2065 6e64 203d 2073  .        end = s
+00041000: 656c 662e 696e 6465 785f 746f 5f70 6174  elf.index_to_pat
+00041010: 685f 696e 6465 7828 656e 6429 0d0a 2020  h_index(end)..  
+00041020: 2020 2020 2020 7365 6c66 2e5f 7061 7468        self._path
+00041030: 2e5f 7661 6c69 6461 7465 5f63 6f6e 6e65  ._validate_conne
+00041040: 6374 696f 6e28 7374 6172 7420 2d20 312c  ction(start - 1,
+00041050: 2070 7265 6665 725f 7365 636f 6e64 3d54   prefer_second=T
+00041060: 7275 6529 0d0a 2020 2020 2020 2020 7365  rue)..        se
+00041070: 6c66 2e5f 7061 7468 2e5f 7661 6c69 6461  lf._path._valida
+00041080: 7465 5f63 6f6e 6e65 6374 696f 6e28 656e  te_connection(en
+00041090: 6429 0d0a 0d0a 2020 2020 6465 6620 7265  d)....    def re
+000410a0: 7665 7273 6528 7365 6c66 293a 0d0a 2020  verse(self):..  
+000410b0: 2020 2020 2020 7369 7a65 203d 206c 656e        size = len
+000410c0: 2873 656c 6629 0d0a 2020 2020 2020 2020  (self)..        
+000410d0: 6966 2073 697a 6520 3d3d 2030 3a0d 0a20  if size == 0:.. 
+000410e0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+000410f0: 6e0d 0a20 2020 2020 2020 2073 7461 7274  n..        start
+00041100: 203d 2030 0d0a 2020 2020 2020 2020 656e   = 0..        en
+00041110: 6420 3d20 7369 7a65 202d 2031 0d0a 2020  d = size - 1..  
+00041120: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+00041130: 6e63 6528 7365 6c66 5b2d 315d 2c20 436c  nce(self[-1], Cl
+00041140: 6f73 6529 3a0d 0a20 2020 2020 2020 2020  ose):..         
+00041150: 2020 2065 6e64 202d 3d20 310d 0a20 2020     end -= 1..   
+00041160: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
+00041170: 6365 280d 0a20 2020 2020 2020 2020 2020  ce(..           
+00041180: 2073 656c 665b 305d 2c20 4d6f 7665 0d0a   self[0], Move..
+00041190: 2020 2020 2020 2020 293a 2020 2320 4d6f          ):  # Mo
+000411a0: 7665 2072 656d 6169 6e73 2069 6e20 706c  ve remains in pl
+000411b0: 6163 6520 6275 7420 7265 6665 7265 6e63  ace but referenc
+000411c0: 6573 206e 6578 7420 656c 656d 656e 742e  es next element.
+000411d0: 0d0a 2020 2020 2020 2020 2020 2020 7374  ..            st
+000411e0: 6172 7420 2b3d 2031 0d0a 2020 2020 2020  art += 1..      
+000411f0: 2020 7365 6c66 2e5f 7265 7665 7273 655f    self._reverse_
+00041200: 7365 676d 656e 7473 2873 7461 7274 2c20  segments(start, 
+00041210: 656e 6429 0d0a 2020 2020 2020 2020 6966  end)..        if
+00041220: 2073 697a 6520 3e20 313a 0d0a 2020 2020   size > 1:..    
+00041230: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+00041240: 7461 6e63 6528 7365 6c66 5b30 5d2c 204d  tance(self[0], M
+00041250: 6f76 6529 3a0d 0a20 2020 2020 2020 2020  ove):..         
+00041260: 2020 2020 2020 2073 656c 665b 305d 2e65         self[0].e
+00041270: 6e64 203d 2050 6f69 6e74 2873 656c 665b  nd = Point(self[
+00041280: 315d 2e73 7461 7274 290d 0a20 2020 2020  1].start)..     
+00041290: 2020 206c 6173 7420 3d20 7365 6c66 5b2d     last = self[-
+000412a0: 315d 0d0a 2020 2020 2020 2020 6966 2069  1]..        if i
+000412b0: 7369 6e73 7461 6e63 6528 6c61 7374 2c20  sinstance(last, 
+000412c0: 436c 6f73 6529 3a0d 0a20 2020 2020 2020  Close):..       
+000412d0: 2020 2020 206c 6173 742e 7265 7665 7273       last.revers
+000412e0: 6528 290d 0a20 2020 2020 2020 2020 2020  e()..           
+000412f0: 2069 6620 6c61 7374 2e73 7461 7274 2021   if last.start !
+00041300: 3d20 7365 6c66 5b2d 325d 2e65 6e64 3a0d  = self[-2].end:.
+00041310: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00041320: 206c 6173 742e 7374 6172 7420 3d20 506f   last.start = Po
+00041330: 696e 7428 7365 6c66 5b2d 325d 2e65 6e64  int(self[-2].end
+00041340: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
+00041350: 6620 6c61 7374 2e65 6e64 2021 3d20 7365  f last.end != se
+00041360: 6c66 5b30 5d2e 656e 643a 0d0a 2020 2020  lf[0].end:..    
+00041370: 2020 2020 2020 2020 2020 2020 6c61 7374              last
+00041380: 2e65 6e64 203d 2050 6f69 6e74 2873 656c  .end = Point(sel
+00041390: 665b 305d 2e65 6e64 290d 0a20 2020 2020  f[0].end)..     
+000413a0: 2020 2072 6574 7572 6e20 7365 6c66 0d0a     return self..
+000413b0: 0d0a 0d0a 636c 6173 7320 4772 6f75 7028  ....class Group(
+000413c0: 5356 4745 6c65 6d65 6e74 2c20 5472 616e  SVGElement, Tran
+000413d0: 7366 6f72 6d61 626c 652c 206c 6973 7429  sformable, list)
+000413e0: 3a0d 0a20 2020 2022 2222 0d0a 2020 2020  :..    """..    
+000413f0: 4772 6f75 7020 436f 6e74 6169 6e65 7220  Group Container 
+00041400: 656c 656d 656e 7420 6361 6e20 6861 7665  element can have
+00041410: 2063 6869 6c64 7265 6e2e 0d0a 2020 2020   children...    
+00041420: 5356 4720 322e 3020 3c67 3e20 6172 6520  SVG 2.0 <g> are 
+00041430: 6465 6669 6e65 6420 696e 3a0d 0a20 2020  defined in:..   
+00041440: 2035 2e32 2e20 4772 6f75 7069 6e67 3a20   5.2. Grouping: 
+00041450: 7468 6520 6720 656c 656d 656e 740d 0a20  the g element.. 
+00041460: 2020 2022 2222 0d0a 0d0a 2020 2020 6465     """....    de
+00041470: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
+00041480: 202a 6172 6773 2c20 2a2a 6b77 6172 6773   *args, **kwargs
+00041490: 293a 0d0a 2020 2020 2020 2020 5472 616e  ):..        Tran
+000414a0: 7366 6f72 6d61 626c 652e 5f5f 696e 6974  sformable.__init
+000414b0: 5f5f 2873 656c 662c 202a 6172 6773 2c20  __(self, *args, 
+000414c0: 2a2a 6b77 6172 6773 290d 0a20 2020 2020  **kwargs)..     
+000414d0: 2020 206c 6973 742e 5f5f 696e 6974 5f5f     list.__init__
+000414e0: 2873 656c 6629 0d0a 2020 2020 2020 2020  (self)..        
+000414f0: 6966 206c 656e 2861 7267 7329 203e 3d20  if len(args) >= 
+00041500: 313a 0d0a 2020 2020 2020 2020 2020 2020  1:..            
+00041510: 7320 3d20 6172 6773 5b30 5d0d 0a20 2020  s = args[0]..   
+00041520: 2020 2020 2020 2020 2069 6620 6973 696e           if isin
+00041530: 7374 616e 6365 2873 2c20 4772 6f75 7029  stance(s, Group)
+00041540: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00041550: 2020 2073 656c 662e 6578 7465 6e64 286c     self.extend(l
+00041560: 6973 7428 6d61 7028 636f 7079 2c20 7329  ist(map(copy, s)
+00041570: 2929 0d0a 2020 2020 2020 2020 5356 4745  ))..        SVGE
+00041580: 6c65 6d65 6e74 2e5f 5f69 6e69 745f 5f28  lement.__init__(
+00041590: 7365 6c66 2c20 2a61 7267 732c 202a 2a6b  self, *args, **k
+000415a0: 7761 7267 7329 0d0a 0d0a 2020 2020 6465  wargs)....    de
+000415b0: 6620 5f5f 696d 756c 5f5f 2873 656c 662c  f __imul__(self,
+000415c0: 206f 7468 6572 293a 0d0a 2020 2020 2020   other):..      
+000415d0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+000415e0: 6f74 6865 722c 2073 7472 293a 0d0a 2020  other, str):..  
+000415f0: 2020 2020 2020 2020 2020 6f74 6865 7220            other 
+00041600: 3d20 4d61 7472 6978 286f 7468 6572 290d  = Matrix(other).
+00041610: 0a20 2020 2020 2020 2069 6620 6973 696e  .        if isin
+00041620: 7374 616e 6365 286f 7468 6572 2c20 4d61  stance(other, Ma
+00041630: 7472 6978 293a 0d0a 2020 2020 2020 2020  trix):..        
+00041640: 2020 2020 7365 6c66 2e74 7261 6e73 666f      self.transfo
+00041650: 726d 202a 3d20 6f74 6865 720d 0a20 2020  rm *= other..   
+00041660: 2020 2020 2020 2020 2066 6f72 2065 2069           for e i
+00041670: 6e20 7365 6c66 3a0d 0a20 2020 2020 2020  n self:..       
+00041680: 2020 2020 2020 2020 2065 202a 3d20 6f74           e *= ot
+00041690: 6865 720d 0a20 2020 2020 2020 2072 6574  her..        ret
+000416a0: 7572 6e20 7365 6c66 0d0a 0d0a 2020 2020  urn self....    
+000416b0: 6465 6620 7265 6e64 6572 2873 656c 662c  def render(self,
+000416c0: 202a 2a6b 7761 7267 7329 3a0d 0a20 2020   **kwargs):..   
+000416d0: 2020 2020 2054 7261 6e73 666f 726d 6162       Transformab
+000416e0: 6c65 2e72 656e 6465 7228 7365 6c66 2c20  le.render(self, 
+000416f0: 2a2a 6b77 6172 6773 290d 0a0d 0a20 2020  **kwargs)....   
+00041700: 2064 6566 205f 5f63 6f70 795f 5f28 7365   def __copy__(se
+00041710: 6c66 293a 0d0a 2020 2020 2020 2020 7265  lf):..        re
+00041720: 7475 726e 2047 726f 7570 2873 656c 6629  turn Group(self)
+00041730: 0d0a 0d0a 2020 2020 6465 6620 7072 6f70  ....    def prop
+00041740: 6572 7479 5f62 795f 6f62 6a65 6374 2873  erty_by_object(s
+00041750: 656c 662c 2073 293a 0d0a 2020 2020 2020  elf, s):..      
+00041760: 2020 5472 616e 7366 6f72 6d61 626c 652e    Transformable.
+00041770: 7072 6f70 6572 7479 5f62 795f 6f62 6a65  property_by_obje
+00041780: 6374 2873 656c 662c 2073 290d 0a20 2020  ct(self, s)..   
+00041790: 2020 2020 2053 5647 456c 656d 656e 742e       SVGElement.
+000417a0: 7072 6f70 6572 7479 5f62 795f 6f62 6a65  property_by_obje
+000417b0: 6374 2873 656c 662c 2073 290d 0a0d 0a20  ct(self, s).... 
+000417c0: 2020 2064 6566 2070 726f 7065 7274 795f     def property_
+000417d0: 6279 5f76 616c 7565 7328 7365 6c66 2c20  by_values(self, 
+000417e0: 7661 6c75 6573 293a 0d0a 2020 2020 2020  values):..      
+000417f0: 2020 5472 616e 7366 6f72 6d61 626c 652e    Transformable.
+00041800: 7072 6f70 6572 7479 5f62 795f 7661 6c75  property_by_valu
+00041810: 6573 2873 656c 662c 2076 616c 7565 7329  es(self, values)
+00041820: 0d0a 2020 2020 2020 2020 5356 4745 6c65  ..        SVGEle
+00041830: 6d65 6e74 2e70 726f 7065 7274 795f 6279  ment.property_by
+00041840: 5f76 616c 7565 7328 7365 6c66 2c20 7661  _values(self, va
+00041850: 6c75 6573 290d 0a0d 0a20 2020 2064 6566  lues)....    def
+00041860: 2073 656c 6563 7428 7365 6c66 2c20 636f   select(self, co
+00041870: 6e64 6974 696f 6e61 6c3d 4e6f 6e65 293a  nditional=None):
+00041880: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
+00041890: 2020 2020 2020 2046 696e 6473 2061 6c6c         Finds all
+000418a0: 2066 6c61 7474 656e 6564 2073 7562 6f62   flattened subob
+000418b0: 6a65 6374 7320 6f66 2074 6869 7320 6772  jects of this gr
+000418c0: 6f75 7020 666f 7220 7768 6963 6820 7468  oup for which th
+000418d0: 6520 636f 6e64 6974 696f 6e61 6c20 7265  e conditional re
+000418e0: 7475 726e 730d 0a20 2020 2020 2020 2074  turns..        t
+000418f0: 7275 652e 0d0a 0d0a 2020 2020 2020 2020  rue.....        
+00041900: 3a70 6172 616d 2063 6f6e 6469 7469 6f6e  :param condition
+00041910: 616c 3a20 6675 6e63 7469 6f6e 2074 616b  al: function tak
+00041920: 696e 6720 656c 656d 656e 7420 616e 6420  ing element and 
+00041930: 7265 7475 726e 7320 5472 7565 2074 6f20  returns True to 
+00041940: 696e 636c 7564 6520 6f72 2046 616c 7365  include or False
+00041950: 2069 6620 6578 636c 7564 650d 0a20 2020   if exclude..   
+00041960: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
+00041970: 2020 6966 2063 6f6e 6469 7469 6f6e 616c    if conditional
+00041980: 2069 7320 4e6f 6e65 3a0d 0a20 2020 2020   is None:..     
+00041990: 2020 2020 2020 2066 6f72 2073 7562 6974         for subit
+000419a0: 656d 2069 6e20 7365 6c66 3a0d 0a20 2020  em in self:..   
+000419b0: 2020 2020 2020 2020 2020 2020 2079 6965               yie
+000419c0: 6c64 2073 7562 6974 656d 0d0a 2020 2020  ld subitem..    
+000419d0: 2020 2020 2020 2020 2020 2020 6966 2069              if i
+000419e0: 7369 6e73 7461 6e63 6528 7375 6269 7465  sinstance(subite
+000419f0: 6d2c 2028 4772 6f75 702c 2055 7365 2929  m, (Group, Use))
+00041a00: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00041a10: 2020 2020 2020 2066 6f72 2073 2069 6e20         for s in 
+00041a20: 7375 6269 7465 6d2e 7365 6c65 6374 2863  subitem.select(c
+00041a30: 6f6e 6469 7469 6f6e 616c 293a 0d0a 2020  onditional):..  
+00041a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00041a50: 2020 2020 2020 7969 656c 6420 730d 0a20        yield s.. 
+00041a60: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+00041a70: 2020 2020 2020 2020 2020 666f 7220 7375            for su
+00041a80: 6269 7465 6d20 696e 2073 656c 663a 0d0a  bitem in self:..
+00041a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00041aa0: 6966 2063 6f6e 6469 7469 6f6e 616c 2873  if conditional(s
+00041ab0: 7562 6974 656d 293a 0d0a 2020 2020 2020  ubitem):..      
+00041ac0: 2020 2020 2020 2020 2020 2020 2020 7969                yi
+00041ad0: 656c 6420 7375 6269 7465 6d0d 0a20 2020  eld subitem..   
+00041ae0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00041af0: 6973 696e 7374 616e 6365 2873 7562 6974  isinstance(subit
+00041b00: 656d 2c20 2847 726f 7570 2c20 5573 6529  em, (Group, Use)
+00041b10: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00041b20: 2020 2020 2020 2020 666f 7220 7320 696e          for s in
+00041b30: 2073 7562 6974 656d 2e73 656c 6563 7428   subitem.select(
+00041b40: 636f 6e64 6974 696f 6e61 6c29 3a0d 0a20  conditional):.. 
+00041b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00041b60: 2020 2020 2020 2079 6965 6c64 2073 0d0a         yield s..
+00041b70: 0d0a 2020 2020 6465 6620 7265 6966 7928  ..    def reify(
+00041b80: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
+00041b90: 5472 616e 7366 6f72 6d61 626c 652e 7265  Transformable.re
+00041ba0: 6966 7928 7365 6c66 290d 0a0d 0a20 2020  ify(self)....   
+00041bb0: 2040 7374 6174 6963 6d65 7468 6f64 0d0a   @staticmethod..
+00041bc0: 2020 2020 6465 6620 756e 696f 6e5f 6262      def union_bb
+00041bd0: 6f78 2865 6c65 6d65 6e74 732c 2074 7261  ox(elements, tra
+00041be0: 6e73 666f 726d 6564 3d54 7275 652c 2077  nsformed=True, w
+00041bf0: 6974 685f 7374 726f 6b65 3d46 616c 7365  ith_stroke=False
+00041c00: 293a 0d0a 2020 2020 2020 2020 2222 220d  ):..        """.
+00041c10: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
+00041c20: 2074 6865 2075 6e69 6f6e 206f 6620 7468   the union of th
+00041c30: 6520 626f 756e 6469 6e67 2062 6f78 6573  e bounding boxes
+00041c40: 2066 6f72 2074 6865 2065 6c65 6d65 6e74   for the element
+00041c50: 7320 7769 7468 696e 2074 6865 2069 7465  s within the ite
+00041c60: 7261 746f 722e 0d0a 0d0a 2020 2020 2020  rator.....      
+00041c70: 2020 3a70 6172 616d 2074 7261 6e73 666f    :param transfo
+00041c80: 726d 6564 3a20 5368 6f75 6c64 2074 6865  rmed: Should the
+00041c90: 2063 6869 6c64 7265 6e20 6f66 2074 6869   children of thi
+00041ca0: 7320 6f62 6a65 6374 2062 6520 7072 6f70  s object be prop
+00041cb0: 6572 6c79 2074 7261 6e73 666f 726d 6564  erly transformed
+00041cc0: 2e0d 0a20 2020 2020 2020 203a 7061 7261  ...        :para
+00041cd0: 6d20 7769 7468 5f73 7472 6f6b 653a 2073  m with_stroke: s
+00041ce0: 686f 756c 6420 7468 6520 7374 726f 6b65  hould the stroke
+00041cf0: 2d77 6964 7468 2062 6520 696e 636c 7564  -width be includ
+00041d00: 6564 2069 6e20 7468 6520 626f 756e 6473  ed in the bounds
+00041d10: 206f 6620 7468 6520 656c 656d 656e 7473   of the elements
+00041d20: 0d0a 2020 2020 2020 2020 3a72 6574 7572  ..        :retur
+00041d30: 6e3a 2075 6e69 6f6e 206f 6620 616c 6c20  n: union of all 
+00041d40: 626f 756e 6469 6e67 2062 6f78 6573 206f  bounding boxes o
+00041d50: 6620 656c 656d 656e 7473 2077 6974 6869  f elements withi
+00041d60: 6e20 7468 6520 6974 6572 6162 6c65 2e0d  n the iterable..
+00041d70: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
+00041d80: 2020 2020 2020 626f 7865 7320 3d20 5b5d        boxes = []
+00041d90: 0d0a 2020 2020 2020 2020 666f 7220 6520  ..        for e 
+00041da0: 696e 2065 6c65 6d65 6e74 733a 0d0a 2020  in elements:..  
+00041db0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+00041dc0: 2068 6173 6174 7472 2865 2c20 2262 626f   hasattr(e, "bbo
+00041dd0: 7822 2920 6f72 2069 7369 6e73 7461 6e63  x") or isinstanc
+00041de0: 6528 652c 2028 4772 6f75 702c 2055 7365  e(e, (Group, Use
+00041df0: 2929 3a0d 0a20 2020 2020 2020 2020 2020  )):..           
+00041e00: 2020 2020 2063 6f6e 7469 6e75 650d 0a20       continue.. 
+00041e10: 2020 2020 2020 2020 2020 2062 6f78 203d             box =
+00041e20: 2065 2e62 626f 7828 7472 616e 7366 6f72   e.bbox(transfor
+00041e30: 6d65 643d 7472 616e 7366 6f72 6d65 642c  med=transformed,
+00041e40: 2077 6974 685f 7374 726f 6b65 3d77 6974   with_stroke=wit
+00041e50: 685f 7374 726f 6b65 290d 0a20 2020 2020  h_stroke)..     
+00041e60: 2020 2020 2020 2069 6620 626f 7820 6973         if box is
+00041e70: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+00041e80: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
+00041e90: 0d0a 2020 2020 2020 2020 2020 2020 626f  ..            bo
+00041ea0: 7865 732e 6170 7065 6e64 2862 6f78 290d  xes.append(box).
+00041eb0: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
+00041ec0: 626f 7865 7329 203d 3d20 303a 0d0a 2020  boxes) == 0:..  
+00041ed0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00041ee0: 204e 6f6e 650d 0a20 2020 2020 2020 2028   None..        (
+00041ef0: 786d 696e 732c 2079 6d69 6e73 2c20 786d  xmins, ymins, xm
+00041f00: 6178 732c 2079 6d61 7873 2920 3d20 7a69  axs, ymaxs) = zi
+00041f10: 7028 2a62 6f78 6573 290d 0a20 2020 2020  p(*boxes)..     
+00041f20: 2020 2072 6574 7572 6e20 286d 696e 2878     return (min(x
+00041f30: 6d69 6e73 292c 206d 696e 2879 6d69 6e73  mins), min(ymins
+00041f40: 292c 206d 6178 2878 6d61 7873 292c 206d  ), max(xmaxs), m
+00041f50: 6178 2879 6d61 7873 2929 0d0a 0d0a 2020  ax(ymaxs))....  
+00041f60: 2020 6465 6620 6262 6f78 2873 656c 662c    def bbox(self,
+00041f70: 2074 7261 6e73 666f 726d 6564 3d54 7275   transformed=Tru
+00041f80: 652c 2077 6974 685f 7374 726f 6b65 3d46  e, with_stroke=F
+00041f90: 616c 7365 293a 0d0a 2020 2020 2020 2020  alse):..        
+00041fa0: 2222 220d 0a20 2020 2020 2020 2052 6574  """..        Ret
+00041fb0: 7572 6e73 2074 6865 2062 6f75 6e64 696e  urns the boundin
+00041fc0: 6720 626f 7820 6f66 2074 6865 2067 6976  g box of the giv
+00041fd0: 656e 206f 626a 6563 742e 0d0a 0d0a 2020  en object.....  
+00041fe0: 2020 2020 2020 496e 2074 6865 2063 6173        In the cas
+00041ff0: 6520 6f66 2067 726f 7570 7320 7468 6973  e of groups this
+00042000: 2069 7320 7468 6520 756e 696f 6e20 6f66   is the union of
+00042010: 2061 6c6c 2074 6865 2062 6f75 6e64 696e   all the boundin
+00042020: 6720 626f 7865 7320 6f66 2061 6c6c 2062  g boxes of all b
+00042030: 6f75 6e64 2063 6869 6c64 7265 6e2e 0d0a  ound children...
+00042040: 0d0a 2020 2020 2020 2020 5365 7474 696e  ..        Settin
+00042050: 6720 7472 616e 7366 6f72 6d65 6420 746f  g transformed to
+00042060: 2066 616c 7365 2c20 6d61 7920 7969 656c   false, may yiel
+00042070: 6420 756e 6578 7065 6374 6564 2072 6573  d unexpected res
+00042080: 756c 7473 2069 6620 7375 6269 7465 6d73  ults if subitems
+00042090: 2061 7265 2074 7261 6e73 666f 726d 6564   are transformed
+000420a0: 2069 6e20 6e6f 6e2d 756e 6966 6f72 6d0d   in non-uniform.
+000420b0: 0a20 2020 2020 2020 2077 6179 732e 0d0a  .        ways...
+000420c0: 0d0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+000420d0: 2074 7261 6e73 666f 726d 6564 3a20 626f   transformed: bo
+000420e0: 756e 6469 6e67 2062 6f78 206f 6620 7468  unding box of th
+000420f0: 6520 7072 6f70 6572 6c79 2074 7261 6e73  e properly trans
+00042100: 666f 726d 6564 2063 6869 6c64 7265 6e2e  formed children.
+00042110: 0d0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+00042120: 2077 6974 685f 7374 726f 6b65 3a20 7368   with_stroke: sh
+00042130: 6f75 6c64 2074 6865 2073 7472 6f6b 652d  ould the stroke-
+00042140: 7769 6474 6820 6265 2069 6e63 6c75 6465  width be include
+00042150: 6420 696e 2074 6865 2062 6f75 6e64 732e  d in the bounds.
+00042160: 0d0a 2020 2020 2020 2020 3a72 6574 7572  ..        :retur
+00042170: 6e3a 2062 6f75 6e64 696e 6720 626f 7820  n: bounding box 
+00042180: 6f66 2074 6865 2067 6976 656e 2065 6c65  of the given ele
+00042190: 6d65 6e74 0d0a 2020 2020 2020 2020 2222  ment..        ""
+000421a0: 220d 0a20 2020 2020 2020 2072 6574 7572  "..        retur
+000421b0: 6e20 4772 6f75 702e 756e 696f 6e5f 6262  n Group.union_bb
+000421c0: 6f78 280d 0a20 2020 2020 2020 2020 2020  ox(..           
+000421d0: 2073 656c 662e 7365 6c65 6374 2829 2c0d   self.select(),.
+000421e0: 0a20 2020 2020 2020 2020 2020 2074 7261  .            tra
+000421f0: 6e73 666f 726d 6564 3d74 7261 6e73 666f  nsformed=transfo
+00042200: 726d 6564 2c0d 0a20 2020 2020 2020 2020  rmed,..         
+00042210: 2020 2077 6974 685f 7374 726f 6b65 3d77     with_stroke=w
+00042220: 6974 685f 7374 726f 6b65 2c0d 0a20 2020  ith_stroke,..   
+00042230: 2020 2020 2029 0d0a 0d0a 0d0a 636c 6173       )......clas
+00042240: 7320 5573 6528 5356 4745 6c65 6d65 6e74  s Use(SVGElement
+00042250: 2c20 5472 616e 7366 6f72 6d61 626c 652c  , Transformable,
+00042260: 206c 6973 7429 3a0d 0a20 2020 2022 2222   list):..    """
+00042270: 0d0a 2020 2020 5573 6520 656c 656d 656e  ..    Use elemen
+00042280: 7473 2061 7265 2064 6566 696e 6564 2069  ts are defined i
+00042290: 6e20 7376 6720 352e 360d 0a20 2020 2068  n svg 5.6..    h
+000422a0: 7474 7073 3a2f 2f77 7777 2e77 332e 6f72  ttps://www.w3.or
+000422b0: 672f 5452 2f53 5647 3131 2f73 7472 7563  g/TR/SVG11/struc
+000422c0: 742e 6874 6d6c 2355 7365 456c 656d 656e  t.html#UseElemen
+000422d0: 740d 0a0d 0a20 2020 2055 7365 2069 7320  t....    Use is 
+000422e0: 6120 6765 6e65 7269 6320 636f 6e74 6169  a generic contai
+000422f0: 6e65 7220 6f62 6a65 6374 2067 726f 7570  ner object group
+00042300: 2d6c 696b 6520 7468 6174 2075 7365 2072  -like that use r
+00042310: 6566 6572 656e 6365 206f 626a 6563 7473  eference objects
+00042320: 2c0d 0a20 2020 2022 2222 0d0a 0d0a 2020  ,..    """....  
+00042330: 2020 6465 6620 5f5f 696e 6974 5f5f 2873    def __init__(s
+00042340: 656c 662c 202a 6172 6773 2c20 2a2a 6b77  elf, *args, **kw
+00042350: 6172 6773 293a 0d0a 2020 2020 2020 2020  args):..        
+00042360: 6c69 7374 2e5f 5f69 6e69 745f 5f28 7365  list.__init__(se
+00042370: 6c66 290d 0a20 2020 2020 2020 2073 656c  lf)..        sel
+00042380: 662e 7820 3d20 4e6f 6e65 0d0a 2020 2020  f.x = None..    
+00042390: 2020 2020 7365 6c66 2e79 203d 204e 6f6e      self.y = Non
+000423a0: 650d 0a20 2020 2020 2020 2073 656c 662e  e..        self.
+000423b0: 7769 6474 6820 3d20 4e6f 6e65 0d0a 2020  width = None..  
+000423c0: 2020 2020 2020 7365 6c66 2e68 6569 6768        self.heigh
+000423d0: 7420 3d20 4e6f 6e65 0d0a 2020 2020 2020  t = None..      
+000423e0: 2020 5472 616e 7366 6f72 6d61 626c 652e    Transformable.
+000423f0: 5f5f 696e 6974 5f5f 2873 656c 662c 202a  __init__(self, *
+00042400: 6172 6773 2c20 2a2a 6b77 6172 6773 290d  args, **kwargs).
+00042410: 0a20 2020 2020 2020 2053 5647 456c 656d  .        SVGElem
+00042420: 656e 742e 5f5f 696e 6974 5f5f 280d 0a20  ent.__init__(.. 
+00042430: 2020 2020 2020 2020 2020 2073 656c 662c             self,
+00042440: 202a 6172 6773 2c20 2a2a 6b77 6172 6773   *args, **kwargs
+00042450: 0d0a 2020 2020 2020 2020 2920 2023 204d  ..        )  # M
+00042460: 7573 7420 676f 206c 6173 742c 2074 7269  ust go last, tri
+00042470: 6767 6572 732c 2062 795f 6f62 6a65 6374  ggers, by_object
+00042480: 2c20 6279 5f76 616c 7565 2c20 6279 5f61  , by_value, by_a
+00042490: 7267 2066 756e 6374 696f 6e73 2e0d 0a0d  rg functions....
+000424a0: 0a20 2020 2064 6566 2070 726f 7065 7274  .    def propert
+000424b0: 795f 6279 5f6f 626a 6563 7428 7365 6c66  y_by_object(self
+000424c0: 2c20 7329 3a0d 0a20 2020 2020 2020 2053  , s):..        S
+000424d0: 5647 456c 656d 656e 742e 7072 6f70 6572  VGElement.proper
+000424e0: 7479 5f62 795f 6f62 6a65 6374 2873 656c  ty_by_object(sel
+000424f0: 662c 2073 290d 0a20 2020 2020 2020 2054  f, s)..        T
+00042500: 7261 6e73 666f 726d 6162 6c65 2e70 726f  ransformable.pro
+00042510: 7065 7274 795f 6279 5f6f 626a 6563 7428  perty_by_object(
+00042520: 7365 6c66 2c20 7329 0d0a 2020 2020 2020  self, s)..      
+00042530: 2020 7365 6c66 2e78 203d 2073 2e78 0d0a    self.x = s.x..
+00042540: 2020 2020 2020 2020 7365 6c66 2e79 203d          self.y =
+00042550: 2073 2e79 0d0a 2020 2020 2020 2020 7365   s.y..        se
+00042560: 6c66 2e77 6964 7468 203d 2073 2e77 6964  lf.width = s.wid
+00042570: 7468 0d0a 2020 2020 2020 2020 7365 6c66  th..        self
+00042580: 2e68 6569 6768 7420 3d20 732e 6865 6967  .height = s.heig
+00042590: 6874 0d0a 0d0a 2020 2020 6465 6620 7072  ht....    def pr
+000425a0: 6f70 6572 7479 5f62 795f 7661 6c75 6573  operty_by_values
+000425b0: 2873 656c 662c 2076 616c 7565 7329 3a0d  (self, values):.
+000425c0: 0a20 2020 2020 2020 2073 656c 662e 7820  .        self.x 
+000425d0: 3d20 4c65 6e67 7468 2876 616c 7565 732e  = Length(values.
+000425e0: 6765 7428 5356 475f 4154 5452 5f58 2c20  get(SVG_ATTR_X, 
+000425f0: 3029 292e 7661 6c75 6528 290d 0a20 2020  0)).value()..   
+00042600: 2020 2020 2073 656c 662e 7920 3d20 4c65       self.y = Le
+00042610: 6e67 7468 2876 616c 7565 732e 6765 7428  ngth(values.get(
+00042620: 5356 475f 4154 5452 5f59 2c20 3029 292e  SVG_ATTR_Y, 0)).
+00042630: 7661 6c75 6528 290d 0a20 2020 2020 2020  value()..       
+00042640: 2073 656c 662e 7769 6474 6820 3d20 4c65   self.width = Le
+00042650: 6e67 7468 2876 616c 7565 732e 6765 7428  ngth(values.get(
+00042660: 5356 475f 4154 5452 5f57 4944 5448 2c20  SVG_ATTR_WIDTH, 
+00042670: 3129 292e 7661 6c75 6528 290d 0a20 2020  1)).value()..   
+00042680: 2020 2020 2073 656c 662e 6865 6967 6874       self.height
+00042690: 203d 204c 656e 6774 6828 7661 6c75 6573   = Length(values
+000426a0: 2e67 6574 2853 5647 5f41 5454 525f 4845  .get(SVG_ATTR_HE
+000426b0: 4947 4854 2c20 3129 292e 7661 6c75 6528  IGHT, 1)).value(
+000426c0: 290d 0a20 2020 2020 2020 2069 6620 7365  )..        if se
+000426d0: 6c66 2e78 2021 3d20 3020 6f72 2073 656c  lf.x != 0 or sel
+000426e0: 662e 7920 213d 2030 3a0d 0a20 2020 2020  f.y != 0:..     
+000426f0: 2020 2020 2020 2023 2049 6620 7820 6f72         # If x or
+00042700: 2079 2069 7320 7365 742c 2061 7070 6c79   y is set, apply
+00042710: 2074 6869 7320 746f 2074 7261 6e73 666f   this to transfo
+00042720: 726d 0d0a 2020 2020 2020 2020 2020 2020  rm..            
+00042730: 7472 793a 0d0a 2020 2020 2020 2020 2020  try:..          
+00042740: 2020 2020 2020 7661 6c75 6573 5b53 5647        values[SVG
+00042750: 5f41 5454 525f 5452 414e 5346 4f52 4d5d  _ATTR_TRANSFORM]
+00042760: 203d 2022 2573 2074 7261 6e73 6c61 7465   = "%s translate
+00042770: 2825 732c 2025 7329 2220 2520 280d 0a20  (%s, %s)" % (.. 
+00042780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042790: 2020 2076 616c 7565 735b 5356 475f 4154     values[SVG_AT
+000427a0: 5452 5f54 5241 4e53 464f 524d 5d2c 0d0a  TR_TRANSFORM],..
+000427b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000427c0: 2020 2020 7365 6c66 2e78 2c0d 0a20 2020      self.x,..   
+000427d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000427e0: 2073 656c 662e 792c 0d0a 2020 2020 2020   self.y,..      
+000427f0: 2020 2020 2020 2020 2020 290d 0a20 2020            )..   
+00042800: 2020 2020 2020 2020 2065 7863 6570 7420           except 
+00042810: 4b65 7945 7272 6f72 3a0d 0a20 2020 2020  KeyError:..     
+00042820: 2020 2020 2020 2020 2020 2076 616c 7565             value
+00042830: 735b 5356 475f 4154 5452 5f54 5241 4e53  s[SVG_ATTR_TRANS
+00042840: 464f 524d 5d20 3d20 2274 7261 6e73 6c61  FORM] = "transla
+00042850: 7465 2825 732c 2025 7329 2220 2520 280d  te(%s, %s)" % (.
+00042860: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00042870: 2020 2020 2073 656c 662e 782c 0d0a 2020       self.x,..  
+00042880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042890: 2020 7365 6c66 2e79 2c0d 0a20 2020 2020    self.y,..     
+000428a0: 2020 2020 2020 2020 2020 2029 0d0a 2020             )..  
+000428b0: 2020 2020 2020 5356 4745 6c65 6d65 6e74        SVGElement
+000428c0: 2e70 726f 7065 7274 795f 6279 5f76 616c  .property_by_val
+000428d0: 7565 7328 7365 6c66 2c20 7661 6c75 6573  ues(self, values
+000428e0: 290d 0a20 2020 2020 2020 2054 7261 6e73  )..        Trans
+000428f0: 666f 726d 6162 6c65 2e70 726f 7065 7274  formable.propert
+00042900: 795f 6279 5f76 616c 7565 7328 7365 6c66  y_by_values(self
+00042910: 2c20 7661 6c75 6573 290d 0a0d 0a20 2020  , values)....   
+00042920: 2064 6566 2072 656e 6465 7228 7365 6c66   def render(self
+00042930: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
+00042940: 2020 2020 2020 5356 4745 6c65 6d65 6e74        SVGElement
+00042950: 2e72 656e 6465 7228 7365 6c66 2c20 2a2a  .render(self, **
+00042960: 6b77 6172 6773 290d 0a20 2020 2020 2020  kwargs)..       
+00042970: 2054 7261 6e73 666f 726d 6162 6c65 2e72   Transformable.r
+00042980: 656e 6465 7228 7365 6c66 2c20 2a2a 6b77  ender(self, **kw
+00042990: 6172 6773 290d 0a0d 0a20 2020 2064 6566  args)....    def
+000429a0: 2073 656c 6563 7428 7365 6c66 2c20 636f   select(self, co
+000429b0: 6e64 6974 696f 6e61 6c3d 4e6f 6e65 293a  nditional=None):
+000429c0: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
+000429d0: 2020 2020 2020 2046 696e 6473 2061 6c6c         Finds all
+000429e0: 2066 6c61 7474 656e 6564 2073 7562 6f62   flattened subob
+000429f0: 6a65 6374 7320 6f66 2074 6869 7320 6772  jects of this gr
+00042a00: 6f75 7020 666f 7220 7768 6963 6820 7468  oup for which th
+00042a10: 6520 636f 6e64 6974 696f 6e61 6c20 7265  e conditional re
+00042a20: 7475 726e 730d 0a20 2020 2020 2020 2074  turns..        t
+00042a30: 7275 652e 0d0a 0d0a 2020 2020 2020 2020  rue.....        
+00042a40: 3a70 6172 616d 2063 6f6e 6469 7469 6f6e  :param condition
+00042a50: 616c 3a20 6675 6e63 7469 6f6e 2074 616b  al: function tak
+00042a60: 696e 6720 656c 656d 656e 7420 616e 6420  ing element and 
+00042a70: 7265 7475 726e 7320 5472 7565 2074 6f20  returns True to 
+00042a80: 696e 636c 7564 6520 6f72 2046 616c 7365  include or False
+00042a90: 2069 6620 6578 636c 7564 650d 0a20 2020   if exclude..   
+00042aa0: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
+00042ab0: 2020 6966 2063 6f6e 6469 7469 6f6e 616c    if conditional
+00042ac0: 2069 7320 4e6f 6e65 3a0d 0a20 2020 2020   is None:..     
+00042ad0: 2020 2020 2020 2066 6f72 2073 7562 6974         for subit
+00042ae0: 656d 2069 6e20 7365 6c66 3a0d 0a20 2020  em in self:..   
+00042af0: 2020 2020 2020 2020 2020 2020 2079 6965               yie
+00042b00: 6c64 2073 7562 6974 656d 0d0a 2020 2020  ld subitem..    
+00042b10: 2020 2020 2020 2020 2020 2020 6966 2069              if i
+00042b20: 7369 6e73 7461 6e63 6528 7375 6269 7465  sinstance(subite
+00042b30: 6d2c 2028 4772 6f75 702c 2055 7365 2929  m, (Group, Use))
+00042b40: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00042b50: 2020 2020 2020 2066 6f72 2073 2069 6e20         for s in 
+00042b60: 7375 6269 7465 6d2e 7365 6c65 6374 2863  subitem.select(c
+00042b70: 6f6e 6469 7469 6f6e 616c 293a 0d0a 2020  onditional):..  
+00042b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042b90: 2020 2020 2020 7969 656c 6420 730d 0a20        yield s.. 
+00042ba0: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+00042bb0: 2020 2020 2020 2020 2020 666f 7220 7375            for su
+00042bc0: 6269 7465 6d20 696e 2073 656c 663a 0d0a  bitem in self:..
+00042bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042be0: 6966 2063 6f6e 6469 7469 6f6e 616c 2873  if conditional(s
+00042bf0: 7562 6974 656d 293a 0d0a 2020 2020 2020  ubitem):..      
+00042c00: 2020 2020 2020 2020 2020 2020 2020 7969                yi
+00042c10: 656c 6420 7375 6269 7465 6d0d 0a20 2020  eld subitem..   
+00042c20: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00042c30: 6973 696e 7374 616e 6365 2873 7562 6974  isinstance(subit
+00042c40: 656d 2c20 2847 726f 7570 2c20 5573 6529  em, (Group, Use)
+00042c50: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00042c60: 2020 2020 2020 2020 666f 7220 7320 696e          for s in
+00042c70: 2073 7562 6974 656d 2e73 656c 6563 7428   subitem.select(
+00042c80: 636f 6e64 6974 696f 6e61 6c29 3a0d 0a20  conditional):.. 
+00042c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042ca0: 2020 2020 2020 2079 6965 6c64 2073 0d0a         yield s..
+00042cb0: 0d0a 2020 2020 4073 7461 7469 636d 6574  ..    @staticmet
+00042cc0: 686f 640d 0a20 2020 2064 6566 2075 6e69  hod..    def uni
+00042cd0: 6f6e 5f62 626f 7828 656c 656d 656e 7473  on_bbox(elements
+00042ce0: 2c20 7472 616e 7366 6f72 6d65 643d 5472  , transformed=Tr
+00042cf0: 7565 2c20 7769 7468 5f73 7472 6f6b 653d  ue, with_stroke=
+00042d00: 4661 6c73 6529 3a0d 0a20 2020 2020 2020  False):..       
+00042d10: 2022 2222 0d0a 2020 2020 2020 2020 5265   """..        Re
+00042d20: 7475 726e 7320 7468 6520 756e 696f 6e20  turns the union 
+00042d30: 6f66 2074 6865 2062 6f75 6e64 696e 6720  of the bounding 
+00042d40: 626f 7865 7320 666f 7220 7468 6520 656c  boxes for the el
+00042d50: 656d 656e 7473 2077 6974 6869 6e20 7468  ements within th
+00042d60: 6520 6974 6572 6174 6f72 2e0d 0a0d 0a20  e iterator..... 
+00042d70: 2020 2020 2020 203a 7061 7261 6d20 7472         :param tr
+00042d80: 616e 7366 6f72 6d65 643a 2053 686f 756c  ansformed: Shoul
+00042d90: 6420 7468 6520 6368 696c 6472 656e 206f  d the children o
+00042da0: 6620 7468 6973 206f 626a 6563 7420 6265  f this object be
+00042db0: 2070 726f 7065 726c 7920 7472 616e 7366   properly transf
+00042dc0: 6f72 6d65 642e 0d0a 2020 2020 2020 2020  ormed...        
+00042dd0: 3a70 6172 616d 2077 6974 685f 7374 726f  :param with_stro
+00042de0: 6b65 3a20 7368 6f75 6c64 2074 6865 2073  ke: should the s
+00042df0: 7472 6f6b 652d 7769 6474 6820 6265 2069  troke-width be i
+00042e00: 6e63 6c75 6465 6420 696e 2074 6865 2062  ncluded in the b
+00042e10: 6f75 6e64 7320 6f66 2074 6865 2065 6c65  ounds of the ele
+00042e20: 6d65 6e74 730d 0a20 2020 2020 2020 203a  ments..        :
+00042e30: 7265 7475 726e 3a20 756e 696f 6e20 6f66  return: union of
+00042e40: 2061 6c6c 2062 6f75 6e64 696e 6720 626f   all bounding bo
+00042e50: 7865 7320 6f66 2065 6c65 6d65 6e74 7320  xes of elements 
+00042e60: 7769 7468 696e 2074 6865 2069 7465 7261  within the itera
+00042e70: 626c 652e 0d0a 2020 2020 2020 2020 2222  ble...        ""
+00042e80: 220d 0a20 2020 2020 2020 2062 6f78 6573  "..        boxes
+00042e90: 203d 205b 5d0d 0a20 2020 2020 2020 2066   = []..        f
+00042ea0: 6f72 2065 2069 6e20 656c 656d 656e 7473  or e in elements
+00042eb0: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
+00042ec0: 6620 6e6f 7420 6861 7361 7474 7228 652c  f not hasattr(e,
+00042ed0: 2022 6262 6f78 2229 206f 7220 6973 696e   "bbox") or isin
+00042ee0: 7374 616e 6365 2865 2c20 2847 726f 7570  stance(e, (Group
+00042ef0: 2c20 5573 6529 293a 0d0a 2020 2020 2020  , Use)):..      
+00042f00: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
+00042f10: 7565 0d0a 2020 2020 2020 2020 2020 2020  ue..            
+00042f20: 626f 7820 3d20 652e 6262 6f78 2874 7261  box = e.bbox(tra
+00042f30: 6e73 666f 726d 6564 3d74 7261 6e73 666f  nsformed=transfo
+00042f40: 726d 6564 2c20 7769 7468 5f73 7472 6f6b  rmed, with_strok
+00042f50: 653d 7769 7468 5f73 7472 6f6b 6529 0d0a  e=with_stroke)..
+00042f60: 2020 2020 2020 2020 2020 2020 6966 2062              if b
+00042f70: 6f78 2069 7320 4e6f 6e65 3a0d 0a20 2020  ox is None:..   
+00042f80: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+00042f90: 7469 6e75 650d 0a20 2020 2020 2020 2020  tinue..         
+00042fa0: 2020 2062 6f78 6573 2e61 7070 656e 6428     boxes.append(
+00042fb0: 626f 7829 0d0a 2020 2020 2020 2020 6966  box)..        if
+00042fc0: 206c 656e 2862 6f78 6573 2920 3d3d 2030   len(boxes) == 0
+00042fd0: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
+00042fe0: 6574 7572 6e20 4e6f 6e65 0d0a 2020 2020  eturn None..    
+00042ff0: 2020 2020 2878 6d69 6e73 2c20 796d 696e      (xmins, ymin
+00043000: 732c 2078 6d61 7873 2c20 796d 6178 7329  s, xmaxs, ymaxs)
+00043010: 203d 207a 6970 282a 626f 7865 7329 0d0a   = zip(*boxes)..
+00043020: 2020 2020 2020 2020 7265 7475 726e 2028          return (
+00043030: 6d69 6e28 786d 696e 7329 2c20 6d69 6e28  min(xmins), min(
+00043040: 796d 696e 7329 2c20 6d61 7828 786d 6178  ymins), max(xmax
+00043050: 7329 2c20 6d61 7828 796d 6178 7329 290d  s), max(ymaxs)).
+00043060: 0a0d 0a20 2020 2064 6566 2062 626f 7828  ...    def bbox(
+00043070: 7365 6c66 2c20 7472 616e 7366 6f72 6d65  self, transforme
+00043080: 643d 5472 7565 2c20 7769 7468 5f73 7472  d=True, with_str
+00043090: 6f6b 653d 4661 6c73 6529 3a0d 0a20 2020  oke=False):..   
+000430a0: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
+000430b0: 2020 5265 7475 726e 7320 7468 6520 626f    Returns the bo
+000430c0: 756e 6469 6e67 2062 6f78 206f 6620 7468  unding box of th
+000430d0: 6520 6769 7665 6e20 6f62 6a65 6374 2e0d  e given object..
+000430e0: 0a0d 0a20 2020 2020 2020 2049 6e20 7468  ...        In th
+000430f0: 6520 6361 7365 206f 6620 6772 6f75 7073  e case of groups
+00043100: 2074 6869 7320 6973 2074 6865 2075 6e69   this is the uni
+00043110: 6f6e 206f 6620 616c 6c20 7468 6520 626f  on of all the bo
+00043120: 756e 6469 6e67 2062 6f78 6573 206f 6620  unding boxes of 
+00043130: 616c 6c20 626f 756e 6420 6368 696c 6472  all bound childr
+00043140: 656e 2e0d 0a0d 0a20 2020 2020 2020 2053  en.....        S
+00043150: 6574 7469 6e67 2074 7261 6e73 666f 726d  etting transform
+00043160: 6564 2074 6f20 6661 6c73 652c 206d 6179  ed to false, may
+00043170: 2079 6965 6c64 2075 6e65 7870 6563 7465   yield unexpecte
+00043180: 6420 7265 7375 6c74 7320 6966 2073 7562  d results if sub
+00043190: 6974 656d 7320 6172 6520 7472 616e 7366  items are transf
+000431a0: 6f72 6d65 6420 696e 206e 6f6e 2d75 6e69  ormed in non-uni
+000431b0: 666f 726d 0d0a 2020 2020 2020 2020 7761  form..        wa
+000431c0: 7973 2e0d 0a0d 0a20 2020 2020 2020 203a  ys.....        :
+000431d0: 7061 7261 6d20 7472 616e 7366 6f72 6d65  param transforme
+000431e0: 643a 2062 6f75 6e64 696e 6720 626f 7820  d: bounding box 
+000431f0: 6f66 2074 6865 2070 726f 7065 726c 7920  of the properly 
+00043200: 7472 616e 7366 6f72 6d65 6420 6368 696c  transformed chil
+00043210: 6472 656e 2e0d 0a20 2020 2020 2020 203a  dren...        :
+00043220: 7061 7261 6d20 7769 7468 5f73 7472 6f6b  param with_strok
+00043230: 653a 2073 686f 756c 6420 7468 6520 7374  e: should the st
+00043240: 726f 6b65 2d77 6964 7468 2062 6520 696e  roke-width be in
+00043250: 636c 7564 6564 2069 6e20 7468 6520 626f  cluded in the bo
+00043260: 756e 6473 2e0d 0a20 2020 2020 2020 203a  unds...        :
+00043270: 7265 7475 726e 3a20 626f 756e 6469 6e67  return: bounding
+00043280: 2062 6f78 206f 6620 7468 6520 6769 7665   box of the give
+00043290: 6e20 656c 656d 656e 740d 0a20 2020 2020  n element..     
+000432a0: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
+000432b0: 7265 7475 726e 2055 7365 2e75 6e69 6f6e  return Use.union
+000432c0: 5f62 626f 7828 0d0a 2020 2020 2020 2020  _bbox(..        
+000432d0: 2020 2020 7365 6c66 2e73 656c 6563 7428      self.select(
+000432e0: 292c 0d0a 2020 2020 2020 2020 2020 2020  ),..            
+000432f0: 7472 616e 7366 6f72 6d65 643d 7472 616e  transformed=tran
+00043300: 7366 6f72 6d65 642c 0d0a 2020 2020 2020  sformed,..      
+00043310: 2020 2020 2020 7769 7468 5f73 7472 6f6b        with_strok
+00043320: 653d 7769 7468 5f73 7472 6f6b 652c 0d0a  e=with_stroke,..
+00043330: 2020 2020 2020 2020 290d 0a0d 0a0d 0a63          )......c
+00043340: 6c61 7373 2043 6c69 7050 6174 6828 5356  lass ClipPath(SV
+00043350: 4745 6c65 6d65 6e74 2c20 6c69 7374 293a  GElement, list):
+00043360: 0d0a 2020 2020 2222 220d 0a20 2020 2063  ..    """..    c
+00043370: 6c69 7050 6174 6820 656c 656d 656e 7473  lipPath elements
+00043380: 2061 7265 2064 6566 696e 6564 2069 6e20   are defined in 
+00043390: 7376 6720 3134 2e33 2e35 0d0a 2020 2020  svg 14.3.5..    
+000433a0: 6874 7470 733a 2f2f 7777 772e 7733 2e6f  https://www.w3.o
+000433b0: 7267 2f54 522f 5356 4731 312f 6d61 736b  rg/TR/SVG11/mask
+000433c0: 696e 672e 6874 6d6c 2343 6c69 7050 6174  ing.html#ClipPat
+000433d0: 6845 6c65 6d65 6e74 0d0a 0d0a 2020 2020  hElement....    
+000433e0: 436c 6970 2070 6174 6873 2063 6f6e 6365  Clip paths conce
+000433f0: 7074 7561 6c6c 7920 6465 6669 6e65 2061  ptually define a
+00043400: 2031 2062 6974 206d 6173 6b20 666f 7220   1 bit mask for 
+00043410: 696d 6167 6573 2074 6865 7365 2061 7265  images these are
+00043420: 2075 7375 616c 6c79 2064 6566 696e 6564   usually defined
+00043430: 2077 6974 6869 6e0d 0a20 2020 2064 6566   within..    def
+00043440: 2062 6c6f 636b 7320 616e 6420 646f 206e   blocks and do n
+00043450: 6f74 2072 656e 6465 7220 7468 656d 7365  ot render themse
+00043460: 6c76 6573 2062 7574 2072 6174 6865 7220  lves but rather 
+00043470: 6172 6520 6174 7461 6368 6564 2062 7920  are attached by 
+00043480: 4952 4920 7265 6665 7265 6e63 6573 2074  IRI references t
+00043490: 6f20 7468 650d 0a20 2020 2022 2222 0d0a  o the..    """..
+000434a0: 0d0a 2020 2020 6465 6620 5f5f 696e 6974  ..    def __init
+000434b0: 5f5f 2873 656c 662c 202a 6172 6773 2c20  __(self, *args, 
+000434c0: 2a2a 6b77 6172 6773 293a 0d0a 2020 2020  **kwargs):..    
+000434d0: 2020 2020 6c69 7374 2e5f 5f69 6e69 745f      list.__init_
+000434e0: 5f28 7365 6c66 290d 0a20 2020 2020 2020  _(self)..       
+000434f0: 2073 656c 662e 756e 6974 5f74 7970 6520   self.unit_type 
+00043500: 3d20 5356 475f 554e 4954 5f54 5950 455f  = SVG_UNIT_TYPE_
+00043510: 5553 4552 5350 4143 454f 4e55 5345 0d0a  USERSPACEONUSE..
+00043520: 2020 2020 2020 2020 5356 4745 6c65 6d65          SVGEleme
+00043530: 6e74 2e5f 5f69 6e69 745f 5f28 7365 6c66  nt.__init__(self
+00043540: 2c20 2a61 7267 732c 202a 2a6b 7761 7267  , *args, **kwarg
+00043550: 7329 0d0a 0d0a 2020 2020 6465 6620 7072  s)....    def pr
+00043560: 6f70 6572 7479 5f62 795f 6f62 6a65 6374  operty_by_object
+00043570: 2873 656c 662c 2073 293a 0d0a 2020 2020  (self, s):..    
+00043580: 2020 2020 5356 4745 6c65 6d65 6e74 2e70      SVGElement.p
+00043590: 726f 7065 7274 795f 6279 5f6f 626a 6563  roperty_by_objec
+000435a0: 7428 7365 6c66 2c20 7329 0d0a 2020 2020  t(self, s)..    
+000435b0: 2020 2020 7365 6c66 2e75 6e69 745f 7479      self.unit_ty
+000435c0: 7065 203d 2073 2e75 6e69 745f 7479 7065  pe = s.unit_type
+000435d0: 0d0a 0d0a 2020 2020 6465 6620 7072 6f70  ....    def prop
+000435e0: 6572 7479 5f62 795f 7661 6c75 6573 2873  erty_by_values(s
+000435f0: 656c 662c 2076 616c 7565 7329 3a0d 0a20  elf, values):.. 
+00043600: 2020 2020 2020 2053 5647 456c 656d 656e         SVGElemen
+00043610: 742e 7072 6f70 6572 7479 5f62 795f 7661  t.property_by_va
+00043620: 6c75 6573 2873 656c 662c 2076 616c 7565  lues(self, value
+00043630: 7329 0d0a 2020 2020 2020 2020 7365 6c66  s)..        self
+00043640: 2e75 6e69 745f 7479 7065 203d 2073 656c  .unit_type = sel
+00043650: 662e 7661 6c75 6573 2e67 6574 280d 0a20  f.values.get(.. 
+00043660: 2020 2020 2020 2020 2020 2053 5647 5f41             SVG_A
+00043670: 5454 525f 434c 4950 5f55 4e49 545f 5459  TTR_CLIP_UNIT_TY
+00043680: 5045 2c20 5356 475f 554e 4954 5f54 5950  PE, SVG_UNIT_TYP
+00043690: 455f 5553 4552 5350 4143 454f 4e55 5345  E_USERSPACEONUSE
+000436a0: 0d0a 2020 2020 2020 2020 290d 0a0d 0a0d  ..        ).....
+000436b0: 0a63 6c61 7373 2050 6174 7465 726e 2853  .class Pattern(S
+000436c0: 5647 456c 656d 656e 742c 206c 6973 7429  VGElement, list)
+000436d0: 3a0d 0a20 2020 2064 6566 205f 5f69 6e69  :..    def __ini
+000436e0: 745f 5f28 7365 6c66 2c20 2a61 7267 732c  t__(self, *args,
+000436f0: 202a 2a6b 7761 7267 7329 3a0d 0a20 2020   **kwargs):..   
+00043700: 2020 2020 2073 656c 662e 7669 6577 626f       self.viewbo
+00043710: 7820 3d20 4e6f 6e65 0d0a 2020 2020 2020  x = None..      
+00043720: 2020 7365 6c66 2e70 7265 7365 7276 655f    self.preserve_
+00043730: 6173 7065 6374 5f72 6174 696f 203d 204e  aspect_ratio = N
+00043740: 6f6e 650d 0a20 2020 2020 2020 2073 656c  one..        sel
+00043750: 662e 7820 3d20 4e6f 6e65 0d0a 2020 2020  f.x = None..    
+00043760: 2020 2020 7365 6c66 2e79 203d 204e 6f6e      self.y = Non
+00043770: 650d 0a20 2020 2020 2020 2073 656c 662e  e..        self.
+00043780: 7769 6474 6820 3d20 4e6f 6e65 0d0a 2020  width = None..  
+00043790: 2020 2020 2020 7365 6c66 2e68 6569 6768        self.heigh
+000437a0: 7420 3d20 4e6f 6e65 0d0a 2020 2020 2020  t = None..      
+000437b0: 2020 7365 6c66 2e68 7265 6620 3d20 4e6f    self.href = No
+000437c0: 6e65 0d0a 2020 2020 2020 2020 7365 6c66  ne..        self
+000437d0: 2e70 6174 7465 726e 5f63 6f6e 7465 6e74  .pattern_content
+000437e0: 5f75 6e69 7473 203d 204e 6f6e 6520 2023  _units = None  #
+000437f0: 2055 7365 7253 7061 6365 4f6e 5573 6520   UserSpaceOnUse 
+00043800: 6465 6661 756c 740d 0a20 2020 2020 2020  default..       
+00043810: 2073 656c 662e 7061 7474 6572 6e5f 7472   self.pattern_tr
+00043820: 616e 7366 6f72 6d20 3d20 4e6f 6e65 0d0a  ansform = None..
+00043830: 2020 2020 2020 2020 7365 6c66 2e70 6174          self.pat
+00043840: 7465 726e 5f75 6e69 7473 203d 204e 6f6e  tern_units = Non
+00043850: 650d 0a20 2020 2020 2020 2053 5647 456c  e..        SVGEl
+00043860: 656d 656e 742e 5f5f 696e 6974 5f5f 2873  ement.__init__(s
+00043870: 656c 662c 202a 6172 6773 2c20 2a2a 6b77  elf, *args, **kw
+00043880: 6172 6773 290d 0a0d 0a20 2020 2064 6566  args)....    def
+00043890: 205f 5f69 6e74 5f5f 2873 656c 6629 3a0d   __int__(self):.
+000438a0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000438b0: 300d 0a0d 0a20 2020 2040 7072 6f70 6572  0....    @proper
+000438c0: 7479 0d0a 2020 2020 6465 6620 7669 6577  ty..    def view
+000438d0: 626f 785f 7472 616e 7366 6f72 6d28 7365  box_transform(se
+000438e0: 6c66 293a 0d0a 2020 2020 2020 2020 6966  lf):..        if
+000438f0: 2073 656c 662e 7669 6577 626f 7820 6973   self.viewbox is
+00043900: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+00043910: 2020 2020 7265 7475 726e 2022 220d 0a20      return "".. 
+00043920: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+00043930: 6c66 2e76 6965 7762 6f78 2e74 7261 6e73  lf.viewbox.trans
+00043940: 666f 726d 2873 656c 6629 0d0a 0d0a 2020  form(self)....  
+00043950: 2020 6465 6620 7072 6f70 6572 7479 5f62    def property_b
+00043960: 795f 6f62 6a65 6374 2873 656c 662c 2073  y_object(self, s
+00043970: 293a 0d0a 2020 2020 2020 2020 5356 4745  ):..        SVGE
+00043980: 6c65 6d65 6e74 2e70 726f 7065 7274 795f  lement.property_
+00043990: 6279 5f6f 626a 6563 7428 7365 6c66 2c20  by_object(self, 
+000439a0: 7329 0d0a 2020 2020 2020 2020 7365 6c66  s)..        self
+000439b0: 2e76 6965 7762 6f78 203d 2073 2e76 6965  .viewbox = s.vie
+000439c0: 7762 6f78 0d0a 2020 2020 2020 2020 7365  wbox..        se
+000439d0: 6c66 2e70 7265 7365 7276 655f 6173 7065  lf.preserve_aspe
+000439e0: 6374 5f72 6174 696f 203d 2073 2e70 7265  ct_ratio = s.pre
+000439f0: 7365 7276 655f 6173 7065 6374 5f72 6174  serve_aspect_rat
+00043a00: 696f 0d0a 0d0a 2020 2020 2020 2020 7365  io....        se
+00043a10: 6c66 2e78 203d 2073 2e78 0d0a 2020 2020  lf.x = s.x..    
+00043a20: 2020 2020 7365 6c66 2e79 203d 2073 2e79      self.y = s.y
+00043a30: 0d0a 2020 2020 2020 2020 7365 6c66 2e77  ..        self.w
+00043a40: 6964 7468 203d 2073 2e77 6964 7468 0d0a  idth = s.width..
+00043a50: 2020 2020 2020 2020 7365 6c66 2e68 6569          self.hei
+00043a60: 6768 7420 3d20 732e 6865 6967 6874 0d0a  ght = s.height..
+00043a70: 2020 2020 2020 2020 7365 6c66 2e68 7265          self.hre
+00043a80: 6620 3d20 732e 6872 6566 0d0a 2020 2020  f = s.href..    
+00043a90: 2020 2020 7365 6c66 2e70 6174 7465 726e      self.pattern
+00043aa0: 5f63 6f6e 7465 6e74 5f75 6e69 7473 203d  _content_units =
+00043ab0: 2073 2e70 6174 7465 726e 5f63 6f6e 7465   s.pattern_conte
+00043ac0: 6e74 735f 756e 6974 730d 0a20 2020 2020  nts_units..     
+00043ad0: 2020 2073 656c 662e 7061 7474 6572 6e5f     self.pattern_
+00043ae0: 7472 616e 7366 6f72 6d20 3d20 280d 0a20  transform = (.. 
+00043af0: 2020 2020 2020 2020 2020 204d 6174 7269             Matri
+00043b00: 7828 732e 7061 7474 6572 6e5f 7472 616e  x(s.pattern_tran
+00043b10: 7366 6f72 6d29 2069 6620 732e 7061 7474  sform) if s.patt
+00043b20: 6572 6e5f 7472 616e 7366 6f72 6d20 6973  ern_transform is
+00043b30: 206e 6f74 204e 6f6e 6520 656c 7365 204e   not None else N
+00043b40: 6f6e 650d 0a20 2020 2020 2020 2029 0d0a  one..        )..
+00043b50: 2020 2020 2020 2020 7365 6c66 2e70 6174          self.pat
+00043b60: 7465 726e 5f75 6e69 7473 203d 2073 2e70  tern_units = s.p
+00043b70: 6174 7465 726e 5f75 6e69 7473 0d0a 0d0a  attern_units....
+00043b80: 2020 2020 6465 6620 7072 6f70 6572 7479      def property
+00043b90: 5f62 795f 7661 6c75 6573 2873 656c 662c  _by_values(self,
+00043ba0: 2076 616c 7565 7329 3a0d 0a20 2020 2020   values):..     
+00043bb0: 2020 2053 5647 456c 656d 656e 742e 7072     SVGElement.pr
+00043bc0: 6f70 6572 7479 5f62 795f 7661 6c75 6573  operty_by_values
+00043bd0: 2873 656c 662c 2076 616c 7565 7329 0d0a  (self, values)..
+00043be0: 2020 2020 2020 2020 6966 2058 4c49 4e4b          if XLINK
+00043bf0: 5f48 5245 4620 696e 2076 616c 7565 733a  _HREF in values:
+00043c00: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00043c10: 6c66 2e68 7265 6620 3d20 7661 6c75 6573  lf.href = values
+00043c20: 5b58 4c49 4e4b 5f48 5245 465d 0d0a 2020  [XLINK_HREF]..  
+00043c30: 2020 2020 2020 656c 6966 2053 5647 5f48        elif SVG_H
+00043c40: 5245 4620 696e 2076 616c 7565 733a 0d0a  REF in values:..
+00043c50: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00043c60: 2e68 7265 6620 3d20 7661 6c75 6573 5b53  .href = values[S
+00043c70: 5647 5f48 5245 465d 0d0a 2020 2020 2020  VG_HREF]..      
+00043c80: 2020 7669 6577 626f 7820 3d20 7661 6c75    viewbox = valu
+00043c90: 6573 2e67 6574 2853 5647 5f41 5454 525f  es.get(SVG_ATTR_
+00043ca0: 5649 4557 424f 5829 0d0a 2020 2020 2020  VIEWBOX)..      
+00043cb0: 2020 6966 2076 6965 7762 6f78 2069 7320    if viewbox is 
+00043cc0: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
+00043cd0: 2020 2020 2020 2073 656c 662e 7669 6577         self.view
+00043ce0: 626f 7820 3d20 5669 6577 626f 7828 7669  box = Viewbox(vi
+00043cf0: 6577 626f 7829 0d0a 2020 2020 2020 2020  ewbox)..        
+00043d00: 6966 2053 5647 5f41 5454 525f 5052 4553  if SVG_ATTR_PRES
+00043d10: 4552 5645 4153 5045 4354 5241 5449 4f20  ERVEASPECTRATIO 
+00043d20: 696e 2076 616c 7565 733a 0d0a 2020 2020  in values:..    
+00043d30: 2020 2020 2020 2020 7365 6c66 2e70 7265          self.pre
+00043d40: 7365 7276 655f 6173 7065 6374 5f72 6174  serve_aspect_rat
+00043d50: 696f 203d 2076 616c 7565 735b 5356 475f  io = values[SVG_
+00043d60: 4154 5452 5f50 5245 5345 5256 4541 5350  ATTR_PRESERVEASP
+00043d70: 4543 5452 4154 494f 5d0d 0a20 2020 2020  ECTRATIO]..     
+00043d80: 2020 2073 656c 662e 7820 3d20 4c65 6e67     self.x = Leng
+00043d90: 7468 2876 616c 7565 732e 6765 7428 5356  th(values.get(SV
+00043da0: 475f 4154 5452 5f58 2c20 3029 292e 7661  G_ATTR_X, 0)).va
+00043db0: 6c75 6528 290d 0a20 2020 2020 2020 2073  lue()..        s
+00043dc0: 656c 662e 7920 3d20 4c65 6e67 7468 2876  elf.y = Length(v
+00043dd0: 616c 7565 732e 6765 7428 5356 475f 4154  alues.get(SVG_AT
+00043de0: 5452 5f59 2c20 3029 292e 7661 6c75 6528  TR_Y, 0)).value(
+00043df0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00043e00: 7769 6474 6820 3d20 4c65 6e67 7468 2876  width = Length(v
+00043e10: 616c 7565 732e 6765 7428 5356 475f 4154  alues.get(SVG_AT
+00043e20: 5452 5f57 4944 5448 2c20 2231 3030 2522  TR_WIDTH, "100%"
+00043e30: 2929 2e76 616c 7565 2829 0d0a 2020 2020  )).value()..    
+00043e40: 2020 2020 7365 6c66 2e68 6569 6768 7420      self.height 
+00043e50: 3d20 4c65 6e67 7468 2876 616c 7565 732e  = Length(values.
+00043e60: 6765 7428 5356 475f 4154 5452 5f48 4549  get(SVG_ATTR_HEI
+00043e70: 4748 542c 2022 3130 3025 2229 292e 7661  GHT, "100%")).va
+00043e80: 6c75 6528 290d 0a20 2020 2020 2020 2069  lue()..        i
+00043e90: 6620 5356 475f 4154 5452 5f50 4154 5445  f SVG_ATTR_PATTE
+00043ea0: 524e 5f43 4f4e 5445 4e54 5f55 4e49 5453  RN_CONTENT_UNITS
+00043eb0: 2069 6e20 7661 6c75 6573 3a0d 0a20 2020   in values:..   
+00043ec0: 2020 2020 2020 2020 2073 656c 662e 7061           self.pa
+00043ed0: 7474 6572 6e5f 636f 6e74 656e 745f 756e  ttern_content_un
+00043ee0: 6974 7320 3d20 7661 6c75 6573 5b53 5647  its = values[SVG
+00043ef0: 5f41 5454 525f 5041 5454 4552 4e5f 434f  _ATTR_PATTERN_CO
+00043f00: 4e54 454e 545f 554e 4954 535d 0d0a 2020  NTENT_UNITS]..  
+00043f10: 2020 2020 2020 6966 2053 5647 5f41 5454        if SVG_ATT
+00043f20: 525f 5041 5454 4552 4e5f 5452 414e 5346  R_PATTERN_TRANSF
+00043f30: 4f52 4d20 696e 2076 616c 7565 733a 0d0a  ORM in values:..
+00043f40: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00043f50: 2e70 6174 7465 726e 5f74 7261 6e73 666f  .pattern_transfo
+00043f60: 726d 203d 204d 6174 7269 7828 7661 6c75  rm = Matrix(valu
+00043f70: 6573 5b53 5647 5f41 5454 525f 5041 5454  es[SVG_ATTR_PATT
+00043f80: 4552 4e5f 5452 414e 5346 4f52 4d5d 290d  ERN_TRANSFORM]).
+00043f90: 0a20 2020 2020 2020 2069 6620 5356 475f  .        if SVG_
+00043fa0: 4154 5452 5f50 4154 5445 524e 5f55 4e49  ATTR_PATTERN_UNI
+00043fb0: 5453 2069 6e20 7661 6c75 6573 3a0d 0a20  TS in values:.. 
+00043fc0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00043fd0: 7061 7474 6572 6e5f 756e 6974 7320 3d20  pattern_units = 
+00043fe0: 7661 6c75 6573 5b53 5647 5f41 5454 525f  values[SVG_ATTR_
+00043ff0: 5041 5454 4552 4e5f 554e 4954 535d 0d0a  PATTERN_UNITS]..
+00044000: 0d0a 2020 2020 6465 6620 7265 6e64 6572  ..    def render
+00044010: 2873 656c 662c 202a 2a6b 7761 7267 7329  (self, **kwargs)
+00044020: 3a0d 0a20 2020 2020 2020 2069 6620 7365  :..        if se
+00044030: 6c66 2e70 6174 7465 726e 5f74 7261 6e73  lf.pattern_trans
+00044040: 666f 726d 2069 7320 6e6f 7420 4e6f 6e65  form is not None
+00044050: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
+00044060: 656c 662e 7061 7474 6572 6e5f 7472 616e  elf.pattern_tran
+00044070: 7366 6f72 6d2e 7265 6e64 6572 282a 2a6b  sform.render(**k
+00044080: 7761 7267 7329 0d0a 2020 2020 2020 2020  wargs)..        
+00044090: 7769 6474 6820 3d20 6b77 6172 6773 2e67  width = kwargs.g
+000440a0: 6574 2822 7769 6474 6822 2c20 6b77 6172  et("width", kwar
+000440b0: 6773 2e67 6574 2822 7265 6c61 7469 7665  gs.get("relative
+000440c0: 5f6c 656e 6774 6822 2929 0d0a 2020 2020  _length"))..    
+000440d0: 2020 2020 6865 6967 6874 203d 206b 7761      height = kwa
+000440e0: 7267 732e 6765 7428 2268 6569 6768 7422  rgs.get("height"
+000440f0: 2c20 6b77 6172 6773 2e67 6574 2822 7265  , kwargs.get("re
+00044100: 6c61 7469 7665 5f6c 656e 6774 6822 2929  lative_length"))
+00044110: 0d0a 2020 2020 2020 2020 7472 793a 0d0a  ..        try:..
+00044120: 2020 2020 2020 2020 2020 2020 6465 6c20              del 
+00044130: 6b77 6172 6773 5b22 7265 6c61 7469 7665  kwargs["relative
+00044140: 5f6c 656e 6774 6822 5d0d 0a20 2020 2020  _length"]..     
+00044150: 2020 2065 7863 6570 7420 4b65 7945 7272     except KeyErr
+00044160: 6f72 3a0d 0a20 2020 2020 2020 2020 2020  or:..           
+00044170: 2070 6173 730d 0a20 2020 2020 2020 2069   pass..        i
+00044180: 6620 6973 696e 7374 616e 6365 2873 656c  f isinstance(sel
+00044190: 662e 782c 204c 656e 6774 6829 3a0d 0a20  f.x, Length):.. 
+000441a0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000441b0: 7820 3d20 7365 6c66 2e78 2e76 616c 7565  x = self.x.value
+000441c0: 2872 656c 6174 6976 655f 6c65 6e67 7468  (relative_length
+000441d0: 3d77 6964 7468 2c20 2a2a 6b77 6172 6773  =width, **kwargs
+000441e0: 290d 0a20 2020 2020 2020 2069 6620 6973  )..        if is
+000441f0: 696e 7374 616e 6365 2873 656c 662e 792c  instance(self.y,
+00044200: 204c 656e 6774 6829 3a0d 0a20 2020 2020   Length):..     
+00044210: 2020 2020 2020 2073 656c 662e 7920 3d20         self.y = 
+00044220: 7365 6c66 2e79 2e76 616c 7565 2872 656c  self.y.value(rel
+00044230: 6174 6976 655f 6c65 6e67 7468 3d68 6569  ative_length=hei
+00044240: 6768 742c 202a 2a6b 7761 7267 7329 0d0a  ght, **kwargs)..
+00044250: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+00044260: 7461 6e63 6528 7365 6c66 2e77 6964 7468  tance(self.width
+00044270: 2c20 4c65 6e67 7468 293a 0d0a 2020 2020  , Length):..    
+00044280: 2020 2020 2020 2020 7365 6c66 2e77 6964          self.wid
+00044290: 7468 203d 2073 656c 662e 7769 6474 682e  th = self.width.
+000442a0: 7661 6c75 6528 7265 6c61 7469 7665 5f6c  value(relative_l
+000442b0: 656e 6774 683d 7769 6474 682c 202a 2a6b  ength=width, **k
+000442c0: 7761 7267 7329 0d0a 2020 2020 2020 2020  wargs)..        
+000442d0: 6966 2069 7369 6e73 7461 6e63 6528 7365  if isinstance(se
+000442e0: 6c66 2e68 6569 6768 742c 204c 656e 6774  lf.height, Lengt
+000442f0: 6829 3a0d 0a20 2020 2020 2020 2020 2020  h):..           
+00044300: 2073 656c 662e 6865 6967 6874 203d 2073   self.height = s
+00044310: 656c 662e 6865 6967 6874 2e76 616c 7565  elf.height.value
+00044320: 2872 656c 6174 6976 655f 6c65 6e67 7468  (relative_length
+00044330: 3d68 6569 6768 742c 202a 2a6b 7761 7267  =height, **kwarg
+00044340: 7329 0d0a 2020 2020 2020 2020 7265 7475  s)..        retu
+00044350: 726e 2073 656c 660d 0a0d 0a0d 0a63 6c61  rn self......cla
+00044360: 7373 2054 6578 7428 5356 4745 6c65 6d65  ss Text(SVGEleme
+00044370: 6e74 2c20 4772 6170 6869 634f 626a 6563  nt, GraphicObjec
+00044380: 742c 2054 7261 6e73 666f 726d 6162 6c65  t, Transformable
+00044390: 293a 0d0a 2020 2020 2222 220d 0a20 2020  ):..    """..   
+000443a0: 2053 5647 2054 6578 7420 6172 6520 6465   SVG Text are de
+000443b0: 6669 6e65 6420 696e 2053 5647 2032 2e30  fined in SVG 2.0
+000443c0: 2043 6861 7074 6572 2031 310d 0a0d 0a20   Chapter 11.... 
+000443d0: 2020 204e 6f20 6d65 7468 6f64 7320 6172     No methods ar
+000443e0: 6520 696d 706c 656d 656e 7465 6420 746f  e implemented to
+000443f0: 2070 6572 666f 726d 2061 2074 6578 7420   perform a text 
+00044400: 746f 2070 6174 6820 636f 6e76 6572 7369  to path conversi
+00044410: 6f6e 2e0d 0a0d 0a20 2020 2048 6f77 6576  on.....    Howev
+00044420: 6572 2c20 6966 2073 7563 6820 6120 6d65  er, if such a me
+00044430: 7468 6f64 2065 7869 7374 7320 7468 6520  thod exists the 
+00044440: 6173 7375 6d70 7469 6f6e 2069 7320 7468  assumption is th
+00044450: 6174 2074 6865 2072 6573 756c 7473 2077  at the results w
+00044460: 696c 6c20 6265 0d0a 2020 2020 706c 6163  ill be..    plac
+00044470: 6564 2069 6e20 7468 6520 2e70 6174 6820  ed in the .path 
+00044480: 6174 7472 6962 7574 652c 2061 6e64 2066  attribute, and f
+00044490: 756e 6374 696f 6e73 206c 696b 6520 6262  unctions like bb
+000444a0: 6f78 2829 2077 696c 6c20 6368 6563 6b20  ox() will check 
+000444b0: 6966 2073 7563 680d 0a20 2020 2061 2076  if such..    a v
+000444c0: 616c 7565 2065 7869 7374 732e 0d0a 2020  alue exists...  
+000444d0: 2020 2222 220d 0a0d 0a20 2020 2064 6566    """....    def
+000444e0: 205f 5f69 6e69 745f 5f28 7365 6c66 2c20   __init__(self, 
+000444f0: 2a61 7267 732c 202a 2a6b 7761 7267 7329  *args, **kwargs)
+00044500: 3a0d 0a20 2020 2020 2020 2069 6620 6c65  :..        if le
+00044510: 6e28 6172 6773 2920 3e3d 2031 3a0d 0a20  n(args) >= 1:.. 
+00044520: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00044530: 7465 7874 203d 2061 7267 735b 305d 0d0a  text = args[0]..
+00044540: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+00044550: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00044560: 7465 7874 203d 2022 220d 0a20 2020 2020  text = ""..     
+00044570: 2020 2073 656c 662e 7769 6474 6820 3d20     self.width = 
+00044580: 300d 0a20 2020 2020 2020 2073 656c 662e  0..        self.
+00044590: 6865 6967 6874 203d 2030 0d0a 2020 2020  height = 0..    
+000445a0: 2020 2020 7365 6c66 2e78 203d 2030 0d0a      self.x = 0..
+000445b0: 2020 2020 2020 2020 7365 6c66 2e79 203d          self.y =
+000445c0: 2030 0d0a 2020 2020 2020 2020 7365 6c66   0..        self
+000445d0: 2e64 7820 3d20 300d 0a20 2020 2020 2020  .dx = 0..       
+000445e0: 2073 656c 662e 6479 203d 2030 0d0a 2020   self.dy = 0..  
+000445f0: 2020 2020 2020 7365 6c66 2e61 6e63 686f        self.ancho
+00044600: 7220 3d20 2273 7461 7274 2220 2023 2073  r = "start"  # s
+00044610: 7461 7274 2c20 6d69 6464 6c65 2c20 656e  tart, middle, en
+00044620: 642e 0d0a 2020 2020 2020 2020 7365 6c66  d...        self
+00044630: 2e66 6f6e 745f 7374 796c 6520 3d20 226e  .font_style = "n
+00044640: 6f72 6d61 6c22 0d0a 2020 2020 2020 2020  ormal"..        
+00044650: 7365 6c66 2e66 6f6e 745f 7661 7269 616e  self.font_varian
+00044660: 7420 3d20 226e 6f72 6d61 6c22 0d0a 2020  t = "normal"..  
+00044670: 2020 2020 2020 7365 6c66 2e66 6f6e 745f        self.font_
+00044680: 7765 6967 6874 203d 2034 3030 0d0a 2020  weight = 400..  
+00044690: 2020 2020 2020 7365 6c66 2e66 6f6e 745f        self.font_
+000446a0: 7374 7265 7463 6820 3d20 226e 6f72 6d61  stretch = "norma
+000446b0: 6c22 0d0a 2020 2020 2020 2020 7365 6c66  l"..        self
+000446c0: 2e66 6f6e 745f 7369 7a65 203d 2031 362e  .font_size = 16.
+000446d0: 3020 2023 2031 3670 7820 666f 6e74 2027  0  # 16px font '
+000446e0: 6e6f 726d 616c 2720 3132 7074 2066 6f6e  normal' 12pt fon
+000446f0: 740d 0a20 2020 2020 2020 2073 656c 662e  t..        self.
+00044700: 6c69 6e65 5f68 6569 6768 7420 3d20 3136  line_height = 16
+00044710: 2e30 0d0a 2020 2020 2020 2020 7365 6c66  .0..        self
+00044720: 2e66 6f6e 745f 6661 6d69 6c79 203d 2022  .font_family = "
+00044730: 7361 6e73 2d73 6572 6966 220d 0a20 2020  sans-serif"..   
+00044740: 2020 2020 2073 656c 662e 7061 7468 203d       self.path =
+00044750: 204e 6f6e 650d 0a0d 0a20 2020 2020 2020   None....       
+00044760: 2054 7261 6e73 666f 726d 6162 6c65 2e5f   Transformable._
+00044770: 5f69 6e69 745f 5f28 7365 6c66 2c20 2a61  _init__(self, *a
+00044780: 7267 732c 202a 2a6b 7761 7267 7329 0d0a  rgs, **kwargs)..
+00044790: 2020 2020 2020 2020 4772 6170 6869 634f          GraphicO
+000447a0: 626a 6563 742e 5f5f 696e 6974 5f5f 2873  bject.__init__(s
+000447b0: 656c 662c 202a 6172 6773 2c20 2a2a 6b77  elf, *args, **kw
+000447c0: 6172 6773 290d 0a20 2020 2020 2020 2053  args)..        S
+000447d0: 5647 456c 656d 656e 742e 5f5f 696e 6974  VGElement.__init
+000447e0: 5f5f 2873 656c 662c 202a 6172 6773 2c20  __(self, *args, 
+000447f0: 2a2a 6b77 6172 6773 290d 0a0d 0a20 2020  **kwargs)....   
+00044800: 2064 6566 205f 5f73 7472 5f5f 2873 656c   def __str__(sel
+00044810: 6629 3a0d 0a20 2020 2020 2020 2076 616c  f):..        val
+00044820: 7565 7320 3d20 6c69 7374 2829 0d0a 2020  ues = list()..  
+00044830: 2020 2020 2020 7661 6c75 6573 2e61 7070        values.app
+00044840: 656e 6428 2227 2573 2722 2025 2073 656c  end("'%s'" % sel
+00044850: 662e 7465 7874 290d 0a20 2020 2020 2020  f.text)..       
+00044860: 2076 616c 7565 732e 6170 7065 6e64 2822   values.append("
+00044870: 2573 3d27 2573 2722 2025 2028 5356 475f  %s='%s'" % (SVG_
+00044880: 4154 5452 5f46 4f4e 545f 4641 4d49 4c59  ATTR_FONT_FAMILY
+00044890: 2c20 7365 6c66 2e66 6f6e 745f 6661 6d69  , self.font_fami
+000448a0: 6c79 2929 0d0a 2020 2020 2020 2020 7661  ly))..        va
+000448b0: 6c75 6573 2e61 7070 656e 6428 2225 733d  lues.append("%s=
+000448c0: 2725 7327 2220 2520 2853 5647 5f41 5454  '%s'" % (SVG_ATT
+000448d0: 525f 464f 4e54 5f53 5459 4c45 2c20 7365  R_FONT_STYLE, se
+000448e0: 6c66 2e66 6f6e 745f 7374 796c 6529 290d  lf.font_style)).
+000448f0: 0a20 2020 2020 2020 2076 616c 7565 732e  .        values.
+00044900: 6170 7065 6e64 2822 2573 3d27 2573 2722  append("%s='%s'"
+00044910: 2025 2028 5356 475f 4154 5452 5f46 4f4e   % (SVG_ATTR_FON
+00044920: 545f 5641 5249 414e 542c 2073 656c 662e  T_VARIANT, self.
+00044930: 666f 6e74 5f76 6172 6961 6e74 2929 0d0a  font_variant))..
+00044940: 2020 2020 2020 2020 7661 6c75 6573 2e61          values.a
+00044950: 7070 656e 6428 2225 733d 2725 7327 2220  ppend("%s='%s'" 
+00044960: 2520 2853 5647 5f41 5454 525f 464f 4e54  % (SVG_ATTR_FONT
+00044970: 5f57 4549 4748 542c 2073 7472 2873 656c  _WEIGHT, str(sel
+00044980: 662e 666f 6e74 5f77 6569 6768 7429 2929  f.font_weight)))
+00044990: 0d0a 2020 2020 2020 2020 7661 6c75 6573  ..        values
+000449a0: 2e61 7070 656e 6428 2225 733d 2725 7327  .append("%s='%s'
+000449b0: 2220 2520 2853 5647 5f41 5454 525f 464f  " % (SVG_ATTR_FO
+000449c0: 4e54 5f53 5452 4554 4348 2c20 7365 6c66  NT_STRETCH, self
+000449d0: 2e66 6f6e 745f 7374 7265 7463 6829 290d  .font_stretch)).
+000449e0: 0a20 2020 2020 2020 2076 616c 7565 732e  .        values.
+000449f0: 6170 7065 6e64 2822 2573 3d25 6422 2025  append("%s=%d" %
+00044a00: 2028 5356 475f 4154 5452 5f46 4f4e 545f   (SVG_ATTR_FONT_
+00044a10: 5349 5a45 2c20 7365 6c66 2e66 6f6e 745f  SIZE, self.font_
+00044a20: 7369 7a65 2929 0d0a 2020 2020 2020 2020  size))..        
+00044a30: 7661 6c75 6573 2e61 7070 656e 6428 2225  values.append("%
+00044a40: 733d 2725 7327 2220 2520 2853 5647 5f41  s='%s'" % (SVG_A
+00044a50: 5454 525f 5445 5854 5f41 4e43 484f 522c  TTR_TEXT_ANCHOR,
+00044a60: 2073 656c 662e 616e 6368 6f72 2929 0d0a   self.anchor))..
+00044a70: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00044a80: 7820 213d 2030 206f 7220 7365 6c66 2e79  x != 0 or self.y
+00044a90: 2021 3d20 303a 0d0a 2020 2020 2020 2020   != 0:..        
+00044aa0: 2020 2020 7661 6c75 6573 2e61 7070 656e      values.appen
+00044ab0: 6428 2225 733d 2573 2220 2520 2853 5647  d("%s=%s" % (SVG
+00044ac0: 5f41 5454 525f 582c 2073 656c 662e 7829  _ATTR_X, self.x)
+00044ad0: 290d 0a20 2020 2020 2020 2020 2020 2076  )..            v
+00044ae0: 616c 7565 732e 6170 7065 6e64 2822 2573  alues.append("%s
+00044af0: 3d25 7322 2025 2028 5356 475f 4154 5452  =%s" % (SVG_ATTR
+00044b00: 5f59 2c20 7365 6c66 2e79 2929 0d0a 2020  _Y, self.y))..  
+00044b10: 2020 2020 2020 6966 2073 656c 662e 6478        if self.dx
+00044b20: 2021 3d20 3020 6f72 2073 656c 662e 6479   != 0 or self.dy
+00044b30: 2021 3d20 303a 0d0a 2020 2020 2020 2020   != 0:..        
+00044b40: 2020 2020 7661 6c75 6573 2e61 7070 656e      values.appen
+00044b50: 6428 2225 733d 2573 2220 2520 2853 5647  d("%s=%s" % (SVG
+00044b60: 5f41 5454 525f 4458 2c20 7365 6c66 2e64  _ATTR_DX, self.d
+00044b70: 7829 290d 0a20 2020 2020 2020 2020 2020  x))..           
+00044b80: 2076 616c 7565 732e 6170 7065 6e64 2822   values.append("
+00044b90: 2573 3d25 7322 2025 2028 5356 475f 4154  %s=%s" % (SVG_AT
+00044ba0: 5452 5f44 592c 2073 656c 662e 6479 2929  TR_DY, self.dy))
+00044bb0: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
+00044bc0: 662e 7374 726f 6b65 2069 7320 6e6f 7420  f.stroke is not 
+00044bd0: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
+00044be0: 2020 2076 616c 7565 732e 6170 7065 6e64     values.append
+00044bf0: 2822 2573 3d27 2573 2722 2025 2028 5356  ("%s='%s'" % (SV
+00044c00: 475f 4154 5452 5f53 5452 4f4b 452c 2073  G_ATTR_STROKE, s
+00044c10: 656c 662e 7374 726f 6b65 2929 0d0a 2020  elf.stroke))..  
+00044c20: 2020 2020 2020 6966 2073 656c 662e 6669        if self.fi
+00044c30: 6c6c 2069 7320 6e6f 7420 4e6f 6e65 3a0d  ll is not None:.
+00044c40: 0a20 2020 2020 2020 2020 2020 2076 616c  .            val
+00044c50: 7565 732e 6170 7065 6e64 2822 2573 3d27  ues.append("%s='
+00044c60: 2573 2722 2025 2028 5356 475f 4154 5452  %s'" % (SVG_ATTR
+00044c70: 5f46 494c 4c2c 2073 656c 662e 6669 6c6c  _FILL, self.fill
+00044c80: 2929 0d0a 2020 2020 2020 2020 6966 2073  ))..        if s
+00044c90: 656c 662e 7374 726f 6b65 5f77 6964 7468  elf.stroke_width
+00044ca0: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
+00044cb0: 2073 656c 662e 7374 726f 6b65 5f77 6964   self.stroke_wid
+00044cc0: 7468 2021 3d20 312e 303a 0d0a 2020 2020  th != 1.0:..    
+00044cd0: 2020 2020 2020 2020 7661 6c75 6573 2e61          values.a
+00044ce0: 7070 656e 6428 2225 733d 2573 2220 2520  ppend("%s=%s" % 
+00044cf0: 2853 5647 5f41 5454 525f 5354 524f 4b45  (SVG_ATTR_STROKE
+00044d00: 5f57 4944 5448 2c20 7374 7228 7365 6c66  _WIDTH, str(self
+00044d10: 2e73 7472 6f6b 655f 7769 6474 6829 2929  .stroke_width)))
+00044d20: 0d0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
+00044d30: 2073 656c 662e 7472 616e 7366 6f72 6d2e   self.transform.
+00044d40: 6973 5f69 6465 6e74 6974 7928 293a 0d0a  is_identity():..
+00044d50: 2020 2020 2020 2020 2020 2020 7661 6c75              valu
+00044d60: 6573 2e61 7070 656e 6428 2225 733d 2573  es.append("%s=%s
+00044d70: 2220 2520 2853 5647 5f41 5454 525f 5452  " % (SVG_ATTR_TR
+00044d80: 414e 5346 4f52 4d2c 2072 6570 7228 7365  ANSFORM, repr(se
+00044d90: 6c66 2e74 7261 6e73 666f 726d 2929 290d  lf.transform))).
+00044da0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+00044db0: 2e69 6420 6973 206e 6f74 204e 6f6e 653a  .id is not None:
+00044dc0: 0d0a 2020 2020 2020 2020 2020 2020 7661  ..            va
+00044dd0: 6c75 6573 2e61 7070 656e 6428 2225 733d  lues.append("%s=
+00044de0: 2725 7327 2220 2520 2853 5647 5f41 5454  '%s'" % (SVG_ATT
+00044df0: 525f 4944 2c20 7365 6c66 2e69 6429 290d  R_ID, self.id)).
+00044e00: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00044e10: 2254 6578 7428 2573 2922 2025 2028 222c  "Text(%s)" % (",
+00044e20: 2022 2e6a 6f69 6e28 7661 6c75 6573 2929   ".join(values))
+00044e30: 0d0a 0d0a 2020 2020 6465 6620 5f5f 7265  ....    def __re
+00044e40: 7072 5f5f 2873 656c 6629 3a0d 0a20 2020  pr__(self):..   
+00044e50: 2020 2020 2023 2043 616e 6e6f 7420 7573       # Cannot us
+00044e60: 6520 5356 475f 4154 5452 5f46 4f4e 545f  e SVG_ATTR_FONT_
+00044e70: 2a20 6f72 2053 5647 5f41 5454 525f 5445  * or SVG_ATTR_TE
+00044e80: 5854 5f41 4e43 484f 5220 666f 7220 7265  XT_ANCHOR for re
+00044e90: 7072 2062 6563 6175 7365 2074 6865 7920  pr because they 
+00044ea0: 636f 6e74 6169 6e20 6879 7068 656e 730d  contain hyphens.
+00044eb0: 0a20 2020 2020 2020 2076 616c 7565 7320  .        values 
+00044ec0: 3d20 6c69 7374 2829 0d0a 2020 2020 2020  = list()..      
+00044ed0: 2020 7661 6c75 6573 2e61 7070 656e 6428    values.append(
+00044ee0: 2227 2573 2722 2025 2073 656c 662e 7465  "'%s'" % self.te
+00044ef0: 7874 290d 0a20 2020 2020 2020 2076 616c  xt)..        val
+00044f00: 7565 732e 6170 7065 6e64 2822 666f 6e74  ues.append("font
+00044f10: 5f66 616d 696c 793d 2725 7327 2220 2520  _family='%s'" % 
+00044f20: 7365 6c66 2e66 6f6e 745f 6661 6d69 6c79  self.font_family
+00044f30: 290d 0a20 2020 2020 2020 2069 6620 7365  )..        if se
+00044f40: 6c66 2e66 6f6e 745f 7374 796c 6520 213d  lf.font_style !=
+00044f50: 2022 6e6f 726d 616c 223a 0d0a 2020 2020   "normal":..    
+00044f60: 2020 2020 2020 2020 7661 6c75 6573 2e61          values.a
+00044f70: 7070 656e 6428 2266 6f6e 745f 7374 796c  ppend("font_styl
+00044f80: 653d 2725 7327 2220 2520 7365 6c66 2e66  e='%s'" % self.f
+00044f90: 6f6e 745f 7374 796c 6529 0d0a 2020 2020  ont_style)..    
+00044fa0: 2020 2020 6966 2073 656c 662e 666f 6e74      if self.font
+00044fb0: 5f76 6172 6961 6e74 2021 3d20 226e 6f72  _variant != "nor
+00044fc0: 6d61 6c22 3a0d 0a20 2020 2020 2020 2020  mal":..         
+00044fd0: 2020 2076 616c 7565 732e 6170 7065 6e64     values.append
+00044fe0: 2822 666f 6e74 5f76 6172 6961 6e74 3d27  ("font_variant='
+00044ff0: 2573 2722 2025 2073 656c 662e 666f 6e74  %s'" % self.font
+00045000: 5f76 6172 6961 6e74 290d 0a20 2020 2020  _variant)..     
+00045010: 2020 2076 616c 7565 732e 6170 7065 6e64     values.append
+00045020: 2822 666f 6e74 5f77 6569 6768 743d 2725  ("font_weight='%
+00045030: 7327 2220 2520 7374 7228 7365 6c66 2e66  s'" % str(self.f
+00045040: 6f6e 745f 7765 6967 6874 2929 0d0a 2020  ont_weight))..  
+00045050: 2020 2020 2020 6966 2073 656c 662e 666f        if self.fo
+00045060: 6e74 5f73 7472 6574 6368 2021 3d20 226e  nt_stretch != "n
+00045070: 6f72 6d61 6c22 3a0d 0a20 2020 2020 2020  ormal":..       
+00045080: 2020 2020 2076 616c 7565 732e 6170 7065       values.appe
+00045090: 6e64 2822 666f 6e74 5f73 7472 6574 6368  nd("font_stretch
+000450a0: 3d27 2573 2722 2025 2073 656c 662e 666f  ='%s'" % self.fo
+000450b0: 6e74 5f73 7472 6574 6368 290d 0a20 2020  nt_stretch)..   
+000450c0: 2020 2020 2076 616c 7565 732e 6170 7065       values.appe
+000450d0: 6e64 2822 666f 6e74 5f73 697a 653d 2564  nd("font_size=%d
+000450e0: 2220 2520 7365 6c66 2e66 6f6e 745f 7369  " % self.font_si
+000450f0: 7a65 290d 0a20 2020 2020 2020 2076 616c  ze)..        val
+00045100: 7565 732e 6170 7065 6e64 2822 7465 7874  ues.append("text
+00045110: 5f61 6e63 686f 723d 2725 7327 2220 2520  _anchor='%s'" % 
+00045120: 7365 6c66 2e61 6e63 686f 7229 0d0a 2020  self.anchor)..  
+00045130: 2020 2020 2020 6966 2073 656c 662e 7820        if self.x 
+00045140: 213d 2030 206f 7220 7365 6c66 2e79 2021  != 0 or self.y !
+00045150: 3d20 303a 0d0a 2020 2020 2020 2020 2020  = 0:..          
+00045160: 2020 7661 6c75 6573 2e61 7070 656e 6428    values.append(
+00045170: 2225 733d 2573 2220 2520 2853 5647 5f41  "%s=%s" % (SVG_A
+00045180: 5454 525f 582c 2073 656c 662e 7829 290d  TTR_X, self.x)).
+00045190: 0a20 2020 2020 2020 2020 2020 2076 616c  .            val
+000451a0: 7565 732e 6170 7065 6e64 2822 2573 3d25  ues.append("%s=%
+000451b0: 7322 2025 2028 5356 475f 4154 5452 5f59  s" % (SVG_ATTR_Y
+000451c0: 2c20 7365 6c66 2e79 2929 0d0a 2020 2020  , self.y))..    
+000451d0: 2020 2020 6966 2073 656c 662e 6478 2021      if self.dx !
+000451e0: 3d20 3020 6f72 2073 656c 662e 6479 2021  = 0 or self.dy !
+000451f0: 3d20 303a 0d0a 2020 2020 2020 2020 2020  = 0:..          
+00045200: 2020 7661 6c75 6573 2e61 7070 656e 6428    values.append(
+00045210: 2225 733d 2573 2220 2520 2853 5647 5f41  "%s=%s" % (SVG_A
+00045220: 5454 525f 4458 2c20 7365 6c66 2e64 7829  TTR_DX, self.dx)
+00045230: 290d 0a20 2020 2020 2020 2020 2020 2076  )..            v
+00045240: 616c 7565 732e 6170 7065 6e64 2822 2573  alues.append("%s
+00045250: 3d25 7322 2025 2028 5356 475f 4154 5452  =%s" % (SVG_ATTR
+00045260: 5f44 592c 2073 656c 662e 6479 2929 0d0a  _DY, self.dy))..
+00045270: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00045280: 7374 726f 6b65 2069 7320 6e6f 7420 4e6f  stroke is not No
+00045290: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
+000452a0: 2076 616c 7565 732e 6170 7065 6e64 2822   values.append("
+000452b0: 2573 3d27 2573 2722 2025 2028 5356 475f  %s='%s'" % (SVG_
+000452c0: 4154 5452 5f53 5452 4f4b 452c 2073 656c  ATTR_STROKE, sel
+000452d0: 662e 7374 726f 6b65 2929 0d0a 2020 2020  f.stroke))..    
+000452e0: 2020 2020 6966 2073 656c 662e 6669 6c6c      if self.fill
+000452f0: 2069 7320 6e6f 7420 4e6f 6e65 3a0d 0a20   is not None:.. 
+00045300: 2020 2020 2020 2020 2020 2076 616c 7565             value
+00045310: 732e 6170 7065 6e64 2822 2573 3d27 2573  s.append("%s='%s
+00045320: 2722 2025 2028 5356 475f 4154 5452 5f46  '" % (SVG_ATTR_F
+00045330: 494c 4c2c 2073 656c 662e 6669 6c6c 2929  ILL, self.fill))
+00045340: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
+00045350: 662e 7374 726f 6b65 5f77 6964 7468 2069  f.stroke_width i
+00045360: 7320 6e6f 7420 4e6f 6e65 2061 6e64 2073  s not None and s
+00045370: 656c 662e 7374 726f 6b65 5f77 6964 7468  elf.stroke_width
+00045380: 2021 3d20 312e 303a 0d0a 2020 2020 2020   != 1.0:..      
+00045390: 2020 2020 2020 7661 6c75 6573 2e61 7070        values.app
+000453a0: 656e 6428 0d0a 2020 2020 2020 2020 2020  end(..          
+000453b0: 2020 2020 2020 2273 7472 6f6b 655f 7769        "stroke_wi
+000453c0: 6474 683d 2573 2220 2520 7374 7228 7365  dth=%s" % str(se
+000453d0: 6c66 2e73 7472 6f6b 655f 7769 6474 6829  lf.stroke_width)
+000453e0: 0d0a 2020 2020 2020 2020 2020 2020 2920  ..            ) 
+000453f0: 2023 2043 616e 6e6f 7420 7573 6520 5356   # Cannot use SV
+00045400: 475f 4154 5452 5f53 5452 4f4b 455f 5749  G_ATTR_STROKE_WI
+00045410: 4454 4820 666f 7220 7265 7072 2062 6563  DTH for repr bec
+00045420: 6175 7365 2069 7420 636f 6e74 6169 6e73  ause it contains
+00045430: 2061 2068 7970 6865 6e0d 0a20 2020 2020   a hyphen..     
+00045440: 2020 2069 6620 6e6f 7420 7365 6c66 2e74     if not self.t
+00045450: 7261 6e73 666f 726d 2e69 735f 6964 656e  ransform.is_iden
+00045460: 7469 7479 2829 3a0d 0a20 2020 2020 2020  tity():..       
+00045470: 2020 2020 2076 616c 7565 732e 6170 7065       values.appe
+00045480: 6e64 2822 2573 3d25 7322 2025 2028 5356  nd("%s=%s" % (SV
+00045490: 475f 4154 5452 5f54 5241 4e53 464f 524d  G_ATTR_TRANSFORM
+000454a0: 2c20 7265 7072 2873 656c 662e 7472 616e  , repr(self.tran
+000454b0: 7366 6f72 6d29 2929 0d0a 2020 2020 2020  sform)))..      
+000454c0: 2020 6966 2073 656c 662e 6964 2069 7320    if self.id is 
+000454d0: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
+000454e0: 2020 2020 2020 2076 616c 7565 732e 6170         values.ap
+000454f0: 7065 6e64 2822 2573 3d27 2573 2722 2025  pend("%s='%s'" %
+00045500: 2028 5356 475f 4154 5452 5f49 442c 2073   (SVG_ATTR_ID, s
+00045510: 656c 662e 6964 2929 0d0a 2020 2020 2020  elf.id))..      
+00045520: 2020 7265 7475 726e 2022 5465 7874 2825    return "Text(%
+00045530: 7329 2220 2520 2822 2c20 222e 6a6f 696e  s)" % (", ".join
+00045540: 2876 616c 7565 7329 290d 0a0d 0a20 2020  (values))....   
+00045550: 2064 6566 205f 5f65 715f 5f28 7365 6c66   def __eq__(self
+00045560: 2c20 6f74 6865 7229 3a0d 0a20 2020 2020  , other):..     
+00045570: 2020 2069 6620 6e6f 7420 6973 696e 7374     if not isinst
+00045580: 616e 6365 286f 7468 6572 2c20 5465 7874  ance(other, Text
+00045590: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+000455a0: 7265 7475 726e 204e 6f74 496d 706c 656d  return NotImplem
+000455b0: 656e 7465 640d 0a20 2020 2020 2020 2069  ented..        i
+000455c0: 6620 7365 6c66 2e74 6578 7420 213d 206f  f self.text != o
+000455d0: 7468 6572 2e74 6578 743a 0d0a 2020 2020  ther.text:..    
+000455e0: 2020 2020 2020 2020 7265 7475 726e 2046          return F
+000455f0: 616c 7365 0d0a 2020 2020 2020 2020 6966  alse..        if
+00045600: 2073 656c 662e 7769 6474 6820 213d 206f   self.width != o
+00045610: 7468 6572 2e77 6964 7468 3a0d 0a20 2020  ther.width:..   
+00045620: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00045630: 4661 6c73 650d 0a20 2020 2020 2020 2069  False..        i
+00045640: 6620 7365 6c66 2e68 6569 6768 7420 213d  f self.height !=
+00045650: 206f 7468 6572 2e68 6569 6768 743a 0d0a   other.height:..
+00045660: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00045670: 726e 2046 616c 7365 0d0a 2020 2020 2020  rn False..      
+00045680: 2020 6966 2073 656c 662e 7820 213d 206f    if self.x != o
+00045690: 7468 6572 2e78 3a0d 0a20 2020 2020 2020  ther.x:..       
+000456a0: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+000456b0: 650d 0a20 2020 2020 2020 2069 6620 7365  e..        if se
+000456c0: 6c66 2e79 2021 3d20 6f74 6865 722e 793a  lf.y != other.y:
+000456d0: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+000456e0: 7475 726e 2046 616c 7365 0d0a 2020 2020  turn False..    
+000456f0: 2020 2020 6966 2073 656c 662e 6478 2021      if self.dx !
+00045700: 3d20 6f74 6865 722e 6478 3a0d 0a20 2020  = other.dx:..   
+00045710: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00045720: 4661 6c73 650d 0a20 2020 2020 2020 2069  False..        i
+00045730: 6620 7365 6c66 2e64 7920 213d 206f 7468  f self.dy != oth
+00045740: 6572 2e64 793a 0d0a 2020 2020 2020 2020  er.dy:..        
+00045750: 2020 2020 7265 7475 726e 2046 616c 7365      return False
+00045760: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
+00045770: 662e 616e 6368 6f72 2021 3d20 6f74 6865  f.anchor != othe
+00045780: 722e 616e 6368 6f72 3a0d 0a20 2020 2020  r.anchor:..     
+00045790: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
+000457a0: 6c73 650d 0a20 2020 2020 2020 2069 6620  lse..        if 
+000457b0: 7365 6c66 2e66 6f6e 745f 7374 796c 6520  self.font_style 
+000457c0: 213d 206f 7468 6572 2e66 6f6e 745f 7374  != other.font_st
+000457d0: 796c 653a 0d0a 2020 2020 2020 2020 2020  yle:..          
+000457e0: 2020 7265 7475 726e 2046 616c 7365 0d0a    return False..
+000457f0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00045800: 666f 6e74 5f76 6172 6961 6e74 2021 3d20  font_variant != 
+00045810: 6f74 6865 722e 666f 6e74 5f76 6172 6961  other.font_varia
+00045820: 6e74 3a0d 0a20 2020 2020 2020 2020 2020  nt:..           
+00045830: 2072 6574 7572 6e20 4661 6c73 650d 0a20   return False.. 
+00045840: 2020 2020 2020 2069 6620 7365 6c66 2e66         if self.f
+00045850: 6f6e 745f 7765 6967 6874 2021 3d20 6f74  ont_weight != ot
+00045860: 6865 722e 666f 6e74 5f77 6569 6768 743a  her.font_weight:
+00045870: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+00045880: 7475 726e 2046 616c 7365 0d0a 2020 2020  turn False..    
+00045890: 2020 2020 6966 2073 656c 662e 666f 6e74      if self.font
+000458a0: 5f73 7472 6574 6368 2021 3d20 6f74 6865  _stretch != othe
+000458b0: 722e 666f 6e74 5f73 7472 6574 6368 3a0d  r.font_stretch:.
+000458c0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+000458d0: 7572 6e20 4661 6c73 650d 0a20 2020 2020  urn False..     
+000458e0: 2020 2069 6620 7365 6c66 2e66 6f6e 745f     if self.font_
+000458f0: 7369 7a65 2021 3d20 6f74 6865 722e 666f  size != other.fo
+00045900: 6e74 5f73 697a 653a 0d0a 2020 2020 2020  nt_size:..      
+00045910: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
+00045920: 7365 0d0a 2020 2020 2020 2020 6966 2073  se..        if s
+00045930: 656c 662e 6c69 6e65 5f68 6569 6768 7420  elf.line_height 
+00045940: 213d 206f 7468 6572 2e6c 696e 655f 6865  != other.line_he
+00045950: 6967 6874 3a0d 0a20 2020 2020 2020 2020  ight:..         
+00045960: 2020 2072 6574 7572 6e20 4661 6c73 650d     return False.
+00045970: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+00045980: 2e66 6f6e 745f 6661 6d69 6c79 2021 3d20  .font_family != 
+00045990: 6f74 6865 722e 666f 6e74 5f66 616d 696c  other.font_famil
+000459a0: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
+000459b0: 7265 7475 726e 2046 616c 7365 0d0a 2020  return False..  
+000459c0: 2020 2020 2020 6966 2073 656c 662e 666f        if self.fo
+000459d0: 6e74 5f73 697a 6520 213d 206f 7468 6572  nt_size != other
+000459e0: 2e66 6f6e 745f 7369 7a65 3a0d 0a20 2020  .font_size:..   
+000459f0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00045a00: 4661 6c73 650d 0a20 2020 2020 2020 2072  False..        r
+00045a10: 6574 7572 6e20 5472 7565 0d0a 0d0a 2020  eturn True....  
+00045a20: 2020 6465 6620 5f5f 6e65 5f5f 2873 656c    def __ne__(sel
+00045a30: 662c 206f 7468 6572 293a 0d0a 2020 2020  f, other):..    
+00045a40: 2020 2020 6966 206e 6f74 2069 7369 6e73      if not isins
+00045a50: 7461 6e63 6528 6f74 6865 722c 2054 6578  tance(other, Tex
+00045a60: 7429 3a0d 0a20 2020 2020 2020 2020 2020  t):..           
+00045a70: 2072 6574 7572 6e20 4e6f 7449 6d70 6c65   return NotImple
+00045a80: 6d65 6e74 6564 0d0a 2020 2020 2020 2020  mented..        
+00045a90: 7265 7475 726e 206e 6f74 2073 656c 6620  return not self 
+00045aa0: 3d3d 206f 7468 6572 0d0a 0d0a 2020 2020  == other....    
+00045ab0: 6465 6620 7072 6f70 6572 7479 5f62 795f  def property_by_
+00045ac0: 6f62 6a65 6374 2873 656c 662c 2073 293a  object(self, s):
+00045ad0: 0d0a 2020 2020 2020 2020 5472 616e 7366  ..        Transf
+00045ae0: 6f72 6d61 626c 652e 7072 6f70 6572 7479  ormable.property
+00045af0: 5f62 795f 6f62 6a65 6374 2873 656c 662c  _by_object(self,
+00045b00: 2073 290d 0a20 2020 2020 2020 2047 7261   s)..        Gra
+00045b10: 7068 6963 4f62 6a65 6374 2e70 726f 7065  phicObject.prope
+00045b20: 7274 795f 6279 5f6f 626a 6563 7428 7365  rty_by_object(se
+00045b30: 6c66 2c20 7329 0d0a 2020 2020 2020 2020  lf, s)..        
+00045b40: 5356 4745 6c65 6d65 6e74 2e70 726f 7065  SVGElement.prope
+00045b50: 7274 795f 6279 5f6f 626a 6563 7428 7365  rty_by_object(se
+00045b60: 6c66 2c20 7329 0d0a 2020 2020 2020 2020  lf, s)..        
+00045b70: 7365 6c66 2e74 6578 7420 3d20 732e 7465  self.text = s.te
+00045b80: 7874 0d0a 2020 2020 2020 2020 7365 6c66  xt..        self
+00045b90: 2e78 203d 2073 2e78 0d0a 2020 2020 2020  .x = s.x..      
+00045ba0: 2020 7365 6c66 2e79 203d 2073 2e79 0d0a    self.y = s.y..
+00045bb0: 2020 2020 2020 2020 7365 6c66 2e77 6964          self.wid
+00045bc0: 7468 203d 2073 2e77 6964 7468 0d0a 2020  th = s.width..  
+00045bd0: 2020 2020 2020 7365 6c66 2e68 6569 6768        self.heigh
+00045be0: 7420 3d20 732e 6865 6967 6874 0d0a 2020  t = s.height..  
+00045bf0: 2020 2020 2020 7365 6c66 2e64 7820 3d20        self.dx = 
+00045c00: 732e 6478 0d0a 2020 2020 2020 2020 7365  s.dx..        se
+00045c10: 6c66 2e64 7920 3d20 732e 6479 0d0a 2020  lf.dy = s.dy..  
+00045c20: 2020 2020 2020 7365 6c66 2e61 6e63 686f        self.ancho
+00045c30: 7220 3d20 732e 616e 6368 6f72 0d0a 2020  r = s.anchor..  
+00045c40: 2020 2020 2020 7365 6c66 2e66 6f6e 745f        self.font_
+00045c50: 6661 6d69 6c79 203d 2073 2e66 6f6e 745f  family = s.font_
+00045c60: 6661 6d69 6c79 0d0a 2020 2020 2020 2020  family..        
+00045c70: 7365 6c66 2e66 6f6e 745f 7374 796c 6520  self.font_style 
+00045c80: 3d20 732e 666f 6e74 5f73 7479 6c65 0d0a  = s.font_style..
+00045c90: 2020 2020 2020 2020 7365 6c66 2e66 6f6e          self.fon
+00045ca0: 745f 7661 7269 616e 7420 3d20 732e 666f  t_variant = s.fo
+00045cb0: 6e74 5f76 6172 6961 6e74 0d0a 2020 2020  nt_variant..    
+00045cc0: 2020 2020 7365 6c66 2e66 6f6e 745f 7765      self.font_we
+00045cd0: 6967 6874 203d 2073 2e66 6f6e 745f 7765  ight = s.font_we
+00045ce0: 6967 6874 0d0a 2020 2020 2020 2020 7365  ight..        se
+00045cf0: 6c66 2e66 6f6e 745f 7374 7265 7463 6820  lf.font_stretch 
+00045d00: 3d20 732e 666f 6e74 5f73 7472 6574 6368  = s.font_stretch
+00045d10: 0d0a 2020 2020 2020 2020 7365 6c66 2e66  ..        self.f
+00045d20: 6f6e 745f 7369 7a65 203d 2073 2e66 6f6e  ont_size = s.fon
+00045d30: 745f 7369 7a65 0d0a 2020 2020 2020 2020  t_size..        
+00045d40: 7365 6c66 2e6c 696e 655f 6865 6967 6874  self.line_height
+00045d50: 203d 2073 2e6c 696e 655f 6865 6967 6874   = s.line_height
+00045d60: 0d0a 0d0a 2020 2020 6465 6620 7061 7273  ....    def pars
+00045d70: 655f 666f 6e74 2873 656c 662c 2066 6f6e  e_font(self, fon
+00045d80: 7429 3a0d 0a20 2020 2020 2020 2022 2222  t):..        """
+00045d90: 0d0a 2020 2020 2020 2020 4353 5320 466f  ..        CSS Fo
+00045da0: 6e74 7320 3320 6861 7320 6120 7368 6f72  nts 3 has a shor
+00045db0: 7468 616e 6420 666f 6e74 2070 726f 7065  thand font prope
+00045dc0: 7274 7920 7768 6963 6820 7365 7276 6573  rty which serves
+00045dd0: 2074 6f20 7072 6f76 6964 6520 6120 7369   to provide a si
+00045de0: 6e67 6c65 206c 6f63 6174 696f 6e20 746f  ngle location to
+00045df0: 2064 6566 696e 653a 0d0a 2020 2020 2020   define:..      
+00045e00: 2020 6066 6f6e 742d 7374 796c 6560 2c20    `font-style`, 
+00045e10: 6066 6f6e 742d 7661 7269 616e 7460 2c20  `font-variant`, 
+00045e20: 6066 6f6e 742d 7765 6967 6874 602c 2060  `font-weight`, `
+00045e30: 666f 6e74 2d73 7472 6574 6368 602c 2060  font-stretch`, `
+00045e40: 666f 6e74 2d73 697a 6560 2c20 606c 696e  font-size`, `lin
+00045e50: 652d 6865 6967 6874 602c 2061 6e64 2060  e-height`, and `
+00045e60: 666f 6e74 2d66 616d 696c 7960 0d0a 0d0a  font-family`....
+00045e70: 2020 2020 2020 2020 666f 6e74 2d73 7479          font-sty
+00045e80: 6c65 3a20 6e6f 726d 616c 207c 2069 7461  le: normal | ita
+00045e90: 6c69 6320 7c20 6f62 6c69 7175 650d 0a20  lic | oblique.. 
+00045ea0: 2020 2020 2020 2066 6f6e 742d 7661 7269         font-vari
+00045eb0: 616e 743a 206e 6f72 6d61 6c20 7c20 736d  ant: normal | sm
+00045ec0: 616c 6c2d 6361 7073 0d0a 2020 2020 2020  all-caps..      
+00045ed0: 2020 666f 6e74 2d77 6569 6768 743a 206e    font-weight: n
+00045ee0: 6f72 6d61 6c20 7c20 626f 6c64 207c 2062  ormal | bold | b
+00045ef0: 6f6c 6465 7220 7c20 6c69 6768 7465 7220  older | lighter 
+00045f00: 7c20 3130 3020 7c20 3230 3020 7c20 3330  | 100 | 200 | 30
+00045f10: 3020 7c20 3430 3020 7c20 3530 3020 7c20  0 | 400 | 500 | 
+00045f20: 3630 3020 7c20 3730 3020 7c20 3830 3020  600 | 700 | 800 
+00045f30: 7c20 3930 300d 0a20 2020 2020 2020 2066  | 900..        f
+00045f40: 6f6e 742d 7374 7265 7463 683a 206e 6f72  ont-stretch: nor
+00045f50: 6d61 6c20 7c20 756c 7472 612d 636f 6e64  mal | ultra-cond
+00045f60: 656e 7365 6420 7c20 6578 7472 612d 636f  ensed | extra-co
+00045f70: 6e64 656e 7365 6420 7c20 636f 6e64 656e  ndensed | conden
+00045f80: 7365 6420 7c20 7365 6d69 2d63 6f6e 6465  sed | semi-conde
+00045f90: 6e73 6564 207c 2073 656d 692d 6578 7061  nsed | semi-expa
+00045fa0: 6e64 6564 207c 2065 7870 616e 6465 6420  nded | expanded 
+00045fb0: 7c20 6578 7472 612d 6578 7061 6e64 6564  | extra-expanded
+00045fc0: 207c 2075 6c74 7261 2d65 7870 616e 6465   | ultra-expande
+00045fd0: 640d 0a20 2020 2020 2020 2066 6f6e 742d  d..        font-
+00045fe0: 7369 7a65 3a20 3c61 6273 6f6c 7574 652d  size: <absolute-
+00045ff0: 7369 7a65 3e20 7c20 3c72 656c 6174 6976  size> | <relativ
+00046000: 652d 7369 7a65 3e20 7c20 3c6c 656e 6774  e-size> | <lengt
+00046010: 682d 7065 7263 656e 7461 6765 3e0d 0a20  h-percentage>.. 
+00046020: 2020 2020 2020 206c 696e 652d 6865 6967         line-heig
+00046030: 6874 3a20 272f 2720 3c60 6c69 6e65 2d68  ht: '/' <`line-h
+00046040: 6569 6768 7460 3e0d 0a20 2020 2020 2020  eight`>..       
+00046050: 2066 6f6e 742d 6661 6d69 6c79 3a20 5b20   font-family: [ 
+00046060: 3c66 616d 696c 792d 6e61 6d65 3e20 7c20  <family-name> | 
+00046070: 3c67 656e 6572 6963 2d66 616d 696c 793e  <generic-family>
+00046080: 205d 2023 0d0a 2020 2020 2020 2020 6765   ] #..        ge
+00046090: 6e65 7269 632d 6661 6d69 6c79 3a20 2060  neric-family:  `
+000460a0: 7365 7269 6660 2c20 6073 616e 732d 7365  serif`, `sans-se
+000460b0: 7269 6660 2c20 6063 7572 7369 7665 602c  rif`, `cursive`,
+000460c0: 2060 6661 6e74 6173 7960 2c20 616e 6420   `fantasy`, and 
+000460d0: 606d 6f6e 6f73 7061 6365 600d 0a20 2020  `monospace`..   
+000460e0: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
+000460f0: 2020 2320 6874 7470 733a 2f2f 7777 772e    # https://www.
+00046100: 7733 2e6f 7267 2f54 522f 6373 732d 666f  w3.org/TR/css-fo
+00046110: 6e74 732d 332f 2366 6f6e 742d 7072 6f70  nts-3/#font-prop
+00046120: 0d0a 2020 2020 2020 2020 6d61 7463 6820  ..        match 
+00046130: 3d20 5245 4745 585f 4353 535f 464f 4e54  = REGEX_CSS_FONT
+00046140: 2e6d 6174 6368 2866 6f6e 7429 0d0a 2020  .match(font)..  
+00046150: 2020 2020 2020 6966 206e 6f74 206d 6174        if not mat
+00046160: 6368 3a0d 0a20 2020 2020 2020 2020 2020  ch:..           
+00046170: 2023 2054 6869 7320 6973 206e 6f74 2061   # This is not a
+00046180: 2071 7561 6c69 6669 6564 2073 686f 7274   qualified short
+00046190: 6861 6e64 2066 6f6e 742e 0d0a 2020 2020  hand font...    
+000461a0: 2020 2020 2020 2020 7265 7475 726e 0d0a          return..
+000461b0: 2020 2020 2020 2020 7365 6c66 2e66 6f6e          self.fon
+000461c0: 745f 7374 796c 6520 3d20 6d61 7463 682e  t_style = match.
+000461d0: 6772 6f75 7028 3129 0d0a 2020 2020 2020  group(1)..      
+000461e0: 2020 6966 2073 656c 662e 666f 6e74 5f73    if self.font_s
+000461f0: 7479 6c65 2069 7320 4e6f 6e65 3a0d 0a20  tyle is None:.. 
+00046200: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00046210: 666f 6e74 5f73 7479 6c65 203d 2022 6e6f  font_style = "no
+00046220: 726d 616c 220d 0a0d 0a20 2020 2020 2020  rmal"....       
+00046230: 2073 656c 662e 666f 6e74 5f76 6172 6961   self.font_varia
+00046240: 6e74 203d 206d 6174 6368 2e67 726f 7570  nt = match.group
+00046250: 2832 290d 0a20 2020 2020 2020 2069 6620  (2)..        if 
+00046260: 7365 6c66 2e66 6f6e 745f 7661 7269 616e  self.font_varian
+00046270: 7420 6973 204e 6f6e 653a 0d0a 2020 2020  t is None:..    
+00046280: 2020 2020 2020 2020 7365 6c66 2e66 6f6e          self.fon
+00046290: 745f 7661 7269 616e 7420 3d20 226e 6f72  t_variant = "nor
+000462a0: 6d61 6c22 0d0a 0d0a 2020 2020 2020 2020  mal"....        
+000462b0: 7365 6c66 2e66 6f6e 745f 7765 6967 6874  self.font_weight
+000462c0: 203d 206d 6174 6368 2e67 726f 7570 2833   = match.group(3
+000462d0: 290d 0a20 2020 2020 2020 2069 6620 7365  )..        if se
+000462e0: 6c66 2e66 6f6e 745f 7765 6967 6874 2069  lf.font_weight i
+000462f0: 7320 4e6f 6e65 3a0d 0a20 2020 2020 2020  s None:..       
+00046300: 2020 2020 2073 656c 662e 666f 6e74 5f77       self.font_w
+00046310: 6569 6768 7420 3d20 226e 6f72 6d61 6c22  eight = "normal"
+00046320: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
+00046330: 2e66 6f6e 745f 7374 7265 7463 6820 3d20  .font_stretch = 
+00046340: 6d61 7463 682e 6772 6f75 7028 3429 0d0a  match.group(4)..
+00046350: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00046360: 666f 6e74 5f73 7472 6574 6368 2069 7320  font_stretch is 
+00046370: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
+00046380: 2020 2073 656c 662e 666f 6e74 5f73 7472     self.font_str
+00046390: 6574 6368 203d 2022 6e6f 726d 616c 220d  etch = "normal".
+000463a0: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
+000463b0: 666f 6e74 5f73 697a 6520 3d20 6d61 7463  font_size = matc
+000463c0: 682e 6772 6f75 7028 3529 0d0a 2020 2020  h.group(5)..    
+000463d0: 2020 2020 6966 2073 656c 662e 666f 6e74      if self.font
+000463e0: 5f73 697a 6520 6973 204e 6f6e 653a 0d0a  _size is None:..
+000463f0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00046400: 2e66 6f6e 745f 7369 7a65 203d 2022 3132  .font_size = "12
+00046410: 7074 220d 0a20 2020 2020 2020 2069 6620  pt"..        if 
+00046420: 7365 6c66 2e66 6f6e 745f 7369 7a65 3a0d  self.font_size:.
+00046430: 0a20 2020 2020 2020 2020 2020 2073 697a  .            siz
+00046440: 6520 3d20 7365 6c66 2e66 6f6e 745f 7369  e = self.font_si
+00046450: 7a65 0d0a 2020 2020 2020 2020 2020 2020  ze..            
+00046460: 7365 6c66 2e66 6f6e 745f 7369 7a65 203d  self.font_size =
+00046470: 204c 656e 6774 6828 7365 6c66 2e66 6f6e   Length(self.fon
+00046480: 745f 7369 7a65 290d 0a20 2020 2020 2020  t_size)..       
+00046490: 2020 2020 2074 7279 3a0d 0a20 2020 2020       try:..     
+000464a0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000464b0: 666f 6e74 5f73 697a 6520 3d20 4c65 6e67  font_size = Leng
+000464c0: 7468 2873 656c 662e 666f 6e74 5f73 697a  th(self.font_siz
+000464d0: 6529 2e76 616c 7565 2829 0d0a 2020 2020  e).value()..    
+000464e0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+000464f0: 656c 662e 666f 6e74 5f73 697a 6520 3d3d  elf.font_size ==
+00046500: 2030 3a0d 0a20 2020 2020 2020 2020 2020   0:..           
+00046510: 2020 2020 2020 2020 2073 656c 662e 666f           self.fo
+00046520: 6e74 5f73 697a 6520 3d20 7369 7a65 0d0a  nt_size = size..
+00046530: 2020 2020 2020 2020 2020 2020 6578 6365              exce
+00046540: 7074 2056 616c 7565 4572 726f 723a 0d0a  pt ValueError:..
+00046550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046560: 7365 6c66 2e66 6f6e 745f 7369 7a65 203d  self.font_size =
+00046570: 2073 697a 650d 0a0d 0a20 2020 2020 2020   size....       
+00046580: 2073 656c 662e 6c69 6e65 5f68 6569 6768   self.line_heigh
+00046590: 7420 3d20 6d61 7463 682e 6772 6f75 7028  t = match.group(
+000465a0: 3629 0d0a 2020 2020 2020 2020 6966 2073  6)..        if s
+000465b0: 656c 662e 6c69 6e65 5f68 6569 6768 7420  elf.line_height 
+000465c0: 6973 204e 6f6e 653a 0d0a 2020 2020 2020  is None:..      
+000465d0: 2020 2020 2020 7365 6c66 2e6c 696e 655f        self.line_
+000465e0: 6865 6967 6874 203d 2022 3132 7074 220d  height = "12pt".
+000465f0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+00046600: 2e6c 696e 655f 6865 6967 6874 3a0d 0a20  .line_height:.. 
+00046610: 2020 2020 2020 2020 2020 2068 6569 6768             heigh
+00046620: 7420 3d20 7365 6c66 2e6c 696e 655f 6865  t = self.line_he
+00046630: 6967 6874 0d0a 2020 2020 2020 2020 2020  ight..          
+00046640: 2020 7365 6c66 2e6c 696e 655f 6865 6967    self.line_heig
+00046650: 6874 203d 204c 656e 6774 6828 7365 6c66  ht = Length(self
+00046660: 2e6c 696e 655f 6865 6967 6874 290d 0a20  .line_height).. 
+00046670: 2020 2020 2020 2020 2020 2074 7279 3a0d             try:.
+00046680: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00046690: 2073 656c 662e 6c69 6e65 5f68 6569 6768   self.line_heigh
+000466a0: 7420 3d20 4c65 6e67 7468 280d 0a20 2020  t = Length(..   
+000466b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000466c0: 2073 656c 662e 6c69 6e65 5f68 6569 6768   self.line_heigh
+000466d0: 742c 2072 656c 6174 6976 655f 6c65 6e67  t, relative_leng
+000466e0: 7468 3d73 656c 662e 666f 6e74 5f73 697a  th=self.font_siz
+000466f0: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
+00046700: 2020 2029 2e76 616c 7565 2829 0d0a 2020     ).value()..  
+00046710: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00046720: 2073 656c 662e 6c69 6e65 5f68 6569 6768   self.line_heigh
+00046730: 7420 3d3d 2030 3a0d 0a20 2020 2020 2020  t == 0:..       
+00046740: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00046750: 662e 6c69 6e65 5f68 6569 6768 7420 3d20  f.line_height = 
+00046760: 6865 6967 6874 0d0a 2020 2020 2020 2020  height..        
+00046770: 2020 2020 6578 6365 7074 2056 616c 7565      except Value
+00046780: 4572 726f 723a 0d0a 2020 2020 2020 2020  Error:..        
+00046790: 2020 2020 2020 2020 7365 6c66 2e6c 696e          self.lin
+000467a0: 655f 6865 6967 6874 203d 2068 6569 6768  e_height = heigh
+000467b0: 740d 0a0d 0a20 2020 2020 2020 2073 656c  t....        sel
+000467c0: 662e 666f 6e74 5f66 616d 696c 7920 3d20  f.font_family = 
+000467d0: 6d61 7463 682e 6772 6f75 7028 3729 0d0a  match.group(7)..
+000467e0: 0d0a 2020 2020 4070 726f 7065 7274 790d  ..    @property.
+000467f0: 0a20 2020 2064 6566 2066 6f6e 745f 6c69  .    def font_li
+00046800: 7374 2873 656c 6629 3a0d 0a20 2020 2020  st(self):..     
+00046810: 2020 2072 6574 7572 6e20 5b0d 0a20 2020     return [..   
+00046820: 2020 2020 2020 2020 2066 616d 696c 795b           family[
+00046830: 313a 2d31 5d20 6966 2066 616d 696c 792e  1:-1] if family.
+00046840: 7374 6172 7473 7769 7468 2827 2227 2920  startswith('"') 
+00046850: 6f72 2066 616d 696c 792e 7374 6172 7473  or family.starts
+00046860: 7769 7468 2822 2722 2920 656c 7365 2066  with("'") else f
+00046870: 616d 696c 790d 0a20 2020 2020 2020 2020  amily..         
+00046880: 2020 2066 6f72 2066 616d 696c 7920 696e     for family in
+00046890: 2052 4547 4558 5f43 5353 5f46 4f4e 545f   REGEX_CSS_FONT_
+000468a0: 4641 4d49 4c59 2e66 696e 6461 6c6c 2873  FAMILY.findall(s
+000468b0: 656c 662e 666f 6e74 5f66 616d 696c 7929  elf.font_family)
+000468c0: 0d0a 2020 2020 2020 2020 5d0d 0a0d 0a20  ..        ].... 
+000468d0: 2020 2040 7072 6f70 6572 7479 0d0a 2020     @property..  
+000468e0: 2020 6465 6620 7765 6967 6874 2873 656c    def weight(sel
+000468f0: 6629 3a0d 0a20 2020 2020 2020 2022 2222  f):..        """
+00046900: 0d0a 2020 2020 2020 2020 5468 6973 2064  ..        This d
+00046910: 6f65 7320 6e6f 7420 636f 7272 6563 746c  oes not correctl
+00046920: 7920 7061 7273 6520 7765 6967 6874 7320  y parse weights 
+00046930: 666f 7220 626f 6c64 6572 206f 7220 6c69  for bolder or li
+00046940: 6768 7465 722e 2054 686f 7365 2061 7265  ghter. Those are
+00046950: 2072 656c 6174 6976 6520 746f 2074 6865   relative to the
+00046960: 2070 7265 7669 6f75 7320 7365 740d 0a20   previous set.. 
+00046970: 2020 2020 2020 2066 6f6e 742d 7765 6967         font-weig
+00046980: 6874 2061 6e64 2074 6861 7420 6973 2067  ht and that is g
+00046990: 656e 6572 616c 6c79 2075 6e6b 6e6f 776e  enerally unknown
+000469a0: 2069 6e20 7468 6973 2063 6f6e 7465 7874   in this context
+000469b0: 2e0d 0a20 2020 2020 2020 2022 2222 0d0a  ...        """..
+000469c0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+000469d0: 666f 6e74 5f77 6569 6768 7420 3d3d 2022  font_weight == "
+000469e0: 626f 6c64 223a 0d0a 2020 2020 2020 2020  bold":..        
+000469f0: 2020 2020 7265 7475 726e 2037 3030 0d0a      return 700..
+00046a00: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00046a10: 666f 6e74 5f77 6569 6768 7420 3d3d 2022  font_weight == "
+00046a20: 6e6f 726d 616c 223a 0d0a 2020 2020 2020  normal":..      
+00046a30: 2020 2020 2020 7265 7475 726e 2034 3030        return 400
+00046a40: 0d0a 2020 2020 2020 2020 7472 793a 0d0a  ..        try:..
+00046a50: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00046a60: 726e 2069 6e74 2873 656c 662e 666f 6e74  rn int(self.font
+00046a70: 5f77 6569 6768 7429 0d0a 2020 2020 2020  _weight)..      
+00046a80: 2020 6578 6365 7074 2056 616c 7565 4572    except ValueEr
+00046a90: 726f 723a 0d0a 2020 2020 2020 2020 2020  ror:..          
+00046aa0: 2020 7265 7475 726e 2034 3030 0d0a 0d0a    return 400....
+00046ab0: 2020 2020 4070 726f 7065 7274 790d 0a20      @property.. 
+00046ac0: 2020 2064 6566 2066 6f6e 745f 6661 6365     def font_face
+00046ad0: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
+00046ae0: 2022 2222 0d0a 2020 2020 2020 2020 4465   """..        De
+00046af0: 7072 6563 6174 6564 2046 6f6e 7466 6163  precated Fontfac
+00046b00: 652e 0d0a 2020 2020 2020 2020 2222 220d  e...        """.
+00046b10: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00046b20: 2222 0d0a 0d0a 2020 2020 6465 6620 7072  ""....    def pr
+00046b30: 6f70 6572 7479 5f62 795f 7661 6c75 6573  operty_by_values
+00046b40: 2873 656c 662c 2076 616c 7565 7329 3a0d  (self, values):.
+00046b50: 0a20 2020 2020 2020 2054 7261 6e73 666f  .        Transfo
+00046b60: 726d 6162 6c65 2e70 726f 7065 7274 795f  rmable.property_
+00046b70: 6279 5f76 616c 7565 7328 7365 6c66 2c20  by_values(self, 
+00046b80: 7661 6c75 6573 290d 0a20 2020 2020 2020  values)..       
+00046b90: 2047 7261 7068 6963 4f62 6a65 6374 2e70   GraphicObject.p
+00046ba0: 726f 7065 7274 795f 6279 5f76 616c 7565  roperty_by_value
+00046bb0: 7328 7365 6c66 2c20 7661 6c75 6573 290d  s(self, values).
+00046bc0: 0a20 2020 2020 2020 2053 5647 456c 656d  .        SVGElem
+00046bd0: 656e 742e 7072 6f70 6572 7479 5f62 795f  ent.property_by_
+00046be0: 7661 6c75 6573 2873 656c 662c 2076 616c  values(self, val
+00046bf0: 7565 7329 0d0a 0d0a 2020 2020 2020 2020  ues)....        
+00046c00: 7365 6c66 2e66 6f6e 745f 6661 6d69 6c79  self.font_family
+00046c10: 203d 2076 616c 7565 732e 6765 7428 2266   = values.get("f
+00046c20: 6f6e 745f 6661 6d69 6c79 222c 2073 656c  ont_family", sel
+00046c30: 662e 666f 6e74 5f66 616d 696c 7929 0d0a  f.font_family)..
+00046c40: 2020 2020 2020 2020 7365 6c66 2e66 6f6e          self.fon
+00046c50: 745f 6661 6d69 6c79 203d 2076 616c 7565  t_family = value
+00046c60: 732e 6765 7428 5356 475f 4154 5452 5f46  s.get(SVG_ATTR_F
+00046c70: 4f4e 545f 4641 4d49 4c59 2c20 7365 6c66  ONT_FAMILY, self
+00046c80: 2e66 6f6e 745f 6661 6d69 6c79 290d 0a0d  .font_family)...
+00046c90: 0a20 2020 2020 2020 2073 656c 662e 666f  .        self.fo
+00046ca0: 6e74 5f73 7479 6c65 203d 2076 616c 7565  nt_style = value
+00046cb0: 732e 6765 7428 2266 6f6e 745f 7374 796c  s.get("font_styl
+00046cc0: 6522 2c20 7365 6c66 2e66 6f6e 745f 7374  e", self.font_st
+00046cd0: 796c 6529 0d0a 2020 2020 2020 2020 7365  yle)..        se
+00046ce0: 6c66 2e66 6f6e 745f 7374 796c 6520 3d20  lf.font_style = 
+00046cf0: 7661 6c75 6573 2e67 6574 2853 5647 5f41  values.get(SVG_A
+00046d00: 5454 525f 464f 4e54 5f53 5459 4c45 2c20  TTR_FONT_STYLE, 
+00046d10: 7365 6c66 2e66 6f6e 745f 6661 6d69 6c79  self.font_family
+00046d20: 290d 0a0d 0a20 2020 2020 2020 2073 656c  )....        sel
+00046d30: 662e 666f 6e74 5f76 6172 6961 6e74 203d  f.font_variant =
+00046d40: 2076 616c 7565 732e 6765 7428 2266 6f6e   values.get("fon
+00046d50: 745f 7661 7269 616e 7422 2c20 7365 6c66  t_variant", self
+00046d60: 2e66 6f6e 745f 7661 7269 616e 7429 0d0a  .font_variant)..
+00046d70: 2020 2020 2020 2020 7365 6c66 2e66 6f6e          self.fon
+00046d80: 745f 7661 7269 616e 7420 3d20 7661 6c75  t_variant = valu
+00046d90: 6573 2e67 6574 2853 5647 5f41 5454 525f  es.get(SVG_ATTR_
+00046da0: 464f 4e54 5f56 4152 4941 4e54 2c20 7365  FONT_VARIANT, se
+00046db0: 6c66 2e66 6f6e 745f 7661 7269 616e 7429  lf.font_variant)
+00046dc0: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
+00046dd0: 2e66 6f6e 745f 7765 6967 6874 203d 2076  .font_weight = v
+00046de0: 616c 7565 732e 6765 7428 2266 6f6e 745f  alues.get("font_
+00046df0: 7765 6967 6874 222c 2073 656c 662e 666f  weight", self.fo
+00046e00: 6e74 5f77 6569 6768 7429 0d0a 2020 2020  nt_weight)..    
+00046e10: 2020 2020 7365 6c66 2e66 6f6e 745f 7765      self.font_we
+00046e20: 6967 6874 203d 2076 616c 7565 732e 6765  ight = values.ge
+00046e30: 7428 5356 475f 4154 5452 5f46 4f4e 545f  t(SVG_ATTR_FONT_
+00046e40: 5745 4947 4854 2c20 7365 6c66 2e66 6f6e  WEIGHT, self.fon
+00046e50: 745f 7765 6967 6874 290d 0a20 2020 2020  t_weight)..     
+00046e60: 2020 2074 7279 3a0d 0a20 2020 2020 2020     try:..       
+00046e70: 2020 2020 2073 656c 662e 666f 6e74 5f77       self.font_w
+00046e80: 6569 6768 7420 3d20 696e 7428 7365 6c66  eight = int(self
+00046e90: 2e66 6f6e 745f 7765 6967 6874 290d 0a20  .font_weight).. 
+00046ea0: 2020 2020 2020 2065 7863 6570 7420 5661         except Va
+00046eb0: 6c75 6545 7272 6f72 3a0d 0a20 2020 2020  lueError:..     
+00046ec0: 2020 2020 2020 2070 6173 730d 0a0d 0a20         pass.... 
+00046ed0: 2020 2020 2020 2073 656c 662e 666f 6e74         self.font
+00046ee0: 5f73 7472 6574 6368 203d 2076 616c 7565  _stretch = value
+00046ef0: 732e 6765 7428 2266 6f6e 745f 7374 7265  s.get("font_stre
+00046f00: 7463 6822 2c20 7365 6c66 2e66 6f6e 745f  tch", self.font_
+00046f10: 7374 7265 7463 6829 0d0a 2020 2020 2020  stretch)..      
+00046f20: 2020 7365 6c66 2e66 6f6e 745f 7374 7265    self.font_stre
+00046f30: 7463 6820 3d20 7661 6c75 6573 2e67 6574  tch = values.get
+00046f40: 2853 5647 5f41 5454 525f 464f 4e54 5f53  (SVG_ATTR_FONT_S
+00046f50: 5452 4554 4348 2c20 7365 6c66 2e66 6f6e  TRETCH, self.fon
+00046f60: 745f 7374 7265 7463 6829 0d0a 0d0a 2020  t_stretch)....  
+00046f70: 2020 2020 2020 7365 6c66 2e66 6f6e 745f        self.font_
+00046f80: 7369 7a65 203d 204c 656e 6774 6828 7661  size = Length(va
+00046f90: 6c75 6573 2e67 6574 2822 666f 6e74 5f73  lues.get("font_s
+00046fa0: 697a 6522 2c20 7365 6c66 2e66 6f6e 745f  ize", self.font_
+00046fb0: 7369 7a65 2929 2e76 616c 7565 2829 0d0a  size)).value()..
+00046fc0: 2020 2020 2020 2020 7365 6c66 2e66 6f6e          self.fon
+00046fd0: 745f 7369 7a65 203d 204c 656e 6774 6828  t_size = Length(
+00046fe0: 7661 6c75 6573 2e67 6574 2853 5647 5f41  values.get(SVG_A
+00046ff0: 5454 525f 464f 4e54 5f53 495a 452c 2073  TTR_FONT_SIZE, s
+00047000: 656c 662e 666f 6e74 5f73 697a 6529 292e  elf.font_size)).
+00047010: 7661 6c75 6528 290d 0a0d 0a20 2020 2020  value()....     
+00047020: 2020 2073 656c 662e 616e 6368 6f72 203d     self.anchor =
+00047030: 2076 616c 7565 732e 6765 7428 2274 6578   values.get("tex
+00047040: 745f 616e 6368 6f72 222c 2073 656c 662e  t_anchor", self.
+00047050: 616e 6368 6f72 290d 0a20 2020 2020 2020  anchor)..       
+00047060: 2073 656c 662e 616e 6368 6f72 203d 2076   self.anchor = v
+00047070: 616c 7565 732e 6765 7428 5356 475f 4154  alues.get(SVG_AT
+00047080: 5452 5f54 4558 545f 414e 4348 4f52 2c20  TR_TEXT_ANCHOR, 
+00047090: 7365 6c66 2e61 6e63 686f 7229 0d0a 0d0a  self.anchor)....
+000470a0: 2020 2020 2020 2020 666f 6e74 203d 2076          font = v
+000470b0: 616c 7565 732e 6765 7428 5356 475f 4154  alues.get(SVG_AT
+000470c0: 5452 5f46 4f4e 542c 204e 6f6e 6529 0d0a  TR_FONT, None)..
+000470d0: 2020 2020 2020 2020 6966 2066 6f6e 7420          if font 
+000470e0: 6973 206e 6f74 204e 6f6e 653a 0d0a 2020  is not None:..  
+000470f0: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+00047100: 6172 7365 5f66 6f6e 7428 666f 6e74 290d  arse_font(font).
+00047110: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
+00047120: 7465 7874 203d 2076 616c 7565 732e 6765  text = values.ge
+00047130: 7428 5356 475f 5441 475f 5445 5854 2c20  t(SVG_TAG_TEXT, 
+00047140: 7365 6c66 2e74 6578 7429 0d0a 2020 2020  self.text)..    
+00047150: 2020 2020 7365 6c66 2e78 203d 204c 656e      self.x = Len
+00047160: 6774 6828 7661 6c75 6573 2e67 6574 2853  gth(values.get(S
+00047170: 5647 5f41 5454 525f 582c 2073 656c 662e  VG_ATTR_X, self.
+00047180: 7829 292e 7661 6c75 6528 290d 0a20 2020  x)).value()..   
+00047190: 2020 2020 2073 656c 662e 7920 3d20 4c65       self.y = Le
+000471a0: 6e67 7468 2876 616c 7565 732e 6765 7428  ngth(values.get(
+000471b0: 5356 475f 4154 5452 5f59 2c20 7365 6c66  SVG_ATTR_Y, self
+000471c0: 2e79 2929 2e76 616c 7565 2829 0d0a 2020  .y)).value()..  
+000471d0: 2020 2020 2020 7365 6c66 2e64 7820 3d20        self.dx = 
+000471e0: 4c65 6e67 7468 2876 616c 7565 732e 6765  Length(values.ge
+000471f0: 7428 5356 475f 4154 5452 5f44 582c 2073  t(SVG_ATTR_DX, s
+00047200: 656c 662e 6478 2929 2e76 616c 7565 2829  elf.dx)).value()
+00047210: 0d0a 2020 2020 2020 2020 7365 6c66 2e64  ..        self.d
+00047220: 7920 3d20 4c65 6e67 7468 2876 616c 7565  y = Length(value
+00047230: 732e 6765 7428 5356 475f 4154 5452 5f44  s.get(SVG_ATTR_D
+00047240: 592c 2073 656c 662e 6479 2929 2e76 616c  Y, self.dy)).val
+00047250: 7565 2829 0d0a 0d0a 2020 2020 6465 6620  ue()....    def 
+00047260: 7265 6966 7928 7365 6c66 293a 0d0a 2020  reify(self):..  
+00047270: 2020 2020 2020 4772 6170 6869 634f 626a        GraphicObj
+00047280: 6563 742e 7265 6966 7928 7365 6c66 290d  ect.reify(self).
+00047290: 0a20 2020 2020 2020 2054 7261 6e73 666f  .        Transfo
+000472a0: 726d 6162 6c65 2e72 6569 6679 2873 656c  rmable.reify(sel
+000472b0: 6629 0d0a 0d0a 2020 2020 6465 6620 7265  f)....    def re
+000472c0: 6e64 6572 2873 656c 662c 202a 2a6b 7761  nder(self, **kwa
+000472d0: 7267 7329 3a0d 0a20 2020 2020 2020 2047  rgs):..        G
+000472e0: 7261 7068 6963 4f62 6a65 6374 2e72 656e  raphicObject.ren
+000472f0: 6465 7228 7365 6c66 2c20 2a2a 6b77 6172  der(self, **kwar
+00047300: 6773 290d 0a20 2020 2020 2020 2054 7261  gs)..        Tra
+00047310: 6e73 666f 726d 6162 6c65 2e72 656e 6465  nsformable.rende
+00047320: 7228 7365 6c66 2c20 2a2a 6b77 6172 6773  r(self, **kwargs
+00047330: 290d 0a20 2020 2020 2020 2077 6964 7468  )..        width
+00047340: 203d 206b 7761 7267 732e 6765 7428 2277   = kwargs.get("w
+00047350: 6964 7468 222c 206b 7761 7267 732e 6765  idth", kwargs.ge
+00047360: 7428 2272 656c 6174 6976 655f 6c65 6e67  t("relative_leng
+00047370: 7468 2229 290d 0a20 2020 2020 2020 2068  th"))..        h
+00047380: 6569 6768 7420 3d20 6b77 6172 6773 2e67  eight = kwargs.g
+00047390: 6574 2822 6865 6967 6874 222c 206b 7761  et("height", kwa
+000473a0: 7267 732e 6765 7428 2272 656c 6174 6976  rgs.get("relativ
+000473b0: 655f 6c65 6e67 7468 2229 290d 0a20 2020  e_length"))..   
+000473c0: 2020 2020 2074 7279 3a0d 0a20 2020 2020       try:..     
+000473d0: 2020 2020 2020 2064 656c 206b 7761 7267         del kwarg
+000473e0: 735b 2272 656c 6174 6976 655f 6c65 6e67  s["relative_leng
+000473f0: 7468 225d 0d0a 2020 2020 2020 2020 6578  th"]..        ex
+00047400: 6365 7074 204b 6579 4572 726f 723a 0d0a  cept KeyError:..
+00047410: 2020 2020 2020 2020 2020 2020 7061 7373              pass
+00047420: 0d0a 2020 2020 2020 2020 6966 2069 7369  ..        if isi
+00047430: 6e73 7461 6e63 6528 7365 6c66 2e78 2c20  nstance(self.x, 
+00047440: 4c65 6e67 7468 293a 0d0a 2020 2020 2020  Length):..      
+00047450: 2020 2020 2020 7365 6c66 2e78 203d 2073        self.x = s
+00047460: 656c 662e 782e 7661 6c75 6528 7265 6c61  elf.x.value(rela
+00047470: 7469 7665 5f6c 656e 6774 683d 7769 6474  tive_length=widt
+00047480: 682c 202a 2a6b 7761 7267 7329 0d0a 2020  h, **kwargs)..  
+00047490: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+000474a0: 6e63 6528 7365 6c66 2e79 2c20 4c65 6e67  nce(self.y, Leng
+000474b0: 7468 293a 0d0a 2020 2020 2020 2020 2020  th):..          
+000474c0: 2020 7365 6c66 2e79 203d 2073 656c 662e    self.y = self.
+000474d0: 792e 7661 6c75 6528 7265 6c61 7469 7665  y.value(relative
+000474e0: 5f6c 656e 6774 683d 6865 6967 6874 2c20  _length=height, 
+000474f0: 2a2a 6b77 6172 6773 290d 0a20 2020 2020  **kwargs)..     
+00047500: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+00047510: 2873 656c 662e 6478 2c20 4c65 6e67 7468  (self.dx, Length
+00047520: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00047530: 7365 6c66 2e64 7820 3d20 7365 6c66 2e64  self.dx = self.d
+00047540: 782e 7661 6c75 6528 7265 6c61 7469 7665  x.value(relative
+00047550: 5f6c 656e 6774 683d 7769 6474 682c 202a  _length=width, *
+00047560: 2a6b 7761 7267 7329 0d0a 2020 2020 2020  *kwargs)..      
+00047570: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+00047580: 7365 6c66 2e64 792c 204c 656e 6774 6829  self.dy, Length)
+00047590: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
+000475a0: 656c 662e 6479 203d 2073 656c 662e 6479  elf.dy = self.dy
+000475b0: 2e76 616c 7565 2872 656c 6174 6976 655f  .value(relative_
+000475c0: 6c65 6e67 7468 3d68 6569 6768 742c 202a  length=height, *
+000475d0: 2a6b 7761 7267 7329 0d0a 2020 2020 2020  *kwargs)..      
+000475e0: 2020 7265 7475 726e 2073 656c 660d 0a0d    return self...
+000475f0: 0a20 2020 2064 6566 205f 5f63 6f70 795f  .    def __copy_
+00047600: 5f28 7365 6c66 293a 0d0a 2020 2020 2020  _(self):..      
+00047610: 2020 7265 7475 726e 2054 6578 7428 7365    return Text(se
+00047620: 6c66 290d 0a0d 0a20 2020 2064 6566 2062  lf)....    def b
+00047630: 626f 7828 7365 6c66 2c20 7472 616e 7366  box(self, transf
+00047640: 6f72 6d65 643d 5472 7565 2c20 7769 7468  ormed=True, with
+00047650: 5f73 7472 6f6b 653d 4661 6c73 6529 3a0d  _stroke=False):.
+00047660: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
+00047670: 2020 2020 2020 4765 7420 7468 6520 626f        Get the bo
+00047680: 756e 6469 6e67 2062 6f78 2066 6f72 2074  unding box for t
+00047690: 6865 2067 6976 656e 2074 6578 7420 6f62  he given text ob
+000476a0: 6a65 6374 2e0d 0a0d 0a20 2020 2020 2020  ject.....       
+000476b0: 203a 7061 7261 6d20 7472 616e 7366 6f72   :param transfor
+000476c0: 6d65 643a 2077 6865 7468 6572 2074 6869  med: whether thi
+000476d0: 7320 6973 2074 6865 2074 7261 6e73 666f  s is the transfo
+000476e0: 726d 6564 2062 6f75 6e64 7320 6f72 2064  rmed bounds or d
+000476f0: 6566 6175 6c74 2e0d 0a20 2020 2020 2020  efault...       
+00047700: 203a 7061 7261 6d20 7769 7468 5f73 7472   :param with_str
+00047710: 6f6b 653a 2073 686f 756c 6420 7468 6520  oke: should the 
+00047720: 7374 726f 6b65 2d77 6964 7468 2062 6520  stroke-width be 
+00047730: 696e 636c 7564 6564 2069 6e20 7468 6520  included in the 
+00047740: 626f 756e 6473 2e0d 0a20 2020 2020 2020  bounds...       
+00047750: 203a 7265 7475 726e 3a20 626f 756e 6469   :return: boundi
+00047760: 6e67 2062 6f78 206f 6620 7468 6520 6769  ng box of the gi
+00047770: 7665 6e20 656c 656d 656e 740d 0a20 2020  ven element..   
+00047780: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
+00047790: 2020 6966 2073 656c 662e 7061 7468 2069    if self.path i
+000477a0: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
+000477b0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+000477c0: 2873 656c 662e 7061 7468 202a 2073 656c  (self.path * sel
+000477d0: 662e 7472 616e 7366 6f72 6d29 2e62 626f  f.transform).bbo
+000477e0: 7828 0d0a 2020 2020 2020 2020 2020 2020  x(..            
+000477f0: 2020 2020 7472 616e 7366 6f72 6d65 643d      transformed=
+00047800: 5472 7565 2c0d 0a20 2020 2020 2020 2020  True,..         
+00047810: 2020 2020 2020 2077 6974 685f 7374 726f         with_stro
+00047820: 6b65 3d77 6974 685f 7374 726f 6b65 2c0d  ke=with_stroke,.
+00047830: 0a20 2020 2020 2020 2020 2020 2029 0d0a  .            )..
+00047840: 0d0a 2020 2020 2020 2020 7769 6474 6820  ..        width 
+00047850: 3d20 7365 6c66 2e77 6964 7468 0d0a 2020  = self.width..  
+00047860: 2020 2020 2020 6865 6967 6874 203d 2073        height = s
+00047870: 656c 662e 6865 6967 6874 0d0a 2020 2020  elf.height..    
+00047880: 2020 2020 786d 696e 203d 2073 656c 662e      xmin = self.
+00047890: 780d 0a20 2020 2020 2020 2079 6d69 6e20  x..        ymin 
+000478a0: 3d20 7365 6c66 2e79 202d 2068 6569 6768  = self.y - heigh
+000478b0: 740d 0a20 2020 2020 2020 2078 6d61 7820  t..        xmax 
+000478c0: 3d20 7365 6c66 2e78 202b 2077 6964 7468  = self.x + width
+000478d0: 0d0a 2020 2020 2020 2020 796d 6178 203d  ..        ymax =
+000478e0: 2073 656c 662e 790d 0a0d 0a20 2020 2020   self.y....     
+000478f0: 2020 2069 6620 6e6f 7420 6861 7361 7474     if not hasatt
+00047900: 7228 7365 6c66 2c20 2261 6e63 686f 7222  r(self, "anchor"
+00047910: 2920 6f72 2073 656c 662e 616e 6368 6f72  ) or self.anchor
+00047920: 203d 3d20 2273 7461 7274 223a 0d0a 2020   == "start":..  
+00047930: 2020 2020 2020 2020 2020 7061 7373 0d0a            pass..
+00047940: 2020 2020 2020 2020 656c 6966 2073 656c          elif sel
+00047950: 662e 616e 6368 6f72 203d 3d20 226d 6964  f.anchor == "mid
+00047960: 646c 6522 3a0d 0a20 2020 2020 2020 2020  dle":..         
+00047970: 2020 2078 6d69 6e20 2d3d 2077 6964 7468     xmin -= width
+00047980: 202f 2032 0d0a 2020 2020 2020 2020 2020   / 2..          
+00047990: 2020 786d 6178 202d 3d20 7769 6474 6820    xmax -= width 
+000479a0: 2f20 320d 0a20 2020 2020 2020 2065 6c69  / 2..        eli
+000479b0: 6620 7365 6c66 2e61 6e63 686f 7220 3d3d  f self.anchor ==
+000479c0: 2022 656e 6422 3a0d 0a20 2020 2020 2020   "end":..       
+000479d0: 2020 2020 2078 6d69 6e20 2d3d 2077 6964       xmin -= wid
+000479e0: 7468 0d0a 2020 2020 2020 2020 2020 2020  th..            
+000479f0: 786d 6178 202d 3d20 7769 6474 680d 0a20  xmax -= width.. 
+00047a00: 2020 2020 2020 2069 6620 7472 616e 7366         if transf
+00047a10: 6f72 6d65 643a 0d0a 2020 2020 2020 2020  ormed:..        
+00047a20: 2020 2020 7030 203d 2073 656c 662e 7472      p0 = self.tr
+00047a30: 616e 7366 6f72 6d2e 7472 616e 7366 6f72  ansform.transfor
+00047a40: 6d5f 706f 696e 7428 5b78 6d69 6e2c 2079  m_point([xmin, y
+00047a50: 6d69 6e5d 290d 0a20 2020 2020 2020 2020  min])..         
+00047a60: 2020 2070 3120 3d20 7365 6c66 2e74 7261     p1 = self.tra
+00047a70: 6e73 666f 726d 2e74 7261 6e73 666f 726d  nsform.transform
+00047a80: 5f70 6f69 6e74 285b 786d 696e 2c20 796d  _point([xmin, ym
+00047a90: 6178 5d29 0d0a 2020 2020 2020 2020 2020  ax])..          
+00047aa0: 2020 7032 203d 2073 656c 662e 7472 616e    p2 = self.tran
+00047ab0: 7366 6f72 6d2e 7472 616e 7366 6f72 6d5f  sform.transform_
+00047ac0: 706f 696e 7428 5b78 6d61 782c 2079 6d69  point([xmax, ymi
+00047ad0: 6e5d 290d 0a20 2020 2020 2020 2020 2020  n])..           
+00047ae0: 2070 3320 3d20 7365 6c66 2e74 7261 6e73   p3 = self.trans
+00047af0: 666f 726d 2e74 7261 6e73 666f 726d 5f70  form.transform_p
+00047b00: 6f69 6e74 285b 786d 6178 2c20 796d 6178  oint([xmax, ymax
+00047b10: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
+00047b20: 786d 696e 203d 206d 696e 2870 305b 305d  xmin = min(p0[0]
+00047b30: 2c20 7031 5b30 5d2c 2070 325b 305d 2c20  , p1[0], p2[0], 
+00047b40: 7033 5b30 5d29 0d0a 2020 2020 2020 2020  p3[0])..        
+00047b50: 2020 2020 796d 696e 203d 206d 696e 2870      ymin = min(p
+00047b60: 305b 315d 2c20 7031 5b31 5d2c 2070 325b  0[1], p1[1], p2[
+00047b70: 315d 2c20 7033 5b31 5d29 0d0a 2020 2020  1], p3[1])..    
+00047b80: 2020 2020 2020 2020 786d 6178 203d 206d          xmax = m
+00047b90: 6178 2870 305b 305d 2c20 7031 5b30 5d2c  ax(p0[0], p1[0],
+00047ba0: 2070 325b 305d 2c20 7033 5b30 5d29 0d0a   p2[0], p3[0])..
+00047bb0: 2020 2020 2020 2020 2020 2020 796d 6178              ymax
+00047bc0: 203d 206d 6178 2870 305b 315d 2c20 7031   = max(p0[1], p1
+00047bd0: 5b31 5d2c 2070 325b 315d 2c20 7033 5b31  [1], p2[1], p3[1
+00047be0: 5d29 0d0a 0d0a 2020 2020 2020 2020 6966  ])....        if
+00047bf0: 2028 0d0a 2020 2020 2020 2020 2020 2020   (..            
+00047c00: 7769 7468 5f73 7472 6f6b 650d 0a20 2020  with_stroke..   
+00047c10: 2020 2020 2020 2020 2061 6e64 2073 656c           and sel
+00047c20: 662e 7374 726f 6b65 5f77 6964 7468 2069  f.stroke_width i
+00047c30: 7320 6e6f 7420 4e6f 6e65 0d0a 2020 2020  s not None..    
+00047c40: 2020 2020 2020 2020 616e 6420 6e6f 7420          and not 
+00047c50: 2873 656c 662e 7374 726f 6b65 2069 7320  (self.stroke is 
+00047c60: 4e6f 6e65 206f 7220 7365 6c66 2e73 7472  None or self.str
+00047c70: 6f6b 652e 7661 6c75 6520 6973 204e 6f6e  oke.value is Non
+00047c80: 6529 0d0a 2020 2020 2020 2020 293a 0d0a  e)..        ):..
+00047c90: 2020 2020 2020 2020 2020 2020 6966 2074              if t
+00047ca0: 7261 6e73 666f 726d 6564 3a0d 0a20 2020  ransformed:..   
+00047cb0: 2020 2020 2020 2020 2020 2020 2064 656c               del
+00047cc0: 7461 203d 2066 6c6f 6174 2873 656c 662e  ta = float(self.
+00047cd0: 696d 706c 6963 6974 5f73 7472 6f6b 655f  implicit_stroke_
+00047ce0: 7769 6474 6829 202f 2032 2e30 0d0a 2020  width) / 2.0..  
+00047cf0: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
+00047d00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00047d10: 2064 656c 7461 203d 2066 6c6f 6174 2873   delta = float(s
+00047d20: 656c 662e 7374 726f 6b65 5f77 6964 7468  elf.stroke_width
+00047d30: 2920 2f20 322e 300d 0a20 2020 2020 2020  ) / 2.0..       
+00047d40: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+00047d50: 2020 2020 6465 6c74 6120 3d20 302e 300d      delta = 0.0.
+00047d60: 0a0d 0a20 2020 2020 2020 2072 6574 7572  ...        retur
+00047d70: 6e20 280d 0a20 2020 2020 2020 2020 2020  n (..           
+00047d80: 2078 6d69 6e20 2d20 6465 6c74 612c 0d0a   xmin - delta,..
+00047d90: 2020 2020 2020 2020 2020 2020 796d 696e              ymin
+00047da0: 202d 2064 656c 7461 2c0d 0a20 2020 2020   - delta,..     
+00047db0: 2020 2020 2020 2078 6d61 7820 2b20 6465         xmax + de
+00047dc0: 6c74 612c 0d0a 2020 2020 2020 2020 2020  lta,..          
+00047dd0: 2020 796d 6178 202b 2064 656c 7461 2c0d    ymax + delta,.
+00047de0: 0a20 2020 2020 2020 2029 0d0a 0d0a 0d0a  .        )......
+00047df0: 5356 4754 6578 7420 3d20 5465 7874 0d0a  SVGText = Text..
+00047e00: 0d0a 0d0a 636c 6173 7320 496d 6167 6528  ....class Image(
+00047e10: 5356 4745 6c65 6d65 6e74 2c20 4772 6170  SVGElement, Grap
+00047e20: 6869 634f 626a 6563 742c 2054 7261 6e73  hicObject, Trans
+00047e30: 666f 726d 6162 6c65 293a 0d0a 2020 2020  formable):..    
+00047e40: 2222 220d 0a20 2020 2053 5647 2049 6d61  """..    SVG Ima
+00047e50: 6765 7320 6172 6520 6465 6669 6e65 6420  ges are defined 
+00047e60: 696e 2053 5647 2032 2e30 2031 322e 330d  in SVG 2.0 12.3.
+00047e70: 0a0d 0a20 2020 2054 6869 7320 636c 6173  ...    This clas
+00047e80: 7320 6973 2063 616c 6c65 6420 5356 4720  s is called SVG 
+00047e90: 496d 6167 6520 7261 7468 6572 2074 6861  Image rather tha
+00047ea0: 6e20 696d 6167 6520 6173 2061 2067 7561  n image as a gua
+00047eb0: 7264 2061 6761 696e 7374 206d 616e 7920  rd against many 
+00047ec0: 496d 6167 6520 6f62 6a65 6374 730d 0a20  Image objects.. 
+00047ed0: 2020 2077 6869 6368 2061 7265 2071 7569     which are qui
+00047ee0: 7465 2075 7365 6675 6c20 616e 6420 776f  te useful and wo
+00047ef0: 756c 6420 6265 2069 6465 616c 2066 6f72  uld be ideal for
+00047f00: 2072 6561 6469 6e67 2074 6865 206c 696e   reading the lin
+00047f10: 6b65 6420 6f72 2063 6f6e 7461 696e 6564  ked or contained
+00047f20: 2064 6174 612e 0d0a 2020 2020 2222 220d   data...    """.
+00047f30: 0a0d 0a20 2020 2064 6566 205f 5f69 6e69  ...    def __ini
+00047f40: 745f 5f28 7365 6c66 2c20 2a61 7267 732c  t__(self, *args,
+00047f50: 202a 2a6b 7761 7267 7329 3a0d 0a20 2020   **kwargs):..   
+00047f60: 2020 2020 2073 656c 662e 7572 6c20 3d20       self.url = 
+00047f70: 4e6f 6e65 0d0a 2020 2020 2020 2020 7365  None..        se
+00047f80: 6c66 2e64 6174 6120 3d20 4e6f 6e65 0d0a  lf.data = None..
+00047f90: 2020 2020 2020 2020 7365 6c66 2e6d 6564          self.med
+00047fa0: 6961 5f74 7970 6520 3d20 4e6f 6e65 0d0a  ia_type = None..
+00047fb0: 2020 2020 2020 2020 7365 6c66 2e76 6965          self.vie
+00047fc0: 7762 6f78 203d 204e 6f6e 650d 0a20 2020  wbox = None..   
+00047fd0: 2020 2020 2073 656c 662e 7072 6573 6572       self.preser
+00047fe0: 7665 5f61 7370 6563 745f 7261 7469 6f20  ve_aspect_ratio 
+00047ff0: 3d20 4e6f 6e65 0d0a 2020 2020 2020 2020  = None..        
+00048000: 7365 6c66 2e78 203d 204e 6f6e 650d 0a20  self.x = None.. 
+00048010: 2020 2020 2020 2073 656c 662e 7920 3d20         self.y = 
+00048020: 4e6f 6e65 0d0a 2020 2020 2020 2020 7365  None..        se
+00048030: 6c66 2e77 6964 7468 203d 204e 6f6e 650d  lf.width = None.
+00048040: 0a20 2020 2020 2020 2073 656c 662e 6865  .        self.he
+00048050: 6967 6874 203d 204e 6f6e 650d 0a0d 0a20  ight = None.... 
+00048060: 2020 2020 2020 2073 656c 662e 696d 6167         self.imag
+00048070: 6520 3d20 4e6f 6e65 0d0a 2020 2020 2020  e = None..      
+00048080: 2020 7365 6c66 2e69 6d61 6765 5f77 6964    self.image_wid
+00048090: 7468 203d 204e 6f6e 650d 0a20 2020 2020  th = None..     
+000480a0: 2020 2073 656c 662e 696d 6167 655f 6865     self.image_he
+000480b0: 6967 6874 203d 204e 6f6e 650d 0a20 2020  ight = None..   
+000480c0: 2020 2020 2054 7261 6e73 666f 726d 6162       Transformab
+000480d0: 6c65 2e5f 5f69 6e69 745f 5f28 7365 6c66  le.__init__(self
+000480e0: 2c20 2a61 7267 732c 202a 2a6b 7761 7267  , *args, **kwarg
+000480f0: 7329 0d0a 2020 2020 2020 2020 4772 6170  s)..        Grap
+00048100: 6869 634f 626a 6563 742e 5f5f 696e 6974  hicObject.__init
+00048110: 5f5f 2873 656c 662c 202a 6172 6773 2c20  __(self, *args, 
+00048120: 2a2a 6b77 6172 6773 290d 0a20 2020 2020  **kwargs)..     
+00048130: 2020 2053 5647 456c 656d 656e 742e 5f5f     SVGElement.__
+00048140: 696e 6974 5f5f 280d 0a20 2020 2020 2020  init__(..       
+00048150: 2020 2020 2073 656c 662c 202a 6172 6773       self, *args
+00048160: 2c20 2a2a 6b77 6172 6773 0d0a 2020 2020  , **kwargs..    
+00048170: 2020 2020 2920 2023 2044 6174 6175 726c      )  # Dataurl
+00048180: 2072 6571 7569 7265 7320 7468 6973 2062   requires this b
+00048190: 6520 7072 6f63 6573 7365 6420 6669 7273  e processed firs
+000481a0: 742e 0d0a 0d0a 2020 2020 2020 2020 6966  t.....        if
+000481b0: 2073 656c 662e 7572 6c20 6973 206e 6f74   self.url is not
+000481c0: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+000481d0: 2020 2020 6d61 7463 6820 3d20 5245 4745      match = REGE
+000481e0: 585f 4441 5441 5f55 524c 2e6d 6174 6368  X_DATA_URL.match
+000481f0: 2873 656c 662e 7572 6c29 0d0a 2020 2020  (self.url)..    
+00048200: 2020 2020 2020 2020 6966 206d 6174 6368          if match
+00048210: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00048220: 2020 2023 2044 6174 6120 5552 4c0d 0a20     # Data URL.. 
+00048230: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00048240: 656c 662e 6d65 6469 615f 7479 7065 203d  elf.media_type =
+00048250: 206d 6174 6368 2e67 726f 7570 2831 292e   match.group(1).
+00048260: 7370 6c69 7428 223b 2229 0d0a 2020 2020  split(";")..    
+00048270: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00048280: 2e64 6174 6120 3d20 6d61 7463 682e 6772  .data = match.gr
+00048290: 6f75 7028 3229 0d0a 2020 2020 2020 2020  oup(2)..        
+000482a0: 2020 2020 2020 2020 6966 2022 6261 7365          if "base
+000482b0: 3634 2220 696e 2073 656c 662e 6d65 6469  64" in self.medi
+000482c0: 615f 7479 7065 3a0d 0a20 2020 2020 2020  a_type:..       
+000482d0: 2020 2020 2020 2020 2020 2020 2066 726f               fro
+000482e0: 6d20 6261 7365 3634 2069 6d70 6f72 7420  m base64 import 
+000482f0: 6236 3464 6563 6f64 650d 0a0d 0a20 2020  b64decode....   
+00048300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048310: 2073 656c 662e 6461 7461 203d 2062 3634   self.data = b64
+00048320: 6465 636f 6465 2873 656c 662e 6461 7461  decode(self.data
+00048330: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00048340: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+00048350: 2020 2020 2020 2020 2020 2020 2020 6672                fr
+00048360: 6f6d 2075 726c 6c69 622e 7061 7273 6520  om urllib.parse 
+00048370: 696d 706f 7274 2075 6e71 756f 7465 5f74  import unquote_t
+00048380: 6f5f 6279 7465 730d 0a0d 0a20 2020 2020  o_bytes....     
+00048390: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000483a0: 656c 662e 6461 7461 203d 2075 6e71 756f  elf.data = unquo
+000483b0: 7465 5f74 6f5f 6279 7465 7328 7365 6c66  te_to_bytes(self
+000483c0: 2e64 6174 6129 0d0a 0d0a 2020 2020 6465  .data)....    de
+000483d0: 6620 5f5f 7265 7072 5f5f 2873 656c 6629  f __repr__(self)
+000483e0: 3a0d 0a20 2020 2020 2020 2076 616c 7565  :..        value
+000483f0: 7320 3d20 5b5d 0d0a 2020 2020 2020 2020  s = []..        
+00048400: 6966 2073 656c 662e 7820 213d 2030 3a0d  if self.x != 0:.
+00048410: 0a20 2020 2020 2020 2020 2020 2076 616c  .            val
+00048420: 7565 732e 6170 7065 6e64 2822 2573 3d25  ues.append("%s=%
+00048430: 7322 2025 2028 5356 475f 4154 5452 5f58  s" % (SVG_ATTR_X
+00048440: 2c20 4c65 6e67 7468 2e73 7472 2873 656c  , Length.str(sel
+00048450: 662e 7829 2929 0d0a 2020 2020 2020 2020  f.x)))..        
+00048460: 6966 2073 656c 662e 7920 213d 2030 3a0d  if self.y != 0:.
+00048470: 0a20 2020 2020 2020 2020 2020 2076 616c  .            val
+00048480: 7565 732e 6170 7065 6e64 2822 2573 3d25  ues.append("%s=%
+00048490: 7322 2025 2028 5356 475f 4154 5452 5f59  s" % (SVG_ATTR_Y
+000484a0: 2c20 4c65 6e67 7468 2e73 7472 2873 656c  , Length.str(sel
+000484b0: 662e 7929 2929 0d0a 2020 2020 2020 2020  f.y)))..        
+000484c0: 6966 2073 656c 662e 7769 6474 6820 213d  if self.width !=
+000484d0: 2022 3130 3025 223a 0d0a 2020 2020 2020   "100%":..      
+000484e0: 2020 2020 2020 7661 6c75 6573 2e61 7070        values.app
+000484f0: 656e 6428 2225 733d 2573 2220 2520 2853  end("%s=%s" % (S
+00048500: 5647 5f41 5454 525f 5749 4454 482c 204c  VG_ATTR_WIDTH, L
+00048510: 656e 6774 682e 7374 7228 7365 6c66 2e77  ength.str(self.w
+00048520: 6964 7468 2929 290d 0a20 2020 2020 2020  idth)))..       
+00048530: 2069 6620 7365 6c66 2e68 6569 6768 7420   if self.height 
+00048540: 213d 2022 3130 3025 223a 0d0a 2020 2020  != "100%":..    
+00048550: 2020 2020 2020 2020 7661 6c75 6573 2e61          values.a
+00048560: 7070 656e 6428 2225 733d 2573 2220 2520  ppend("%s=%s" % 
+00048570: 2853 5647 5f41 5454 525f 4845 4947 4854  (SVG_ATTR_HEIGHT
+00048580: 2c20 4c65 6e67 7468 2e73 7472 2873 656c  , Length.str(sel
+00048590: 662e 6865 6967 6874 2929 290d 0a20 2020  f.height)))..   
+000485a0: 2020 2020 2069 6620 7365 6c66 2e70 7265       if self.pre
+000485b0: 7365 7276 655f 6173 7065 6374 5f72 6174  serve_aspect_rat
+000485c0: 696f 2069 7320 6e6f 7420 4e6f 6e65 3a0d  io is not None:.
+000485d0: 0a20 2020 2020 2020 2020 2020 2076 616c  .            val
+000485e0: 7565 732e 6170 7065 6e64 280d 0a20 2020  ues.append(..   
+000485f0: 2020 2020 2020 2020 2020 2020 2022 2573               "%s
+00048600: 3d25 7322 2025 2028 5356 475f 4154 5452  =%s" % (SVG_ATTR
+00048610: 5f50 5245 5345 5256 4541 5350 4543 5452  _PRESERVEASPECTR
+00048620: 4154 494f 2c20 7365 6c66 2e70 7265 7365  ATIO, self.prese
+00048630: 7276 655f 6173 7065 6374 5f72 6174 696f  rve_aspect_ratio
+00048640: 290d 0a20 2020 2020 2020 2020 2020 2029  )..            )
+00048650: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
+00048660: 662e 7669 6577 626f 7820 6973 206e 6f74  f.viewbox is not
+00048670: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+00048680: 2020 2020 7661 6c75 6573 2e61 7070 656e      values.appen
+00048690: 6428 2225 733d 2725 7327 2220 2520 2853  d("%s='%s'" % (S
+000486a0: 5647 5f41 5454 525f 5649 4557 424f 582c  VG_ATTR_VIEWBOX,
+000486b0: 2073 7472 2873 656c 662e 7669 6577 626f   str(self.viewbo
+000486c0: 7829 2929 0d0a 2020 2020 2020 2020 6966  x)))..        if
+000486d0: 2073 656c 662e 7572 6c20 6973 206e 6f74   self.url is not
+000486e0: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+000486f0: 2020 2020 7661 6c75 6573 2e61 7070 656e      values.appen
+00048700: 6428 2225 733d 2725 7327 2220 2520 2853  d("%s='%s'" % (S
+00048710: 5647 5f48 5245 462c 2073 656c 662e 7572  VG_HREF, self.ur
+00048720: 6c29 290d 0a20 2020 2020 2020 2069 6620  l))..        if 
+00048730: 6e6f 7420 7365 6c66 2e74 7261 6e73 666f  not self.transfo
+00048740: 726d 2e69 735f 6964 656e 7469 7479 2829  rm.is_identity()
+00048750: 3a0d 0a20 2020 2020 2020 2020 2020 2076  :..            v
+00048760: 616c 7565 732e 6170 7065 6e64 2822 7472  alues.append("tr
+00048770: 616e 7366 6f72 6d3d 2573 2220 2520 7265  ansform=%s" % re
+00048780: 7072 2873 656c 662e 7472 616e 7366 6f72  pr(self.transfor
+00048790: 6d29 290d 0a20 2020 2020 2020 2070 6172  m))..        par
+000487a0: 616d 7320 3d20 222c 2022 2e6a 6f69 6e28  ams = ", ".join(
+000487b0: 7661 6c75 6573 290d 0a20 2020 2020 2020  values)..       
+000487c0: 2072 6574 7572 6e20 2249 6d61 6765 2825   return "Image(%
+000487d0: 7329 2220 2520 7061 7261 6d73 0d0a 0d0a  s)" % params....
+000487e0: 2020 2020 6465 6620 5f5f 6571 5f5f 2873      def __eq__(s
+000487f0: 656c 662c 206f 7468 6572 293a 0d0a 2020  elf, other):..  
+00048800: 2020 2020 2020 6966 206e 6f74 2069 7369        if not isi
+00048810: 6e73 7461 6e63 6528 6f74 6865 722c 2049  nstance(other, I
+00048820: 6d61 6765 293a 0d0a 2020 2020 2020 2020  mage):..        
+00048830: 2020 2020 7265 7475 726e 204e 6f74 496d      return NotIm
+00048840: 706c 656d 656e 7465 640d 0a20 2020 2020  plemented..     
+00048850: 2020 2069 6620 7365 6c66 2e75 726c 2021     if self.url !
+00048860: 3d20 6f74 6865 722e 7572 6c3a 0d0a 2020  = other.url:..  
+00048870: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00048880: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
+00048890: 6966 2073 656c 662e 6461 7461 2021 3d20  if self.data != 
+000488a0: 6f74 6865 722e 6461 7461 3a0d 0a20 2020  other.data:..   
+000488b0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+000488c0: 4661 6c73 650d 0a20 2020 2020 2020 2069  False..        i
+000488d0: 6620 7365 6c66 2e77 6964 7468 2021 3d20  f self.width != 
+000488e0: 6f74 6865 722e 7769 6474 683a 0d0a 2020  other.width:..  
+000488f0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00048900: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
+00048910: 6966 2073 656c 662e 6865 6967 6874 2021  if self.height !
+00048920: 3d20 6f74 6865 722e 6865 6967 6874 3a0d  = other.height:.
+00048930: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00048940: 7572 6e20 4661 6c73 650d 0a20 2020 2020  urn False..     
+00048950: 2020 2069 6620 7365 6c66 2e78 2021 3d20     if self.x != 
+00048960: 6f74 6865 722e 783a 0d0a 2020 2020 2020  other.x:..      
+00048970: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
+00048980: 7365 0d0a 2020 2020 2020 2020 6966 2073  se..        if s
+00048990: 656c 662e 7920 213d 206f 7468 6572 2e79  elf.y != other.y
+000489a0: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
+000489b0: 6574 7572 6e20 4661 6c73 650d 0a20 2020  eturn False..   
+000489c0: 2020 2020 2069 6620 7365 6c66 2e69 6d61       if self.ima
+000489d0: 6765 2021 3d20 6f74 6865 722e 696d 6167  ge != other.imag
+000489e0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+000489f0: 7265 7475 726e 2046 616c 7365 0d0a 2020  return False..  
+00048a00: 2020 2020 2020 6966 2073 656c 662e 7669        if self.vi
+00048a10: 6577 626f 7820 213d 206f 7468 6572 2e76  ewbox != other.v
+00048a20: 6965 7762 6f78 3a0d 0a20 2020 2020 2020  iewbox:..       
+00048a30: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+00048a40: 650d 0a20 2020 2020 2020 2072 6574 7572  e..        retur
+00048a50: 6e20 7365 6c66 2e70 7265 7365 7276 655f  n self.preserve_
+00048a60: 6173 7065 6374 5f72 6174 696f 203d 3d20  aspect_ratio == 
+00048a70: 6f74 6865 722e 7072 6573 6572 7665 5f61  other.preserve_a
+00048a80: 7370 6563 745f 7261 7469 6f0d 0a0d 0a20  spect_ratio.... 
+00048a90: 2020 2064 6566 205f 5f6e 655f 5f28 7365     def __ne__(se
+00048aa0: 6c66 2c20 6f74 6865 7229 3a0d 0a20 2020  lf, other):..   
+00048ab0: 2020 2020 2069 6620 6e6f 7420 6973 696e       if not isin
+00048ac0: 7374 616e 6365 286f 7468 6572 2c20 496d  stance(other, Im
+00048ad0: 6167 6529 3a0d 0a20 2020 2020 2020 2020  age):..         
+00048ae0: 2020 2072 6574 7572 6e20 4e6f 7449 6d70     return NotImp
+00048af0: 6c65 6d65 6e74 6564 0d0a 2020 2020 2020  lemented..      
+00048b00: 2020 7265 7475 726e 206e 6f74 2073 656c    return not sel
+00048b10: 6620 3d3d 206f 7468 6572 0d0a 0d0a 2020  f == other....  
+00048b20: 2020 6465 6620 7072 6f70 6572 7479 5f62    def property_b
+00048b30: 795f 6f62 6a65 6374 2873 656c 662c 2073  y_object(self, s
+00048b40: 293a 0d0a 2020 2020 2020 2020 5356 4745  ):..        SVGE
+00048b50: 6c65 6d65 6e74 2e70 726f 7065 7274 795f  lement.property_
+00048b60: 6279 5f6f 626a 6563 7428 7365 6c66 2c20  by_object(self, 
+00048b70: 7329 0d0a 2020 2020 2020 2020 5472 616e  s)..        Tran
+00048b80: 7366 6f72 6d61 626c 652e 7072 6f70 6572  sformable.proper
+00048b90: 7479 5f62 795f 6f62 6a65 6374 2873 656c  ty_by_object(sel
+00048ba0: 662c 2073 290d 0a20 2020 2020 2020 2047  f, s)..        G
+00048bb0: 7261 7068 6963 4f62 6a65 6374 2e70 726f  raphicObject.pro
+00048bc0: 7065 7274 795f 6279 5f6f 626a 6563 7428  perty_by_object(
+00048bd0: 7365 6c66 2c20 7329 0d0a 2020 2020 2020  self, s)..      
+00048be0: 2020 7365 6c66 2e75 726c 203d 2073 2e75    self.url = s.u
+00048bf0: 726c 0d0a 2020 2020 2020 2020 7365 6c66  rl..        self
+00048c00: 2e64 6174 6120 3d20 732e 6461 7461 0d0a  .data = s.data..
+00048c10: 2020 2020 2020 2020 7365 6c66 2e76 6965          self.vie
+00048c20: 7762 6f78 203d 2073 2e76 6965 7762 6f78  wbox = s.viewbox
+00048c30: 0d0a 2020 2020 2020 2020 7365 6c66 2e70  ..        self.p
+00048c40: 7265 7365 7276 655f 6173 7065 6374 5f72  reserve_aspect_r
+00048c50: 6174 696f 203d 2073 2e70 7265 7365 7276  atio = s.preserv
+00048c60: 655f 6173 7065 6374 5f72 6174 696f 0d0a  e_aspect_ratio..
+00048c70: 0d0a 2020 2020 2020 2020 7365 6c66 2e78  ..        self.x
+00048c80: 203d 2073 2e78 0d0a 2020 2020 2020 2020   = s.x..        
+00048c90: 7365 6c66 2e79 203d 2073 2e79 0d0a 2020  self.y = s.y..  
+00048ca0: 2020 2020 2020 7365 6c66 2e77 6964 7468        self.width
+00048cb0: 203d 2073 2e77 6964 7468 0d0a 2020 2020   = s.width..    
+00048cc0: 2020 2020 7365 6c66 2e68 6569 6768 7420      self.height 
+00048cd0: 3d20 732e 6865 6967 6874 0d0a 0d0a 2020  = s.height....  
+00048ce0: 2020 2020 2020 7365 6c66 2e69 6d61 6765        self.image
+00048cf0: 203d 2073 2e69 6d61 6765 0d0a 2020 2020   = s.image..    
+00048d00: 2020 2020 7365 6c66 2e69 6d61 6765 5f77      self.image_w
+00048d10: 6964 7468 203d 2073 2e69 6d61 6765 5f77  idth = s.image_w
+00048d20: 6964 7468 0d0a 2020 2020 2020 2020 7365  idth..        se
+00048d30: 6c66 2e69 6d61 6765 5f68 6569 6768 7420  lf.image_height 
+00048d40: 3d20 732e 696d 6167 655f 6865 6967 6874  = s.image_height
+00048d50: 0d0a 0d0a 2020 2020 6465 6620 7072 6f70  ....    def prop
+00048d60: 6572 7479 5f62 795f 7661 6c75 6573 2873  erty_by_values(s
+00048d70: 656c 662c 2076 616c 7565 7329 3a0d 0a20  elf, values):.. 
+00048d80: 2020 2020 2020 2053 5647 456c 656d 656e         SVGElemen
+00048d90: 742e 7072 6f70 6572 7479 5f62 795f 7661  t.property_by_va
+00048da0: 6c75 6573 2873 656c 662c 2076 616c 7565  lues(self, value
+00048db0: 7329 0d0a 2020 2020 2020 2020 5472 616e  s)..        Tran
+00048dc0: 7366 6f72 6d61 626c 652e 7072 6f70 6572  sformable.proper
+00048dd0: 7479 5f62 795f 7661 6c75 6573 2873 656c  ty_by_values(sel
+00048de0: 662c 2076 616c 7565 7329 0d0a 2020 2020  f, values)..    
+00048df0: 2020 2020 4772 6170 6869 634f 626a 6563      GraphicObjec
+00048e00: 742e 7072 6f70 6572 7479 5f62 795f 7661  t.property_by_va
+00048e10: 6c75 6573 2873 656c 662c 2076 616c 7565  lues(self, value
+00048e20: 7329 0d0a 2020 2020 2020 2020 6966 2058  s)..        if X
+00048e30: 4c49 4e4b 5f48 5245 4620 696e 2076 616c  LINK_HREF in val
+00048e40: 7565 733a 0d0a 2020 2020 2020 2020 2020  ues:..          
+00048e50: 2020 7365 6c66 2e75 726c 203d 2076 616c    self.url = val
+00048e60: 7565 735b 584c 494e 4b5f 4852 4546 5d0d  ues[XLINK_HREF].
+00048e70: 0a20 2020 2020 2020 2065 6c69 6620 5356  .        elif SV
+00048e80: 475f 4852 4546 2069 6e20 7661 6c75 6573  G_HREF in values
+00048e90: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
+00048ea0: 656c 662e 7572 6c20 3d20 7661 6c75 6573  elf.url = values
+00048eb0: 5b53 5647 5f48 5245 465d 0d0a 2020 2020  [SVG_HREF]..    
+00048ec0: 2020 2020 7669 6577 626f 7820 3d20 7661      viewbox = va
+00048ed0: 6c75 6573 2e67 6574 2853 5647 5f41 5454  lues.get(SVG_ATT
+00048ee0: 525f 5649 4557 424f 5829 0d0a 2020 2020  R_VIEWBOX)..    
+00048ef0: 2020 2020 6966 2076 6965 7762 6f78 2069      if viewbox i
+00048f00: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
+00048f10: 2020 2020 2020 2020 2073 656c 662e 7669           self.vi
+00048f20: 6577 626f 7820 3d20 5669 6577 626f 7828  ewbox = Viewbox(
+00048f30: 7669 6577 626f 7829 0d0a 2020 2020 2020  viewbox)..      
+00048f40: 2020 6966 2053 5647 5f41 5454 525f 5052    if SVG_ATTR_PR
+00048f50: 4553 4552 5645 4153 5045 4354 5241 5449  ESERVEASPECTRATI
+00048f60: 4f20 696e 2076 616c 7565 733a 0d0a 2020  O in values:..  
+00048f70: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+00048f80: 7265 7365 7276 655f 6173 7065 6374 5f72  reserve_aspect_r
+00048f90: 6174 696f 203d 2076 616c 7565 735b 5356  atio = values[SV
+00048fa0: 475f 4154 5452 5f50 5245 5345 5256 4541  G_ATTR_PRESERVEA
+00048fb0: 5350 4543 5452 4154 494f 5d0d 0a20 2020  SPECTRATIO]..   
+00048fc0: 2020 2020 2073 656c 662e 7820 3d20 4c65       self.x = Le
+00048fd0: 6e67 7468 2876 616c 7565 732e 6765 7428  ngth(values.get(
+00048fe0: 5356 475f 4154 5452 5f58 2c20 3029 292e  SVG_ATTR_X, 0)).
+00048ff0: 7661 6c75 6528 290d 0a20 2020 2020 2020  value()..       
+00049000: 2073 656c 662e 7920 3d20 4c65 6e67 7468   self.y = Length
+00049010: 2876 616c 7565 732e 6765 7428 5356 475f  (values.get(SVG_
+00049020: 4154 5452 5f59 2c20 3029 292e 7661 6c75  ATTR_Y, 0)).valu
+00049030: 6528 290d 0a20 2020 2020 2020 2073 656c  e()..        sel
+00049040: 662e 7769 6474 6820 3d20 4c65 6e67 7468  f.width = Length
+00049050: 2876 616c 7565 732e 6765 7428 5356 475f  (values.get(SVG_
+00049060: 4154 5452 5f57 4944 5448 2c20 2231 3030  ATTR_WIDTH, "100
+00049070: 2522 2929 2e76 616c 7565 2829 0d0a 2020  %")).value()..  
+00049080: 2020 2020 2020 7365 6c66 2e68 6569 6768        self.heigh
+00049090: 7420 3d20 4c65 6e67 7468 2876 616c 7565  t = Length(value
+000490a0: 732e 6765 7428 5356 475f 4154 5452 5f48  s.get(SVG_ATTR_H
+000490b0: 4549 4748 542c 2022 3130 3025 2229 292e  EIGHT, "100%")).
+000490c0: 7661 6c75 6528 290d 0a20 2020 2020 2020  value()..       
+000490d0: 2069 6620 2269 6d61 6765 2220 696e 2076   if "image" in v
+000490e0: 616c 7565 733a 0d0a 2020 2020 2020 2020  alues:..        
+000490f0: 2020 2020 7365 6c66 2e69 6d61 6765 203d      self.image =
+00049100: 2076 616c 7565 735b 2269 6d61 6765 225d   values["image"]
+00049110: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00049120: 6c66 2e69 6d61 6765 5f77 6964 7468 2c20  lf.image_width, 
+00049130: 7365 6c66 2e69 6d61 6765 5f68 6569 6768  self.image_heigh
+00049140: 7420 3d20 7365 6c66 2e69 6d61 6765 2e73  t = self.image.s
+00049150: 697a 650d 0a0d 0a20 2020 2064 6566 2072  ize....    def r
+00049160: 656e 6465 7228 7365 6c66 2c20 2a2a 6b77  ender(self, **kw
+00049170: 6172 6773 293a 0d0a 2020 2020 2020 2020  args):..        
+00049180: 4772 6170 6869 634f 626a 6563 742e 7265  GraphicObject.re
+00049190: 6e64 6572 2873 656c 662c 202a 2a6b 7761  nder(self, **kwa
+000491a0: 7267 7329 0d0a 2020 2020 2020 2020 5472  rgs)..        Tr
+000491b0: 616e 7366 6f72 6d61 626c 652e 7265 6e64  ansformable.rend
+000491c0: 6572 2873 656c 662c 202a 2a6b 7761 7267  er(self, **kwarg
+000491d0: 7329 0d0a 2020 2020 2020 2020 5356 4745  s)..        SVGE
+000491e0: 6c65 6d65 6e74 2e72 656e 6465 7228 7365  lement.render(se
+000491f0: 6c66 2c20 2a2a 6b77 6172 6773 290d 0a20  lf, **kwargs).. 
+00049200: 2020 2020 2020 2077 6964 7468 203d 206b         width = k
+00049210: 7761 7267 732e 6765 7428 2277 6964 7468  wargs.get("width
+00049220: 222c 206b 7761 7267 732e 6765 7428 2272  ", kwargs.get("r
+00049230: 656c 6174 6976 655f 6c65 6e67 7468 2229  elative_length")
+00049240: 290d 0a20 2020 2020 2020 2068 6569 6768  )..        heigh
+00049250: 7420 3d20 6b77 6172 6773 2e67 6574 2822  t = kwargs.get("
+00049260: 6865 6967 6874 222c 206b 7761 7267 732e  height", kwargs.
+00049270: 6765 7428 2272 656c 6174 6976 655f 6c65  get("relative_le
+00049280: 6e67 7468 2229 290d 0a20 2020 2020 2020  ngth"))..       
+00049290: 2074 7279 3a0d 0a20 2020 2020 2020 2020   try:..         
+000492a0: 2020 2064 656c 206b 7761 7267 735b 2272     del kwargs["r
+000492b0: 656c 6174 6976 655f 6c65 6e67 7468 225d  elative_length"]
+000492c0: 0d0a 2020 2020 2020 2020 6578 6365 7074  ..        except
+000492d0: 204b 6579 4572 726f 723a 0d0a 2020 2020   KeyError:..    
+000492e0: 2020 2020 2020 2020 7061 7373 0d0a 2020          pass..  
+000492f0: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+00049300: 6e63 6528 7365 6c66 2e78 2c20 4c65 6e67  nce(self.x, Leng
+00049310: 7468 293a 0d0a 2020 2020 2020 2020 2020  th):..          
+00049320: 2020 7365 6c66 2e78 203d 2073 656c 662e    self.x = self.
+00049330: 782e 7661 6c75 6528 7265 6c61 7469 7665  x.value(relative
+00049340: 5f6c 656e 6774 683d 7769 6474 682c 202a  _length=width, *
+00049350: 2a6b 7761 7267 7329 0d0a 2020 2020 2020  *kwargs)..      
+00049360: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+00049370: 7365 6c66 2e79 2c20 4c65 6e67 7468 293a  self.y, Length):
+00049380: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00049390: 6c66 2e79 203d 2073 656c 662e 792e 7661  lf.y = self.y.va
+000493a0: 6c75 6528 7265 6c61 7469 7665 5f6c 656e  lue(relative_len
+000493b0: 6774 683d 6865 6967 6874 2c20 2a2a 6b77  gth=height, **kw
+000493c0: 6172 6773 290d 0a20 2020 2020 2020 2069  args)..        i
+000493d0: 6620 6973 696e 7374 616e 6365 2873 656c  f isinstance(sel
+000493e0: 662e 7769 6474 682c 204c 656e 6774 6829  f.width, Length)
+000493f0: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
+00049400: 656c 662e 7769 6474 6820 3d20 7365 6c66  elf.width = self
+00049410: 2e77 6964 7468 2e76 616c 7565 2872 656c  .width.value(rel
+00049420: 6174 6976 655f 6c65 6e67 7468 3d77 6964  ative_length=wid
+00049430: 7468 2c20 2a2a 6b77 6172 6773 290d 0a20  th, **kwargs).. 
+00049440: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
+00049450: 616e 6365 2873 656c 662e 6865 6967 6874  ance(self.height
+00049460: 2c20 4c65 6e67 7468 293a 0d0a 2020 2020  , Length):..    
+00049470: 2020 2020 2020 2020 7365 6c66 2e68 6569          self.hei
+00049480: 6768 7420 3d20 7365 6c66 2e68 6569 6768  ght = self.heigh
+00049490: 742e 7661 6c75 6528 7265 6c61 7469 7665  t.value(relative
+000494a0: 5f6c 656e 6774 683d 6865 6967 6874 2c20  _length=height, 
+000494b0: 2a2a 6b77 6172 6773 290d 0a20 2020 2020  **kwargs)..     
+000494c0: 2020 2072 6574 7572 6e20 7365 6c66 0d0a     return self..
+000494d0: 0d0a 2020 2020 6465 6620 5f5f 636f 7079  ..    def __copy
+000494e0: 5f5f 2873 656c 6629 3a0d 0a20 2020 2020  __(self):..     
+000494f0: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
+00049500: 436f 7079 206f 6620 496d 6167 652e 2054  Copy of Image. T
+00049510: 6869 7320 7769 6c6c 206e 6f74 2063 6f70  his will not cop
+00049520: 7920 7468 6520 2e69 6d61 6765 2073 7562  y the .image sub
+00049530: 6f62 6a65 6374 2069 6e20 6120 6465 6570  object in a deep
+00049540: 206d 616e 6e65 720d 0a20 2020 2020 2020   manner..       
+00049550: 2073 696e 6365 2069 7427 7320 6f70 7469   since it's opti
+00049560: 6f6e 616c 2074 6861 7420 7468 6174 206f  onal that that o
+00049570: 626a 6563 7420 7769 6c6c 2065 7869 7374  bject will exist
+00049580: 206f 7220 6e6f 742e 2041 7320 7375 6368   or not. As such
+00049590: 2069 6620 7573 696e 6720 5049 4c20 6974   if using PIL it
+000495a0: 2077 6f75 6c64 0d0a 2020 2020 2020 2020   would..        
+000495b0: 6265 2072 6571 7569 7265 6420 746f 2065  be required to e
+000495c0: 6974 6865 7220 7361 7920 7365 6c66 2e69  ither say self.i
+000495d0: 6d61 6765 203d 2073 656c 662e 696d 6167  mage = self.imag
+000495e0: 652e 636f 7079 2829 206f 7220 6361 6c6c  e.copy() or call
+000495f0: 202e 6c6f 6164 2829 2061 6761 696e 2e0d   .load() again..
+00049600: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
+00049610: 2020 2020 2020 7265 7475 726e 2049 6d61        return Ima
+00049620: 6765 2873 656c 6629 0d0a 0d0a 2020 2020  ge(self)....    
+00049630: 4070 726f 7065 7274 790d 0a20 2020 2064  @property..    d
+00049640: 6566 2076 6965 7762 6f78 5f74 7261 6e73  ef viewbox_trans
+00049650: 666f 726d 2873 656c 6629 3a0d 0a20 2020  form(self):..   
+00049660: 2020 2020 2069 6620 7365 6c66 2e76 6965       if self.vie
+00049670: 7762 6f78 2069 7320 4e6f 6e65 3a0d 0a20  wbox is None:.. 
+00049680: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00049690: 6e20 2222 0d0a 2020 2020 2020 2020 7265  n ""..        re
+000496a0: 7475 726e 2073 656c 662e 7669 6577 626f  turn self.viewbo
+000496b0: 782e 7472 616e 7366 6f72 6d28 7365 6c66  x.transform(self
+000496c0: 290d 0a0d 0a20 2020 2064 6566 206c 6f61  )....    def loa
+000496d0: 6428 7365 6c66 2c20 6469 7265 6374 6f72  d(self, director
+000496e0: 793d 4e6f 6e65 293a 0d0a 2020 2020 2020  y=None):..      
+000496f0: 2020 7472 793a 0d0a 2020 2020 2020 2020    try:..        
+00049700: 2020 2020 6672 6f6d 2050 494c 2069 6d70      from PIL imp
+00049710: 6f72 7420 496d 6167 6520 6173 2050 494c  ort Image as PIL
+00049720: 496d 6167 650d 0a0d 0a20 2020 2020 2020  Image....       
+00049730: 2020 2020 2069 6620 7365 6c66 2e64 6174       if self.dat
+00049740: 6120 6973 206e 6f74 204e 6f6e 653a 0d0a  a is not None:..
+00049750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049760: 7365 6c66 2e6c 6f61 645f 6461 7461 2829  self.load_data()
+00049770: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
+00049780: 6966 2073 656c 662e 7572 6c20 6973 206e  if self.url is n
+00049790: 6f74 204e 6f6e 653a 0d0a 2020 2020 2020  ot None:..      
+000497a0: 2020 2020 2020 2020 2020 7365 6c66 2e6c            self.l
+000497b0: 6f61 645f 6669 6c65 2864 6972 6563 746f  oad_file(directo
+000497c0: 7279 290d 0a20 2020 2020 2020 2020 2020  ry)..           
+000497d0: 2073 656c 662e 7365 745f 7661 6c75 6573   self.set_values
+000497e0: 5f62 795f 696d 6167 6528 290d 0a20 2020  _by_image()..   
+000497f0: 2020 2020 2065 7863 6570 7420 496d 706f       except Impo
+00049800: 7274 4572 726f 723a 0d0a 2020 2020 2020  rtError:..      
+00049810: 2020 2020 2020 7061 7373 0d0a 0d0a 2020        pass....  
+00049820: 2020 6465 6620 6c6f 6164 5f64 6174 6128    def load_data(
+00049830: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
+00049840: 7472 793a 0d0a 2020 2020 2020 2020 2020  try:..          
+00049850: 2020 2320 5468 6973 2063 6f64 6520 7769    # This code wi
+00049860: 6c6c 206e 6f74 2061 6374 6976 6174 6520  ll not activate 
+00049870: 7769 7468 6f75 7420 5049 4c2f 5069 6c6c  without PIL/Pill
+00049880: 6f77 2069 6e73 7461 6c6c 6564 2e0d 0a20  ow installed... 
+00049890: 2020 2020 2020 2020 2020 2066 726f 6d20             from 
+000498a0: 5049 4c20 696d 706f 7274 2049 6d61 6765  PIL import Image
+000498b0: 2061 7320 5049 4c49 6d61 6765 0d0a 0d0a   as PILImage....
+000498c0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+000498d0: 656c 662e 6461 7461 2069 7320 6e6f 7420  elf.data is not 
+000498e0: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
+000498f0: 2020 2020 2020 2066 726f 6d20 696f 2069         from io i
+00049900: 6d70 6f72 7420 4279 7465 7349 4f0d 0a0d  mport BytesIO...
+00049910: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00049920: 2073 656c 662e 696d 6167 6520 3d20 5049   self.image = PI
+00049930: 4c49 6d61 6765 2e6f 7065 6e28 4279 7465  LImage.open(Byte
+00049940: 7349 4f28 7365 6c66 2e64 6174 6129 290d  sIO(self.data)).
+00049950: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+00049960: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00049970: 2020 2020 7265 7475 726e 0d0a 2020 2020      return..    
+00049980: 2020 2020 6578 6365 7074 2049 6d70 6f72      except Impor
+00049990: 7445 7272 6f72 3a0d 0a20 2020 2020 2020  tError:..       
+000499a0: 2020 2020 2023 2050 494c 2f50 696c 6c6f       # PIL/Pillo
+000499b0: 7720 6e6f 7420 666f 756e 642c 2064 6563  w not found, dec
+000499c0: 6f64 696e 6720 6461 7461 2069 7320 6d6f  oding data is mo
+000499d0: 7374 2077 6520 6361 6e20 646f 2e0d 0a20  st we can do... 
+000499e0: 2020 2020 2020 2020 2020 2070 6173 730d             pass.
+000499f0: 0a0d 0a20 2020 2064 6566 206c 6f61 645f  ...    def load_
+00049a00: 6669 6c65 2873 656c 662c 2064 6972 6563  file(self, direc
+00049a10: 746f 7279 293a 0d0a 2020 2020 2020 2020  tory):..        
+00049a20: 7472 793a 0d0a 2020 2020 2020 2020 2020  try:..          
+00049a30: 2020 2320 5468 6973 2063 6f64 6520 7769    # This code wi
+00049a40: 6c6c 206e 6f74 2061 6374 6976 6174 6520  ll not activate 
+00049a50: 7769 7468 6f75 7420 5049 4c2f 5069 6c6c  without PIL/Pill
+00049a60: 6f77 2069 6e73 7461 6c6c 6564 2e0d 0a20  ow installed... 
+00049a70: 2020 2020 2020 2020 2020 2066 726f 6d20             from 
+00049a80: 5049 4c20 696d 706f 7274 2049 6d61 6765  PIL import Image
+00049a90: 2061 7320 5049 4c49 6d61 6765 0d0a 0d0a   as PILImage....
+00049aa0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+00049ab0: 656c 662e 7572 6c20 6973 206e 6f74 204e  elf.url is not N
+00049ac0: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
+00049ad0: 2020 2020 2020 7472 793a 0d0a 2020 2020        try:..    
+00049ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049af0: 7365 6c66 2e69 6d61 6765 203d 2050 494c  self.image = PIL
+00049b00: 496d 6167 652e 6f70 656e 2873 656c 662e  Image.open(self.
+00049b10: 7572 6c29 0d0a 2020 2020 2020 2020 2020  url)..          
+00049b20: 2020 2020 2020 6578 6365 7074 2049 4f45        except IOE
+00049b30: 7272 6f72 3a0d 0a20 2020 2020 2020 2020  rror:..         
+00049b40: 2020 2020 2020 2020 2020 2074 7279 3a0d             try:.
+00049b50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00049b60: 2020 2020 2020 2020 2069 6620 6469 7265           if dire
+00049b70: 6374 6f72 7920 6973 206e 6f74 204e 6f6e  ctory is not Non
+00049b80: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00049b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049ba0: 6672 6f6d 206f 732e 7061 7468 2069 6d70  from os.path imp
+00049bb0: 6f72 7420 6a6f 696e 0d0a 0d0a 2020 2020  ort join....    
+00049bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049bd0: 2020 2020 2020 2020 7265 6c70 6174 6820          relpath 
+00049be0: 3d20 6a6f 696e 2864 6972 6563 746f 7279  = join(directory
+00049bf0: 2c20 7365 6c66 2e75 726c 290d 0a20 2020  , self.url)..   
+00049c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049c10: 2020 2020 2020 2020 2073 656c 662e 696d           self.im
+00049c20: 6167 6520 3d20 5049 4c49 6d61 6765 2e6f  age = PILImage.o
+00049c30: 7065 6e28 7265 6c70 6174 6829 0d0a 2020  pen(relpath)..  
+00049c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049c50: 2020 6578 6365 7074 2049 4f45 7272 6f72    except IOError
+00049c60: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00049c70: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00049c80: 6e0d 0a20 2020 2020 2020 2065 7863 6570  n..        excep
+00049c90: 7420 496d 706f 7274 4572 726f 723a 0d0a  t ImportError:..
+00049ca0: 2020 2020 2020 2020 2020 2020 2320 5049              # PI
+00049cb0: 4c2f 5069 6c6c 6f77 206e 6f74 2066 6f75  L/Pillow not fou
+00049cc0: 6e64 2c20 6465 636f 6469 6e67 2064 6174  nd, decoding dat
+00049cd0: 6120 6973 206d 6f73 7420 7765 2063 616e  a is most we can
+00049ce0: 2064 6f2e 0d0a 2020 2020 2020 2020 2020   do...          
+00049cf0: 2020 7061 7373 0d0a 0d0a 2020 2020 6465    pass....    de
+00049d00: 6620 7365 745f 7661 6c75 6573 5f62 795f  f set_values_by_
+00049d10: 696d 6167 6528 7365 6c66 293a 0d0a 2020  image(self):..  
+00049d20: 2020 2020 2020 6966 2073 656c 662e 696d        if self.im
+00049d30: 6167 6520 6973 204e 6f6e 653a 0d0a 2020  age is None:..  
+00049d40: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00049d50: 2020 2320 4e6f 2069 6d61 6765 2074 6f20    # No image to 
+00049d60: 7365 7420 7661 6c75 6573 2062 792e 0d0a  set values by...
+00049d70: 2020 2020 2020 2020 7365 6c66 2e69 6d61          self.ima
+00049d80: 6765 5f77 6964 7468 203d 2073 656c 662e  ge_width = self.
+00049d90: 696d 6167 652e 7769 6474 680d 0a20 2020  image.width..   
+00049da0: 2020 2020 2073 656c 662e 696d 6167 655f       self.image_
+00049db0: 6865 6967 6874 203d 2073 656c 662e 696d  height = self.im
+00049dc0: 6167 652e 6865 6967 6874 0d0a 2020 2020  age.height..    
+00049dd0: 2020 2020 7365 6c66 2e76 6965 7762 6f78      self.viewbox
+00049de0: 203d 2056 6965 7762 6f78 280d 0a20 2020   = Viewbox(..   
+00049df0: 2020 2020 2020 2020 2022 3020 3020 2564           "0 0 %d
+00049e00: 2025 6422 2025 2028 7365 6c66 2e69 6d61   %d" % (self.ima
+00049e10: 6765 5f77 6964 7468 2c20 7365 6c66 2e69  ge_width, self.i
+00049e20: 6d61 6765 5f68 6569 6768 7429 2c0d 0a20  mage_height),.. 
+00049e30: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00049e40: 7072 6573 6572 7665 5f61 7370 6563 745f  preserve_aspect_
+00049e50: 7261 7469 6f2c 0d0a 2020 2020 2020 2020  ratio,..        
+00049e60: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00049e70: 7265 6e64 6572 2877 6964 7468 3d73 656c  render(width=sel
+00049e80: 662e 696d 6167 655f 7769 6474 682c 2068  f.image_width, h
+00049e90: 6569 6768 743d 7365 6c66 2e69 6d61 6765  eight=self.image
+00049ea0: 5f68 6569 6768 7429 0d0a 2020 2020 2020  _height)..      
+00049eb0: 2020 7365 6c66 2e74 7261 6e73 666f 726d    self.transform
+00049ec0: 203d 204d 6174 7269 7828 7365 6c66 2e76   = Matrix(self.v
+00049ed0: 6965 7762 6f78 5f74 7261 6e73 666f 726d  iewbox_transform
+00049ee0: 2920 2a20 7365 6c66 2e74 7261 6e73 666f  ) * self.transfo
+00049ef0: 726d 0d0a 0d0a 2020 2020 6465 6620 6262  rm....    def bb
+00049f00: 6f78 2873 656c 662c 2074 7261 6e73 666f  ox(self, transfo
+00049f10: 726d 6564 3d54 7275 652c 2077 6974 685f  rmed=True, with_
+00049f20: 7374 726f 6b65 3d46 616c 7365 293a 0d0a  stroke=False):..
+00049f30: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
+00049f40: 2020 2020 2047 6574 2074 6865 2062 6f75       Get the bou
+00049f50: 6e64 696e 6720 626f 7820 666f 7220 7468  nding box for th
+00049f60: 6520 6769 7665 6e20 696d 6167 6520 6f62  e given image ob
+00049f70: 6a65 6374 0d0a 0d0a 2020 2020 2020 2020  ject....        
+00049f80: 3a70 6172 616d 2074 7261 6e73 666f 726d  :param transform
+00049f90: 6564 3a20 7768 6574 6865 7220 7468 6973  ed: whether this
+00049fa0: 2069 7320 7468 6520 7472 616e 7366 6f72   is the transfor
+00049fb0: 6d65 6420 626f 756e 6473 206f 7220 6465  med bounds or de
+00049fc0: 6661 756c 742e 0d0a 2020 2020 2020 2020  fault...        
+00049fd0: 3a70 6172 616d 2077 6974 685f 7374 726f  :param with_stro
+00049fe0: 6b65 3a20 5468 6572 6520 6973 206e 6f20  ke: There is no 
+00049ff0: 7374 726f 6b65 2066 6f72 2061 6e20 696d  stroke for an im
+0004a000: 6167 6520 736f 2077 6974 685f 7374 726f  age so with_stro
+0004a010: 6b65 2069 7320 6967 6e6f 7265 640d 0a20  ke is ignored.. 
+0004a020: 2020 2020 2020 203a 7265 7475 726e 3a20         :return: 
+0004a030: 626f 756e 6469 6e67 2062 6f78 206f 6620  bounding box of 
+0004a040: 7468 6520 6769 7665 6e20 656c 656d 656e  the given elemen
+0004a050: 740d 0a20 2020 2020 2020 2022 2222 0d0a  t..        """..
+0004a060: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+0004a070: 696d 6167 655f 7769 6474 6820 6973 204e  image_width is N
+0004a080: 6f6e 6520 6f72 2073 656c 662e 696d 6167  one or self.imag
+0004a090: 655f 6865 6967 6874 2069 7320 4e6f 6e65  e_height is None
+0004a0a0: 3a0d 0a20 2020 2020 2020 2020 2020 2070  :..            p
+0004a0b0: 203d 2050 6f69 6e74 2830 2c20 3029 0d0a   = Point(0, 0)..
+0004a0c0: 2020 2020 2020 2020 2020 2020 7020 2a3d              p *=
+0004a0d0: 2073 656c 662e 7472 616e 7366 6f72 6d0d   self.transform.
+0004a0e0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0004a0f0: 7572 6e20 702e 782c 2070 2e79 2c20 702e  urn p.x, p.y, p.
+0004a100: 782c 2070 2e79 0d0a 2020 2020 2020 2020  x, p.y..        
+0004a110: 7769 6474 6820 3d20 7365 6c66 2e69 6d61  width = self.ima
+0004a120: 6765 5f77 6964 7468 0d0a 2020 2020 2020  ge_width..      
+0004a130: 2020 6865 6967 6874 203d 2073 656c 662e    height = self.
+0004a140: 696d 6167 655f 6865 6967 6874 0d0a 0d0a  image_height....
+0004a150: 2020 2020 2020 2020 6966 2074 7261 6e73          if trans
+0004a160: 666f 726d 6564 3a0d 0a20 2020 2020 2020  formed:..       
+0004a170: 2020 2020 2070 203d 2028 0d0a 2020 2020       p = (..    
+0004a180: 2020 2020 2020 2020 2020 2020 506f 696e              Poin
+0004a190: 7428 302c 2030 2920 2a20 7365 6c66 2e74  t(0, 0) * self.t
+0004a1a0: 7261 6e73 666f 726d 2c0d 0a20 2020 2020  ransform,..     
+0004a1b0: 2020 2020 2020 2020 2020 2050 6f69 6e74             Point
+0004a1c0: 2877 6964 7468 2c20 3029 202a 2073 656c  (width, 0) * sel
+0004a1d0: 662e 7472 616e 7366 6f72 6d2c 0d0a 2020  f.transform,..  
+0004a1e0: 2020 2020 2020 2020 2020 2020 2020 506f                Po
+0004a1f0: 696e 7428 7769 6474 682c 2068 6569 6768  int(width, heigh
+0004a200: 7429 202a 2073 656c 662e 7472 616e 7366  t) * self.transf
+0004a210: 6f72 6d2c 0d0a 2020 2020 2020 2020 2020  orm,..          
+0004a220: 2020 2020 2020 506f 696e 7428 302c 2068        Point(0, h
+0004a230: 6569 6768 7429 202a 2073 656c 662e 7472  eight) * self.tr
+0004a240: 616e 7366 6f72 6d2c 0d0a 2020 2020 2020  ansform,..      
+0004a250: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
+0004a260: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+0004a270: 2020 2020 7020 3d20 2850 6f69 6e74 2830      p = (Point(0
+0004a280: 2c20 3029 2c20 506f 696e 7428 7769 6474  , 0), Point(widt
+0004a290: 682c 2030 292c 2050 6f69 6e74 2877 6964  h, 0), Point(wid
+0004a2a0: 7468 2c20 6865 6967 6874 292c 2050 6f69  th, height), Poi
+0004a2b0: 6e74 2830 2c20 6865 6967 6874 2929 0d0a  nt(0, height))..
+0004a2c0: 2020 2020 2020 2020 785f 7661 6c73 203d          x_vals =
+0004a2d0: 206c 6973 7428 732e 7820 666f 7220 7320   list(s.x for s 
+0004a2e0: 696e 2070 290d 0a20 2020 2020 2020 2079  in p)..        y
+0004a2f0: 5f76 616c 7320 3d20 6c69 7374 2873 2e79  _vals = list(s.y
+0004a300: 2066 6f72 2073 2069 6e20 7029 0d0a 2020   for s in p)..  
+0004a310: 2020 2020 2020 6d69 6e5f 7820 3d20 6d69        min_x = mi
+0004a320: 6e28 785f 7661 6c73 290d 0a20 2020 2020  n(x_vals)..     
+0004a330: 2020 206d 696e 5f79 203d 206d 696e 2879     min_y = min(y
+0004a340: 5f76 616c 7329 0d0a 2020 2020 2020 2020  _vals)..        
+0004a350: 6d61 785f 7820 3d20 6d61 7828 785f 7661  max_x = max(x_va
+0004a360: 6c73 290d 0a20 2020 2020 2020 206d 6178  ls)..        max
+0004a370: 5f79 203d 206d 6178 2879 5f76 616c 7329  _y = max(y_vals)
+0004a380: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+0004a390: 206d 696e 5f78 2c20 6d69 6e5f 792c 206d   min_x, min_y, m
+0004a3a0: 6178 5f78 2c20 6d61 785f 790d 0a0d 0a0d  ax_x, max_y.....
+0004a3b0: 0a53 5647 496d 6167 6520 3d20 496d 6167  .SVGImage = Imag
+0004a3c0: 650d 0a0d 0a0d 0a63 6c61 7373 2044 6573  e......class Des
+0004a3d0: 6328 5356 4745 6c65 6d65 6e74 293a 0d0a  c(SVGElement):..
+0004a3e0: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
+0004a3f0: 2873 656c 662c 202a 6172 6773 2c20 2a2a  (self, *args, **
+0004a400: 7661 6c75 6573 293a 0d0a 2020 2020 2020  values):..      
+0004a410: 2020 7365 6c66 2e64 6573 6320 3d20 4e6f    self.desc = No
+0004a420: 6e65 0d0a 2020 2020 2020 2020 6966 2076  ne..        if v
+0004a430: 616c 7565 7320 6973 204e 6f6e 653a 0d0a  alues is None:..
+0004a440: 2020 2020 2020 2020 2020 2020 7661 6c75              valu
+0004a450: 6573 203d 2064 6963 7428 290d 0a20 2020  es = dict()..   
+0004a460: 2020 2020 2053 5647 456c 656d 656e 742e       SVGElement.
+0004a470: 5f5f 696e 6974 5f5f 2873 656c 662c 202a  __init__(self, *
+0004a480: 6172 6773 2c20 2a2a 7661 6c75 6573 290d  args, **values).
+0004a490: 0a0d 0a20 2020 2064 6566 205f 5f65 715f  ...    def __eq_
+0004a4a0: 5f28 7365 6c66 2c20 6f74 6865 7229 3a0d  _(self, other):.
+0004a4b0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+0004a4c0: 6973 696e 7374 616e 6365 286f 7468 6572  isinstance(other
+0004a4d0: 2c20 4465 7363 293a 0d0a 2020 2020 2020  , Desc):..      
+0004a4e0: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
+0004a4f0: 7365 0d0a 2020 2020 2020 2020 7265 7475  se..        retu
+0004a500: 726e 2073 656c 662e 6465 7363 203d 3d20  rn self.desc == 
+0004a510: 6f74 6865 722e 6465 7363 0d0a 0d0a 2020  other.desc....  
+0004a520: 2020 6465 6620 5f5f 7265 7072 5f5f 2873    def __repr__(s
+0004a530: 656c 6629 3a0d 0a20 2020 2020 2020 2072  elf):..        r
+0004a540: 6574 7572 6e20 2225 7328 2725 7327 2922  eturn "%s('%s')"
+0004a550: 2025 2028 7365 6c66 2e5f 5f63 6c61 7373   % (self.__class
+0004a560: 5f5f 2e5f 5f6e 616d 655f 5f2c 2073 656c  __.__name__, sel
+0004a570: 662e 6465 7363 290d 0a0d 0a20 2020 2064  f.desc)....    d
+0004a580: 6566 2070 726f 7065 7274 795f 6279 5f61  ef property_by_a
+0004a590: 7267 7328 7365 6c66 2c20 2a61 7267 7329  rgs(self, *args)
+0004a5a0: 3a0d 0a20 2020 2020 2020 2069 6620 6c65  :..        if le
+0004a5b0: 6e28 6172 6773 2920 3d3d 2031 3a0d 0a20  n(args) == 1:.. 
+0004a5c0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0004a5d0: 6465 7363 203d 2061 7267 735b 305d 0d0a  desc = args[0]..
+0004a5e0: 0d0a 2020 2020 6465 6620 7072 6f70 6572  ..    def proper
+0004a5f0: 7479 5f62 795f 6f62 6a65 6374 2873 656c  ty_by_object(sel
+0004a600: 662c 206f 626a 293a 0d0a 2020 2020 2020  f, obj):..      
+0004a610: 2020 5356 4745 6c65 6d65 6e74 2e70 726f    SVGElement.pro
+0004a620: 7065 7274 795f 6279 5f6f 626a 6563 7428  perty_by_object(
+0004a630: 7365 6c66 2c20 6f62 6a29 0d0a 2020 2020  self, obj)..    
+0004a640: 2020 2020 7365 6c66 2e64 6573 6320 3d20      self.desc = 
+0004a650: 6f62 6a2e 6465 7363 0d0a 0d0a 2020 2020  obj.desc....    
+0004a660: 6465 6620 7072 6f70 6572 7479 5f62 795f  def property_by_
+0004a670: 7661 6c75 6573 2873 656c 662c 2076 616c  values(self, val
+0004a680: 7565 7329 3a0d 0a20 2020 2020 2020 2053  ues):..        S
+0004a690: 5647 456c 656d 656e 742e 7072 6f70 6572  VGElement.proper
+0004a6a0: 7479 5f62 795f 7661 6c75 6573 2873 656c  ty_by_values(sel
+0004a6b0: 662c 2076 616c 7565 7329 0d0a 2020 2020  f, values)..    
+0004a6c0: 2020 2020 6966 2053 5647 5f54 4147 5f44      if SVG_TAG_D
+0004a6d0: 4553 4320 696e 2076 616c 7565 733a 0d0a  ESC in values:..
+0004a6e0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0004a6f0: 2e64 6573 6320 3d20 7661 6c75 6573 5b53  .desc = values[S
+0004a700: 5647 5f54 4147 5f44 4553 435d 0d0a 0d0a  VG_TAG_DESC]....
+0004a710: 0d0a 5356 4744 6573 6320 3d20 4465 7363  ..SVGDesc = Desc
+0004a720: 0d0a 0d0a 0d0a 636c 6173 7320 5469 746c  ......class Titl
+0004a730: 6528 5356 4745 6c65 6d65 6e74 293a 0d0a  e(SVGElement):..
+0004a740: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
+0004a750: 2873 656c 662c 202a 6172 6773 2c20 2a2a  (self, *args, **
+0004a760: 7661 6c75 6573 293a 0d0a 2020 2020 2020  values):..      
+0004a770: 2020 7365 6c66 2e74 6974 6c65 203d 204e    self.title = N
+0004a780: 6f6e 650d 0a20 2020 2020 2020 2069 6620  one..        if 
+0004a790: 7661 6c75 6573 2069 7320 4e6f 6e65 3a0d  values is None:.
+0004a7a0: 0a20 2020 2020 2020 2020 2020 2076 616c  .            val
+0004a7b0: 7565 7320 3d20 6469 6374 2829 0d0a 2020  ues = dict()..  
+0004a7c0: 2020 2020 2020 5356 4745 6c65 6d65 6e74        SVGElement
+0004a7d0: 2e5f 5f69 6e69 745f 5f28 7365 6c66 2c20  .__init__(self, 
+0004a7e0: 2a61 7267 732c 202a 2a76 616c 7565 7329  *args, **values)
+0004a7f0: 0d0a 0d0a 2020 2020 6465 6620 5f5f 6571  ....    def __eq
+0004a800: 5f5f 2873 656c 662c 206f 7468 6572 293a  __(self, other):
+0004a810: 0d0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
+0004a820: 2069 7369 6e73 7461 6e63 6528 6f74 6865   isinstance(othe
+0004a830: 722c 2054 6974 6c65 293a 0d0a 2020 2020  r, Title):..    
+0004a840: 2020 2020 2020 2020 7265 7475 726e 2046          return F
+0004a850: 616c 7365 0d0a 2020 2020 2020 2020 7265  alse..        re
+0004a860: 7475 726e 2073 656c 662e 7469 746c 6520  turn self.title 
+0004a870: 3d3d 206f 7468 6572 2e74 6974 6c65 0d0a  == other.title..
+0004a880: 0d0a 2020 2020 6465 6620 5f5f 7265 7072  ..    def __repr
+0004a890: 5f5f 2873 656c 6629 3a0d 0a20 2020 2020  __(self):..     
+0004a8a0: 2020 2072 6574 7572 6e20 2225 7328 2725     return "%s('%
+0004a8b0: 7327 2922 2025 2028 7365 6c66 2e5f 5f63  s')" % (self.__c
+0004a8c0: 6c61 7373 5f5f 2e5f 5f6e 616d 655f 5f2c  lass__.__name__,
+0004a8d0: 2073 656c 662e 7469 746c 6529 0d0a 0d0a   self.title)....
+0004a8e0: 2020 2020 6465 6620 7072 6f70 6572 7479      def property
+0004a8f0: 5f62 795f 6172 6773 2873 656c 662c 202a  _by_args(self, *
+0004a900: 6172 6773 293a 0d0a 2020 2020 2020 2020  args):..        
+0004a910: 6966 206c 656e 2861 7267 7329 203d 3d20  if len(args) == 
+0004a920: 313a 0d0a 2020 2020 2020 2020 2020 2020  1:..            
+0004a930: 7365 6c66 2e74 6974 6c65 203d 2061 7267  self.title = arg
+0004a940: 735b 305d 0d0a 0d0a 2020 2020 6465 6620  s[0]....    def 
+0004a950: 7072 6f70 6572 7479 5f62 795f 6f62 6a65  property_by_obje
+0004a960: 6374 2873 656c 662c 206f 626a 293a 0d0a  ct(self, obj):..
+0004a970: 2020 2020 2020 2020 5356 4745 6c65 6d65          SVGEleme
+0004a980: 6e74 2e70 726f 7065 7274 795f 6279 5f6f  nt.property_by_o
+0004a990: 626a 6563 7428 7365 6c66 2c20 6f62 6a29  bject(self, obj)
+0004a9a0: 0d0a 2020 2020 2020 2020 7365 6c66 2e74  ..        self.t
+0004a9b0: 6974 6c65 203d 206f 626a 2e74 6974 6c65  itle = obj.title
+0004a9c0: 0d0a 0d0a 2020 2020 6465 6620 7072 6f70  ....    def prop
+0004a9d0: 6572 7479 5f62 795f 7661 6c75 6573 2873  erty_by_values(s
+0004a9e0: 656c 662c 2076 616c 7565 7329 3a0d 0a20  elf, values):.. 
+0004a9f0: 2020 2020 2020 2053 5647 456c 656d 656e         SVGElemen
+0004aa00: 742e 7072 6f70 6572 7479 5f62 795f 7661  t.property_by_va
+0004aa10: 6c75 6573 2873 656c 662c 2076 616c 7565  lues(self, value
+0004aa20: 7329 0d0a 2020 2020 2020 2020 6966 2053  s)..        if S
+0004aa30: 5647 5f54 4147 5f54 4954 4c45 2069 6e20  VG_TAG_TITLE in 
+0004aa40: 7661 6c75 6573 3a0d 0a20 2020 2020 2020  values:..       
+0004aa50: 2020 2020 2073 656c 662e 7469 746c 6520       self.title 
+0004aa60: 3d20 7661 6c75 6573 5b53 5647 5f54 4147  = values[SVG_TAG
+0004aa70: 5f54 4954 4c45 5d0d 0a0d 0a0d 0a63 6c61  _TITLE]......cla
+0004aa80: 7373 2053 5647 2847 726f 7570 293a 0d0a  ss SVG(Group):..
+0004aa90: 2020 2020 2222 220d 0a20 2020 2053 5647      """..    SVG
+0004aaa0: 2044 6f63 756d 656e 7420 616e 6420 5061   Document and Pa
+0004aab0: 7273 696e 672e 0d0a 0d0a 2020 2020 5356  rsing.....    SV
+0004aac0: 4720 6973 2074 6865 2053 5647 206d 6169  G is the SVG mai
+0004aad0: 6e20 6f62 6a65 6374 2061 6e64 2061 6c73  n object and als
+0004aae0: 6f20 7468 6520 656d 6265 6464 6564 2053  o the embedded S
+0004aaf0: 5647 7320 7769 7468 696e 2069 742e 2049  VGs within it. I
+0004ab00: 7427 7320 6120 7375 6274 7970 6520 6f66  t's a subtype of
+0004ab10: 2047 726f 7570 2e20 5468 6520 5356 4720   Group. The SVG 
+0004ab20: 6861 7320 6120 7669 6577 626f 782c 0d0a  has a viewbox,..
+0004ab30: 2020 2020 616e 6420 7061 7273 696e 6720      and parsing 
+0004ab40: 6d65 7468 6f64 7320 7768 6963 6820 6361  methods which ca
+0004ab50: 6e20 6265 2075 7365 6420 6966 2067 6976  n be used if giv
+0004ab60: 656e 2061 2073 7472 6561 6d2c 2070 6174  en a stream, pat
+0004ab70: 682c 206f 7220 7376 6720 7374 7269 6e67  h, or svg string
+0004ab80: 2e0d 0a20 2020 2022 2222 0d0a 0d0a 2020  ...    """....  
+0004ab90: 2020 6465 6620 5f5f 696e 6974 5f5f 2873    def __init__(s
+0004aba0: 656c 662c 202a 6172 6773 2c20 2a2a 6b77  elf, *args, **kw
+0004abb0: 6172 6773 293a 0d0a 2020 2020 2020 2020  args):..        
+0004abc0: 7365 6c66 2e6f 626a 6563 7473 203d 207b  self.objects = {
+0004abd0: 7d0d 0a20 2020 2020 2020 2073 656c 662e  }..        self.
+0004abe0: 7820 3d20 4e6f 6e65 0d0a 2020 2020 2020  x = None..      
+0004abf0: 2020 7365 6c66 2e79 203d 204e 6f6e 650d    self.y = None.
+0004ac00: 0a20 2020 2020 2020 2073 656c 662e 7769  .        self.wi
+0004ac10: 6474 6820 3d20 4e6f 6e65 0d0a 2020 2020  dth = None..    
+0004ac20: 2020 2020 7365 6c66 2e68 6569 6768 7420      self.height 
+0004ac30: 3d20 4e6f 6e65 0d0a 2020 2020 2020 2020  = None..        
+0004ac40: 7365 6c66 2e76 6965 7762 6f78 203d 204e  self.viewbox = N
+0004ac50: 6f6e 650d 0a20 2020 2020 2020 2047 726f  one..        Gro
+0004ac60: 7570 2e5f 5f69 6e69 745f 5f28 7365 6c66  up.__init__(self
+0004ac70: 2c20 2a61 7267 732c 202a 2a6b 7761 7267  , *args, **kwarg
+0004ac80: 7329 0d0a 0d0a 2020 2020 4070 726f 7065  s)....    @prope
+0004ac90: 7274 790d 0a20 2020 2064 6566 2069 6d70  rty..    def imp
+0004aca0: 6c69 6369 745f 706f 7369 7469 6f6e 2873  licit_position(s
+0004acb0: 656c 6629 3a0d 0a20 2020 2020 2020 2069  elf):..        i
+0004acc0: 6620 6e6f 7420 7365 6c66 2e61 7070 6c79  f not self.apply
+0004acd0: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
+0004ace0: 6574 7572 6e20 506f 696e 7428 7365 6c66  eturn Point(self
+0004acf0: 2e78 2c20 7365 6c66 2e79 290d 0a20 2020  .x, self.y)..   
+0004ad00: 2020 2020 2070 6f69 6e74 203d 2050 6f69       point = Poi
+0004ad10: 6e74 2873 656c 662e 782c 2073 656c 662e  nt(self.x, self.
+0004ad20: 7929 0d0a 2020 2020 2020 2020 706f 696e  y)..        poin
+0004ad30: 7420 2a3d 2073 656c 662e 7472 616e 7366  t *= self.transf
+0004ad40: 6f72 6d0d 0a20 2020 2020 2020 2072 6574  orm..        ret
+0004ad50: 7572 6e20 706f 696e 740d 0a0d 0a20 2020  urn point....   
+0004ad60: 2040 7072 6f70 6572 7479 0d0a 2020 2020   @property..    
+0004ad70: 6465 6620 696d 706c 6963 6974 5f78 2873  def implicit_x(s
+0004ad80: 656c 6629 3a0d 0a20 2020 2020 2020 2069  elf):..        i
+0004ad90: 6620 6e6f 7420 7365 6c66 2e61 7070 6c79  f not self.apply
+0004ada0: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
+0004adb0: 6574 7572 6e20 7365 6c66 2e78 0d0a 2020  eturn self.x..  
+0004adc0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+0004add0: 662e 696d 706c 6963 6974 5f70 6f73 6974  f.implicit_posit
+0004ade0: 696f 6e5b 305d 0d0a 0d0a 2020 2020 4070  ion[0]....    @p
+0004adf0: 726f 7065 7274 790d 0a20 2020 2064 6566  roperty..    def
+0004ae00: 2069 6d70 6c69 6369 745f 7928 7365 6c66   implicit_y(self
+0004ae10: 293a 0d0a 2020 2020 2020 2020 6966 206e  ):..        if n
+0004ae20: 6f74 2073 656c 662e 6170 706c 793a 0d0a  ot self.apply:..
+0004ae30: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0004ae40: 726e 2073 656c 662e 790d 0a20 2020 2020  rn self.y..     
+0004ae50: 2020 2072 6574 7572 6e20 7365 6c66 2e69     return self.i
+0004ae60: 6d70 6c69 6369 745f 706f 7369 7469 6f6e  mplicit_position
+0004ae70: 5b31 5d0d 0a0d 0a20 2020 2040 7072 6f70  [1]....    @prop
+0004ae80: 6572 7479 0d0a 2020 2020 6465 6620 696d  erty..    def im
+0004ae90: 706c 6963 6974 5f77 6964 7468 2873 656c  plicit_width(sel
+0004aea0: 6629 3a0d 0a20 2020 2020 2020 2069 6620  f):..        if 
+0004aeb0: 6e6f 7420 7365 6c66 2e61 7070 6c79 3a0d  not self.apply:.
+0004aec0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0004aed0: 7572 6e20 7365 6c66 2e77 6964 7468 0d0a  urn self.width..
+0004aee0: 2020 2020 2020 2020 7020 3d20 506f 696e          p = Poin
+0004aef0: 7428 7365 6c66 2e77 6964 7468 2c20 3029  t(self.width, 0)
+0004af00: 0d0a 2020 2020 2020 2020 7020 2a3d 2073  ..        p *= s
+0004af10: 656c 662e 7472 616e 7366 6f72 6d0d 0a20  elf.transform.. 
+0004af20: 2020 2020 2020 206f 7269 6769 6e20 3d20         origin = 
+0004af30: 506f 696e 7428 302c 2030 290d 0a20 2020  Point(0, 0)..   
+0004af40: 2020 2020 206f 7269 6769 6e20 2a3d 2073       origin *= s
+0004af50: 656c 662e 7472 616e 7366 6f72 6d0d 0a20  elf.transform.. 
+0004af60: 2020 2020 2020 2072 6574 7572 6e20 6f72         return or
+0004af70: 6967 696e 2e64 6973 7461 6e63 655f 746f  igin.distance_to
+0004af80: 2870 290d 0a0d 0a20 2020 2040 7072 6f70  (p)....    @prop
+0004af90: 6572 7479 0d0a 2020 2020 6465 6620 696d  erty..    def im
+0004afa0: 706c 6963 6974 5f68 6569 6768 7428 7365  plicit_height(se
+0004afb0: 6c66 293a 0d0a 2020 2020 2020 2020 6966  lf):..        if
+0004afc0: 206e 6f74 2073 656c 662e 6170 706c 793a   not self.apply:
+0004afd0: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+0004afe0: 7475 726e 2073 656c 662e 6865 6967 6874  turn self.height
+0004aff0: 0d0a 2020 2020 2020 2020 7020 3d20 506f  ..        p = Po
+0004b000: 696e 7428 302c 2073 656c 662e 6865 6967  int(0, self.heig
+0004b010: 6874 290d 0a20 2020 2020 2020 2070 202a  ht)..        p *
+0004b020: 3d20 7365 6c66 2e74 7261 6e73 666f 726d  = self.transform
+0004b030: 0d0a 2020 2020 2020 2020 6f72 6967 696e  ..        origin
+0004b040: 203d 2050 6f69 6e74 2830 2c20 3029 0d0a   = Point(0, 0)..
+0004b050: 2020 2020 2020 2020 6f72 6967 696e 202a          origin *
+0004b060: 3d20 7365 6c66 2e74 7261 6e73 666f 726d  = self.transform
+0004b070: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+0004b080: 206f 7269 6769 6e2e 6469 7374 616e 6365   origin.distance
+0004b090: 5f74 6f28 7029 0d0a 0d0a 2020 2020 6465  _to(p)....    de
+0004b0a0: 6620 7072 6f70 6572 7479 5f62 795f 6f62  f property_by_ob
+0004b0b0: 6a65 6374 2873 656c 662c 2073 293a 0d0a  ject(self, s):..
+0004b0c0: 2020 2020 2020 2020 4772 6f75 702e 7072          Group.pr
+0004b0d0: 6f70 6572 7479 5f62 795f 6f62 6a65 6374  operty_by_object
+0004b0e0: 2873 656c 662c 2073 290d 0a20 2020 2020  (self, s)..     
+0004b0f0: 2020 2073 656c 662e 7820 3d20 732e 780d     self.x = s.x.
+0004b100: 0a20 2020 2020 2020 2073 656c 662e 7920  .        self.y 
+0004b110: 3d20 732e 790d 0a20 2020 2020 2020 2073  = s.y..        s
+0004b120: 656c 662e 7769 6474 6820 3d20 732e 7769  elf.width = s.wi
+0004b130: 6474 680d 0a20 2020 2020 2020 2073 656c  dth..        sel
+0004b140: 662e 6865 6967 6874 203d 2073 2e68 6569  f.height = s.hei
+0004b150: 6768 740d 0a20 2020 2020 2020 2073 656c  ght..        sel
+0004b160: 662e 7669 6577 626f 7820 3d20 5669 6577  f.viewbox = View
+0004b170: 626f 7828 732e 7669 6577 626f 7829 2069  box(s.viewbox) i
+0004b180: 6620 732e 7669 6577 626f 7820 6973 206e  f s.viewbox is n
+0004b190: 6f74 204e 6f6e 6520 656c 7365 204e 6f6e  ot None else Non
+0004b1a0: 650d 0a0d 0a20 2020 2064 6566 2070 726f  e....    def pro
+0004b1b0: 7065 7274 795f 6279 5f76 616c 7565 7328  perty_by_values(
+0004b1c0: 7365 6c66 2c20 7661 6c75 6573 293a 0d0a  self, values):..
+0004b1d0: 2020 2020 2020 2020 4772 6f75 702e 7072          Group.pr
+0004b1e0: 6f70 6572 7479 5f62 795f 7661 6c75 6573  operty_by_values
+0004b1f0: 2873 656c 662c 2076 616c 7565 7329 0d0a  (self, values)..
+0004b200: 2020 2020 2020 2020 7365 6c66 2e78 203d          self.x =
+0004b210: 204c 656e 6774 6828 7661 6c75 6573 2e67   Length(values.g
+0004b220: 6574 2853 5647 5f41 5454 525f 582c 2030  et(SVG_ATTR_X, 0
+0004b230: 2929 2e76 616c 7565 2829 0d0a 2020 2020  )).value()..    
+0004b240: 2020 2020 7365 6c66 2e79 203d 204c 656e      self.y = Len
+0004b250: 6774 6828 7661 6c75 6573 2e67 6574 2853  gth(values.get(S
+0004b260: 5647 5f41 5454 525f 592c 2030 2929 2e76  VG_ATTR_Y, 0)).v
+0004b270: 616c 7565 2829 0d0a 2020 2020 2020 2020  alue()..        
+0004b280: 7365 6c66 2e77 6964 7468 203d 204c 656e  self.width = Len
+0004b290: 6774 6828 7661 6c75 6573 2e67 6574 2853  gth(values.get(S
+0004b2a0: 5647 5f41 5454 525f 5749 4454 482c 2022  VG_ATTR_WIDTH, "
+0004b2b0: 3130 3025 2229 292e 7661 6c75 6528 290d  100%")).value().
+0004b2c0: 0a20 2020 2020 2020 2073 656c 662e 6865  .        self.he
+0004b2d0: 6967 6874 203d 204c 656e 6774 6828 7661  ight = Length(va
+0004b2e0: 6c75 6573 2e67 6574 2853 5647 5f41 5454  lues.get(SVG_ATT
+0004b2f0: 525f 4845 4947 4854 2c20 2231 3030 2522  R_HEIGHT, "100%"
+0004b300: 2929 2e76 616c 7565 2829 0d0a 2020 2020  )).value()..    
+0004b310: 2020 2020 7669 6577 626f 7820 3d20 7661      viewbox = va
+0004b320: 6c75 6573 2e67 6574 2853 5647 5f41 5454  lues.get(SVG_ATT
+0004b330: 525f 5649 4557 424f 5829 0d0a 2020 2020  R_VIEWBOX)..    
+0004b340: 2020 2020 7061 7220 3d20 7661 6c75 6573      par = values
+0004b350: 2e67 6574 2853 5647 5f41 5454 525f 5052  .get(SVG_ATTR_PR
+0004b360: 4553 4552 5645 4153 5045 4354 5241 5449  ESERVEASPECTRATI
+0004b370: 4f29 0d0a 2020 2020 2020 2020 7365 6c66  O)..        self
+0004b380: 2e76 6965 7762 6f78 203d 2056 6965 7762  .viewbox = Viewb
+0004b390: 6f78 2876 6965 7762 6f78 2c20 7061 7229  ox(viewbox, par)
+0004b3a0: 2069 6620 7669 6577 626f 7820 6973 206e   if viewbox is n
+0004b3b0: 6f74 204e 6f6e 6520 656c 7365 204e 6f6e  ot None else Non
+0004b3c0: 650d 0a0d 0a20 2020 2064 6566 2067 6574  e....    def get
+0004b3d0: 5f65 6c65 6d65 6e74 5f62 795f 6964 2873  _element_by_id(s
+0004b3e0: 656c 662c 2069 6429 3a0d 0a20 2020 2020  elf, id):..     
+0004b3f0: 2020 2072 6574 7572 6e20 7365 6c66 2e6f     return self.o
+0004b400: 626a 6563 7473 2e67 6574 2869 6429 0d0a  bjects.get(id)..
+0004b410: 0d0a 2020 2020 6465 6620 6765 745f 656c  ..    def get_el
+0004b420: 656d 656e 745f 6279 5f75 726c 2873 656c  ement_by_url(sel
+0004b430: 662c 2075 726c 293a 0d0a 2020 2020 2020  f, url):..      
+0004b440: 2020 666f 7220 5f69 6420 696e 2052 4547    for _id in REG
+0004b450: 4558 5f49 5249 2e66 696e 6461 6c6c 2875  EX_IRI.findall(u
+0004b460: 726c 293a 0d0a 2020 2020 2020 2020 2020  rl):..          
+0004b470: 2020 7265 7475 726e 2073 656c 662e 6765    return self.ge
+0004b480: 745f 656c 656d 656e 745f 6279 5f69 6428  t_element_by_id(
+0004b490: 5f69 6429 0d0a 0d0a 2020 2020 6465 6620  _id)....    def 
+0004b4a0: 7265 6e64 6572 2873 656c 662c 202a 2a6b  render(self, **k
+0004b4b0: 7761 7267 7329 3a0d 0a20 2020 2020 2020  wargs):..       
+0004b4c0: 2047 726f 7570 2e72 656e 6465 7228 7365   Group.render(se
+0004b4d0: 6c66 2c20 2a2a 6b77 6172 6773 290d 0a20  lf, **kwargs).. 
+0004b4e0: 2020 2020 2020 2077 6964 7468 203d 206b         width = k
+0004b4f0: 7761 7267 732e 6765 7428 2277 6964 7468  wargs.get("width
+0004b500: 222c 206b 7761 7267 732e 6765 7428 2272  ", kwargs.get("r
+0004b510: 656c 6174 6976 655f 6c65 6e67 7468 2229  elative_length")
+0004b520: 290d 0a20 2020 2020 2020 2068 6569 6768  )..        heigh
+0004b530: 7420 3d20 6b77 6172 6773 2e67 6574 2822  t = kwargs.get("
+0004b540: 6865 6967 6874 222c 206b 7761 7267 732e  height", kwargs.
+0004b550: 6765 7428 2272 656c 6174 6976 655f 6c65  get("relative_le
+0004b560: 6e67 7468 2229 290d 0a20 2020 2020 2020  ngth"))..       
+0004b570: 2074 7279 3a0d 0a20 2020 2020 2020 2020   try:..         
+0004b580: 2020 2064 656c 206b 7761 7267 735b 2272     del kwargs["r
+0004b590: 656c 6174 6976 655f 6c65 6e67 7468 225d  elative_length"]
+0004b5a0: 0d0a 2020 2020 2020 2020 6578 6365 7074  ..        except
+0004b5b0: 204b 6579 4572 726f 723a 0d0a 2020 2020   KeyError:..    
+0004b5c0: 2020 2020 2020 2020 7061 7373 0d0a 2020          pass..  
+0004b5d0: 2020 2020 2020 7365 6c66 2e77 6964 7468        self.width
+0004b5e0: 203d 204c 656e 6774 6828 7365 6c66 2e77   = Length(self.w
+0004b5f0: 6964 7468 292e 7661 6c75 6528 7265 6c61  idth).value(rela
+0004b600: 7469 7665 5f6c 656e 6774 683d 7769 6474  tive_length=widt
+0004b610: 682c 202a 2a6b 7761 7267 7329 0d0a 2020  h, **kwargs)..  
+0004b620: 2020 2020 2020 7365 6c66 2e68 6569 6768        self.heigh
+0004b630: 7420 3d20 4c65 6e67 7468 2873 656c 662e  t = Length(self.
+0004b640: 6865 6967 6874 292e 7661 6c75 6528 7265  height).value(re
+0004b650: 6c61 7469 7665 5f6c 656e 6774 683d 6865  lative_length=he
+0004b660: 6967 6874 2c20 2a2a 6b77 6172 6773 290d  ight, **kwargs).
+0004b670: 0a20 2020 2020 2020 2073 656c 662e 7820  .        self.x 
+0004b680: 3d20 4c65 6e67 7468 2873 656c 662e 7829  = Length(self.x)
+0004b690: 2e76 616c 7565 2872 656c 6174 6976 655f  .value(relative_
+0004b6a0: 6c65 6e67 7468 3d77 6964 7468 2c20 2a2a  length=width, **
+0004b6b0: 6b77 6172 6773 290d 0a20 2020 2020 2020  kwargs)..       
+0004b6c0: 2073 656c 662e 7920 3d20 4c65 6e67 7468   self.y = Length
+0004b6d0: 2873 656c 662e 7929 2e76 616c 7565 2872  (self.y).value(r
+0004b6e0: 656c 6174 6976 655f 6c65 6e67 7468 3d68  elative_length=h
+0004b6f0: 6569 6768 742c 202a 2a6b 7761 7267 7329  eight, **kwargs)
+0004b700: 0d0a 0d0a 2020 2020 6465 6620 656c 656d  ....    def elem
+0004b710: 656e 7473 2873 656c 662c 2063 6f6e 6469  ents(self, condi
+0004b720: 7469 6f6e 616c 3d4e 6f6e 6529 3a0d 0a20  tional=None):.. 
+0004b730: 2020 2020 2020 2069 6620 636f 6e64 6974         if condit
+0004b740: 696f 6e61 6c20 6973 204e 6f6e 6520 6f72  ional is None or
+0004b750: 2063 6f6e 6469 7469 6f6e 616c 2873 656c   conditional(sel
+0004b760: 6629 3a0d 0a20 2020 2020 2020 2020 2020  f):..           
+0004b770: 2079 6965 6c64 2073 656c 660d 0a20 2020   yield self..   
+0004b780: 2020 2020 2066 6f72 2071 2069 6e20 7365       for q in se
+0004b790: 6c66 2e73 656c 6563 7428 636f 6e64 6974  lf.select(condit
+0004b7a0: 696f 6e61 6c29 3a0d 0a20 2020 2020 2020  ional):..       
+0004b7b0: 2020 2020 2079 6965 6c64 2071 0d0a 0d0a       yield q....
+0004b7c0: 2020 2020 4070 726f 7065 7274 790d 0a20      @property.. 
+0004b7d0: 2020 2064 6566 2076 6965 7762 6f78 5f74     def viewbox_t
+0004b7e0: 7261 6e73 666f 726d 2873 656c 6629 3a0d  ransform(self):.
+0004b7f0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+0004b800: 2e76 6965 7762 6f78 2069 7320 4e6f 6e65  .viewbox is None
+0004b810: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
+0004b820: 6574 7572 6e20 2222 0d0a 2020 2020 2020  eturn ""..      
+0004b830: 2020 7265 7475 726e 2073 656c 662e 7669    return self.vi
+0004b840: 6577 626f 782e 7472 616e 7366 6f72 6d28  ewbox.transform(
+0004b850: 7365 6c66 290d 0a0d 0a20 2020 2040 7374  self)....    @st
+0004b860: 6174 6963 6d65 7468 6f64 0d0a 2020 2020  aticmethod..    
+0004b870: 6465 6620 5f75 7365 5f73 7472 7563 7475  def _use_structu
+0004b880: 7265 5f70 6172 7365 2873 6f75 7263 6529  re_parse(source)
+0004b890: 3a0d 0a20 2020 2020 2020 2022 2222 0d0a  :..        """..
+0004b8a0: 2020 2020 2020 2020 5356 4720 7374 7275          SVG stru
+0004b8b0: 6374 7572 6520 7061 7373 3a20 7061 7273  cture pass: pars
+0004b8c0: 6573 2074 6865 2073 7667 2066 696c 6520  es the svg file 
+0004b8d0: 7375 6368 2074 6861 7420 6974 2063 7265  such that it cre
+0004b8e0: 6174 6573 2074 6865 2073 7472 7563 7475  ates the structu
+0004b8f0: 7265 2069 6d70 6c69 6564 2062 7920 7265  re implied by re
+0004b900: 7573 6564 206f 626a 6563 7473 2069 6e20  used objects in 
+0004b910: 610d 0a20 2020 2020 2020 2067 656e 6572  a..        gener
+0004b920: 616c 697a 6564 2063 6f6e 7465 7874 2e20  alized context. 
+0004b930: 4f62 6a65 6374 7320 6964 7320 6172 6520  Objects ids are 
+0004b940: 7265 6164 2061 6e64 2070 7574 2069 6e74  read and put int
+0004b950: 6f20 616e 2075 6e70 6172 7365 6420 7368  o an unparsed sh
+0004b960: 6164 6f77 2074 7265 652e 203c 7573 653e  adow tree. <use>
+0004b970: 206f 626a 6563 7473 2073 6561 6d6c 6573   objects seamles
+0004b980: 736c 7920 636f 6e74 6169 6e0d 0a20 2020  sly contain..   
+0004b990: 2020 2020 2074 6865 6972 2064 6566 696e       their defin
+0004b9a0: 6974 696f 6e73 2e0d 0a20 2020 2020 2020  itions...       
+0004b9b0: 2022 2222 0d0a 2020 2020 2020 2020 6576   """..        ev
+0004b9c0: 656e 745f 6465 6673 203d 207b 7d0d 0a20  ent_defs = {}.. 
+0004b9d0: 2020 2020 2020 2070 6172 656e 7420 3d20         parent = 
+0004b9e0: 4e6f 6e65 2020 2320 4465 6669 6e65 2052  None  # Define R
+0004b9f0: 6f6f 7420 4e6f 6465 2e0d 0a20 2020 2020  oot Node...     
+0004ba00: 2020 2063 6869 6c64 7265 6e20 3d20 6c69     children = li
+0004ba10: 7374 2829 0d0a 0d0a 2020 2020 2020 2020  st()....        
+0004ba20: 2320 5072 6570 726f 6365 7373 2069 7465  # Preprocess ite
+0004ba30: 7270 6172 7365 2074 7265 652e 2053 746f  rparse tree. Sto
+0004ba40: 7265 2061 6c6c 2065 7665 6e74 732e 2052  re all events. R
+0004ba50: 6566 6572 656e 6365 2061 6c6c 2074 6167  eference all tag
+0004ba60: 732e 0d0a 2020 2020 2020 2020 666f 7220  s...        for 
+0004ba70: 6576 656e 742c 2065 6c65 6d20 696e 2069  event, elem in i
+0004ba80: 7465 7270 6172 7365 2873 6f75 7263 652c  terparse(source,
+0004ba90: 2065 7665 6e74 733d 2822 7374 6172 7422   events=("start"
+0004baa0: 2c20 2265 6e64 222c 2022 7374 6172 742d  , "end", "start-
+0004bab0: 6e73 2229 293a 0d0a 2020 2020 2020 2020  ns")):..        
+0004bac0: 2020 2020 6966 2065 7665 6e74 203d 3d20      if event == 
+0004bad0: 2273 7461 7274 223a 0d0a 2020 2020 2020  "start":..      
+0004bae0: 2020 2020 2020 2020 2020 7369 626c 696e            siblin
+0004baf0: 6773 203d 2063 6869 6c64 7265 6e20 2023  gs = children  #
+0004bb00: 2050 6172 656e 7427 7320 6368 696c 6472   Parent's childr
+0004bb10: 656e 2061 7265 206e 6f77 206d 7920 7369  en are now my si
+0004bb20: 626c 696e 6773 2e0d 0a20 2020 2020 2020  blings...       
+0004bb30: 2020 2020 2020 2020 2070 6172 656e 7420           parent 
+0004bb40: 3d20 2870 6172 656e 742c 2063 6869 6c64  = (parent, child
+0004bb50: 7265 6e29 2020 2320 7061 7265 6e74 2069  ren)  # parent i
+0004bb60: 7320 6e6f 7720 7072 6576 696f 7573 206e  s now previous n
+0004bb70: 6f64 6520 636f 6e74 6578 740d 0a20 2020  ode context..   
+0004bb80: 2020 2020 2020 2020 2020 2020 2063 6869               chi
+0004bb90: 6c64 7265 6e20 3d20 6c69 7374 2829 2020  ldren = list()  
+0004bba0: 2320 6e65 7720 6e6f 6465 2068 6173 206e  # new node has n
+0004bbb0: 6f20 6368 696c 6472 656e 2e0d 0a20 2020  o children...   
+0004bbc0: 2020 2020 2020 2020 2020 2020 206e 6f64               nod
+0004bbd0: 6520 3d20 2865 6c65 6d2c 2063 6869 6c64  e = (elem, child
+0004bbe0: 7265 6e29 2020 2320 6465 6669 6e65 2074  ren)  # define t
+0004bbf0: 6869 7320 6e6f 6465 2e0d 0a20 2020 2020  his node...     
+0004bc00: 2020 2020 2020 2020 2020 2073 6962 6c69             sibli
+0004bc10: 6e67 732e 6170 7065 6e64 286e 6f64 6529  ngs.append(node)
+0004bc20: 2020 2320 7369 626c 696e 6773 206e 6f77    # siblings now
+0004bc30: 2069 6e63 6c75 6465 7320 7468 6973 206e   includes this n
+0004bc40: 6f64 652e 0d0a 2020 2020 2020 2020 2020  ode...          
+0004bc50: 2020 2020 2020 6174 7472 6962 7574 6573        attributes
+0004bc60: 203d 2065 6c65 6d2e 6174 7472 6962 0d0a   = elem.attrib..
+0004bc70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004bc80: 6966 2053 5647 5f41 5454 525f 4944 2069  if SVG_ATTR_ID i
+0004bc90: 6e20 6174 7472 6962 7574 6573 3a20 2023  n attributes:  #
+0004bca0: 2049 6620 7765 2068 6176 6520 616e 2049   If we have an I
+0004bcb0: 442c 2077 6520 7361 7665 2074 6865 206e  D, we save the n
+0004bcc0: 6f64 652e 0d0a 2020 2020 2020 2020 2020  ode...          
+0004bcd0: 2020 2020 2020 2020 2020 6576 656e 745f            event_
+0004bce0: 6465 6673 5b0d 0a20 2020 2020 2020 2020  defs[..         
+0004bcf0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+0004bd00: 7474 7269 6275 7465 735b 5356 475f 4154  ttributes[SVG_AT
+0004bd10: 5452 5f49 445d 0d0a 2020 2020 2020 2020  TR_ID]..        
+0004bd20: 2020 2020 2020 2020 2020 2020 5d20 3d20              ] = 
+0004bd30: 6e6f 6465 2020 2320 7374 6f72 6520 6e6f  node  # store no
+0004bd40: 6465 2076 616c 7565 2069 6e20 6465 6673  de value in defs
+0004bd50: 2e0d 0a20 2020 2020 2020 2020 2020 2065  ...            e
+0004bd60: 6c69 6620 6576 656e 7420 3d3d 2022 656e  lif event == "en
+0004bd70: 6422 3a0d 0a20 2020 2020 2020 2020 2020  d":..           
+0004bd80: 2020 2020 2070 6172 656e 742c 2063 6869       parent, chi
+0004bd90: 6c64 7265 6e20 3d20 7061 7265 6e74 0d0a  ldren = parent..
+0004bda0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0004bdb0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0004bdc0: 2020 2063 6869 6c64 7265 6e2e 6170 7065     children.appe
+0004bdd0: 6e64 2828 656c 656d 2c20 4e6f 6e65 2929  nd((elem, None))
+0004bde0: 0d0a 2020 2020 2020 2020 6e6f 6465 7320  ..        nodes 
+0004bdf0: 3d20 6368 696c 6472 656e 0d0a 0d0a 2020  = children....  
+0004be00: 2020 2020 2020 2320 456e 6420 7072 6570        # End prep
+0004be10: 726f 6365 7373 0d0a 0d0a 2020 2020 2020  rocess....      
+0004be20: 2020 2320 5365 6d69 7061 7273 6520 7468    # Semiparse th
+0004be30: 6520 6e6f 6465 732e 2041 6c6c 206e 6f64  e nodes. All nod
+0004be40: 6573 2061 7265 2067 6976 656e 2069 6e20  es are given in 
+0004be50: 6974 6572 7061 7273 6520 6f72 6465 7269  iterparse orderi
+0004be60: 6e67 2077 6974 6820 7374 6172 742d 6e73  ng with start-ns
+0004be70: 2c20 7374 6172 742c 2061 6e64 2065 6e64  , start, and end
+0004be80: 2e0d 0a20 2020 2020 2020 2023 2055 7365  ...        # Use
+0004be90: 2076 616c 7565 7320 6172 6520 696e 6c69   values are inli
+0004bea0: 6e65 642e 0d0a 2020 2020 2020 2020 6465  ned...        de
+0004beb0: 6620 7365 6d69 7061 7273 6528 6e6f 6465  f semiparse(node
+0004bec0: 7329 3a0d 0a20 2020 2020 2020 2020 2020  s):..           
+0004bed0: 2066 6f72 2065 6c65 6d2c 2063 6869 6c64   for elem, child
+0004bee0: 7265 6e20 696e 206e 6f64 6573 3a0d 0a20  ren in nodes:.. 
+0004bef0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0004bf00: 6620 6368 696c 6472 656e 2069 7320 4e6f  f children is No
+0004bf10: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
+0004bf20: 2020 2020 2020 2020 2079 6965 6c64 204e           yield N
+0004bf30: 6f6e 652c 2022 7374 6172 742d 6e73 222c  one, "start-ns",
+0004bf40: 2065 6c65 6d0d 0a20 2020 2020 2020 2020   elem..         
+0004bf50: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
+0004bf60: 6e75 650d 0a20 2020 2020 2020 2020 2020  nue..           
+0004bf70: 2020 2020 2074 6167 203d 2065 6c65 6d2e       tag = elem.
+0004bf80: 7461 670d 0a20 2020 2020 2020 2020 2020  tag..           
+0004bf90: 2020 2020 2069 6620 7461 672e 7374 6172       if tag.star
+0004bfa0: 7473 7769 7468 2822 7b68 7474 703a 2f2f  tswith("{http://
+0004bfb0: 7777 772e 7733 2e6f 7267 2f32 3030 302f  www.w3.org/2000/
+0004bfc0: 7376 6722 293a 0d0a 2020 2020 2020 2020  svg"):..        
+0004bfd0: 2020 2020 2020 2020 2020 2020 7461 6720              tag 
+0004bfe0: 3d20 7461 675b 3238 3a5d 2020 2320 5265  = tag[28:]  # Re
+0004bff0: 6d6f 7669 6e67 206e 616d 6573 7061 6365  moving namespace
+0004c000: 2e20 6874 7470 3a2f 2f77 7777 2e77 332e  . http://www.w3.
+0004c010: 6f72 672f 3230 3030 2f73 7667 3a0d 0a20  org/2000/svg:.. 
+0004c020: 2020 2020 2020 2020 2020 2020 2020 2079                 y
+0004c030: 6965 6c64 2074 6167 2c20 2273 7461 7274  ield tag, "start
+0004c040: 222c 2065 6c65 6d0d 0a20 2020 2020 2020  ", elem..       
+0004c050: 2020 2020 2020 2020 2079 6965 6c64 2066           yield f
+0004c060: 726f 6d20 7365 6d69 7061 7273 6528 6368  rom semiparse(ch
+0004c070: 696c 6472 656e 290d 0a20 2020 2020 2020  ildren)..       
+0004c080: 2020 2020 2020 2020 2069 6620 5356 475f           if SVG_
+0004c090: 5441 475f 5553 4520 3d3d 2074 6167 3a0d  TAG_USE == tag:.
+0004c0a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004c0b0: 2020 2020 2075 726c 203d 204e 6f6e 650d       url = None.
+0004c0c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004c0d0: 2020 2020 2073 656d 6961 7474 7220 3d20       semiattr = 
+0004c0e0: 656c 656d 2e61 7474 7269 620d 0a20 2020  elem.attrib..   
+0004c0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c100: 2069 6620 584c 494e 4b5f 4852 4546 2069   if XLINK_HREF i
+0004c110: 6e20 7365 6d69 6174 7472 3a0d 0a20 2020  n semiattr:..   
+0004c120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c130: 2020 2020 2075 726c 203d 2073 656d 6961       url = semia
+0004c140: 7474 725b 584c 494e 4b5f 4852 4546 5d0d  ttr[XLINK_HREF].
+0004c150: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004c160: 2020 2020 2069 6620 5356 475f 4852 4546       if SVG_HREF
+0004c170: 2069 6e20 7365 6d69 6174 7472 3a0d 0a20   in semiattr:.. 
+0004c180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c190: 2020 2020 2020 2075 726c 203d 2073 656d         url = sem
+0004c1a0: 6961 7474 725b 5356 475f 4852 4546 5d0d  iattr[SVG_HREF].
+0004c1b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004c1c0: 2020 2020 2069 6620 7572 6c20 6973 206e       if url is n
+0004c1d0: 6f74 204e 6f6e 653a 0d0a 2020 2020 2020  ot None:..      
+0004c1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c1f0: 2020 7472 793a 0d0a 2020 2020 2020 2020    try:..        
+0004c200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c210: 2020 2020 7969 656c 6420 6672 6f6d 2073      yield from s
+0004c220: 656d 6970 6172 7365 285b 6576 656e 745f  emiparse([event_
+0004c230: 6465 6673 5b75 726c 5b31 3a5d 5d5d 290d  defs[url[1:]]]).
+0004c240: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004c250: 2020 2020 2020 2020 2065 7863 6570 7420           except 
+0004c260: 4b65 7945 7272 6f72 3a0d 0a20 2020 2020  KeyError:..     
+0004c270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c280: 2020 2020 2020 2070 6173 7320 2023 2046         pass  # F
+0004c290: 6169 6c65 6420 746f 2066 696e 6420 6c69  ailed to find li
+0004c2a0: 6e6b 2e0d 0a20 2020 2020 2020 2020 2020  nk...           
+0004c2b0: 2020 2020 2079 6965 6c64 2074 6167 2c20       yield tag, 
+0004c2c0: 2265 6e64 222c 2065 6c65 6d0d 0a0d 0a20  "end", elem.... 
+0004c2d0: 2020 2020 2020 2079 6965 6c64 2066 726f         yield fro
+0004c2e0: 6d20 7365 6d69 7061 7273 6528 6e6f 6465  m semiparse(node
+0004c2f0: 7329 0d0a 0d0a 2020 2020 4073 7461 7469  s)....    @stati
+0004c300: 636d 6574 686f 640d 0a20 2020 2064 6566  cmethod..    def
+0004c310: 2070 6172 7365 280d 0a20 2020 2020 2020   parse(..       
+0004c320: 2073 6f75 7263 652c 0d0a 2020 2020 2020   source,..      
+0004c330: 2020 7265 6966 793d 5472 7565 2c0d 0a20    reify=True,.. 
+0004c340: 2020 2020 2020 2070 7069 3d44 4546 4155         ppi=DEFAU
+0004c350: 4c54 5f50 5049 2c0d 0a20 2020 2020 2020  LT_PPI,..       
+0004c360: 2077 6964 7468 3d4e 6f6e 652c 0d0a 2020   width=None,..  
+0004c370: 2020 2020 2020 6865 6967 6874 3d4e 6f6e        height=Non
+0004c380: 652c 0d0a 2020 2020 2020 2020 636f 6c6f  e,..        colo
+0004c390: 723d 2262 6c61 636b 222c 0d0a 2020 2020  r="black",..    
+0004c3a0: 2020 2020 7472 616e 7366 6f72 6d3d 4e6f      transform=No
+0004c3b0: 6e65 2c0d 0a20 2020 2020 2020 2063 6f6e  ne,..        con
+0004c3c0: 7465 7874 3d4e 6f6e 652c 0d0a 2020 2020  text=None,..    
+0004c3d0: 2020 2020 7061 7273 655f 6469 7370 6c61      parse_displa
+0004c3e0: 795f 6e6f 6e65 3d46 616c 7365 2c0d 0a20  y_none=False,.. 
+0004c3f0: 2020 2020 2020 206f 6e5f 6572 726f 723d         on_error=
+0004c400: 2269 676e 6f72 6522 2c0d 0a20 2020 2029  "ignore",..    )
+0004c410: 3a0d 0a20 2020 2020 2020 2022 2222 0d0a  :..        """..
+0004c420: 2020 2020 2020 2020 5061 7273 6573 2074          Parses t
+0004c430: 6865 2053 5647 2066 696c 652e 2041 6c6c  he SVG file. All
+0004c440: 2061 7474 7269 6275 7465 7320 6172 6520   attributes are 
+0004c450: 7468 696e 6773 2077 6869 6368 2074 6865  things which the
+0004c460: 2053 5647 2064 6f63 756d 656e 7420 6974   SVG document it
+0004c470: 7365 6c66 2063 6f75 6c64 206e 6f74 2062  self could not b
+0004c480: 6520 6177 6172 6520 6f66 2c20 7375 6368  e aware of, such
+0004c490: 2061 730d 0a20 2020 2020 2020 2074 6865   as..        the
+0004c4a0: 2072 6561 6c20 7369 7a65 206f 6620 7069   real size of pi
+0004c4b0: 7865 6c73 2061 6e64 2074 6865 2073 697a  xels and the siz
+0004c4c0: 6520 6f66 2074 6865 2076 6965 7770 6f72  e of the viewpor
+0004c4d0: 7420 2861 7320 6f70 706f 7365 6420 746f  t (as opposed to
+0004c4e0: 2074 6865 2076 6965 7762 6f78 292e 0d0a   the viewbox)...
+0004c4f0: 0d0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+0004c500: 2073 6f75 7263 653a 2053 6f75 7263 6520   source: Source 
+0004c510: 7376 6720 6669 6c65 206f 7220 7374 7265  svg file or stre
+0004c520: 616d 2e0d 0a20 2020 2020 2020 203a 7061  am...        :pa
+0004c530: 7261 6d20 7265 6966 793a 2053 686f 756c  ram reify: Shoul
+0004c540: 6420 7468 6520 4765 6f6d 6574 7279 2073  d the Geometry s
+0004c550: 697a 6564 206f 7220 6861 7665 206c 617a  ized or have laz
+0004c560: 7920 6d61 7472 6963 6573 2e0d 0a20 2020  y matrices...   
+0004c570: 2020 2020 203a 7061 7261 6d20 7070 693a       :param ppi:
+0004c580: 2048 6f77 206d 616e 7920 7068 7973 6963   How many physic
+0004c590: 616c 2070 6978 656c 7320 7065 7220 696e  al pixels per in
+0004c5a0: 6368 2061 7265 2074 6865 7265 2069 6e20  ch are there in 
+0004c5b0: 7468 6973 2076 6965 772e 0d0a 2020 2020  this view...    
+0004c5c0: 2020 2020 3a70 6172 616d 2077 6964 7468      :param width
+0004c5d0: 3a20 5468 6520 7068 7973 6963 616c 2077  : The physical w
+0004c5e0: 6964 7468 206f 6620 7468 6520 7669 6577  idth of the view
+0004c5f0: 706f 7274 0d0a 2020 2020 2020 2020 3a70  port..        :p
+0004c600: 6172 616d 2068 6569 6768 743a 2054 6865  aram height: The
+0004c610: 2070 6879 7369 6361 6c20 6865 6967 6874   physical height
+0004c620: 206f 6620 7468 6520 7669 6577 706f 7274   of the viewport
+0004c630: 0d0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+0004c640: 2063 6f6c 6f72 3a20 7468 6520 6063 7572   color: the `cur
+0004c650: 7265 6e74 436f 6c6f 7260 2076 616c 7565  rentColor` value
+0004c660: 2066 726f 6d20 6f75 7473 6964 6520 7468   from outside th
+0004c670: 6520 6375 7272 656e 7420 7363 6f70 652e  e current scope.
+0004c680: 0d0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+0004c690: 2074 7261 6e73 666f 726d 3a20 416e 7920   transform: Any 
+0004c6a0: 7265 7175 6972 6564 2074 7261 6e73 666f  required transfo
+0004c6b0: 726d 6174 696f 6e73 2074 6f20 6265 2070  rmations to be p
+0004c6c0: 7265 2d61 7070 6c69 6564 2074 6f20 7468  re-applied to th
+0004c6d0: 6973 2064 6f63 756d 656e 740d 0a20 2020  is document..   
+0004c6e0: 2020 2020 203a 7061 7261 6d20 636f 6e74       :param cont
+0004c6f0: 6578 743a 2041 6e79 2065 7869 7374 696e  ext: Any existin
+0004c700: 6720 646f 6375 6d65 6e74 2063 6f6e 7465  g document conte
+0004c710: 7874 2e0d 0a20 2020 2020 2020 203a 7061  xt...        :pa
+0004c720: 7261 6d20 7061 7273 655f 6469 7370 6c61  ram parse_displa
+0004c730: 795f 6e6f 6e65 3a20 5061 7273 6520 6469  y_none: Parse di
+0004c740: 7370 6c61 795f 6e6f 6e65 2076 616c 7565  splay_none value
+0004c750: 7320 616e 7977 6179 2e0d 0a20 2020 2020  s anyway...     
+0004c760: 2020 203a 7061 7261 6d20 6f6e 5f65 7272     :param on_err
+0004c770: 6f72 3a20 4572 726f 7220 6d6f 6465 2c20  or: Error mode, 
+0004c780: 2269 676e 6f72 6522 2c20 2272 6169 7365  "ignore", "raise
+0004c790: 222c 2022 7374 6f70 220d 0a20 2020 2020  ", "stop"..     
+0004c7a0: 2020 203a 7265 7475 726e 3a0d 0a20 2020     :return:..   
+0004c7b0: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
+0004c7c0: 2020 7573 6520 3d20 300d 0a20 2020 2020    use = 0..     
+0004c7d0: 2020 2063 6c69 7020 3d20 300d 0a20 2020     clip = 0..   
+0004c7e0: 2020 2020 2072 6f6f 7420 3d20 636f 6e74       root = cont
+0004c7f0: 6578 740d 0a20 2020 2020 2020 2073 7479  ext..        sty
+0004c800: 6c65 7320 3d20 7b7d 0d0a 2020 2020 2020  les = {}..      
+0004c810: 2020 7374 6163 6b20 3d20 5b5d 0d0a 0d0a    stack = []....
+0004c820: 2020 2020 2020 2020 7661 6c75 6573 203d          values =
+0004c830: 207b 0d0a 2020 2020 2020 2020 2020 2020   {..            
+0004c840: 5356 475f 4154 5452 5f43 4f4c 4f52 3a20  SVG_ATTR_COLOR: 
+0004c850: 636f 6c6f 722c 0d0a 2020 2020 2020 2020  color,..        
+0004c860: 2020 2020 5356 475f 4154 5452 5f46 494c      SVG_ATTR_FIL
+0004c870: 4c3a 2022 626c 6163 6b22 2c0d 0a20 2020  L: "black",..   
+0004c880: 2020 2020 2020 2020 2053 5647 5f41 5454           SVG_ATT
+0004c890: 525f 5354 524f 4b45 3a20 226e 6f6e 6522  R_STROKE: "none"
+0004c8a0: 2c0d 0a20 2020 2020 2020 207d 0d0a 0d0a  ,..        }....
+0004c8b0: 2020 2020 2020 2020 6966 2074 7261 6e73          if trans
+0004c8c0: 666f 726d 2069 7320 6e6f 7420 4e6f 6e65  form is not None
+0004c8d0: 3a0d 0a20 2020 2020 2020 2020 2020 2076  :..            v
+0004c8e0: 616c 7565 735b 5356 475f 4154 5452 5f54  alues[SVG_ATTR_T
+0004c8f0: 5241 4e53 464f 524d 5d20 3d20 7472 616e  RANSFORM] = tran
+0004c900: 7366 6f72 6d0d 0a0d 0a20 2020 2020 2020  sform....       
+0004c910: 2066 6f72 2074 6167 2c20 6576 656e 742c   for tag, event,
+0004c920: 2065 6c65 6d20 696e 2053 5647 2e5f 7573   elem in SVG._us
+0004c930: 655f 7374 7275 6374 7572 655f 7061 7273  e_structure_pars
+0004c940: 6528 736f 7572 6365 293a 0d0a 2020 2020  e(source):..    
+0004c950: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
+0004c960: 2020 2020 2020 2020 2053 5647 2065 6c65           SVG ele
+0004c970: 6d65 6e74 2070 6172 7369 6e67 2070 6172  ment parsing par
+0004c980: 7365 7320 7468 6520 6a6f 6220 636f 6d70  ses the job comp
+0004c990: 696c 696e 6720 616e 7920 7061 7273 6564  iling any parsed
+0004c9a0: 2065 6c65 6d65 6e74 7320 696e 746f 2074   elements into t
+0004c9b0: 6865 6972 2063 6f6d 7069 6c65 6420 6f62  heir compiled ob
+0004c9c0: 6a65 6374 2066 6f72 6d73 2e0d 0a20 2020  ject forms...   
+0004c9d0: 2020 2020 2020 2020 2022 2222 0d0a 2020           """..  
+0004c9e0: 2020 2020 2020 2020 2020 6966 2065 7665            if eve
+0004c9f0: 6e74 203d 3d20 2273 7461 7274 223a 0d0a  nt == "start":..
+0004ca00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ca10: 7374 6163 6b2e 6170 7065 6e64 2828 636f  stack.append((co
+0004ca20: 6e74 6578 742c 2076 616c 7565 7329 290d  ntext, values)).
+0004ca30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004ca40: 2069 6620 280d 0a20 2020 2020 2020 2020   if (..         
+0004ca50: 2020 2020 2020 2020 2020 206e 6f74 2070             not p
+0004ca60: 6172 7365 5f64 6973 706c 6179 5f6e 6f6e  arse_display_non
+0004ca70: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
+0004ca80: 2020 2020 2020 2061 6e64 2053 5647 5f41         and SVG_A
+0004ca90: 5454 525f 4449 5350 4c41 5920 696e 2076  TTR_DISPLAY in v
+0004caa0: 616c 7565 730d 0a20 2020 2020 2020 2020  alues..         
+0004cab0: 2020 2020 2020 2020 2020 2061 6e64 2076             and v
+0004cac0: 616c 7565 735b 5356 475f 4154 5452 5f44  alues[SVG_ATTR_D
+0004cad0: 4953 504c 4159 5d2e 6c6f 7765 7228 2920  ISPLAY].lower() 
+0004cae0: 3d3d 2053 5647 5f56 414c 5545 5f4e 4f4e  == SVG_VALUE_NON
+0004caf0: 450d 0a20 2020 2020 2020 2020 2020 2020  E..             
+0004cb00: 2020 2029 3a0d 0a20 2020 2020 2020 2020     ):..         
+0004cb10: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
+0004cb20: 6e75 6520 2023 2056 616c 7565 7320 6861  nue  # Values ha
+0004cb30: 7320 6120 6469 7370 6c61 793d 6e6f 6e65  s a display=none
+0004cb40: 2e20 446f 206e 6f74 2072 656e 6465 7220  . Do not render 
+0004cb50: 616e 7974 6869 6e67 2e20 4e6f 2053 6861  anything. No Sha
+0004cb60: 646f 7720 446f 6d2e 0d0a 2020 2020 2020  dow Dom...      
+0004cb70: 2020 2020 2020 2020 2020 6375 7272 656e            curren
+0004cb80: 745f 7661 6c75 6573 203d 2076 616c 7565  t_values = value
+0004cb90: 730d 0a20 2020 2020 2020 2020 2020 2020  s..             
+0004cba0: 2020 2076 616c 7565 7320 3d20 7b7d 0d0a     values = {}..
+0004cbb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004cbc0: 7661 6c75 6573 2e75 7064 6174 6528 6375  values.update(cu
+0004cbd0: 7272 656e 745f 7661 6c75 6573 2920 2023  rrent_values)  #
+0004cbe0: 2063 6f70 7920 6f66 2064 6963 7469 6f6e   copy of diction
+0004cbf0: 6172 790d 0a0d 0a20 2020 2020 2020 2020  ary....         
+0004cc00: 2020 2020 2020 2023 204e 6f6e 2d70 726f         # Non-pro
+0004cc10: 7061 6761 7469 6e67 2076 616c 7565 732e  pagating values.
+0004cc20: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0004cc30: 2020 6966 2053 5647 5f41 5454 525f 5052    if SVG_ATTR_PR
+0004cc40: 4553 4552 5645 4153 5045 4354 5241 5449  ESERVEASPECTRATI
+0004cc50: 4f20 696e 2076 616c 7565 733a 0d0a 2020  O in values:..  
+0004cc60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004cc70: 2020 6465 6c20 7661 6c75 6573 5b53 5647    del values[SVG
+0004cc80: 5f41 5454 525f 5052 4553 4552 5645 4153  _ATTR_PRESERVEAS
+0004cc90: 5045 4354 5241 5449 4f5d 0d0a 2020 2020  PECTRATIO]..    
+0004cca0: 2020 2020 2020 2020 2020 2020 6966 2053              if S
+0004ccb0: 5647 5f41 5454 525f 5649 4557 424f 5820  VG_ATTR_VIEWBOX 
+0004ccc0: 696e 2076 616c 7565 733a 0d0a 2020 2020  in values:..    
+0004ccd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004cce0: 6465 6c20 7661 6c75 6573 5b53 5647 5f41  del values[SVG_A
+0004ccf0: 5454 525f 5649 4557 424f 585d 0d0a 2020  TTR_VIEWBOX]..  
+0004cd00: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0004cd10: 2053 5647 5f41 5454 525f 4944 2069 6e20   SVG_ATTR_ID in 
+0004cd20: 7661 6c75 6573 3a0d 0a20 2020 2020 2020  values:..       
+0004cd30: 2020 2020 2020 2020 2020 2020 2064 656c               del
+0004cd40: 2076 616c 7565 735b 5356 475f 4154 5452   values[SVG_ATTR
+0004cd50: 5f49 445d 0d0a 2020 2020 2020 2020 2020  _ID]..          
+0004cd60: 2020 2020 2020 6966 2053 5647 5f41 5454        if SVG_ATT
+0004cd70: 525f 434c 4153 5320 696e 2076 616c 7565  R_CLASS in value
+0004cd80: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
+0004cd90: 2020 2020 2020 2020 6465 6c20 7661 6c75          del valu
+0004cda0: 6573 5b53 5647 5f41 5454 525f 434c 4153  es[SVG_ATTR_CLAS
+0004cdb0: 535d 0d0a 2020 2020 2020 2020 2020 2020  S]..            
+0004cdc0: 2020 2020 6966 2053 5647 5f41 5454 525f      if SVG_ATTR_
+0004cdd0: 434c 4950 5f50 4154 4820 696e 2076 616c  CLIP_PATH in val
+0004cde0: 7565 733a 0d0a 2020 2020 2020 2020 2020  ues:..          
+0004cdf0: 2020 2020 2020 2020 2020 6465 6c20 7661            del va
+0004ce00: 6c75 6573 5b53 5647 5f41 5454 525f 434c  lues[SVG_ATTR_CL
+0004ce10: 4950 5f50 4154 485d 0d0a 0d0a 2020 2020  IP_PATH]....    
+0004ce20: 2020 2020 2020 2020 2020 2020 6174 7472              attr
+0004ce30: 6962 7574 6573 203d 2064 6963 7428 656c  ibutes = dict(el
+0004ce40: 656d 2e61 7474 7269 6229 2020 2320 7072  em.attrib)  # pr
+0004ce50: 696f 7269 7479 3b20 6c6f 7765 7374 0d0a  iority; lowest..
+0004ce60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ce70: 6174 7472 6962 7574 6573 5b53 5647 5f41  attributes[SVG_A
+0004ce80: 5454 525f 5441 475d 203d 2074 6167 0d0a  TTR_TAG] = tag..
+0004ce90: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0004cea0: 2020 2320 5370 6c69 7420 616e 7920 5374    # Split any St
+0004ceb0: 796c 6520 626c 6f63 6b20 656c 656d 656e  yle block elemen
+0004cec0: 7473 2069 6e74 6f20 7061 7274 733b 2070  ts into parts; p
+0004ced0: 7269 6f72 6974 7920 6d65 6469 756d 0d0a  riority medium..
+0004cee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004cef0: 7374 796c 6520 3d20 2222 0d0a 2020 2020  style = ""..    
+0004cf00: 2020 2020 2020 2020 2020 2020 6966 2022              if "
+0004cf10: 2a22 2069 6e20 7374 796c 6573 3a20 2023  *" in styles:  #
+0004cf20: 2053 656c 6563 7420 616c 6c2e 0d0a 2020   Select all...  
+0004cf30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004cf40: 2020 7374 796c 6520 2b3d 2073 7479 6c65    style += style
+0004cf50: 735b 222a 225d 0d0a 2020 2020 2020 2020  s["*"]..        
+0004cf60: 2020 2020 2020 2020 6966 2074 6167 2069          if tag i
+0004cf70: 6e20 7374 796c 6573 3a20 2023 2073 656c  n styles:  # sel
+0004cf80: 6563 746f 7220 7479 7065 0d0a 2020 2020  ector type..    
+0004cf90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004cfa0: 7374 796c 6520 2b3d 2073 7479 6c65 735b  style += styles[
+0004cfb0: 7461 675d 0d0a 2020 2020 2020 2020 2020  tag]..          
+0004cfc0: 2020 2020 2020 6966 2053 5647 5f41 5454        if SVG_ATT
+0004cfd0: 525f 4944 2069 6e20 6174 7472 6962 7574  R_ID in attribut
+0004cfe0: 6573 3a20 2023 2053 656c 6563 746f 7220  es:  # Selector 
+0004cff0: 6964 2023 6964 0d0a 2020 2020 2020 2020  id #id..        
+0004d000: 2020 2020 2020 2020 2020 2020 7376 675f              svg_
+0004d010: 6964 203d 2061 7474 7269 6275 7465 735b  id = attributes[
+0004d020: 5356 475f 4154 5452 5f49 445d 0d0a 2020  SVG_ATTR_ID]..  
+0004d030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d040: 2020 6373 735f 7461 6720 3d20 2223 2573    css_tag = "#%s
+0004d050: 2220 2520 7376 675f 6964 0d0a 2020 2020  " % svg_id..    
 0004d060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d070: 2020 2053 5647 5f41 5454 525f 4649 4c4c     SVG_ATTR_FILL
-0004d080: 2069 6e20 6174 7472 6962 7574 6573 0d0a   in attributes..
-0004d090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d0a0: 2020 2020 616e 6420 6174 7472 6962 7574      and attribut
-0004d0b0: 6573 5b53 5647 5f41 5454 525f 4649 4c4c  es[SVG_ATTR_FILL
-0004d0c0: 5d20 3d3d 2053 5647 5f56 414c 5545 5f43  ] == SVG_VALUE_C
-0004d0d0: 5552 5245 4e54 5f43 4f4c 4f52 0d0a 2020  URRENT_COLOR..  
-0004d0e0: 2020 2020 2020 2020 2020 2020 2020 293a                ):
-0004d0f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0004d100: 2020 2020 2020 6966 2053 5647 5f41 5454        if SVG_ATT
-0004d110: 525f 434f 4c4f 5220 696e 2061 7474 7269  R_COLOR in attri
-0004d120: 6275 7465 733a 0d0a 2020 2020 2020 2020  butes:..        
-0004d130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d140: 6174 7472 6962 7574 6573 5b53 5647 5f41  attributes[SVG_A
-0004d150: 5454 525f 4649 4c4c 5d20 3d20 6174 7472  TTR_FILL] = attr
-0004d160: 6962 7574 6573 5b53 5647 5f41 5454 525f  ibutes[SVG_ATTR_
-0004d170: 434f 4c4f 525d 0d0a 2020 2020 2020 2020  COLOR]..        
-0004d180: 2020 2020 2020 2020 2020 2020 656c 7365              else
-0004d190: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0004d1a0: 2020 2020 2020 2020 2020 2061 7474 7269             attri
-0004d1b0: 6275 7465 735b 5356 475f 4154 5452 5f46  butes[SVG_ATTR_F
-0004d1c0: 494c 4c5d 203d 2076 616c 7565 735b 5356  ILL] = values[SV
-0004d1d0: 475f 4154 5452 5f43 4f4c 4f52 5d0d 0a0d  G_ATTR_COLOR]...
-0004d1e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004d1f0: 2069 6620 280d 0a20 2020 2020 2020 2020   if (..         
-0004d200: 2020 2020 2020 2020 2020 2053 5647 5f41             SVG_A
-0004d210: 5454 525f 5354 524f 4b45 2069 6e20 6174  TTR_STROKE in at
-0004d220: 7472 6962 7574 6573 0d0a 2020 2020 2020  tributes..      
-0004d230: 2020 2020 2020 2020 2020 2020 2020 616e                an
-0004d240: 6420 6174 7472 6962 7574 6573 5b53 5647  d attributes[SVG
-0004d250: 5f41 5454 525f 5354 524f 4b45 5d20 3d3d  _ATTR_STROKE] ==
-0004d260: 2053 5647 5f56 414c 5545 5f43 5552 5245   SVG_VALUE_CURRE
-0004d270: 4e54 5f43 4f4c 4f52 0d0a 2020 2020 2020  NT_COLOR..      
-0004d280: 2020 2020 2020 2020 2020 293a 0d0a 2020            ):..  
-0004d290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d2a0: 2020 6966 2053 5647 5f41 5454 525f 434f    if SVG_ATTR_CO
-0004d2b0: 4c4f 5220 696e 2061 7474 7269 6275 7465  LOR in attribute
-0004d2c0: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
-0004d2d0: 2020 2020 2020 2020 2020 2020 6174 7472              attr
-0004d2e0: 6962 7574 6573 5b53 5647 5f41 5454 525f  ibutes[SVG_ATTR_
-0004d2f0: 5354 524f 4b45 5d20 3d20 6174 7472 6962  STROKE] = attrib
-0004d300: 7574 6573 5b53 5647 5f41 5454 525f 434f  utes[SVG_ATTR_CO
-0004d310: 4c4f 525d 0d0a 2020 2020 2020 2020 2020  LOR]..          
-0004d320: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
-0004d330: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004d340: 2020 2020 2020 2020 2061 7474 7269 6275           attribu
-0004d350: 7465 735b 5356 475f 4154 5452 5f53 5452  tes[SVG_ATTR_STR
-0004d360: 4f4b 455d 203d 2076 616c 7565 735b 5356  OKE] = values[SV
-0004d370: 475f 4154 5452 5f43 4f4c 4f52 5d0d 0a0d  G_ATTR_COLOR]...
-0004d380: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004d390: 2069 6620 5356 475f 4154 5452 5f54 5241   if SVG_ATTR_TRA
-0004d3a0: 4e53 464f 524d 2069 6e20 6174 7472 6962  NSFORM in attrib
-0004d3b0: 7574 6573 3a0d 0a20 2020 2020 2020 2020  utes:..         
-0004d3c0: 2020 2020 2020 2020 2020 2023 2049 6620             # If 
-0004d3d0: 7472 616e 7366 6f72 6d20 6973 2061 6c72  transform is alr
-0004d3e0: 6561 6479 2069 6e20 7661 6c75 6573 2c20  eady in values, 
-0004d3f0: 6170 7065 6e64 2074 6865 206e 6577 2076  append the new v
-0004d400: 616c 7565 2e0d 0a20 2020 2020 2020 2020  alue...         
-0004d410: 2020 2020 2020 2020 2020 2069 6620 5356             if SV
-0004d420: 475f 4154 5452 5f54 5241 4e53 464f 524d  G_ATTR_TRANSFORM
-0004d430: 2069 6e20 7661 6c75 6573 3a0d 0a20 2020   in values:..   
-0004d440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d450: 2020 2020 2061 7474 7269 6275 7465 735b       attributes[
-0004d460: 5356 475f 4154 5452 5f54 5241 4e53 464f  SVG_ATTR_TRANSFO
-0004d470: 524d 5d20 3d20 280d 0a20 2020 2020 2020  RM] = (..       
-0004d480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d490: 2020 2020 2076 616c 7565 735b 5356 475f       values[SVG_
-0004d4a0: 4154 5452 5f54 5241 4e53 464f 524d 5d0d  ATTR_TRANSFORM].
-0004d4b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004d4c0: 2020 2020 2020 2020 2020 2020 202b 2022               + "
-0004d4d0: 2022 0d0a 2020 2020 2020 2020 2020 2020   "..            
+0004d070: 6966 2063 7373 5f74 6167 2069 6e20 7374  if css_tag in st
+0004d080: 796c 6573 3a0d 0a20 2020 2020 2020 2020  yles:..         
+0004d090: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0004d0a0: 6620 6c65 6e28 7374 796c 6529 2021 3d20  f len(style) != 
+0004d0b0: 303a 0d0a 2020 2020 2020 2020 2020 2020  0:..            
+0004d0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d0d0: 7374 796c 6520 2b3d 2022 3b22 0d0a 2020  style += ";"..  
+0004d0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d0f0: 2020 2020 2020 7374 796c 6520 2b3d 2073        style += s
+0004d100: 7479 6c65 735b 6373 735f 7461 675d 0d0a  tyles[css_tag]..
+0004d110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d120: 6966 2053 5647 5f41 5454 525f 434c 4153  if SVG_ATTR_CLAS
+0004d130: 5320 696e 2061 7474 7269 6275 7465 733a  S in attributes:
+0004d140: 2020 2320 5365 6c65 6374 6f72 2063 6c61    # Selector cla
+0004d150: 7373 202e 636c 6173 730d 0a20 2020 2020  ss .class..     
+0004d160: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0004d170: 6f72 2073 7667 5f63 6c61 7373 2069 6e20  or svg_class in 
+0004d180: 6174 7472 6962 7574 6573 5b53 5647 5f41  attributes[SVG_A
+0004d190: 5454 525f 434c 4153 535d 2e73 706c 6974  TTR_CLASS].split
+0004d1a0: 2822 2022 293a 0d0a 2020 2020 2020 2020  (" "):..        
+0004d1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d1c0: 6373 735f 7461 6720 3d20 222e 2573 2220  css_tag = ".%s" 
+0004d1d0: 2520 7376 675f 636c 6173 730d 0a20 2020  % svg_class..   
+0004d1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d1f0: 2020 2020 2069 6620 6373 735f 7461 6720       if css_tag 
+0004d200: 696e 2073 7479 6c65 733a 0d0a 2020 2020  in styles:..    
+0004d210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d220: 2020 2020 2020 2020 6966 206c 656e 2873          if len(s
+0004d230: 7479 6c65 2920 213d 2030 3a0d 0a20 2020  tyle) != 0:..   
+0004d240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d250: 2020 2020 2020 2020 2020 2020 2073 7479               sty
+0004d260: 6c65 202b 3d20 223b 220d 0a20 2020 2020  le += ";"..     
+0004d270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d280: 2020 2020 2020 2073 7479 6c65 202b 3d20         style += 
+0004d290: 7374 796c 6573 5b63 7373 5f74 6167 5d0d  styles[css_tag].
+0004d2a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004d2b0: 2020 2020 2020 2020 2063 7373 5f74 6167           css_tag
+0004d2c0: 203d 2022 2573 2e25 7322 2025 2028 0d0a   = "%s.%s" % (..
+0004d2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d2e0: 2020 2020 2020 2020 2020 2020 7461 672c              tag,
+0004d2f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0004d300: 2020 2020 2020 2020 2020 2020 2020 7376                sv
+0004d310: 675f 636c 6173 732c 0d0a 2020 2020 2020  g_class,..      
+0004d320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d330: 2020 2920 2023 2053 656c 6563 746f 7220    )  # Selector 
+0004d340: 7479 7065 2f63 6c61 7373 2074 7970 652e  type/class type.
+0004d350: 636c 6173 730d 0a20 2020 2020 2020 2020  class..         
+0004d360: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0004d370: 6620 6373 735f 7461 6720 696e 2073 7479  f css_tag in sty
+0004d380: 6c65 733a 0d0a 2020 2020 2020 2020 2020  les:..          
+0004d390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d3a0: 2020 6966 206c 656e 2873 7479 6c65 2920    if len(style) 
+0004d3b0: 213d 2030 3a0d 0a20 2020 2020 2020 2020  != 0:..         
+0004d3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d3d0: 2020 2020 2020 2073 7479 6c65 202b 3d20         style += 
+0004d3e0: 223b 220d 0a20 2020 2020 2020 2020 2020  ";"..           
+0004d3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d400: 2073 7479 6c65 202b 3d20 7374 796c 6573   style += styles
+0004d410: 5b63 7373 5f74 6167 5d0d 0a20 2020 2020  [css_tag]..     
+0004d420: 2020 2020 2020 2020 2020 2023 2053 706c             # Spl
+0004d430: 6974 2073 7479 6c65 2065 6c65 6d65 6e74  it style element
+0004d440: 2069 6e74 6f20 7061 7274 733b 2070 7269   into parts; pri
+0004d450: 6f72 6974 7920 6869 6768 6573 740d 0a20  ority highest.. 
+0004d460: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0004d470: 6620 5356 475f 4154 5452 5f53 5459 4c45  f SVG_ATTR_STYLE
+0004d480: 2069 6e20 6174 7472 6962 7574 6573 3a0d   in attributes:.
+0004d490: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004d4a0: 2020 2020 2069 6620 6c65 6e28 7374 796c       if len(styl
+0004d4b0: 6529 2021 3d20 303a 0d0a 2020 2020 2020  e) != 0:..      
+0004d4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d4d0: 2020 7374 796c 6520 2b3d 2022 3b22 0d0a    style += ";"..
 0004d4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d4f0: 2b20 6174 7472 6962 7574 6573 5b53 5647  + attributes[SVG
-0004d500: 5f41 5454 525f 5452 414e 5346 4f52 4d5d  _ATTR_TRANSFORM]
-0004d510: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0004d520: 2020 2020 2020 2020 2020 290d 0a20 2020            )..   
-0004d530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d540: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-0004d550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d560: 6174 7472 6962 7574 6573 5b53 5647 5f41  attributes[SVG_A
-0004d570: 5454 525f 5452 414e 5346 4f52 4d5d 203d  TTR_TRANSFORM] =
-0004d580: 2061 7474 7269 6275 7465 735b 5356 475f   attributes[SVG_
-0004d590: 4154 5452 5f54 5241 4e53 464f 524d 5d0d  ATTR_TRANSFORM].
-0004d5a0: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
-0004d5b0: 2020 2023 2041 6c6c 2063 6c61 7373 2061     # All class a
-0004d5c0: 6e64 2061 7474 7269 6275 7465 2070 726f  nd attribute pro
-0004d5d0: 7065 7274 6965 7320 6172 6520 636f 6d70  perties are comp
-0004d5e0: 696c 6564 2e0d 0a20 2020 2020 2020 2020  iled...         
-0004d5f0: 2020 2020 2020 2076 616c 7565 732e 7570         values.up
-0004d600: 6461 7465 2861 7474 7269 6275 7465 7329  date(attributes)
-0004d610: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0004d620: 2020 7661 6c75 6573 5b53 5647 5f53 5452    values[SVG_STR
-0004d630: 5543 545f 4154 5452 4942 5d20 3d20 6174  UCT_ATTRIB] = at
-0004d640: 7472 6962 7574 6573 0d0a 2020 2020 2020  tributes..      
-0004d650: 2020 2020 2020 2020 2020 6966 2028 0d0a            if (..
+0004d4f0: 2020 2020 7374 796c 6520 2b3d 2061 7474      style += att
+0004d500: 7269 6275 7465 735b 5356 475f 4154 5452  ributes[SVG_ATTR
+0004d510: 5f53 5459 4c45 5d0d 0a0d 0a20 2020 2020  _STYLE]....     
+0004d520: 2020 2020 2020 2020 2020 2023 2050 726f             # Pro
+0004d530: 6365 7373 2073 7479 6c65 2074 6167 206c  cess style tag l
+0004d540: 6566 7420 746f 2072 6967 6874 2e0d 0a20  eft to right... 
+0004d550: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0004d560: 6f72 2065 7175 6174 6520 696e 2073 7479  or equate in sty
+0004d570: 6c65 2e73 706c 6974 2822 3b22 293a 0d0a  le.split(";"):..
+0004d580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d590: 2020 2020 6571 7561 6c5f 6974 656d 203d      equal_item =
+0004d5a0: 2065 7175 6174 652e 7370 6c69 7428 223a   equate.split(":
+0004d5b0: 2229 0d0a 2020 2020 2020 2020 2020 2020  ")..            
+0004d5c0: 2020 2020 2020 2020 6966 206c 656e 2865          if len(e
+0004d5d0: 7175 616c 5f69 7465 6d29 203d 3d20 323a  qual_item) == 2:
+0004d5e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0004d5f0: 2020 2020 2020 2020 2020 6b65 7920 3d20            key = 
+0004d600: 7374 7228 6571 7561 6c5f 6974 656d 5b30  str(equal_item[0
+0004d610: 5d29 2e73 7472 6970 2829 0d0a 2020 2020  ]).strip()..    
+0004d620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d630: 2020 2020 7661 6c75 6520 3d20 7374 7228      value = str(
+0004d640: 6571 7561 6c5f 6974 656d 5b31 5d29 2e73  equal_item[1]).s
+0004d650: 7472 6970 2829 0d0a 2020 2020 2020 2020  trip()..        
 0004d660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d670: 2020 2020 6e6f 7420 7061 7273 655f 6469      not parse_di
-0004d680: 7370 6c61 795f 6e6f 6e65 0d0a 2020 2020  splay_none..    
-0004d690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d6a0: 616e 6420 5356 475f 4154 5452 5f44 4953  and SVG_ATTR_DIS
-0004d6b0: 504c 4159 2069 6e20 7661 6c75 6573 0d0a  PLAY in values..
-0004d6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d6d0: 2020 2020 616e 6420 7661 6c75 6573 5b53      and values[S
-0004d6e0: 5647 5f41 5454 525f 4449 5350 4c41 595d  VG_ATTR_DISPLAY]
-0004d6f0: 2e6c 6f77 6572 2829 203d 3d20 5356 475f  .lower() == SVG_
-0004d700: 5641 4c55 455f 4e4f 4e45 0d0a 2020 2020  VALUE_NONE..    
-0004d710: 2020 2020 2020 2020 2020 2020 293a 0d0a              ):..
-0004d720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d730: 2020 2020 636f 6e74 696e 7565 2020 2320      continue  # 
-0004d740: 4966 2074 6865 2061 7474 7269 6275 7465  If the attribute
-0004d750: 7320 666c 6167 7320 6f75 7220 7661 6c75  s flags our valu
-0004d760: 6573 2074 6f20 6469 7370 6c61 793d 6e6f  es to display=no
-0004d770: 6e65 2c20 7374 6f70 2072 656e 6465 7269  ne, stop renderi
-0004d780: 6e67 2e0d 0a20 2020 2020 2020 2020 2020  ng...           
-0004d790: 2020 2020 2069 6620 5356 475f 4e41 4d45       if SVG_NAME
-0004d7a0: 5f54 4147 203d 3d20 7461 673a 0d0a 2020  _TAG == tag:..  
-0004d7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d7c0: 2020 2320 5468 6520 6f72 6465 7269 6e67    # The ordering
-0004d7d0: 2066 6f72 2074 7261 6e73 666f 726d 6174   for transformat
-0004d7e0: 696f 6e73 206f 6e20 7468 6520 5356 4720  ions on the SVG 
-0004d7f0: 6f62 6a65 6374 2061 7265 3a0d 0a20 2020  object are:..   
-0004d800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d810: 2023 2065 7870 6c69 6369 7420 7472 616e   # explicit tran
-0004d820: 7366 6f72 6d2c 2070 6172 656e 7420 7472  sform, parent tr
-0004d830: 616e 7366 6f72 6d73 2c20 6174 7472 6962  ansforms, attrib
-0004d840: 7574 6520 7472 616e 7366 6f72 6d73 2c20  ute transforms, 
-0004d850: 7669 6577 706f 7274 2074 7261 6e73 666f  viewport transfo
-0004d860: 726d 730d 0a20 2020 2020 2020 2020 2020  rms..           
-0004d870: 2020 2020 2020 2020 2073 203d 2053 5647           s = SVG
-0004d880: 2876 616c 7565 7329 0d0a 0d0a 2020 2020  (values)....    
-0004d890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d8a0: 6966 2077 6964 7468 2069 7320 4e6f 6e65  if width is None
-0004d8b0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0004d8c0: 2020 2020 2020 2020 2020 2023 2049 6620             # If 
-0004d8d0: 6120 6469 6d20 7761 7320 6e6f 7420 7072  a dim was not pr
-0004d8e0: 6f76 6964 6564 2062 7574 2061 2076 6965  ovided but a vie
-0004d8f0: 7762 6f78 2077 6173 2c20 7573 6520 7468  wbox was, use th
-0004d900: 6520 7669 6577 626f 7820 6469 6d20 6173  e viewbox dim as
-0004d910: 2070 6879 7369 6361 6c20 7369 7a65 2c20   physical size, 
-0004d920: 656c 7365 2031 3030 300d 0a20 2020 2020  else 1000..     
-0004d930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d940: 2020 2077 6964 7468 203d 2028 0d0a 2020     width = (..  
-0004d950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d960: 2020 2020 2020 2020 2020 732e 7669 6577            s.view
-0004d970: 626f 782e 7769 6474 6820 6966 2073 2e76  box.width if s.v
-0004d980: 6965 7762 6f78 2069 7320 6e6f 7420 4e6f  iewbox is not No
-0004d990: 6e65 2065 6c73 6520 3130 3030 0d0a 2020  ne else 1000..  
-0004d9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d9b0: 2020 2020 2020 2920 2023 2031 3030 3020        )  # 1000 
-0004d9c0: 6465 6661 756c 7420 6e6f 2069 6e66 6f72  default no infor
-0004d9d0: 6d61 7469 6f6e 2e0d 0a20 2020 2020 2020  mation...       
-0004d9e0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0004d9f0: 6865 6967 6874 2069 7320 4e6f 6e65 3a0d  height is None:.
-0004da00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004da10: 2020 2020 2020 2020 2068 6569 6768 7420           height 
-0004da20: 3d20 732e 7669 6577 626f 782e 6865 6967  = s.viewbox.heig
-0004da30: 6874 2069 6620 732e 7669 6577 626f 7820  ht if s.viewbox 
-0004da40: 6973 206e 6f74 204e 6f6e 6520 656c 7365  is not None else
-0004da50: 2031 3030 300d 0a0d 0a20 2020 2020 2020   1000....       
-0004da60: 2020 2020 2020 2020 2020 2020 2073 2e72               s.r
-0004da70: 656e 6465 7228 7070 693d 7070 692c 2077  ender(ppi=ppi, w
-0004da80: 6964 7468 3d77 6964 7468 2c20 6865 6967  idth=width, heig
-0004da90: 6874 3d68 6569 6768 742c 2076 6965 7762  ht=height, viewb
-0004daa0: 6f78 3d73 2e76 6965 7762 6f78 290d 0a20  ox=s.viewbox).. 
-0004dab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004dac0: 2020 2068 6569 6768 742c 2077 6964 7468     height, width
-0004dad0: 203d 2073 2e77 6964 7468 2c20 732e 6865   = s.width, s.he
-0004dae0: 6967 6874 0d0a 2020 2020 2020 2020 2020  ight..          
-0004daf0: 2020 2020 2020 2020 2020 6966 2073 2e76            if s.v
-0004db00: 6965 7762 6f78 2069 7320 6e6f 7420 4e6f  iewbox is not No
-0004db10: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
-0004db20: 2020 2020 2020 2020 2020 2020 2074 7279               try
-0004db30: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0004db40: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0004db50: 6620 732e 6865 6967 6874 203d 3d20 3020  f s.height == 0 
-0004db60: 6f72 2073 2e77 6964 7468 203d 3d20 303a  or s.width == 0:
-0004db70: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0004db80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004db90: 2020 7265 7475 726e 2073 0d0a 2020 2020    return s..    
-0004dba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004dbb0: 2020 2020 2020 2020 7669 6577 706f 7274          viewport
-0004dbc0: 5f74 7261 6e73 666f 726d 203d 2073 2e76  _transform = s.v
-0004dbd0: 6965 7762 6f78 5f74 7261 6e73 666f 726d  iewbox_transform
-0004dbe0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0004dbf0: 2020 2020 2020 2020 2020 6578 6365 7074            except
-0004dc00: 205a 6572 6f44 6976 6973 696f 6e45 7272   ZeroDivisionErr
-0004dc10: 6f72 3a0d 0a20 2020 2020 2020 2020 2020  or:..           
-0004dc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004dc30: 2023 2054 6865 2077 6964 7468 206f 7220   # The width or 
-0004dc40: 6865 6967 6874 2077 6173 207a 6572 6f2e  height was zero.
+0004d670: 6174 7472 6962 7574 6573 5b6b 6579 5d20  attributes[key] 
+0004d680: 3d20 7661 6c75 650d 0a20 2020 2020 2020  = value..       
+0004d690: 2020 2020 2020 2020 2069 6620 280d 0a20           if (.. 
+0004d6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d6b0: 2020 2053 5647 5f41 5454 525f 4649 4c4c     SVG_ATTR_FILL
+0004d6c0: 2069 6e20 6174 7472 6962 7574 6573 0d0a   in attributes..
+0004d6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d6e0: 2020 2020 616e 6420 6174 7472 6962 7574      and attribut
+0004d6f0: 6573 5b53 5647 5f41 5454 525f 4649 4c4c  es[SVG_ATTR_FILL
+0004d700: 5d20 3d3d 2053 5647 5f56 414c 5545 5f43  ] == SVG_VALUE_C
+0004d710: 5552 5245 4e54 5f43 4f4c 4f52 0d0a 2020  URRENT_COLOR..  
+0004d720: 2020 2020 2020 2020 2020 2020 2020 293a                ):
+0004d730: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0004d740: 2020 2020 2020 6966 2053 5647 5f41 5454        if SVG_ATT
+0004d750: 525f 434f 4c4f 5220 696e 2061 7474 7269  R_COLOR in attri
+0004d760: 6275 7465 733a 0d0a 2020 2020 2020 2020  butes:..        
+0004d770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d780: 6174 7472 6962 7574 6573 5b53 5647 5f41  attributes[SVG_A
+0004d790: 5454 525f 4649 4c4c 5d20 3d20 6174 7472  TTR_FILL] = attr
+0004d7a0: 6962 7574 6573 5b53 5647 5f41 5454 525f  ibutes[SVG_ATTR_
+0004d7b0: 434f 4c4f 525d 0d0a 2020 2020 2020 2020  COLOR]..        
+0004d7c0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0004d7d0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0004d7e0: 2020 2020 2020 2020 2020 2061 7474 7269             attri
+0004d7f0: 6275 7465 735b 5356 475f 4154 5452 5f46  butes[SVG_ATTR_F
+0004d800: 494c 4c5d 203d 2076 616c 7565 735b 5356  ILL] = values[SV
+0004d810: 475f 4154 5452 5f43 4f4c 4f52 5d0d 0a0d  G_ATTR_COLOR]...
+0004d820: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004d830: 2069 6620 280d 0a20 2020 2020 2020 2020   if (..         
+0004d840: 2020 2020 2020 2020 2020 2053 5647 5f41             SVG_A
+0004d850: 5454 525f 5354 524f 4b45 2069 6e20 6174  TTR_STROKE in at
+0004d860: 7472 6962 7574 6573 0d0a 2020 2020 2020  tributes..      
+0004d870: 2020 2020 2020 2020 2020 2020 2020 616e                an
+0004d880: 6420 6174 7472 6962 7574 6573 5b53 5647  d attributes[SVG
+0004d890: 5f41 5454 525f 5354 524f 4b45 5d20 3d3d  _ATTR_STROKE] ==
+0004d8a0: 2053 5647 5f56 414c 5545 5f43 5552 5245   SVG_VALUE_CURRE
+0004d8b0: 4e54 5f43 4f4c 4f52 0d0a 2020 2020 2020  NT_COLOR..      
+0004d8c0: 2020 2020 2020 2020 2020 293a 0d0a 2020            ):..  
+0004d8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d8e0: 2020 6966 2053 5647 5f41 5454 525f 434f    if SVG_ATTR_CO
+0004d8f0: 4c4f 5220 696e 2061 7474 7269 6275 7465  LOR in attribute
+0004d900: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
+0004d910: 2020 2020 2020 2020 2020 2020 6174 7472              attr
+0004d920: 6962 7574 6573 5b53 5647 5f41 5454 525f  ibutes[SVG_ATTR_
+0004d930: 5354 524f 4b45 5d20 3d20 6174 7472 6962  STROKE] = attrib
+0004d940: 7574 6573 5b53 5647 5f41 5454 525f 434f  utes[SVG_ATTR_CO
+0004d950: 4c4f 525d 0d0a 2020 2020 2020 2020 2020  LOR]..          
+0004d960: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
+0004d970: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004d980: 2020 2020 2020 2020 2061 7474 7269 6275           attribu
+0004d990: 7465 735b 5356 475f 4154 5452 5f53 5452  tes[SVG_ATTR_STR
+0004d9a0: 4f4b 455d 203d 2076 616c 7565 735b 5356  OKE] = values[SV
+0004d9b0: 475f 4154 5452 5f43 4f4c 4f52 5d0d 0a0d  G_ATTR_COLOR]...
+0004d9c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004d9d0: 2069 6620 5356 475f 4154 5452 5f54 5241   if SVG_ATTR_TRA
+0004d9e0: 4e53 464f 524d 2069 6e20 6174 7472 6962  NSFORM in attrib
+0004d9f0: 7574 6573 3a0d 0a20 2020 2020 2020 2020  utes:..         
+0004da00: 2020 2020 2020 2020 2020 2023 2049 6620             # If 
+0004da10: 7472 616e 7366 6f72 6d20 6973 2061 6c72  transform is alr
+0004da20: 6561 6479 2069 6e20 7661 6c75 6573 2c20  eady in values, 
+0004da30: 6170 7065 6e64 2074 6865 206e 6577 2076  append the new v
+0004da40: 616c 7565 2e0d 0a20 2020 2020 2020 2020  alue...         
+0004da50: 2020 2020 2020 2020 2020 2069 6620 5356             if SV
+0004da60: 475f 4154 5452 5f54 5241 4e53 464f 524d  G_ATTR_TRANSFORM
+0004da70: 2069 6e20 7661 6c75 6573 3a0d 0a20 2020   in values:..   
+0004da80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004da90: 2020 2020 2061 7474 7269 6275 7465 735b       attributes[
+0004daa0: 5356 475f 4154 5452 5f54 5241 4e53 464f  SVG_ATTR_TRANSFO
+0004dab0: 524d 5d20 3d20 280d 0a20 2020 2020 2020  RM] = (..       
+0004dac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004dad0: 2020 2020 2076 616c 7565 735b 5356 475f       values[SVG_
+0004dae0: 4154 5452 5f54 5241 4e53 464f 524d 5d0d  ATTR_TRANSFORM].
+0004daf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004db00: 2020 2020 2020 2020 2020 2020 202b 2022               + "
+0004db10: 2022 0d0a 2020 2020 2020 2020 2020 2020   "..            
+0004db20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004db30: 2b20 6174 7472 6962 7574 6573 5b53 5647  + attributes[SVG
+0004db40: 5f41 5454 525f 5452 414e 5346 4f52 4d5d  _ATTR_TRANSFORM]
+0004db50: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0004db60: 2020 2020 2020 2020 2020 290d 0a20 2020            )..   
+0004db70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004db80: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+0004db90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004dba0: 6174 7472 6962 7574 6573 5b53 5647 5f41  attributes[SVG_A
+0004dbb0: 5454 525f 5452 414e 5346 4f52 4d5d 203d  TTR_TRANSFORM] =
+0004dbc0: 2061 7474 7269 6275 7465 735b 5356 475f   attributes[SVG_
+0004dbd0: 4154 5452 5f54 5241 4e53 464f 524d 5d0d  ATTR_TRANSFORM].
+0004dbe0: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
+0004dbf0: 2020 2023 2041 6c6c 2063 6c61 7373 2061     # All class a
+0004dc00: 6e64 2061 7474 7269 6275 7465 2070 726f  nd attribute pro
+0004dc10: 7065 7274 6965 7320 6172 6520 636f 6d70  perties are comp
+0004dc20: 696c 6564 2e0d 0a20 2020 2020 2020 2020  iled...         
+0004dc30: 2020 2020 2020 2076 616c 7565 732e 7570         values.up
+0004dc40: 6461 7465 2861 7474 7269 6275 7465 7329  date(attributes)
 0004dc50: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0004dc60: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0004dc70: 6874 7470 733a 2f2f 7777 772e 7733 2e6f  https://www.w3.o
-0004dc80: 7267 2f54 522f 5356 4731 312f 7374 7275  rg/TR/SVG11/stru
-0004dc90: 6374 2e68 746d 6c23 5356 4745 6c65 6d65  ct.html#SVGEleme
-0004dca0: 6e74 5769 6474 6841 7474 7269 6275 7465  ntWidthAttribute
-0004dcb0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0004dcc0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0004dcd0: 2241 2076 616c 7565 206f 6620 7a65 726f  "A value of zero
-0004dce0: 2064 6973 6162 6c65 7320 7265 6e64 6572   disables render
-0004dcf0: 696e 6720 6f66 2074 6865 2065 6c65 6d65  ing of the eleme
-0004dd00: 6e74 2e22 0d0a 2020 2020 2020 2020 2020  nt."..          
-0004dd10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004dd20: 2020 7265 7475 726e 2073 2020 2320 4e6f    return s  # No
-0004dd30: 206d 6f72 6520 7061 7273 696e 6720 7769   more parsing wi
-0004dd40: 6c6c 2062 6520 646f 6e65 2e0d 0a0d 0a20  ll be done..... 
-0004dd50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004dd60: 2020 2020 2020 2069 6620 5356 475f 4154         if SVG_AT
-0004dd70: 5452 5f54 5241 4e53 464f 524d 2069 6e20  TR_TRANSFORM in 
-0004dd80: 7661 6c75 6573 3a0d 0a20 2020 2020 2020  values:..       
-0004dd90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004dda0: 2020 2020 2023 2074 7261 6e73 666f 726d       # transform
-0004ddb0: 206f 6e20 5356 4720 656c 656d 656e 7420   on SVG element 
-0004ddc0: 6170 706c 6965 6420 6173 2069 6620 7376  applied as if sv
-0004ddd0: 6720 6861 6420 7061 7265 6e74 2077 6974  g had parent wit
-0004dde0: 6820 7472 616e 7366 6f72 6d2e 0d0a 2020  h transform...  
+0004dc60: 2020 7661 6c75 6573 5b53 5647 5f53 5452    values[SVG_STR
+0004dc70: 5543 545f 4154 5452 4942 5d20 3d20 6174  UCT_ATTRIB] = at
+0004dc80: 7472 6962 7574 6573 0d0a 2020 2020 2020  tributes..      
+0004dc90: 2020 2020 2020 2020 2020 6966 2028 0d0a            if (..
+0004dca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004dcb0: 2020 2020 6e6f 7420 7061 7273 655f 6469      not parse_di
+0004dcc0: 7370 6c61 795f 6e6f 6e65 0d0a 2020 2020  splay_none..    
+0004dcd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004dce0: 616e 6420 5356 475f 4154 5452 5f44 4953  and SVG_ATTR_DIS
+0004dcf0: 504c 4159 2069 6e20 7661 6c75 6573 0d0a  PLAY in values..
+0004dd00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004dd10: 2020 2020 616e 6420 7661 6c75 6573 5b53      and values[S
+0004dd20: 5647 5f41 5454 525f 4449 5350 4c41 595d  VG_ATTR_DISPLAY]
+0004dd30: 2e6c 6f77 6572 2829 203d 3d20 5356 475f  .lower() == SVG_
+0004dd40: 5641 4c55 455f 4e4f 4e45 0d0a 2020 2020  VALUE_NONE..    
+0004dd50: 2020 2020 2020 2020 2020 2020 293a 0d0a              ):..
+0004dd60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004dd70: 2020 2020 636f 6e74 696e 7565 2020 2320      continue  # 
+0004dd80: 4966 2074 6865 2061 7474 7269 6275 7465  If the attribute
+0004dd90: 7320 666c 6167 7320 6f75 7220 7661 6c75  s flags our valu
+0004dda0: 6573 2074 6f20 6469 7370 6c61 793d 6e6f  es to display=no
+0004ddb0: 6e65 2c20 7374 6f70 2072 656e 6465 7269  ne, stop renderi
+0004ddc0: 6e67 2e0d 0a20 2020 2020 2020 2020 2020  ng...           
+0004ddd0: 2020 2020 2069 6620 5356 475f 4e41 4d45       if SVG_NAME
+0004dde0: 5f54 4147 203d 3d20 7461 673a 0d0a 2020  _TAG == tag:..  
 0004ddf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004de00: 2020 2020 2020 2020 2020 7661 6c75 6573            values
-0004de10: 5b53 5647 5f41 5454 525f 5452 414e 5346  [SVG_ATTR_TRANSF
-0004de20: 4f52 4d5d 202b 3d20 2220 2220 2b20 7669  ORM] += " " + vi
-0004de30: 6577 706f 7274 5f74 7261 6e73 666f 726d  ewport_transform
-0004de40: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0004de50: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
-0004de60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004de70: 2020 2020 2020 2020 2020 2020 2076 616c               val
-0004de80: 7565 735b 5356 475f 4154 5452 5f54 5241  ues[SVG_ATTR_TRA
-0004de90: 4e53 464f 524d 5d20 3d20 7669 6577 706f  NSFORM] = viewpo
-0004dea0: 7274 5f74 7261 6e73 666f 726d 0d0a 2020  rt_transform..  
-0004deb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004dec0: 2020 2020 2020 7661 6c75 6573 5b22 7669        values["vi
-0004ded0: 6577 706f 7274 5f74 7261 6e73 666f 726d  ewport_transform
-0004dee0: 225d 203d 2076 616c 7565 735b 5356 475f  "] = values[SVG_
-0004def0: 4154 5452 5f54 5241 4e53 464f 524d 5d0d  ATTR_TRANSFORM].
-0004df00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004df10: 2020 2020 2020 2020 2077 6964 7468 2c20           width, 
-0004df20: 6865 6967 6874 203d 2073 2e76 6965 7762  height = s.viewb
-0004df30: 6f78 2e77 6964 7468 2c20 732e 7669 6577  ox.width, s.view
-0004df40: 626f 782e 6865 6967 6874 0d0a 2020 2020  box.height..    
-0004df50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004df60: 6966 2063 6f6e 7465 7874 2069 7320 4e6f  if context is No
-0004df70: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
-0004df80: 2020 2020 2020 2020 2020 2020 2073 7461               sta
-0004df90: 636b 5b2d 315d 203d 2028 636f 6e74 6578  ck[-1] = (contex
-0004dfa0: 742c 2076 616c 7565 7329 0d0a 2020 2020  t, values)..    
-0004dfb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004dfc0: 6966 2063 6f6e 7465 7874 2069 7320 6e6f  if context is no
-0004dfd0: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
+0004de00: 2020 2320 5468 6520 6f72 6465 7269 6e67    # The ordering
+0004de10: 2066 6f72 2074 7261 6e73 666f 726d 6174   for transformat
+0004de20: 696f 6e73 206f 6e20 7468 6520 5356 4720  ions on the SVG 
+0004de30: 6f62 6a65 6374 2061 7265 3a0d 0a20 2020  object are:..   
+0004de40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004de50: 2023 2065 7870 6c69 6369 7420 7472 616e   # explicit tran
+0004de60: 7366 6f72 6d2c 2070 6172 656e 7420 7472  sform, parent tr
+0004de70: 616e 7366 6f72 6d73 2c20 6174 7472 6962  ansforms, attrib
+0004de80: 7574 6520 7472 616e 7366 6f72 6d73 2c20  ute transforms, 
+0004de90: 7669 6577 706f 7274 2074 7261 6e73 666f  viewport transfo
+0004dea0: 726d 730d 0a20 2020 2020 2020 2020 2020  rms..           
+0004deb0: 2020 2020 2020 2020 2073 203d 2053 5647           s = SVG
+0004dec0: 2876 616c 7565 7329 0d0a 0d0a 2020 2020  (values)....    
+0004ded0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004dee0: 6966 2077 6964 7468 2069 7320 4e6f 6e65  if width is None
+0004def0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0004df00: 2020 2020 2020 2020 2020 2023 2049 6620             # If 
+0004df10: 6120 6469 6d20 7761 7320 6e6f 7420 7072  a dim was not pr
+0004df20: 6f76 6964 6564 2062 7574 2061 2076 6965  ovided but a vie
+0004df30: 7762 6f78 2077 6173 2c20 7573 6520 7468  wbox was, use th
+0004df40: 6520 7669 6577 626f 7820 6469 6d20 6173  e viewbox dim as
+0004df50: 2070 6879 7369 6361 6c20 7369 7a65 2c20   physical size, 
+0004df60: 656c 7365 2031 3030 300d 0a20 2020 2020  else 1000..     
+0004df70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004df80: 2020 2077 6964 7468 203d 2028 0d0a 2020     width = (..  
+0004df90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004dfa0: 2020 2020 2020 2020 2020 732e 7669 6577            s.view
+0004dfb0: 626f 782e 7769 6474 6820 6966 2073 2e76  box.width if s.v
+0004dfc0: 6965 7762 6f78 2069 7320 6e6f 7420 4e6f  iewbox is not No
+0004dfd0: 6e65 2065 6c73 6520 3130 3030 0d0a 2020  ne else 1000..  
 0004dfe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004dff0: 2063 6f6e 7465 7874 2e61 7070 656e 6428   context.append(
-0004e000: 7329 0d0a 2020 2020 2020 2020 2020 2020  s)..            
-0004e010: 2020 2020 2020 2020 636f 6e74 6578 7420          context 
-0004e020: 3d20 730d 0a20 2020 2020 2020 2020 2020  = s..           
-0004e030: 2020 2020 2065 6c69 6620 5356 475f 5441       elif SVG_TA
-0004e040: 475f 4752 4f55 5020 3d3d 2074 6167 3a0d  G_GROUP == tag:.
-0004e050: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004e060: 2020 2020 2073 203d 2047 726f 7570 2876       s = Group(v
-0004e070: 616c 7565 7329 0d0a 2020 2020 2020 2020  alues)..        
-0004e080: 2020 2020 2020 2020 2020 2020 6966 2063              if c
-0004e090: 6f6e 7465 7874 2069 7320 6e6f 7420 4e6f  ontext is not No
-0004e0a0: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
-0004e0b0: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-0004e0c0: 7465 7874 2e61 7070 656e 6428 7329 0d0a  text.append(s)..
-0004e0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e0e0: 2020 2020 636f 6e74 6578 7420 3d20 730d      context = s.
-0004e0f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004e100: 2020 2020 2073 2e72 656e 6465 7228 7070       s.render(pp
-0004e110: 693d 7070 692c 2077 6964 7468 3d77 6964  i=ppi, width=wid
-0004e120: 7468 2c20 6865 6967 6874 3d68 6569 6768  th, height=heigh
-0004e130: 7429 0d0a 2020 2020 2020 2020 2020 2020  t)..            
-0004e140: 2020 2020 656c 6966 2053 5647 5f54 4147      elif SVG_TAG
-0004e150: 5f44 4546 5320 3d3d 2074 6167 3a0d 0a20  _DEFS == tag:.. 
-0004e160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e170: 2020 2073 203d 2047 726f 7570 2876 616c     s = Group(val
-0004e180: 7565 7329 0d0a 2020 2020 2020 2020 2020  ues)..          
-0004e190: 2020 2020 2020 2020 2020 636f 6e74 6578            contex
-0004e1a0: 7420 3d20 7320 2023 204e 6f6e 2d52 656e  t = s  # Non-Ren
-0004e1b0: 6465 7265 640d 0a20 2020 2020 2020 2020  dered..         
-0004e1c0: 2020 2020 2020 2020 2020 2073 2e72 656e             s.ren
-0004e1d0: 6465 7228 7070 693d 7070 692c 2077 6964  der(ppi=ppi, wid
-0004e1e0: 7468 3d77 6964 7468 2c20 6865 6967 6874  th=width, height
-0004e1f0: 3d68 6569 6768 7429 0d0a 2020 2020 2020  =height)..      
-0004e200: 2020 2020 2020 2020 2020 656c 6966 2053            elif S
-0004e210: 5647 5f54 4147 5f43 4c49 5050 4154 4820  VG_TAG_CLIPPATH 
-0004e220: 3d3d 2074 6167 3a0d 0a20 2020 2020 2020  == tag:..       
-0004e230: 2020 2020 2020 2020 2020 2020 2073 203d               s =
-0004e240: 2043 6c69 7050 6174 6828 7661 6c75 6573   ClipPath(values
-0004e250: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-0004e260: 2020 2020 2020 2063 6f6e 7465 7874 203d         context =
-0004e270: 2073 2020 2320 4e6f 6e2d 5265 6e64 6572   s  # Non-Render
-0004e280: 6564 0d0a 2020 2020 2020 2020 2020 2020  ed..            
-0004e290: 2020 2020 2020 2020 732e 7265 6e64 6572          s.render
-0004e2a0: 2870 7069 3d70 7069 2c20 7769 6474 683d  (ppi=ppi, width=
-0004e2b0: 7769 6474 682c 2068 6569 6768 743d 6865  width, height=he
-0004e2c0: 6967 6874 290d 0a20 2020 2020 2020 2020  ight)..         
-0004e2d0: 2020 2020 2020 2020 2020 2063 6c69 7020             clip 
-0004e2e0: 2b3d 2031 0d0a 2020 2020 2020 2020 2020  += 1..          
-0004e2f0: 2020 2020 2020 656c 6966 2053 5647 5f54        elif SVG_T
-0004e300: 4147 5f55 5345 203d 3d20 7461 673a 0d0a  AG_USE == tag:..
-0004e310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e320: 2020 2020 7320 3d20 5573 6528 7661 6c75      s = Use(valu
-0004e330: 6573 290d 0a20 2020 2020 2020 2020 2020  es)..           
-0004e340: 2020 2020 2020 2020 2069 6620 5356 475f           if SVG_
-0004e350: 4154 5452 5f54 5241 4e53 464f 524d 2069  ATTR_TRANSFORM i
-0004e360: 6e20 732e 7661 6c75 6573 3a0d 0a20 2020  n s.values:..   
-0004e370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e380: 2020 2020 2023 2055 7064 6174 6520 7661       # Update va
-0004e390: 6c75 6520 696e 2063 6173 6520 7820 6f72  lue in case x or
-0004e3a0: 2079 2061 7070 6c69 6564 2e0d 0a20 2020   y applied...   
-0004e3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e3c0: 2020 2020 2076 616c 7565 735b 5356 475f       values[SVG_
-0004e3d0: 4154 5452 5f54 5241 4e53 464f 524d 5d20  ATTR_TRANSFORM] 
-0004e3e0: 3d20 732e 7661 6c75 6573 5b53 5647 5f41  = s.values[SVG_A
-0004e3f0: 5454 525f 5452 414e 5346 4f52 4d5d 0d0a  TTR_TRANSFORM]..
-0004e400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e410: 2020 2020 6966 2053 5647 5f41 5454 525f      if SVG_ATTR_
-0004e420: 5820 696e 2076 616c 7565 733a 0d0a 2020  X in values:..  
+0004dff0: 2020 2020 2020 2920 2023 2031 3030 3020        )  # 1000 
+0004e000: 6465 6661 756c 7420 6e6f 2069 6e66 6f72  default no infor
+0004e010: 6d61 7469 6f6e 2e0d 0a20 2020 2020 2020  mation...       
+0004e020: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0004e030: 6865 6967 6874 2069 7320 4e6f 6e65 3a0d  height is None:.
+0004e040: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004e050: 2020 2020 2020 2020 2068 6569 6768 7420           height 
+0004e060: 3d20 732e 7669 6577 626f 782e 6865 6967  = s.viewbox.heig
+0004e070: 6874 2069 6620 732e 7669 6577 626f 7820  ht if s.viewbox 
+0004e080: 6973 206e 6f74 204e 6f6e 6520 656c 7365  is not None else
+0004e090: 2031 3030 300d 0a0d 0a20 2020 2020 2020   1000....       
+0004e0a0: 2020 2020 2020 2020 2020 2020 2073 2e72               s.r
+0004e0b0: 656e 6465 7228 7070 693d 7070 692c 2077  ender(ppi=ppi, w
+0004e0c0: 6964 7468 3d77 6964 7468 2c20 6865 6967  idth=width, heig
+0004e0d0: 6874 3d68 6569 6768 742c 2076 6965 7762  ht=height, viewb
+0004e0e0: 6f78 3d73 2e76 6965 7762 6f78 290d 0a20  ox=s.viewbox).. 
+0004e0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e100: 2020 2068 6569 6768 742c 2077 6964 7468     height, width
+0004e110: 203d 2073 2e77 6964 7468 2c20 732e 6865   = s.width, s.he
+0004e120: 6967 6874 0d0a 2020 2020 2020 2020 2020  ight..          
+0004e130: 2020 2020 2020 2020 2020 6966 2073 2e76            if s.v
+0004e140: 6965 7762 6f78 2069 7320 6e6f 7420 4e6f  iewbox is not No
+0004e150: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
+0004e160: 2020 2020 2020 2020 2020 2020 2074 7279               try
+0004e170: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0004e180: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0004e190: 6620 732e 6865 6967 6874 203d 3d20 3020  f s.height == 0 
+0004e1a0: 6f72 2073 2e77 6964 7468 203d 3d20 303a  or s.width == 0:
+0004e1b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0004e1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e1d0: 2020 7265 7475 726e 2073 0d0a 2020 2020    return s..    
+0004e1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e1f0: 2020 2020 2020 2020 7669 6577 706f 7274          viewport
+0004e200: 5f74 7261 6e73 666f 726d 203d 2073 2e76  _transform = s.v
+0004e210: 6965 7762 6f78 5f74 7261 6e73 666f 726d  iewbox_transform
+0004e220: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0004e230: 2020 2020 2020 2020 2020 6578 6365 7074            except
+0004e240: 205a 6572 6f44 6976 6973 696f 6e45 7272   ZeroDivisionErr
+0004e250: 6f72 3a0d 0a20 2020 2020 2020 2020 2020  or:..           
+0004e260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e270: 2023 2054 6865 2077 6964 7468 206f 7220   # The width or 
+0004e280: 6865 6967 6874 2077 6173 207a 6572 6f2e  height was zero.
+0004e290: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0004e2a0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0004e2b0: 6874 7470 733a 2f2f 7777 772e 7733 2e6f  https://www.w3.o
+0004e2c0: 7267 2f54 522f 5356 4731 312f 7374 7275  rg/TR/SVG11/stru
+0004e2d0: 6374 2e68 746d 6c23 5356 4745 6c65 6d65  ct.html#SVGEleme
+0004e2e0: 6e74 5769 6474 6841 7474 7269 6275 7465  ntWidthAttribute
+0004e2f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0004e300: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0004e310: 2241 2076 616c 7565 206f 6620 7a65 726f  "A value of zero
+0004e320: 2064 6973 6162 6c65 7320 7265 6e64 6572   disables render
+0004e330: 696e 6720 6f66 2074 6865 2065 6c65 6d65  ing of the eleme
+0004e340: 6e74 2e22 0d0a 2020 2020 2020 2020 2020  nt."..          
+0004e350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e360: 2020 7265 7475 726e 2073 2020 2320 4e6f    return s  # No
+0004e370: 206d 6f72 6520 7061 7273 696e 6720 7769   more parsing wi
+0004e380: 6c6c 2062 6520 646f 6e65 2e0d 0a0d 0a20  ll be done..... 
+0004e390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e3a0: 2020 2020 2020 2069 6620 5356 475f 4154         if SVG_AT
+0004e3b0: 5452 5f54 5241 4e53 464f 524d 2069 6e20  TR_TRANSFORM in 
+0004e3c0: 7661 6c75 6573 3a0d 0a20 2020 2020 2020  values:..       
+0004e3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e3e0: 2020 2020 2023 2074 7261 6e73 666f 726d       # transform
+0004e3f0: 206f 6e20 5356 4720 656c 656d 656e 7420   on SVG element 
+0004e400: 6170 706c 6965 6420 6173 2069 6620 7376  applied as if sv
+0004e410: 6720 6861 6420 7061 7265 6e74 2077 6974  g had parent wit
+0004e420: 6820 7472 616e 7366 6f72 6d2e 0d0a 2020  h transform...  
 0004e430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e440: 2020 2020 2020 6465 6c20 7661 6c75 6573        del values
-0004e450: 5b53 5647 5f41 5454 525f 585d 0d0a 2020  [SVG_ATTR_X]..  
-0004e460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e470: 2020 6966 2053 5647 5f41 5454 525f 5920    if SVG_ATTR_Y 
-0004e480: 696e 2076 616c 7565 733a 0d0a 2020 2020  in values:..    
-0004e490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e4a0: 2020 2020 6465 6c20 7661 6c75 6573 5b53      del values[S
-0004e4b0: 5647 5f41 5454 525f 595d 0d0a 2020 2020  VG_ATTR_Y]..    
-0004e4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e4d0: 6966 2053 5647 5f41 5454 525f 5749 4454  if SVG_ATTR_WIDT
-0004e4e0: 4820 696e 2076 616c 7565 733a 0d0a 2020  H in values:..  
+0004e440: 2020 2020 2020 2020 2020 7661 6c75 6573            values
+0004e450: 5b53 5647 5f41 5454 525f 5452 414e 5346  [SVG_ATTR_TRANSF
+0004e460: 4f52 4d5d 202b 3d20 2220 2220 2b20 7669  ORM] += " " + vi
+0004e470: 6577 706f 7274 5f74 7261 6e73 666f 726d  ewport_transform
+0004e480: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0004e490: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
+0004e4a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004e4b0: 2020 2020 2020 2020 2020 2020 2076 616c               val
+0004e4c0: 7565 735b 5356 475f 4154 5452 5f54 5241  ues[SVG_ATTR_TRA
+0004e4d0: 4e53 464f 524d 5d20 3d20 7669 6577 706f  NSFORM] = viewpo
+0004e4e0: 7274 5f74 7261 6e73 666f 726d 0d0a 2020  rt_transform..  
 0004e4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e500: 2020 2020 2020 6465 6c20 7661 6c75 6573        del values
-0004e510: 5b53 5647 5f41 5454 525f 5749 4454 485d  [SVG_ATTR_WIDTH]
-0004e520: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0004e530: 2020 2020 2020 6966 2053 5647 5f41 5454        if SVG_ATT
-0004e540: 525f 4845 4947 4854 2069 6e20 7661 6c75  R_HEIGHT in valu
-0004e550: 6573 3a0d 0a20 2020 2020 2020 2020 2020  es:..           
-0004e560: 2020 2020 2020 2020 2020 2020 2064 656c               del
-0004e570: 2076 616c 7565 735b 5356 475f 4154 5452   values[SVG_ATTR
-0004e580: 5f48 4549 4748 545d 0d0a 2020 2020 2020  _HEIGHT]..      
-0004e590: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0004e5a0: 2063 6f6e 7465 7874 2069 7320 6e6f 7420   context is not 
-0004e5b0: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
-0004e5c0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0004e5d0: 6f6e 7465 7874 2e61 7070 656e 6428 7329  ontext.append(s)
-0004e5e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0004e5f0: 2020 2020 2020 636f 6e74 6578 7420 3d20        context = 
-0004e600: 730d 0a20 2020 2020 2020 2020 2020 2020  s..             
-0004e610: 2020 2020 2020 2075 7365 202b 3d20 310d         use += 1.
-0004e620: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004e630: 2020 2020 2069 6620 5356 475f 4154 5452       if SVG_ATTR
-0004e640: 5f49 4420 696e 2061 7474 7269 6275 7465  _ID in attribute
-0004e650: 7320 616e 6420 726f 6f74 2069 7320 6e6f  s and root is no
-0004e660: 7420 4e6f 6e65 2061 6e64 2075 7365 203d  t None and use =
-0004e670: 3d20 313a 0d0a 2020 2020 2020 2020 2020  = 1:..          
-0004e680: 2020 2020 2020 2020 2020 2020 2020 726f                ro
-0004e690: 6f74 2e6f 626a 6563 7473 5b61 7474 7269  ot.objects[attri
-0004e6a0: 6275 7465 735b 5356 475f 4154 5452 5f49  butes[SVG_ATTR_I
-0004e6b0: 445d 5d20 3d20 730d 0a20 2020 2020 2020  D]] = s..       
-0004e6c0: 2020 2020 2020 2020 2065 6c69 6620 5356           elif SV
-0004e6d0: 475f 5441 475f 5041 5454 4552 4e20 3d3d  G_TAG_PATTERN ==
-0004e6e0: 2074 6167 3a0d 0a20 2020 2020 2020 2020   tag:..         
-0004e6f0: 2020 2020 2020 2020 2020 2073 203d 2050             s = P
-0004e700: 6174 7465 726e 2876 616c 7565 7329 0d0a  attern(values)..
+0004e500: 2020 2020 2020 7661 6c75 6573 5b22 7669        values["vi
+0004e510: 6577 706f 7274 5f74 7261 6e73 666f 726d  ewport_transform
+0004e520: 225d 203d 2076 616c 7565 735b 5356 475f  "] = values[SVG_
+0004e530: 4154 5452 5f54 5241 4e53 464f 524d 5d0d  ATTR_TRANSFORM].
+0004e540: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004e550: 2020 2020 2020 2020 2077 6964 7468 2c20           width, 
+0004e560: 6865 6967 6874 203d 2073 2e76 6965 7762  height = s.viewb
+0004e570: 6f78 2e77 6964 7468 2c20 732e 7669 6577  ox.width, s.view
+0004e580: 626f 782e 6865 6967 6874 0d0a 2020 2020  box.height..    
+0004e590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e5a0: 6966 2063 6f6e 7465 7874 2069 7320 4e6f  if context is No
+0004e5b0: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
+0004e5c0: 2020 2020 2020 2020 2020 2020 2073 7461               sta
+0004e5d0: 636b 5b2d 315d 203d 2028 636f 6e74 6578  ck[-1] = (contex
+0004e5e0: 742c 2076 616c 7565 7329 0d0a 2020 2020  t, values)..    
+0004e5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e600: 6966 2063 6f6e 7465 7874 2069 7320 6e6f  if context is no
+0004e610: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
+0004e620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e630: 2063 6f6e 7465 7874 2e61 7070 656e 6428   context.append(
+0004e640: 7329 0d0a 2020 2020 2020 2020 2020 2020  s)..            
+0004e650: 2020 2020 2020 2020 636f 6e74 6578 7420          context 
+0004e660: 3d20 730d 0a20 2020 2020 2020 2020 2020  = s..           
+0004e670: 2020 2020 2065 6c69 6620 5356 475f 5441       elif SVG_TA
+0004e680: 475f 4752 4f55 5020 3d3d 2074 6167 3a0d  G_GROUP == tag:.
+0004e690: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004e6a0: 2020 2020 2073 203d 2047 726f 7570 2876       s = Group(v
+0004e6b0: 616c 7565 7329 0d0a 2020 2020 2020 2020  alues)..        
+0004e6c0: 2020 2020 2020 2020 2020 2020 6966 2063              if c
+0004e6d0: 6f6e 7465 7874 2069 7320 6e6f 7420 4e6f  ontext is not No
+0004e6e0: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
+0004e6f0: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+0004e700: 7465 7874 2e61 7070 656e 6428 7329 0d0a  text.append(s)..
 0004e710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e720: 2020 2020 636f 6e74 6578 7420 3d20 7320      context = s 
-0004e730: 2023 204e 6f6e 2d72 656e 6465 7265 640d   # Non-rendered.
-0004e740: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004e750: 2020 2020 2073 2e72 656e 6465 7228 7070       s.render(pp
-0004e760: 693d 7070 692c 2077 6964 7468 3d77 6964  i=ppi, width=wid
-0004e770: 7468 2c20 6865 6967 6874 3d68 6569 6768  th, height=heigh
-0004e780: 7429 0d0a 2020 2020 2020 2020 2020 2020  t)..            
-0004e790: 2020 2020 656c 6966 2074 6167 2069 6e20      elif tag in 
-0004e7a0: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
-0004e7b0: 2020 2020 2020 2053 5647 5f54 4147 5f50         SVG_TAG_P
-0004e7c0: 4154 482c 0d0a 2020 2020 2020 2020 2020  ATH,..          
-0004e7d0: 2020 2020 2020 2020 2020 5356 475f 5441            SVG_TA
-0004e7e0: 475f 4349 5243 4c45 2c0d 0a20 2020 2020  G_CIRCLE,..     
-0004e7f0: 2020 2020 2020 2020 2020 2020 2020 2053                 S
-0004e800: 5647 5f54 4147 5f45 4c4c 4950 5345 2c0d  VG_TAG_ELLIPSE,.
-0004e810: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004e820: 2020 2020 2053 5647 5f54 4147 5f4c 494e       SVG_TAG_LIN
-0004e830: 452c 2020 2320 5368 6170 6573 0d0a 2020  E,  # Shapes..  
-0004e840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e850: 2020 5356 475f 5441 475f 504f 4c59 4c49    SVG_TAG_POLYLI
-0004e860: 4e45 2c0d 0a20 2020 2020 2020 2020 2020  NE,..           
-0004e870: 2020 2020 2020 2020 2053 5647 5f54 4147           SVG_TAG
-0004e880: 5f50 4f4c 5947 4f4e 2c0d 0a20 2020 2020  _POLYGON,..     
-0004e890: 2020 2020 2020 2020 2020 2020 2020 2053                 S
-0004e8a0: 5647 5f54 4147 5f52 4543 542c 0d0a 2020  VG_TAG_RECT,..  
-0004e8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e8c0: 2020 5356 475f 5441 475f 494d 4147 452c    SVG_TAG_IMAGE,
-0004e8d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0004e8e0: 2020 293a 0d0a 2020 2020 2020 2020 2020    ):..          
-0004e8f0: 2020 2020 2020 2020 2020 7472 793a 0d0a            try:..
-0004e900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e910: 2020 2020 2020 2020 6966 2053 5647 5f54          if SVG_T
-0004e920: 4147 5f50 4154 4820 3d3d 2074 6167 3a0d  AG_PATH == tag:.
-0004e930: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004e940: 2020 2020 2020 2020 2020 2020 2073 203d               s =
-0004e950: 2050 6174 6828 7661 6c75 6573 290d 0a20   Path(values).. 
-0004e960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e970: 2020 2020 2020 2065 6c69 6620 5356 475f         elif SVG_
-0004e980: 5441 475f 4349 5243 4c45 203d 3d20 7461  TAG_CIRCLE == ta
-0004e990: 673a 0d0a 2020 2020 2020 2020 2020 2020  g:..            
-0004e9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e9b0: 7320 3d20 4369 7263 6c65 2876 616c 7565  s = Circle(value
-0004e9c0: 7329 0d0a 2020 2020 2020 2020 2020 2020  s)..            
-0004e9d0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-0004e9e0: 2053 5647 5f54 4147 5f45 4c4c 4950 5345   SVG_TAG_ELLIPSE
-0004e9f0: 203d 3d20 7461 673a 0d0a 2020 2020 2020   == tag:..      
-0004ea00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ea10: 2020 2020 2020 7320 3d20 456c 6c69 7073        s = Ellips
-0004ea20: 6528 7661 6c75 6573 290d 0a20 2020 2020  e(values)..     
-0004ea30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ea40: 2020 2065 6c69 6620 5356 475f 5441 475f     elif SVG_TAG_
-0004ea50: 4c49 4e45 203d 3d20 7461 673a 0d0a 2020  LINE == tag:..  
-0004ea60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ea70: 2020 2020 2020 2020 2020 7320 3d20 5369            s = Si
-0004ea80: 6d70 6c65 4c69 6e65 2876 616c 7565 7329  mpleLine(values)
-0004ea90: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0004eaa0: 2020 2020 2020 2020 2020 656c 6966 2053            elif S
-0004eab0: 5647 5f54 4147 5f50 4f4c 594c 494e 4520  VG_TAG_POLYLINE 
-0004eac0: 3d3d 2074 6167 3a0d 0a20 2020 2020 2020  == tag:..       
+0004e720: 2020 2020 636f 6e74 6578 7420 3d20 730d      context = s.
+0004e730: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004e740: 2020 2020 2073 2e72 656e 6465 7228 7070       s.render(pp
+0004e750: 693d 7070 692c 2077 6964 7468 3d77 6964  i=ppi, width=wid
+0004e760: 7468 2c20 6865 6967 6874 3d68 6569 6768  th, height=heigh
+0004e770: 7429 0d0a 2020 2020 2020 2020 2020 2020  t)..            
+0004e780: 2020 2020 656c 6966 2053 5647 5f54 4147      elif SVG_TAG
+0004e790: 5f44 4546 5320 3d3d 2074 6167 3a0d 0a20  _DEFS == tag:.. 
+0004e7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e7b0: 2020 2073 203d 2047 726f 7570 2876 616c     s = Group(val
+0004e7c0: 7565 7329 0d0a 2020 2020 2020 2020 2020  ues)..          
+0004e7d0: 2020 2020 2020 2020 2020 636f 6e74 6578            contex
+0004e7e0: 7420 3d20 7320 2023 204e 6f6e 2d52 656e  t = s  # Non-Ren
+0004e7f0: 6465 7265 640d 0a20 2020 2020 2020 2020  dered..         
+0004e800: 2020 2020 2020 2020 2020 2073 2e72 656e             s.ren
+0004e810: 6465 7228 7070 693d 7070 692c 2077 6964  der(ppi=ppi, wid
+0004e820: 7468 3d77 6964 7468 2c20 6865 6967 6874  th=width, height
+0004e830: 3d68 6569 6768 7429 0d0a 2020 2020 2020  =height)..      
+0004e840: 2020 2020 2020 2020 2020 656c 6966 2053            elif S
+0004e850: 5647 5f54 4147 5f43 4c49 5050 4154 4820  VG_TAG_CLIPPATH 
+0004e860: 3d3d 2074 6167 3a0d 0a20 2020 2020 2020  == tag:..       
+0004e870: 2020 2020 2020 2020 2020 2020 2073 203d               s =
+0004e880: 2043 6c69 7050 6174 6828 7661 6c75 6573   ClipPath(values
+0004e890: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+0004e8a0: 2020 2020 2020 2063 6f6e 7465 7874 203d         context =
+0004e8b0: 2073 2020 2320 4e6f 6e2d 5265 6e64 6572   s  # Non-Render
+0004e8c0: 6564 0d0a 2020 2020 2020 2020 2020 2020  ed..            
+0004e8d0: 2020 2020 2020 2020 732e 7265 6e64 6572          s.render
+0004e8e0: 2870 7069 3d70 7069 2c20 7769 6474 683d  (ppi=ppi, width=
+0004e8f0: 7769 6474 682c 2068 6569 6768 743d 6865  width, height=he
+0004e900: 6967 6874 290d 0a20 2020 2020 2020 2020  ight)..         
+0004e910: 2020 2020 2020 2020 2020 2063 6c69 7020             clip 
+0004e920: 2b3d 2031 0d0a 2020 2020 2020 2020 2020  += 1..          
+0004e930: 2020 2020 2020 656c 6966 2053 5647 5f54        elif SVG_T
+0004e940: 4147 5f55 5345 203d 3d20 7461 673a 0d0a  AG_USE == tag:..
+0004e950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e960: 2020 2020 7320 3d20 5573 6528 7661 6c75      s = Use(valu
+0004e970: 6573 290d 0a20 2020 2020 2020 2020 2020  es)..           
+0004e980: 2020 2020 2020 2020 2069 6620 5356 475f           if SVG_
+0004e990: 4154 5452 5f54 5241 4e53 464f 524d 2069  ATTR_TRANSFORM i
+0004e9a0: 6e20 732e 7661 6c75 6573 3a0d 0a20 2020  n s.values:..   
+0004e9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e9c0: 2020 2020 2023 2055 7064 6174 6520 7661       # Update va
+0004e9d0: 6c75 6520 696e 2063 6173 6520 7820 6f72  lue in case x or
+0004e9e0: 2079 2061 7070 6c69 6564 2e0d 0a20 2020   y applied...   
+0004e9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ea00: 2020 2020 2076 616c 7565 735b 5356 475f       values[SVG_
+0004ea10: 4154 5452 5f54 5241 4e53 464f 524d 5d20  ATTR_TRANSFORM] 
+0004ea20: 3d20 732e 7661 6c75 6573 5b53 5647 5f41  = s.values[SVG_A
+0004ea30: 5454 525f 5452 414e 5346 4f52 4d5d 0d0a  TTR_TRANSFORM]..
+0004ea40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ea50: 2020 2020 6966 2053 5647 5f41 5454 525f      if SVG_ATTR_
+0004ea60: 5820 696e 2076 616c 7565 733a 0d0a 2020  X in values:..  
+0004ea70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ea80: 2020 2020 2020 6465 6c20 7661 6c75 6573        del values
+0004ea90: 5b53 5647 5f41 5454 525f 585d 0d0a 2020  [SVG_ATTR_X]..  
+0004eaa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004eab0: 2020 6966 2053 5647 5f41 5454 525f 5920    if SVG_ATTR_Y 
+0004eac0: 696e 2076 616c 7565 733a 0d0a 2020 2020  in values:..    
 0004ead0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004eae0: 2020 2020 2073 203d 2050 6f6c 796c 696e       s = Polylin
-0004eaf0: 6528 7661 6c75 6573 290d 0a20 2020 2020  e(values)..     
+0004eae0: 2020 2020 6465 6c20 7661 6c75 6573 5b53      del values[S
+0004eaf0: 5647 5f41 5454 525f 595d 0d0a 2020 2020  VG_ATTR_Y]..    
 0004eb00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004eb10: 2020 2065 6c69 6620 5356 475f 5441 475f     elif SVG_TAG_
-0004eb20: 504f 4c59 474f 4e20 3d3d 2074 6167 3a0d  POLYGON == tag:.
-0004eb30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004eb40: 2020 2020 2020 2020 2020 2020 2073 203d               s =
-0004eb50: 2050 6f6c 7967 6f6e 2876 616c 7565 7329   Polygon(values)
+0004eb10: 6966 2053 5647 5f41 5454 525f 5749 4454  if SVG_ATTR_WIDT
+0004eb20: 4820 696e 2076 616c 7565 733a 0d0a 2020  H in values:..  
+0004eb30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004eb40: 2020 2020 2020 6465 6c20 7661 6c75 6573        del values
+0004eb50: 5b53 5647 5f41 5454 525f 5749 4454 485d  [SVG_ATTR_WIDTH]
 0004eb60: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0004eb70: 2020 2020 2020 2020 2020 656c 6966 2053            elif S
-0004eb80: 5647 5f54 4147 5f52 4543 5420 3d3d 2074  VG_TAG_RECT == t
-0004eb90: 6167 3a0d 0a20 2020 2020 2020 2020 2020  ag:..           
-0004eba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ebb0: 2073 203d 2052 6563 7428 7661 6c75 6573   s = Rect(values
-0004ebc0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-0004ebd0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0004ebe0: 2020 2320 5356 475f 5441 475f 494d 4147    # SVG_TAG_IMAG
-0004ebf0: 4520 3d3d 2074 6167 3a0d 0a20 2020 2020  E == tag:..     
-0004ec00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ec10: 2020 2020 2020 2073 203d 2049 6d61 6765         s = Image
-0004ec20: 2876 616c 7565 7329 0d0a 2020 2020 2020  (values)..      
-0004ec30: 2020 2020 2020 2020 2020 2020 2020 6578                ex
-0004ec40: 6365 7074 2056 616c 7565 4572 726f 723a  cept ValueError:
-0004ec50: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0004ec60: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
-0004ec70: 7565 0d0a 2020 2020 2020 2020 2020 2020  ue..            
-0004ec80: 2020 2020 2020 2020 732e 7265 6e64 6572          s.render
-0004ec90: 2870 7069 3d70 7069 2c20 7769 6474 683d  (ppi=ppi, width=
-0004eca0: 7769 6474 682c 2068 6569 6768 743d 6865  width, height=he
-0004ecb0: 6967 6874 290d 0a20 2020 2020 2020 2020  ight)..         
-0004ecc0: 2020 2020 2020 2020 2020 2069 6620 7265             if re
-0004ecd0: 6966 793a 0d0a 2020 2020 2020 2020 2020  ify:..          
-0004ece0: 2020 2020 2020 2020 2020 2020 2020 732e                s.
-0004ecf0: 7265 6966 7928 290d 0a20 2020 2020 2020  reify()..       
-0004ed00: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0004ed10: 732e 6973 5f64 6567 656e 6572 6174 6528  s.is_degenerate(
-0004ed20: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-0004ed30: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-0004ed40: 696e 7565 0d0a 2020 2020 2020 2020 2020  inue..          
-0004ed50: 2020 2020 2020 2020 2020 6966 2063 6f6e            if con
-0004ed60: 7465 7874 2069 7320 6e6f 7420 4e6f 6e65  text is not None
-0004ed70: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0004ed80: 2020 2020 2020 2020 2020 2063 6f6e 7465             conte
-0004ed90: 7874 2e61 7070 656e 6428 7329 0d0a 2020  xt.append(s)..  
-0004eda0: 2020 2020 2020 2020 2020 2020 2020 656c                el
-0004edb0: 6966 2074 6167 2069 6e20 280d 0a20 2020  if tag in (..   
-0004edc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004edd0: 2053 5647 5f54 4147 5f53 5459 4c45 2c0d   SVG_TAG_STYLE,.
-0004ede0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004edf0: 2020 2020 2053 5647 5f54 4147 5f54 4558       SVG_TAG_TEX
-0004ee00: 542c 0d0a 2020 2020 2020 2020 2020 2020  T,..            
-0004ee10: 2020 2020 2020 2020 5356 475f 5441 475f          SVG_TAG_
-0004ee20: 4445 5343 2c0d 0a20 2020 2020 2020 2020  DESC,..         
-0004ee30: 2020 2020 2020 2020 2020 2053 5647 5f54             SVG_T
-0004ee40: 4147 5f54 4954 4c45 2c0d 0a20 2020 2020  AG_TITLE,..     
-0004ee50: 2020 2020 2020 2020 2020 2020 2020 2053                 S
-0004ee60: 5647 5f54 4147 5f54 5350 414e 2c0d 0a20  VG_TAG_TSPAN,.. 
-0004ee70: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-0004ee80: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0004ee90: 2020 2020 2020 2023 203c 7374 796c 653e         # <style>
-0004eea0: 2c20 3c74 6578 743e 2c20 3c64 6573 633e  , <text>, <desc>
-0004eeb0: 2c20 3c74 6974 6c65 3e0d 0a20 2020 2020  , <title>..     
-0004eec0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0004eed0: 6f6e 7469 6e75 650d 0a20 2020 2020 2020  ontinue..       
-0004eee0: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
+0004eb70: 2020 2020 2020 6966 2053 5647 5f41 5454        if SVG_ATT
+0004eb80: 525f 4845 4947 4854 2069 6e20 7661 6c75  R_HEIGHT in valu
+0004eb90: 6573 3a0d 0a20 2020 2020 2020 2020 2020  es:..           
+0004eba0: 2020 2020 2020 2020 2020 2020 2064 656c               del
+0004ebb0: 2076 616c 7565 735b 5356 475f 4154 5452   values[SVG_ATTR
+0004ebc0: 5f48 4549 4748 545d 0d0a 2020 2020 2020  _HEIGHT]..      
+0004ebd0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0004ebe0: 2063 6f6e 7465 7874 2069 7320 6e6f 7420   context is not 
+0004ebf0: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
+0004ec00: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0004ec10: 6f6e 7465 7874 2e61 7070 656e 6428 7329  ontext.append(s)
+0004ec20: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0004ec30: 2020 2020 2020 636f 6e74 6578 7420 3d20        context = 
+0004ec40: 730d 0a20 2020 2020 2020 2020 2020 2020  s..             
+0004ec50: 2020 2020 2020 2075 7365 202b 3d20 310d         use += 1.
+0004ec60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004ec70: 2020 2020 2069 6620 5356 475f 4154 5452       if SVG_ATTR
+0004ec80: 5f49 4420 696e 2061 7474 7269 6275 7465  _ID in attribute
+0004ec90: 7320 616e 6420 726f 6f74 2069 7320 6e6f  s and root is no
+0004eca0: 7420 4e6f 6e65 2061 6e64 2075 7365 203d  t None and use =
+0004ecb0: 3d20 313a 0d0a 2020 2020 2020 2020 2020  = 1:..          
+0004ecc0: 2020 2020 2020 2020 2020 2020 2020 726f                ro
+0004ecd0: 6f74 2e6f 626a 6563 7473 5b61 7474 7269  ot.objects[attri
+0004ece0: 6275 7465 735b 5356 475f 4154 5452 5f49  butes[SVG_ATTR_I
+0004ecf0: 445d 5d20 3d20 730d 0a20 2020 2020 2020  D]] = s..       
+0004ed00: 2020 2020 2020 2020 2065 6c69 6620 5356           elif SV
+0004ed10: 475f 5441 475f 5041 5454 4552 4e20 3d3d  G_TAG_PATTERN ==
+0004ed20: 2074 6167 3a0d 0a20 2020 2020 2020 2020   tag:..         
+0004ed30: 2020 2020 2020 2020 2020 2073 203d 2050             s = P
+0004ed40: 6174 7465 726e 2876 616c 7565 7329 0d0a  attern(values)..
+0004ed50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ed60: 2020 2020 636f 6e74 6578 7420 3d20 7320      context = s 
+0004ed70: 2023 204e 6f6e 2d72 656e 6465 7265 640d   # Non-rendered.
+0004ed80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004ed90: 2020 2020 2073 2e72 656e 6465 7228 7070       s.render(pp
+0004eda0: 693d 7070 692c 2077 6964 7468 3d77 6964  i=ppi, width=wid
+0004edb0: 7468 2c20 6865 6967 6874 3d68 6569 6768  th, height=heigh
+0004edc0: 7429 0d0a 2020 2020 2020 2020 2020 2020  t)..            
+0004edd0: 2020 2020 656c 6966 2074 6167 2069 6e20      elif tag in 
+0004ede0: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
+0004edf0: 2020 2020 2020 2053 5647 5f54 4147 5f50         SVG_TAG_P
+0004ee00: 4154 482c 0d0a 2020 2020 2020 2020 2020  ATH,..          
+0004ee10: 2020 2020 2020 2020 2020 5356 475f 5441            SVG_TA
+0004ee20: 475f 4349 5243 4c45 2c0d 0a20 2020 2020  G_CIRCLE,..     
+0004ee30: 2020 2020 2020 2020 2020 2020 2020 2053                 S
+0004ee40: 5647 5f54 4147 5f45 4c4c 4950 5345 2c0d  VG_TAG_ELLIPSE,.
+0004ee50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004ee60: 2020 2020 2053 5647 5f54 4147 5f4c 494e       SVG_TAG_LIN
+0004ee70: 452c 2020 2320 5368 6170 6573 0d0a 2020  E,  # Shapes..  
+0004ee80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ee90: 2020 5356 475f 5441 475f 504f 4c59 4c49    SVG_TAG_POLYLI
+0004eea0: 4e45 2c0d 0a20 2020 2020 2020 2020 2020  NE,..           
+0004eeb0: 2020 2020 2020 2020 2053 5647 5f54 4147           SVG_TAG
+0004eec0: 5f50 4f4c 5947 4f4e 2c0d 0a20 2020 2020  _POLYGON,..     
+0004eed0: 2020 2020 2020 2020 2020 2020 2020 2053                 S
+0004eee0: 5647 5f54 4147 5f52 4543 542c 0d0a 2020  VG_TAG_RECT,..  
 0004eef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ef00: 2020 2020 7320 3d20 5356 4745 6c65 6d65      s = SVGEleme
-0004ef10: 6e74 2876 616c 7565 7329 2020 2320 5356  nt(values)  # SV
-0004ef20: 4720 556e 6b6e 6f77 6e20 6f62 6a65 6374  G Unknown object
-0004ef30: 2072 6574 7572 6e20 6173 2065 6c65 6d65   return as eleme
-0004ef40: 6e74 2e0d 0a20 2020 2020 2020 2020 2020  nt...           
-0004ef50: 2020 2020 2020 2020 2069 6620 636f 6e74           if cont
-0004ef60: 6578 7420 6973 206e 6f74 204e 6f6e 653a  ext is not None:
-0004ef70: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0004ef80: 2020 2020 2020 2020 2020 636f 6e74 6578            contex
-0004ef90: 742e 6170 7065 6e64 2873 290d 0a20 2020  t.append(s)..   
-0004efa0: 2020 2020 2020 2020 2020 2020 2023 2049               # I
-0004efb0: 6620 6e6f 2072 6f6f 7420 7761 7320 6573  f no root was es
-0004efc0: 7461 626c 6973 6865 642c 2073 2069 7320  tablished, s is 
-0004efd0: 726f 6f74 2e0d 0a20 2020 2020 2020 2020  root...         
-0004efe0: 2020 2020 2020 2069 6620 726f 6f74 2069         if root i
-0004eff0: 7320 4e6f 6e65 3a0d 0a20 2020 2020 2020  s None:..       
-0004f000: 2020 2020 2020 2020 2020 2020 2072 6f6f               roo
-0004f010: 7420 3d20 730d 0a20 2020 2020 2020 2020  t = s..         
-0004f020: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-0004f030: 616e 6365 2872 6f6f 742c 2053 5647 293a  ance(root, SVG):
-0004f040: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0004f050: 2020 2020 2020 2320 4173 7369 676e 206f        # Assign o
-0004f060: 7074 696f 6e61 6c20 6c69 6e6b 6564 2070  ptional linked p
-0004f070: 726f 7065 7274 6965 732e 0d0a 2020 2020  roperties...    
+0004ef00: 2020 5356 475f 5441 475f 494d 4147 452c    SVG_TAG_IMAGE,
+0004ef10: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0004ef20: 2020 293a 0d0a 2020 2020 2020 2020 2020    ):..          
+0004ef30: 2020 2020 2020 2020 2020 7061 7273 655f            parse_
+0004ef40: 6572 726f 7220 3d20 4e6f 6e65 0d0a 2020  error = None..  
+0004ef50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ef60: 2020 7320 3d20 4e6f 6e65 0d0a 2020 2020    s = None..    
+0004ef70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ef80: 7472 793a 0d0a 2020 2020 2020 2020 2020  try:..          
+0004ef90: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0004efa0: 2053 5647 5f54 4147 5f50 4154 4820 3d3d   SVG_TAG_PATH ==
+0004efb0: 2074 6167 3a0d 0a20 2020 2020 2020 2020   tag:..         
+0004efc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004efd0: 2020 2023 2044 656c 6179 6564 2070 6174     # Delayed pat
+0004efe0: 6820 7061 7273 696e 672c 2066 6f72 2070  h parsing, for p
+0004eff0: 6172 7469 616c 2070 6174 6873 2e0d 0a20  artial paths... 
+0004f000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f010: 2020 2020 2020 2020 2020 2073 203d 2050             s = P
+0004f020: 6174 6828 7661 6c75 6573 2c20 7061 7468  ath(values, path
+0004f030: 645f 6c6f 6164 6564 3d54 7275 6529 0d0a  d_loaded=True)..
+0004f040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f050: 2020 2020 2020 2020 2020 2020 732e 7061              s.pa
+0004f060: 7273 6528 7661 6c75 6573 2e67 6574 2853  rse(values.get(S
+0004f070: 5647 5f41 5454 525f 4441 5441 2929 0d0a  VG_ATTR_DATA))..
 0004f080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f090: 7472 793a 0d0a 2020 2020 2020 2020 2020  try:..          
-0004f0a0: 2020 2020 2020 2020 2020 2020 2020 636c                cl
-0004f0b0: 6970 5f70 6174 685f 7572 6c20 3d20 732e  ip_path_url = s.
-0004f0c0: 7661 6c75 6573 2e67 6574 2853 5647 5f41  values.get(SVG_A
-0004f0d0: 5454 525f 434c 4950 5f50 4154 482c 204e  TTR_CLIP_PATH, N
-0004f0e0: 6f6e 6529 0d0a 2020 2020 2020 2020 2020  one)..          
-0004f0f0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0004f100: 2063 6c69 705f 7061 7468 5f75 726c 2069   clip_path_url i
-0004f110: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
+0004f090: 2020 2020 2020 2020 656c 6966 2053 5647          elif SVG
+0004f0a0: 5f54 4147 5f43 4952 434c 4520 3d3d 2074  _TAG_CIRCLE == t
+0004f0b0: 6167 3a0d 0a20 2020 2020 2020 2020 2020  ag:..           
+0004f0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f0d0: 2073 203d 2043 6972 636c 6528 7661 6c75   s = Circle(valu
+0004f0e0: 6573 290d 0a20 2020 2020 2020 2020 2020  es)..           
+0004f0f0: 2020 2020 2020 2020 2020 2020 2065 6c69               eli
+0004f100: 6620 5356 475f 5441 475f 454c 4c49 5053  f SVG_TAG_ELLIPS
+0004f110: 4520 3d3d 2074 6167 3a0d 0a20 2020 2020  E == tag:..     
 0004f120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f130: 2020 2020 2020 2020 2063 6c69 705f 7061           clip_pa
-0004f140: 7468 203d 2072 6f6f 742e 6765 745f 656c  th = root.get_el
-0004f150: 656d 656e 745f 6279 5f75 726c 2863 6c69  ement_by_url(cli
-0004f160: 705f 7061 7468 5f75 726c 290d 0a20 2020  p_path_url)..   
-0004f170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f180: 2020 2020 2020 2020 2073 2e63 6c69 705f           s.clip_
-0004f190: 7061 7468 203d 2063 6c69 705f 7061 7468  path = clip_path
-0004f1a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0004f1b0: 2020 2020 2020 6578 6365 7074 2041 7474        except Att
-0004f1c0: 7269 6275 7465 4572 726f 723a 0d0a 2020  ributeError:..  
-0004f1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f1e0: 2020 2020 2020 7061 7373 0d0a 2020 2020        pass..    
+0004f130: 2020 2020 2020 2073 203d 2045 6c6c 6970         s = Ellip
+0004f140: 7365 2876 616c 7565 7329 0d0a 2020 2020  se(values)..    
+0004f150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f160: 2020 2020 656c 6966 2053 5647 5f54 4147      elif SVG_TAG
+0004f170: 5f4c 494e 4520 3d3d 2074 6167 3a0d 0a20  _LINE == tag:.. 
+0004f180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f190: 2020 2020 2020 2020 2020 2073 203d 2053             s = S
+0004f1a0: 696d 706c 654c 696e 6528 7661 6c75 6573  impleLine(values
+0004f1b0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+0004f1c0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+0004f1d0: 5356 475f 5441 475f 504f 4c59 4c49 4e45  SVG_TAG_POLYLINE
+0004f1e0: 203d 3d20 7461 673a 0d0a 2020 2020 2020   == tag:..      
 0004f1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f200: 6966 2063 6c69 7020 213d 2030 3a0d 0a20  if clip != 0:.. 
-0004f210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f220: 2020 2020 2020 2074 7279 3a0d 0a20 2020         try:..   
-0004f230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f240: 2020 2020 2020 2020 2063 6c69 705f 7275           clip_ru
-0004f250: 6c65 203d 2073 2e76 616c 7565 732e 6765  le = s.values.ge
-0004f260: 7428 0d0a 2020 2020 2020 2020 2020 2020  t(..            
-0004f270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f280: 2020 2020 5356 475f 4154 5452 5f43 4c49      SVG_ATTR_CLI
-0004f290: 505f 5255 4c45 2c20 5356 475f 5255 4c45  P_RULE, SVG_RULE
-0004f2a0: 5f4e 4f4e 5a45 524f 0d0a 2020 2020 2020  _NONZERO..      
-0004f2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f2c0: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
-0004f2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f2e0: 2020 2020 2069 6620 636c 6970 5f72 756c       if clip_rul
-0004f2f0: 6520 6973 206e 6f74 204e 6f6e 653a 0d0a  e is not None:..
-0004f300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f320: 732e 636c 6970 5f72 756c 6520 3d20 636c  s.clip_rule = cl
-0004f330: 6970 5f72 756c 650d 0a20 2020 2020 2020  ip_rule..       
-0004f340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f350: 2065 7863 6570 7420 4174 7472 6962 7574   except Attribut
-0004f360: 6545 7272 6f72 3a0d 0a20 2020 2020 2020  eError:..       
-0004f370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f380: 2020 2020 2070 6173 730d 0a20 2020 2020       pass..     
-0004f390: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0004f3a0: 6620 5356 475f 4154 5452 5f49 4420 696e  f SVG_ATTR_ID in
-0004f3b0: 2061 7474 7269 6275 7465 7320 616e 6420   attributes and 
-0004f3c0: 7573 6520 3d3d 2030 3a0d 0a20 2020 2020  use == 0:..     
+0004f200: 2020 2020 2020 7320 3d20 506f 6c79 6c69        s = Polyli
+0004f210: 6e65 2876 616c 7565 7329 0d0a 2020 2020  ne(values)..    
+0004f220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f230: 2020 2020 656c 6966 2053 5647 5f54 4147      elif SVG_TAG
+0004f240: 5f50 4f4c 5947 4f4e 203d 3d20 7461 673a  _POLYGON == tag:
+0004f250: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0004f260: 2020 2020 2020 2020 2020 2020 2020 7320                s 
+0004f270: 3d20 506f 6c79 676f 6e28 7661 6c75 6573  = Polygon(values
+0004f280: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+0004f290: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+0004f2a0: 5356 475f 5441 475f 5245 4354 203d 3d20  SVG_TAG_RECT == 
+0004f2b0: 7461 673a 0d0a 2020 2020 2020 2020 2020  tag:..          
+0004f2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f2d0: 2020 7320 3d20 5265 6374 2876 616c 7565    s = Rect(value
+0004f2e0: 7329 0d0a 2020 2020 2020 2020 2020 2020  s)..            
+0004f2f0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0004f300: 3a20 2023 2053 5647 5f54 4147 5f49 4d41  :  # SVG_TAG_IMA
+0004f310: 4745 203d 3d20 7461 673a 0d0a 2020 2020  GE == tag:..    
+0004f320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f330: 2020 2020 2020 2020 7320 3d20 496d 6167          s = Imag
+0004f340: 6528 7661 6c75 6573 290d 0a20 2020 2020  e(values)..     
+0004f350: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0004f360: 7863 6570 7420 5661 6c75 6545 7272 6f72  xcept ValueError
+0004f370: 2061 7320 653a 0d0a 2020 2020 2020 2020   as e:..        
+0004f380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f390: 7061 7273 655f 6572 726f 7220 3d20 650d  parse_error = e.
+0004f3a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004f3b0: 2020 2020 2020 2020 2069 6620 7320 6973           if s is
+0004f3c0: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
 0004f3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f3e0: 2020 2072 6f6f 742e 6f62 6a65 6374 735b     root.objects[
-0004f3f0: 6174 7472 6962 7574 6573 5b53 5647 5f41  attributes[SVG_A
-0004f400: 5454 525f 4944 5d5d 203d 2073 0d0a 2020  TTR_ID]] = s..  
-0004f410: 2020 2020 2020 2020 2020 656c 6966 2065            elif e
-0004f420: 7665 6e74 203d 3d20 2265 6e64 223a 2020  vent == "end":  
-0004f430: 2320 456e 6420 6576 656e 742e 0d0a 2020  # End event...  
-0004f440: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0004f450: 5468 6520 6974 6572 7061 7273 6520 7370  The iterparse sp
-0004f460: 6563 206d 616b 6573 2069 7420 636c 6561  ec makes it clea
-0004f470: 7220 7468 6174 2069 6e74 6572 6e61 6c20  r that internal 
-0004f480: 7465 7874 2064 6174 6120 6973 2075 6e64  text data is und
-0004f490: 6566 696e 6564 2065 7863 6570 7420 6174  efined except at
-0004f4a0: 2074 6865 2065 6e64 2e0d 0a20 2020 2020   the end...     
-0004f4b0: 2020 2020 2020 2020 2020 2069 6620 280d             if (.
-0004f4c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004f4d0: 2020 2020 2053 5647 5f41 5454 525f 4449       SVG_ATTR_DI
-0004f4e0: 5350 4c41 5920 696e 2076 616c 7565 730d  SPLAY in values.
-0004f4f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004f500: 2020 2020 2061 6e64 2076 616c 7565 735b       and values[
-0004f510: 5356 475f 4154 5452 5f44 4953 504c 4159  SVG_ATTR_DISPLAY
-0004f520: 5d2e 6c6f 7765 7228 2920 3d3d 2053 5647  ].lower() == SVG
-0004f530: 5f56 414c 5545 5f4e 4f4e 450d 0a20 2020  _VALUE_NONE..   
-0004f540: 2020 2020 2020 2020 2020 2020 2029 3a0d               ):.
-0004f550: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004f560: 2020 2020 2023 2057 6520 6172 6520 696e       # We are in
-0004f570: 2061 2064 6973 706c 6179 3d6e 6f6e 652c   a display=none,
-0004f580: 2064 6f20 6e6f 7420 7265 6e64 6572 2074   do not render t
-0004f590: 6869 732e 2050 6f70 2076 616c 7565 7320  his. Pop values 
-0004f5a0: 616e 6420 636f 6e74 696e 7565 2e0d 0a20  and continue... 
-0004f5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f5c0: 2020 2063 6f6e 7465 7874 2c20 7661 6c75     context, valu
-0004f5d0: 6573 203d 2073 7461 636b 2e70 6f70 2829  es = stack.pop()
-0004f5e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0004f5f0: 2020 2020 2020 636f 6e74 696e 7565 0d0a        continue..
-0004f600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f610: 7320 3d20 4e6f 6e65 0d0a 2020 2020 2020  s = None..      
-0004f620: 2020 2020 2020 2020 2020 6966 2074 6167            if tag
-0004f630: 2069 6e20 280d 0a20 2020 2020 2020 2020   in (..         
-0004f640: 2020 2020 2020 2020 2020 2053 5647 5f54             SVG_T
-0004f650: 4147 5f54 4558 542c 0d0a 2020 2020 2020  AG_TEXT,..      
-0004f660: 2020 2020 2020 2020 2020 2020 2020 5356                SV
-0004f670: 475f 5441 475f 5453 5041 4e2c 0d0a 2020  G_TAG_TSPAN,..  
-0004f680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f690: 2020 5356 475f 5441 475f 4445 5343 2c0d    SVG_TAG_DESC,.
-0004f6a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004f6b0: 2020 2020 2053 5647 5f54 4147 5f54 4954       SVG_TAG_TIT
-0004f6c0: 4c45 2c0d 0a20 2020 2020 2020 2020 2020  LE,..           
-0004f6d0: 2020 2020 2020 2020 2053 5647 5f54 4147           SVG_TAG
-0004f6e0: 5f53 5459 4c45 2c0d 0a20 2020 2020 2020  _STYLE,..       
-0004f6f0: 2020 2020 2020 2020 2029 3a0d 0a20 2020           ):..   
-0004f700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f710: 2061 7474 7269 6275 7465 7320 3d20 656c   attributes = el
-0004f720: 656d 2e61 7474 7269 620d 0a20 2020 2020  em.attrib..     
-0004f730: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0004f740: 6620 5356 475f 4154 5452 5f49 4420 696e  f SVG_ATTR_ID in
-0004f750: 2061 7474 7269 6275 7465 7320 616e 6420   attributes and 
-0004f760: 726f 6f74 2069 7320 6e6f 7420 4e6f 6e65  root is not None
-0004f770: 2061 6e64 2075 7365 203d 3d20 303a 0d0a   and use == 0:..
-0004f780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f790: 2020 2020 2020 2020 726f 6f74 2e6f 626a          root.obj
-0004f7a0: 6563 7473 5b61 7474 7269 6275 7465 735b  ects[attributes[
-0004f7b0: 5356 475f 4154 5452 5f49 445d 5d20 3d20  SVG_ATTR_ID]] = 
-0004f7c0: 730d 0a20 2020 2020 2020 2020 2020 2020  s..             
-0004f7d0: 2020 2069 6620 7461 6720 696e 2028 5356     if tag in (SV
-0004f7e0: 475f 5441 475f 5445 5854 2c20 5356 475f  G_TAG_TEXT, SVG_
-0004f7f0: 5441 475f 5453 5041 4e29 3a0d 0a20 2020  TAG_TSPAN):..   
-0004f800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f810: 2073 203d 2054 6578 7428 7661 6c75 6573   s = Text(values
-0004f820: 2c20 7465 7874 3d65 6c65 6d2e 7465 7874  , text=elem.text
-0004f830: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-0004f840: 2020 2020 2020 2073 2e72 656e 6465 7228         s.render(
-0004f850: 7070 693d 7070 692c 2077 6964 7468 3d77  ppi=ppi, width=w
-0004f860: 6964 7468 2c20 6865 6967 6874 3d68 6569  idth, height=hei
-0004f870: 6768 7429 0d0a 2020 2020 2020 2020 2020  ght)..          
-0004f880: 2020 2020 2020 2020 2020 6966 2072 6569            if rei
-0004f890: 6679 3a0d 0a20 2020 2020 2020 2020 2020  fy:..           
-0004f8a0: 2020 2020 2020 2020 2020 2020 2073 2e72               s.r
-0004f8b0: 6569 6679 2829 0d0a 2020 2020 2020 2020  eify()..        
-0004f8c0: 2020 2020 2020 2020 2020 2020 6966 2063              if c
-0004f8d0: 6f6e 7465 7874 2069 7320 6e6f 7420 4e6f  ontext is not No
-0004f8e0: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
-0004f8f0: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-0004f900: 7465 7874 2e61 7070 656e 6428 7329 0d0a  text.append(s)..
-0004f910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f920: 656c 6966 2053 5647 5f54 4147 5f44 4553  elif SVG_TAG_DES
-0004f930: 4320 3d3d 2074 6167 3a0d 0a20 2020 2020  C == tag:..     
-0004f940: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0004f950: 203d 2044 6573 6328 7661 6c75 6573 2c20   = Desc(values, 
-0004f960: 6465 7363 3d65 6c65 6d2e 7465 7874 290d  desc=elem.text).
-0004f970: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004f980: 2020 2020 2069 6620 636f 6e74 6578 7420       if context 
-0004f990: 6973 206e 6f74 204e 6f6e 653a 0d0a 2020  is not None:..  
-0004f9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f9b0: 2020 2020 2020 636f 6e74 6578 742e 6170        context.ap
-0004f9c0: 7065 6e64 2873 290d 0a20 2020 2020 2020  pend(s)..       
-0004f9d0: 2020 2020 2020 2020 2065 6c69 6620 5356           elif SV
-0004f9e0: 475f 5441 475f 5449 544c 4520 3d3d 2074  G_TAG_TITLE == t
-0004f9f0: 6167 3a0d 0a20 2020 2020 2020 2020 2020  ag:..           
-0004fa00: 2020 2020 2020 2020 2073 203d 2054 6974           s = Tit
-0004fa10: 6c65 2876 616c 7565 732c 2074 6974 6c65  le(values, title
-0004fa20: 3d65 6c65 6d2e 7465 7874 290d 0a20 2020  =elem.text)..   
-0004fa30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004fa40: 2069 6620 636f 6e74 6578 7420 6973 206e   if context is n
-0004fa50: 6f74 204e 6f6e 653a 0d0a 2020 2020 2020  ot None:..      
-0004fa60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004fa70: 2020 636f 6e74 6578 742e 6170 7065 6e64    context.append
-0004fa80: 2873 290d 0a20 2020 2020 2020 2020 2020  (s)..           
-0004fa90: 2020 2020 2065 6c69 6620 5356 475f 5441       elif SVG_TA
-0004faa0: 475f 5354 594c 4520 3d3d 2074 6167 3a0d  G_STYLE == tag:.
-0004fab0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004fac0: 2020 2020 2074 6578 7473 7479 6c65 203d       textstyle =
-0004fad0: 2065 6c65 6d2e 7465 7874 0d0a 2020 2020   elem.text..    
-0004fae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004faf0: 6966 2074 6578 7473 7479 6c65 2069 7320  if textstyle is 
-0004fb00: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
-0004fb10: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0004fb20: 6578 7473 7479 6c65 203d 2022 220d 0a20  extstyle = "".. 
-0004fb30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004fb40: 2020 2074 6578 7473 7479 6c65 203d 2072     textstyle = r
-0004fb50: 652e 7375 6228 5245 4745 585f 4353 535f  e.sub(REGEX_CSS_
-0004fb60: 434f 4d4d 454e 542c 2022 222c 2074 6578  COMMENT, "", tex
-0004fb70: 7473 7479 6c65 290d 0a20 2020 2020 2020  tstyle)..       
-0004fb80: 2020 2020 2020 2020 2020 2020 2061 7373               ass
-0004fb90: 6967 6e6d 656e 7473 203d 206c 6973 7428  ignments = list(
-0004fba0: 7265 2e66 696e 6461 6c6c 2852 4547 4558  re.findall(REGEX
-0004fbb0: 5f43 5353 5f53 5459 4c45 2c20 7465 7874  _CSS_STYLE, text
-0004fbc0: 7374 796c 652e 7374 7269 7028 2929 290d  style.strip())).
-0004fbd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004fbe0: 2020 2020 2066 6f72 206b 6579 2c20 7661       for key, va
-0004fbf0: 6c75 6520 696e 2061 7373 6967 6e6d 656e  lue in assignmen
-0004fc00: 7473 3a0d 0a20 2020 2020 2020 2020 2020  ts:..           
-0004fc10: 2020 2020 2020 2020 2020 2020 206b 6579               key
-0004fc20: 203d 206b 6579 2e73 7472 6970 2829 0d0a   = key.strip()..
-0004fc30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004fc40: 2020 2020 2020 2020 7661 6c75 6520 3d20          value = 
-0004fc50: 7661 6c75 652e 7374 7269 7028 290d 0a20  value.strip().. 
-0004fc60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004fc70: 2020 2020 2020 2066 6f72 2073 656c 6563         for selec
-0004fc80: 746f 7220 696e 206b 6579 2e73 706c 6974  tor in key.split
-0004fc90: 2822 2c22 293a 2020 2320 4361 6e20 636f  (","):  # Can co
-0004fca0: 6d6d 6120 7365 6c65 6374 2073 7562 6974  mma select subit
-0004fcb0: 656d 732e 0d0a 2020 2020 2020 2020 2020  ems...          
+0004f3e0: 2020 2020 2320 7320 7761 7320 6e6f 7420      # s was not 
+0004f3f0: 6573 7461 626c 6973 6865 6420 7765 2063  established we c
+0004f400: 6f6e 7469 6e75 6520 7769 7468 6f75 7420  ontinue without 
+0004f410: 6974 2e0d 0a20 2020 2020 2020 2020 2020  it...           
+0004f420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f430: 2063 6f6e 7469 6e75 650d 0a20 2020 2020   continue..     
+0004f440: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0004f450: 2e72 656e 6465 7228 7070 693d 7070 692c  .render(ppi=ppi,
+0004f460: 2077 6964 7468 3d77 6964 7468 2c20 6865   width=width, he
+0004f470: 6967 6874 3d68 6569 6768 7429 0d0a 2020  ight=height)..  
+0004f480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f490: 2020 6966 2072 6569 6679 3a0d 0a20 2020    if reify:..   
+0004f4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f4b0: 2020 2020 2073 2e72 6569 6679 2829 0d0a       s.reify()..
+0004f4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f4d0: 2020 2020 6966 2073 2e69 735f 6465 6765      if s.is_dege
+0004f4e0: 6e65 7261 7465 2829 3a0d 0a20 2020 2020  nerate():..     
+0004f4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f500: 2020 2063 6f6e 7469 6e75 650d 0a20 2020     continue..   
+0004f510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f520: 2069 6620 636f 6e74 6578 7420 6973 206e   if context is n
+0004f530: 6f74 204e 6f6e 653a 0d0a 2020 2020 2020  ot None:..      
+0004f540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f550: 2020 636f 6e74 6578 742e 6170 7065 6e64    context.append
+0004f560: 2873 290d 0a20 2020 2020 2020 2020 2020  (s)..           
+0004f570: 2020 2020 2020 2020 2069 6620 7061 7273           if pars
+0004f580: 655f 6572 726f 723a 0d0a 2020 2020 2020  e_error:..      
+0004f590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f5a0: 2020 2320 4572 726f 7220 7761 7320 656e    # Error was en
+0004f5b0: 636f 756e 7465 7265 642c 2062 7574 2073  countered, but s
+0004f5c0: 2077 6173 2065 7374 6162 6c69 7368 6564   was established
+0004f5d0: 2061 6e64 2070 726f 6365 7373 6564 2e0d   and processed..
+0004f5e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004f5f0: 2020 2020 2020 2020 2069 6620 6f6e 5f65           if on_e
+0004f600: 7272 6f72 203d 3d20 2269 676e 6f72 6522  rror == "ignore"
+0004f610: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0004f620: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0004f630: 6f6e 7469 6e75 650d 0a20 2020 2020 2020  ontinue..       
+0004f640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f650: 2065 6c69 6620 6f6e 5f65 7272 6f72 203d   elif on_error =
+0004f660: 3d20 2272 6169 7365 223a 0d0a 2020 2020  = "raise":..    
+0004f670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f680: 2020 2020 2020 2020 7261 6973 6520 7061          raise pa
+0004f690: 7273 655f 6572 726f 720d 0a20 2020 2020  rse_error..     
+0004f6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f6b0: 2020 2065 6c73 653a 2020 2320 2273 746f     else:  # "sto
+0004f6c0: 7022 0d0a 2020 2020 2020 2020 2020 2020  p"..            
+0004f6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f6e0: 7265 7475 726e 2072 6f6f 740d 0a20 2020  return root..   
+0004f6f0: 2020 2020 2020 2020 2020 2020 2065 6c69               eli
+0004f700: 6620 7461 6720 696e 2028 0d0a 2020 2020  f tag in (..    
+0004f710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f720: 5356 475f 5441 475f 5354 594c 452c 0d0a  SVG_TAG_STYLE,..
+0004f730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f740: 2020 2020 5356 475f 5441 475f 5445 5854      SVG_TAG_TEXT
+0004f750: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0004f760: 2020 2020 2020 2053 5647 5f54 4147 5f44         SVG_TAG_D
+0004f770: 4553 432c 0d0a 2020 2020 2020 2020 2020  ESC,..          
+0004f780: 2020 2020 2020 2020 2020 5356 475f 5441            SVG_TA
+0004f790: 475f 5449 544c 452c 0d0a 2020 2020 2020  G_TITLE,..      
+0004f7a0: 2020 2020 2020 2020 2020 2020 2020 5356                SV
+0004f7b0: 475f 5441 475f 5453 5041 4e2c 0d0a 2020  G_TAG_TSPAN,..  
+0004f7c0: 2020 2020 2020 2020 2020 2020 2020 293a                ):
+0004f7d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0004f7e0: 2020 2020 2020 2320 3c73 7479 6c65 3e2c        # <style>,
+0004f7f0: 203c 7465 7874 3e2c 203c 6465 7363 3e2c   <text>, <desc>,
+0004f800: 203c 7469 746c 653e 0d0a 2020 2020 2020   <title>..      
+0004f810: 2020 2020 2020 2020 2020 2020 2020 636f                co
+0004f820: 6e74 696e 7565 0d0a 2020 2020 2020 2020  ntinue..        
+0004f830: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+0004f840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f850: 2020 2073 203d 2053 5647 456c 656d 656e     s = SVGElemen
+0004f860: 7428 7661 6c75 6573 2920 2023 2053 5647  t(values)  # SVG
+0004f870: 2055 6e6b 6e6f 776e 206f 626a 6563 7420   Unknown object 
+0004f880: 7265 7475 726e 2061 7320 656c 656d 656e  return as elemen
+0004f890: 742e 0d0a 2020 2020 2020 2020 2020 2020  t...            
+0004f8a0: 2020 2020 2020 2020 6966 2063 6f6e 7465          if conte
+0004f8b0: 7874 2069 7320 6e6f 7420 4e6f 6e65 3a0d  xt is not None:.
+0004f8c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004f8d0: 2020 2020 2020 2020 2063 6f6e 7465 7874           context
+0004f8e0: 2e61 7070 656e 6428 7329 0d0a 2020 2020  .append(s)..    
+0004f8f0: 2020 2020 2020 2020 2020 2020 2320 4966              # If
+0004f900: 206e 6f20 726f 6f74 2077 6173 2065 7374   no root was est
+0004f910: 6162 6c69 7368 6564 2c20 7320 6973 2072  ablished, s is r
+0004f920: 6f6f 742e 0d0a 2020 2020 2020 2020 2020  oot...          
+0004f930: 2020 2020 2020 6966 2072 6f6f 7420 6973        if root is
+0004f940: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+0004f950: 2020 2020 2020 2020 2020 2020 726f 6f74              root
+0004f960: 203d 2073 0d0a 2020 2020 2020 2020 2020   = s..          
+0004f970: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+0004f980: 6e63 6528 726f 6f74 2c20 5356 4729 3a0d  nce(root, SVG):.
+0004f990: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004f9a0: 2020 2020 2023 2041 7373 6967 6e20 6f70       # Assign op
+0004f9b0: 7469 6f6e 616c 206c 696e 6b65 6420 7072  tional linked pr
+0004f9c0: 6f70 6572 7469 6573 2e0d 0a20 2020 2020  operties...     
+0004f9d0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0004f9e0: 7279 3a0d 0a20 2020 2020 2020 2020 2020  ry:..           
+0004f9f0: 2020 2020 2020 2020 2020 2020 2063 6c69               cli
+0004fa00: 705f 7061 7468 5f75 726c 203d 2073 2e76  p_path_url = s.v
+0004fa10: 616c 7565 732e 6765 7428 5356 475f 4154  alues.get(SVG_AT
+0004fa20: 5452 5f43 4c49 505f 5041 5448 2c20 4e6f  TR_CLIP_PATH, No
+0004fa30: 6e65 290d 0a20 2020 2020 2020 2020 2020  ne)..           
+0004fa40: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0004fa50: 636c 6970 5f70 6174 685f 7572 6c20 6973  clip_path_url is
+0004fa60: 206e 6f74 204e 6f6e 653a 0d0a 2020 2020   not None:..    
+0004fa70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004fa80: 2020 2020 2020 2020 636c 6970 5f70 6174          clip_pat
+0004fa90: 6820 3d20 726f 6f74 2e67 6574 5f65 6c65  h = root.get_ele
+0004faa0: 6d65 6e74 5f62 795f 7572 6c28 636c 6970  ment_by_url(clip
+0004fab0: 5f70 6174 685f 7572 6c29 0d0a 2020 2020  _path_url)..    
+0004fac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004fad0: 2020 2020 2020 2020 732e 636c 6970 5f70          s.clip_p
+0004fae0: 6174 6820 3d20 636c 6970 5f70 6174 680d  ath = clip_path.
+0004faf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004fb00: 2020 2020 2065 7863 6570 7420 4174 7472       except Attr
+0004fb10: 6962 7574 6545 7272 6f72 3a0d 0a20 2020  ibuteError:..   
+0004fb20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004fb30: 2020 2020 2070 6173 730d 0a20 2020 2020       pass..     
+0004fb40: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0004fb50: 6620 636c 6970 2021 3d20 303a 0d0a 2020  f clip != 0:..  
+0004fb60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004fb70: 2020 2020 2020 7472 793a 0d0a 2020 2020        try:..    
+0004fb80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004fb90: 2020 2020 2020 2020 636c 6970 5f72 756c          clip_rul
+0004fba0: 6520 3d20 732e 7661 6c75 6573 2e67 6574  e = s.values.get
+0004fbb0: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
+0004fbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004fbd0: 2020 2053 5647 5f41 5454 525f 434c 4950     SVG_ATTR_CLIP
+0004fbe0: 5f52 554c 452c 2053 5647 5f52 554c 455f  _RULE, SVG_RULE_
+0004fbf0: 4e4f 4e5a 4552 4f0d 0a20 2020 2020 2020  NONZERO..       
+0004fc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004fc10: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
+0004fc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004fc30: 2020 2020 6966 2063 6c69 705f 7275 6c65      if clip_rule
+0004fc40: 2069 7320 6e6f 7420 4e6f 6e65 3a0d 0a20   is not None:.. 
+0004fc50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004fc60: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0004fc70: 2e63 6c69 705f 7275 6c65 203d 2063 6c69  .clip_rule = cli
+0004fc80: 705f 7275 6c65 0d0a 2020 2020 2020 2020  p_rule..        
+0004fc90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004fca0: 6578 6365 7074 2041 7474 7269 6275 7465  except Attribute
+0004fcb0: 4572 726f 723a 0d0a 2020 2020 2020 2020  Error:..        
 0004fcc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004fcd0: 2020 7365 6c20 3d20 7365 6c65 6374 6f72    sel = selector
-0004fce0: 2e73 7472 6970 2829 0d0a 2020 2020 2020  .strip()..      
-0004fcf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004fd00: 2020 2020 2020 6966 2073 656c 206e 6f74        if sel not
-0004fd10: 2069 6e20 7374 796c 6573 3a0d 0a20 2020   in styles:..   
+0004fcd0: 2020 2020 7061 7373 0d0a 2020 2020 2020      pass..      
+0004fce0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0004fcf0: 2053 5647 5f41 5454 525f 4944 2069 6e20   SVG_ATTR_ID in 
+0004fd00: 6174 7472 6962 7574 6573 2061 6e64 2075  attributes and u
+0004fd10: 7365 203d 3d20 303a 0d0a 2020 2020 2020  se == 0:..      
 0004fd20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004fd30: 2020 2020 2020 2020 2020 2020 2073 7479               sty
-0004fd40: 6c65 735b 7365 6c5d 203d 2076 616c 7565  les[sel] = value
-0004fd50: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0004fd60: 2020 2020 2020 2020 2020 2020 2020 656c                el
-0004fd70: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
-0004fd80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004fd90: 2020 2020 2069 6620 6e6f 7420 7374 796c       if not styl
-0004fda0: 6573 5b73 656c 5d2e 656e 6473 7769 7468  es[sel].endswith
-0004fdb0: 2822 3b22 293a 0d0a 2020 2020 2020 2020  (";"):..        
-0004fdc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004fdd0: 2020 2020 2020 2020 2020 2020 7374 796c              styl
-0004fde0: 6573 5b73 656c 5d20 2b3d 2022 3b22 0d0a  es[sel] += ";"..
-0004fdf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004fe00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004fe10: 7374 796c 6573 5b73 656c 5d20 2b3d 2076  styles[sel] += v
-0004fe20: 616c 7565 0d0a 2020 2020 2020 2020 2020  alue..          
-0004fe30: 2020 2020 2020 656c 6966 2053 5647 5f54        elif SVG_T
-0004fe40: 4147 5f43 4c49 5050 4154 4820 3d3d 2074  AG_CLIPPATH == t
-0004fe50: 6167 3a0d 0a20 2020 2020 2020 2020 2020  ag:..           
-0004fe60: 2020 2020 2020 2020 2063 6c69 7020 2d3d           clip -=
-0004fe70: 2031 0d0a 2020 2020 2020 2020 2020 2020   1..            
-0004fe80: 2020 2020 656c 6966 2053 5647 5f54 4147      elif SVG_TAG
-0004fe90: 5f55 5345 203d 3d20 7461 673a 0d0a 2020  _USE == tag:..  
+0004fd30: 2020 726f 6f74 2e6f 626a 6563 7473 5b61    root.objects[a
+0004fd40: 7474 7269 6275 7465 735b 5356 475f 4154  ttributes[SVG_AT
+0004fd50: 5452 5f49 445d 5d20 3d20 730d 0a20 2020  TR_ID]] = s..   
+0004fd60: 2020 2020 2020 2020 2065 6c69 6620 6576           elif ev
+0004fd70: 656e 7420 3d3d 2022 656e 6422 3a20 2023  ent == "end":  #
+0004fd80: 2045 6e64 2065 7665 6e74 2e0d 0a20 2020   End event...   
+0004fd90: 2020 2020 2020 2020 2020 2020 2023 2054               # T
+0004fda0: 6865 2069 7465 7270 6172 7365 2073 7065  he iterparse spe
+0004fdb0: 6320 6d61 6b65 7320 6974 2063 6c65 6172  c makes it clear
+0004fdc0: 2074 6861 7420 696e 7465 726e 616c 2074   that internal t
+0004fdd0: 6578 7420 6461 7461 2069 7320 756e 6465  ext data is unde
+0004fde0: 6669 6e65 6420 6578 6365 7074 2061 7420  fined except at 
+0004fdf0: 7468 6520 656e 642e 0d0a 2020 2020 2020  the end...      
+0004fe00: 2020 2020 2020 2020 2020 6966 2028 0d0a            if (..
+0004fe10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004fe20: 2020 2020 5356 475f 4154 5452 5f44 4953      SVG_ATTR_DIS
+0004fe30: 504c 4159 2069 6e20 7661 6c75 6573 0d0a  PLAY in values..
+0004fe40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004fe50: 2020 2020 616e 6420 7661 6c75 6573 5b53      and values[S
+0004fe60: 5647 5f41 5454 525f 4449 5350 4c41 595d  VG_ATTR_DISPLAY]
+0004fe70: 2e6c 6f77 6572 2829 203d 3d20 5356 475f  .lower() == SVG_
+0004fe80: 5641 4c55 455f 4e4f 4e45 0d0a 2020 2020  VALUE_NONE..    
+0004fe90: 2020 2020 2020 2020 2020 2020 293a 0d0a              ):..
 0004fea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004feb0: 2020 7573 6520 2d3d 2031 0d0a 2020 2020    use -= 1..    
-0004fec0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-0004fed0: 2069 7320 6e6f 7420 4e6f 6e65 3a0d 0a20   is not None:.. 
-0004fee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004fef0: 2020 2069 6620 726f 6f74 2069 7320 4e6f     if root is No
-0004ff00: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
-0004ff10: 2020 2020 2020 2020 2020 2020 2072 6f6f               roo
-0004ff20: 7420 3d20 730d 0a20 2020 2020 2020 2020  t = s..         
-0004ff30: 2020 2020 2020 2020 2020 2023 2041 7373             # Ass
-0004ff40: 6967 6e20 6f70 7469 6f6e 616c 206c 696e  ign optional lin
-0004ff50: 6b65 6420 7072 6f70 6572 7469 6573 2e0d  ked properties..
-0004ff60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004ff70: 2020 2020 2074 7279 3a0d 0a20 2020 2020       try:..     
-0004ff80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ff90: 2020 2063 6c69 705f 7061 7468 5f75 726c     clip_path_url
-0004ffa0: 203d 2073 2e76 616c 7565 732e 6765 7428   = s.values.get(
-0004ffb0: 5356 475f 4154 5452 5f43 4c49 505f 5041  SVG_ATTR_CLIP_PA
-0004ffc0: 5448 2c20 4e6f 6e65 290d 0a20 2020 2020  TH, None)..     
+0004feb0: 2020 2020 2320 5765 2061 7265 2069 6e20      # We are in 
+0004fec0: 6120 6469 7370 6c61 793d 6e6f 6e65 2c20  a display=none, 
+0004fed0: 646f 206e 6f74 2072 656e 6465 7220 7468  do not render th
+0004fee0: 6973 2e20 506f 7020 7661 6c75 6573 2061  is. Pop values a
+0004fef0: 6e64 2063 6f6e 7469 6e75 652e 0d0a 2020  nd continue...  
+0004ff00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ff10: 2020 636f 6e74 6578 742c 2076 616c 7565    context, value
+0004ff20: 7320 3d20 7374 6163 6b2e 706f 7028 290d  s = stack.pop().
+0004ff30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004ff40: 2020 2020 2063 6f6e 7469 6e75 650d 0a20       continue.. 
+0004ff50: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0004ff60: 203d 204e 6f6e 650d 0a20 2020 2020 2020   = None..       
+0004ff70: 2020 2020 2020 2020 2069 6620 7461 6720           if tag 
+0004ff80: 696e 2028 0d0a 2020 2020 2020 2020 2020  in (..          
+0004ff90: 2020 2020 2020 2020 2020 5356 475f 5441            SVG_TA
+0004ffa0: 475f 5445 5854 2c0d 0a20 2020 2020 2020  G_TEXT,..       
+0004ffb0: 2020 2020 2020 2020 2020 2020 2053 5647               SVG
+0004ffc0: 5f54 4147 5f54 5350 414e 2c0d 0a20 2020  _TAG_TSPAN,..   
 0004ffd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ffe0: 2020 2069 6620 636c 6970 5f70 6174 685f     if clip_path_
-0004fff0: 7572 6c20 6973 206e 6f74 204e 6f6e 653a  url is not None:
-00050000: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00050010: 2020 2020 2020 2020 2020 2020 2020 636c                cl
-00050020: 6970 5f70 6174 6820 3d20 726f 6f74 2e67  ip_path = root.g
-00050030: 6574 5f65 6c65 6d65 6e74 5f62 795f 7572  et_element_by_ur
-00050040: 6c28 636c 6970 5f70 6174 685f 7572 6c29  l(clip_path_url)
-00050050: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00050060: 2020 2020 2020 2020 2020 2020 2020 732e                s.
-00050070: 636c 6970 5f70 6174 6820 3d20 636c 6970  clip_path = clip
-00050080: 5f70 6174 680d 0a20 2020 2020 2020 2020  _path..         
-00050090: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-000500a0: 7420 4174 7472 6962 7574 6545 7272 6f72  t AttributeError
-000500b0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-000500c0: 2020 2020 2020 2020 2020 2070 6173 730d             pass.
-000500d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000500e0: 2020 2020 2069 6620 636c 6970 2021 3d20       if clip != 
-000500f0: 303a 0d0a 2020 2020 2020 2020 2020 2020  0:..            
-00050100: 2020 2020 2020 2020 2020 2020 7472 793a              try:
+0004ffe0: 2053 5647 5f54 4147 5f44 4553 432c 0d0a   SVG_TAG_DESC,..
+0004fff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050000: 2020 2020 5356 475f 5441 475f 5449 544c      SVG_TAG_TITL
+00050010: 452c 0d0a 2020 2020 2020 2020 2020 2020  E,..            
+00050020: 2020 2020 2020 2020 5356 475f 5441 475f          SVG_TAG_
+00050030: 5354 594c 452c 0d0a 2020 2020 2020 2020  STYLE,..        
+00050040: 2020 2020 2020 2020 293a 0d0a 2020 2020          ):..    
+00050050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050060: 6174 7472 6962 7574 6573 203d 2065 6c65  attributes = ele
+00050070: 6d2e 6174 7472 6962 0d0a 2020 2020 2020  m.attrib..      
+00050080: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00050090: 2053 5647 5f41 5454 525f 4944 2069 6e20   SVG_ATTR_ID in 
+000500a0: 6174 7472 6962 7574 6573 2061 6e64 2072  attributes and r
+000500b0: 6f6f 7420 6973 206e 6f74 204e 6f6e 6520  oot is not None 
+000500c0: 616e 6420 7573 6520 3d3d 2030 3a0d 0a20  and use == 0:.. 
+000500d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000500e0: 2020 2020 2020 2072 6f6f 742e 6f62 6a65         root.obje
+000500f0: 6374 735b 6174 7472 6962 7574 6573 5b53  cts[attributes[S
+00050100: 5647 5f41 5454 525f 4944 5d5d 203d 2073  VG_ATTR_ID]] = s
 00050110: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00050120: 2020 2020 2020 2020 2020 2020 2020 636c                cl
-00050130: 6970 5f72 756c 6520 3d20 732e 7661 6c75  ip_rule = s.valu
-00050140: 6573 2e67 6574 280d 0a20 2020 2020 2020  es.get(..       
+00050120: 2020 6966 2074 6167 2069 6e20 2853 5647    if tag in (SVG
+00050130: 5f54 4147 5f54 4558 542c 2053 5647 5f54  _TAG_TEXT, SVG_T
+00050140: 4147 5f54 5350 414e 293a 0d0a 2020 2020  AG_TSPAN):..    
 00050150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050160: 2020 2020 2020 2020 2053 5647 5f41 5454           SVG_ATT
-00050170: 525f 434c 4950 5f52 554c 452c 2053 5647  R_CLIP_RULE, SVG
-00050180: 5f52 554c 455f 4e4f 4e5a 4552 4f0d 0a20  _RULE_NONZERO.. 
-00050190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000501a0: 2020 2020 2020 2020 2020 2029 0d0a 2020             )..  
-000501b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000501c0: 2020 2020 2020 2020 2020 6966 2063 6c69            if cli
-000501d0: 705f 7275 6c65 2069 7320 6e6f 7420 4e6f  p_rule is not No
-000501e0: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
-000501f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050200: 2020 2020 2073 2e63 6c69 705f 7275 6c65       s.clip_rule
-00050210: 203d 2063 6c69 705f 7275 6c65 0d0a 2020   = clip_rule..  
-00050220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050230: 2020 2020 2020 6578 6365 7074 2041 7474        except Att
-00050240: 7269 6275 7465 4572 726f 723a 0d0a 2020  ributeError:..  
-00050250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050260: 2020 2020 2020 2020 2020 7061 7373 0d0a            pass..
-00050270: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00050280: 2020 636f 6e74 6578 742c 2076 616c 7565    context, value
-00050290: 7320 3d20 7374 6163 6b2e 706f 7028 290d  s = stack.pop().
-000502a0: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
-000502b0: 6620 6576 656e 7420 3d3d 2022 7374 6172  f event == "star
-000502c0: 742d 6e73 223a 0d0a 2020 2020 2020 2020  t-ns":..        
-000502d0: 2020 2020 2020 2020 6966 2065 6c65 6d5b          if elem[
-000502e0: 305d 2021 3d20 5356 475f 4154 5452 5f44  0] != SVG_ATTR_D
-000502f0: 4154 413a 0d0a 2020 2020 2020 2020 2020  ATA:..          
-00050300: 2020 2020 2020 2020 2020 2320 5261 7265            # Rare
-00050310: 2077 6333 2074 6573 7420 7573 6573 2061   wc3 test uses a
-00050320: 2027 6427 206e 616d 6573 7061 6365 2e0d   'd' namespace..
-00050330: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00050340: 2020 2020 2076 616c 7565 735b 656c 656d       values[elem
-00050350: 5b30 5d5d 203d 2065 6c65 6d5b 315d 0d0a  [0]] = elem[1]..
-00050360: 2020 2020 2020 2020 7265 7475 726e 2072          return r
-00050370: 6f6f 740d 0a0d 0a0d 0a64 6566 2074 6f73  oot......def tos
-00050380: 7472 696e 6728 6e6f 6465 293a 0d0a 2020  tring(node):..  
-00050390: 2020 6672 6f6d 2078 6d6c 2e65 7472 6565    from xml.etree
-000503a0: 2e45 6c65 6d65 6e74 5472 6565 2069 6d70  .ElementTree imp
-000503b0: 6f72 7420 746f 7374 7269 6e67 0d0a 0d0a  ort tostring....
-000503c0: 2020 2020 7265 7475 726e 2074 6f73 7472      return tostr
-000503d0: 696e 6728 5f77 7269 7465 5f6e 6f64 6528  ing(_write_node(
-000503e0: 6e6f 6465 292c 2065 6e63 6f64 696e 673d  node), encoding=
-000503f0: 2275 6e69 636f 6465 2229 0d0a 0d0a 0d0a  "unicode")......
-00050400: 6465 6620 7772 6974 6528 6e6f 6465 2c20  def write(node, 
-00050410: 662c 2070 7265 7474 793d 5472 7565 293a  f, pretty=True):
-00050420: 0d0a 2020 2020 6672 6f6d 2078 6d6c 2e65  ..    from xml.e
-00050430: 7472 6565 2e45 6c65 6d65 6e74 5472 6565  tree.ElementTree
-00050440: 2069 6d70 6f72 7420 456c 656d 656e 7454   import ElementT
-00050450: 7265 650d 0a0d 0a20 2020 2072 6f6f 7420  ree....    root 
-00050460: 3d20 5f77 7269 7465 5f6e 6f64 6528 6e6f  = _write_node(no
-00050470: 6465 290d 0a20 2020 2069 6620 7072 6574  de)..    if pret
-00050480: 7479 3a0d 0a20 2020 2020 2020 205f 7072  ty:..        _pr
-00050490: 6574 7479 5f70 7269 6e74 2872 6f6f 7429  etty_print(root)
-000504a0: 0d0a 2020 2020 7472 6565 203d 2045 6c65  ..    tree = Ele
-000504b0: 6d65 6e74 5472 6565 2872 6f6f 7429 0d0a  mentTree(root)..
-000504c0: 2020 2020 6966 2066 2e6c 6f77 6572 2829      if f.lower()
-000504d0: 2e65 6e64 7377 6974 6828 2273 7667 7a22  .endswith("svgz"
-000504e0: 293a 0d0a 2020 2020 2020 2020 696d 706f  ):..        impo
-000504f0: 7274 2067 7a69 700d 0a0d 0a20 2020 2020  rt gzip....     
-00050500: 2020 2066 203d 2067 7a69 702e 6f70 656e     f = gzip.open
-00050510: 2866 2c20 2277 6222 290d 0a20 2020 2074  (f, "wb")..    t
-00050520: 7265 652e 7772 6974 6528 6629 0d0a 0d0a  ree.write(f)....
-00050530: 0d0a 6465 6620 5f77 7269 7465 5f6e 6f64  ..def _write_nod
-00050540: 6528 6e6f 6465 2c20 786d 6c5f 7472 6565  e(node, xml_tree
-00050550: 3d4e 6f6e 652c 2076 6965 7770 6f72 745f  =None, viewport_
-00050560: 7472 616e 7366 6f72 6d3d 4e6f 6e65 293a  transform=None):
-00050570: 0d0a 2020 2020 6966 2068 6173 6174 7472  ..    if hasattr
-00050580: 286e 6f64 652c 2022 7661 6c75 6573 2229  (node, "values")
-00050590: 3a0d 0a20 2020 2020 2020 2076 616c 7565  :..        value
-000505a0: 7320 3d20 6e6f 6465 2e76 616c 7565 730d  s = node.values.
-000505b0: 0a20 2020 2020 2020 2076 616c 7565 7320  .        values 
-000505c0: 3d20 6e6f 6465 2e76 616c 7565 732e 6765  = node.values.ge
-000505d0: 7428 5356 475f 5354 5255 4354 5f41 5454  t(SVG_STRUCT_ATT
-000505e0: 5249 422c 2076 616c 7565 7329 0d0a 2020  RIB, values)..  
-000505f0: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-00050600: 2076 616c 7565 7320 3d20 4e6f 6e65 0d0a   values = None..
-00050610: 0d0a 2020 2020 6465 6620 7375 6278 6d6c  ..    def subxml
-00050620: 2878 6d6c 5f74 7265 652c 2074 6167 293a  (xml_tree, tag):
-00050630: 0d0a 2020 2020 2020 2020 6672 6f6d 2078  ..        from x
-00050640: 6d6c 2e65 7472 6565 2e45 6c65 6d65 6e74  ml.etree.Element
-00050650: 5472 6565 2069 6d70 6f72 7420 456c 656d  Tree import Elem
-00050660: 656e 742c 2053 7562 456c 656d 656e 740d  ent, SubElement.
-00050670: 0a0d 0a20 2020 2020 2020 2069 6620 786d  ...        if xm
-00050680: 6c5f 7472 6565 2069 7320 4e6f 6e65 3a0d  l_tree is None:.
-00050690: 0a20 2020 2020 2020 2020 2020 2078 6d6c  .            xml
-000506a0: 5f74 7265 6520 3d20 456c 656d 656e 7428  _tree = Element(
-000506b0: 7461 6729 0d0a 2020 2020 2020 2020 656c  tag)..        el
-000506c0: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
-000506d0: 2078 6d6c 5f74 7265 6520 3d20 5375 6245   xml_tree = SubE
-000506e0: 6c65 6d65 6e74 2878 6d6c 5f74 7265 652c  lement(xml_tree,
-000506f0: 2074 6167 290d 0a20 2020 2020 2020 2066   tag)..        f
-00050700: 6f72 206b 6579 2c20 7661 6c75 6520 696e  or key, value in
-00050710: 2076 616c 7565 732e 6974 656d 7328 293a   values.items():
-00050720: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00050730: 206b 6579 2069 6e20 280d 0a20 2020 2020   key in (..     
-00050740: 2020 2020 2020 2020 2020 2022 7461 6722             "tag"
-00050750: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00050760: 2020 2053 5647 5f53 5452 5543 545f 4154     SVG_STRUCT_AT
-00050770: 5452 4942 2c0d 0a20 2020 2020 2020 2020  TRIB,..         
-00050780: 2020 2020 2020 2053 5647 5f41 5454 525f         SVG_ATTR_
-00050790: 5452 414e 5346 4f52 4d2c 0d0a 2020 2020  TRANSFORM,..    
-000507a0: 2020 2020 2020 2020 2020 2020 5356 475f              SVG_
-000507b0: 4154 5452 5f46 494c 4c2c 0d0a 2020 2020  ATTR_FILL,..    
-000507c0: 2020 2020 2020 2020 2020 2020 5356 475f              SVG_
-000507d0: 4154 5452 5f53 5452 4f4b 452c 0d0a 2020  ATTR_STROKE,..  
-000507e0: 2020 2020 2020 2020 2020 2020 2020 5356                SV
-000507f0: 475f 5441 475f 5354 594c 452c 0d0a 2020  G_TAG_STYLE,..  
-00050800: 2020 2020 2020 2020 2020 293a 0d0a 2020            ):..  
-00050810: 2020 2020 2020 2020 2020 2020 2020 636f                co
-00050820: 6e74 696e 7565 0d0a 2020 2020 2020 2020  ntinue..        
-00050830: 2020 2020 786d 6c5f 7472 6565 2e73 6574      xml_tree.set
-00050840: 286b 6579 2c20 7374 7228 7661 6c75 6529  (key, str(value)
-00050850: 290d 0a20 2020 2020 2020 2072 6574 7572  )..        retur
-00050860: 6e20 786d 6c5f 7472 6565 0d0a 0d0a 2020  n xml_tree....  
-00050870: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-00050880: 6e6f 6465 2c20 5356 4729 3a0d 0a20 2020  node, SVG):..   
-00050890: 2020 2020 2069 6620 786d 6c5f 7472 6565       if xml_tree
-000508a0: 2069 7320 4e6f 6e65 3a0d 0a20 2020 2020   is None:..     
-000508b0: 2020 2020 2020 2078 6d6c 5f74 7265 6520         xml_tree 
-000508c0: 3d20 7375 6278 6d6c 2878 6d6c 5f74 7265  = subxml(xml_tre
-000508d0: 652c 2053 5647 5f4e 414d 455f 5441 4729  e, SVG_NAME_TAG)
-000508e0: 0d0a 2020 2020 2020 2020 2020 2020 786d  ..            xm
-000508f0: 6c5f 7472 6565 2e73 6574 2853 5647 5f41  l_tree.set(SVG_A
-00050900: 5454 525f 5645 5253 494f 4e2c 2053 5647  TTR_VERSION, SVG
-00050910: 5f56 414c 5545 5f56 4552 5349 4f4e 290d  _VALUE_VERSION).
-00050920: 0a20 2020 2020 2020 2020 2020 2078 6d6c  .            xml
-00050930: 5f74 7265 652e 7365 7428 5356 475f 4154  _tree.set(SVG_AT
-00050940: 5452 5f58 4d4c 4e53 2c20 5356 475f 5641  TR_XMLNS, SVG_VA
-00050950: 4c55 455f 584d 4c4e 5329 0d0a 2020 2020  LUE_XMLNS)..    
-00050960: 2020 2020 2020 2020 786d 6c5f 7472 6565          xml_tree
-00050970: 2e73 6574 2853 5647 5f41 5454 525f 584d  .set(SVG_ATTR_XM
-00050980: 4c4e 535f 4c49 4e4b 2c20 5356 475f 5641  LNS_LINK, SVG_VA
-00050990: 4c55 455f 584c 494e 4b29 0d0a 2020 2020  LUE_XLINK)..    
-000509a0: 2020 2020 2020 2020 786d 6c5f 7472 6565          xml_tree
-000509b0: 2e73 6574 2853 5647 5f41 5454 525f 584d  .set(SVG_ATTR_XM
-000509c0: 4c4e 535f 4556 2c20 5356 475f 5641 4c55  LNS_EV, SVG_VALU
-000509d0: 455f 584d 4c4e 535f 4556 290d 0a20 2020  E_XMLNS_EV)..   
-000509e0: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-000509f0: 2020 2020 2020 2020 786d 6c5f 7472 6565          xml_tree
-00050a00: 203d 2073 7562 786d 6c28 786d 6c5f 7472   = subxml(xml_tr
-00050a10: 6565 2c20 5356 475f 4e41 4d45 5f54 4147  ee, SVG_NAME_TAG
-00050a20: 290d 0a20 2020 2020 2020 2069 6620 6e6f  )..        if no
-00050a30: 6465 2e78 3a0d 0a20 2020 2020 2020 2020  de.x:..         
-00050a40: 2020 2078 6d6c 5f74 7265 652e 7365 7428     xml_tree.set(
-00050a50: 5356 475f 4154 5452 5f58 2c20 7374 7228  SVG_ATTR_X, str(
-00050a60: 6e6f 6465 2e78 2929 0d0a 2020 2020 2020  node.x))..      
-00050a70: 2020 6966 206e 6f64 652e 793a 0d0a 2020    if node.y:..  
-00050a80: 2020 2020 2020 2020 2020 786d 6c5f 7472            xml_tr
-00050a90: 6565 2e73 6574 2853 5647 5f41 5454 525f  ee.set(SVG_ATTR_
-00050aa0: 592c 2073 7472 286e 6f64 652e 7929 290d  Y, str(node.y)).
-00050ab0: 0a20 2020 2020 2020 2069 6620 6e6f 6465  .        if node
-00050ac0: 2e77 6964 7468 3a0d 0a20 2020 2020 2020  .width:..       
-00050ad0: 2020 2020 2078 6d6c 5f74 7265 652e 7365       xml_tree.se
-00050ae0: 7428 5356 475f 4154 5452 5f57 4944 5448  t(SVG_ATTR_WIDTH
-00050af0: 2c20 7374 7228 6e6f 6465 2e77 6964 7468  , str(node.width
-00050b00: 2929 0d0a 2020 2020 2020 2020 6966 206e  ))..        if n
-00050b10: 6f64 652e 6865 6967 6874 3a0d 0a20 2020  ode.height:..   
-00050b20: 2020 2020 2020 2020 2078 6d6c 5f74 7265           xml_tre
-00050b30: 652e 7365 7428 5356 475f 4154 5452 5f48  e.set(SVG_ATTR_H
-00050b40: 4549 4748 542c 2073 7472 286e 6f64 652e  EIGHT, str(node.
-00050b50: 6865 6967 6874 2929 0d0a 2020 2020 2020  height))..      
-00050b60: 2020 6966 206e 6f64 652e 7669 6577 626f    if node.viewbo
-00050b70: 783a 0d0a 2020 2020 2020 2020 2020 2020  x:..            
-00050b80: 786d 6c5f 7472 6565 2e73 6574 2853 5647  xml_tree.set(SVG
-00050b90: 5f41 5454 525f 5649 4557 424f 582c 2073  _ATTR_VIEWBOX, s
-00050ba0: 7472 286e 6f64 652e 7669 6577 626f 7829  tr(node.viewbox)
-00050bb0: 290d 0a20 2020 2020 2020 2076 7420 3d20  )..        vt = 
-00050bc0: 6e6f 6465 2e76 6965 7762 6f78 5f74 7261  node.viewbox_tra
-00050bd0: 6e73 666f 726d 0d0a 2020 2020 2020 2020  nsform..        
-00050be0: 6966 2076 743a 0d0a 2020 2020 2020 2020  if vt:..        
-00050bf0: 2020 2020 6d20 3d20 4d61 7472 6978 2876      m = Matrix(v
-00050c00: 7429 0d0a 2020 2020 2020 2020 2020 2020  t)..            
-00050c10: 6d2e 696e 7665 7273 6528 290d 0a20 2020  m.inverse()..   
-00050c20: 2020 2020 2020 2020 2076 7420 3d20 6d0d           vt = m.
-00050c30: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
-00050c40: 2020 2020 2020 2020 2020 2020 7674 203d              vt =
-00050c50: 204e 6f6e 650d 0a20 2020 2020 2020 2066   None..        f
-00050c60: 6f72 2063 6869 6c64 2069 6e20 6e6f 6465  or child in node
-00050c70: 3a0d 0a20 2020 2020 2020 2020 2020 205f  :..            _
-00050c80: 7772 6974 655f 6e6f 6465 2863 6869 6c64  write_node(child
-00050c90: 2c20 786d 6c5f 7472 6565 2c20 7674 290d  , xml_tree, vt).
-00050ca0: 0a20 2020 2065 6c69 6620 6973 696e 7374  .    elif isinst
-00050cb0: 616e 6365 286e 6f64 652c 2045 6c6c 6970  ance(node, Ellip
-00050cc0: 7365 293a 0d0a 2020 2020 2020 2020 786d  se):..        xm
-00050cd0: 6c5f 7472 6565 203d 2073 7562 786d 6c28  l_tree = subxml(
-00050ce0: 786d 6c5f 7472 6565 2c20 5356 475f 5441  xml_tree, SVG_TA
-00050cf0: 475f 454c 4c49 5053 4529 0d0a 2020 2020  G_ELLIPSE)..    
-00050d00: 2020 2020 6966 206e 6f64 652e 6378 3a0d      if node.cx:.
-00050d10: 0a20 2020 2020 2020 2020 2020 2078 6d6c  .            xml
-00050d20: 5f74 7265 652e 7365 7428 5356 475f 4154  _tree.set(SVG_AT
-00050d30: 5452 5f43 454e 5445 525f 582c 2073 7472  TR_CENTER_X, str
-00050d40: 286e 6f64 652e 6378 2929 0d0a 2020 2020  (node.cx))..    
-00050d50: 2020 2020 6966 206e 6f64 652e 6379 3a0d      if node.cy:.
-00050d60: 0a20 2020 2020 2020 2020 2020 2078 6d6c  .            xml
-00050d70: 5f74 7265 652e 7365 7428 5356 475f 4154  _tree.set(SVG_AT
-00050d80: 5452 5f43 454e 5445 525f 592c 2073 7472  TR_CENTER_Y, str
-00050d90: 286e 6f64 652e 6379 2929 0d0a 2020 2020  (node.cy))..    
-00050da0: 2020 2020 6966 206e 6f64 652e 7278 3a0d      if node.rx:.
-00050db0: 0a20 2020 2020 2020 2020 2020 2078 6d6c  .            xml
-00050dc0: 5f74 7265 652e 7365 7428 5356 475f 4154  _tree.set(SVG_AT
-00050dd0: 5452 5f52 4144 4955 535f 582c 2073 7472  TR_RADIUS_X, str
-00050de0: 286e 6f64 652e 7278 2929 0d0a 2020 2020  (node.rx))..    
-00050df0: 2020 2020 6966 206e 6f64 652e 7279 3a0d      if node.ry:.
-00050e00: 0a20 2020 2020 2020 2020 2020 2078 6d6c  .            xml
-00050e10: 5f74 7265 652e 7365 7428 5356 475f 4154  _tree.set(SVG_AT
-00050e20: 5452 5f52 4144 4955 535f 592c 2073 7472  TR_RADIUS_Y, str
-00050e30: 286e 6f64 652e 7279 2929 0d0a 2020 2020  (node.ry))..    
-00050e40: 656c 6966 2069 7369 6e73 7461 6e63 6528  elif isinstance(
-00050e50: 6e6f 6465 2c20 4369 7263 6c65 293a 0d0a  node, Circle):..
-00050e60: 2020 2020 2020 2020 786d 6c5f 7472 6565          xml_tree
-00050e70: 203d 2073 7562 786d 6c28 786d 6c5f 7472   = subxml(xml_tr
-00050e80: 6565 2c20 5356 475f 5441 475f 4349 5243  ee, SVG_TAG_CIRC
-00050e90: 4c45 290d 0a20 2020 2020 2020 2069 6620  LE)..        if 
-00050ea0: 6e6f 6465 2e63 783a 0d0a 2020 2020 2020  node.cx:..      
-00050eb0: 2020 2020 2020 786d 6c5f 7472 6565 2e73        xml_tree.s
-00050ec0: 6574 2853 5647 5f41 5454 525f 4345 4e54  et(SVG_ATTR_CENT
-00050ed0: 4552 5f58 2c20 7374 7228 6e6f 6465 2e63  ER_X, str(node.c
-00050ee0: 7829 290d 0a20 2020 2020 2020 2069 6620  x))..        if 
-00050ef0: 6e6f 6465 2e63 793a 0d0a 2020 2020 2020  node.cy:..      
-00050f00: 2020 2020 2020 786d 6c5f 7472 6565 2e73        xml_tree.s
-00050f10: 6574 2853 5647 5f41 5454 525f 4345 4e54  et(SVG_ATTR_CENT
-00050f20: 4552 5f59 2c20 7374 7228 6e6f 6465 2e63  ER_Y, str(node.c
-00050f30: 7929 290d 0a20 2020 2020 2020 2069 6620  y))..        if 
-00050f40: 6e6f 6465 2e72 783a 0d0a 2020 2020 2020  node.rx:..      
-00050f50: 2020 2020 2020 786d 6c5f 7472 6565 2e73        xml_tree.s
-00050f60: 6574 2853 5647 5f41 5454 525f 5241 4449  et(SVG_ATTR_RADI
-00050f70: 5553 2c20 7374 7228 6e6f 6465 2e72 7829  US, str(node.rx)
-00050f80: 290d 0a20 2020 2065 6c69 6620 6973 696e  )..    elif isin
-00050f90: 7374 616e 6365 286e 6f64 652c 2049 6d61  stance(node, Ima
-00050fa0: 6765 293a 0d0a 2020 2020 2020 2020 786d  ge):..        xm
-00050fb0: 6c5f 7472 6565 203d 2073 7562 786d 6c28  l_tree = subxml(
-00050fc0: 786d 6c5f 7472 6565 2c20 5356 475f 5441  xml_tree, SVG_TA
-00050fd0: 475f 494d 4147 4529 0d0a 2020 2020 2020  G_IMAGE)..      
-00050fe0: 2020 6672 6f6d 2062 6173 6536 3420 696d    from base64 im
-00050ff0: 706f 7274 2062 3634 656e 636f 6465 0d0a  port b64encode..
-00051000: 2020 2020 2020 2020 6672 6f6d 2069 6f20          from io 
-00051010: 696d 706f 7274 2042 7974 6573 494f 0d0a  import BytesIO..
-00051020: 0d0a 2020 2020 2020 2020 6966 206e 6f64  ..        if nod
-00051030: 652e 696d 6167 6520 6973 206e 6f74 204e  e.image is not N
-00051040: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
-00051050: 2020 7374 7265 616d 203d 2042 7974 6573    stream = Bytes
-00051060: 494f 2829 0d0a 2020 2020 2020 2020 2020  IO()..          
-00051070: 2020 6e6f 6465 2e69 6d61 6765 2e73 6176    node.image.sav
-00051080: 6528 7374 7265 616d 2c20 666f 726d 6174  e(stream, format
-00051090: 3d22 504e 4722 290d 0a20 2020 2020 2020  ="PNG")..       
-000510a0: 2020 2020 2078 6d6c 5f74 7265 652e 7365       xml_tree.se
-000510b0: 7428 0d0a 2020 2020 2020 2020 2020 2020  t(..            
-000510c0: 2020 2020 2278 6c69 6e6b 3a68 7265 6622      "xlink:href"
-000510d0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-000510e0: 2020 2066 2264 6174 613a 696d 6167 652f     f"data:image/
-000510f0: 706e 673b 6261 7365 3634 2c7b 6236 3465  png;base64,{b64e
-00051100: 6e63 6f64 6528 7374 7265 616d 2e67 6574  ncode(stream.get
-00051110: 7661 6c75 6528 2929 2e64 6563 6f64 6528  value()).decode(
-00051120: 2775 7466 3827 297d 222c 0d0a 2020 2020  'utf8')}",..    
-00051130: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
-00051140: 2020 2069 6620 6e6f 6465 2e78 3a0d 0a20     if node.x:.. 
-00051150: 2020 2020 2020 2020 2020 2078 6d6c 5f74             xml_t
-00051160: 7265 652e 7365 7428 5356 475f 4154 5452  ree.set(SVG_ATTR
-00051170: 5f58 2c20 7374 7228 6e6f 6465 2e78 2929  _X, str(node.x))
-00051180: 0d0a 2020 2020 2020 2020 6966 206e 6f64  ..        if nod
-00051190: 652e 793a 0d0a 2020 2020 2020 2020 2020  e.y:..          
-000511a0: 2020 786d 6c5f 7472 6565 2e73 6574 2853    xml_tree.set(S
-000511b0: 5647 5f41 5454 525f 592c 2073 7472 286e  VG_ATTR_Y, str(n
-000511c0: 6f64 652e 7929 290d 0a20 2020 2020 2020  ode.y))..       
-000511d0: 2069 6620 6e6f 6465 2e77 6964 7468 3a0d   if node.width:.
-000511e0: 0a20 2020 2020 2020 2020 2020 2078 6d6c  .            xml
-000511f0: 5f74 7265 652e 7365 7428 5356 475f 4154  _tree.set(SVG_AT
-00051200: 5452 5f57 4944 5448 2c20 7374 7228 6e6f  TR_WIDTH, str(no
-00051210: 6465 2e77 6964 7468 2929 0d0a 2020 2020  de.width))..    
-00051220: 2020 2020 6966 206e 6f64 652e 6865 6967      if node.heig
-00051230: 6874 3a0d 0a20 2020 2020 2020 2020 2020  ht:..           
-00051240: 2078 6d6c 5f74 7265 652e 7365 7428 5356   xml_tree.set(SV
-00051250: 475f 4154 5452 5f48 4549 4748 542c 2073  G_ATTR_HEIGHT, s
-00051260: 7472 286e 6f64 652e 6865 6967 6874 2929  tr(node.height))
-00051270: 0d0a 2020 2020 656c 6966 2069 7369 6e73  ..    elif isins
-00051280: 7461 6e63 6528 6e6f 6465 2c20 5369 6d70  tance(node, Simp
-00051290: 6c65 4c69 6e65 293a 0d0a 2020 2020 2020  leLine):..      
-000512a0: 2020 786d 6c5f 7472 6565 203d 2073 7562    xml_tree = sub
-000512b0: 786d 6c28 786d 6c5f 7472 6565 2c20 5356  xml(xml_tree, SV
-000512c0: 475f 5441 475f 4c49 4e45 290d 0a20 2020  G_TAG_LINE)..   
-000512d0: 2020 2020 2069 6620 6e6f 6465 2e78 313a       if node.x1:
-000512e0: 0d0a 2020 2020 2020 2020 2020 2020 786d  ..            xm
-000512f0: 6c5f 7472 6565 2e73 6574 2853 5647 5f41  l_tree.set(SVG_A
-00051300: 5454 525f 5831 2c20 7374 7228 6e6f 6465  TTR_X1, str(node
-00051310: 2e78 3129 290d 0a20 2020 2020 2020 2069  .x1))..        i
-00051320: 6620 6e6f 6465 2e79 313a 0d0a 2020 2020  f node.y1:..    
-00051330: 2020 2020 2020 2020 786d 6c5f 7472 6565          xml_tree
-00051340: 2e73 6574 2853 5647 5f41 5454 525f 5931  .set(SVG_ATTR_Y1
-00051350: 2c20 7374 7228 6e6f 6465 2e79 3129 290d  , str(node.y1)).
-00051360: 0a20 2020 2020 2020 2069 6620 6e6f 6465  .        if node
-00051370: 2e78 323a 0d0a 2020 2020 2020 2020 2020  .x2:..          
-00051380: 2020 786d 6c5f 7472 6565 2e73 6574 2853    xml_tree.set(S
-00051390: 5647 5f41 5454 525f 5832 2c20 7374 7228  VG_ATTR_X2, str(
-000513a0: 6e6f 6465 2e78 3229 290d 0a20 2020 2020  node.x2))..     
-000513b0: 2020 2069 6620 6e6f 6465 2e79 323a 0d0a     if node.y2:..
-000513c0: 2020 2020 2020 2020 2020 2020 786d 6c5f              xml_
-000513d0: 7472 6565 2e73 6574 2853 5647 5f41 5454  tree.set(SVG_ATT
-000513e0: 525f 5932 2c20 7374 7228 6e6f 6465 2e79  R_Y2, str(node.y
-000513f0: 3229 290d 0a20 2020 2065 6c69 6620 6973  2))..    elif is
-00051400: 696e 7374 616e 6365 286e 6f64 652c 2050  instance(node, P
-00051410: 6174 6829 3a0d 0a20 2020 2020 2020 2078  ath):..        x
-00051420: 6d6c 5f74 7265 6520 3d20 7375 6278 6d6c  ml_tree = subxml
-00051430: 2878 6d6c 5f74 7265 652c 2053 5647 5f54  (xml_tree, SVG_T
-00051440: 4147 5f50 4154 4829 0d0a 2020 2020 2020  AG_PATH)..      
-00051450: 2020 786d 6c5f 7472 6565 2e73 6574 2853    xml_tree.set(S
-00051460: 5647 5f41 5454 525f 4441 5441 2c20 6e6f  VG_ATTR_DATA, no
-00051470: 6465 2e64 2874 7261 6e73 666f 726d 6564  de.d(transformed
-00051480: 3d46 616c 7365 2929 0d0a 2020 2020 656c  =False))..    el
-00051490: 6966 2069 7369 6e73 7461 6e63 6528 6e6f  if isinstance(no
-000514a0: 6465 2c20 506f 6c79 6c69 6e65 293a 0d0a  de, Polyline):..
-000514b0: 2020 2020 2020 2020 786d 6c5f 7472 6565          xml_tree
-000514c0: 203d 2073 7562 786d 6c28 786d 6c5f 7472   = subxml(xml_tr
-000514d0: 6565 2c20 5356 475f 5441 475f 504f 4c59  ee, SVG_TAG_POLY
-000514e0: 4c49 4e45 290d 0a20 2020 2020 2020 2078  LINE)..        x
-000514f0: 6d6c 5f74 7265 652e 7365 7428 0d0a 2020  ml_tree.set(..  
-00051500: 2020 2020 2020 2020 2020 5356 475f 4154            SVG_AT
-00051510: 5452 5f50 4f49 4e54 532c 0d0a 2020 2020  TR_POINTS,..    
-00051520: 2020 2020 2020 2020 2220 222e 6a6f 696e          " ".join
-00051530: 285b 6622 7b65 5b30 5d7d 207b 655b 315d  ([f"{e[0]} {e[1]
-00051540: 7d22 2066 6f72 2065 2069 6e20 6e6f 6465  }" for e in node
-00051550: 2e70 6f69 6e74 735d 292c 0d0a 2020 2020  .points]),..    
-00051560: 2020 2020 290d 0a20 2020 2065 6c69 6620      )..    elif 
-00051570: 6973 696e 7374 616e 6365 286e 6f64 652c  isinstance(node,
-00051580: 2050 6f6c 7967 6f6e 293a 0d0a 2020 2020   Polygon):..    
-00051590: 2020 2020 786d 6c5f 7472 6565 203d 2073      xml_tree = s
-000515a0: 7562 786d 6c28 786d 6c5f 7472 6565 2c20  ubxml(xml_tree, 
-000515b0: 5356 475f 5441 475f 504f 4c59 474f 4e29  SVG_TAG_POLYGON)
-000515c0: 0d0a 2020 2020 2020 2020 786d 6c5f 7472  ..        xml_tr
-000515d0: 6565 2e73 6574 280d 0a20 2020 2020 2020  ee.set(..       
-000515e0: 2020 2020 2053 5647 5f41 5454 525f 504f       SVG_ATTR_PO
-000515f0: 494e 5453 2c0d 0a20 2020 2020 2020 2020  INTS,..         
-00051600: 2020 2022 2022 2e6a 6f69 6e28 5b66 227b     " ".join([f"{
-00051610: 655b 305d 7d20 7b65 5b31 5d7d 2220 666f  e[0]} {e[1]}" fo
-00051620: 7220 6520 696e 206e 6f64 652e 706f 696e  r e in node.poin
-00051630: 7473 5d29 2c0d 0a20 2020 2020 2020 2029  ts]),..        )
-00051640: 0d0a 2020 2020 656c 6966 2069 7369 6e73  ..    elif isins
-00051650: 7461 6e63 6528 6e6f 6465 2c20 5265 6374  tance(node, Rect
-00051660: 293a 0d0a 2020 2020 2020 2020 786d 6c5f  ):..        xml_
-00051670: 7472 6565 203d 2073 7562 786d 6c28 786d  tree = subxml(xm
-00051680: 6c5f 7472 6565 2c20 5356 475f 5441 475f  l_tree, SVG_TAG_
-00051690: 5245 4354 290d 0a20 2020 2020 2020 2069  RECT)..        i
-000516a0: 6620 6e6f 6465 2e78 3a0d 0a20 2020 2020  f node.x:..     
-000516b0: 2020 2020 2020 2078 6d6c 5f74 7265 652e         xml_tree.
-000516c0: 7365 7428 5356 475f 4154 5452 5f58 2c20  set(SVG_ATTR_X, 
-000516d0: 7374 7228 6e6f 6465 2e78 2929 0d0a 2020  str(node.x))..  
-000516e0: 2020 2020 2020 6966 206e 6f64 652e 793a        if node.y:
-000516f0: 0d0a 2020 2020 2020 2020 2020 2020 786d  ..            xm
-00051700: 6c5f 7472 6565 2e73 6574 2853 5647 5f41  l_tree.set(SVG_A
-00051710: 5454 525f 592c 2073 7472 286e 6f64 652e  TTR_Y, str(node.
-00051720: 7929 290d 0a20 2020 2020 2020 2069 6620  y))..        if 
-00051730: 6e6f 6465 2e72 783a 0d0a 2020 2020 2020  node.rx:..      
-00051740: 2020 2020 2020 786d 6c5f 7472 6565 2e73        xml_tree.s
-00051750: 6574 2853 5647 5f41 5454 525f 5241 4449  et(SVG_ATTR_RADI
-00051760: 5553 5f58 2c20 7374 7228 6e6f 6465 2e72  US_X, str(node.r
-00051770: 7829 290d 0a20 2020 2020 2020 2069 6620  x))..        if 
-00051780: 6e6f 6465 2e72 793a 0d0a 2020 2020 2020  node.ry:..      
-00051790: 2020 2020 2020 786d 6c5f 7472 6565 2e73        xml_tree.s
-000517a0: 6574 2853 5647 5f41 5454 525f 5241 4449  et(SVG_ATTR_RADI
-000517b0: 5553 5f59 2c20 7374 7228 6e6f 6465 2e72  US_Y, str(node.r
-000517c0: 7929 290d 0a20 2020 2020 2020 2069 6620  y))..        if 
-000517d0: 6e6f 6465 2e77 6964 7468 3a0d 0a20 2020  node.width:..   
-000517e0: 2020 2020 2020 2020 2078 6d6c 5f74 7265           xml_tre
-000517f0: 652e 7365 7428 5356 475f 4154 5452 5f57  e.set(SVG_ATTR_W
-00051800: 4944 5448 2c20 7374 7228 6e6f 6465 2e77  IDTH, str(node.w
-00051810: 6964 7468 2929 0d0a 2020 2020 2020 2020  idth))..        
-00051820: 6966 206e 6f64 652e 6865 6967 6874 3a0d  if node.height:.
-00051830: 0a20 2020 2020 2020 2020 2020 2078 6d6c  .            xml
-00051840: 5f74 7265 652e 7365 7428 5356 475f 4154  _tree.set(SVG_AT
-00051850: 5452 5f48 4549 4748 542c 2073 7472 286e  TR_HEIGHT, str(n
-00051860: 6f64 652e 6865 6967 6874 2929 0d0a 2020  ode.height))..  
-00051870: 2020 656c 6966 2069 7369 6e73 7461 6e63    elif isinstanc
-00051880: 6528 6e6f 6465 2c20 5465 7874 293a 0d0a  e(node, Text):..
-00051890: 2020 2020 2020 2020 786d 6c5f 7472 6565          xml_tree
-000518a0: 203d 2073 7562 786d 6c28 786d 6c5f 7472   = subxml(xml_tr
-000518b0: 6565 2c20 5356 475f 5441 475f 5445 5854  ee, SVG_TAG_TEXT
-000518c0: 290d 0a20 2020 2020 2020 2078 6d6c 5f74  )..        xml_t
-000518d0: 7265 652e 7465 7874 203d 206e 6f64 652e  ree.text = node.
-000518e0: 7465 7874 0d0a 2020 2020 2020 2020 6966  text..        if
-000518f0: 206e 6f64 652e 666f 6e74 5f66 616d 696c   node.font_famil
-00051900: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
-00051910: 786d 6c5f 7472 6565 2e73 6574 2853 5647  xml_tree.set(SVG
-00051920: 5f41 5454 525f 464f 4e54 5f46 414d 494c  _ATTR_FONT_FAMIL
-00051930: 592c 2073 7472 286e 6f64 652e 666f 6e74  Y, str(node.font
-00051940: 5f66 616d 696c 7929 290d 0a20 2020 2020  _family))..     
-00051950: 2020 2069 6620 6e6f 6465 2e66 6f6e 745f     if node.font_
-00051960: 7374 796c 653a 0d0a 2020 2020 2020 2020  style:..        
-00051970: 2020 2020 786d 6c5f 7472 6565 2e73 6574      xml_tree.set
-00051980: 2853 5647 5f41 5454 525f 464f 4e54 5f53  (SVG_ATTR_FONT_S
-00051990: 5459 4c45 2c20 7374 7228 6e6f 6465 2e66  TYLE, str(node.f
-000519a0: 6f6e 745f 7374 796c 6529 290d 0a20 2020  ont_style))..   
-000519b0: 2020 2020 2069 6620 6e6f 6465 2e66 6f6e       if node.fon
-000519c0: 745f 7661 7269 616e 743a 0d0a 2020 2020  t_variant:..    
-000519d0: 2020 2020 2020 2020 786d 6c5f 7472 6565          xml_tree
-000519e0: 2e73 6574 2853 5647 5f41 5454 525f 464f  .set(SVG_ATTR_FO
-000519f0: 4e54 5f56 4152 4941 4e54 2c20 7374 7228  NT_VARIANT, str(
-00051a00: 6e6f 6465 2e66 6f6e 745f 7661 7269 616e  node.font_varian
-00051a10: 7429 290d 0a20 2020 2020 2020 2069 6620  t))..        if 
-00051a20: 6e6f 6465 2e66 6f6e 745f 7374 7265 7463  node.font_stretc
-00051a30: 683a 0d0a 2020 2020 2020 2020 2020 2020  h:..            
-00051a40: 786d 6c5f 7472 6565 2e73 6574 2853 5647  xml_tree.set(SVG
-00051a50: 5f41 5454 525f 464f 4e54 5f53 5452 4554  _ATTR_FONT_STRET
-00051a60: 4348 2c20 6e6f 6465 2e66 6f6e 745f 7374  CH, node.font_st
-00051a70: 7265 7463 6829 0d0a 2020 2020 2020 2020  retch)..        
-00051a80: 6966 206e 6f64 652e 666f 6e74 5f73 697a  if node.font_siz
-00051a90: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00051aa0: 786d 6c5f 7472 6565 2e73 6574 2853 5647  xml_tree.set(SVG
-00051ab0: 5f41 5454 525f 464f 4e54 5f53 495a 452c  _ATTR_FONT_SIZE,
-00051ac0: 2073 7472 286e 6f64 652e 666f 6e74 5f73   str(node.font_s
-00051ad0: 697a 6529 290d 0a20 2020 2020 2020 2069  ize))..        i
-00051ae0: 6620 6e6f 6465 2e6c 696e 655f 6865 6967  f node.line_heig
-00051af0: 6874 3a0d 0a20 2020 2020 2020 2020 2020  ht:..           
-00051b00: 2078 6d6c 5f74 7265 652e 7365 7428 226c   xml_tree.set("l
-00051b10: 696e 655f 6865 6967 6874 222c 2073 7472  ine_height", str
-00051b20: 286e 6f64 652e 6c69 6e65 5f68 6569 6768  (node.line_heigh
-00051b30: 7429 290d 0a20 2020 2020 2020 2069 6620  t))..        if 
-00051b40: 6e6f 6465 2e61 6e63 686f 723a 0d0a 2020  node.anchor:..  
-00051b50: 2020 2020 2020 2020 2020 786d 6c5f 7472            xml_tr
-00051b60: 6565 2e73 6574 2853 5647 5f41 5454 525f  ee.set(SVG_ATTR_
-00051b70: 5445 5854 5f41 4e43 484f 522c 206e 6f64  TEXT_ANCHOR, nod
-00051b80: 652e 616e 6368 6f72 290d 0a20 2020 2065  e.anchor)..    e
-00051b90: 6c69 6620 6973 696e 7374 616e 6365 286e  lif isinstance(n
-00051ba0: 6f64 652c 2044 6573 6329 3a0d 0a20 2020  ode, Desc):..   
-00051bb0: 2020 2020 2078 6d6c 5f74 7265 6520 3d20       xml_tree = 
-00051bc0: 7375 6278 6d6c 2878 6d6c 5f74 7265 652c  subxml(xml_tree,
-00051bd0: 2053 5647 5f54 4147 5f44 4553 4329 0d0a   SVG_TAG_DESC)..
-00051be0: 2020 2020 2020 2020 6966 206e 6f64 652e          if node.
-00051bf0: 6465 7363 3a0d 0a20 2020 2020 2020 2020  desc:..         
-00051c00: 2020 2078 6d6c 5f74 7265 652e 7365 7428     xml_tree.set(
-00051c10: 5356 475f 5441 475f 4445 5343 2c20 7374  SVG_TAG_DESC, st
-00051c20: 7228 6e6f 6465 2e64 6573 6329 290d 0a20  r(node.desc)).. 
-00051c30: 2020 2065 6c69 6620 6973 696e 7374 616e     elif isinstan
-00051c40: 6365 286e 6f64 652c 2054 6974 6c65 293a  ce(node, Title):
-00051c50: 0d0a 2020 2020 2020 2020 786d 6c5f 7472  ..        xml_tr
-00051c60: 6565 203d 2073 7562 786d 6c28 786d 6c5f  ee = subxml(xml_
-00051c70: 7472 6565 2c20 5356 475f 5441 475f 5449  tree, SVG_TAG_TI
-00051c80: 544c 4529 0d0a 2020 2020 2020 2020 6966  TLE)..        if
-00051c90: 206e 6f64 652e 7469 746c 653a 0d0a 2020   node.title:..  
-00051ca0: 2020 2020 2020 2020 2020 786d 6c5f 7472            xml_tr
-00051cb0: 6565 2e73 6574 2853 5647 5f54 4147 5f54  ee.set(SVG_TAG_T
-00051cc0: 4954 4c45 2c20 7374 7228 6e6f 6465 2e74  ITLE, str(node.t
-00051cd0: 6974 6c65 2929 0d0a 2020 2020 656c 6966  itle))..    elif
-00051ce0: 2069 7369 6e73 7461 6e63 6528 6e6f 6465   isinstance(node
-00051cf0: 2c20 5061 7474 6572 6e29 3a0d 0a20 2020  , Pattern):..   
-00051d00: 2020 2020 2078 6d6c 5f74 7265 6520 3d20       xml_tree = 
-00051d10: 7375 6278 6d6c 2878 6d6c 5f74 7265 652c  subxml(xml_tree,
-00051d20: 2053 5647 5f54 4147 5f50 4154 5445 524e   SVG_TAG_PATTERN
-00051d30: 290d 0a20 2020 2020 2020 2069 6620 6e6f  )..        if no
-00051d40: 6465 2e70 6174 7465 726e 5f74 7261 6e73  de.pattern_trans
-00051d50: 666f 726d 3a0d 0a20 2020 2020 2020 2020  form:..         
-00051d60: 2020 2078 6d6c 5f74 7265 652e 7365 7428     xml_tree.set(
-00051d70: 5356 475f 4154 5452 5f50 4154 5445 524e  SVG_ATTR_PATTERN
-00051d80: 5f54 5241 4e53 464f 524d 2c20 7374 7228  _TRANSFORM, str(
-00051d90: 6e6f 6465 2e70 6174 7465 726e 5f74 7261  node.pattern_tra
-00051da0: 6e73 666f 726d 2929 0d0a 2020 2020 2020  nsform))..      
-00051db0: 2020 6966 206e 6f64 652e 7061 7474 6572    if node.patter
-00051dc0: 6e5f 636f 6e74 656e 745f 756e 6974 733a  n_content_units:
-00051dd0: 0d0a 2020 2020 2020 2020 2020 2020 786d  ..            xm
-00051de0: 6c5f 7472 6565 2e73 6574 280d 0a20 2020  l_tree.set(..   
-00051df0: 2020 2020 2020 2020 2020 2020 2053 5647               SVG
-00051e00: 5f41 5454 525f 5041 5454 4552 4e5f 434f  _ATTR_PATTERN_CO
-00051e10: 4e54 454e 545f 554e 4954 532c 2073 7472  NTENT_UNITS, str
-00051e20: 286e 6f64 652e 7061 7474 6572 6e5f 636f  (node.pattern_co
-00051e30: 6e74 656e 745f 756e 6974 7329 0d0a 2020  ntent_units)..  
-00051e40: 2020 2020 2020 2020 2020 290d 0a20 2020            )..   
-00051e50: 2020 2020 2069 6620 6e6f 6465 2e70 6174       if node.pat
-00051e60: 7465 726e 5f75 6e69 7473 3a0d 0a20 2020  tern_units:..   
-00051e70: 2020 2020 2020 2020 2078 6d6c 5f74 7265           xml_tre
-00051e80: 652e 7365 7428 5356 475f 4154 5452 5f50  e.set(SVG_ATTR_P
-00051e90: 4154 5445 524e 5f55 4e49 5453 2c20 7374  ATTERN_UNITS, st
-00051ea0: 7228 6e6f 6465 2e70 6174 7465 726e 5f75  r(node.pattern_u
-00051eb0: 6e69 7473 2929 0d0a 2020 2020 2020 2020  nits))..        
-00051ec0: 6966 206e 6f64 652e 7072 6573 6572 7665  if node.preserve
-00051ed0: 5f61 7370 6563 745f 7261 7469 6f3a 0d0a  _aspect_ratio:..
-00051ee0: 2020 2020 2020 2020 2020 2020 786d 6c5f              xml_
-00051ef0: 7472 6565 2e73 6574 2853 5647 5f41 5454  tree.set(SVG_ATT
-00051f00: 525f 5052 4553 4552 5645 4153 5045 4354  R_PRESERVEASPECT
-00051f10: 5241 5449 4f2c 2073 7472 286e 6f64 652e  RATIO, str(node.
-00051f20: 7072 6573 6572 7665 5f61 7370 6563 745f  preserve_aspect_
-00051f30: 7261 7469 6f29 290d 0a20 2020 2065 6c69  ratio))..    eli
-00051f40: 6620 6973 696e 7374 616e 6365 286e 6f64  f isinstance(nod
-00051f50: 652c 2055 7365 293a 0d0a 2020 2020 2020  e, Use):..      
-00051f60: 2020 2320 5768 696c 6520 5573 6520 656c    # While Use el
-00051f70: 656d 656e 7473 2061 7265 206f 7269 6769  ements are origi
-00051f80: 6e61 6c6c 7920 7468 6569 7220 6f77 6e20  nally their own 
-00051f90: 7468 696e 6720 6974 2063 616e 2774 2062  thing it can't b
-00051fa0: 6520 7265 7374 6f72 6564 2e0d 0a20 2020  e restored...   
-00051fb0: 2020 2020 2078 6d6c 5f74 7265 6520 3d20       xml_tree = 
-00051fc0: 7375 6278 6d6c 2878 6d6c 5f74 7265 652c  subxml(xml_tree,
-00051fd0: 2053 5647 5f54 4147 5f47 524f 5550 290d   SVG_TAG_GROUP).
-00051fe0: 0a20 2020 2020 2020 2066 6f72 2063 6869  .        for chi
-00051ff0: 6c64 2069 6e20 6e6f 6465 3a0d 0a20 2020  ld in node:..   
-00052000: 2020 2020 2020 2020 205f 7772 6974 655f           _write_
-00052010: 6e6f 6465 2863 6869 6c64 2c20 786d 6c5f  node(child, xml_
-00052020: 7472 6565 2c20 7669 6577 706f 7274 5f74  tree, viewport_t
-00052030: 7261 6e73 666f 726d 290d 0a20 2020 2065  ransform)..    e
-00052040: 6c69 6620 6973 696e 7374 616e 6365 286e  lif isinstance(n
-00052050: 6f64 652c 2047 726f 7570 293a 0d0a 2020  ode, Group):..  
-00052060: 2020 2020 2020 2320 5468 6973 2069 7320        # This is 
-00052070: 6120 7374 7275 6374 7572 616c 2067 726f  a structural gro
-00052080: 7570 206e 6f64 6520 6f66 2065 6c65 6d65  up node of eleme
-00052090: 6e74 732e 2052 6563 7572 7365 2063 616c  nts. Recurse cal
-000520a0: 6c20 746f 2077 7269 7465 2076 616c 7565  l to write value
-000520b0: 732e 0d0a 2020 2020 2020 2020 786d 6c5f  s...        xml_
-000520c0: 7472 6565 203d 2073 7562 786d 6c28 786d  tree = subxml(xm
-000520d0: 6c5f 7472 6565 2c20 5356 475f 5441 475f  l_tree, SVG_TAG_
-000520e0: 4752 4f55 5029 0d0a 2020 2020 2020 2020  GROUP)..        
-000520f0: 666f 7220 6368 696c 6420 696e 206e 6f64  for child in nod
-00052100: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00052110: 5f77 7269 7465 5f6e 6f64 6528 6368 696c  _write_node(chil
-00052120: 642c 2078 6d6c 5f74 7265 652c 2076 6965  d, xml_tree, vie
-00052130: 7770 6f72 745f 7472 616e 7366 6f72 6d29  wport_transform)
-00052140: 0d0a 2020 2020 656c 6966 2069 7369 6e73  ..    elif isins
-00052150: 7461 6e63 6528 6e6f 6465 2c20 5356 4745  tance(node, SVGE
-00052160: 6c65 6d65 6e74 293a 0d0a 2020 2020 2020  lement):..      
-00052170: 2020 6966 2053 5647 5f41 5454 525f 5441    if SVG_ATTR_TA
-00052180: 4720 696e 2076 616c 7565 733a 0d0a 2020  G in values:..  
-00052190: 2020 2020 2020 2020 2020 786d 6c5f 7472            xml_tr
-000521a0: 6565 203d 2073 7562 786d 6c28 786d 6c5f  ee = subxml(xml_
-000521b0: 7472 6565 2c20 7661 6c75 6573 2e67 6574  tree, values.get
-000521c0: 2853 5647 5f41 5454 525f 5441 4729 290d  (SVG_ATTR_TAG)).
-000521d0: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
-000521e0: 2020 2020 2020 2020 2020 2020 2320 4361              # Ca
-000521f0: 6e6e 6f74 2077 7269 7465 2067 656e 6572  nnot write gener
-00052200: 6963 2073 7667 656c 656d 656e 7420 666f  ic svgelement fo
-00052210: 726d 0d0a 2020 2020 2020 2020 2020 2020  rm..            
-00052220: 7265 7475 726e 0d0a 2020 2020 2320 5772  return..    # Wr
-00052230: 6974 6520 5472 616e 7366 6f72 6d0d 0a20  ite Transform.. 
-00052240: 2020 2069 6620 6861 7361 7474 7228 6e6f     if hasattr(no
-00052250: 6465 2c20 2274 7261 6e73 666f 726d 2229  de, "transform")
-00052260: 2061 6e64 206e 6f74 2069 7369 6e73 7461   and not isinsta
-00052270: 6e63 6528 6e6f 6465 2c20 4772 6f75 7029  nce(node, Group)
-00052280: 3a0d 0a20 2020 2020 2020 2074 203d 206e  :..        t = n
-00052290: 6f64 652e 7472 616e 7366 6f72 6d0d 0a20  ode.transform.. 
-000522a0: 2020 2020 2020 2069 6620 7669 6577 706f         if viewpo
-000522b0: 7274 5f74 7261 6e73 666f 726d 3a0d 0a20  rt_transform:.. 
-000522c0: 2020 2020 2020 2020 2020 2074 203d 2074             t = t
-000522d0: 202a 2076 6965 7770 6f72 745f 7472 616e   * viewport_tran
-000522e0: 7366 6f72 6d0d 0a20 2020 2020 2020 2069  sform..        i
-000522f0: 6620 6e6f 7420 742e 6973 5f69 6465 6e74  f not t.is_ident
-00052300: 6974 7928 293a 0d0a 2020 2020 2020 2020  ity():..        
-00052310: 2020 2020 786d 6c5f 7472 6565 2e73 6574      xml_tree.set
-00052320: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
-00052330: 2020 2053 5647 5f41 5454 525f 5452 414e     SVG_ATTR_TRAN
-00052340: 5346 4f52 4d2c 0d0a 2020 2020 2020 2020  SFORM,..        
-00052350: 2020 2020 2020 2020 226d 6174 7269 7828          "matrix(
-00052360: 2566 2c20 2566 2c20 2566 2c20 2566 2c20  %f, %f, %f, %f, 
-00052370: 2566 2c20 2566 2922 2025 2028 742e 612c  %f, %f)" % (t.a,
-00052380: 2074 2e62 2c20 742e 632c 2074 2e64 2c20   t.b, t.c, t.d, 
-00052390: 742e 652c 2074 2e66 292c 0d0a 2020 2020  t.e, t.f),..    
-000523a0: 2020 2020 2020 2020 290d 0a0d 0a20 2020          )....   
-000523b0: 2023 2057 7269 7465 2053 7472 6f6b 650d   # Write Stroke.
-000523c0: 0a20 2020 2069 6620 6861 7361 7474 7228  .    if hasattr(
-000523d0: 6e6f 6465 2c20 2273 7472 6f6b 6522 293a  node, "stroke"):
-000523e0: 0d0a 2020 2020 2020 2020 7374 726f 6b65  ..        stroke
-000523f0: 203d 206e 6f64 652e 7374 726f 6b65 0d0a   = node.stroke..
-00052400: 2020 2020 2020 2020 6966 2073 7472 6f6b          if strok
-00052410: 6520 6973 206e 6f74 204e 6f6e 653a 0d0a  e is not None:..
-00052420: 2020 2020 2020 2020 2020 2020 7374 726f              stro
-00052430: 6b65 5f6f 7061 6369 7479 203d 2073 7472  ke_opacity = str
-00052440: 6f6b 652e 6f70 6163 6974 790d 0a20 2020  oke.opacity..   
-00052450: 2020 2020 2020 2020 2073 7472 6f6b 6520           stroke 
-00052460: 3d20 280d 0a20 2020 2020 2020 2020 2020  = (..           
-00052470: 2020 2020 2073 7472 2861 6273 2873 7472       str(abs(str
-00052480: 6f6b 6529 290d 0a20 2020 2020 2020 2020  oke))..         
-00052490: 2020 2020 2020 2069 6620 7374 726f 6b65         if stroke
-000524a0: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
-000524b0: 2073 7472 6f6b 652e 7661 6c75 6520 6973   stroke.value is
-000524c0: 206e 6f74 204e 6f6e 650d 0a20 2020 2020   not None..     
-000524d0: 2020 2020 2020 2020 2020 2065 6c73 6520             else 
-000524e0: 5356 475f 5641 4c55 455f 4e4f 4e45 0d0a  SVG_VALUE_NONE..
-000524f0: 2020 2020 2020 2020 2020 2020 290d 0a20              ).. 
-00052500: 2020 2020 2020 2020 2020 2078 6d6c 5f74             xml_t
-00052510: 7265 652e 7365 7428 5356 475f 4154 5452  ree.set(SVG_ATTR
-00052520: 5f53 5452 4f4b 452c 2073 7472 2873 7472  _STROKE, str(str
-00052530: 6f6b 6529 290d 0a20 2020 2020 2020 2020  oke))..         
-00052540: 2020 2069 6620 7374 726f 6b65 5f6f 7061     if stroke_opa
-00052550: 6369 7479 2021 3d20 312e 3020 616e 6420  city != 1.0 and 
-00052560: 7374 726f 6b65 5f6f 7061 6369 7479 2069  stroke_opacity i
-00052570: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
-00052580: 2020 2020 2020 2020 2020 2020 2078 6d6c               xml
-00052590: 5f74 7265 652e 7365 7428 5356 475f 4154  _tree.set(SVG_AT
-000525a0: 5452 5f53 5452 4f4b 455f 4f50 4143 4954  TR_STROKE_OPACIT
-000525b0: 592c 2073 7472 2873 7472 6f6b 655f 6f70  Y, str(stroke_op
-000525c0: 6163 6974 7929 290d 0a0d 0a20 2020 2020  acity))....     
-000525d0: 2020 2020 2020 2074 7279 3a0d 0a20 2020         try:..   
-000525e0: 2020 2020 2020 2020 2020 2020 2073 7472               str
-000525f0: 6f6b 655f 7769 6474 6820 3d20 7374 7228  oke_width = str(
-00052600: 6e6f 6465 2e73 7472 6f6b 655f 7769 6474  node.stroke_widt
-00052610: 6829 0d0a 2020 2020 2020 2020 2020 2020  h)..            
-00052620: 2020 2020 786d 6c5f 7472 6565 2e73 6574      xml_tree.set
-00052630: 2853 5647 5f41 5454 525f 5354 524f 4b45  (SVG_ATTR_STROKE
-00052640: 5f57 4944 5448 2c20 7374 7228 7374 726f  _WIDTH, str(stro
-00052650: 6b65 5f77 6964 7468 2929 0d0a 2020 2020  ke_width))..    
-00052660: 2020 2020 2020 2020 6578 6365 7074 2041          except A
-00052670: 7474 7269 6275 7465 4572 726f 723a 0d0a  ttributeError:..
-00052680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052690: 7061 7373 0d0a 0d0a 2020 2020 2320 5772  pass....    # Wr
-000526a0: 6974 6520 4669 6c6c 0d0a 2020 2020 6966  ite Fill..    if
-000526b0: 2068 6173 6174 7472 286e 6f64 652c 2022   hasattr(node, "
-000526c0: 6669 6c6c 2229 3a0d 0a20 2020 2020 2020  fill"):..       
-000526d0: 2066 696c 6c20 3d20 6e6f 6465 2e66 696c   fill = node.fil
-000526e0: 6c0d 0a20 2020 2020 2020 2069 6620 6669  l..        if fi
-000526f0: 6c6c 2069 7320 6e6f 7420 4e6f 6e65 3a0d  ll is not None:.
-00052700: 0a20 2020 2020 2020 2020 2020 2066 696c  .            fil
-00052710: 6c5f 6f70 6163 6974 7920 3d20 6669 6c6c  l_opacity = fill
-00052720: 2e6f 7061 6369 7479 0d0a 2020 2020 2020  .opacity..      
-00052730: 2020 2020 2020 6669 6c6c 203d 2028 0d0a        fill = (..
-00052740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052750: 7374 7228 6162 7328 6669 6c6c 2929 0d0a  str(abs(fill))..
-00052760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052770: 6966 2066 696c 6c20 6973 206e 6f74 204e  if fill is not N
-00052780: 6f6e 6520 616e 6420 6669 6c6c 2e76 616c  one and fill.val
-00052790: 7565 2069 7320 6e6f 7420 4e6f 6e65 0d0a  ue is not None..
-000527a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000527b0: 656c 7365 2053 5647 5f56 414c 5545 5f4e  else SVG_VALUE_N
-000527c0: 4f4e 450d 0a20 2020 2020 2020 2020 2020  ONE..           
-000527d0: 2029 0d0a 2020 2020 2020 2020 2020 2020   )..            
-000527e0: 786d 6c5f 7472 6565 2e73 6574 2853 5647  xml_tree.set(SVG
-000527f0: 5f41 5454 525f 4649 4c4c 2c20 7374 7228  _ATTR_FILL, str(
-00052800: 6669 6c6c 2929 0d0a 2020 2020 2020 2020  fill))..        
-00052810: 2020 2020 6966 2066 696c 6c5f 6f70 6163      if fill_opac
-00052820: 6974 7920 213d 2031 2e30 2061 6e64 2066  ity != 1.0 and f
-00052830: 696c 6c5f 6f70 6163 6974 7920 6973 206e  ill_opacity is n
-00052840: 6f74 204e 6f6e 653a 0d0a 2020 2020 2020  ot None:..      
-00052850: 2020 2020 2020 2020 2020 786d 6c5f 7472            xml_tr
-00052860: 6565 2e73 6574 2853 5647 5f41 5454 525f  ee.set(SVG_ATTR_
-00052870: 4649 4c4c 5f4f 5041 4349 5459 2c20 7374  FILL_OPACITY, st
-00052880: 7228 6669 6c6c 5f6f 7061 6369 7479 2929  r(fill_opacity))
-00052890: 0d0a 0d0a 2020 2020 2320 5772 6974 6520  ....    # Write 
-000528a0: 6964 0d0a 2020 2020 6966 2068 6173 6174  id..    if hasat
-000528b0: 7472 286e 6f64 652c 2022 6964 2229 3a0d  tr(node, "id"):.
-000528c0: 0a20 2020 2020 2020 2069 6620 6e6f 6465  .        if node
-000528d0: 2e69 6420 6973 206e 6f74 204e 6f6e 653a  .id is not None:
-000528e0: 0d0a 2020 2020 2020 2020 2020 2020 786d  ..            xm
-000528f0: 6c5f 7472 6565 2e73 6574 2853 5647 5f41  l_tree.set(SVG_A
-00052900: 5454 525f 4944 2c20 7374 7228 6e6f 6465  TTR_ID, str(node
-00052910: 2e69 6429 290d 0a0d 0a20 2020 2072 6574  .id))....    ret
-00052920: 7572 6e20 786d 6c5f 7472 6565 0d0a 0d0a  urn xml_tree....
-00052930: 0d0a 6465 6620 5f70 7265 7474 795f 7072  ..def _pretty_pr
-00052940: 696e 7428 6375 7272 656e 742c 2070 6172  int(current, par
-00052950: 656e 743d 4e6f 6e65 2c20 696e 6465 783d  ent=None, index=
-00052960: 2d31 2c20 6465 7074 683d 3029 3a0d 0a20  -1, depth=0):.. 
-00052970: 2020 2066 6f72 2069 2c20 6e6f 6465 2069     for i, node i
-00052980: 6e20 656e 756d 6572 6174 6528 6375 7272  n enumerate(curr
-00052990: 656e 7429 3a0d 0a20 2020 2020 2020 205f  ent):..        _
-000529a0: 7072 6574 7479 5f70 7269 6e74 286e 6f64  pretty_print(nod
-000529b0: 652c 2063 7572 7265 6e74 2c20 692c 2064  e, current, i, d
-000529c0: 6570 7468 202b 2031 290d 0a20 2020 2069  epth + 1)..    i
-000529d0: 6620 7061 7265 6e74 2069 7320 6e6f 7420  f parent is not 
-000529e0: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2069  None:..        i
-000529f0: 6620 696e 6465 7820 3d3d 2030 3a0d 0a20  f index == 0:.. 
-00052a00: 2020 2020 2020 2020 2020 2070 6172 656e             paren
-00052a10: 742e 7465 7874 203d 2022 5c6e 2220 2b20  t.text = "\n" + 
-00052a20: 2822 5c74 2220 2a20 6465 7074 6829 0d0a  ("\t" * depth)..
-00052a30: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-00052a40: 2020 2020 2020 2020 2020 2070 6172 656e             paren
-00052a50: 745b 696e 6465 7820 2d20 315d 2e74 6169  t[index - 1].tai
-00052a60: 6c20 3d20 225c 6e22 202b 2028 225c 7422  l = "\n" + ("\t"
-00052a70: 202a 2064 6570 7468 290d 0a20 2020 2020   * depth)..     
-00052a80: 2020 2069 6620 696e 6465 7820 3d3d 206c     if index == l
-00052a90: 656e 2870 6172 656e 7429 202d 2031 3a0d  en(parent) - 1:.
-00052aa0: 0a20 2020 2020 2020 2020 2020 2063 7572  .            cur
-00052ab0: 7265 6e74 2e74 6169 6c20 3d20 225c 6e22  rent.tail = "\n"
-00052ac0: 202b 2028 225c 7422 202a 2028 6465 7074   + ("\t" * (dept
-00052ad0: 6820 2d20 3129 290d 0a                   h - 1))..
+00050160: 7320 3d20 5465 7874 2876 616c 7565 732c  s = Text(values,
+00050170: 2074 6578 743d 656c 656d 2e74 6578 7429   text=elem.text)
+00050180: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00050190: 2020 2020 2020 732e 7265 6e64 6572 2870        s.render(p
+000501a0: 7069 3d70 7069 2c20 7769 6474 683d 7769  pi=ppi, width=wi
+000501b0: 6474 682c 2068 6569 6768 743d 6865 6967  dth, height=heig
+000501c0: 6874 290d 0a20 2020 2020 2020 2020 2020  ht)..           
+000501d0: 2020 2020 2020 2020 2069 6620 7265 6966           if reif
+000501e0: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
+000501f0: 2020 2020 2020 2020 2020 2020 732e 7265              s.re
+00050200: 6966 7928 290d 0a20 2020 2020 2020 2020  ify()..         
+00050210: 2020 2020 2020 2020 2020 2069 6620 636f             if co
+00050220: 6e74 6578 7420 6973 206e 6f74 204e 6f6e  ntext is not Non
+00050230: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00050240: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+00050250: 6578 742e 6170 7065 6e64 2873 290d 0a20  ext.append(s).. 
+00050260: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00050270: 6c69 6620 5356 475f 5441 475f 4445 5343  lif SVG_TAG_DESC
+00050280: 203d 3d20 7461 673a 0d0a 2020 2020 2020   == tag:..      
+00050290: 2020 2020 2020 2020 2020 2020 2020 7320                s 
+000502a0: 3d20 4465 7363 2876 616c 7565 732c 2064  = Desc(values, d
+000502b0: 6573 633d 656c 656d 2e74 6578 7429 0d0a  esc=elem.text)..
+000502c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000502d0: 2020 2020 6966 2063 6f6e 7465 7874 2069      if context i
+000502e0: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
+000502f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050300: 2020 2020 2063 6f6e 7465 7874 2e61 7070       context.app
+00050310: 656e 6428 7329 0d0a 2020 2020 2020 2020  end(s)..        
+00050320: 2020 2020 2020 2020 656c 6966 2053 5647          elif SVG
+00050330: 5f54 4147 5f54 4954 4c45 203d 3d20 7461  _TAG_TITLE == ta
+00050340: 673a 0d0a 2020 2020 2020 2020 2020 2020  g:..            
+00050350: 2020 2020 2020 2020 7320 3d20 5469 746c          s = Titl
+00050360: 6528 7661 6c75 6573 2c20 7469 746c 653d  e(values, title=
+00050370: 656c 656d 2e74 6578 7429 0d0a 2020 2020  elem.text)..    
+00050380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050390: 6966 2063 6f6e 7465 7874 2069 7320 6e6f  if context is no
+000503a0: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
+000503b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000503c0: 2063 6f6e 7465 7874 2e61 7070 656e 6428   context.append(
+000503d0: 7329 0d0a 2020 2020 2020 2020 2020 2020  s)..            
+000503e0: 2020 2020 656c 6966 2053 5647 5f54 4147      elif SVG_TAG
+000503f0: 5f53 5459 4c45 203d 3d20 7461 673a 0d0a  _STYLE == tag:..
+00050400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050410: 2020 2020 7465 7874 7374 796c 6520 3d20      textstyle = 
+00050420: 656c 656d 2e74 6578 740d 0a20 2020 2020  elem.text..     
+00050430: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00050440: 6620 7465 7874 7374 796c 6520 6973 204e  f textstyle is N
+00050450: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
+00050460: 2020 2020 2020 2020 2020 2020 2020 7465                te
+00050470: 7874 7374 796c 6520 3d20 2222 0d0a 2020  xtstyle = ""..  
+00050480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050490: 2020 7465 7874 7374 796c 6520 3d20 7265    textstyle = re
+000504a0: 2e73 7562 2852 4547 4558 5f43 5353 5f43  .sub(REGEX_CSS_C
+000504b0: 4f4d 4d45 4e54 2c20 2222 2c20 7465 7874  OMMENT, "", text
+000504c0: 7374 796c 6529 0d0a 2020 2020 2020 2020  style)..        
+000504d0: 2020 2020 2020 2020 2020 2020 6173 7369              assi
+000504e0: 676e 6d65 6e74 7320 3d20 6c69 7374 2872  gnments = list(r
+000504f0: 652e 6669 6e64 616c 6c28 5245 4745 585f  e.findall(REGEX_
+00050500: 4353 535f 5354 594c 452c 2074 6578 7473  CSS_STYLE, texts
+00050510: 7479 6c65 2e73 7472 6970 2829 2929 0d0a  tyle.strip()))..
+00050520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050530: 2020 2020 666f 7220 6b65 792c 2076 616c      for key, val
+00050540: 7565 2069 6e20 6173 7369 676e 6d65 6e74  ue in assignment
+00050550: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
+00050560: 2020 2020 2020 2020 2020 2020 6b65 7920              key 
+00050570: 3d20 6b65 792e 7374 7269 7028 290d 0a20  = key.strip().. 
+00050580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050590: 2020 2020 2020 2076 616c 7565 203d 2076         value = v
+000505a0: 616c 7565 2e73 7472 6970 2829 0d0a 2020  alue.strip()..  
+000505b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000505c0: 2020 2020 2020 666f 7220 7365 6c65 6374        for select
+000505d0: 6f72 2069 6e20 6b65 792e 7370 6c69 7428  or in key.split(
+000505e0: 222c 2229 3a20 2023 2043 616e 2063 6f6d  ","):  # Can com
+000505f0: 6d61 2073 656c 6563 7420 7375 6269 7465  ma select subite
+00050600: 6d73 2e0d 0a20 2020 2020 2020 2020 2020  ms...           
+00050610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050620: 2073 656c 203d 2073 656c 6563 746f 722e   sel = selector.
+00050630: 7374 7269 7028 290d 0a20 2020 2020 2020  strip()..       
+00050640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050650: 2020 2020 2069 6620 7365 6c20 6e6f 7420       if sel not 
+00050660: 696e 2073 7479 6c65 733a 0d0a 2020 2020  in styles:..    
+00050670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050680: 2020 2020 2020 2020 2020 2020 7374 796c              styl
+00050690: 6573 5b73 656c 5d20 3d20 7661 6c75 650d  es[sel] = value.
+000506a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000506b0: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+000506c0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+000506d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000506e0: 2020 2020 6966 206e 6f74 2073 7479 6c65      if not style
+000506f0: 735b 7365 6c5d 2e65 6e64 7377 6974 6828  s[sel].endswith(
+00050700: 223b 2229 3a0d 0a20 2020 2020 2020 2020  ";"):..         
+00050710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050720: 2020 2020 2020 2020 2020 2073 7479 6c65             style
+00050730: 735b 7365 6c5d 202b 3d20 223b 220d 0a20  s[sel] += ";".. 
+00050740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050750: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00050760: 7479 6c65 735b 7365 6c5d 202b 3d20 7661  tyles[sel] += va
+00050770: 6c75 650d 0a20 2020 2020 2020 2020 2020  lue..           
+00050780: 2020 2020 2065 6c69 6620 5356 475f 5441       elif SVG_TA
+00050790: 475f 434c 4950 5041 5448 203d 3d20 7461  G_CLIPPATH == ta
+000507a0: 673a 0d0a 2020 2020 2020 2020 2020 2020  g:..            
+000507b0: 2020 2020 2020 2020 636c 6970 202d 3d20          clip -= 
+000507c0: 310d 0a20 2020 2020 2020 2020 2020 2020  1..             
+000507d0: 2020 2065 6c69 6620 5356 475f 5441 475f     elif SVG_TAG_
+000507e0: 5553 4520 3d3d 2074 6167 3a0d 0a20 2020  USE == tag:..   
+000507f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050800: 2075 7365 202d 3d20 310d 0a20 2020 2020   use -= 1..     
+00050810: 2020 2020 2020 2020 2020 2069 6620 7320             if s 
+00050820: 6973 206e 6f74 204e 6f6e 653a 0d0a 2020  is not None:..  
+00050830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050840: 2020 6966 2072 6f6f 7420 6973 204e 6f6e    if root is Non
+00050850: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00050860: 2020 2020 2020 2020 2020 2020 726f 6f74              root
+00050870: 203d 2073 0d0a 2020 2020 2020 2020 2020   = s..          
+00050880: 2020 2020 2020 2020 2020 2320 4173 7369            # Assi
+00050890: 676e 206f 7074 696f 6e61 6c20 6c69 6e6b  gn optional link
+000508a0: 6564 2070 726f 7065 7274 6965 732e 0d0a  ed properties...
+000508b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000508c0: 2020 2020 7472 793a 0d0a 2020 2020 2020      try:..      
+000508d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000508e0: 2020 636c 6970 5f70 6174 685f 7572 6c20    clip_path_url 
+000508f0: 3d20 732e 7661 6c75 6573 2e67 6574 2853  = s.values.get(S
+00050900: 5647 5f41 5454 525f 434c 4950 5f50 4154  VG_ATTR_CLIP_PAT
+00050910: 482c 204e 6f6e 6529 0d0a 2020 2020 2020  H, None)..      
+00050920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050930: 2020 6966 2063 6c69 705f 7061 7468 5f75    if clip_path_u
+00050940: 726c 2069 7320 6e6f 7420 4e6f 6e65 3a0d  rl is not None:.
+00050950: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00050960: 2020 2020 2020 2020 2020 2020 2063 6c69               cli
+00050970: 705f 7061 7468 203d 2072 6f6f 742e 6765  p_path = root.ge
+00050980: 745f 656c 656d 656e 745f 6279 5f75 726c  t_element_by_url
+00050990: 2863 6c69 705f 7061 7468 5f75 726c 290d  (clip_path_url).
+000509a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000509b0: 2020 2020 2020 2020 2020 2020 2073 2e63               s.c
+000509c0: 6c69 705f 7061 7468 203d 2063 6c69 705f  lip_path = clip_
+000509d0: 7061 7468 0d0a 2020 2020 2020 2020 2020  path..          
+000509e0: 2020 2020 2020 2020 2020 6578 6365 7074            except
+000509f0: 2041 7474 7269 6275 7465 4572 726f 723a   AttributeError:
+00050a00: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00050a10: 2020 2020 2020 2020 2020 7061 7373 0d0a            pass..
+00050a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050a30: 2020 2020 6966 2063 6c69 7020 213d 2030      if clip != 0
+00050a40: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00050a50: 2020 2020 2020 2020 2020 2074 7279 3a0d             try:.
+00050a60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00050a70: 2020 2020 2020 2020 2020 2020 2063 6c69               cli
+00050a80: 705f 7275 6c65 203d 2073 2e76 616c 7565  p_rule = s.value
+00050a90: 732e 6765 7428 0d0a 2020 2020 2020 2020  s.get(..        
+00050aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050ab0: 2020 2020 2020 2020 5356 475f 4154 5452          SVG_ATTR
+00050ac0: 5f43 4c49 505f 5255 4c45 2c20 5356 475f  _CLIP_RULE, SVG_
+00050ad0: 5255 4c45 5f4e 4f4e 5a45 524f 0d0a 2020  RULE_NONZERO..  
+00050ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050af0: 2020 2020 2020 2020 2020 290d 0a20 2020            )..   
+00050b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050b10: 2020 2020 2020 2020 2069 6620 636c 6970           if clip
+00050b20: 5f72 756c 6520 6973 206e 6f74 204e 6f6e  _rule is not Non
+00050b30: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00050b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050b50: 2020 2020 732e 636c 6970 5f72 756c 6520      s.clip_rule 
+00050b60: 3d20 636c 6970 5f72 756c 650d 0a20 2020  = clip_rule..   
+00050b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050b80: 2020 2020 2065 7863 6570 7420 4174 7472       except Attr
+00050b90: 6962 7574 6545 7272 6f72 3a0d 0a20 2020  ibuteError:..   
+00050ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050bb0: 2020 2020 2020 2020 2070 6173 730d 0a0d           pass...
+00050bc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00050bd0: 2063 6f6e 7465 7874 2c20 7661 6c75 6573   context, values
+00050be0: 203d 2073 7461 636b 2e70 6f70 2829 0d0a   = stack.pop()..
+00050bf0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+00050c00: 2065 7665 6e74 203d 3d20 2273 7461 7274   event == "start
+00050c10: 2d6e 7322 3a0d 0a20 2020 2020 2020 2020  -ns":..         
+00050c20: 2020 2020 2020 2069 6620 656c 656d 5b30         if elem[0
+00050c30: 5d20 213d 2053 5647 5f41 5454 525f 4441  ] != SVG_ATTR_DA
+00050c40: 5441 3a0d 0a20 2020 2020 2020 2020 2020  TA:..           
+00050c50: 2020 2020 2020 2020 2023 2052 6172 6520           # Rare 
+00050c60: 7763 3320 7465 7374 2075 7365 7320 6120  wc3 test uses a 
+00050c70: 2764 2720 6e61 6d65 7370 6163 652e 0d0a  'd' namespace...
+00050c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050c90: 2020 2020 7661 6c75 6573 5b65 6c65 6d5b      values[elem[
+00050ca0: 305d 5d20 3d20 656c 656d 5b31 5d0d 0a20  0]] = elem[1].. 
+00050cb0: 2020 2020 2020 2072 6574 7572 6e20 726f         return ro
+00050cc0: 6f74 0d0a 0d0a 0d0a 6465 6620 746f 7374  ot......def tost
+00050cd0: 7269 6e67 286e 6f64 6529 3a0d 0a20 2020  ring(node):..   
+00050ce0: 2066 726f 6d20 786d 6c2e 6574 7265 652e   from xml.etree.
+00050cf0: 456c 656d 656e 7454 7265 6520 696d 706f  ElementTree impo
+00050d00: 7274 2074 6f73 7472 696e 670d 0a0d 0a20  rt tostring.... 
+00050d10: 2020 2072 6574 7572 6e20 746f 7374 7269     return tostri
+00050d20: 6e67 285f 7772 6974 655f 6e6f 6465 286e  ng(_write_node(n
+00050d30: 6f64 6529 2c20 656e 636f 6469 6e67 3d22  ode), encoding="
+00050d40: 756e 6963 6f64 6522 290d 0a0d 0a0d 0a64  unicode")......d
+00050d50: 6566 2077 7269 7465 286e 6f64 652c 2066  ef write(node, f
+00050d60: 2c20 7072 6574 7479 3d54 7275 6529 3a0d  , pretty=True):.
+00050d70: 0a20 2020 2066 726f 6d20 786d 6c2e 6574  .    from xml.et
+00050d80: 7265 652e 456c 656d 656e 7454 7265 6520  ree.ElementTree 
+00050d90: 696d 706f 7274 2045 6c65 6d65 6e74 5472  import ElementTr
+00050da0: 6565 0d0a 0d0a 2020 2020 726f 6f74 203d  ee....    root =
+00050db0: 205f 7772 6974 655f 6e6f 6465 286e 6f64   _write_node(nod
+00050dc0: 6529 0d0a 2020 2020 6966 2070 7265 7474  e)..    if prett
+00050dd0: 793a 0d0a 2020 2020 2020 2020 5f70 7265  y:..        _pre
+00050de0: 7474 795f 7072 696e 7428 726f 6f74 290d  tty_print(root).
+00050df0: 0a20 2020 2074 7265 6520 3d20 456c 656d  .    tree = Elem
+00050e00: 656e 7454 7265 6528 726f 6f74 290d 0a20  entTree(root).. 
+00050e10: 2020 2069 6620 662e 6c6f 7765 7228 292e     if f.lower().
+00050e20: 656e 6473 7769 7468 2822 7376 677a 2229  endswith("svgz")
+00050e30: 3a0d 0a20 2020 2020 2020 2069 6d70 6f72  :..        impor
+00050e40: 7420 677a 6970 0d0a 0d0a 2020 2020 2020  t gzip....      
+00050e50: 2020 6620 3d20 677a 6970 2e6f 7065 6e28    f = gzip.open(
+00050e60: 662c 2022 7762 2229 0d0a 2020 2020 7472  f, "wb")..    tr
+00050e70: 6565 2e77 7269 7465 2866 290d 0a0d 0a0d  ee.write(f).....
+00050e80: 0a64 6566 205f 7772 6974 655f 6e6f 6465  .def _write_node
+00050e90: 286e 6f64 652c 2078 6d6c 5f74 7265 653d  (node, xml_tree=
+00050ea0: 4e6f 6e65 2c20 7669 6577 706f 7274 5f74  None, viewport_t
+00050eb0: 7261 6e73 666f 726d 3d4e 6f6e 6529 3a0d  ransform=None):.
+00050ec0: 0a20 2020 2069 6620 6861 7361 7474 7228  .    if hasattr(
+00050ed0: 6e6f 6465 2c20 2276 616c 7565 7322 293a  node, "values"):
+00050ee0: 0d0a 2020 2020 2020 2020 7661 6c75 6573  ..        values
+00050ef0: 203d 206e 6f64 652e 7661 6c75 6573 0d0a   = node.values..
+00050f00: 2020 2020 2020 2020 7661 6c75 6573 203d          values =
+00050f10: 206e 6f64 652e 7661 6c75 6573 2e67 6574   node.values.get
+00050f20: 2853 5647 5f53 5452 5543 545f 4154 5452  (SVG_STRUCT_ATTR
+00050f30: 4942 2c20 7661 6c75 6573 290d 0a20 2020  IB, values)..   
+00050f40: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+00050f50: 7661 6c75 6573 203d 204e 6f6e 650d 0a0d  values = None...
+00050f60: 0a20 2020 2064 6566 2073 7562 786d 6c28  .    def subxml(
+00050f70: 786d 6c5f 7472 6565 2c20 7461 6729 3a0d  xml_tree, tag):.
+00050f80: 0a20 2020 2020 2020 2066 726f 6d20 786d  .        from xm
+00050f90: 6c2e 6574 7265 652e 456c 656d 656e 7454  l.etree.ElementT
+00050fa0: 7265 6520 696d 706f 7274 2045 6c65 6d65  ree import Eleme
+00050fb0: 6e74 2c20 5375 6245 6c65 6d65 6e74 0d0a  nt, SubElement..
+00050fc0: 0d0a 2020 2020 2020 2020 6966 2078 6d6c  ..        if xml
+00050fd0: 5f74 7265 6520 6973 204e 6f6e 653a 0d0a  _tree is None:..
+00050fe0: 2020 2020 2020 2020 2020 2020 786d 6c5f              xml_
+00050ff0: 7472 6565 203d 2045 6c65 6d65 6e74 2874  tree = Element(t
+00051000: 6167 290d 0a20 2020 2020 2020 2065 6c73  ag)..        els
+00051010: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00051020: 786d 6c5f 7472 6565 203d 2053 7562 456c  xml_tree = SubEl
+00051030: 656d 656e 7428 786d 6c5f 7472 6565 2c20  ement(xml_tree, 
+00051040: 7461 6729 0d0a 2020 2020 2020 2020 666f  tag)..        fo
+00051050: 7220 6b65 792c 2076 616c 7565 2069 6e20  r key, value in 
+00051060: 7661 6c75 6573 2e69 7465 6d73 2829 3a0d  values.items():.
+00051070: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00051080: 6b65 7920 696e 2028 0d0a 2020 2020 2020  key in (..      
+00051090: 2020 2020 2020 2020 2020 2274 6167 222c            "tag",
+000510a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000510b0: 2020 5356 475f 5354 5255 4354 5f41 5454    SVG_STRUCT_ATT
+000510c0: 5249 422c 0d0a 2020 2020 2020 2020 2020  RIB,..          
+000510d0: 2020 2020 2020 5356 475f 4154 5452 5f54        SVG_ATTR_T
+000510e0: 5241 4e53 464f 524d 2c0d 0a20 2020 2020  RANSFORM,..     
+000510f0: 2020 2020 2020 2020 2020 2053 5647 5f41             SVG_A
+00051100: 5454 525f 4649 4c4c 2c0d 0a20 2020 2020  TTR_FILL,..     
+00051110: 2020 2020 2020 2020 2020 2053 5647 5f41             SVG_A
+00051120: 5454 525f 5354 524f 4b45 2c0d 0a20 2020  TTR_STROKE,..   
+00051130: 2020 2020 2020 2020 2020 2020 2053 5647               SVG
+00051140: 5f54 4147 5f53 5459 4c45 2c0d 0a20 2020  _TAG_STYLE,..   
+00051150: 2020 2020 2020 2020 2029 3a0d 0a20 2020           ):..   
+00051160: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+00051170: 7469 6e75 650d 0a20 2020 2020 2020 2020  tinue..         
+00051180: 2020 2078 6d6c 5f74 7265 652e 7365 7428     xml_tree.set(
+00051190: 6b65 792c 2073 7472 2876 616c 7565 2929  key, str(value))
+000511a0: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+000511b0: 2078 6d6c 5f74 7265 650d 0a0d 0a20 2020   xml_tree....   
+000511c0: 2069 6620 6973 696e 7374 616e 6365 286e   if isinstance(n
+000511d0: 6f64 652c 2053 5647 293a 0d0a 2020 2020  ode, SVG):..    
+000511e0: 2020 2020 6966 2078 6d6c 5f74 7265 6520      if xml_tree 
+000511f0: 6973 204e 6f6e 653a 0d0a 2020 2020 2020  is None:..      
+00051200: 2020 2020 2020 786d 6c5f 7472 6565 203d        xml_tree =
+00051210: 2073 7562 786d 6c28 786d 6c5f 7472 6565   subxml(xml_tree
+00051220: 2c20 5356 475f 4e41 4d45 5f54 4147 290d  , SVG_NAME_TAG).
+00051230: 0a20 2020 2020 2020 2020 2020 2078 6d6c  .            xml
+00051240: 5f74 7265 652e 7365 7428 5356 475f 4154  _tree.set(SVG_AT
+00051250: 5452 5f56 4552 5349 4f4e 2c20 5356 475f  TR_VERSION, SVG_
+00051260: 5641 4c55 455f 5645 5253 494f 4e29 0d0a  VALUE_VERSION)..
+00051270: 2020 2020 2020 2020 2020 2020 786d 6c5f              xml_
+00051280: 7472 6565 2e73 6574 2853 5647 5f41 5454  tree.set(SVG_ATT
+00051290: 525f 584d 4c4e 532c 2053 5647 5f56 414c  R_XMLNS, SVG_VAL
+000512a0: 5545 5f58 4d4c 4e53 290d 0a20 2020 2020  UE_XMLNS)..     
+000512b0: 2020 2020 2020 2078 6d6c 5f74 7265 652e         xml_tree.
+000512c0: 7365 7428 5356 475f 4154 5452 5f58 4d4c  set(SVG_ATTR_XML
+000512d0: 4e53 5f4c 494e 4b2c 2053 5647 5f56 414c  NS_LINK, SVG_VAL
+000512e0: 5545 5f58 4c49 4e4b 290d 0a20 2020 2020  UE_XLINK)..     
+000512f0: 2020 2020 2020 2078 6d6c 5f74 7265 652e         xml_tree.
+00051300: 7365 7428 5356 475f 4154 5452 5f58 4d4c  set(SVG_ATTR_XML
+00051310: 4e53 5f45 562c 2053 5647 5f56 414c 5545  NS_EV, SVG_VALUE
+00051320: 5f58 4d4c 4e53 5f45 5629 0d0a 2020 2020  _XMLNS_EV)..    
+00051330: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
+00051340: 2020 2020 2020 2078 6d6c 5f74 7265 6520         xml_tree 
+00051350: 3d20 7375 6278 6d6c 2878 6d6c 5f74 7265  = subxml(xml_tre
+00051360: 652c 2053 5647 5f4e 414d 455f 5441 4729  e, SVG_NAME_TAG)
+00051370: 0d0a 2020 2020 2020 2020 6966 206e 6f64  ..        if nod
+00051380: 652e 783a 0d0a 2020 2020 2020 2020 2020  e.x:..          
+00051390: 2020 786d 6c5f 7472 6565 2e73 6574 2853    xml_tree.set(S
+000513a0: 5647 5f41 5454 525f 582c 2073 7472 286e  VG_ATTR_X, str(n
+000513b0: 6f64 652e 7829 290d 0a20 2020 2020 2020  ode.x))..       
+000513c0: 2069 6620 6e6f 6465 2e79 3a0d 0a20 2020   if node.y:..   
+000513d0: 2020 2020 2020 2020 2078 6d6c 5f74 7265           xml_tre
+000513e0: 652e 7365 7428 5356 475f 4154 5452 5f59  e.set(SVG_ATTR_Y
+000513f0: 2c20 7374 7228 6e6f 6465 2e79 2929 0d0a  , str(node.y))..
+00051400: 2020 2020 2020 2020 6966 206e 6f64 652e          if node.
+00051410: 7769 6474 683a 0d0a 2020 2020 2020 2020  width:..        
+00051420: 2020 2020 786d 6c5f 7472 6565 2e73 6574      xml_tree.set
+00051430: 2853 5647 5f41 5454 525f 5749 4454 482c  (SVG_ATTR_WIDTH,
+00051440: 2073 7472 286e 6f64 652e 7769 6474 6829   str(node.width)
+00051450: 290d 0a20 2020 2020 2020 2069 6620 6e6f  )..        if no
+00051460: 6465 2e68 6569 6768 743a 0d0a 2020 2020  de.height:..    
+00051470: 2020 2020 2020 2020 786d 6c5f 7472 6565          xml_tree
+00051480: 2e73 6574 2853 5647 5f41 5454 525f 4845  .set(SVG_ATTR_HE
+00051490: 4947 4854 2c20 7374 7228 6e6f 6465 2e68  IGHT, str(node.h
+000514a0: 6569 6768 7429 290d 0a20 2020 2020 2020  eight))..       
+000514b0: 2069 6620 6e6f 6465 2e76 6965 7762 6f78   if node.viewbox
+000514c0: 3a0d 0a20 2020 2020 2020 2020 2020 2078  :..            x
+000514d0: 6d6c 5f74 7265 652e 7365 7428 5356 475f  ml_tree.set(SVG_
+000514e0: 4154 5452 5f56 4945 5742 4f58 2c20 7374  ATTR_VIEWBOX, st
+000514f0: 7228 6e6f 6465 2e76 6965 7762 6f78 2929  r(node.viewbox))
+00051500: 0d0a 2020 2020 2020 2020 7674 203d 206e  ..        vt = n
+00051510: 6f64 652e 7669 6577 626f 785f 7472 616e  ode.viewbox_tran
+00051520: 7366 6f72 6d0d 0a20 2020 2020 2020 2069  sform..        i
+00051530: 6620 7674 3a0d 0a20 2020 2020 2020 2020  f vt:..         
+00051540: 2020 206d 203d 204d 6174 7269 7828 7674     m = Matrix(vt
+00051550: 290d 0a20 2020 2020 2020 2020 2020 206d  )..            m
+00051560: 2e69 6e76 6572 7365 2829 0d0a 2020 2020  .inverse()..    
+00051570: 2020 2020 2020 2020 7674 203d 206d 0d0a          vt = m..
+00051580: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+00051590: 2020 2020 2020 2020 2020 2076 7420 3d20             vt = 
+000515a0: 4e6f 6e65 0d0a 2020 2020 2020 2020 666f  None..        fo
+000515b0: 7220 6368 696c 6420 696e 206e 6f64 653a  r child in node:
+000515c0: 0d0a 2020 2020 2020 2020 2020 2020 5f77  ..            _w
+000515d0: 7269 7465 5f6e 6f64 6528 6368 696c 642c  rite_node(child,
+000515e0: 2078 6d6c 5f74 7265 652c 2076 7429 0d0a   xml_tree, vt)..
+000515f0: 2020 2020 656c 6966 2069 7369 6e73 7461      elif isinsta
+00051600: 6e63 6528 6e6f 6465 2c20 456c 6c69 7073  nce(node, Ellips
+00051610: 6529 3a0d 0a20 2020 2020 2020 2078 6d6c  e):..        xml
+00051620: 5f74 7265 6520 3d20 7375 6278 6d6c 2878  _tree = subxml(x
+00051630: 6d6c 5f74 7265 652c 2053 5647 5f54 4147  ml_tree, SVG_TAG
+00051640: 5f45 4c4c 4950 5345 290d 0a20 2020 2020  _ELLIPSE)..     
+00051650: 2020 2069 6620 6e6f 6465 2e63 783a 0d0a     if node.cx:..
+00051660: 2020 2020 2020 2020 2020 2020 786d 6c5f              xml_
+00051670: 7472 6565 2e73 6574 2853 5647 5f41 5454  tree.set(SVG_ATT
+00051680: 525f 4345 4e54 4552 5f58 2c20 7374 7228  R_CENTER_X, str(
+00051690: 6e6f 6465 2e63 7829 290d 0a20 2020 2020  node.cx))..     
+000516a0: 2020 2069 6620 6e6f 6465 2e63 793a 0d0a     if node.cy:..
+000516b0: 2020 2020 2020 2020 2020 2020 786d 6c5f              xml_
+000516c0: 7472 6565 2e73 6574 2853 5647 5f41 5454  tree.set(SVG_ATT
+000516d0: 525f 4345 4e54 4552 5f59 2c20 7374 7228  R_CENTER_Y, str(
+000516e0: 6e6f 6465 2e63 7929 290d 0a20 2020 2020  node.cy))..     
+000516f0: 2020 2069 6620 6e6f 6465 2e72 783a 0d0a     if node.rx:..
+00051700: 2020 2020 2020 2020 2020 2020 786d 6c5f              xml_
+00051710: 7472 6565 2e73 6574 2853 5647 5f41 5454  tree.set(SVG_ATT
+00051720: 525f 5241 4449 5553 5f58 2c20 7374 7228  R_RADIUS_X, str(
+00051730: 6e6f 6465 2e72 7829 290d 0a20 2020 2020  node.rx))..     
+00051740: 2020 2069 6620 6e6f 6465 2e72 793a 0d0a     if node.ry:..
+00051750: 2020 2020 2020 2020 2020 2020 786d 6c5f              xml_
+00051760: 7472 6565 2e73 6574 2853 5647 5f41 5454  tree.set(SVG_ATT
+00051770: 525f 5241 4449 5553 5f59 2c20 7374 7228  R_RADIUS_Y, str(
+00051780: 6e6f 6465 2e72 7929 290d 0a20 2020 2065  node.ry))..    e
+00051790: 6c69 6620 6973 696e 7374 616e 6365 286e  lif isinstance(n
+000517a0: 6f64 652c 2043 6972 636c 6529 3a0d 0a20  ode, Circle):.. 
+000517b0: 2020 2020 2020 2078 6d6c 5f74 7265 6520         xml_tree 
+000517c0: 3d20 7375 6278 6d6c 2878 6d6c 5f74 7265  = subxml(xml_tre
+000517d0: 652c 2053 5647 5f54 4147 5f43 4952 434c  e, SVG_TAG_CIRCL
+000517e0: 4529 0d0a 2020 2020 2020 2020 6966 206e  E)..        if n
+000517f0: 6f64 652e 6378 3a0d 0a20 2020 2020 2020  ode.cx:..       
+00051800: 2020 2020 2078 6d6c 5f74 7265 652e 7365       xml_tree.se
+00051810: 7428 5356 475f 4154 5452 5f43 454e 5445  t(SVG_ATTR_CENTE
+00051820: 525f 582c 2073 7472 286e 6f64 652e 6378  R_X, str(node.cx
+00051830: 2929 0d0a 2020 2020 2020 2020 6966 206e  ))..        if n
+00051840: 6f64 652e 6379 3a0d 0a20 2020 2020 2020  ode.cy:..       
+00051850: 2020 2020 2078 6d6c 5f74 7265 652e 7365       xml_tree.se
+00051860: 7428 5356 475f 4154 5452 5f43 454e 5445  t(SVG_ATTR_CENTE
+00051870: 525f 592c 2073 7472 286e 6f64 652e 6379  R_Y, str(node.cy
+00051880: 2929 0d0a 2020 2020 2020 2020 6966 206e  ))..        if n
+00051890: 6f64 652e 7278 3a0d 0a20 2020 2020 2020  ode.rx:..       
+000518a0: 2020 2020 2078 6d6c 5f74 7265 652e 7365       xml_tree.se
+000518b0: 7428 5356 475f 4154 5452 5f52 4144 4955  t(SVG_ATTR_RADIU
+000518c0: 532c 2073 7472 286e 6f64 652e 7278 2929  S, str(node.rx))
+000518d0: 0d0a 2020 2020 656c 6966 2069 7369 6e73  ..    elif isins
+000518e0: 7461 6e63 6528 6e6f 6465 2c20 496d 6167  tance(node, Imag
+000518f0: 6529 3a0d 0a20 2020 2020 2020 2078 6d6c  e):..        xml
+00051900: 5f74 7265 6520 3d20 7375 6278 6d6c 2878  _tree = subxml(x
+00051910: 6d6c 5f74 7265 652c 2053 5647 5f54 4147  ml_tree, SVG_TAG
+00051920: 5f49 4d41 4745 290d 0a20 2020 2020 2020  _IMAGE)..       
+00051930: 2066 726f 6d20 6261 7365 3634 2069 6d70   from base64 imp
+00051940: 6f72 7420 6236 3465 6e63 6f64 650d 0a20  ort b64encode.. 
+00051950: 2020 2020 2020 2066 726f 6d20 696f 2069         from io i
+00051960: 6d70 6f72 7420 4279 7465 7349 4f0d 0a0d  mport BytesIO...
+00051970: 0a20 2020 2020 2020 2069 6620 6e6f 6465  .        if node
+00051980: 2e69 6d61 6765 2069 7320 6e6f 7420 4e6f  .image is not No
+00051990: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
+000519a0: 2073 7472 6561 6d20 3d20 4279 7465 7349   stream = BytesI
+000519b0: 4f28 290d 0a20 2020 2020 2020 2020 2020  O()..           
+000519c0: 206e 6f64 652e 696d 6167 652e 7361 7665   node.image.save
+000519d0: 2873 7472 6561 6d2c 2066 6f72 6d61 743d  (stream, format=
+000519e0: 2250 4e47 2229 0d0a 2020 2020 2020 2020  "PNG")..        
+000519f0: 2020 2020 786d 6c5f 7472 6565 2e73 6574      xml_tree.set
+00051a00: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
+00051a10: 2020 2022 786c 696e 6b3a 6872 6566 222c     "xlink:href",
+00051a20: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00051a30: 2020 6622 6461 7461 3a69 6d61 6765 2f70    f"data:image/p
+00051a40: 6e67 3b62 6173 6536 342c 7b62 3634 656e  ng;base64,{b64en
+00051a50: 636f 6465 2873 7472 6561 6d2e 6765 7476  code(stream.getv
+00051a60: 616c 7565 2829 292e 6465 636f 6465 2827  alue()).decode('
+00051a70: 7574 6638 2729 7d22 2c0d 0a20 2020 2020  utf8')}",..     
+00051a80: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
+00051a90: 2020 6966 206e 6f64 652e 783a 0d0a 2020    if node.x:..  
+00051aa0: 2020 2020 2020 2020 2020 786d 6c5f 7472            xml_tr
+00051ab0: 6565 2e73 6574 2853 5647 5f41 5454 525f  ee.set(SVG_ATTR_
+00051ac0: 582c 2073 7472 286e 6f64 652e 7829 290d  X, str(node.x)).
+00051ad0: 0a20 2020 2020 2020 2069 6620 6e6f 6465  .        if node
+00051ae0: 2e79 3a0d 0a20 2020 2020 2020 2020 2020  .y:..           
+00051af0: 2078 6d6c 5f74 7265 652e 7365 7428 5356   xml_tree.set(SV
+00051b00: 475f 4154 5452 5f59 2c20 7374 7228 6e6f  G_ATTR_Y, str(no
+00051b10: 6465 2e79 2929 0d0a 2020 2020 2020 2020  de.y))..        
+00051b20: 6966 206e 6f64 652e 7769 6474 683a 0d0a  if node.width:..
+00051b30: 2020 2020 2020 2020 2020 2020 786d 6c5f              xml_
+00051b40: 7472 6565 2e73 6574 2853 5647 5f41 5454  tree.set(SVG_ATT
+00051b50: 525f 5749 4454 482c 2073 7472 286e 6f64  R_WIDTH, str(nod
+00051b60: 652e 7769 6474 6829 290d 0a20 2020 2020  e.width))..     
+00051b70: 2020 2069 6620 6e6f 6465 2e68 6569 6768     if node.heigh
+00051b80: 743a 0d0a 2020 2020 2020 2020 2020 2020  t:..            
+00051b90: 786d 6c5f 7472 6565 2e73 6574 2853 5647  xml_tree.set(SVG
+00051ba0: 5f41 5454 525f 4845 4947 4854 2c20 7374  _ATTR_HEIGHT, st
+00051bb0: 7228 6e6f 6465 2e68 6569 6768 7429 290d  r(node.height)).
+00051bc0: 0a20 2020 2065 6c69 6620 6973 696e 7374  .    elif isinst
+00051bd0: 616e 6365 286e 6f64 652c 2053 696d 706c  ance(node, Simpl
+00051be0: 654c 696e 6529 3a0d 0a20 2020 2020 2020  eLine):..       
+00051bf0: 2078 6d6c 5f74 7265 6520 3d20 7375 6278   xml_tree = subx
+00051c00: 6d6c 2878 6d6c 5f74 7265 652c 2053 5647  ml(xml_tree, SVG
+00051c10: 5f54 4147 5f4c 494e 4529 0d0a 2020 2020  _TAG_LINE)..    
+00051c20: 2020 2020 6966 206e 6f64 652e 7831 3a0d      if node.x1:.
+00051c30: 0a20 2020 2020 2020 2020 2020 2078 6d6c  .            xml
+00051c40: 5f74 7265 652e 7365 7428 5356 475f 4154  _tree.set(SVG_AT
+00051c50: 5452 5f58 312c 2073 7472 286e 6f64 652e  TR_X1, str(node.
+00051c60: 7831 2929 0d0a 2020 2020 2020 2020 6966  x1))..        if
+00051c70: 206e 6f64 652e 7931 3a0d 0a20 2020 2020   node.y1:..     
+00051c80: 2020 2020 2020 2078 6d6c 5f74 7265 652e         xml_tree.
+00051c90: 7365 7428 5356 475f 4154 5452 5f59 312c  set(SVG_ATTR_Y1,
+00051ca0: 2073 7472 286e 6f64 652e 7931 2929 0d0a   str(node.y1))..
+00051cb0: 2020 2020 2020 2020 6966 206e 6f64 652e          if node.
+00051cc0: 7832 3a0d 0a20 2020 2020 2020 2020 2020  x2:..           
+00051cd0: 2078 6d6c 5f74 7265 652e 7365 7428 5356   xml_tree.set(SV
+00051ce0: 475f 4154 5452 5f58 322c 2073 7472 286e  G_ATTR_X2, str(n
+00051cf0: 6f64 652e 7832 2929 0d0a 2020 2020 2020  ode.x2))..      
+00051d00: 2020 6966 206e 6f64 652e 7932 3a0d 0a20    if node.y2:.. 
+00051d10: 2020 2020 2020 2020 2020 2078 6d6c 5f74             xml_t
+00051d20: 7265 652e 7365 7428 5356 475f 4154 5452  ree.set(SVG_ATTR
+00051d30: 5f59 322c 2073 7472 286e 6f64 652e 7932  _Y2, str(node.y2
+00051d40: 2929 0d0a 2020 2020 656c 6966 2069 7369  ))..    elif isi
+00051d50: 6e73 7461 6e63 6528 6e6f 6465 2c20 5061  nstance(node, Pa
+00051d60: 7468 293a 0d0a 2020 2020 2020 2020 786d  th):..        xm
+00051d70: 6c5f 7472 6565 203d 2073 7562 786d 6c28  l_tree = subxml(
+00051d80: 786d 6c5f 7472 6565 2c20 5356 475f 5441  xml_tree, SVG_TA
+00051d90: 475f 5041 5448 290d 0a20 2020 2020 2020  G_PATH)..       
+00051da0: 2078 6d6c 5f74 7265 652e 7365 7428 5356   xml_tree.set(SV
+00051db0: 475f 4154 5452 5f44 4154 412c 206e 6f64  G_ATTR_DATA, nod
+00051dc0: 652e 6428 7472 616e 7366 6f72 6d65 643d  e.d(transformed=
+00051dd0: 4661 6c73 6529 290d 0a20 2020 2065 6c69  False))..    eli
+00051de0: 6620 6973 696e 7374 616e 6365 286e 6f64  f isinstance(nod
+00051df0: 652c 2050 6f6c 796c 696e 6529 3a0d 0a20  e, Polyline):.. 
+00051e00: 2020 2020 2020 2078 6d6c 5f74 7265 6520         xml_tree 
+00051e10: 3d20 7375 6278 6d6c 2878 6d6c 5f74 7265  = subxml(xml_tre
+00051e20: 652c 2053 5647 5f54 4147 5f50 4f4c 594c  e, SVG_TAG_POLYL
+00051e30: 494e 4529 0d0a 2020 2020 2020 2020 786d  INE)..        xm
+00051e40: 6c5f 7472 6565 2e73 6574 280d 0a20 2020  l_tree.set(..   
+00051e50: 2020 2020 2020 2020 2053 5647 5f41 5454           SVG_ATT
+00051e60: 525f 504f 494e 5453 2c0d 0a20 2020 2020  R_POINTS,..     
+00051e70: 2020 2020 2020 2022 2022 2e6a 6f69 6e28         " ".join(
+00051e80: 5b66 227b 655b 305d 7d20 7b65 5b31 5d7d  [f"{e[0]} {e[1]}
+00051e90: 2220 666f 7220 6520 696e 206e 6f64 652e  " for e in node.
+00051ea0: 706f 696e 7473 5d29 2c0d 0a20 2020 2020  points]),..     
+00051eb0: 2020 2029 0d0a 2020 2020 656c 6966 2069     )..    elif i
+00051ec0: 7369 6e73 7461 6e63 6528 6e6f 6465 2c20  sinstance(node, 
+00051ed0: 506f 6c79 676f 6e29 3a0d 0a20 2020 2020  Polygon):..     
+00051ee0: 2020 2078 6d6c 5f74 7265 6520 3d20 7375     xml_tree = su
+00051ef0: 6278 6d6c 2878 6d6c 5f74 7265 652c 2053  bxml(xml_tree, S
+00051f00: 5647 5f54 4147 5f50 4f4c 5947 4f4e 290d  VG_TAG_POLYGON).
+00051f10: 0a20 2020 2020 2020 2078 6d6c 5f74 7265  .        xml_tre
+00051f20: 652e 7365 7428 0d0a 2020 2020 2020 2020  e.set(..        
+00051f30: 2020 2020 5356 475f 4154 5452 5f50 4f49      SVG_ATTR_POI
+00051f40: 4e54 532c 0d0a 2020 2020 2020 2020 2020  NTS,..          
+00051f50: 2020 2220 222e 6a6f 696e 285b 6622 7b65    " ".join([f"{e
+00051f60: 5b30 5d7d 207b 655b 315d 7d22 2066 6f72  [0]} {e[1]}" for
+00051f70: 2065 2069 6e20 6e6f 6465 2e70 6f69 6e74   e in node.point
+00051f80: 735d 292c 0d0a 2020 2020 2020 2020 290d  s]),..        ).
+00051f90: 0a20 2020 2065 6c69 6620 6973 696e 7374  .    elif isinst
+00051fa0: 616e 6365 286e 6f64 652c 2052 6563 7429  ance(node, Rect)
+00051fb0: 3a0d 0a20 2020 2020 2020 2078 6d6c 5f74  :..        xml_t
+00051fc0: 7265 6520 3d20 7375 6278 6d6c 2878 6d6c  ree = subxml(xml
+00051fd0: 5f74 7265 652c 2053 5647 5f54 4147 5f52  _tree, SVG_TAG_R
+00051fe0: 4543 5429 0d0a 2020 2020 2020 2020 6966  ECT)..        if
+00051ff0: 206e 6f64 652e 783a 0d0a 2020 2020 2020   node.x:..      
+00052000: 2020 2020 2020 786d 6c5f 7472 6565 2e73        xml_tree.s
+00052010: 6574 2853 5647 5f41 5454 525f 582c 2073  et(SVG_ATTR_X, s
+00052020: 7472 286e 6f64 652e 7829 290d 0a20 2020  tr(node.x))..   
+00052030: 2020 2020 2069 6620 6e6f 6465 2e79 3a0d       if node.y:.
+00052040: 0a20 2020 2020 2020 2020 2020 2078 6d6c  .            xml
+00052050: 5f74 7265 652e 7365 7428 5356 475f 4154  _tree.set(SVG_AT
+00052060: 5452 5f59 2c20 7374 7228 6e6f 6465 2e79  TR_Y, str(node.y
+00052070: 2929 0d0a 2020 2020 2020 2020 6966 206e  ))..        if n
+00052080: 6f64 652e 7278 3a0d 0a20 2020 2020 2020  ode.rx:..       
+00052090: 2020 2020 2078 6d6c 5f74 7265 652e 7365       xml_tree.se
+000520a0: 7428 5356 475f 4154 5452 5f52 4144 4955  t(SVG_ATTR_RADIU
+000520b0: 535f 582c 2073 7472 286e 6f64 652e 7278  S_X, str(node.rx
+000520c0: 2929 0d0a 2020 2020 2020 2020 6966 206e  ))..        if n
+000520d0: 6f64 652e 7279 3a0d 0a20 2020 2020 2020  ode.ry:..       
+000520e0: 2020 2020 2078 6d6c 5f74 7265 652e 7365       xml_tree.se
+000520f0: 7428 5356 475f 4154 5452 5f52 4144 4955  t(SVG_ATTR_RADIU
+00052100: 535f 592c 2073 7472 286e 6f64 652e 7279  S_Y, str(node.ry
+00052110: 2929 0d0a 2020 2020 2020 2020 6966 206e  ))..        if n
+00052120: 6f64 652e 7769 6474 683a 0d0a 2020 2020  ode.width:..    
+00052130: 2020 2020 2020 2020 786d 6c5f 7472 6565          xml_tree
+00052140: 2e73 6574 2853 5647 5f41 5454 525f 5749  .set(SVG_ATTR_WI
+00052150: 4454 482c 2073 7472 286e 6f64 652e 7769  DTH, str(node.wi
+00052160: 6474 6829 290d 0a20 2020 2020 2020 2069  dth))..        i
+00052170: 6620 6e6f 6465 2e68 6569 6768 743a 0d0a  f node.height:..
+00052180: 2020 2020 2020 2020 2020 2020 786d 6c5f              xml_
+00052190: 7472 6565 2e73 6574 2853 5647 5f41 5454  tree.set(SVG_ATT
+000521a0: 525f 4845 4947 4854 2c20 7374 7228 6e6f  R_HEIGHT, str(no
+000521b0: 6465 2e68 6569 6768 7429 290d 0a20 2020  de.height))..   
+000521c0: 2065 6c69 6620 6973 696e 7374 616e 6365   elif isinstance
+000521d0: 286e 6f64 652c 2054 6578 7429 3a0d 0a20  (node, Text):.. 
+000521e0: 2020 2020 2020 2078 6d6c 5f74 7265 6520         xml_tree 
+000521f0: 3d20 7375 6278 6d6c 2878 6d6c 5f74 7265  = subxml(xml_tre
+00052200: 652c 2053 5647 5f54 4147 5f54 4558 5429  e, SVG_TAG_TEXT)
+00052210: 0d0a 2020 2020 2020 2020 786d 6c5f 7472  ..        xml_tr
+00052220: 6565 2e74 6578 7420 3d20 6e6f 6465 2e74  ee.text = node.t
+00052230: 6578 740d 0a20 2020 2020 2020 2069 6620  ext..        if 
+00052240: 6e6f 6465 2e66 6f6e 745f 6661 6d69 6c79  node.font_family
+00052250: 3a0d 0a20 2020 2020 2020 2020 2020 2078  :..            x
+00052260: 6d6c 5f74 7265 652e 7365 7428 5356 475f  ml_tree.set(SVG_
+00052270: 4154 5452 5f46 4f4e 545f 4641 4d49 4c59  ATTR_FONT_FAMILY
+00052280: 2c20 7374 7228 6e6f 6465 2e66 6f6e 745f  , str(node.font_
+00052290: 6661 6d69 6c79 2929 0d0a 2020 2020 2020  family))..      
+000522a0: 2020 6966 206e 6f64 652e 666f 6e74 5f73    if node.font_s
+000522b0: 7479 6c65 3a0d 0a20 2020 2020 2020 2020  tyle:..         
+000522c0: 2020 2078 6d6c 5f74 7265 652e 7365 7428     xml_tree.set(
+000522d0: 5356 475f 4154 5452 5f46 4f4e 545f 5354  SVG_ATTR_FONT_ST
+000522e0: 594c 452c 2073 7472 286e 6f64 652e 666f  YLE, str(node.fo
+000522f0: 6e74 5f73 7479 6c65 2929 0d0a 2020 2020  nt_style))..    
+00052300: 2020 2020 6966 206e 6f64 652e 666f 6e74      if node.font
+00052310: 5f76 6172 6961 6e74 3a0d 0a20 2020 2020  _variant:..     
+00052320: 2020 2020 2020 2078 6d6c 5f74 7265 652e         xml_tree.
+00052330: 7365 7428 5356 475f 4154 5452 5f46 4f4e  set(SVG_ATTR_FON
+00052340: 545f 5641 5249 414e 542c 2073 7472 286e  T_VARIANT, str(n
+00052350: 6f64 652e 666f 6e74 5f76 6172 6961 6e74  ode.font_variant
+00052360: 2929 0d0a 2020 2020 2020 2020 6966 206e  ))..        if n
+00052370: 6f64 652e 666f 6e74 5f73 7472 6574 6368  ode.font_stretch
+00052380: 3a0d 0a20 2020 2020 2020 2020 2020 2078  :..            x
+00052390: 6d6c 5f74 7265 652e 7365 7428 5356 475f  ml_tree.set(SVG_
+000523a0: 4154 5452 5f46 4f4e 545f 5354 5245 5443  ATTR_FONT_STRETC
+000523b0: 482c 206e 6f64 652e 666f 6e74 5f73 7472  H, node.font_str
+000523c0: 6574 6368 290d 0a20 2020 2020 2020 2069  etch)..        i
+000523d0: 6620 6e6f 6465 2e66 6f6e 745f 7369 7a65  f node.font_size
+000523e0: 3a0d 0a20 2020 2020 2020 2020 2020 2078  :..            x
+000523f0: 6d6c 5f74 7265 652e 7365 7428 5356 475f  ml_tree.set(SVG_
+00052400: 4154 5452 5f46 4f4e 545f 5349 5a45 2c20  ATTR_FONT_SIZE, 
+00052410: 7374 7228 6e6f 6465 2e66 6f6e 745f 7369  str(node.font_si
+00052420: 7a65 2929 0d0a 2020 2020 2020 2020 6966  ze))..        if
+00052430: 206e 6f64 652e 6c69 6e65 5f68 6569 6768   node.line_heigh
+00052440: 743a 0d0a 2020 2020 2020 2020 2020 2020  t:..            
+00052450: 786d 6c5f 7472 6565 2e73 6574 2822 6c69  xml_tree.set("li
+00052460: 6e65 5f68 6569 6768 7422 2c20 7374 7228  ne_height", str(
+00052470: 6e6f 6465 2e6c 696e 655f 6865 6967 6874  node.line_height
+00052480: 2929 0d0a 2020 2020 2020 2020 6966 206e  ))..        if n
+00052490: 6f64 652e 616e 6368 6f72 3a0d 0a20 2020  ode.anchor:..   
+000524a0: 2020 2020 2020 2020 2078 6d6c 5f74 7265           xml_tre
+000524b0: 652e 7365 7428 5356 475f 4154 5452 5f54  e.set(SVG_ATTR_T
+000524c0: 4558 545f 414e 4348 4f52 2c20 6e6f 6465  EXT_ANCHOR, node
+000524d0: 2e61 6e63 686f 7229 0d0a 2020 2020 656c  .anchor)..    el
+000524e0: 6966 2069 7369 6e73 7461 6e63 6528 6e6f  if isinstance(no
+000524f0: 6465 2c20 4465 7363 293a 0d0a 2020 2020  de, Desc):..    
+00052500: 2020 2020 786d 6c5f 7472 6565 203d 2073      xml_tree = s
+00052510: 7562 786d 6c28 786d 6c5f 7472 6565 2c20  ubxml(xml_tree, 
+00052520: 5356 475f 5441 475f 4445 5343 290d 0a20  SVG_TAG_DESC).. 
+00052530: 2020 2020 2020 2069 6620 6e6f 6465 2e64         if node.d
+00052540: 6573 633a 0d0a 2020 2020 2020 2020 2020  esc:..          
+00052550: 2020 786d 6c5f 7472 6565 2e73 6574 2853    xml_tree.set(S
+00052560: 5647 5f54 4147 5f44 4553 432c 2073 7472  VG_TAG_DESC, str
+00052570: 286e 6f64 652e 6465 7363 2929 0d0a 2020  (node.desc))..  
+00052580: 2020 656c 6966 2069 7369 6e73 7461 6e63    elif isinstanc
+00052590: 6528 6e6f 6465 2c20 5469 746c 6529 3a0d  e(node, Title):.
+000525a0: 0a20 2020 2020 2020 2078 6d6c 5f74 7265  .        xml_tre
+000525b0: 6520 3d20 7375 6278 6d6c 2878 6d6c 5f74  e = subxml(xml_t
+000525c0: 7265 652c 2053 5647 5f54 4147 5f54 4954  ree, SVG_TAG_TIT
+000525d0: 4c45 290d 0a20 2020 2020 2020 2069 6620  LE)..        if 
+000525e0: 6e6f 6465 2e74 6974 6c65 3a0d 0a20 2020  node.title:..   
+000525f0: 2020 2020 2020 2020 2078 6d6c 5f74 7265           xml_tre
+00052600: 652e 7365 7428 5356 475f 5441 475f 5449  e.set(SVG_TAG_TI
+00052610: 544c 452c 2073 7472 286e 6f64 652e 7469  TLE, str(node.ti
+00052620: 746c 6529 290d 0a20 2020 2065 6c69 6620  tle))..    elif 
+00052630: 6973 696e 7374 616e 6365 286e 6f64 652c  isinstance(node,
+00052640: 2050 6174 7465 726e 293a 0d0a 2020 2020   Pattern):..    
+00052650: 2020 2020 786d 6c5f 7472 6565 203d 2073      xml_tree = s
+00052660: 7562 786d 6c28 786d 6c5f 7472 6565 2c20  ubxml(xml_tree, 
+00052670: 5356 475f 5441 475f 5041 5454 4552 4e29  SVG_TAG_PATTERN)
+00052680: 0d0a 2020 2020 2020 2020 6966 206e 6f64  ..        if nod
+00052690: 652e 7061 7474 6572 6e5f 7472 616e 7366  e.pattern_transf
+000526a0: 6f72 6d3a 0d0a 2020 2020 2020 2020 2020  orm:..          
+000526b0: 2020 786d 6c5f 7472 6565 2e73 6574 2853    xml_tree.set(S
+000526c0: 5647 5f41 5454 525f 5041 5454 4552 4e5f  VG_ATTR_PATTERN_
+000526d0: 5452 414e 5346 4f52 4d2c 2073 7472 286e  TRANSFORM, str(n
+000526e0: 6f64 652e 7061 7474 6572 6e5f 7472 616e  ode.pattern_tran
+000526f0: 7366 6f72 6d29 290d 0a20 2020 2020 2020  sform))..       
+00052700: 2069 6620 6e6f 6465 2e70 6174 7465 726e   if node.pattern
+00052710: 5f63 6f6e 7465 6e74 5f75 6e69 7473 3a0d  _content_units:.
+00052720: 0a20 2020 2020 2020 2020 2020 2078 6d6c  .            xml
+00052730: 5f74 7265 652e 7365 7428 0d0a 2020 2020  _tree.set(..    
+00052740: 2020 2020 2020 2020 2020 2020 5356 475f              SVG_
+00052750: 4154 5452 5f50 4154 5445 524e 5f43 4f4e  ATTR_PATTERN_CON
+00052760: 5445 4e54 5f55 4e49 5453 2c20 7374 7228  TENT_UNITS, str(
+00052770: 6e6f 6465 2e70 6174 7465 726e 5f63 6f6e  node.pattern_con
+00052780: 7465 6e74 5f75 6e69 7473 290d 0a20 2020  tent_units)..   
+00052790: 2020 2020 2020 2020 2029 0d0a 2020 2020           )..    
+000527a0: 2020 2020 6966 206e 6f64 652e 7061 7474      if node.patt
+000527b0: 6572 6e5f 756e 6974 733a 0d0a 2020 2020  ern_units:..    
+000527c0: 2020 2020 2020 2020 786d 6c5f 7472 6565          xml_tree
+000527d0: 2e73 6574 2853 5647 5f41 5454 525f 5041  .set(SVG_ATTR_PA
+000527e0: 5454 4552 4e5f 554e 4954 532c 2073 7472  TTERN_UNITS, str
+000527f0: 286e 6f64 652e 7061 7474 6572 6e5f 756e  (node.pattern_un
+00052800: 6974 7329 290d 0a20 2020 2020 2020 2069  its))..        i
+00052810: 6620 6e6f 6465 2e70 7265 7365 7276 655f  f node.preserve_
+00052820: 6173 7065 6374 5f72 6174 696f 3a0d 0a20  aspect_ratio:.. 
+00052830: 2020 2020 2020 2020 2020 2078 6d6c 5f74             xml_t
+00052840: 7265 652e 7365 7428 5356 475f 4154 5452  ree.set(SVG_ATTR
+00052850: 5f50 5245 5345 5256 4541 5350 4543 5452  _PRESERVEASPECTR
+00052860: 4154 494f 2c20 7374 7228 6e6f 6465 2e70  ATIO, str(node.p
+00052870: 7265 7365 7276 655f 6173 7065 6374 5f72  reserve_aspect_r
+00052880: 6174 696f 2929 0d0a 2020 2020 656c 6966  atio))..    elif
+00052890: 2069 7369 6e73 7461 6e63 6528 6e6f 6465   isinstance(node
+000528a0: 2c20 5573 6529 3a0d 0a20 2020 2020 2020  , Use):..       
+000528b0: 2023 2057 6869 6c65 2055 7365 2065 6c65   # While Use ele
+000528c0: 6d65 6e74 7320 6172 6520 6f72 6967 696e  ments are origin
+000528d0: 616c 6c79 2074 6865 6972 206f 776e 2074  ally their own t
+000528e0: 6869 6e67 2069 7420 6361 6e27 7420 6265  hing it can't be
+000528f0: 2072 6573 746f 7265 642e 0d0a 2020 2020   restored...    
+00052900: 2020 2020 786d 6c5f 7472 6565 203d 2073      xml_tree = s
+00052910: 7562 786d 6c28 786d 6c5f 7472 6565 2c20  ubxml(xml_tree, 
+00052920: 5356 475f 5441 475f 4752 4f55 5029 0d0a  SVG_TAG_GROUP)..
+00052930: 2020 2020 2020 2020 666f 7220 6368 696c          for chil
+00052940: 6420 696e 206e 6f64 653a 0d0a 2020 2020  d in node:..    
+00052950: 2020 2020 2020 2020 5f77 7269 7465 5f6e          _write_n
+00052960: 6f64 6528 6368 696c 642c 2078 6d6c 5f74  ode(child, xml_t
+00052970: 7265 652c 2076 6965 7770 6f72 745f 7472  ree, viewport_tr
+00052980: 616e 7366 6f72 6d29 0d0a 2020 2020 656c  ansform)..    el
+00052990: 6966 2069 7369 6e73 7461 6e63 6528 6e6f  if isinstance(no
+000529a0: 6465 2c20 4772 6f75 7029 3a0d 0a20 2020  de, Group):..   
+000529b0: 2020 2020 2023 2054 6869 7320 6973 2061       # This is a
+000529c0: 2073 7472 7563 7475 7261 6c20 6772 6f75   structural grou
+000529d0: 7020 6e6f 6465 206f 6620 656c 656d 656e  p node of elemen
+000529e0: 7473 2e20 5265 6375 7273 6520 6361 6c6c  ts. Recurse call
+000529f0: 2074 6f20 7772 6974 6520 7661 6c75 6573   to write values
+00052a00: 2e0d 0a20 2020 2020 2020 2078 6d6c 5f74  ...        xml_t
+00052a10: 7265 6520 3d20 7375 6278 6d6c 2878 6d6c  ree = subxml(xml
+00052a20: 5f74 7265 652c 2053 5647 5f54 4147 5f47  _tree, SVG_TAG_G
+00052a30: 524f 5550 290d 0a20 2020 2020 2020 2066  ROUP)..        f
+00052a40: 6f72 2063 6869 6c64 2069 6e20 6e6f 6465  or child in node
+00052a50: 3a0d 0a20 2020 2020 2020 2020 2020 205f  :..            _
+00052a60: 7772 6974 655f 6e6f 6465 2863 6869 6c64  write_node(child
+00052a70: 2c20 786d 6c5f 7472 6565 2c20 7669 6577  , xml_tree, view
+00052a80: 706f 7274 5f74 7261 6e73 666f 726d 290d  port_transform).
+00052a90: 0a20 2020 2065 6c69 6620 6973 696e 7374  .    elif isinst
+00052aa0: 616e 6365 286e 6f64 652c 2053 5647 456c  ance(node, SVGEl
+00052ab0: 656d 656e 7429 3a0d 0a20 2020 2020 2020  ement):..       
+00052ac0: 2069 6620 5356 475f 4154 5452 5f54 4147   if SVG_ATTR_TAG
+00052ad0: 2069 6e20 7661 6c75 6573 3a0d 0a20 2020   in values:..   
+00052ae0: 2020 2020 2020 2020 2078 6d6c 5f74 7265           xml_tre
+00052af0: 6520 3d20 7375 6278 6d6c 2878 6d6c 5f74  e = subxml(xml_t
+00052b00: 7265 652c 2076 616c 7565 732e 6765 7428  ree, values.get(
+00052b10: 5356 475f 4154 5452 5f54 4147 2929 0d0a  SVG_ATTR_TAG))..
+00052b20: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+00052b30: 2020 2020 2020 2020 2020 2023 2043 616e             # Can
+00052b40: 6e6f 7420 7772 6974 6520 6765 6e65 7269  not write generi
+00052b50: 6320 7376 6765 6c65 6d65 6e74 2066 6f72  c svgelement for
+00052b60: 6d0d 0a20 2020 2020 2020 2020 2020 2072  m..            r
+00052b70: 6574 7572 6e0d 0a20 2020 2023 2057 7269  eturn..    # Wri
+00052b80: 7465 2054 7261 6e73 666f 726d 0d0a 2020  te Transform..  
+00052b90: 2020 6966 2068 6173 6174 7472 286e 6f64    if hasattr(nod
+00052ba0: 652c 2022 7472 616e 7366 6f72 6d22 2920  e, "transform") 
+00052bb0: 616e 6420 6e6f 7420 6973 696e 7374 616e  and not isinstan
+00052bc0: 6365 286e 6f64 652c 2047 726f 7570 293a  ce(node, Group):
+00052bd0: 0d0a 2020 2020 2020 2020 7420 3d20 6e6f  ..        t = no
+00052be0: 6465 2e74 7261 6e73 666f 726d 0d0a 2020  de.transform..  
+00052bf0: 2020 2020 2020 6966 2076 6965 7770 6f72        if viewpor
+00052c00: 745f 7472 616e 7366 6f72 6d3a 0d0a 2020  t_transform:..  
+00052c10: 2020 2020 2020 2020 2020 7420 3d20 7420            t = t 
+00052c20: 2a20 7669 6577 706f 7274 5f74 7261 6e73  * viewport_trans
+00052c30: 666f 726d 0d0a 2020 2020 2020 2020 6966  form..        if
+00052c40: 206e 6f74 2074 2e69 735f 6964 656e 7469   not t.is_identi
+00052c50: 7479 2829 3a0d 0a20 2020 2020 2020 2020  ty():..         
+00052c60: 2020 2078 6d6c 5f74 7265 652e 7365 7428     xml_tree.set(
+00052c70: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00052c80: 2020 5356 475f 4154 5452 5f54 5241 4e53    SVG_ATTR_TRANS
+00052c90: 464f 524d 2c0d 0a20 2020 2020 2020 2020  FORM,..         
+00052ca0: 2020 2020 2020 2022 6d61 7472 6978 2825         "matrix(%
+00052cb0: 662c 2025 662c 2025 662c 2025 662c 2025  f, %f, %f, %f, %
+00052cc0: 662c 2025 6629 2220 2520 2874 2e61 2c20  f, %f)" % (t.a, 
+00052cd0: 742e 622c 2074 2e63 2c20 742e 642c 2074  t.b, t.c, t.d, t
+00052ce0: 2e65 2c20 742e 6629 2c0d 0a20 2020 2020  .e, t.f),..     
+00052cf0: 2020 2020 2020 2029 0d0a 0d0a 2020 2020         )....    
+00052d00: 2320 5772 6974 6520 5374 726f 6b65 0d0a  # Write Stroke..
+00052d10: 2020 2020 6966 2068 6173 6174 7472 286e      if hasattr(n
+00052d20: 6f64 652c 2022 7374 726f 6b65 2229 3a0d  ode, "stroke"):.
+00052d30: 0a20 2020 2020 2020 2073 7472 6f6b 6520  .        stroke 
+00052d40: 3d20 6e6f 6465 2e73 7472 6f6b 650d 0a20  = node.stroke.. 
+00052d50: 2020 2020 2020 2069 6620 7374 726f 6b65         if stroke
+00052d60: 2069 7320 6e6f 7420 4e6f 6e65 3a0d 0a20   is not None:.. 
+00052d70: 2020 2020 2020 2020 2020 2073 7472 6f6b             strok
+00052d80: 655f 6f70 6163 6974 7920 3d20 7374 726f  e_opacity = stro
+00052d90: 6b65 2e6f 7061 6369 7479 0d0a 2020 2020  ke.opacity..    
+00052da0: 2020 2020 2020 2020 7374 726f 6b65 203d          stroke =
+00052db0: 2028 0d0a 2020 2020 2020 2020 2020 2020   (..            
+00052dc0: 2020 2020 7374 7228 6162 7328 7374 726f      str(abs(stro
+00052dd0: 6b65 2929 0d0a 2020 2020 2020 2020 2020  ke))..          
+00052de0: 2020 2020 2020 6966 2073 7472 6f6b 6520        if stroke 
+00052df0: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
+00052e00: 7374 726f 6b65 2e76 616c 7565 2069 7320  stroke.value is 
+00052e10: 6e6f 7420 4e6f 6e65 0d0a 2020 2020 2020  not None..      
+00052e20: 2020 2020 2020 2020 2020 656c 7365 2053            else S
+00052e30: 5647 5f56 414c 5545 5f4e 4f4e 450d 0a20  VG_VALUE_NONE.. 
+00052e40: 2020 2020 2020 2020 2020 2029 0d0a 2020             )..  
+00052e50: 2020 2020 2020 2020 2020 786d 6c5f 7472            xml_tr
+00052e60: 6565 2e73 6574 2853 5647 5f41 5454 525f  ee.set(SVG_ATTR_
+00052e70: 5354 524f 4b45 2c20 7374 7228 7374 726f  STROKE, str(stro
+00052e80: 6b65 2929 0d0a 2020 2020 2020 2020 2020  ke))..          
+00052e90: 2020 6966 2073 7472 6f6b 655f 6f70 6163    if stroke_opac
+00052ea0: 6974 7920 213d 2031 2e30 2061 6e64 2073  ity != 1.0 and s
+00052eb0: 7472 6f6b 655f 6f70 6163 6974 7920 6973  troke_opacity is
+00052ec0: 206e 6f74 204e 6f6e 653a 0d0a 2020 2020   not None:..    
+00052ed0: 2020 2020 2020 2020 2020 2020 786d 6c5f              xml_
+00052ee0: 7472 6565 2e73 6574 2853 5647 5f41 5454  tree.set(SVG_ATT
+00052ef0: 525f 5354 524f 4b45 5f4f 5041 4349 5459  R_STROKE_OPACITY
+00052f00: 2c20 7374 7228 7374 726f 6b65 5f6f 7061  , str(stroke_opa
+00052f10: 6369 7479 2929 0d0a 0d0a 2020 2020 2020  city))....      
+00052f20: 2020 2020 2020 7472 793a 0d0a 2020 2020        try:..    
+00052f30: 2020 2020 2020 2020 2020 2020 7374 726f              stro
+00052f40: 6b65 5f77 6964 7468 203d 2073 7472 286e  ke_width = str(n
+00052f50: 6f64 652e 7374 726f 6b65 5f77 6964 7468  ode.stroke_width
+00052f60: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00052f70: 2020 2078 6d6c 5f74 7265 652e 7365 7428     xml_tree.set(
+00052f80: 5356 475f 4154 5452 5f53 5452 4f4b 455f  SVG_ATTR_STROKE_
+00052f90: 5749 4454 482c 2073 7472 2873 7472 6f6b  WIDTH, str(strok
+00052fa0: 655f 7769 6474 6829 290d 0a20 2020 2020  e_width))..     
+00052fb0: 2020 2020 2020 2065 7863 6570 7420 4174         except At
+00052fc0: 7472 6962 7574 6545 7272 6f72 3a0d 0a20  tributeError:.. 
+00052fd0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00052fe0: 6173 730d 0a0d 0a20 2020 2023 2057 7269  ass....    # Wri
+00052ff0: 7465 2046 696c 6c0d 0a20 2020 2069 6620  te Fill..    if 
+00053000: 6861 7361 7474 7228 6e6f 6465 2c20 2266  hasattr(node, "f
+00053010: 696c 6c22 293a 0d0a 2020 2020 2020 2020  ill"):..        
+00053020: 6669 6c6c 203d 206e 6f64 652e 6669 6c6c  fill = node.fill
+00053030: 0d0a 2020 2020 2020 2020 6966 2066 696c  ..        if fil
+00053040: 6c20 6973 206e 6f74 204e 6f6e 653a 0d0a  l is not None:..
+00053050: 2020 2020 2020 2020 2020 2020 6669 6c6c              fill
+00053060: 5f6f 7061 6369 7479 203d 2066 696c 6c2e  _opacity = fill.
+00053070: 6f70 6163 6974 790d 0a20 2020 2020 2020  opacity..       
+00053080: 2020 2020 2066 696c 6c20 3d20 280d 0a20       fill = (.. 
+00053090: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000530a0: 7472 2861 6273 2866 696c 6c29 290d 0a20  tr(abs(fill)).. 
+000530b0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000530c0: 6620 6669 6c6c 2069 7320 6e6f 7420 4e6f  f fill is not No
+000530d0: 6e65 2061 6e64 2066 696c 6c2e 7661 6c75  ne and fill.valu
+000530e0: 6520 6973 206e 6f74 204e 6f6e 650d 0a20  e is not None.. 
+000530f0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00053100: 6c73 6520 5356 475f 5641 4c55 455f 4e4f  lse SVG_VALUE_NO
+00053110: 4e45 0d0a 2020 2020 2020 2020 2020 2020  NE..            
+00053120: 290d 0a20 2020 2020 2020 2020 2020 2078  )..            x
+00053130: 6d6c 5f74 7265 652e 7365 7428 5356 475f  ml_tree.set(SVG_
+00053140: 4154 5452 5f46 494c 4c2c 2073 7472 2866  ATTR_FILL, str(f
+00053150: 696c 6c29 290d 0a20 2020 2020 2020 2020  ill))..         
+00053160: 2020 2069 6620 6669 6c6c 5f6f 7061 6369     if fill_opaci
+00053170: 7479 2021 3d20 312e 3020 616e 6420 6669  ty != 1.0 and fi
+00053180: 6c6c 5f6f 7061 6369 7479 2069 7320 6e6f  ll_opacity is no
+00053190: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
+000531a0: 2020 2020 2020 2020 2078 6d6c 5f74 7265           xml_tre
+000531b0: 652e 7365 7428 5356 475f 4154 5452 5f46  e.set(SVG_ATTR_F
+000531c0: 494c 4c5f 4f50 4143 4954 592c 2073 7472  ILL_OPACITY, str
+000531d0: 2866 696c 6c5f 6f70 6163 6974 7929 290d  (fill_opacity)).
+000531e0: 0a0d 0a20 2020 2023 2057 7269 7465 2069  ...    # Write i
+000531f0: 640d 0a20 2020 2069 6620 6861 7361 7474  d..    if hasatt
+00053200: 7228 6e6f 6465 2c20 2269 6422 293a 0d0a  r(node, "id"):..
+00053210: 2020 2020 2020 2020 6966 206e 6f64 652e          if node.
+00053220: 6964 2069 7320 6e6f 7420 4e6f 6e65 3a0d  id is not None:.
+00053230: 0a20 2020 2020 2020 2020 2020 2078 6d6c  .            xml
+00053240: 5f74 7265 652e 7365 7428 5356 475f 4154  _tree.set(SVG_AT
+00053250: 5452 5f49 442c 2073 7472 286e 6f64 652e  TR_ID, str(node.
+00053260: 6964 2929 0d0a 0d0a 2020 2020 7265 7475  id))....    retu
+00053270: 726e 2078 6d6c 5f74 7265 650d 0a0d 0a0d  rn xml_tree.....
+00053280: 0a64 6566 205f 7072 6574 7479 5f70 7269  .def _pretty_pri
+00053290: 6e74 2863 7572 7265 6e74 2c20 7061 7265  nt(current, pare
+000532a0: 6e74 3d4e 6f6e 652c 2069 6e64 6578 3d2d  nt=None, index=-
+000532b0: 312c 2064 6570 7468 3d30 293a 0d0a 2020  1, depth=0):..  
+000532c0: 2020 666f 7220 692c 206e 6f64 6520 696e    for i, node in
+000532d0: 2065 6e75 6d65 7261 7465 2863 7572 7265   enumerate(curre
+000532e0: 6e74 293a 0d0a 2020 2020 2020 2020 5f70  nt):..        _p
+000532f0: 7265 7474 795f 7072 696e 7428 6e6f 6465  retty_print(node
+00053300: 2c20 6375 7272 656e 742c 2069 2c20 6465  , current, i, de
+00053310: 7074 6820 2b20 3129 0d0a 2020 2020 6966  pth + 1)..    if
+00053320: 2070 6172 656e 7420 6973 206e 6f74 204e   parent is not N
+00053330: 6f6e 653a 0d0a 2020 2020 2020 2020 6966  one:..        if
+00053340: 2069 6e64 6578 203d 3d20 303a 0d0a 2020   index == 0:..  
+00053350: 2020 2020 2020 2020 2020 7061 7265 6e74            parent
+00053360: 2e74 6578 7420 3d20 225c 6e22 202b 2028  .text = "\n" + (
+00053370: 225c 7422 202a 2064 6570 7468 290d 0a20  "\t" * depth).. 
+00053380: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+00053390: 2020 2020 2020 2020 2020 7061 7265 6e74            parent
+000533a0: 5b69 6e64 6578 202d 2031 5d2e 7461 696c  [index - 1].tail
+000533b0: 203d 2022 5c6e 2220 2b20 2822 5c74 2220   = "\n" + ("\t" 
+000533c0: 2a20 6465 7074 6829 0d0a 2020 2020 2020  * depth)..      
+000533d0: 2020 6966 2069 6e64 6578 203d 3d20 6c65    if index == le
+000533e0: 6e28 7061 7265 6e74 2920 2d20 313a 0d0a  n(parent) - 1:..
+000533f0: 2020 2020 2020 2020 2020 2020 6375 7272              curr
+00053400: 656e 742e 7461 696c 203d 2022 5c6e 2220  ent.tail = "\n" 
+00053410: 2b20 2822 5c74 2220 2a20 2864 6570 7468  + ("\t" * (depth
+00053420: 202d 2031 2929 0d0a                       - 1))..
```

### Comparing `meerk40t-0.8.3000/meerk40t/tools/driver_to_path.py` & `meerk40t-0.8.4000/meerk40t/tools/driver_to_path.py`

 * *Files 0% similar despite different names*

```diff
@@ -453,15 +453,15 @@
         with elements.static("driver_to_path"):
             plotter = PlotterDriver()
             for opt in self.options:
                 if hasattr(plotter, opt["attr"]):
                     setattr(plotter, opt["attr"], getattr(self, opt["attr"]))
 
             spooler_job = elements.lookup(f"spoolerjob/{blob_type}")
-            job_object = spooler_job(plotter, elements.device.scene_to_show_matrix())
+            job_object = spooler_job(plotter, elements.space.display.matrix())
             job_object.write_blob(data)
             while not job_object.execute():
                 # Still more to execute.
                 pass
 
             op_nodes = {}
             color_index = 0
```

### Comparing `meerk40t-0.8.3000/meerk40t/tools/geomstr.py` & `meerk40t-0.8.4000/meerk40t/tools/geomstr.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/tools/jhfparser.py` & `meerk40t-0.8.4000/meerk40t/tools/jhfparser.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/tools/livinghinges.py` & `meerk40t-0.8.4000/meerk40t/tools/livinghinges.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/tools/pathtools.py` & `meerk40t-0.8.4000/meerk40t/tools/pathtools.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/tools/pointfinder.py` & `meerk40t-0.8.4000/meerk40t/tools/pointfinder.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/tools/polybool.py` & `meerk40t-0.8.4000/meerk40t/tools/polybool.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/tools/rasterplotter.py` & `meerk40t-0.8.4000/meerk40t/tools/rasterplotter.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/tools/shxparser.py` & `meerk40t-0.8.4000/meerk40t/tools/shxparser.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/tools/ttfparser.py` & `meerk40t-0.8.4000/meerk40t/tools/ttfparser.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t/tools/zinglplotter.py` & `meerk40t-0.8.4000/meerk40t/tools/zinglplotter.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/meerk40t.egg-info/PKG-INFO` & `meerk40t-0.8.4000/meerk40t.egg-info/PKG-INFO`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: meerk40t
-Version: 0.8.3000
+Version: 0.8.4000
 Summary: MeerK40t LaserCutter Software
 Home-page: https://github.com/meerk40t/meerk40t
 Author: Tatarize
 Author-email: tatarize@gmail.com
 License: MIT
 Description: # MeerK40t
         MeerK40t (pronounced MeerKat) is a built-from-the-ground-up MIT licensed open-source laser cutting software.
```

### Comparing `meerk40t-0.8.3000/meerk40t.egg-info/SOURCES.txt` & `meerk40t-0.8.4000/meerk40t.egg-info/SOURCES.txt`

 * *Files 5% similar despite different names*

```diff
@@ -1,13 +1,16 @@
 LICENSE
 README.md
 pyproject.toml
 setup.cfg
 setup.py
 ./meerk40t/__init__.py
+./meerk40t/external_plugins.py
+./meerk40t/external_plugins_build.py
+./meerk40t/internal_plugins.py
 ./meerk40t/main.py
 ./meerk40t/svgelements.py
 ./meerk40t/balormk/__init__.py
 ./meerk40t/balormk/balor_params.py
 ./meerk40t/balormk/controller.py
 ./meerk40t/balormk/device.py
 ./meerk40t/balormk/driver.py
@@ -33,25 +36,28 @@
 ./meerk40t/ch341/mock.py
 ./meerk40t/ch341/windll.py
 ./meerk40t/core/__init__.py
 ./meerk40t/core/bindalias.py
 ./meerk40t/core/core.py
 ./meerk40t/core/cutplan.py
 ./meerk40t/core/drivers.py
+./meerk40t/core/element_commands.py
 ./meerk40t/core/exceptions.py
 ./meerk40t/core/laserjob.py
 ./meerk40t/core/logging.py
 ./meerk40t/core/parameters.py
 ./meerk40t/core/planner.py
 ./meerk40t/core/plotplanner.py
+./meerk40t/core/space.py
 ./meerk40t/core/spoolers.py
 ./meerk40t/core/svg_io.py
 ./meerk40t/core/treeop.py
 ./meerk40t/core/undos.py
 ./meerk40t/core/units.py
+./meerk40t/core/view.py
 ./meerk40t/core/webhelp.py
 ./meerk40t/core/wordlist.py
 ./meerk40t/core/cutcode/__init__.py
 ./meerk40t/core/cutcode/cubiccut.py
 ./meerk40t/core/cutcode/cutcode.py
 ./meerk40t/core/cutcode/cutgroup.py
 ./meerk40t/core/cutcode/cutobject.py
@@ -73,14 +79,15 @@
 ./meerk40t/core/elements/element_treeops.py
 ./meerk40t/core/elements/element_types.py
 ./meerk40t/core/elements/elements.py
 ./meerk40t/core/elements/grid.py
 ./meerk40t/core/elements/materials.py
 ./meerk40t/core/elements/notes.py
 ./meerk40t/core/elements/penbox.py
+./meerk40t/core/elements/placements.py
 ./meerk40t/core/elements/render.py
 ./meerk40t/core/elements/shapes.py
 ./meerk40t/core/elements/trace.py
 ./meerk40t/core/elements/tree_commands.py
 ./meerk40t/core/elements/undo_redo.py
 ./meerk40t/core/elements/wordlist.py
 ./meerk40t/core/node/__init__.py
@@ -108,14 +115,16 @@
 ./meerk40t/core/node/nutils.py
 ./meerk40t/core/node/op_cut.py
 ./meerk40t/core/node/op_dots.py
 ./meerk40t/core/node/op_engrave.py
 ./meerk40t/core/node/op_hatch.py
 ./meerk40t/core/node/op_image.py
 ./meerk40t/core/node/op_raster.py
+./meerk40t/core/node/place_current.py
+./meerk40t/core/node/place_point.py
 ./meerk40t/core/node/refnode.py
 ./meerk40t/core/node/rootnode.py
 ./meerk40t/core/node/util_console.py
 ./meerk40t/core/node/util_goto.py
 ./meerk40t/core/node/util_home.py
 ./meerk40t/core/node/util_input.py
 ./meerk40t/core/node/util_origin.py
@@ -136,14 +145,15 @@
 ./meerk40t/device/gui/warningpanel.py
 ./meerk40t/dxf/__init__.py
 ./meerk40t/dxf/dxf_io.py
 ./meerk40t/dxf/plugin.py
 ./meerk40t/extra/__init__.py
 ./meerk40t/extra/cag.py
 ./meerk40t/extra/embroider.py
+./meerk40t/extra/ezd.py
 ./meerk40t/extra/hershey.py
 ./meerk40t/extra/imageactions.py
 ./meerk40t/extra/inkscape.py
 ./meerk40t/extra/pathoptimize.py
 ./meerk40t/extra/potrace.py
 ./meerk40t/extra/updater.py
 ./meerk40t/extra/vectrace.py
@@ -219,14 +229,15 @@
 ./meerk40t/gui/propertypanels/groupproperties.py
 ./meerk40t/gui/propertypanels/imageproperty.py
 ./meerk40t/gui/propertypanels/inputproperty.py
 ./meerk40t/gui/propertypanels/opbranchproperties.py
 ./meerk40t/gui/propertypanels/operationpropertymain.py
 ./meerk40t/gui/propertypanels/outputproperty.py
 ./meerk40t/gui/propertypanels/pathproperty.py
+./meerk40t/gui/propertypanels/placementproperty.py
 ./meerk40t/gui/propertypanels/pointproperty.py
 ./meerk40t/gui/propertypanels/propertywindow.py
 ./meerk40t/gui/propertypanels/rasterwizardpanels.py
 ./meerk40t/gui/propertypanels/textproperty.py
 ./meerk40t/gui/propertypanels/waitproperty.py
 ./meerk40t/gui/scene/__init__.py
 ./meerk40t/gui/scene/guicolors.py
@@ -260,14 +271,15 @@
 ./meerk40t/gui/toolwidgets/toolcircle.py
 ./meerk40t/gui/toolwidgets/toolcontainer.py
 ./meerk40t/gui/toolwidgets/tooldraw.py
 ./meerk40t/gui/toolwidgets/toolellipse.py
 ./meerk40t/gui/toolwidgets/toollinetext.py
 ./meerk40t/gui/toolwidgets/toolmeasure.py
 ./meerk40t/gui/toolwidgets/toolnodeedit.py
+./meerk40t/gui/toolwidgets/toolplacement.py
 ./meerk40t/gui/toolwidgets/toolpoint.py
 ./meerk40t/gui/toolwidgets/toolpolygon.py
 ./meerk40t/gui/toolwidgets/toolpolyline.py
 ./meerk40t/gui/toolwidgets/toolrect.py
 ./meerk40t/gui/toolwidgets/toolrelocate.py
 ./meerk40t/gui/toolwidgets/toolribbon.py
 ./meerk40t/gui/toolwidgets/tooltext.py
@@ -467,14 +479,31 @@
 meerk40t/core/cutcode/linecut.py
 meerk40t/core/cutcode/outputcut.py
 meerk40t/core/cutcode/plotcut.py
 meerk40t/core/cutcode/quadcut.py
 meerk40t/core/cutcode/rastercut.py
 meerk40t/core/cutcode/setorigincut.py
 meerk40t/core/cutcode/waitcut.py
+meerk40t/core/elements/__init__.py
+meerk40t/core/elements/align.py
+meerk40t/core/elements/branches.py
+meerk40t/core/elements/clipboard.py
+meerk40t/core/elements/element_treeops.py
+meerk40t/core/elements/element_types.py
+meerk40t/core/elements/elements.py
+meerk40t/core/elements/grid.py
+meerk40t/core/elements/materials.py
+meerk40t/core/elements/notes.py
+meerk40t/core/elements/penbox.py
+meerk40t/core/elements/render.py
+meerk40t/core/elements/shapes.py
+meerk40t/core/elements/trace.py
+meerk40t/core/elements/tree_commands.py
+meerk40t/core/elements/undo_redo.py
+meerk40t/core/elements/wordlist.py
 meerk40t/core/node/__init__.py
 meerk40t/core/node/blobnode.py
 meerk40t/core/node/bootstrap.py
 meerk40t/core/node/branch_elems.py
 meerk40t/core/node/branch_ops.py
 meerk40t/core/node/branch_regmark.py
 meerk40t/core/node/cutnode.py
@@ -542,14 +571,15 @@
 meerk40t/fill/patterns.py
 meerk40t/grbl/__init__.py
 meerk40t/grbl/control.py
 meerk40t/grbl/controller.py
 meerk40t/grbl/device.py
 meerk40t/grbl/driver.py
 meerk40t/grbl/emulator.py
+meerk40t/grbl/gcodejob.py
 meerk40t/grbl/interpreter.py
 meerk40t/grbl/loader.py
 meerk40t/grbl/mock_connection.py
 meerk40t/grbl/plugin.py
 meerk40t/grbl/serial_connection.py
 meerk40t/grbl/tcp_connection.py
 meerk40t/grbl/gui/__init__.py
@@ -557,14 +587,15 @@
 meerk40t/grbl/gui/grblserialcontroller.py
 meerk40t/grbl/gui/gui.py
 meerk40t/grbl/gui/tcpcontroller.py
 meerk40t/gui/__init__.py
 meerk40t/gui/about.py
 meerk40t/gui/alignment.py
 meerk40t/gui/bufferview.py
+meerk40t/gui/busy.py
 meerk40t/gui/choicepropertypanel.py
 meerk40t/gui/consolepanel.py
 meerk40t/gui/devicepanel.py
 meerk40t/gui/dialogoptions.py
 meerk40t/gui/executejob.py
 meerk40t/gui/fonts.py
 meerk40t/gui/hersheymanager.py
@@ -659,16 +690,22 @@
 meerk40t/gui/toolwidgets/tooltext.py
 meerk40t/gui/toolwidgets/toolvector.py
 meerk40t/gui/toolwidgets/toolwidget.py
 meerk40t/gui/utilitywidgets/__init__.py
 meerk40t/gui/utilitywidgets/buttonwidget.py
 meerk40t/gui/utilitywidgets/checkboxwidget.py
 meerk40t/gui/utilitywidgets/cyclocycloidwidget.py
+meerk40t/gui/utilitywidgets/handlewidget.py
+meerk40t/gui/utilitywidgets/harmonograph.py
+meerk40t/gui/utilitywidgets/openclosewidget.py
+meerk40t/gui/utilitywidgets/rotationwidget.py
+meerk40t/gui/utilitywidgets/scalewidget.py
 meerk40t/gui/utilitywidgets/seekbarwidget.py
 meerk40t/gui/utilitywidgets/togglewidget.py
+meerk40t/gui/utilitywidgets/toolbarwidget.py
 meerk40t/image/__init__.py
 meerk40t/image/imagetools.py
 meerk40t/kernel/__init__.py
 meerk40t/kernel/channel.py
 meerk40t/kernel/context.py
 meerk40t/kernel/exceptions.py
 meerk40t/kernel/functions.py
@@ -707,27 +744,48 @@
 meerk40t/moshi/gui/moshicontrollergui.py
 meerk40t/moshi/gui/moshidrivergui.py
 meerk40t/network/__init__.py
 meerk40t/network/console_server.py
 meerk40t/network/kernelserver.py
 meerk40t/network/tcp_server.py
 meerk40t/network/udp_server.py
+meerk40t/newly/__init__.py
+meerk40t/newly/controller.py
+meerk40t/newly/device.py
+meerk40t/newly/driver.py
+meerk40t/newly/mock_connection.py
+meerk40t/newly/newly_params.py
+meerk40t/newly/plugin.py
+meerk40t/newly/usb_connection.py
+meerk40t/newly/gui/__init__.py
+meerk40t/newly/gui/gui.py
+meerk40t/newly/gui/newlyconfig.py
+meerk40t/newly/gui/newlycontroller.py
+meerk40t/newly/gui/operationproperties.py
 meerk40t/rotary/__init__.py
 meerk40t/rotary/rotary.py
 meerk40t/rotary/gui/__init__.py
 meerk40t/rotary/gui/gui.py
 meerk40t/rotary/gui/rotarysettings.py
 meerk40t/ruida/__init__.py
 meerk40t/ruida/control.py
+meerk40t/ruida/controller.py
 meerk40t/ruida/device.py
+meerk40t/ruida/driver.py
 meerk40t/ruida/emulator.py
+meerk40t/ruida/exceptions.py
 meerk40t/ruida/loader.py
+meerk40t/ruida/mock_connection.py
 meerk40t/ruida/plugin.py
+meerk40t/ruida/rdjob.py
 meerk40t/ruida/gui/__init__.py
 meerk40t/ruida/gui/gui.py
+meerk40t/ruida/gui/ruidaconfig.py
+meerk40t/ruida/gui/ruidacontroller.py
+meerk40t/ruida/gui/ruidaoperationproperties.py
 meerk40t/tools/__init__.py
 meerk40t/tools/driver_to_path.py
 meerk40t/tools/geomstr.py
 meerk40t/tools/jhfparser.py
 meerk40t/tools/livinghinges.py
 meerk40t/tools/pathtools.py
 meerk40t/tools/pointfinder.py
```

### Comparing `meerk40t-0.8.3000/pyproject.toml` & `meerk40t-0.8.4000/pyproject.toml`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/setup.cfg` & `meerk40t-0.8.4000/setup.cfg`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 00000000: 5b6d 6574 6164 6174 615d 0d0a 6e61 6d65  [metadata]..name
 00000010: 203d 206d 6565 726b 3430 740d 0a76 6572   = meerk40t..ver
-00000020: 7369 6f6e 203d 2030 2e38 2e33 3030 300d  sion = 0.8.3000.
+00000020: 7369 6f6e 203d 2030 2e38 2e34 3030 300d  sion = 0.8.4000.
 00000030: 0a64 6573 6372 6970 7469 6f6e 203d 204d  .description = M
 00000040: 6565 724b 3430 7420 4c61 7365 7243 7574  eerK40t LaserCut
 00000050: 7465 7220 536f 6674 7761 7265 0d0a 6c6f  ter Software..lo
 00000060: 6e67 5f64 6573 6372 6970 7469 6f6e 5f63  ng_description_c
 00000070: 6f6e 7465 6e74 5f74 7970 6520 3d20 7465  ontent_type = te
 00000080: 7874 2f6d 6172 6b64 6f77 6e0d 0a6c 6f6e  xt/markdown..lon
 00000090: 675f 6465 7363 7269 7074 696f 6e20 3d20  g_description =
```

### Comparing `meerk40t-0.8.3000/setup.py` & `meerk40t-0.8.4000/setup.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/test/bootstrap.py` & `meerk40t-0.8.4000/test/bootstrap.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/test/test_core_cutcode.py` & `meerk40t-0.8.4000/test/test_core_cutcode.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/test/test_core_elements.py` & `meerk40t-0.8.4000/test/test_core_elements.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/test/test_core_plotplanner.py` & `meerk40t-0.8.4000/test/test_core_plotplanner.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/test/test_core_viewports.py` & `meerk40t-0.8.4000/test/test_core_viewports.py`

 * *Files 10% similar despite different names*

```diff
@@ -22,29 +22,25 @@
                 native_scale_x=UNITS_PER_MIL,
                 native_scale_y=UNITS_PER_MIL,
                 origin_x=random.random(),
                 origin_y=random.random(),
                 flip_x=bool(random.randint(0, 1)),
                 flip_y=bool(random.randint(0, 1)),
                 swap_xy=bool(random.randint(0, 1)),
-                show_origin_x=random.random(),
-                show_origin_y=random.random(),
-                show_flip_x=bool(random.randint(0, 1)),
-                show_flip_y=bool(random.randint(0, 1)),
             )
 
             x, y = view.scene_to_device_position(0, 0)
             x, y = view.device_to_scene_position(x, y)
             self.assertAlmostEqual(x, 0, delta=10)
             self.assertAlmostEqual(y, 0, delta=10)
 
-            x, y = view.show_to_device_position(0, 0)
-            x, y = view.device_to_show_position(x, y)
-            self.assertAlmostEqual(x, 0, delta=10)
-            self.assertAlmostEqual(y, 0, delta=10)
+            # x, y = view.show_to_device_position(0, 0)
+            # x, y = view.device_to_show_position(x, y)
+            # self.assertAlmostEqual(x, 0, delta=10)
+            # self.assertAlmostEqual(y, 0, delta=10)
 
     def test_viewport_lihuiyu_user_scale(self):
         """
         Test Lihuiyu-esque viewport. User-scaled to mm
 
         :return:
         """
@@ -205,108 +201,104 @@
                                 native_scale_x=units_per_galvo_x,
                                 native_scale_y=units_per_galvo_y,
                                 origin_x=1.0 if flip_x else 0.0,
                                 origin_y=1.0 if flip_y else 0.0,
                                 flip_x=flip_x,
                                 flip_y=flip_y,
                                 swap_xy=swap_xy,
-                                show_origin_x=0.5,
-                                show_origin_y=0.5,
-                                show_flip_x=show_flip_x,
-                                show_flip_y=show_flip_y,
                             )
                             sx, sy = view.device_to_scene_position(0x7FFF, 0x7FFF)
                             if swap_xy:
                                 self.assertAlmostEqual(sx, unit_size_y / 2, delta=10)
                                 self.assertAlmostEqual(sy, unit_size_x / 2, delta=10)
                             else:
                                 self.assertAlmostEqual(sx, unit_size_x / 2, delta=10)
                                 self.assertAlmostEqual(sy, unit_size_y / 2, delta=10)
                             vx, vy = view.physical_to_device_position("50%", "50%")
                             self.assertAlmostEqual(vx, 0x7FFF, delta=10)
                             self.assertAlmostEqual(vy, 0x7FFF, delta=10)
 
-    def test_viewport_balor_device_to_show(self):
-        """
-        Test Balor-esque viewport.
-        Center x, y. normal_x/flip_x, normal_y/flip_y, swap and non-linear
-
-        Device to show position.
-
-        :return:
-        """
-        lens_size_x = "110mm"
-        lens_size_y = "100mm"  # 10mm less
-        unit_size_x = float(Length(lens_size_x))
-        unit_size_y = float(Length(lens_size_y))
-        galvo_range = 0xFFFF
-        units_per_galvo_x = unit_size_x / galvo_range
-        units_per_galvo_y = unit_size_y / galvo_range
-
-        for flip_x in (False, True):
-            for flip_y in (False, True):
-                for swap_xy in (False, True):
-                    for show_flip_x in (False, True):
-                        for show_flip_y in (False, True):
-                            view = ViewPort(
-                                lens_size_x,
-                                lens_size_y,
-                                native_scale_x=units_per_galvo_x,
-                                native_scale_y=units_per_galvo_y,
-                                origin_x=1.0 if flip_x else 0.0,
-                                origin_y=1.0 if flip_y else 0.0,
-                                flip_x=flip_x,
-                                flip_y=flip_y,
-                                swap_xy=swap_xy,
-                                show_origin_x=0.5,
-                                show_origin_y=0.5,
-                                show_flip_x=show_flip_x,
-                                show_flip_y=show_flip_y,
-                            )
-                            x, y = view.device_to_show_position(0x7FFF, 0x7FFF)
-                            self.assertAlmostEqual(x, 0, delta=10)
-                            self.assertAlmostEqual(y, 0, delta=10)
-                            x, y = view.show_to_device_position(0, 0)
-                            self.assertAlmostEqual(x, 0x7FFF, delta=10)
-                            self.assertAlmostEqual(y, 0x7FFF, delta=10)
-
-    def test_viewport_balor_physical_to_show(self):
-        """
-        Test Balor-esque viewport.
-        Center x, y. flip_x, flip_y, swap and offset
-
-        :return:
-        """
-        lens_size_x = "110mm"
-        lens_size_y = "100mm"  # 10mm less
-        unit_size_x = float(Length(lens_size_x))
-        unit_size_y = float(Length(lens_size_y))
-        galvo_range = 0xFFFF
-        units_per_galvo_x = unit_size_x / galvo_range
-        units_per_galvo_y = unit_size_y / galvo_range
-
-        for flip_x in (False, True):
-            for flip_y in (False, True):
-                for swap_xy in (False, True):
-                    view = ViewPort(
-                        lens_size_x,
-                        lens_size_y,
-                        native_scale_x=units_per_galvo_x,
-                        native_scale_y=units_per_galvo_y,
-                        origin_x=1.0 if flip_x else 0.0,
-                        origin_y=1.0 if flip_y else 0.0,
-                        show_origin_x=0.5,
-                        show_origin_y=0.5,
-                        flip_x=flip_x,
-                        flip_y=flip_y,
-                        swap_xy=swap_xy,
-                    )
-                    hx, hy = view.physical_to_show_position("55mm", "50mm")
-                    self.assertAlmostEqual(hx, 0)
-                    self.assertAlmostEqual(hy, 0)
+    # def test_viewport_balor_device_to_show(self):
+    #     """
+    #     Test Balor-esque viewport.
+    #     Center x, y. normal_x/flip_x, normal_y/flip_y, swap and non-linear
+    #
+    #     Device to show position.
+    #
+    #     :return:
+    #     """
+    #     lens_size_x = "110mm"
+    #     lens_size_y = "100mm"  # 10mm less
+    #     unit_size_x = float(Length(lens_size_x))
+    #     unit_size_y = float(Length(lens_size_y))
+    #     galvo_range = 0xFFFF
+    #     units_per_galvo_x = unit_size_x / galvo_range
+    #     units_per_galvo_y = unit_size_y / galvo_range
+    #
+    #     for flip_x in (False, True):
+    #         for flip_y in (False, True):
+    #             for swap_xy in (False, True):
+    #                 for show_flip_x in (False, True):
+    #                     for show_flip_y in (False, True):
+    #                         view = ViewPort(
+    #                             lens_size_x,
+    #                             lens_size_y,
+    #                             native_scale_x=units_per_galvo_x,
+    #                             native_scale_y=units_per_galvo_y,
+    #                             origin_x=1.0 if flip_x else 0.0,
+    #                             origin_y=1.0 if flip_y else 0.0,
+    #                             flip_x=flip_x,
+    #                             flip_y=flip_y,
+    #                             swap_xy=swap_xy,
+    #                             show_origin_x=0.5,
+    #                             show_origin_y=0.5,
+    #                             show_flip_x=show_flip_x,
+    #                             show_flip_y=show_flip_y,
+    #                         )
+    #                         x, y = view.device_to_show_position(0x7FFF, 0x7FFF)
+    #                         self.assertAlmostEqual(x, 0, delta=10)
+    #                         self.assertAlmostEqual(y, 0, delta=10)
+    #                         x, y = view.show_to_device_position(0, 0)
+    #                         self.assertAlmostEqual(x, 0x7FFF, delta=10)
+    #                         self.assertAlmostEqual(y, 0x7FFF, delta=10)
+
+    # def test_viewport_balor_physical_to_show(self):
+    #     """
+    #     Test Balor-esque viewport.
+    #     Center x, y. flip_x, flip_y, swap and offset
+    #
+    #     :return:
+    #     """
+    #     lens_size_x = "110mm"
+    #     lens_size_y = "100mm"  # 10mm less
+    #     unit_size_x = float(Length(lens_size_x))
+    #     unit_size_y = float(Length(lens_size_y))
+    #     galvo_range = 0xFFFF
+    #     units_per_galvo_x = unit_size_x / galvo_range
+    #     units_per_galvo_y = unit_size_y / galvo_range
+    #
+    #     for flip_x in (False, True):
+    #         for flip_y in (False, True):
+    #             for swap_xy in (False, True):
+    #                 view = ViewPort(
+    #                     lens_size_x,
+    #                     lens_size_y,
+    #                     native_scale_x=units_per_galvo_x,
+    #                     native_scale_y=units_per_galvo_y,
+    #                     origin_x=1.0 if flip_x else 0.0,
+    #                     origin_y=1.0 if flip_y else 0.0,
+    #                     show_origin_x=0.5,
+    #                     show_origin_y=0.5,
+    #                     flip_x=flip_x,
+    #                     flip_y=flip_y,
+    #                     swap_xy=swap_xy,
+    #                 )
+    #                 hx, hy = view.physical_to_show_position("55mm", "50mm")
+    #                 self.assertAlmostEqual(hx, 0)
+    #                 self.assertAlmostEqual(hy, 0)
 
     def test_viewport_balor_physical_to_scene(self):
         """
         Test Balor-esque viewport.
         Center x, y. flip_x, flip_y, swap and offset
 
         :return:
@@ -325,16 +317,14 @@
                     view = ViewPort(
                         lens_size_x,
                         lens_size_y,
                         native_scale_x=units_per_galvo_x,
                         native_scale_y=units_per_galvo_y,
                         origin_x=1.0 if flip_x else 0.0,
                         origin_y=1.0 if flip_y else 0.0,
-                        show_origin_x=0.5,
-                        show_origin_y=0.5,
                         flip_x=flip_x,
                         flip_y=flip_y,
                         swap_xy=swap_xy,
                     )
                     sx, sy = view.physical_to_scene_position("50%", "50%")
 
                     dim0 = view.unit_width / 2
```

### Comparing `meerk40t-0.8.3000/test/test_drivers_grbl.py` & `meerk40t-0.8.4000/test/test_drivers_grbl.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/test/test_drivers_lihuiyu.py` & `meerk40t-0.8.4000/test/test_drivers_lihuiyu.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/test/test_element_degenerate_points.py` & `meerk40t-0.8.4000/test/test_element_degenerate_points.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/test/test_elements_classify.py` & `meerk40t-0.8.4000/test/test_elements_classify.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/test/test_elements_penbox.py` & `meerk40t-0.8.4000/test/test_elements_penbox.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/test/test_fill.py` & `meerk40t-0.8.4000/test/test_fill.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/test/test_geomstr.py` & `meerk40t-0.8.4000/test/test_geomstr.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/test/test_imagetools_actualize.py` & `meerk40t-0.8.4000/test/test_imagetools_actualize.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/test/test_imagetools_wizard.py` & `meerk40t-0.8.4000/test/test_imagetools_wizard.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/test/test_kernel.py` & `meerk40t-0.8.4000/test/test_kernel.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/test/test_laser_speeds.py` & `meerk40t-0.8.4000/test/test_laser_speeds.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/test/test_length.py` & `meerk40t-0.8.4000/test/test_length.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/test/test_lifecycle.py` & `meerk40t-0.8.4000/test/test_lifecycle.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/test/test_operations_hatch.py` & `meerk40t-0.8.4000/test/test_operations_hatch.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/test/test_spooler.py` & `meerk40t-0.8.4000/test/test_spooler.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/test/test_wobble.py` & `meerk40t-0.8.4000/test/test_wobble.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.3000/test/test_zingl.py` & `meerk40t-0.8.4000/test/test_zingl.py`

 * *Files identical despite different names*

