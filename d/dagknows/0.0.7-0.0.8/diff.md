# Comparing `tmp/dagknows-0.0.7-py3-none-any.whl.zip` & `tmp/dagknows-0.0.8-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,27 +1,27 @@
-Zip file size: 27498 bytes, number of entries: 25
--rw-r--r--  2.0 unx       23 b- defN 23-Apr-28 05:54 dagcli/__init__.py
+Zip file size: 27896 bytes, number of entries: 25
+-rw-r--r--  2.0 unx       23 b- defN 23-Apr-28 22:08 dagcli/__init__.py
 -rw-r--r--  2.0 unx     6232 b- defN 23-Apr-27 18:48 dagcli/client.py
 -rw-r--r--  2.0 unx    13656 b- defN 23-Apr-26 21:28 dagcli/cmd.py
--rw-r--r--  2.0 unx     4003 b- defN 23-Apr-22 21:12 dagcli/configs.py
+-rw-r--r--  2.0 unx     4065 b- defN 23-Apr-28 17:13 dagcli/configs.py
 -rw-r--r--  2.0 unx     6014 b- defN 23-Apr-28 05:42 dagcli/dags.py
 -rw-r--r--  2.0 unx     2864 b- defN 23-Apr-28 05:46 dagcli/execs.py
 -rw-r--r--  2.0 unx     2614 b- defN 23-Apr-10 22:19 dagcli/main.py
 -rw-r--r--  2.0 unx     2290 b- defN 23-Apr-22 21:07 dagcli/messages.py
 -rw-r--r--  2.0 unx     5655 b- defN 23-Apr-28 01:23 dagcli/nodes.py
 -rw-r--r--  2.0 unx     1833 b- defN 23-Apr-19 17:56 dagcli/proxy.py
--rw-r--r--  2.0 unx     4157 b- defN 23-Apr-24 02:22 dagcli/root.py
+-rw-r--r--  2.0 unx     5503 b- defN 23-Apr-28 22:16 dagcli/root.py
 -rw-r--r--  2.0 unx     4098 b- defN 23-Apr-26 21:29 dagcli/sessions.py
 -rw-r--r--  2.0 unx     4743 b- defN 23-Apr-26 21:29 dagcli/swaggerutils.py
 -rw-r--r--  2.0 unx     1171 b- defN 23-Apr-15 22:48 dagcli/tokens.py
 -rw-r--r--  2.0 unx     3353 b- defN 23-Apr-27 18:51 dagcli/transformers.py
 -rw-r--r--  2.0 unx     5192 b- defN 23-Apr-26 21:29 dagcli/tries.py
 -rw-r--r--  2.0 unx      777 b- defN 23-Apr-25 14:09 dagcli/ty.py
 -rw-r--r--  2.0 unx     4007 b- defN 23-Apr-27 16:10 dagcli/utils.py
--rw-r--r--  2.0 unx     1087 b- defN 23-Apr-28 05:55 dagknows-0.0.7.dist-info/LICENSE
--rw-r--r--  2.0 unx     1247 b- defN 23-Apr-28 05:55 dagknows-0.0.7.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 23-Apr-28 05:55 dagknows-0.0.7.dist-info/WHEEL
--rw-r--r--  2.0 unx       60 b- defN 23-Apr-28 05:55 dagknows-0.0.7.dist-info/entry_points.txt
--rw-r--r--  2.0 unx        7 b- defN 23-Apr-28 05:55 dagknows-0.0.7.dist-info/top_level.txt
--rw-r--r--  2.0 unx        1 b- defN 23-Apr-28 05:55 dagknows-0.0.7.dist-info/zip-safe
--rw-rw-r--  2.0 unx     1886 b- defN 23-Apr-28 05:55 dagknows-0.0.7.dist-info/RECORD
-25 files, 77062 bytes uncompressed, 24522 bytes compressed:  68.2%
+-rw-r--r--  2.0 unx     1087 b- defN 23-Apr-28 22:16 dagknows-0.0.8.dist-info/LICENSE
+-rw-r--r--  2.0 unx     1247 b- defN 23-Apr-28 22:16 dagknows-0.0.8.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 23-Apr-28 22:16 dagknows-0.0.8.dist-info/WHEEL
+-rw-r--r--  2.0 unx       60 b- defN 23-Apr-28 22:16 dagknows-0.0.8.dist-info/entry_points.txt
+-rw-r--r--  2.0 unx        7 b- defN 23-Apr-28 22:16 dagknows-0.0.8.dist-info/top_level.txt
+-rw-r--r--  2.0 unx        1 b- defN 23-Apr-28 22:16 dagknows-0.0.8.dist-info/zip-safe
+-rw-rw-r--  2.0 unx     1886 b- defN 23-Apr-28 22:16 dagknows-0.0.8.dist-info/RECORD
+25 files, 78470 bytes uncompressed, 24920 bytes compressed:  68.2%
```

## zipnote {}

```diff
@@ -48,29 +48,29 @@
 
 Filename: dagcli/ty.py
 Comment: 
 
 Filename: dagcli/utils.py
 Comment: 
 
-Filename: dagknows-0.0.7.dist-info/LICENSE
+Filename: dagknows-0.0.8.dist-info/LICENSE
 Comment: 
 
-Filename: dagknows-0.0.7.dist-info/METADATA
+Filename: dagknows-0.0.8.dist-info/METADATA
 Comment: 
 
-Filename: dagknows-0.0.7.dist-info/WHEEL
+Filename: dagknows-0.0.8.dist-info/WHEEL
 Comment: 
 
-Filename: dagknows-0.0.7.dist-info/entry_points.txt
+Filename: dagknows-0.0.8.dist-info/entry_points.txt
 Comment: 
 
-Filename: dagknows-0.0.7.dist-info/top_level.txt
+Filename: dagknows-0.0.8.dist-info/top_level.txt
 Comment: 
 
-Filename: dagknows-0.0.7.dist-info/zip-safe
+Filename: dagknows-0.0.8.dist-info/zip-safe
 Comment: 
 
-Filename: dagknows-0.0.7.dist-info/RECORD
+Filename: dagknows-0.0.8.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## dagcli/__init__.py

```diff
@@ -1,2 +1,2 @@
 
-__version__ = "0.0.7"
+__version__ = "0.0.8"
```

## dagcli/configs.py

```diff
@@ -2,19 +2,20 @@
 import requests
 import json
 import re
 import os
 from dagcli.client import SessionClient
 
 class DagKnowsConfig:
-    def __init__(self, homedir, **data):
+    def __init__(self, homedir, curr_profile="default", **data):
         self.homedir = homedir
         self.data = data
         self._curr_profile_data = {}
         self._client = None
+        self._curr_profile = curr_profile
         self.tree_transformer = None
         self.load()
 
     @property
     def headers(self):
         out = {
             "Authorization": f"Bearer {self.access_token}",
@@ -81,22 +82,22 @@
 
     @property
     def profile_data(self):
         return self._curr_profile_data
 
     @property
     def curr_profile(self):
-        return self.data["profile"]
+        return self._curr_profile
 
     @curr_profile.setter
     def curr_profile(self, newprofile):
         if newprofile != self.curr_profile:
             self.save()
             self._client = None
-            self.data["profile"] = newprofile
+            self._curr_profile = newprofile
             self.load()
 
     @property
     def client(self):
         if self._client is None:
             host = self.data["reqrouter_host"]
             self._client = SessionClient(host, self.getpath("cookies"))
```

## dagcli/root.py

```diff
@@ -1,93 +1,121 @@
 import typer
 from dagcli.configs import DagKnowsConfig
-import os, sys
+from dagcli.client import newapi
+import json, os, sys
 
 app = typer.Typer(pretty_exceptions_show_locals=False)
 
+DISABLE_LOGIN = False
+
 # This callback applies to *all* commands
 @app.callback()
 def common_params(ctx: typer.Context,
                   dagknows_home: str = typer.Option("~/.dagknows", envvar="DagKnowsHomeDir", help="Dir for DagKnows configs"),
-                  profile: str = typer.Option("default", envvar="DagKnowsProfile", help="DagKnows profile to use"),
+                  profile: str = typer.Option(None, envvar="DagKnowsProfile", help="DagKnows profile to use.  To set a default run `dk profiles set-default`"),
                   access_token: str = typer.Option(None, envvar='DagKnowsAccessToken', help='Access token for accessing DagKnows APIs'),
                   log_request: bool = typer.Option(False, help='Enables logging of requests'),
                   log_response: bool = typer.Option(False, help='Enables logging of responses'),
                   format: str = typer.Option("tree", envvar='DagKnowsOutputFormat', help='Output format to print as - json, yaml, tree')):
     assert ctx.obj is None
 
+    # See if there is a current file
+    dagknows_home_dir = os.path.expanduser(dagknows_home)
+    if not profile:
+        curr_config_file = os.path.join(dagknows_home_dir, "current")
+        if not os.path.isdir(dagknows_home_dir):
+            os.makedirs(dagknows_home_dir)
+        if not os.path.isfile(curr_config_file):
+            with open(curr_config_file, "w") as configfile:
+                curr_config = {
+                    "profile": "default"
+                }
+                configfile.write(json.dumps(curr_config, indent=4))
+        curr_config = json.loads(open(curr_config_file).read().strip() or "{}")
+        profile = curr_config["profile"]
+
     # For now these are env vars and not params yet
     reqrouter_host = os.environ.get('DagKnowsReqRouterHost', "")
     api_host = os.environ.get('DagKnowsApiGatewayHost', "")
-    ctx.obj  = DagKnowsConfig(os.path.expanduser(dagknows_home),
-                              profile=profile,
+    ctx.obj  = DagKnowsConfig(dagknows_home_dir, profile or "default",
                               output_format=format,
                               reqrouter_host=reqrouter_host,
                               api_host=api_host,
                               access_token=access_token,
                               log_request=log_request,
                               log_response=log_response)
 
 def ensure_access_token(ctx: typer.Context):
     if not ctx.obj.access_token:
-        ctx.fail("Access token needed.  Either login to install one or pass one via --access-token or set the DagKnowsAccessToken environment variable to it.")
+        ctx.fail(f"Access token missing in current config ({ctx.obj.curr_profile}).  You can manually pass an --access-token option, or set the DagKnowsAccessToken or initialize your profile with 'dk init --profile {ctx.obj.curr_profile}'")
 
 @app.command()
 def init(ctx: typer.Context,
          profile: str = typer.Option("default", help = "Name of the profie to initialize"),
+         api_host: str = typer.Option(None, help='API Host to use for this profile'),
+         username: str = typer.Option(None, help="Username/Email to login with if access_token not to be entered manually"),
+         password: str = typer.Option(None, help="Password to login with if access_token not to be entered manually"),
          access_token: str = typer.Option(None, help='Access token to initialize CLI with for this profile')):
     """ Initializes DagKnows config and state folders. """
     # Initialize the home directory
     dkconfig = ctx.obj
-    # if os.path.isdir(homedir):
-        # confirm = typer.confirm("You already have a homedir.  Do you want to remove all data and re-initializes the Dagknows CLI?", abort=True)
 
     # Enter the name of a default profile
     dkconfig.curr_profile = profile
     profile_data = dkconfig.profile_data
-    api_host = typer.prompt("Enter the api host to make api calls to: ", default="http://localhost:9080/api")
-    profile_data["api_host"] = api_host
+
+    if not api_host:
+        api_host = typer.prompt("Enter the api host to make api calls to: ", default="http://localhost:9080/api")
+        profile_data["api_host"] = api_host
 
     if not access_token:
-        access_token = typer.prompt("Enter an access token: ")
+        from rich.prompt import Prompt, Confirm
+        login = False
+        if not DISABLE_LOGIN:
+            login = username or password
+            if not login:
+                login = Confirm.ask("Would you like to login to get your access token?", default=True)
+        if login:
+            org = Prompt.ask("Please enter your org: ", default="dagknows")
+            if not username:
+                username = Prompt.ask("Please enter your username: ")
+            if not password:
+                password = Prompt.ask("Please enter your password: ")
+            # make call and get access_token
+            payload = {"org": org,
+                       "username": username,
+                       "credentials": { "password": password }
+                       }
+            resp = newapi(ctx.obj, "/v1/users/login", payload, "POST")
+            all_tokens = sorted([(v["expiry"], v,k) for k,v in resp["data"].items() if not v.get("revoked", False)])
+            access_token = all_tokens[-1][2]
+        else:
+            access_token = typer.prompt("Enter an access token: ")
 
     profile_data["access_tokens"] = [
         {"value": access_token}
     ]
     dkconfig.save()
 
 @app.command()
 def configs(ctx: typer.Context, as_json: bool=typer.Option(False, help="Control whether print as json or yaml")):
     """ Show all defaults and environments. """
     out = {
+        "curr_profile": ctx.obj.curr_profile,
         "profile_data": ctx.obj.profile_data,
         "overrides": ctx.obj.data,
     }
     if as_json:
         from pprint import pprint
         pprint(out)
     else:
         import yaml
         print(yaml.dump(out, sort_keys=False))
 
 def get_token_for_label(homedir: str, label: str) -> str:
     pass
 
 @app.command()
-def login(ctx: typer.Context, org: str = typer.Option("dagknows", help="Organization to login to"),
-          install_token: bool = typer.Option(True, help="Automatically install an access token for use"),
-          username: str = typer.Option(..., help="Username/Email to login with", prompt=True),
-          password: str = typer.Option(..., help="Username/Email to login with", prompt=True, hide_input=True)):
-    """ Logs into DagKnows and installs a new access token. """
-    sesscli = ctx.obj.client
-    sesscli.reset()
-    sesscli.login_with_email(username, password, org)
-    if install_token:
-        # TODO
-        pass
-    typer.echo("Congratulations.  You can now create and revoke tokens")
-
-@app.command()
 def logout(ctx: typer.Context):
     """ Logs out DagKnows and clears all sessions. """
     # TODO
     pass
```

## Comparing `dagknows-0.0.7.dist-info/LICENSE` & `dagknows-0.0.8.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `dagknows-0.0.7.dist-info/METADATA` & `dagknows-0.0.8.dist-info/METADATA`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: dagknows
-Version: 0.0.7
+Version: 0.0.8
 Summary: Our CLI utilities for DagKnows
 Home-page: https://github.com/dagknows/dagclis
 Author: Sriram Panyam
 Author-email: sri@dagknows.com
 License: BSD 3-Clause License
 Keywords: dagknows,cli,api,setuptools
 Classifier: License :: OSI Approved :: BSD License
```

## Comparing `dagknows-0.0.7.dist-info/RECORD` & `dagknows-0.0.8.dist-info/RECORD`

 * *Files 23% similar despite different names*

```diff
@@ -1,25 +1,25 @@
-dagcli/__init__.py,sha256=XyfCa8s3PhnmOEPyWMzr8o3uk0ehrYi88NSbwuPKACY,23
+dagcli/__init__.py,sha256=BkqodgHhiu8cdGziO-8AVXPBynuWuGTtraFN_upmHMs,23
 dagcli/client.py,sha256=mlB0Er7895Zjd3smcGwpOGBJwySn7Ac8rsMU1YyeGDI,6232
 dagcli/cmd.py,sha256=toO2-lYB23iysVfJ3KHlOCXRjZbrb7agHCnExhBKhDY,13656
-dagcli/configs.py,sha256=719y5YqAA2oGOSZMu7mCTJNM7Rze58hTkQJLVPpTuWs,4003
+dagcli/configs.py,sha256=RvexWcpyuXlBikPAg_cBnUN-dNCzZuxrafwzSg0JfEc,4065
 dagcli/dags.py,sha256=30jLWy_EytQOASobR50gJT2AkvWMCffh2Q-ASD7aNqA,6014
 dagcli/execs.py,sha256=LwG7_rvWkj1aTysBkhKANB8ETcSOgFGXnmqM-E9Z_3Q,2864
 dagcli/main.py,sha256=QcqNPlzKknkQyQLmabK3u8ndCNoXwizHRXZi6FLXziQ,2614
 dagcli/messages.py,sha256=ffmd5HmdYa1E1esl1epMPxuG9nKAhMfLokdG0MC9v68,2290
 dagcli/nodes.py,sha256=ylJP50kYxMPAoLnawKLCgMPzXFn9aRT9iUIygI8Yb1o,5655
 dagcli/proxy.py,sha256=aIIXT7UcX9NETvFfqmru4uwYrYwFRr1NeNw7KanBhUw,1833
-dagcli/root.py,sha256=Yk49RPzZmPvJlH64e3EfgauDMoJQEmv_wPCPuWwzoD0,4157
+dagcli/root.py,sha256=1zKA9zA1rDm8RDSced4ikTPAIZM3GHJZQ74iSu8shNI,5503
 dagcli/sessions.py,sha256=ZiuMICEa83xTWByxuVaCX7SkgCmgqwZZogwvkihwZfo,4098
 dagcli/swaggerutils.py,sha256=abIo_RzynXZyncK5ys2T0U79CaEA8RNUQDhUPwVPbYY,4743
 dagcli/tokens.py,sha256=vJC1zdR8dPd8pAfErOoLdGS3CtXWri-ZVAmgr_QsQZo,1171
 dagcli/transformers.py,sha256=h5WOgRWkTPCzfPF6ZZ6wuDv3sl4IpXPTnc6PFhTCsc0,3353
 dagcli/tries.py,sha256=8oKY5MDu5YyXCaLbvMgjsrWOs5ROD597PL7BiMLpPVs,5192
 dagcli/ty.py,sha256=SDEN1yTWs7RY2hD7-Pohu1tVE1YSEtIpczUsNUvF4dQ,777
 dagcli/utils.py,sha256=GdsrXDLIcpKvmzmWdIJafxC637FP6XEMtBK_iu7VOOA,4007
-dagknows-0.0.7.dist-info/LICENSE,sha256=M0q3orsPI5q4dF1tp7ENx9JOPvzjePppOlSlpfoilcc,1087
-dagknows-0.0.7.dist-info/METADATA,sha256=y2B8FcsFy4aZm97hGuzbktXSxvkNDwJzgqnB2ZhcnFE,1247
-dagknows-0.0.7.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
-dagknows-0.0.7.dist-info/entry_points.txt,sha256=kqij_XtXMQWjBLfjGaLMmvWKeyiLsHOFzhMTxHkthS0,60
-dagknows-0.0.7.dist-info/top_level.txt,sha256=ZyrCJ5UVk8RcMTCA5ZmGRiBB1YoUkaM1a77Biq0nThQ,7
-dagknows-0.0.7.dist-info/zip-safe,sha256=AbpHGcgLb-kRsJGnwFEktk7uzpZOCcBY74-YBdrKVGs,1
-dagknows-0.0.7.dist-info/RECORD,,
+dagknows-0.0.8.dist-info/LICENSE,sha256=M0q3orsPI5q4dF1tp7ENx9JOPvzjePppOlSlpfoilcc,1087
+dagknows-0.0.8.dist-info/METADATA,sha256=DyJjUyWbIbJOeNZB-l0tiLuDO6RN8MGl3-dsDiqfGPk,1247
+dagknows-0.0.8.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
+dagknows-0.0.8.dist-info/entry_points.txt,sha256=kqij_XtXMQWjBLfjGaLMmvWKeyiLsHOFzhMTxHkthS0,60
+dagknows-0.0.8.dist-info/top_level.txt,sha256=ZyrCJ5UVk8RcMTCA5ZmGRiBB1YoUkaM1a77Biq0nThQ,7
+dagknows-0.0.8.dist-info/zip-safe,sha256=AbpHGcgLb-kRsJGnwFEktk7uzpZOCcBY74-YBdrKVGs,1
+dagknows-0.0.8.dist-info/RECORD,,
```

