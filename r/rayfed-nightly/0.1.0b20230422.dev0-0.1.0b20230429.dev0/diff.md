# Comparing `tmp/rayfed_nightly-0.1.0b20230422.dev0-py3-none-any.whl.zip` & `tmp/rayfed_nightly-0.1.0b20230429.dev0-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,27 +1,27 @@
-Zip file size: 38170 bytes, number of entries: 25
--rw-r--r--  2.0 unx      853 b- defN 23-Apr-22 01:23 fed/__init__.py
--rw-r--r--  2.0 unx    15364 b- defN 23-Apr-22 01:23 fed/api.py
--rw-r--r--  2.0 unx    15749 b- defN 23-Apr-22 01:23 fed/barriers.py
--rw-r--r--  2.0 unx     2933 b- defN 23-Apr-22 01:23 fed/cleanup.py
--rw-r--r--  2.0 unx     2280 b- defN 23-Apr-22 01:23 fed/config.py
--rw-r--r--  2.0 unx     2877 b- defN 23-Apr-22 01:23 fed/fed_object.py
--rw-r--r--  2.0 unx     7908 b- defN 23-Apr-22 01:23 fed/tree_util.py
--rw-r--r--  2.0 unx     5254 b- defN 23-Apr-22 01:23 fed/utils.py
--rw-r--r--  2.0 unx      581 b- defN 23-Apr-22 01:23 fed/_private/__init__.py
--rw-r--r--  2.0 unx      581 b- defN 23-Apr-22 01:23 fed/_private/api.py
--rw-r--r--  2.0 unx     4487 b- defN 23-Apr-22 01:23 fed/_private/compatible_utils.py
--rw-r--r--  2.0 unx     1268 b- defN 23-Apr-22 01:23 fed/_private/constants.py
--rw-r--r--  2.0 unx     3837 b- defN 23-Apr-22 01:23 fed/_private/fed_actor.py
--rw-r--r--  2.0 unx     3825 b- defN 23-Apr-22 01:23 fed/_private/fed_call_holder.py
--rw-r--r--  2.0 unx      933 b- defN 23-Apr-22 01:23 fed/_private/global_context.py
--rw-r--r--  2.0 unx     2859 b- defN 23-Apr-22 01:23 fed/_private/grpc_options.py
--rw-r--r--  2.0 unx     2386 b- defN 23-Apr-22 01:23 fed/_private/serialization_utils.py
--rw-r--r--  2.0 unx      581 b- defN 23-Apr-22 01:23 fed/grpc/__init__.py
--rw-r--r--  2.0 unx     5608 b- defN 23-Apr-22 01:23 fed/grpc/fed_pb2.py
--rw-r--r--  2.0 unx     2955 b- defN 23-Apr-22 01:23 fed/grpc/fed_pb2_grpc.py
--rw-r--r--  2.0 unx    11356 b- defN 23-Apr-22 01:25 rayfed_nightly-0.1.0b20230422.dev0.dist-info/LICENSE
--rw-r--r--  2.0 unx     7243 b- defN 23-Apr-22 01:25 rayfed_nightly-0.1.0b20230422.dev0.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 23-Apr-22 01:25 rayfed_nightly-0.1.0b20230422.dev0.dist-info/WHEEL
--rw-r--r--  2.0 unx        4 b- defN 23-Apr-22 01:25 rayfed_nightly-0.1.0b20230422.dev0.dist-info/top_level.txt
--rw-rw-r--  2.0 unx     2052 b- defN 23-Apr-22 01:25 rayfed_nightly-0.1.0b20230422.dev0.dist-info/RECORD
-25 files, 103866 bytes uncompressed, 34872 bytes compressed:  66.4%
+Zip file size: 38323 bytes, number of entries: 25
+-rw-r--r--  2.0 unx      853 b- defN 23-Apr-29 01:23 fed/__init__.py
+-rw-r--r--  2.0 unx    15904 b- defN 23-Apr-29 01:23 fed/api.py
+-rw-r--r--  2.0 unx    16086 b- defN 23-Apr-29 01:23 fed/barriers.py
+-rw-r--r--  2.0 unx     2933 b- defN 23-Apr-29 01:23 fed/cleanup.py
+-rw-r--r--  2.0 unx     2280 b- defN 23-Apr-29 01:23 fed/config.py
+-rw-r--r--  2.0 unx     2877 b- defN 23-Apr-29 01:23 fed/fed_object.py
+-rw-r--r--  2.0 unx     7908 b- defN 23-Apr-29 01:23 fed/tree_util.py
+-rw-r--r--  2.0 unx     5254 b- defN 23-Apr-29 01:23 fed/utils.py
+-rw-r--r--  2.0 unx      581 b- defN 23-Apr-29 01:23 fed/_private/__init__.py
+-rw-r--r--  2.0 unx      581 b- defN 23-Apr-29 01:23 fed/_private/api.py
+-rw-r--r--  2.0 unx     4487 b- defN 23-Apr-29 01:23 fed/_private/compatible_utils.py
+-rw-r--r--  2.0 unx     1268 b- defN 23-Apr-29 01:23 fed/_private/constants.py
+-rw-r--r--  2.0 unx     3837 b- defN 23-Apr-29 01:23 fed/_private/fed_actor.py
+-rw-r--r--  2.0 unx     3825 b- defN 23-Apr-29 01:23 fed/_private/fed_call_holder.py
+-rw-r--r--  2.0 unx     1017 b- defN 23-Apr-29 01:23 fed/_private/global_context.py
+-rw-r--r--  2.0 unx     2859 b- defN 23-Apr-29 01:23 fed/_private/grpc_options.py
+-rw-r--r--  2.0 unx     2386 b- defN 23-Apr-29 01:23 fed/_private/serialization_utils.py
+-rw-r--r--  2.0 unx      581 b- defN 23-Apr-29 01:23 fed/grpc/__init__.py
+-rw-r--r--  2.0 unx     5608 b- defN 23-Apr-29 01:23 fed/grpc/fed_pb2.py
+-rw-r--r--  2.0 unx     2955 b- defN 23-Apr-29 01:23 fed/grpc/fed_pb2_grpc.py
+-rw-r--r--  2.0 unx    11356 b- defN 23-Apr-29 01:25 rayfed_nightly-0.1.0b20230429.dev0.dist-info/LICENSE
+-rw-r--r--  2.0 unx     7243 b- defN 23-Apr-29 01:25 rayfed_nightly-0.1.0b20230429.dev0.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 23-Apr-29 01:25 rayfed_nightly-0.1.0b20230429.dev0.dist-info/WHEEL
+-rw-r--r--  2.0 unx        4 b- defN 23-Apr-29 01:25 rayfed_nightly-0.1.0b20230429.dev0.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx     2053 b- defN 23-Apr-29 01:25 rayfed_nightly-0.1.0b20230429.dev0.dist-info/RECORD
+25 files, 104828 bytes uncompressed, 35025 bytes compressed:  66.6%
```

## zipnote {}

```diff
@@ -54,23 +54,23 @@
 
 Filename: fed/grpc/fed_pb2.py
 Comment: 
 
 Filename: fed/grpc/fed_pb2_grpc.py
 Comment: 
 
-Filename: rayfed_nightly-0.1.0b20230422.dev0.dist-info/LICENSE
+Filename: rayfed_nightly-0.1.0b20230429.dev0.dist-info/LICENSE
 Comment: 
 
-Filename: rayfed_nightly-0.1.0b20230422.dev0.dist-info/METADATA
+Filename: rayfed_nightly-0.1.0b20230429.dev0.dist-info/METADATA
 Comment: 
 
-Filename: rayfed_nightly-0.1.0b20230422.dev0.dist-info/WHEEL
+Filename: rayfed_nightly-0.1.0b20230429.dev0.dist-info/WHEEL
 Comment: 
 
-Filename: rayfed_nightly-0.1.0b20230422.dev0.dist-info/top_level.txt
+Filename: rayfed_nightly-0.1.0b20230429.dev0.dist-info/top_level.txt
 Comment: 
 
-Filename: rayfed_nightly-0.1.0b20230422.dev0.dist-info/RECORD
+Filename: rayfed_nightly-0.1.0b20230429.dev0.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## fed/api.py

```diff
@@ -22,15 +22,15 @@
 
 import fed._private.compatible_utils as compatible_utils
 import fed.config as fed_config
 import fed.utils as fed_utils
 from fed._private import constants
 from fed._private.fed_actor import FedActorHandle
 from fed._private.fed_call_holder import FedCallHolder
-from fed._private.global_context import get_global_context
+from fed._private.global_context import get_global_context, clear_global_context
 from fed.barriers import ping_others, recv, send, start_recv_proxy, start_send_proxy
 from fed.cleanup import set_exit_on_failure_sending, wait_sending
 from fed.fed_object import FedObject
 from fed.utils import is_ray_object_refs, setup_logger
 
 logger = logging.getLogger(__name__)
 
@@ -63,29 +63,35 @@
             .. code:: python
                 {
                     'alice': {
                         # The address for other parties.
                         'address': '127.0.0.1:10001',
                         # (Optional) the listen address, the `address` will be
                         # used if not provided.
-                        'listen_addr': '0.0.0.0:10001'
+                        'listen_addr': '0.0.0.0:10001',
+                        # (Optional) The party specific metadata sent with the grpc request
+                        'grpc_metadata': (('token', 'alice-token'),),
                     },
                     'bob': {
                         # The address for other parties.
                         'address': '127.0.0.1:10002',
                         # (Optional) the listen address, the `address` will be
                         # used if not provided.
-                        'listen_addr': '0.0.0.0:10002'
+                        'listen_addr': '0.0.0.0:10002',
+                        # (Optional) The party specific metadata sent with the grpc request
+                        'grpc_metadata': (('token', 'bob-token'),),
                     },
                     'carol': {
                         # The address for other parties.
                         'address': '127.0.0.1:10003',
                         # (Optional) the listen address, the `address` will be
                         # used if not provided.
-                        'listen_addr': '0.0.0.0:10003'
+                        'listen_addr': '0.0.0.0:10003',
+                        # (Optional) The party specific metadata sent with the grpc request
+                        'grpc_metadata': (('token', 'carol-token'),),
                     },
                 }
         party: optional; self party.
         tls_config: optional; a dict describes the tls config. E.g.
             For alice,
 
             .. code:: python
@@ -172,15 +178,15 @@
             cross_silo_serializing_allowed_list,
         constants.KEY_OF_CROSS_SILO_MESSAGES_MAX_SIZE_IN_BYTES:
             cross_silo_messages_max_size_in_bytes,
         constants.KEY_OF_CROSS_SILO_TIMEOUT_IN_SECONDS: cross_silo_timeout_in_seconds,
     }
 
     job_config = {
-       constants.KEY_OF_GRPC_METADATA : grpc_metadata,
+        constants.KEY_OF_GRPC_METADATA : grpc_metadata,
     }
     compatible_utils.kv.put(constants.KEY_OF_CLUSTER_CONFIG,
                             cloudpickle.dumps(cluster_config))
     compatible_utils.kv.put(constants.KEY_OF_JOB_CONFIG, cloudpickle.dumps(job_config))
     # Set logger.
     # Note(NKcqx): This should be called after internal_kv has party value, i.e.
     # after `ray.init` and
@@ -220,16 +226,17 @@
     """
     Shutdown a RayFed client.
     """
     wait_sending()
     compatible_utils.kv.delete(constants.KEY_OF_CLUSTER_CONFIG)
     compatible_utils.kv.delete(constants.KEY_OF_JOB_CONFIG)
     compatible_utils.kv.reset()
+    clear_global_context()
     ray.shutdown()
-    logger.info('Shutdowned ray.')
+    logger.info('Shutdowned rayfed.')
 
 
 def _get_cluster():
     """
     Get the RayFed cluster configration.
     """
     return fed_config.get_cluster_config().cluster_addresses
```

## fed/barriers.py

```diff
@@ -226,21 +226,29 @@
             f'from {upstream_seq_id}'
         )
         logger.debug(
             f'Sending {send_log_msg} with{"out" if not self._tls_config else ""}'
             ' credentials.'
         )
         dest_addr = self._cluster[dest_party]['address']
+        dest_party_grpc_metadata = dict(
+            self._cluster[dest_party].get('grpc_metadata', {})
+        )
+        global_grpc_metadata = (
+            dict(self._grpc_metadata) if self._grpc_metadata is not None else {}
+        )
+        # merge grpc metadata
+        grpc_metadata = {**global_grpc_metadata, **dest_party_grpc_metadata}
         try:
             response = await send_data_grpc(
                 dest=dest_addr,
                 data=data,
                 upstream_seq_id=upstream_seq_id,
                 downstream_seq_id=downstream_seq_id,
-                metadata=self._grpc_metadata,
+                metadata=grpc_metadata,
                 tls_config=self._tls_config,
                 retry_policy=self.retry_policy,
             )
         except Exception as e:
             logger.error(f'Failed to {send_log_msg}, error: {e}')
             return False
         logger.debug(f"Succeeded to send {send_log_msg}. Response is {response}")
@@ -362,15 +370,15 @@
     cluster: Dict,
     party: str,
     logging_level: str,
     tls_config: Dict = None,
     retry_policy=None,
     max_retries=None,
 ):
-    # Create RecevrProxyActor
+    # Create SendProxyActor
     global _SEND_PROXY_ACTOR
     if max_retries is not None:
         _SEND_PROXY_ACTOR = SendProxyActor.options(
             name="SendProxyActor",
             max_concurrency=1000,
             max_task_retries=max_retries,
             max_restarts=1,
```

## fed/_private/global_context.py

```diff
@@ -26,7 +26,12 @@
 
 
 def get_global_context():
     global _global_context
     if _global_context is None:
         _global_context = GlobalContext()
     return _global_context
+
+
+def clear_global_context():
+    global _global_context
+    _global_context = None
```

## Comparing `rayfed_nightly-0.1.0b20230422.dev0.dist-info/LICENSE` & `rayfed_nightly-0.1.0b20230429.dev0.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `rayfed_nightly-0.1.0b20230422.dev0.dist-info/METADATA` & `rayfed_nightly-0.1.0b20230429.dev0.dist-info/METADATA`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: rayfed-nightly
-Version: 0.1.0b20230422.dev0
+Version: 0.1.0b20230429.dev0
 Summary: A multiple parties joint, distributed execution engine based on Ray,to help build your own federated learning frameworks in minutes.
 Home-page: https://github.com/ray-project/rayfed
 Author: RayFed Team
 Author-email: rayfed-dev@googlegroups.com
 License: Apache 2.0
 Platform: UNKNOWN
 Description-Content-Type: text/markdown
```

## Comparing `rayfed_nightly-0.1.0b20230422.dev0.dist-info/RECORD` & `rayfed_nightly-0.1.0b20230429.dev0.dist-info/RECORD`

 * *Files 7% similar despite different names*

```diff
@@ -1,25 +1,25 @@
 fed/__init__.py,sha256=6Xds1gLndBN-E4GBTuxnc7gf3Zw_D8iNejjA3JTjWnc,853
-fed/api.py,sha256=w9eNrciaJxADs1Tx_lHaYNi9BDik2POpPLXpWnoo4LU,15364
-fed/barriers.py,sha256=bj0LZ6KxBzbziR6C7gU77S0s_75Mw6G_GUCB56IZ_mU,15749
+fed/api.py,sha256=sf1JOAYRel6slaO3U4_X1WLz-siIHLTdNZI8rjFZDvk,15904
+fed/barriers.py,sha256=KnIDXzrWUx8HKGPCYO20GHy2s01u78HWPjIlN0wOpPA,16086
 fed/cleanup.py,sha256=5P_Z6nX7GqB6WbHt1b8oVhNdUfYVRhclDdgUNt5weK0,2933
 fed/config.py,sha256=bpflURNHjH224XWM9BUgvMLzH-3BRzZJ_oX0PtdErrw,2280
 fed/fed_object.py,sha256=l2BRa9WZ3jqXSDjwFPURcAIK8XkH8A5UYA_OcY4TOD0,2877
 fed/tree_util.py,sha256=25LiGASBcreE34OsGsoeRWH4t6BuBk3QVcKjCe38jTI,7908
 fed/utils.py,sha256=gMJrnH9-EPkcWrwWyXRtnl5HOGeCl1kP2Gc0In7m5es,5254
 fed/_private/__init__.py,sha256=MDXwlZ-y7_o-tfqh8DVkjlO-6MlWqwLdbSIZUJfXtF0,581
 fed/_private/api.py,sha256=MDXwlZ-y7_o-tfqh8DVkjlO-6MlWqwLdbSIZUJfXtF0,581
 fed/_private/compatible_utils.py,sha256=ZhaLX797pZ-PnwlNIMgRzkwrysW0wbruQLHm-WsNUUs,4487
 fed/_private/constants.py,sha256=r0vt4ueAsB3cyNVOQ8lJZgCCDosYHgNYZblaUfapk1o,1268
 fed/_private/fed_actor.py,sha256=8nqXO_l9yOno5duMiEhWagp9q9-w696erKos-RgcnoU,3837
 fed/_private/fed_call_holder.py,sha256=uJhmyq1nIn4nqJUg1bOqjgXrgFscZHsdpi5pXrXPF2M,3825
-fed/_private/global_context.py,sha256=QUEE9RttgdWOHvXZsycKnxeMTKo1E0nGp7Zyxnxb_Zw,933
+fed/_private/global_context.py,sha256=dlfeqdp6C_5bGDvzHcxbR6xZGELfVyoQtDIZ4ampwZw,1017
 fed/_private/grpc_options.py,sha256=_r43xjQfg0JmD0T447wHV42EYhP0YpBubsGKG22TuN4,2859
 fed/_private/serialization_utils.py,sha256=l63nacVabcyKpys9tVT2zUMmKecimeVflsJ6v45AYvc,2386
 fed/grpc/__init__.py,sha256=MDXwlZ-y7_o-tfqh8DVkjlO-6MlWqwLdbSIZUJfXtF0,581
 fed/grpc/fed_pb2.py,sha256=CKRJyBIx8MG4XtqtARL9ETFEyIsX2ksO0IVU9JgBhWQ,5608
 fed/grpc/fed_pb2_grpc.py,sha256=PsTotUwY4gEHWV0gQnPwpoQWdNJCczNZti6bJBYFj5Q,2955
-rayfed_nightly-0.1.0b20230422.dev0.dist-info/LICENSE,sha256=QwcOLU5TJoTeUhuIXzhdCEEDDvorGiC6-3YTOl4TecE,11356
-rayfed_nightly-0.1.0b20230422.dev0.dist-info/METADATA,sha256=pcqZbpQe0dO191pJ2liQxLIKNFk-U2ra5tr5BEqWMes,7243
-rayfed_nightly-0.1.0b20230422.dev0.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
-rayfed_nightly-0.1.0b20230422.dev0.dist-info/top_level.txt,sha256=5gd1qhbpzLAi36ONV8p_s65_-iAiOSwFljYh-ONEwts,4
-rayfed_nightly-0.1.0b20230422.dev0.dist-info/RECORD,,
+rayfed_nightly-0.1.0b20230429.dev0.dist-info/LICENSE,sha256=QwcOLU5TJoTeUhuIXzhdCEEDDvorGiC6-3YTOl4TecE,11356
+rayfed_nightly-0.1.0b20230429.dev0.dist-info/METADATA,sha256=4Sn0SYbmA1U2UY3rglxZsBeNwqhnNagjSWzOLcjT-sA,7243
+rayfed_nightly-0.1.0b20230429.dev0.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
+rayfed_nightly-0.1.0b20230429.dev0.dist-info/top_level.txt,sha256=5gd1qhbpzLAi36ONV8p_s65_-iAiOSwFljYh-ONEwts,4
+rayfed_nightly-0.1.0b20230429.dev0.dist-info/RECORD,,
```

